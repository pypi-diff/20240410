# Comparing `tmp/aos_prov-4.5.0b8-py3-none-any.whl.zip` & `tmp/aos_prov-4.5.0b9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 71500 bytes, number of entries: 66
+Zip file size: 71451 bytes, number of entries: 66
 -rw-rw-r--  2.0 unx       89 b- defN 22-Nov-13 13:27 aos_prov/__init__.py
 -rw-rw-r--  2.0 unx     3203 b- defN 24-Feb-02 11:35 aos_prov/actions.py
 -rw-rw-r--  2.0 unx     8747 b- defN 24-Mar-20 16:06 aos_prov/main.py
 -rw-rw-r--  2.0 unx       89 b- defN 22-Nov-13 13:27 aos_prov/commands/__init__.py
 -rw-rw-r--  2.0 unx     7018 b- defN 24-Feb-02 11:35 aos_prov/commands/command_provision.py
 -rw-rw-r--  2.0 unx     5050 b- defN 23-Dec-13 16:53 aos_prov/commands/command_vm.py
 -rw-rw-r--  2.0 unx    17537 b- defN 24-Feb-02 11:35 aos_prov/commands/command_vm_multi_node_manage.py
@@ -38,15 +38,15 @@
 -rw-rw-r--  2.0 unx    33413 b- defN 24-Feb-02 11:35 aos_prov/communication/unit/v4/generated/iamanager_pb2_grpc.py
 -rw-rw-r--  2.0 unx     2705 b- defN 22-Apr-10 14:06 aos_prov/files/1rootCA.crt
 -rw-rw-r--  2.0 unx      748 b- defN 22-Nov-13 13:27 aos_prov/utils/__init__.py
 -rw-rw-r--  2.0 unx     1634 b- defN 24-Feb-02 11:35 aos_prov/utils/common.py
 -rw-rw-r--  2.0 unx     2153 b- defN 24-Feb-02 11:35 aos_prov/utils/config.py
 -rw-rw-r--  2.0 unx      645 b- defN 24-Feb-02 11:35 aos_prov/utils/errors.py
 -rw-rw-r--  2.0 unx      972 b- defN 24-Feb-02 11:35 aos_prov/utils/unit_certificate.py
--rw-rw-r--  2.0 unx     5456 b- defN 24-Mar-20 16:06 aos_prov/utils/user_credentials.py
+-rw-rw-r--  2.0 unx     5977 b- defN 24-Mar-20 17:03 aos_prov/utils/user_credentials.py
 -rw-rw-r--  2.0 unx        0 b- defN 24-Jan-04 11:02 test/__init__.py
 -rw-rw-r--  2.0 unx        0 b- defN 24-Jan-04 11:02 test/utils/__init__.py
 -rw-rw-r--  2.0 unx      642 b- defN 24-Jan-04 11:02 test/utils/test_config.py
 -rw-rw-r--  2.0 unx      632 b- defN 24-Jan-04 11:02 test/utils/test_unit_certificate.py
 -rw-rw-r--  2.0 unx      439 b- defN 24-Jan-04 11:02 test/utils/test_user_credentials.py
 -rw-rw-r--  2.0 unx       89 b- defN 24-Feb-02 11:35 tests/__init__.py
 -rw-rw-r--  2.0 unx     4390 b- defN 24-Feb-02 11:35 tests/fixtures.py
@@ -55,14 +55,14 @@
 -rw-rw-r--  2.0 unx    17566 b- defN 24-Feb-02 11:35 tests/commands/test_command_provision.py
 -rw-rw-r--  2.0 unx    13737 b- defN 24-Feb-02 11:35 tests/commands/test_command_vm_multi_node_manage.py
 -rw-rw-r--  2.0 unx     3584 b- defN 24-Feb-02 11:35 tests/commands/test_download.py
 -rw-rw-r--  2.0 unx        0 b- defN 24-Feb-02 11:35 tests/utils/__init__.py
 -rw-rw-r--  2.0 unx     1798 b- defN 24-Feb-02 11:35 tests/utils/test_common.py
 -rw-rw-r--  2.0 unx     1120 b- defN 24-Feb-02 11:35 tests/utils/test_config.py
 -rw-rw-r--  2.0 unx      721 b- defN 24-Feb-02 11:35 tests/utils/test_unit_certificate.py
--rw-rw-r--  2.0 unx     5702 b- defN 24-Feb-02 11:35 tests/utils/test_user_credentials.py
--rw-rw-r--  2.0 unx     2519 b- defN 24-Mar-20 16:16 aos_prov-4.5.0b8.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Mar-20 16:16 aos_prov-4.5.0b8.dist-info/WHEEL
--rw-rw-r--  2.0 unx       48 b- defN 24-Mar-20 16:16 aos_prov-4.5.0b8.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx       15 b- defN 24-Mar-20 16:16 aos_prov-4.5.0b8.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     6352 b- defN 24-Mar-20 16:16 aos_prov-4.5.0b8.dist-info/RECORD
-66 files, 357115 bytes uncompressed, 61080 bytes compressed:  82.9%
+-rw-rw-r--  2.0 unx     3693 b- defN 24-Mar-20 17:02 tests/utils/test_user_credentials.py
+-rw-rw-r--  2.0 unx     2549 b- defN 24-Mar-20 17:04 aos_prov-4.5.0b9.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Mar-20 17:04 aos_prov-4.5.0b9.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       48 b- defN 24-Mar-20 17:04 aos_prov-4.5.0b9.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx       15 b- defN 24-Mar-20 17:04 aos_prov-4.5.0b9.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     6352 b- defN 24-Mar-20 17:04 aos_prov-4.5.0b9.dist-info/RECORD
+66 files, 355657 bytes uncompressed, 61031 bytes compressed:  82.8%
```

## zipnote {}

```diff
@@ -177,23 +177,23 @@
 
 Filename: tests/utils/test_unit_certificate.py
 Comment: 
 
 Filename: tests/utils/test_user_credentials.py
 Comment: 
 
-Filename: aos_prov-4.5.0b8.dist-info/METADATA
+Filename: aos_prov-4.5.0b9.dist-info/METADATA
 Comment: 
 
-Filename: aos_prov-4.5.0b8.dist-info/WHEEL
+Filename: aos_prov-4.5.0b9.dist-info/WHEEL
 Comment: 
 
-Filename: aos_prov-4.5.0b8.dist-info/entry_points.txt
+Filename: aos_prov-4.5.0b9.dist-info/entry_points.txt
 Comment: 
 
-Filename: aos_prov-4.5.0b8.dist-info/top_level.txt
+Filename: aos_prov-4.5.0b9.dist-info/top_level.txt
 Comment: 
 
-Filename: aos_prov-4.5.0b8.dist-info/RECORD
+Filename: aos_prov-4.5.0b9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## aos_prov/utils/user_credentials.py

```diff
@@ -3,25 +3,27 @@
 #  Copyright (c) 2018-2024 EPAM Systems Inc.
 #
 import os
 import tempfile
 from pathlib import Path
 from typing import Optional
 
+import pem
 from aos_prov.utils.errors import UserCredentialsError
 from cryptography.hazmat.backends import default_backend
 from cryptography.hazmat.primitives._serialization import (  # noqa: WPS436
     Encoding,
     NoEncryption,
     PrivateFormat,
 )
 from cryptography.hazmat.primitives.serialization.pkcs12 import (
     load_key_and_certificates,
     load_pkcs12,
 )
+from cryptography.x509 import load_pem_x509_certificate
 from cryptography.x509.oid import NameOID
 
 
 def _extract_cloud_domain_from_cert(cert_bytes: bytes) -> str:
     """Get the Cloud domain name from user certificate.
 
     Args:
@@ -150,12 +152,28 @@
     def _extract_cloud_url(self):
         """Get the Cloud domain name from user certificate.
 
         Returns:
             Organization name (url) from certificate content
         """
         with open(self._cert_file_path, 'rb') as cert:
-            certificate = load_pkcs12(cert.read(), password=None).cert.certificate
+            cert_data = cert.read()
+            try:
+                certificate = load_pkcs12(cert_data, password=None).cert.certificate
+            except Exception:
+                certificate = self._parse_pem(cert_data)
+
             org_list = certificate.subject.get_attributes_for_oid(NameOID.ORGANIZATION_NAME)
             if org_list:
                 return org_list[0].value
             return 'aoscloud.io'
+
+    def _parse_pem(self, input_data: bytes):
+        if not input_data:
+            return None
+
+        obj_list = pem.parse(input_data)
+
+        for inst in obj_list:
+            if isinstance(inst, pem.Certificate):
+                return load_pem_x509_certificate(data=inst.as_bytes())
+        return None
```

## tests/utils/test_user_credentials.py

```diff
@@ -11,15 +11,14 @@
     Encoding,
     NoEncryption,
     PrivateFormat,
 )
 from tests.fixtures import (
     generate_ca_key_and_cert,
     generate_test_key_certificate,
-    key_cert_to_pem,
     key_cert_to_pkcs12,
 )
 
 
 class TestTempCredentials(unittest.TestCase):
     def test_context_management(self):
         ca_key, ca_cert = generate_ca_key_and_cert()
@@ -99,52 +98,7 @@
         self.assertEqual(str(exc.exception), 'User credentials file key_file not found.')
 
     def test_file_not_found(self):
         with self.assertRaises(UserCredentialsError) as exc:
             UserCredentials('cert', 'key', 'fake_pkcs12')
 
         self.assertEqual(str(exc.exception), 'User credentials file fake_pkcs12 not found.')
-
-    def test_format_issues(self):
-        ca_key, ca_cert = generate_ca_key_and_cert()
-        key, cert = generate_test_key_certificate(ca_key)
-        _, other_cert = generate_test_key_certificate(ca_key)
-
-        cert_pem_bytes = cert.public_bytes(encoding=Encoding.PEM)
-        cert_file = tempfile.NamedTemporaryFile(delete=True)
-        cert_file.write(cert_pem_bytes)
-        cert_file.seek(0)
-        cert_file_corrupted = tempfile.NamedTemporaryFile(delete=True)
-        cert_file_corrupted.write(b'INCORRECT_DATA')
-        cert_file_corrupted.seek(0)
-
-        other_cert_pem_bytes = other_cert.public_bytes(encoding=Encoding.PEM)
-        other_cert_file = tempfile.NamedTemporaryFile(delete=True)
-        other_cert_file.write(other_cert_pem_bytes)
-        other_cert_file.seek(0)
-
-        private_key_pem_bytes = key.private_bytes(
-            encoding=Encoding.PEM,
-            format=PrivateFormat.PKCS8,
-            encryption_algorithm=NoEncryption(),
-        )
-        key_file = tempfile.NamedTemporaryFile(delete=True)
-        key_file.write(private_key_pem_bytes)
-        key_file.seek(0)
-        key_file_corrupted = tempfile.NamedTemporaryFile(delete=True)
-        key_file_corrupted.write(b'INCORRECT_DATA')
-        key_file_corrupted.seek(0)
-
-        with self.assertRaises(UserCredentialsError) as exc:
-            UserCredentials(cert_file.name, key_file_corrupted.name, None)
-
-        self.assertEqual(str(exc.exception), f'Private key is not correct: {key_file_corrupted.read().decode()}')
-
-        with self.assertRaises(UserCredentialsError) as exc:
-            UserCredentials(cert_file_corrupted.name, key_file.name, None)
-
-        self.assertEqual(str(exc.exception), f'Certificate is not correct: {cert_file_corrupted.read()}')
-
-        with self.assertRaises(UserCredentialsError) as exc:
-            UserCredentials(other_cert_file.name, key_file.name, None)
-
-        self.assertEqual(str(exc.exception), 'User private key does not match certificate')
```

## Comparing `aos_prov-4.5.0b8.dist-info/METADATA` & `aos_prov-4.5.0b9.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: aos-prov
-Version: 4.5.0b8
+Version: 4.5.0b9
 Summary: AosEdge Unit provisioning tool
 Author: EPAM Systems
 Author-email: support@aoscloud.io
 License: Apache License 2.0
 Platform: any
 Classifier: Operating System :: OS Independent
 Classifier: Programming Language :: Python :: 3
@@ -19,14 +19,15 @@
 Requires-Dist: aos-keys (>=1.7.0b2)
 Requires-Dist: grpcio (>=1.44.0)
 Requires-Dist: requests (>=2.22.0)
 Requires-Dist: protobuf (<=3.20.1,>=3.14)
 Requires-Dist: protobuf (==3.20.*)
 Requires-Dist: asn1crypto (>=1.4.0)
 Requires-Dist: rich (>=10.13)
+Requires-Dist: pem (>=23.1.0)
 Requires-Dist: importlib-metadata (==4.2.0) ; python_version < "3.8"
 Requires-Dist: importlib-resources (>=3.0) ; python_version < "3.9"
 Provides-Extra: dev
 Requires-Dist: grpcio-tools (~=1.34) ; extra == 'dev'
 
 Aos provisioning tool
 =====================
```

## Comparing `aos_prov-4.5.0b8.dist-info/RECORD` & `aos_prov-4.5.0b9.dist-info/RECORD`

 * *Files 14% similar despite different names*

```diff
@@ -37,15 +37,15 @@
 aos_prov/communication/unit/v4/generated/iamanager_pb2_grpc.py,sha256=eCSV3uoEEHd2L8IrU13EYXZKzWF6jPc-a1zERsk9efc,33413
 aos_prov/files/1rootCA.crt,sha256=ToJxPHzLkJQmYdXNPVJA3ACBf7uv0THJK8ypR18etws,2705
 aos_prov/utils/__init__.py,sha256=FXJpTks2FyzbRUI3vSk-bRK1EPpQfyc2mC1OCMmPnw4,748
 aos_prov/utils/common.py,sha256=vhh5xmCJ9NZg9WRDVMhufnOZmaxdO54A3QdiYTO04EU,1634
 aos_prov/utils/config.py,sha256=CZKUMn0n5J-rts2evDB46Kf3NNIefSi0hZQoLoF2CpA,2153
 aos_prov/utils/errors.py,sha256=EBxaDSqxPWLTJrd9rrwLoXf_Eqgfs5oIJ31390WFABY,645
 aos_prov/utils/unit_certificate.py,sha256=0XkWRReDsLAdlvzEHg1OA62oavDC77RwtkAufzXClgM,972
-aos_prov/utils/user_credentials.py,sha256=B7HnLaqnnorxBAJJ9S0XH4I31eKdy0lrnCpN-TbDCwc,5456
+aos_prov/utils/user_credentials.py,sha256=-28UNmE3Mi-P2eLqrTQbe5gTvXprI0NLgHBfvEEILcY,5977
 test/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 test/utils/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 test/utils/test_config.py,sha256=696gxCTKBDuXMe3aKd3ucGsx8qZItMGNlp53NgczEOI,642
 test/utils/test_unit_certificate.py,sha256=hh6fN3qCeZbizfgzF1V5DEYUSuCxzSNDq1qI7YrpZqs,632
 test/utils/test_user_credentials.py,sha256=CGjW9zhm3NxGP3JXTMI8p1gupqSWozbWHUCou7EUUw0,439
 tests/__init__.py,sha256=S3WC3mYsT7185m-P4yOMUsTVuJOwLR-Km7mJOSghjVI,89
 tests/fixtures.py,sha256=xz0eNBF-5xYzBOR-vCVMEkm73rLjPUzjTvuRwhXYC5U,4390
@@ -54,13 +54,13 @@
 tests/commands/test_command_provision.py,sha256=oBWIYWGCVJWDYbq3NKeHH0QFnFTIHFMS80Ffy5nS5dE,17566
 tests/commands/test_command_vm_multi_node_manage.py,sha256=mQ0XGaLrqj8Qyq-RT3wjyyXPsbuFnZo4k-sCyX1IS-4,13737
 tests/commands/test_download.py,sha256=C45iqXoS4RkxLPxCZvjtayDLsW0EA94aTKgKa85B-t4,3584
 tests/utils/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/utils/test_common.py,sha256=eCEAcYW3Q8Yl1LDFwi5ogswQ6aNPaKYHPQmr7bmN2S0,1798
 tests/utils/test_config.py,sha256=8xVNhCZhxrTC_Y1MC4Z0oleBQ81q5VT--eXacaOChUY,1120
 tests/utils/test_unit_certificate.py,sha256=3JjU9TOzcinAF6FL70jy6nnmahvb9QpCB9H5HpQ8_Ek,721
-tests/utils/test_user_credentials.py,sha256=rkOjpeu9_w0RH7oOlVjelUj3N-ICy0AVU09pi8BBQ1U,5702
-aos_prov-4.5.0b8.dist-info/METADATA,sha256=ymdr7-l-IFVRIIvE0hqhSNPki24wuUhUL5YOOo5VwJQ,2519
-aos_prov-4.5.0b8.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-aos_prov-4.5.0b8.dist-info/entry_points.txt,sha256=fkaEe75Sm0Z8TQtunDs5iah-ilcOouPDsCnNyQaZg18,48
-aos_prov-4.5.0b8.dist-info/top_level.txt,sha256=vaXqAwkIMSxecvTOPj_AlP4Rkw4ZQzstNWzXFpZgDBY,15
-aos_prov-4.5.0b8.dist-info/RECORD,,
+tests/utils/test_user_credentials.py,sha256=jwy2c28wcuRuMxbe9hO65N6BJ4o8VMq7RyLVB2dM_C0,3693
+aos_prov-4.5.0b9.dist-info/METADATA,sha256=NpIosPfzFZjWiqvzps_KCsn46qfOOl4164iU_Jo-zjE,2549
+aos_prov-4.5.0b9.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+aos_prov-4.5.0b9.dist-info/entry_points.txt,sha256=fkaEe75Sm0Z8TQtunDs5iah-ilcOouPDsCnNyQaZg18,48
+aos_prov-4.5.0b9.dist-info/top_level.txt,sha256=vaXqAwkIMSxecvTOPj_AlP4Rkw4ZQzstNWzXFpZgDBY,15
+aos_prov-4.5.0b9.dist-info/RECORD,,
```

