# Comparing `tmp/ip_check-1.5.3-py3-none-any.whl.zip` & `tmp/ip_check-1.5.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 38150 bytes, number of entries: 31
+Zip file size: 38141 bytes, number of entries: 31
 -rw-rw-r--  2.0 unx      383 b- defN 24-Mar-19 08:00 ipcheck/__init__.py
--rw-rw-r--  2.0 unx     6609 b- defN 24-Apr-02 02:06 ipcheck/geoinfo.py
--rw-rw-r--  2.0 unx    10450 b- defN 24-Apr-09 02:49 ipcheck/main.py
+-rw-rw-r--  2.0 unx     6184 b- defN 24-Apr-09 05:35 ipcheck/geoinfo.py
+-rw-rw-r--  2.0 unx    10544 b- defN 24-Apr-09 07:16 ipcheck/main.py
 -rw-rw-r--  2.0 unx        0 b- defN 24-Mar-14 08:04 ipcheck/app/__init__.py
 -rw-rw-r--  2.0 unx      726 b- defN 24-Mar-14 08:04 ipcheck/app/base_config.py
 -rw-rw-r--  2.0 unx      388 b- defN 24-Mar-14 08:04 ipcheck/app/common_config.py
 -rw-rw-r--  2.0 unx     6052 b- defN 24-Mar-25 07:07 ipcheck/app/config.py
 -rw-rw-r--  2.0 unx     1773 b- defN 24-Mar-19 08:00 ipcheck/app/default_config.py
 -rw-rw-r--  2.0 unx     1233 b- defN 24-Apr-09 03:10 ipcheck/app/gen_ip_utils.py
 -rw-rw-r--  2.0 unx     1894 b- defN 24-Apr-09 01:00 ipcheck/app/ip_info.py
 -rw-rw-r--  2.0 unx     2546 b- defN 24-Mar-14 08:04 ipcheck/app/rtt_test.py
 -rw-rw-r--  2.0 unx      223 b- defN 24-Mar-14 08:04 ipcheck/app/rtt_test_config.py
 -rw-rw-r--  2.0 unx     5656 b- defN 24-Apr-08 09:02 ipcheck/app/speed_test.py
 -rw-rw-r--  2.0 unx      223 b- defN 24-Mar-14 08:04 ipcheck/app/speed_test_config.py
 -rw-rw-r--  2.0 unx     2537 b- defN 24-Apr-09 02:27 ipcheck/app/utils.py
--rw-rw-r--  2.0 unx     3753 b- defN 24-Apr-09 02:54 ipcheck/app/valid_test.py
+-rw-rw-r--  2.0 unx     3765 b- defN 24-Apr-09 05:22 ipcheck/app/valid_test.py
 -rw-rw-r--  2.0 unx      362 b- defN 24-Apr-09 01:09 ipcheck/app/valid_test_config.py
 -rw-rw-r--  2.0 unx        0 b- defN 24-Apr-09 01:18 ipcheck/app/ipparser/__init__.py
 -rw-rw-r--  2.0 unx      364 b- defN 24-Apr-09 02:58 ipcheck/app/ipparser/base_parser.py
 -rw-rw-r--  2.0 unx      671 b- defN 24-Apr-09 02:57 ipcheck/app/ipparser/ip_cidr_parser.py
--rw-rw-r--  2.0 unx      749 b- defN 24-Apr-09 03:11 ipcheck/app/ipparser/ip_dir_parser.py
+-rw-rw-r--  2.0 unx      804 b- defN 24-Apr-09 06:09 ipcheck/app/ipparser/ip_dir_parser.py
 -rw-rw-r--  2.0 unx     1110 b- defN 24-Apr-09 03:05 ipcheck/app/ipparser/ip_file_parser.py
 -rw-rw-r--  2.0 unx      502 b- defN 24-Apr-09 02:57 ipcheck/app/ipparser/ip_parser.py
 -rw-r--r--  2.0 unx      738 b- defN 24-Apr-09 02:56 ipcheck/app/ipparser/ip_path_parser.py
 -rw-rw-r--  2.0 unx     1071 b- defN 24-Apr-09 02:56 ipcheck/app/ipparser/ip_port_parser.py
--rw-rw-r--  2.0 unx    35148 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/LICENSE
--rw-rw-r--  2.0 unx     5417 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/WHEEL
--rw-r--r--  2.0 unx      201 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        8 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2601 b- defN 24-Apr-09 03:37 ip_check-1.5.3.dist-info/RECORD
-31 files, 93480 bytes uncompressed, 33954 bytes compressed:  63.7%
+-rw-rw-r--  2.0 unx    35148 b- defN 24-Apr-09 07:24 ip_check-1.5.4.dist-info/LICENSE
+-rw-rw-r--  2.0 unx     5483 b- defN 24-Apr-09 07:24 ip_check-1.5.4.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Apr-09 07:24 ip_check-1.5.4.dist-info/WHEEL
+-rw-r--r--  2.0 unx      201 b- defN 24-Apr-09 07:24 ip_check-1.5.4.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        8 b- defN 24-Apr-09 07:24 ip_check-1.5.4.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2601 b- defN 24-Apr-09 07:24 ip_check-1.5.4.dist-info/RECORD
+31 files, 93282 bytes uncompressed, 33945 bytes compressed:  63.6%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: ipcheck/app/ipparser/ip_path_parser.py
 Comment: 
 
 Filename: ipcheck/app/ipparser/ip_port_parser.py
 Comment: 
 
-Filename: ip_check-1.5.3.dist-info/LICENSE
+Filename: ip_check-1.5.4.dist-info/LICENSE
 Comment: 
 
-Filename: ip_check-1.5.3.dist-info/METADATA
+Filename: ip_check-1.5.4.dist-info/METADATA
 Comment: 
 
-Filename: ip_check-1.5.3.dist-info/WHEEL
+Filename: ip_check-1.5.4.dist-info/WHEEL
 Comment: 
 
-Filename: ip_check-1.5.3.dist-info/entry_points.txt
+Filename: ip_check-1.5.4.dist-info/entry_points.txt
 Comment: 
 
-Filename: ip_check-1.5.3.dist-info/top_level.txt
+Filename: ip_check-1.5.4.dist-info/top_level.txt
 Comment: 
 
-Filename: ip_check-1.5.3.dist-info/RECORD
+Filename: ip_check-1.5.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## ipcheck/geoinfo.py

```diff
@@ -42,28 +42,14 @@
 def check_geo_asn_db():
     if os.path.exists(GEO2ASN_DB_PATH):
         return True
     else:
         print('ip 数据库不存在，请手动下载{} 到 {}'.format(GEO2ASN_DB_NAME, GEO2ASN_DB_PATH))
         return False
 
-
-def get_geo_asn(infos: List[IpInfo]) -> List[IpInfo]:
-    res = []
-    if check_geo_asn_db():
-        with geoip2.database.Reader(GEO2ASN_DB_PATH) as reader:
-            for info in infos:
-                response = reader.asn(info.ip)
-                info.asn = response.autonomous_system_number
-                info.network = response.network
-                res.append(info)
-    else:
-        res = infos
-    return res
-
 def handle_blank_in_str(handle_str: str):
     res = handle_str
     if handle_str:
         res = handle_str.replace(' ', '_')
     return res
```

## ipcheck/main.py

```diff
@@ -106,27 +106,30 @@
     print('期望最大rtt 为: {} ms'.format(config.rt_max_rtt))
     if args.speed:
         config.st_download_speed = args.speed
     print('期望网速为: {} kB/s'.format(config.st_download_speed))
     if args.fast_check:
         print("快速测速已开启")
         config.st_fast_check = True
-    fixed_file = args.source[0]
-    if not is_ip_address(fixed_file) and is_ip_network(fixed_file):
-        fixed_file = fixed_file.replace('/', '@')
-    source_file = os.path.join(fixed_file)
-    dir_name = os.path.dirname(source_file)
-    base_name = os.path.basename(source_file)
 
-    dst_name = base_name.replace('.txt', '')
-    dst_name = dst_name.replace('::', '--')
-    dst_name = dst_name.replace(':', '-')
     if args.output:
         config.out_file = args.output
     else:
+        fixed_file = args.source[0]
+        if not is_ip_address(fixed_file) and is_ip_network(fixed_file):
+            fixed_file = fixed_file.replace('/', '@')
+        source_file = os.path.join(fixed_file)
+        dir_name = os.path.dirname(source_file)
+        base_name = os.path.basename(source_file)
+
+        dst_name = base_name.replace('.txt', '')
+        dst_name = dst_name.replace('::', '--')
+        dst_name = dst_name.replace(':', '-')
+        if not dst_name:
+            dst_name = dir_name
         config.out_file = os.path.join(dir_name, 'result_{}_{}.txt'.format(dst_name, config.ip_port))
     print('优选ip 文件为: ', config.out_file)
     config.no_save = args.no_save
     print('是否忽略保存测速结果到文件: ', config.no_save)
     # 处理限制参数
     lv, lr, lb, loss = args.max_vt_ip_count, args.max_rt_ip_count, args.max_st_ip_count, args.loss
     if lv:
```

## ipcheck/app/valid_test.py

```diff
@@ -46,19 +46,18 @@
                 passed_ips.append(ret)
         thread_pool_executor.shutdown(wait=True)
         print('可用性结果为: 总数{}, {} pass'.format(len(self.ip_list), len(passed_ips)))
         return passed_ips
 
     def __test(self, ip_info) -> None:
         check_key = self.config.check_key
-        ip, port = ip_info.ip, ip_info.port
         pool = urllib3.HTTPSConnectionPool(
-                ip, assert_hostname=self.config.host_name,
+                ip_info.ip, assert_hostname=self.config.host_name,
                 server_hostname=self.config.host_name,
-                port=port, cert_reqs='CERT_NONE')
+                port=ip_info.port, cert_reqs='CERT_NONE')
         res = None
         headers = {
             'Host': self.config.host_name,
         }
         if self.config.user_agent:
             headers.update({'User-Agent': random.choice(USER_AGENTS)})
         try:
@@ -74,14 +73,16 @@
                 for line in r.readlines():
                     line = line.decode('utf-8')
                     kv = line.strip().split('=')
                     req_dict.update({kv[0]: kv[1]})
                 if req_dict.get(check_key, None) == self.config.host_name:
                     loc = req_dict.get('loc', None)
                     colo = req_dict.get('colo', None)
-                    res = IpInfo(ip, port, loc=loc, colo=colo)
+                    ip_info.loc = loc
+                    ip_info.colo = colo
+                    res = ip_info
             elif r.status == 200:
-                res = IpInfo(ip, port)
+                res = ip_info
             r.release_conn()
         except:
             pass
         return res
```

## ipcheck/app/ipparser/ip_dir_parser.py

```diff
@@ -14,13 +14,15 @@
     '''
 
     @property
     def is_valid(self) -> bool:
         return path.exists(self.source) and path.isdir(self.source)
 
     def parse(self) -> List[IpInfo]:
+        if not self.is_valid:
+            return False
         ip_list = []
         sources = find_txt_in_dir(self.source)
         for source in sources:
             parser = IpFileParser(source, self.port)
             ip_list.extend(parser.parse())
         return ip_list
```

## Comparing `ip_check-1.5.3.dist-info/LICENSE` & `ip_check-1.5.4.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `ip_check-1.5.3.dist-info/METADATA` & `ip_check-1.5.4.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ip-check
-Version: 1.5.3
+Version: 1.5.4
 Summary: Powerful cdn network speed test utils.
 Author: nobitaqaq
 Author-email: xiaoleigs@gmail.com
 Keywords: cdn,speed test,network speed
 Requires-Python: >=3.8
 Description-Content-Type: text/markdown
 License-File: LICENSE
@@ -175,12 +175,15 @@
 
 optional arguments:
   -h, --help  show this help message and exit
 ```
 
 ## Release Note
 
+- V1.5.4
+  - 修正带路径分隔符输出文件名异常的bug
+
 - V1.5.3
   - 把ip 输入源解析重构，方便以后拓展
 
 - V1.5.2
   - ip 传递参数新增ip:port 格式
```

## Comparing `ip_check-1.5.3.dist-info/RECORD` & `ip_check-1.5.4.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,31 +1,31 @@
 ipcheck/__init__.py,sha256=mjRHWAo73u50fxwseCRsTdvj9pPNZuTmsKW8Qpj-cNk,383
-ipcheck/geoinfo.py,sha256=s90kPWJfrJQB1AT5zOfhcunH9h_HD5FQ6FyDfY1baJ0,6609
-ipcheck/main.py,sha256=rJ31vAjD9p2F1_E14LL3_2U9jxL7lDReeXm4cJwhP2g,10450
+ipcheck/geoinfo.py,sha256=WOt1q-vjOFkbaU8S4jHDoB3FDw6Urz6N6m8QC4jnsGo,6184
+ipcheck/main.py,sha256=1cO9kblhI2G1An9vwq0aVXvioOWqPZ0tSEZFRI6YBcA,10544
 ipcheck/app/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 ipcheck/app/base_config.py,sha256=PxNW4PXHagvULNc9FgDwMtu7aCn91RYx2SqBYd4-nd4,726
 ipcheck/app/common_config.py,sha256=s5WjPy45UhxBgymYgZRaQugaSvxBM-96_PXUUa7Pc9U,388
 ipcheck/app/config.py,sha256=_vvb-xuD7R2rR6wqEVWCBDtOeIuf-bMlZiexKu7RmZo,6052
 ipcheck/app/default_config.py,sha256=7OP6pibA78-xkmVGZ4kLsmWzV8fKRff8bCXd9sceFPU,1773
 ipcheck/app/gen_ip_utils.py,sha256=aof1-l6bdMpWqZyIZgZapWPFgIYMz7NMQr6NhBF3AbI,1233
 ipcheck/app/ip_info.py,sha256=4jATfWFztXQqGa3wJZhx72Zx7RIltFKt4_cMmzb-xns,1894
 ipcheck/app/rtt_test.py,sha256=d1_iC3OFeqBAFqqHBdRN_IH5jlRgtd5USn0vV0_CM8M,2546
 ipcheck/app/rtt_test_config.py,sha256=PK7M7uLst4Zi3v2DgKA8rfpZsXIRnwfTxYa12bPDeb8,223
 ipcheck/app/speed_test.py,sha256=LKolSAPbkIkDrfJyW5fVHlMzWuGXaPOckat6S8kqebY,5656
 ipcheck/app/speed_test_config.py,sha256=Ji1jUEqSjAIqkzUzeE1BBHPfoJ2E-JeG36DJiHJ3CYA,223
 ipcheck/app/utils.py,sha256=nmxWod8DqtxVl4I8YgX1x7qNLiD5JeJ_XKUTGglJlMU,2537
-ipcheck/app/valid_test.py,sha256=BfgoYlIXS_vuKLLu70X2a9_Qo9zw64fA4XgpIjdiwIk,3753
+ipcheck/app/valid_test.py,sha256=e6t81vxstm-dy3T2cKxwhtLP7_xNE9b_rSf_WaRy8_w,3765
 ipcheck/app/valid_test_config.py,sha256=akRLXfL1XAFVwIQKvszMRj9TfdI1oQkob3HUEr_grvQ,362
 ipcheck/app/ipparser/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 ipcheck/app/ipparser/base_parser.py,sha256=az8t4Crxo6vhmm4pzSSCPQnZStMT4fstMHRtHfmZZtw,364
 ipcheck/app/ipparser/ip_cidr_parser.py,sha256=HYB6voUAH3-CB6TqtF0pmd7neHWg4cTQD8DMGlRML18,671
-ipcheck/app/ipparser/ip_dir_parser.py,sha256=y9zzV5wpsaiW_a4dmquCvtiPuDUFuBAZZ9OGn-n2M_M,749
+ipcheck/app/ipparser/ip_dir_parser.py,sha256=-nanGalrEIw7dE3arnO5JPPxzBG6B71OswAMlYr6Fm4,804
 ipcheck/app/ipparser/ip_file_parser.py,sha256=CTxRIwMrubm2tWEm1m1rpeaLr3yZxylLfNyYdR4oZP4,1110
 ipcheck/app/ipparser/ip_parser.py,sha256=gTbQSD81Tc0Qra4jAbHMvMC6BiOyTEEaSSh4ov3GGqg,502
 ipcheck/app/ipparser/ip_path_parser.py,sha256=oXnN_PK-s10y2OUeYIskLLH_DHbPWSiYdETkoxVDV1Q,738
 ipcheck/app/ipparser/ip_port_parser.py,sha256=0gGOCyHHiCXZS5iByf9ycHVoArRCEonMW6X0WNVwdsw,1071
-ip_check-1.5.3.dist-info/LICENSE,sha256=ixuiBLtpoK3iv89l7ylKkg9rs2GzF9ukPH7ynZYzK5s,35148
-ip_check-1.5.3.dist-info/METADATA,sha256=fqIHwSDKwDSMbS-LDNEJ3TAEQJ6P6qcfmy1MTKBprrs,5417
-ip_check-1.5.3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-ip_check-1.5.3.dist-info/entry_points.txt,sha256=LbstGY5z6sejWLCwyd9pTq4qRdfCsligLhJHjwp-Pd0,201
-ip_check-1.5.3.dist-info/top_level.txt,sha256=24binHFMOV_-4WIWZrtgRz4y7uY3vUxlJBq2UXMMfvY,8
-ip_check-1.5.3.dist-info/RECORD,,
+ip_check-1.5.4.dist-info/LICENSE,sha256=ixuiBLtpoK3iv89l7ylKkg9rs2GzF9ukPH7ynZYzK5s,35148
+ip_check-1.5.4.dist-info/METADATA,sha256=gMB-8wzmTAity8FhlrD5TDeY-DWyl4PIHbjcN-aBkt0,5483
+ip_check-1.5.4.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+ip_check-1.5.4.dist-info/entry_points.txt,sha256=LbstGY5z6sejWLCwyd9pTq4qRdfCsligLhJHjwp-Pd0,201
+ip_check-1.5.4.dist-info/top_level.txt,sha256=24binHFMOV_-4WIWZrtgRz4y7uY3vUxlJBq2UXMMfvY,8
+ip_check-1.5.4.dist-info/RECORD,,
```

