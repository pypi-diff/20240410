# Comparing `tmp/mia_processes-2.5.0.tar.gz` & `tmp/mia_processes-2.6.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "mia_processes-2.5.0.tar", last modified: Mon Dec 18 11:34:38 2023, max compression
+gzip compressed data, was "mia_processes-2.6.0.tar", last modified: Wed Apr 10 15:52:20 2024, max compression
```

## Comparing `mia_processes-2.5.0.tar` & `mia_processes-2.6.0.tar`

### file list

```diff
@@ -1,97 +1,106 @@
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.684786 mia_processes-2.5.0/
--rw-r--r--   0 econdami  (1385) econdami  (1385)    21778 2023-08-22 09:48:37.000000 mia_processes-2.5.0/LICENSE
--rw-r--r--   0 econdami  (1385) econdami  (1385)     5674 2023-12-18 11:34:38.684786 mia_processes-2.5.0/PKG-INFO
--rw-r--r--   0 econdami  (1385) econdami  (1385)     4087 2023-12-15 09:59:35.000000 mia_processes-2.5.0/README.md
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.681786 mia_processes-2.5.0/mia_processes/
--rw-r--r--   0 econdami  (1385) econdami  (1385)     1034 2023-12-18 11:32:52.000000 mia_processes-2.5.0/mia_processes/__init__.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.681786 mia_processes-2.5.0/mia_processes/bricks/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      688 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/__init__.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.681786 mia_processes-2.5.0/mia_processes/bricks/preprocess/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      805 2023-09-08 11:50:04.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/__init__.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.681786 mia_processes-2.5.0/mia_processes/bricks/preprocess/afni/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      696 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/afni/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    86037 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/afni/processes.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/preprocess/ants/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      599 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/ants/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    60111 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/ants/processes.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/preprocess/dipy/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      526 2023-10-13 13:50:25.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/dipy/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    16387 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/dipy/processes.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/preprocess/freesurfer/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      550 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/freesurfer/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    36209 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/freesurfer/processes.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/preprocess/fsl/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      592 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/fsl/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    56855 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/fsl/processes.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/preprocess/mrtrix/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      922 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/mrtrix/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)   184719 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/mrtrix/processes.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/preprocess/others/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      869 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/others/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)   171183 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/others/processing.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/preprocess/spm/
--rwxr-xr-x   0 econdami  (1385) econdami  (1385)      633 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/spm/__init__.py
--rwxr-xr-x   0 econdami  (1385) econdami  (1385)   113277 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/preprocess/spm/spatial_preprocessing.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.682786 mia_processes-2.5.0/mia_processes/bricks/reports/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      855 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/reports/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)   123255 2023-12-01 13:49:44.000000 mia_processes-2.5.0/mia_processes/bricks/reports/processes.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    60256 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/reports/reporting.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.683786 mia_processes-2.5.0/mia_processes/bricks/stat/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      484 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/stat/__init__.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.683786 mia_processes-2.5.0/mia_processes/bricks/stat/spm/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      670 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/stat/spm/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)   140569 2023-11-20 11:43:16.000000 mia_processes-2.5.0/mia_processes/bricks/stat/spm/model.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.683786 mia_processes-2.5.0/mia_processes/bricks/tools/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      839 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/bricks/tools/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    58913 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/bricks/tools/tools.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     3865 2023-12-18 11:25:59.000000 mia_processes-2.5.0/mia_processes/info.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.683786 mia_processes-2.5.0/mia_processes/pipelines/
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.683786 mia_processes-2.5.0/mia_processes/pipelines/CerebVascularReact/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      557 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/pipelines/CerebVascularReact/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     7072 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/CerebVascularReact/co2_inhalation.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.683786 mia_processes-2.5.0/mia_processes/pipelines/DWITractography/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      599 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/DWITractography/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     9125 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/DWITractography/dwi_whole_brain_tractography.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)      506 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/pipelines/__init__.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.683786 mia_processes-2.5.0/mia_processes/pipelines/preprocess/
--rw-r--r--   0 econdami  (1385) econdami  (1385)     1399 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     5004 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_airmask.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     2952 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_headmask.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     6621 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_mni_tpms.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     3553 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_skullstrip.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     5053 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_skullstrip_synthstrip.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     6740 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_spatial_norm.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     2780 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_hmc.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    11273 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_mni_align.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     5595 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing1.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     5597 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing2.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     5672 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/dwi_fod_msmt_csd.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     6619 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/dwi_preprocessing.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     7007 2023-10-13 13:50:25.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/dwi_tissue_boundaries.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     3857 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/preprocess/spatial_mask.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.684786 mia_processes-2.5.0/mia_processes/pipelines/qualityControl/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      592 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/pipelines/qualityControl/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     8537 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/qualityControl/anat_mriqc.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     7926 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/pipelines/qualityControl/bold_mriqc.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.684786 mia_processes-2.5.0/mia_processes/pipelines/reports/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      585 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/pipelines/reports/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     8850 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/reports/bold_iqms.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     7174 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/reports/extract_roi_param.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.684786 mia_processes-2.5.0/mia_processes/pipelines/stat/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      513 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/pipelines/stat/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     4120 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/pipelines/stat/bold_stat_cvr.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)     3137 2023-08-22 09:48:37.000000 mia_processes-2.5.0/mia_processes/process_matlab.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.684786 mia_processes-2.5.0/mia_processes/utils/
--rw-r--r--   0 econdami  (1385) econdami  (1385)      977 2023-09-08 11:50:04.000000 mia_processes-2.5.0/mia_processes/utils/__init__.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    84984 2023-10-26 15:06:13.000000 mia_processes-2.5.0/mia_processes/utils/report.py
--rw-r--r--   0 econdami  (1385) econdami  (1385)    22217 2023-10-11 06:58:02.000000 mia_processes-2.5.0/mia_processes/utils/tools.py
-drwxr-xr-x   0 econdami  (1385) econdami  (1385)        0 2023-12-18 11:34:38.684786 mia_processes-2.5.0/mia_processes.egg-info/
--rw-r--r--   0 econdami  (1385) econdami  (1385)     5674 2023-12-18 11:34:38.000000 mia_processes-2.5.0/mia_processes.egg-info/PKG-INFO
--rw-r--r--   0 econdami  (1385) econdami  (1385)     3142 2023-12-18 11:34:38.000000 mia_processes-2.5.0/mia_processes.egg-info/SOURCES.txt
--rw-r--r--   0 econdami  (1385) econdami  (1385)        1 2023-12-18 11:34:38.000000 mia_processes-2.5.0/mia_processes.egg-info/dependency_links.txt
--rw-r--r--   0 econdami  (1385) econdami  (1385)        1 2023-12-18 11:34:38.000000 mia_processes-2.5.0/mia_processes.egg-info/not-zip-safe
--rw-r--r--   0 econdami  (1385) econdami  (1385)      212 2023-12-18 11:34:38.000000 mia_processes-2.5.0/mia_processes.egg-info/requires.txt
--rw-r--r--   0 econdami  (1385) econdami  (1385)       14 2023-12-18 11:34:38.000000 mia_processes-2.5.0/mia_processes.egg-info/top_level.txt
--rw-r--r--   0 econdami  (1385) econdami  (1385)     2202 2023-12-18 11:31:08.000000 mia_processes-2.5.0/pyproject.toml
--rw-r--r--   0 econdami  (1385) econdami  (1385)       38 2023-12-18 11:34:38.684786 mia_processes-2.5.0/setup.cfg
--rw-r--r--   0 econdami  (1385) econdami  (1385)     1678 2023-08-22 09:48:37.000000 mia_processes-2.5.0/setup.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.506505 mia_processes-2.6.0/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    21778 2023-06-20 12:45:24.000000 mia_processes-2.6.0/LICENSE
+-rw-r--r--   0 econdami  (1000) econdami  (1000)     5776 2024-04-10 15:52:20.506505 mia_processes-2.6.0/PKG-INFO
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     4165 2024-04-10 15:47:23.000000 mia_processes-2.6.0/README.md
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.498505 mia_processes-2.6.0/mia_processes/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     1034 2023-12-19 09:58:59.000000 mia_processes-2.6.0/mia_processes/__init__.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.499505 mia_processes-2.6.0/mia_processes/bricks/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      688 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/bricks/__init__.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.499505 mia_processes-2.6.0/mia_processes/bricks/preprocess/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      953 2024-03-21 14:52:04.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/__init__.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.499505 mia_processes-2.6.0/mia_processes/bricks/preprocess/afni/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      696 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/afni/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    86037 2023-10-19 15:59:22.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/afni/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.500505 mia_processes-2.6.0/mia_processes/bricks/preprocess/ants/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      599 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/ants/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    60111 2023-10-19 15:19:16.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/ants/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.500505 mia_processes-2.6.0/mia_processes/bricks/preprocess/dipy/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      526 2023-10-16 08:22:12.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/dipy/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    17293 2024-03-05 17:48:15.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/dipy/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.500505 mia_processes-2.6.0/mia_processes/bricks/preprocess/freesurfer/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      550 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/freesurfer/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    36209 2023-10-19 15:31:40.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/freesurfer/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.500505 mia_processes-2.6.0/mia_processes/bricks/preprocess/fsl/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      620 2024-03-05 17:48:15.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/fsl/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    80384 2024-03-21 14:52:04.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/fsl/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.500505 mia_processes-2.6.0/mia_processes/bricks/preprocess/matlab_wrap/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      137 2024-03-21 14:52:04.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/matlab_wrap/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     6123 2024-02-20 17:27:05.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/matlab_wrap/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.501505 mia_processes-2.6.0/mia_processes/bricks/preprocess/mrtrix/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      934 2024-04-10 15:33:28.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/mrtrix/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)   189832 2024-04-10 15:33:28.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/mrtrix/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.501505 mia_processes-2.6.0/mia_processes/bricks/preprocess/others/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      914 2024-03-12 08:59:04.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/others/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)   181320 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/others/processing.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.501505 mia_processes-2.6.0/mia_processes/bricks/preprocess/spm/
+-rwxrwxr-x   0 econdami  (1000) econdami  (1000)      633 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/spm/__init__.py
+-rwxrwxr-x   0 econdami  (1000) econdami  (1000)   116082 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/spm/spatial_preprocessing.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.501505 mia_processes-2.6.0/mia_processes/bricks/preprocess/volbrain/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      559 2024-03-21 14:52:04.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/volbrain/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    23014 2024-03-21 14:52:04.000000 mia_processes-2.6.0/mia_processes/bricks/preprocess/volbrain/processes.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.502505 mia_processes-2.6.0/mia_processes/bricks/reports/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      897 2024-03-12 08:59:04.000000 mia_processes-2.6.0/mia_processes/bricks/reports/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)   134568 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/bricks/reports/processes.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    83705 2024-03-18 13:08:56.000000 mia_processes-2.6.0/mia_processes/bricks/reports/reporting.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.502505 mia_processes-2.6.0/mia_processes/bricks/stat/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      484 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/bricks/stat/__init__.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.502505 mia_processes-2.6.0/mia_processes/bricks/stat/spm/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      670 2023-06-28 03:34:04.000000 mia_processes-2.6.0/mia_processes/bricks/stat/spm/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)   140637 2024-04-05 17:28:35.000000 mia_processes-2.6.0/mia_processes/bricks/stat/spm/model.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.502505 mia_processes-2.6.0/mia_processes/bricks/tools/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      864 2024-03-05 17:46:34.000000 mia_processes-2.6.0/mia_processes/bricks/tools/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)   107266 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/bricks/tools/tools.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     3880 2024-04-10 15:45:22.000000 mia_processes-2.6.0/mia_processes/info.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.503505 mia_processes-2.6.0/mia_processes/pipelines/
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.503505 mia_processes-2.6.0/mia_processes/pipelines/CerebVascularReact/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      557 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/pipelines/CerebVascularReact/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    10574 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/pipelines/CerebVascularReact/co2_inhalation.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.503505 mia_processes-2.6.0/mia_processes/pipelines/DWITractography/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      599 2023-10-05 10:46:09.000000 mia_processes-2.6.0/mia_processes/pipelines/DWITractography/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     8865 2024-02-20 17:27:05.000000 mia_processes-2.6.0/mia_processes/pipelines/DWITractography/dwi_whole_brain_tractography.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      506 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/pipelines/__init__.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.504505 mia_processes-2.6.0/mia_processes/pipelines/preprocess/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     1399 2023-10-05 10:46:09.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     5004 2023-10-19 14:56:03.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_airmask.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     2952 2023-10-19 14:51:44.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_headmask.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     6621 2023-10-19 14:54:02.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_mni_tpms.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     3553 2023-10-19 14:56:03.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_skullstrip.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     5053 2023-10-19 15:59:20.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_skullstrip_synthstrip.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     6742 2024-01-31 08:24:51.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_spatial_norm.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     2780 2023-10-19 14:52:32.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_hmc.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    11275 2024-01-31 08:24:51.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_mni_align.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     6681 2024-01-26 13:31:34.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing1.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     5599 2024-01-31 08:24:51.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing2.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     5671 2024-01-31 08:24:51.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/dwi_fod_msmt_csd.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     6418 2024-02-20 17:27:05.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/dwi_preprocessing.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     7006 2024-01-31 08:24:51.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/dwi_tissue_boundaries.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     3836 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/pipelines/preprocess/spatial_mask.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.505505 mia_processes-2.6.0/mia_processes/pipelines/qualityControl/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      653 2024-03-21 14:52:04.000000 mia_processes-2.6.0/mia_processes/pipelines/qualityControl/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     8537 2023-10-19 15:08:19.000000 mia_processes-2.6.0/mia_processes/pipelines/qualityControl/anat_mriqc.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     7926 2023-10-19 15:07:00.000000 mia_processes-2.6.0/mia_processes/pipelines/qualityControl/bold_mriqc.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    17955 2024-03-21 14:52:04.000000 mia_processes-2.6.0/mia_processes/pipelines/qualityControl/bold_signals_roi.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.505505 mia_processes-2.6.0/mia_processes/pipelines/reports/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      585 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/pipelines/reports/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     8850 2023-10-09 14:34:18.000000 mia_processes-2.6.0/mia_processes/pipelines/reports/bold_iqms.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     6244 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/pipelines/reports/extract_roi_param.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.505505 mia_processes-2.6.0/mia_processes/pipelines/stat/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      513 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/pipelines/stat/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     4157 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/pipelines/stat/bold_stat_cvr.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     3137 2023-06-20 12:45:24.000000 mia_processes-2.6.0/mia_processes/process_matlab.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.505505 mia_processes-2.6.0/mia_processes/sources_images/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)       40 2024-01-31 18:24:11.000000 mia_processes-2.6.0/mia_processes/sources_images/__init__.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.506505 mia_processes-2.6.0/mia_processes/utils/
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      977 2024-01-16 17:04:35.000000 mia_processes-2.6.0/mia_processes/utils/__init__.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)   149146 2024-04-10 15:34:10.000000 mia_processes-2.6.0/mia_processes/utils/report.py
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)    29222 2024-04-09 15:01:42.000000 mia_processes-2.6.0/mia_processes/utils/tools.py
+drwxrwxr-x   0 econdami  (1000) econdami  (1000)        0 2024-04-10 15:52:20.506505 mia_processes-2.6.0/mia_processes.egg-info/
+-rw-r--r--   0 econdami  (1000) econdami  (1000)     5776 2024-04-10 15:52:20.000000 mia_processes-2.6.0/mia_processes.egg-info/PKG-INFO
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     3462 2024-04-10 15:52:20.000000 mia_processes-2.6.0/mia_processes.egg-info/SOURCES.txt
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)        1 2024-04-10 15:52:20.000000 mia_processes-2.6.0/mia_processes.egg-info/dependency_links.txt
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)        1 2024-04-10 15:52:20.000000 mia_processes-2.6.0/mia_processes.egg-info/not-zip-safe
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)      221 2024-04-10 15:52:20.000000 mia_processes-2.6.0/mia_processes.egg-info/requires.txt
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)       14 2024-04-10 15:52:20.000000 mia_processes-2.6.0/mia_processes.egg-info/top_level.txt
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     2218 2024-04-10 15:45:22.000000 mia_processes-2.6.0/pyproject.toml
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)       38 2024-04-10 15:52:20.506505 mia_processes-2.6.0/setup.cfg
+-rw-rw-r--   0 econdami  (1000) econdami  (1000)     1678 2023-06-20 12:45:24.000000 mia_processes-2.6.0/setup.py
```

### Comparing `mia_processes-2.5.0/LICENSE` & `mia_processes-2.6.0/LICENSE`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/PKG-INFO` & `mia_processes-2.6.0/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mia_processes
-Version: 2.5.0
+Version: 2.6.0
 Summary: mia_processes
 Home-page: http://populse.github.io/mia_processes
 Author: Populse team
 Author-email: Populse team <populse-support@univ-grenoble-alpes.fr>
 License: CeCILL-B
 Project-URL: homepage, http://populse.github.io/mia_processes/
 Project-URL: repository, https://github.com/populse/mia_processes
@@ -30,14 +30,15 @@
 Requires-Dist: nibabel
 Requires-Dist: nilearn
 Requires-Dist: nipy
 Requires-Dist: nipype
 Requires-Dist: nitime
 Requires-Dist: nitransforms
 Requires-Dist: numpy
+Requires-Dist: openpyxl
 Requires-Dist: paramiko
 Requires-Dist: populse-db<3.0.0,>=2.5.0
 Requires-Dist: populse_mia<3.0.0,>=2.5.0
 Requires-Dist: pyxnat
 Requires-Dist: reportlab
 Requires-Dist: scipy
 Requires-Dist: statsmodels
@@ -119,29 +120,36 @@
 
 Many mia_processes bricks (atomic processes) use third-party softwares. To use these bricks, the corresponding [third-party softwares must be installed](https://populse.github.io/populse_mia/html/installation/3rd-party_installations.html).
 
 
 # Requirements
 
 In order to get all the bricks and pipelines proposed by mia_processes some third libraries are required:
+* boto
+* cmp
+* cfflib
 * dipy
 * nibabel
 * nilearn
 * nipy
 * nipype
 * nitime
 * nitransforms
 * numpy
-* populse_db >=2.1.0
-* populse_mia >= 2.2.0
+* openpyxl
+* paramiko
+* populse-db >= 2.5.0, < 3.0.0
+* populse_mia >= 2.5.0, < 3.0.0
+* pyxnat
 * reportlab
 * scipy
 * statsmodels
 * templateflow
 * torch
+* vtk
 
 # License
 
 * The whole populse project is open source.
 * Mia_processes is precisely released under the CeCILL software license.
 * All license details can be found [here](http://cecill.info/licences/Licence_CeCILL_V2.1-en.html), or refer to the license file [here](https://github.com/populse/mia_processes/blob/master/LICENSE).
```

### Comparing `mia_processes-2.5.0/README.md` & `mia_processes-2.6.0/README.md`

 * *Files 3% similar despite different names*

```diff
@@ -70,29 +70,36 @@
 
 Many mia_processes bricks (atomic processes) use third-party softwares. To use these bricks, the corresponding [third-party softwares must be installed](https://populse.github.io/populse_mia/html/installation/3rd-party_installations.html).
 
 
 # Requirements
 
 In order to get all the bricks and pipelines proposed by mia_processes some third libraries are required:
+* boto
+* cmp
+* cfflib
 * dipy
 * nibabel
 * nilearn
 * nipy
 * nipype
 * nitime
 * nitransforms
 * numpy
-* populse_db >=2.1.0
-* populse_mia >= 2.2.0
+* openpyxl
+* paramiko
+* populse-db >= 2.5.0, < 3.0.0
+* populse_mia >= 2.5.0, < 3.0.0
+* pyxnat
 * reportlab
 * scipy
 * statsmodels
 * templateflow
 * torch
+* vtk
 
 # License
 
 * The whole populse project is open source.
 * Mia_processes is precisely released under the CeCILL software license.
 * All license details can be found [here](http://cecill.info/licences/Licence_CeCILL_V2.1-en.html), or refer to the license file [here](https://github.com/populse/mia_processes/blob/master/LICENSE).
```

### Comparing `mia_processes-2.5.0/mia_processes/__init__.py` & `mia_processes-2.6.0/mia_processes/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/afni/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/afni/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/afni/processes.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/afni/processes.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/ants/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/ants/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/ants/processes.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/ants/processes.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/dipy/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/dipy/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/dipy/processes.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/dipy/processes.py`

 * *Files 2% similar despite different names*

```diff
@@ -222,15 +222,15 @@
 
     def run_process_mia(self):
         """Dedicated to the process launch step of the brick."""
         super(Denoise, self).run_process_mia()
         self.process.in_file = self.in_file
         self.process.block_radius = self.block_radius
         self.process.noise_model = self.noise_model
-        self.process._out_file = self.out_file
+        self.process.out_file = self.out_file
         self.process.patch_radius = self.patch_radius
         if self.in_mask:
             self.process.in_mask = self.in_mask
         if self.noise_mask:
             self.process.noise_mask = self.noise_mask
         if self.signal_mask:
             self.process.signal_mask = self.signal_mask
@@ -308,18 +308,34 @@
         )
 
         # Mandatory inputs traits
         self.add_trait(
             "in_dwi", File(output=False, optional=False, desc=in_dwi_desc)
         )
         self.add_trait(
-            "dwi_bvec", File(output=False, optional=False, desc=dwi_bvec_desc)
+            "dwi_bvec",
+            Either(
+                Undefined,
+                File(),
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=dwi_bvec_desc,
+            ),
         )
         self.add_trait(
-            "dwi_bval", File(output=False, optional=False, desc=dwi_bval_desc)
+            "dwi_bval",
+            Either(
+                Undefined,
+                File(),
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=dwi_bval_desc,
+            ),
         )
         self.add_trait(
             "in_mask", File(output=False, optional=True, desc=in_mask_desc)
         )
 
         # Outputs traits
         self.add_trait("out_FA", File(output=True, desc=out_FA_desc))
@@ -355,14 +371,24 @@
             if self.output_directory:
                 valid_ext, in_ext, fileName = checkFileExt(self.in_dwi, EXT)
 
                 if not valid_ext:
                     print("\nThe input image format is not recognized...!")
                     return
                 else:
+                    if self.dwi_bvec is Undefined:
+                        self.dwi_bvec = self.in_dwi.replace(in_ext, "bvec")
+                    if self.dwi_bval is Undefined:
+                        self.dwi_bval = self.in_dwi.replace(in_ext, "bval")
+                    if (
+                        self.dwi_bvec is Undefined
+                        or self.dwi_bval is Undefined
+                    ):
+                        print("No bvec or bval found")
+                        return
                     self.outputs["out_FA"] = os.path.join(
                         self.output_directory,
                         fileName + "_dki_FA." + in_ext,
                     )
                     self.outputs["out_MD"] = os.path.join(
                         self.output_directory,
                         fileName + "_dki_MD." + in_ext,
@@ -421,16 +447,20 @@
         """Dedicated to the process launch step of the brick."""
         super(ComputeDKI, self).run_process_mia()
 
         data, affine = load_nifti(self.in_dwi)
         bvals, bvecs = read_bvals_bvecs(self.dwi_bval, self.dwi_bvec)
         gtab = gradient_table(bvals, bvecs)
         dkimodel = dki.DiffusionKurtosisModel(gtab)
-        mask, affine_mask = load_nifti(self.in_mask)
-        dkifit = dkimodel.fit(data, mask=mask)
+        if self.in_mask:
+            mask, affine_mask = load_nifti(self.in_mask)
+            dkifit = dkimodel.fit(data, mask=mask)
+        else:
+            dkifit = dkimodel.fit(data)
+
         dki_metrics = {
             "FA": dkifit.fa,
             "MD": dkifit.md,
             "AD": dkifit.ad,
             "RD": dkifit.rd,
             "MK": dkifit.mk(0, 3),
             "AK": dkifit.ak(0, 3),
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/freesurfer/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/freesurfer/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/freesurfer/processes.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/freesurfer/processes.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/fsl/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/fsl/__init__.py`

 * *Files 19% similar despite different names*

```diff
@@ -10,12 +10,14 @@
 # the CEA-CNRS-INRIA. Refer to the LICENSE file or to
 # http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html
 # for details.
 ##########################################################################
 
 from .processes import (  # noqa: F401
     BetSurfacesExtraction,
+    ConvertXFM,
+    EpiReg,
     ExtractROI,
     FastSegment,
     Flirt,
     Smooth,
 )
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/fsl/processes.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/fsl/processes.py`

 * *Files 14% similar despite different names*

```diff
@@ -5,16 +5,19 @@
 The purpose of this module is to customise the main fsl preprocessing bricks
 provided by nipype and to correct some things that do not work directly in
 populse_mia.
 
 :Contains:
     :Class:
         - BetSurfacesExtraction
+        - ConvertXFM
+        - EpiReg
         - ExtractROI
         - FastSegment
+        - Flirt
         - Smooth
 
 """
 
 ##########################################################################
 # mia_processes - Copyright (C) IRMaGe/CEA, 2018
 # Distributed under the terms of the CeCILL license, as published by
@@ -22,32 +25,33 @@
 # http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html
 # for details.
 ##########################################################################
 
 # Other import
 import os
 
-from nipype.interfaces.base import File
+from nipype.interfaces.base import File, isdefined
 
 # populse_mia import
 from populse_mia.user_interface.pipeline_manager.process_mia import ProcessMIA
 from traits.api import Bool, Either, Enum, Float, Int, List, String, Undefined
 
 from mia_processes.utils import checkFileExt
 
 EXT = {"NIFTI_GZ": "nii.gz", "NIFTI": "nii"}
+EXT_MATRICE = {"FSL_MATRICE": "mat"}
 
 
 class BetSurfacesExtraction(ProcessMIA):
     """
     *Surfaces (skull, inskull, outskull, outskin) extraction using BET (FSL)*
 
-    Please, see the complete documentation for the `SurfacesExtraction brick
+    Please, see the complete documentation for the `BetSurfacesExtraction brick
     in the mia_processes website
-    <https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/fsl/SurfacesExtraction.html>`_
+    <https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/fsl/BetSurfacesExtraction.html>`_
     """
 
     def __init__(self):
         """Dedicated to the attributes initialisation/instantiation.
         The input and output plugs are defined here. The special
         'self.requirement' attribute (optional) is used to define the
         third-party products necessary for the running of the brick.
@@ -254,21 +258,627 @@
 
         # default inputs
         self.process.surfaces = True
 
         return self.process.run(configuration_dict={})
 
 
+class ConvertXFM(ProcessMIA):
+    """
+    *Modify transformation matrice using convert_xfm (FSL)*
+
+    Please, see the complete documentation for the `ConvertXFM brick
+    in the mia_processes website
+    <https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/fsl/ConvertXFM.html>`_
+    """
+
+    def __init__(self):
+        """Dedicated to the attributes initialisation/instantiation.
+        The input and output plugs are defined here. The special
+        'self.requirement' attribute (optional) is used to define the
+        third-party products necessary for the running of the brick.
+        """
+        # Initialisation of the objects needed for the launch of the brick
+        super(ConvertXFM, self).__init__()
+
+        # Third party softwares required for the execution of the brick
+        self.requirement = ["fsl", "nipype"]
+
+        # Mandatory inputs description
+        in_transfo_desc = (
+            "Input transformation matrix (a pathlike object"
+            "string representing an existing file)"
+        )
+        # Optional inputs with default value description
+        output_type_desc = (
+            "Typecodes of the output NIfTI image formats (one "
+            "of NIFTI, NIFTI_GZ)."
+        )
+        invert_xfm_desc = (
+            "Invert input transformation "
+            "(exclusive with fix_scale_skew, concat_xfm)"
+        )
+        concat_xfm_desc = (
+            "Write joint transformation of two input matrices "
+            "(exclusive with invert_xfm, fix_scale_skew, require in_transfo_2)"
+        )
+        fix_scale_skew_desc = (
+            "Use secondary matrix to fix scale and skew.  "
+            "(exclusive with invert_xfm, convert_xfm, require in_transfo_2)"
+        )
+
+        # Optional inputs
+        in_transfo_2_desc = (
+            "Second input transformation matrix (a pathlike object"
+            "string representing an existing file)"
+        )
+        # Outputs description
+        out_file_desc = (
+            "Final transformation matrix (a pathlike object "
+            "or string representing a file)"
+        )
+
+        # Mandatory inputs traits
+        self.add_trait(
+            "in_transfo",
+            File(output=False, optional=False, desc=in_transfo_desc),
+        )
+
+        # Optional inputs
+        self.add_trait(
+            "invert_xfm",
+            Bool(False, output=False, optional=True, desc=invert_xfm_desc),
+        )
+        self.add_trait(
+            "concat_xfm",
+            Bool(False, output=False, optional=True, desc=concat_xfm_desc),
+        )
+
+        self.add_trait(
+            "fix_scale_skew",
+            Bool(False, output=False, optional=True, desc=fix_scale_skew_desc),
+        )
+
+        self.add_trait(
+            "in_transfo_2",
+            File(output=False, optional=True, desc=in_transfo_2_desc),
+        )
+
+        self.add_trait(
+            "output_type",
+            Enum(
+                "NIFTI",
+                "NIFTI_GZ",
+                output=False,
+                optional=True,
+                desc=output_type_desc,
+            ),
+        )
+        # Outputs traits
+        self.add_trait(
+            "out_file", File(output=True, optional=False, desc=out_file_desc)
+        )
+
+        self.init_default_traits()
+
+        # To suppress the "FSLOUTPUTTYPE environment
+        # variable is not set" nipype warning:
+        if "FSLOUTPUTTYPE" not in os.environ:
+            os.environ["FSLOUTPUTTYPE"] = self.output_type
+
+        self.init_process("nipype.interfaces.fsl.ConvertXFM")
+
+    def list_outputs(self, is_plugged=None):
+        """Dedicated to the initialisation step of the brick.
+        The main objective of this method is to produce the outputs of the
+        bricks (self.outputs) and the associated tags (self.inheritance_dic),
+        if defined here. In order not to include an output in the database,
+        this output must be a value of the optional key 'notInDb' of the
+        self.outputs dictionary. To work properly this method must return
+        self.make_initResult() object.
+        :param is_plugged: the state, linked or not, of the plugs.
+        :returns: a dictionary with requirement, outputs and inheritance_dict.
+        """
+        # Using the inheritance to ProcessMIA class, list_outputs method
+        super(ConvertXFM, self).list_outputs()
+
+        # Outputs definition and tags inheritance
+        if self.in_transfo:
+            if (
+                (self.fix_scale_skew and self.concat_xfm)
+                or (self.fix_scale_skew and self.invert_xfm)
+                or (self.concat_xfm and self.invert_xfm)
+            ):
+                print(
+                    "Initisalisation failed.."
+                    "fix_scale_skew, concat_xfm, invert_xfm parameters are "
+                    "mutually esclusive"
+                )
+                return
+            if (self.fix_scale_skew or self.concat_xfm) and (
+                not self.in_transfo_2
+            ):
+                print(
+                    "Initisalisation failed.."
+                    "fix_scale_skew or concat_xfm require in_transfo_2 "
+                )
+                return
+
+            valid_ext, in_ext, file_name = checkFileExt(
+                self.in_transfo, EXT_MATRICE
+            )
+            if not valid_ext:
+                print("\nThe input matrice format is not recognized...!")
+                return
+            if self.output_directory:
+                if self.in_transfo_2:
+                    valid_ext, in_ext, file_name_2 = checkFileExt(
+                        self.in_transfo_2, EXT_MATRICE
+                    )
+                    if not valid_ext:
+                        print(
+                            "\nThe second input matrice format "
+                            "is not recognized...!"
+                        )
+                        return
+                    if self.fix_scale_skew:
+                        out_file_name = (
+                            file_name + "_fix_scale_skew_" + file_name_2
+                        )
+                    elif self.concat_xfm:
+                        out_file_name = file_name + "_concate_" + file_name_2
+                if self.invert_xfm:
+                    out_file_name = file_name + "_inverse"
+                self.outputs["out_file"] = os.path.join(
+                    self.output_directory, out_file_name + ".mat"
+                )
+
+        if self.outputs:
+            self.tags_inheritance(
+                in_file=self.in_transfo,
+                out_file=self.outputs["out_file"],
+            )
+
+        # Return the requirement, outputs and inheritance_dict
+        return self.make_initResult()
+
+    def run_process_mia(self):
+        """Dedicated to the process launch step of the brick."""
+        super(ConvertXFM, self).run_process_mia()
+        self.process.output_type = self.output_type
+        self.process.in_file = self.in_transfo
+        self.process.out_file = self.out_file
+        if self.in_transfo_2:
+            self.process.in_file2 = self.in_transfo_2
+        if self.concat_xfm:
+            self.process.concat_xfm = self.concat_xfm
+        if self.fix_scale_skew:
+            self.process.fix_scale_skew = self.fix_scale_skew
+        if self.invert_xfm:
+            self.process.invert_xfm = self.invert_xfm
+
+        return self.process.run(configuration_dict={})
+
+
+class EpiReg(ProcessMIA):
+    """
+    *Run epi_reg script (FSL) to register EPI images to structural images*
+
+    Please, see the complete documentation for the `EpiReg brick
+    in the mia_processes website
+    <https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/fsl/EpiReg.html>`_
+    """
+
+    def __init__(self):
+        """Dedicated to the attributes initialisation/instantiation.
+        The input and output plugs are defined here. The special
+        'self.requirement' attribute (optional) is used to define the
+        third-party products necessary for the running of the brick.
+        """
+        # Initialisation of the objects needed for the launch of the brick
+        super(EpiReg, self).__init__()
+
+        # Third party softwares required for the execution of the brick
+        self.requirement = ["fsl", "nipype"]
+
+        # Mandatory inputs description
+        in_epi_desc = (
+            "Input EPI image(a pathlike object"
+            "string representing an existing file)"
+        )
+        in_t1_desc = (
+            "Input T1 image(a pathlike object"
+            "string representing an existing file)"
+        )
+        in_t1_brain_desc = (
+            "Input brain extracted T1image(a pathlike object"
+            "string representing an existing file)"
+        )
+        # Optional inputs with default value description
+        output_type_desc = (
+            "Typecodes of the output NIfTI image formats (one "
+            "of NIFTI, NIFTI_GZ)."
+        )
+        no_clean_desc = "Do not clean up intermediate files "
+        no_fmapreg_desc = "Do not perform registration of fmap to T1 "
+        out_base_desc = "Output base name. "
+
+        # Optional inputs
+        weight_image_desc = (
+            "Weighting image (in T1 space)(a pathlike object"
+            "string representing an existing file)"
+        )
+        wmseg_desc = (
+            "White matter segmentation of T1 image (a pathlike object"
+            "string representing an existing file)"
+        )
+        fmap_desc = (
+            "Fieldmap image (in rad/s)(a pathlike object"
+            "string representing an existing file)"
+        )
+        fmapmag_desc = (
+            "Fieldmap magnitude image - wholehead (a pathlike object"
+            "string representing an existing file)"
+        )
+        fmapmagbrain_desc = (
+            "Fieldmap magnitude image - brain extracted (a pathlike object"
+            "string representing an existing file)"
+        )
+        pedir_desc = "Phase encoding direction, dir = x/y/z/-x/-y/-z"
+        echospacing_desc = "Effective EPI echo spacing (a float)"
+        # Outputs description
+        out_file_desc = (
+            "Unwarped and coregistered epi input. (a pathlike object "
+            "or string representing a file)"
+        )
+        out_1vol_desc = (
+            "Unwarped and coregistered epi single volume. (a pathlike object "
+            "or string representing a file)"
+        )
+        epi2str_mat_desc = (
+            "Rigid epi-to-structural transform.(a pathlike object "
+            "or string representing a file)"
+        )
+        epi2str_inv_desc = (
+            "Rigid structural-to-epi transform.(a pathlike object "
+            "or string representing a file)"
+        )
+        fmap2epi_mat_desc = (
+            "Rigid fieldmap-to-epi transform.(a pathlike object "
+            "or string representing a file)"
+        )
+        fmap2str_mat_desc = (
+            "Rigid fieldmap-to-structural transform.(a pathlike object "
+            "or string representing a file)"
+        )
+        fmap_epi_desc = (
+            "Fieldmap in epi space. (a pathlike object "
+            "or string representing a file)"
+        )
+        fmap_str_desc = (
+            "Fieldmap in structural space..(a pathlike object "
+            "or string representing a file)"
+        )
+        fmapmag_str_desc = (
+            "Fieldmap magnitude image in structural space.(a pathlike object "
+            "or string representing a file)"
+        )
+        fullwarp_desc = (
+            "Warpfield to unwarp epi and transform into structural space."
+            "(a pathlike object or string representing a file)"
+        )
+        seg_desc = (
+            "White matter, gray matter, csf segmentation.(a pathlike object "
+            "or string representing a file)"
+        )
+        shiftmap_desc = (
+            "Shiftmap in epi space.(a pathlike object "
+            "or string representing a file)"
+        )
+        wmedge_desc = (
+            "White matter edges for visualization.(a pathlike object "
+            "or string representing a file)"
+        )
+        wmseg_out_desc = (
+            "White matter segmentation used in flirt bbr.(a pathlike object "
+            "or string representing a file)"
+        )
+
+        # Mandatory inputs traits
+        self.add_trait(
+            "in_epi", File(output=False, optional=False, desc=in_epi_desc)
+        )
+        self.add_trait(
+            "in_t1", File(output=False, optional=False, desc=in_t1_desc)
+        )
+        self.add_trait(
+            "in_t1_brain",
+            File(output=False, optional=False, desc=in_t1_brain_desc),
+        )
+
+        # Optional inputs
+        self.add_trait(
+            "no_clean",
+            Bool(False, output=False, optional=True, desc=no_clean_desc),
+        )
+        self.add_trait(
+            "out_base",
+            String(
+                "epi2struct", output=False, optional=True, desc=out_base_desc
+            ),
+        )
+        self.add_trait(
+            "weight_image",
+            File(output=False, optional=True, desc=weight_image_desc),
+        )
+        self.add_trait(
+            "wmseg", File(output=False, optional=True, desc=wmseg_desc)
+        )
+        self.add_trait(
+            "no_fmapreg",
+            Bool(False, output=False, optional=True, desc=no_fmapreg_desc),
+        )
+        self.add_trait(
+            "fmap", File(output=False, optional=True, desc=fmap_desc)
+        )
+        self.add_trait(
+            "fmapmag", File(output=False, optional=True, desc=fmapmag_desc)
+        )
+        self.add_trait(
+            "fmapmagbrain",
+            File(output=False, optional=True, desc=fmapmagbrain_desc),
+        )
+        self.add_trait(
+            "echospacing",
+            Either(
+                Undefined,
+                Float(),
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=echospacing_desc,
+            ),
+        )
+        self.add_trait(
+            "pedir",
+            Either(
+                Undefined,
+                Enum("x", "y", "z", "-x", "-y", "-z"),
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=pedir_desc,
+            ),
+        )
+        self.add_trait(
+            "output_type",
+            Enum(
+                "NIFTI",
+                "NIFTI_GZ",
+                output=False,
+                optional=True,
+                desc=output_type_desc,
+            ),
+        )
+        # Outputs traits
+        self.add_trait(
+            "out_file", File(output=True, optional=False, desc=out_file_desc)
+        )
+        self.add_trait(
+            "epi2str_mat",
+            File(output=True, optional=False, desc=epi2str_mat_desc),
+        )
+        self.add_trait("seg", File(output=True, optional=True, desc=seg_desc))
+        self.add_trait(
+            "wmedge", File(output=True, optional=True, desc=wmedge_desc)
+        )
+        self.add_trait(
+            "wmseg_out", File(output=True, optional=True, desc=wmseg_out_desc)
+        )
+        self.add_trait(
+            "out_1vol", File(output=True, optional=True, desc=out_1vol_desc)
+        )
+        self.add_trait(
+            "epi2str_inv",
+            File(output=True, optional=True, desc=epi2str_inv_desc),
+        )
+        self.add_trait(
+            "fmap2epi_mat",
+            File(output=True, optional=True, desc=fmap2epi_mat_desc),
+        )
+        self.add_trait(
+            "fmap2str_mat",
+            File(output=True, optional=True, desc=fmap2str_mat_desc),
+        )
+        self.add_trait(
+            "fmap_epi", File(output=True, optional=True, desc=fmap_epi_desc)
+        )
+        self.add_trait(
+            "fmap_str", File(output=True, optional=True, desc=fmap_str_desc)
+        )
+        self.add_trait(
+            "fmapmag_str",
+            File(output=True, optional=True, desc=fmapmag_str_desc),
+        )
+        self.add_trait(
+            "fullwarp", File(output=True, optional=True, desc=fullwarp_desc)
+        )
+        self.add_trait(
+            "shiftmap", File(output=True, optional=True, desc=shiftmap_desc)
+        )
+
+        self.init_default_traits()
+
+        # To suppress the "FSLOUTPUTTYPE environment
+        # variable is not set" nipype warning:
+        if "FSLOUTPUTTYPE" not in os.environ:
+            os.environ["FSLOUTPUTTYPE"] = self.output_type
+
+        self.init_process("nipype.interfaces.fsl.EpiReg")
+
+    def list_outputs(self, is_plugged=None):
+        """Dedicated to the initialisation step of the brick.
+        The main objective of this method is to produce the outputs of the
+        bricks (self.outputs) and the associated tags (self.inheritance_dic),
+        if defined here. In order not to include an output in the database,
+        this output must be a value of the optional key 'notInDb' of the
+        self.outputs dictionary. To work properly this method must return
+        self.make_initResult() object.
+        :param is_plugged: the state, linked or not, of the plugs.
+        :returns: a dictionary with requirement, outputs and inheritance_dict.
+        """
+        # Using the inheritance to ProcessMIA class, list_outputs method
+        super(EpiReg, self).list_outputs()
+
+        # Outputs definition and tags inheritance
+        if self.in_epi:
+
+            valid_ext, in_ext, file_name = checkFileExt(self.in_epi, EXT)
+            valid_ext_2, in_ext_2, file_name_2 = checkFileExt(self.in_t1, EXT)
+            valid_ext_3, in_ext_3, file_name_3 = checkFileExt(
+                self.in_t1_brain, EXT
+            )
+            if not valid_ext or not valid_ext_2 or not valid_ext_3:
+                print("\nInput format is not recognized...!")
+                return
+            if self.output_directory:
+                ext = EXT[self.output_type]
+                if self.in_epi:
+                    self.outputs["out_file"] = os.path.join(
+                        self.output_directory, self.out_base + "." + ext
+                    )
+                    self.outputs["epi2str_mat"] = os.path.join(
+                        self.output_directory, self.out_base + ".mat"
+                    )
+
+                    if not self.no_fmapreg and isdefined(self.fmap):
+                        self.outputs["out_1vol"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_1vol." + ext,
+                        )
+                        self.outputs["fmap2str_mat"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fieldmap2str.mat",
+                        )
+                        self.outputs["fmap2epi_mat"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fieldmaprads2epi.mat",
+                        )
+                        self.outputs["fmap_epi"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fieldmaprads2epi." + ext,
+                        )
+                        self.outputs["fmap_str"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fieldmaprads2str." + ext,
+                        )
+                        self.outputs["fmapmag_str"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fieldmap2str." + ext,
+                        )
+                        self.outputs["shiftmap"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fieldmaprads2epi_shift." + ext,
+                        )
+                        self.outputs["fullwarp"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_warp." + ext,
+                        )
+                        self.outputs["epi2str_inv"] = os.path.join(
+                            self.output_directory, self.out_base + "_inv.mat"
+                        )
+                    if not isdefined(self.wmseg):
+                        self.outputs["wmedge"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fast_wmedge." + ext,
+                        )
+                        self.outputs["wmseg_out"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fast_wmseg." + ext,
+                        )
+                        self.outputs["seg"] = os.path.join(
+                            self.output_directory,
+                            self.out_base + "_fast_seg." + ext,
+                        )
+
+                if self.outputs:
+                    # FIXME: not sure about inheritance for matrice
+                    for k in (
+                        "out_file",
+                        "epi2str_mat",
+                    ):
+                        self.tags_inheritance(
+                            in_file=self.in_epi,
+                            out_file=self.outputs[k],
+                        )
+
+                    if not self.no_fmapreg and isdefined(self.fmap):
+                        for k in (
+                            "out_1vol",
+                            "fullwarp",
+                            "epi2str_inv",
+                            "fmap2str_mat",
+                            "fmap2epi_mat",
+                        ):
+                            self.tags_inheritance(
+                                in_file=self.in_epi,
+                                out_file=self.outputs[k],
+                            )
+                        for k in (
+                            "fmapmag_str",
+                            "fmap_epi",
+                            "fmap_str",
+                            "shiftmap",
+                        ):
+                            self.tags_inheritance(
+                                in_file=self.fmap,
+                                out_file=self.outputs[k],
+                            )
+
+                    if not isdefined(self.wmseg):
+                        for k in ("wmedge", "wmseg_out", "seg"):
+                            self.tags_inheritance(
+                                in_file=self.in_t1,
+                                out_file=self.outputs[k],
+                            )
+
+        # Return the requirement, outputs and inheritance_dict
+        return self.make_initResult()
+
+    def run_process_mia(self):
+        """Dedicated to the process launch step of the brick."""
+        super(EpiReg, self).run_process_mia()
+        self.process.output_type = self.output_type
+        self.process.epi = self.in_epi
+        self.process.t1_head = self.in_t1
+        self.process.t1_brain = self.in_t1_brain
+        self.process.out_base = self.out_base
+        self.process.fmap = self.fmap
+        self.process.fmapmag = self.fmapmag
+        self.process.fmapmagbrain = self.fmapmagbrain
+        self.process.no_clean = self.no_clean
+        self.process.no_fmapreg = self.no_fmapreg
+        self.process.weight_image = self.weight_image
+        self.process.wmseg = self.wmseg
+
+        if self.pedir:
+            self.process.pedir = self.pedir
+        if self.echospacing:
+            self.process.echospacing = self.echospacing
+
+        return self.process.run(configuration_dict={})
+
+
 class ExtractROI(ProcessMIA):
     """
     *Extract region of interest (ROI) from an image using FslROI*
 
     Please, see the complete documentation for the `ExtractROI brick
     in the mia_processes website
-    <https://populse.github.io/mia_processes/htmldocumentation/bricks/preprocess/fsl/ExtractROI.html>`_
+    <https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/fsl/ExtractROI.html>`_
 
     """
 
     def __init__(self):
         """Dedicated to the attributes initialisation/instantiation.
 
         The input and output plugs are defined here. The special
@@ -1418,22 +2028,23 @@
                 print(
                     "\nThe input reference image format is "
                     "not recognized...!"
                 )
                 return
 
             if self.output_directory:
+                ext = EXT[self.output_type]
                 if self.get_registered_file:
                     self.outputs["out_file"] = os.path.join(
                         self.output_directory,
                         fileName
                         + "_registered_with_"
                         + fileName_ref
                         + "."
-                        + in_ext,
+                        + ext,
                     )
                 if not self.apply_xfm or not self.apply_isoxfm:
                     self.outputs["out_matrix_file"] = os.path.join(
                         self.output_directory,
                         fileName + "_" + fileName_ref + "_flirt.mat",
                     )
                 if self.save_log:
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/mrtrix/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/mrtrix/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,14 +12,15 @@
 # for details.
 ##########################################################################
 
 from .processes import (  # noqa: F401
     ConstrainedSphericalDeconvolution,
     DWIBiasCorrect,
     DWIBrainMask,
+    DWICat,
     DWIDenoise,
     DWIExtract,
     DWIPreproc,
     EditingTrack,
     FilteringTrack,
     FitTensor,
     Generate5tt2gmwmi,
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/mrtrix/processes.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/mrtrix/processes.py`

 * *Files 1% similar despite different names*

```diff
@@ -7,14 +7,15 @@
 populse_mia.
 
 :Contains:
     :Class:
         - ConstrainedSphericalDeconvolution
         - DWIBiasCorrect
         - DWIBrainMask
+        - DWICat
         - DWIDenoise
         - DWIExtract
         - DWIPreproc
         - EditingTrack
         - FitTensor
         - FilteringTrack
         - Generate5ttfsl
@@ -589,14 +590,141 @@
         super(DWIBrainMask, self).run_process_mia()
         self.process.in_file = self.in_file
         self.process.out_file = self.out_file
 
         return self.process.run(configuration_dict={})
 
 
+class DWICat(ProcessMIA):
+    """
+    *Concatenating multiple DWI series with
+    intensity scaling (dwicat command)*
+
+    Please, see the complete documentation for the `DWICat brick
+    in the mia_processes website
+    <https://populse.github.io/mia_processes/html/documentation/bricks/tools/mrtrix/DWICat.html>`_
+    """
+
+    def __init__(self):
+        """Dedicated to the attributes initialisation/instantiation.
+        The input and output plugs are defined here. The special
+        'self.requirement' attribute (optional) is used to define the
+        third-party products necessary for the running of the brick.
+        """
+        # Initialisation of the objects needed for the launch of the brick
+        super(DWICat, self).__init__()
+
+        # Third party softwares required for the execution of the brick
+        self.requirement = ["mrtrix"]
+
+        # Mandatory inputs description
+        in_files_desc = (
+            "Inputs DWI images (a list of items which are a pathlike "
+            "object or a string representing an existing file)"
+        )
+        # Optional inputs description
+        in_mask_desc = (
+            "A binary mask within which image intensities will be matched"
+            "(a pathlike object or a string representing an existing file)"
+        )
+        out_name_desc = "Output name (a string)"
+
+        # Output description
+        out_file_desc = (
+            "Output image ie all DWI concatenated "
+            "(a pathlike object or string representing an existing file)"
+        )
+        # Mandatory inputs traits
+        self.add_trait(
+            "in_files",
+            InputMultiPath(
+                Either(File(), List(File())),
+                output=False,
+                desc=in_files_desc,
+            ),
+        )
+
+        # Optional inputs traits
+        self.add_trait(
+            "in_mask", File(output=False, optional=True, desc=in_mask_desc)
+        )
+
+        self.add_trait(
+            "out_name", String(output=False, optional=True, desc=out_name_desc)
+        )
+
+        # Outputs traits
+        self.add_trait(
+            "out_file", File(output=True, optional=False, desc=out_file_desc)
+        )
+
+        # no nipype command for dwicat
+        self.init_default_traits()
+
+    def list_outputs(self, is_plugged=None):
+        """Dedicated to the initialisation step of the brick.
+        The main objective of this method is to produce the outputs of the
+        bricks (self.outputs) and the associated tags (self.inheritance_dic),
+        if defined here. In order not to include an output in the database,
+        this output must be a value of the optional key 'notInDb' of the
+        self.outputs dictionary. To work properly this method must return
+        self.make_initResult() object.
+        :param is_plugged: the state, linked or not, of the plugs.
+        :returns: a dictionary with requirement, outputs and inheritance_dict.
+        """
+        # Using the inheritance to ProcessMIA class, list_outputs method
+        super(DWICat, self).list_outputs()
+
+        # Outputs definition and tags inheritance (optional)
+        if self.in_files:
+            out_name = "concat"
+
+            for in_file in self.in_files:
+                valid_ext, in_ext, file_name = checkFileExt(in_file, EXT_DWI)
+                out_name += "_" + file_name
+                if not valid_ext:
+                    print("\nThe input image format is not recognized...!")
+                    return self.make_initResult()
+
+            if self.output_directory:
+                if self.out_name:
+                    out_file_name = self.out_name
+                else:
+                    out_file_name = out_name
+
+                self.outputs["out_file"] = os.path.join(
+                    self.output_directory, out_file_name + ".mif"
+                )
+
+        if self.outputs:
+            # Inheritance from the first file
+            self.tags_inheritance(
+                in_file=self.in_files[0], out_file=self.outputs["out_file"]
+            )
+
+        # Return the requirement, outputs and inheritance_dict
+        return self.make_initResult()
+
+    def run_process_mia(self):
+        """Dedicated to the process launch step of the brick."""
+        super(DWICat, self).run_process_mia()
+
+        cmd = ["dwicat"]
+
+        if self.in_files:
+            for in_file in self.in_files:
+                cmd += [in_file]
+        if self.in_mask:
+            cmd += ["-mask", self.in_mask]
+
+        cmd += [self.out_file]
+
+        return mrtrix.mrtrix_call(cmd)
+
+
 class DWIDenoise(ProcessMIA):
     """
     *Denoise DWI data and estimate the noise level based on the optimal
     threshold for PCA. (dwi denoise command)*
 
     Please, see the complete documentation for the `DWIDenoise brick
     in the mia_processes website
@@ -873,14 +1001,17 @@
                 return self.make_initResult()
 
             if self.output_directory:
                 if self.nobzero:
                     fileName += "_nobzero"
                 if self.bzero:
                     fileName += "_bzero"
+                if self.shell:
+                    shells = "_".join(str(int(s)) for s in self.shell)
+                    fileName += "_" + shells
 
                 self.outputs["out_file"] = os.path.join(
                     self.output_directory, fileName + "." + in_ext
                 )
 
         if self.outputs:
             self.tags_inheritance(
@@ -2854,32 +2985,43 @@
         self.make_initResult() object.
         :param is_plugged: the state, linked or not, of the plugs.
         :returns: a dictionary with requirement, outputs and inheritance_dict.
         """
         # Using the inheritance to ProcessMIA class, list_outputs method
         super(MRConvert, self).list_outputs()
 
-        if (self.in_bval and not self.in_bvec) or (
-            not self.in_bval and self.in_bvec
-        ):
-            print("\nIf grad_file used, do not provied bvec or bval")
-            return self.make_initResult()
-
         if self.grad_file and self.in_bvec:
             print("\nIf grad_file used, do not provied bvec or bval")
             return self.make_initResult()
 
         # Outputs definition and tags inheritance (optional)
         if self.in_file:
             valid_ext, in_ext, fileName = checkFileExt(self.in_file, EXT)
 
             if not valid_ext:
                 print("\nThe input image format is not recognized...!")
                 return self.make_initResult()
 
+            # Find automatically bvec/bval if it is a diffusion
+            if not self.in_bvec:
+                bvec = self.in_file.replace(in_ext, "bvec")
+                if os.path.exists(bvec):
+                    self.in_bvec = bvec
+
+            if not self.in_bval:
+                bval = self.in_file.replace(in_ext, "bval")
+                if os.path.exists(bval):
+                    self.in_bval = bval
+
+            if (self.in_bval and not self.in_bvec) or (
+                not self.in_bval and self.in_bvec
+            ):
+                print("\n Missing bvec or bval")
+                return self.make_initResult()
+
             if self.output_directory:
                 if self.suffix:
                     fileName += "_" + self.suffix
                 else:
                     if self.scaling:
                         fileName += "_scaled"
                     if self.vox:
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/others/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/others/__init__.py`

 * *Files 26% similar despite different names*

```diff
@@ -17,14 +17,16 @@
     ApplyBiasCorrection,
     ArtifactMask,
     Binarize,
     ConformImage,
     ConvROI,
     Enhance,
     EstimateSNR,
+    ExtractROIbyLabel,
+    ExtractSignalROI,
     GradientThreshold,
     Harmonize,
     IntensityClip,
     Mask,
     NonSteadyStateDetector,
     Resample1,
     Resample2,
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/others/processing.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/others/processing.py`

 * *Files 12% similar despite different names*

```diff
@@ -19,10681 +19,11315 @@
 00000120: 4d61 736b 0a20 2020 2020 2020 202d 2042  Mask.        - B
 00000130: 696e 6172 697a 650a 2020 2020 2020 2020  inarize.        
 00000140: 2d20 436f 6e66 6f72 6d49 6d61 6765 0a20  - ConformImage. 
 00000150: 2020 2020 2020 202d 2043 6f6e 7652 4f49         - ConvROI
 00000160: 0a20 2020 2020 2020 202d 2045 6e68 616e  .        - Enhan
 00000170: 6365 0a20 2020 2020 2020 202d 2045 7374  ce.        - Est
 00000180: 696d 6174 6553 4e52 0a20 2020 2020 2020  imateSNR.       
-00000190: 202d 2047 7261 6469 656e 7454 6872 6573   - GradientThres
-000001a0: 686f 6c64 0a20 2020 2020 2020 202d 2048  hold.        - H
-000001b0: 6172 6d6f 6e69 7a65 0a20 2020 2020 2020  armonize.       
-000001c0: 202d 2049 6e74 656e 7369 7479 436c 6970   - IntensityClip
-000001d0: 0a20 2020 2020 2020 202d 204d 6173 6b0a  .        - Mask.
-000001e0: 2020 2020 2020 2020 2d20 4e6f 6e53 7465          - NonSte
-000001f0: 6164 7953 7461 7465 4465 7465 6374 6f72  adyStateDetector
-00000200: 0a20 2020 2020 2020 202d 2052 6573 616d  .        - Resam
-00000210: 706c 6531 0a20 2020 2020 2020 202d 2052  ple1.        - R
-00000220: 6573 616d 706c 6532 0a20 2020 2020 2020  esample2.       
-00000230: 202d 2052 6f74 6174 696f 6e4d 6173 6b0a   - RotationMask.
-00000240: 2020 2020 2020 2020 2d20 5361 6e69 7469          - Saniti
-00000250: 7a65 0a20 2020 2020 2020 202d 2054 534e  ze.        - TSN
-00000260: 520a 2020 2020 2020 2020 2d20 5465 6d70  R.        - Temp
-00000270: 6c61 7465 4672 6f6d 5465 6d70 6c61 7465  lateFromTemplate
-00000280: 466c 6f77 0a20 2020 2020 2020 202d 2054  Flow.        - T
-00000290: 6872 6573 686f 6c64 0a0a 2020 2020 3a46  hreshold..    :F
-000002a0: 756e 6374 696f 6e3a 0a20 2020 2020 2020  unction:.       
-000002b0: 202d 2061 7274 6966 6163 745f 6d61 736b   - artifact_mask
-000002c0: 0a20 2020 2020 2020 202d 2069 735f 6f75  .        - is_ou
-000002d0: 746c 6965 720a 2020 2020 2020 2020 2d20  tlier.        - 
-000002e0: 7468 7265 7368 6f6c 640a 2222 220a 0a23  threshold."""..#
-000002f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000310: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000330: 2323 2323 2323 2323 230a 2320 6d69 615f  #########.# mia_
-00000340: 7072 6f63 6573 7365 7320 2d20 436f 7079  processes - Copy
-00000350: 7269 6768 7420 2843 2920 4952 4d61 4765  right (C) IRMaGe
-00000360: 2f43 4541 2c20 3230 3138 0a23 2044 6973  /CEA, 2018.# Dis
-00000370: 7472 6962 7574 6564 2075 6e64 6572 2074  tributed under t
-00000380: 6865 2074 6572 6d73 206f 6620 7468 6520  he terms of the 
-00000390: 4365 4349 4c4c 206c 6963 656e 7365 2c20  CeCILL license, 
-000003a0: 6173 2070 7562 6c69 7368 6564 2062 790a  as published by.
-000003b0: 2320 7468 6520 4345 412d 434e 5253 2d49  # the CEA-CNRS-I
-000003c0: 4e52 4941 2e20 5265 6665 7220 746f 2074  NRIA. Refer to t
-000003d0: 6865 204c 4943 454e 5345 2066 696c 6520  he LICENSE file 
-000003e0: 6f72 2074 6f0a 2320 6874 7470 3a2f 2f77  or to.# http://w
-000003f0: 7777 2e63 6563 696c 6c2e 696e 666f 2f6c  ww.cecill.info/l
-00000400: 6963 656e 6365 732f 4c69 6365 6e63 655f  icences/Licence_
-00000410: 4365 4349 4c4c 5f56 322e 312d 656e 2e68  CeCILL_V2.1-en.h
-00000420: 746d 6c0a 2320 666f 7220 6465 7461 696c  tml.# for detail
-00000430: 732e 0a23 2323 2323 2323 2323 2323 2323  s..#############
-00000440: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000450: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000470: 2323 2323 2323 2323 2323 2323 230a 0a69  #############..i
-00000480: 6d70 6f72 7420 6f73 0a69 6d70 6f72 7420  mport os.import 
-00000490: 7368 7574 696c 0a69 6d70 6f72 7420 7465  shutil.import te
-000004a0: 6d70 6669 6c65 0a0a 2320 6e69 6261 6265  mpfile..# nibabe
-000004b0: 6c20 696d 706f 7274 0a69 6d70 6f72 7420  l import.import 
-000004c0: 6e69 6261 6265 6c20 6173 206e 6962 0a69  nibabel as nib.i
-000004d0: 6d70 6f72 7420 6e69 6261 6265 6c2e 7072  mport nibabel.pr
-000004e0: 6f63 6573 7369 6e67 2061 7320 6e69 6270  ocessing as nibp
-000004f0: 0a69 6d70 6f72 7420 6e75 6d70 7920 6173  .import numpy as
-00000500: 206e 700a 0a23 206e 6970 7970 6520 696d   np..# nipype im
-00000510: 706f 7274 0a66 726f 6d20 6e69 7079 7065  port.from nipype
-00000520: 2e69 6e74 6572 6661 6365 732e 6261 7365  .interfaces.base
-00000530: 2069 6d70 6f72 7420 280a 2020 2020 4669   import (.    Fi
-00000540: 6c65 2c0a 2020 2020 496e 7075 744d 756c  le,.    InputMul
-00000550: 7469 5061 7468 2c0a 2020 2020 4f75 7470  tiPath,.    Outp
-00000560: 7574 4d75 6c74 6950 6174 682c 0a20 2020  utMultiPath,.   
-00000570: 2054 7261 6974 4c69 7374 4f62 6a65 6374   TraitListObject
-00000580: 2c0a 2020 2020 556e 6465 6669 6e65 642c  ,.    Undefined,
-00000590: 0a20 2020 2074 7261 6974 732c 0a29 0a66  .    traits,.).f
-000005a0: 726f 6d20 6e69 7079 7065 2e69 6e74 6572  rom nipype.inter
-000005b0: 6661 6365 732e 7370 6d2e 6261 7365 2069  faces.spm.base i
-000005c0: 6d70 6f72 7420 496d 6167 6546 696c 6553  mport ImageFileS
-000005d0: 504d 0a0a 2320 706f 7075 6c73 655f 6d69  PM..# populse_mi
-000005e0: 6120 696d 706f 7274 0a66 726f 6d20 706f  a import.from po
-000005f0: 7075 6c73 655f 6d69 612e 7573 6572 5f69  pulse_mia.user_i
-00000600: 6e74 6572 6661 6365 2e70 6970 656c 696e  nterface.pipelin
-00000610: 655f 6d61 6e61 6765 722e 7072 6f63 6573  e_manager.proces
-00000620: 735f 6d69 6120 696d 706f 7274 2050 726f  s_mia import Pro
-00000630: 6365 7373 4d49 410a 6672 6f6d 2073 6369  cessMIA.from sci
-00000640: 7079 2069 6d70 6f72 7420 6e64 696d 6167  py import ndimag
-00000650: 6520 6173 2073 696d 0a66 726f 6d20 736b  e as sim.from sk
-00000660: 696d 6167 652e 6d6f 7270 686f 6c6f 6779  image.morphology
-00000670: 2069 6d70 6f72 7420 6261 6c6c 0a66 726f   import ball.fro
-00000680: 6d20 736b 696d 6167 652e 7472 616e 7366  m skimage.transf
-00000690: 6f72 6d20 696d 706f 7274 2072 6573 697a  orm import resiz
-000006a0: 650a 0a23 2073 6f6d 612d 6261 7365 2069  e..# soma-base i
-000006b0: 6d70 6f72 7473 0a66 726f 6d20 736f 6d61  mports.from soma
-000006c0: 2e71 745f 6775 692e 7174 5f62 6163 6b65  .qt_gui.qt_backe
-000006d0: 6e64 2e51 7420 696d 706f 7274 2051 4d65  nd.Qt import QMe
-000006e0: 7373 6167 6542 6f78 0a66 726f 6d20 7374  ssageBox.from st
-000006f0: 6174 736d 6f64 656c 732e 726f 6275 7374  atsmodels.robust
-00000700: 2e73 6361 6c65 2069 6d70 6f72 7420 6d61  .scale import ma
-00000710: 640a 0a23 2069 6d70 6f72 7420 7465 6d70  d..# import temp
-00000720: 6c61 7465 666c 6f77 2074 6f20 6765 7420  lateflow to get 
-00000730: 616e 6174 6f6d 6963 616c 2074 656d 706c  anatomical templ
-00000740: 6174 6573 0a66 726f 6d20 7465 6d70 6c61  ates.from templa
-00000750: 7465 666c 6f77 2e61 7069 2069 6d70 6f72  teflow.api impor
-00000760: 7420 6765 7420 6173 2067 6574 5f74 656d  t get as get_tem
-00000770: 706c 6174 650a 0a23 206d 6961 5f70 726f  plate..# mia_pro
-00000780: 6365 7373 6573 2069 6d70 6f72 740a 6672  cesses import.fr
-00000790: 6f6d 206d 6961 5f70 726f 6365 7373 6573  om mia_processes
-000007a0: 2e75 7469 6c73 2069 6d70 6f72 7420 280a  .utils import (.
-000007b0: 2020 2020 6368 6563 6b46 696c 6545 7874      checkFileExt
-000007c0: 2c0a 2020 2020 6765 745f 6462 4669 656c  ,.    get_dbFiel
-000007d0: 6456 616c 7565 2c0a 2020 2020 7365 745f  dValue,.    set_
-000007e0: 6462 4669 656c 6456 616c 7565 2c0a 290a  dbFieldValue,.).
-000007f0: 0a23 204f 7468 6572 2069 6d70 6f72 740a  .# Other import.
-00000800: 2320 6672 6f6d 2064 6973 7475 7469 6c73  # from distutils
-00000810: 2e64 6972 5f75 7469 6c20 696d 706f 7274  .dir_util import
-00000820: 2063 6f70 795f 7472 6565 0a0a 0a23 2066   copy_tree...# f
-00000830: 726f 6d20 706f 7075 6c73 655f 6d69 612e  rom populse_mia.
-00000840: 736f 6674 7761 7265 5f70 726f 7065 7274  software_propert
-00000850: 6965 7320 696d 706f 7274 2043 6f6e 6669  ies import Confi
-00000860: 670a 0a0a 4558 5420 3d20 7b22 4e49 4654  g...EXT = {"NIFT
-00000870: 495f 475a 223a 2022 6e69 692e 677a 222c  I_GZ": "nii.gz",
-00000880: 2022 4e49 4654 4922 3a20 226e 6969 227d   "NIFTI": "nii"}
-00000890: 0a0a 0a63 6c61 7373 2041 7070 6c79 4269  ...class ApplyBi
-000008a0: 6173 436f 7272 6563 7469 6f6e 2850 726f  asCorrection(Pro
-000008b0: 6365 7373 4d49 4129 3a0a 2020 2020 2222  cessMIA):.    ""
-000008c0: 220a 2020 2020 2a41 7070 6c79 2062 6961  ".    *Apply bia
-000008d0: 7320 6669 656c 6420 636f 7272 6563 7469  s field correcti
-000008e0: 6f6e 2074 6f20 616e 2069 6e70 7574 2066  on to an input f
-000008f0: 696c 6520 7573 696e 6720 7468 6520 6269  ile using the bi
-00000900: 6173 2069 6d61 6765 2a0a 0a20 2020 2050  as image*..    P
-00000910: 6c65 6173 652c 2073 6565 2074 6865 2063  lease, see the c
-00000920: 6f6d 706c 6574 6520 646f 6375 6d65 6e74  omplete document
-00000930: 6174 696f 6e20 666f 7220 7468 6520 2741  ation for the 'A
-00000940: 7070 6c79 4269 6173 436f 7272 6563 7469  pplyBiasCorrecti
-00000950: 6f6e 2062 7269 636b 0a20 2020 2069 6e20  on brick.    in 
-00000960: 7468 6520 6d69 615f 7072 6f63 6573 7365  the mia_processe
-00000970: 7320 7765 6273 6974 650a 2020 2020 3c68  s website.    <h
-00000980: 7474 7073 3a2f 2f70 6f70 756c 7365 2e67  ttps://populse.g
-00000990: 6974 6875 622e 696f 2f6d 6961 5f70 726f  ithub.io/mia_pro
-000009a0: 6365 7373 6573 2f68 746d 6c2f 646f 6375  cesses/html/docu
-000009b0: 6d65 6e74 6174 696f 6e2f 6272 6963 6b73  mentation/bricks
-000009c0: 2f70 7265 7072 6f63 6573 732f 6f74 6865  /preprocess/othe
-000009d0: 722f 4170 706c 794d 6173 6b2e 6874 6d6c  r/ApplyMask.html
-000009e0: 3e60 5f0a 0a20 2020 2022 2222 0a0a 2020  >`_..    """..  
-000009f0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00000a00: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00000a10: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
-00000a20: 6520 6174 7472 6962 7574 6573 2069 6e69  e attributes ini
-00000a30: 7469 616c 6973 6174 696f 6e20 2f20 696e  tialisation / in
-00000a40: 7374 616e 7469 6174 696f 6e2e 0a0a 2020  stantiation...  
-00000a50: 2020 2020 2020 5468 6520 696e 7075 7420        The input 
-00000a60: 616e 6420 6f75 7470 7574 2070 6c75 6773  and output plugs
-00000a70: 2061 7265 2064 6566 696e 6564 2068 6572   are defined her
-00000a80: 652e 2054 6865 2073 7065 6369 616c 0a20  e. The special. 
-00000a90: 2020 2020 2020 2027 7365 6c66 2e72 6571         'self.req
-00000aa0: 7569 7265 6d65 6e74 2720 6174 7472 6962  uirement' attrib
-00000ab0: 7574 6520 286f 7074 696f 6e61 6c29 2069  ute (optional) i
-00000ac0: 7320 7573 6564 2074 6f20 6465 6669 6e65  s used to define
-00000ad0: 2074 6865 0a20 2020 2020 2020 2074 6869   the.        thi
-00000ae0: 7264 2d70 6172 7479 2070 726f 6475 6374  rd-party product
-00000af0: 7320 6e65 6365 7373 6172 7920 666f 7220  s necessary for 
-00000b00: 7468 6520 7275 6e6e 696e 6720 6f66 2074  the running of t
-00000b10: 6865 2062 7269 636b 2e0a 2020 2020 2020  he brick..      
-00000b20: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-00000b30: 496e 6974 6961 6c69 7361 7469 6f6e 206f  Initialisation o
-00000b40: 6620 7468 6520 6f62 6a65 6374 7320 6e65  f the objects ne
-00000b50: 6564 6564 2066 6f72 2074 6865 206c 6175  eded for the lau
-00000b60: 6e63 6820 6f66 2074 6865 2062 7269 636b  nch of the brick
-00000b70: 0a20 2020 2020 2020 2073 7570 6572 2841  .        super(A
-00000b80: 7070 6c79 4269 6173 436f 7272 6563 7469  pplyBiasCorrecti
-00000b90: 6f6e 2c20 7365 6c66 292e 5f5f 696e 6974  on, self).__init
-00000ba0: 5f5f 2829 0a0a 2020 2020 2020 2020 2320  __()..        # 
-00000bb0: 5468 6972 6420 7061 7274 7920 736f 6674  Third party soft
-00000bc0: 7761 7265 7320 7265 7175 6972 6564 2066  wares required f
-00000bd0: 6f72 2074 6865 2065 7865 6375 7469 6f6e  or the execution
-00000be0: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
-00000bf0: 2020 2020 2020 7365 6c66 2e72 6571 7569        self.requi
-00000c00: 7265 6d65 6e74 203d 205b 5d0a 0a20 2020  rement = []..   
-00000c10: 2020 2020 2023 2049 6e70 7574 7320 6465       # Inputs de
-00000c20: 7363 7269 7074 696f 6e0a 2020 2020 2020  scription.      
-00000c30: 2020 696e 5f66 696c 655f 6465 7363 203d    in_file_desc =
-00000c40: 2022 4120 6669 6c65 220a 2020 2020 2020   "A file".      
-00000c50: 2020 6269 6173 5f69 6d61 6765 5f64 6573    bias_image_des
-00000c60: 6320 3d20 2242 6961 7320 696d 6167 6522  c = "Bias image"
-00000c70: 0a0a 2020 2020 2020 2020 2320 4f75 7470  ..        # Outp
-00000c80: 7574 7320 6465 7363 7269 7074 696f 6e0a  uts description.
-00000c90: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
-00000ca0: 5f64 6573 6320 3d20 224f 7574 2066 696c  _desc = "Out fil
-00000cb0: 6522 0a0a 2020 2020 2020 2020 2320 496e  e"..        # In
-00000cc0: 7075 7473 2074 7261 6974 730a 2020 2020  puts traits.    
-00000cd0: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
-00000ce0: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
-00000cf0: 2269 6e5f 6669 6c65 222c 2046 696c 6528  "in_file", File(
-00000d00: 6f75 7470 7574 3d46 616c 7365 2c20 6f70  output=False, op
-00000d10: 7469 6f6e 616c 3d46 616c 7365 2c20 6465  tional=False, de
-00000d20: 7363 3d69 6e5f 6669 6c65 5f64 6573 6329  sc=in_file_desc)
-00000d30: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00000d40: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
-00000d50: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
-00000d60: 2262 6961 735f 696d 6167 6522 2c0a 2020  "bias_image",.  
-00000d70: 2020 2020 2020 2020 2020 4669 6c65 286f            File(o
-00000d80: 7574 7075 743d 4661 6c73 652c 206f 7074  utput=False, opt
-00000d90: 696f 6e61 6c3d 4661 6c73 652c 2064 6573  ional=False, des
-00000da0: 633d 6269 6173 5f69 6d61 6765 5f64 6573  c=bias_image_des
-00000db0: 6329 2c0a 2020 2020 2020 2020 290a 0a20  c),.        ).. 
-00000dc0: 2020 2020 2020 2023 204f 7574 7075 7473         # Outputs
-00000dd0: 2074 7261 6974 730a 2020 2020 2020 2020   traits.        
-00000de0: 7365 6c66 2e61 6464 5f74 7261 6974 2822  self.add_trait("
-00000df0: 6f75 745f 6669 6c65 222c 2046 696c 6528  out_file", File(
-00000e00: 6f75 7470 7574 3d54 7275 652c 2064 6573  output=True, des
-00000e10: 633d 6f75 745f 6669 6c65 5f64 6573 6329  c=out_file_desc)
-00000e20: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00000e30: 696e 6974 5f64 6566 6175 6c74 5f74 7261  init_default_tra
-00000e40: 6974 7328 290a 0a20 2020 2064 6566 206c  its()..    def l
-00000e50: 6973 745f 6f75 7470 7574 7328 7365 6c66  ist_outputs(self
-00000e60: 2c20 6973 5f70 6c75 6767 6564 3d4e 6f6e  , is_plugged=Non
-00000e70: 6529 3a0a 2020 2020 2020 2020 2222 2244  e):.        """D
-00000e80: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
-00000e90: 696e 6974 6961 6c69 7361 7469 6f6e 2073  initialisation s
-00000ea0: 7465 7020 6f66 2074 6865 2062 7269 636b  tep of the brick
-00000eb0: 2e0a 0a20 2020 2020 2020 2054 6865 206d  ...        The m
-00000ec0: 6169 6e20 6f62 6a65 6374 6976 6520 6f66  ain objective of
-00000ed0: 2074 6869 7320 6d65 7468 6f64 2069 7320   this method is 
-00000ee0: 746f 2070 726f 6475 6365 2074 6865 206f  to produce the o
-00000ef0: 7574 7075 7473 206f 6620 7468 650a 2020  utputs of the.  
-00000f00: 2020 2020 2020 6272 6963 6b73 2028 7365        bricks (se
-00000f10: 6c66 2e6f 7574 7075 7473 2920 616e 6420  lf.outputs) and 
-00000f20: 7468 6520 6173 736f 6369 6174 6564 2074  the associated t
-00000f30: 6167 7320 2873 656c 662e 696e 6865 7269  ags (self.inheri
-00000f40: 7461 6e63 655f 6469 6329 2c0a 2020 2020  tance_dic),.    
-00000f50: 2020 2020 6966 2064 6566 696e 6564 2068      if defined h
-00000f60: 6572 652e 2054 6f20 776f 726b 2070 726f  ere. To work pro
-00000f70: 7065 726c 7920 7468 6973 206d 6574 686f  perly this metho
-00000f80: 6420 6d75 7374 2072 6574 7572 6e0a 2020  d must return.  
-00000f90: 2020 2020 2020 7365 6c66 2e6d 616b 655f        self.make_
-00000fa0: 696e 6974 5265 7375 6c74 2829 206f 626a  initResult() obj
-00000fb0: 6563 742e 0a0a 2020 2020 2020 2020 3a70  ect...        :p
-00000fc0: 6172 616d 2069 735f 706c 7567 6765 643a  aram is_plugged:
-00000fd0: 2074 6865 2073 7461 7465 2c20 6c69 6e6b   the state, link
-00000fe0: 6564 206f 7220 6e6f 742c 206f 6620 7468  ed or not, of th
-00000ff0: 6520 706c 7567 732e 0a20 2020 2020 2020  e plugs..       
-00001000: 203a 7265 7475 726e 733a 2061 2064 6963   :returns: a dic
-00001010: 7469 6f6e 6172 7920 7769 7468 2072 6571  tionary with req
-00001020: 7569 7265 6d65 6e74 2c20 6f75 7470 7574  uirement, output
-00001030: 7320 616e 6420 696e 6865 7269 7461 6e63  s and inheritanc
-00001040: 655f 6469 6374 2e0a 2020 2020 2020 2020  e_dict..        
-00001050: 2222 220a 2020 2020 2020 2020 2320 5573  """.        # Us
-00001060: 696e 6720 7468 6520 696e 6865 7269 7461  ing the inherita
-00001070: 6e63 6520 746f 2050 726f 6365 7373 4d49  nce to ProcessMI
-00001080: 4120 636c 6173 732c 206c 6973 745f 6f75  A class, list_ou
-00001090: 7470 7574 7320 6d65 7468 6f64 0a20 2020  tputs method.   
-000010a0: 2020 2020 2073 7570 6572 2841 7070 6c79       super(Apply
-000010b0: 4269 6173 436f 7272 6563 7469 6f6e 2c20  BiasCorrection, 
-000010c0: 7365 6c66 292e 6c69 7374 5f6f 7574 7075  self).list_outpu
-000010d0: 7473 2829 0a0a 2020 2020 2020 2020 6966  ts()..        if
-000010e0: 2073 656c 662e 696e 5f66 696c 653a 0a20   self.in_file:. 
-000010f0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00001100: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
-00001110: 6f72 793a 0a20 2020 2020 2020 2020 2020  ory:.           
-00001120: 2020 2020 2076 616c 6964 5f65 7874 2c20       valid_ext, 
-00001130: 696e 5f65 7874 2c20 6669 6c65 4e61 6d65  in_ext, fileName
-00001140: 203d 2063 6865 636b 4669 6c65 4578 7428   = checkFileExt(
-00001150: 7365 6c66 2e69 6e5f 6669 6c65 2c20 4558  self.in_file, EX
-00001160: 5429 0a0a 2020 2020 2020 2020 2020 2020  T)..            
-00001170: 2020 2020 6966 206e 6f74 2076 616c 6964      if not valid
-00001180: 5f65 7874 3a0a 2020 2020 2020 2020 2020  _ext:.          
-00001190: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000011a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000011b0: 2020 2020 2020 2020 2022 5c6e 4170 706c           "\nAppl
-000011c0: 7942 6961 7343 6f72 7265 6374 696f 6e20  yBiasCorrection 
-000011d0: 6272 6963 6b3a 2054 6865 2069 6e70 7574  brick: The input
-000011e0: 2069 6d61 6765 2022 0a20 2020 2020 2020   image ".       
+00000190: 202d 2045 7874 7261 6374 524f 4962 794c   - ExtractROIbyL
+000001a0: 6162 656c 0a20 2020 2020 2020 202d 2045  abel.        - E
+000001b0: 7874 7261 6374 5369 676e 616c 524f 490a  xtractSignalROI.
+000001c0: 2020 2020 2020 2020 2d20 4772 6164 6965          - Gradie
+000001d0: 6e74 5468 7265 7368 6f6c 640a 2020 2020  ntThreshold.    
+000001e0: 2020 2020 2d20 4861 726d 6f6e 697a 650a      - Harmonize.
+000001f0: 2020 2020 2020 2020 2d20 496e 7465 6e73          - Intens
+00000200: 6974 7943 6c69 700a 2020 2020 2020 2020  ityClip.        
+00000210: 2d20 4d61 736b 0a20 2020 2020 2020 202d  - Mask.        -
+00000220: 204e 6f6e 5374 6561 6479 5374 6174 6544   NonSteadyStateD
+00000230: 6574 6563 746f 720a 2020 2020 2020 2020  etector.        
+00000240: 2d20 5265 7361 6d70 6c65 310a 2020 2020  - Resample1.    
+00000250: 2020 2020 2d20 5265 7361 6d70 6c65 320a      - Resample2.
+00000260: 2020 2020 2020 2020 2d20 526f 7461 7469          - Rotati
+00000270: 6f6e 4d61 736b 0a20 2020 2020 2020 202d  onMask.        -
+00000280: 2053 616e 6974 697a 650a 2020 2020 2020   Sanitize.      
+00000290: 2020 2d20 5453 4e52 0a20 2020 2020 2020    - TSNR.       
+000002a0: 202d 2054 656d 706c 6174 6546 726f 6d54   - TemplateFromT
+000002b0: 656d 706c 6174 6546 6c6f 770a 2020 2020  emplateFlow.    
+000002c0: 2020 2020 2d20 5468 7265 7368 6f6c 640a      - Threshold.
+000002d0: 0a20 2020 203a 4675 6e63 7469 6f6e 3a0a  .    :Function:.
+000002e0: 2020 2020 2020 2020 2d20 6172 7469 6661          - artifa
+000002f0: 6374 5f6d 6173 6b0a 2020 2020 2020 2020  ct_mask.        
+00000300: 2d20 6973 5f6f 7574 6c69 6572 0a20 2020  - is_outlier.   
+00000310: 2020 2020 202d 2074 6872 6573 686f 6c64       - threshold
+00000320: 0a22 2222 0a0a 2323 2323 2323 2323 2323  ."""..##########
+00000330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000360: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000370: 0a23 206d 6961 5f70 726f 6365 7373 6573  .# mia_processes
+00000380: 202d 2043 6f70 7972 6967 6874 2028 4329   - Copyright (C)
+00000390: 2049 524d 6147 652f 4345 412c 2032 3031   IRMaGe/CEA, 201
+000003a0: 380a 2320 4469 7374 7269 6275 7465 6420  8.# Distributed 
+000003b0: 756e 6465 7220 7468 6520 7465 726d 7320  under the terms 
+000003c0: 6f66 2074 6865 2043 6543 494c 4c20 6c69  of the CeCILL li
+000003d0: 6365 6e73 652c 2061 7320 7075 626c 6973  cense, as publis
+000003e0: 6865 6420 6279 0a23 2074 6865 2043 4541  hed by.# the CEA
+000003f0: 2d43 4e52 532d 494e 5249 412e 2052 6566  -CNRS-INRIA. Ref
+00000400: 6572 2074 6f20 7468 6520 4c49 4345 4e53  er to the LICENS
+00000410: 4520 6669 6c65 206f 7220 746f 0a23 2068  E file or to.# h
+00000420: 7474 703a 2f2f 7777 772e 6365 6369 6c6c  ttp://www.cecill
+00000430: 2e69 6e66 6f2f 6c69 6365 6e63 6573 2f4c  .info/licences/L
+00000440: 6963 656e 6365 5f43 6543 494c 4c5f 5632  icence_CeCILL_V2
+00000450: 2e31 2d65 6e2e 6874 6d6c 0a23 2066 6f72  .1-en.html.# for
+00000460: 2064 6574 6169 6c73 2e0a 2323 2323 2323   details..######
+00000470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000480: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00000490: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000004a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000004b0: 2323 2323 0a0a 696d 706f 7274 206f 730a  ####..import os.
+000004c0: 696d 706f 7274 2073 6875 7469 6c0a 696d  import shutil.im
+000004d0: 706f 7274 2074 656d 7066 696c 650a 0a69  port tempfile..i
+000004e0: 6d70 6f72 7420 6e69 6261 6265 6c20 6173  mport nibabel as
+000004f0: 206e 6962 0a69 6d70 6f72 7420 6e75 6d70   nib.import nump
+00000500: 7920 6173 206e 700a 696d 706f 7274 2070  y as np.import p
+00000510: 616e 6461 7320 6173 2070 640a 6672 6f6d  andas as pd.from
+00000520: 206e 696c 6561 726e 2e69 6d61 6765 2069   nilearn.image i
+00000530: 6d70 6f72 7420 7265 7361 6d70 6c65 5f74  mport resample_t
+00000540: 6f5f 696d 670a 6672 6f6d 206e 696c 6561  o_img.from nilea
+00000550: 726e 2e6d 6173 6b65 7273 2069 6d70 6f72  rn.maskers impor
+00000560: 7420 4e69 6674 694c 6162 656c 734d 6173  t NiftiLabelsMas
+00000570: 6b65 720a 0a23 206e 6970 7970 6520 696d  ker..# nipype im
+00000580: 706f 7274 0a66 726f 6d20 6e69 7079 7065  port.from nipype
+00000590: 2e69 6e74 6572 6661 6365 732e 6261 7365  .interfaces.base
+000005a0: 2069 6d70 6f72 7420 280a 2020 2020 4669   import (.    Fi
+000005b0: 6c65 2c0a 2020 2020 496e 7075 744d 756c  le,.    InputMul
+000005c0: 7469 5061 7468 2c0a 2020 2020 4f75 7470  tiPath,.    Outp
+000005d0: 7574 4d75 6c74 6950 6174 682c 0a20 2020  utMultiPath,.   
+000005e0: 2054 7261 6974 4c69 7374 4f62 6a65 6374   TraitListObject
+000005f0: 2c0a 2020 2020 556e 6465 6669 6e65 642c  ,.    Undefined,
+00000600: 0a20 2020 2074 7261 6974 732c 0a29 0a66  .    traits,.).f
+00000610: 726f 6d20 6e69 7079 7065 2e69 6e74 6572  rom nipype.inter
+00000620: 6661 6365 732e 7370 6d2e 6261 7365 2069  faces.spm.base i
+00000630: 6d70 6f72 7420 496d 6167 6546 696c 6553  mport ImageFileS
+00000640: 504d 0a0a 2320 706f 7075 6c73 655f 6d69  PM..# populse_mi
+00000650: 6120 696d 706f 7274 0a23 2066 726f 6d20  a import.# from 
+00000660: 706f 7075 6c73 655f 6d69 612e 736f 6674  populse_mia.soft
+00000670: 7761 7265 5f70 726f 7065 7274 6965 7320  ware_properties 
+00000680: 696d 706f 7274 2043 6f6e 6669 670a 6672  import Config.fr
+00000690: 6f6d 2070 6f70 756c 7365 5f6d 6961 2e75  om populse_mia.u
+000006a0: 7365 725f 696e 7465 7266 6163 652e 7069  ser_interface.pi
+000006b0: 7065 6c69 6e65 5f6d 616e 6167 6572 2e70  peline_manager.p
+000006c0: 726f 6365 7373 5f6d 6961 2069 6d70 6f72  rocess_mia impor
+000006d0: 7420 5072 6f63 6573 734d 4941 0a66 726f  t ProcessMIA.fro
+000006e0: 6d20 7363 6970 7920 696d 706f 7274 206e  m scipy import n
+000006f0: 6469 6d61 6765 2061 7320 7369 6d0a 6672  dimage as sim.fr
+00000700: 6f6d 2073 6b69 6d61 6765 2e6d 6f72 7068  om skimage.morph
+00000710: 6f6c 6f67 7920 696d 706f 7274 2062 616c  ology import bal
+00000720: 6c0a 0a23 2073 6f6d 612d 6261 7365 2069  l..# soma-base i
+00000730: 6d70 6f72 7473 0a66 726f 6d20 736f 6d61  mports.from soma
+00000740: 2e71 745f 6775 692e 7174 5f62 6163 6b65  .qt_gui.qt_backe
+00000750: 6e64 2e51 7420 696d 706f 7274 2051 4d65  nd.Qt import QMe
+00000760: 7373 6167 6542 6f78 0a66 726f 6d20 7374  ssageBox.from st
+00000770: 6174 736d 6f64 656c 732e 726f 6275 7374  atsmodels.robust
+00000780: 2e73 6361 6c65 2069 6d70 6f72 7420 6d61  .scale import ma
+00000790: 640a 0a23 2069 6d70 6f72 7420 7465 6d70  d..# import temp
+000007a0: 6c61 7465 666c 6f77 2074 6f20 6765 7420  lateflow to get 
+000007b0: 616e 6174 6f6d 6963 616c 2074 656d 706c  anatomical templ
+000007c0: 6174 6573 0a66 726f 6d20 7465 6d70 6c61  ates.from templa
+000007d0: 7465 666c 6f77 2e61 7069 2069 6d70 6f72  teflow.api impor
+000007e0: 7420 6765 7420 6173 2067 6574 5f74 656d  t get as get_tem
+000007f0: 706c 6174 650a 0a23 206d 6961 5f70 726f  plate..# mia_pro
+00000800: 6365 7373 6573 2069 6d70 6f72 740a 6672  cesses import.fr
+00000810: 6f6d 206d 6961 5f70 726f 6365 7373 6573  om mia_processes
+00000820: 2e75 7469 6c73 2069 6d70 6f72 7420 280a  .utils import (.
+00000830: 2020 2020 6368 6563 6b46 696c 6545 7874      checkFileExt
+00000840: 2c0a 2020 2020 6765 745f 6462 4669 656c  ,.    get_dbFiel
+00000850: 6456 616c 7565 2c0a 2020 2020 7365 745f  dValue,.    set_
+00000860: 6462 4669 656c 6456 616c 7565 2c0a 290a  dbFieldValue,.).
+00000870: 0a23 204f 7468 6572 2069 6d70 6f72 740a  .# Other import.
+00000880: 2320 6672 6f6d 2064 6973 7475 7469 6c73  # from distutils
+00000890: 2e64 6972 5f75 7469 6c20 696d 706f 7274  .dir_util import
+000008a0: 2063 6f70 795f 7472 6565 0a0a 4558 5420   copy_tree..EXT 
+000008b0: 3d20 7b22 4e49 4654 495f 475a 223a 2022  = {"NIFTI_GZ": "
+000008c0: 6e69 692e 677a 222c 2022 4e49 4654 4922  nii.gz", "NIFTI"
+000008d0: 3a20 226e 6969 227d 0a0a 0a63 6c61 7373  : "nii"}...class
+000008e0: 2041 7070 6c79 4269 6173 436f 7272 6563   ApplyBiasCorrec
+000008f0: 7469 6f6e 2850 726f 6365 7373 4d49 4129  tion(ProcessMIA)
+00000900: 3a0a 2020 2020 2222 220a 2020 2020 2a41  :.    """.    *A
+00000910: 7070 6c79 2062 6961 7320 6669 656c 6420  pply bias field 
+00000920: 636f 7272 6563 7469 6f6e 2074 6f20 616e  correction to an
+00000930: 2069 6e70 7574 2066 696c 6520 7573 696e   input file usin
+00000940: 6720 7468 6520 6269 6173 2069 6d61 6765  g the bias image
+00000950: 2a0a 0a20 2020 2050 6c65 6173 652c 2073  *..    Please, s
+00000960: 6565 2074 6865 2063 6f6d 706c 6574 6520  ee the complete 
+00000970: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
+00000980: 7220 7468 6520 2741 7070 6c79 4269 6173  r the 'ApplyBias
+00000990: 436f 7272 6563 7469 6f6e 2062 7269 636b  Correction brick
+000009a0: 0a20 2020 2069 6e20 7468 6520 6d69 615f  .    in the mia_
+000009b0: 7072 6f63 6573 7365 7320 7765 6273 6974  processes websit
+000009c0: 650a 2020 2020 3c68 7474 7073 3a2f 2f70  e.    <https://p
+000009d0: 6f70 756c 7365 2e67 6974 6875 622e 696f  opulse.github.io
+000009e0: 2f6d 6961 5f70 726f 6365 7373 6573 2f68  /mia_processes/h
+000009f0: 746d 6c2f 646f 6375 6d65 6e74 6174 696f  tml/documentatio
+00000a00: 6e2f 6272 6963 6b73 2f70 7265 7072 6f63  n/bricks/preproc
+00000a10: 6573 732f 6f74 6865 722f 4170 706c 794d  ess/other/ApplyM
+00000a20: 6173 6b2e 6874 6d6c 3e60 5f0a 0a20 2020  ask.html>`_..   
+00000a30: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00000a40: 696e 6974 5f5f 2873 656c 6629 3a0a 2020  init__(self):.  
+00000a50: 2020 2020 2020 2222 2244 6564 6963 6174        """Dedicat
+00000a60: 6564 2074 6f20 7468 6520 6174 7472 6962  ed to the attrib
+00000a70: 7574 6573 2069 6e69 7469 616c 6973 6174  utes initialisat
+00000a80: 696f 6e20 2f20 696e 7374 616e 7469 6174  ion / instantiat
+00000a90: 696f 6e2e 0a0a 2020 2020 2020 2020 5468  ion...        Th
+00000aa0: 6520 696e 7075 7420 616e 6420 6f75 7470  e input and outp
+00000ab0: 7574 2070 6c75 6773 2061 7265 2064 6566  ut plugs are def
+00000ac0: 696e 6564 2068 6572 652e 2054 6865 2073  ined here. The s
+00000ad0: 7065 6369 616c 0a20 2020 2020 2020 2027  pecial.        '
+00000ae0: 7365 6c66 2e72 6571 7569 7265 6d65 6e74  self.requirement
+00000af0: 2720 6174 7472 6962 7574 6520 286f 7074  ' attribute (opt
+00000b00: 696f 6e61 6c29 2069 7320 7573 6564 2074  ional) is used t
+00000b10: 6f20 6465 6669 6e65 2074 6865 0a20 2020  o define the.   
+00000b20: 2020 2020 2074 6869 7264 2d70 6172 7479       third-party
+00000b30: 2070 726f 6475 6374 7320 6e65 6365 7373   products necess
+00000b40: 6172 7920 666f 7220 7468 6520 7275 6e6e  ary for the runn
+00000b50: 696e 6720 6f66 2074 6865 2062 7269 636b  ing of the brick
+00000b60: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00000b70: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
+00000b80: 7361 7469 6f6e 206f 6620 7468 6520 6f62  sation of the ob
+00000b90: 6a65 6374 7320 6e65 6564 6564 2066 6f72  jects needed for
+00000ba0: 2074 6865 206c 6175 6e63 6820 6f66 2074   the launch of t
+00000bb0: 6865 2062 7269 636b 0a20 2020 2020 2020  he brick.       
+00000bc0: 2073 7570 6572 2841 7070 6c79 4269 6173   super(ApplyBias
+00000bd0: 436f 7272 6563 7469 6f6e 2c20 7365 6c66  Correction, self
+00000be0: 292e 5f5f 696e 6974 5f5f 2829 0a0a 2020  ).__init__()..  
+00000bf0: 2020 2020 2020 2320 5468 6972 6420 7061        # Third pa
+00000c00: 7274 7920 736f 6674 7761 7265 7320 7265  rty softwares re
+00000c10: 7175 6972 6564 2066 6f72 2074 6865 2065  quired for the e
+00000c20: 7865 6375 7469 6f6e 206f 6620 7468 6520  xecution of the 
+00000c30: 6272 6963 6b0a 2020 2020 2020 2020 7365  brick.        se
+00000c40: 6c66 2e72 6571 7569 7265 6d65 6e74 203d  lf.requirement =
+00000c50: 205b 5d0a 0a20 2020 2020 2020 2023 2049   []..        # I
+00000c60: 6e70 7574 7320 6465 7363 7269 7074 696f  nputs descriptio
+00000c70: 6e0a 2020 2020 2020 2020 696e 5f66 696c  n.        in_fil
+00000c80: 655f 6465 7363 203d 2022 4120 6669 6c65  e_desc = "A file
+00000c90: 220a 2020 2020 2020 2020 6269 6173 5f69  ".        bias_i
+00000ca0: 6d61 6765 5f64 6573 6320 3d20 2242 6961  mage_desc = "Bia
+00000cb0: 7320 696d 6167 6522 0a0a 2020 2020 2020  s image"..      
+00000cc0: 2020 2320 4f75 7470 7574 7320 6465 7363    # Outputs desc
+00000cd0: 7269 7074 696f 6e0a 2020 2020 2020 2020  ription.        
+00000ce0: 6f75 745f 6669 6c65 5f64 6573 6320 3d20  out_file_desc = 
+00000cf0: 224f 7574 2066 696c 6522 0a0a 2020 2020  "Out file"..    
+00000d00: 2020 2020 2320 496e 7075 7473 2074 7261      # Inputs tra
+00000d10: 6974 730a 2020 2020 2020 2020 7365 6c66  its.        self
+00000d20: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
+00000d30: 2020 2020 2020 2020 2269 6e5f 6669 6c65          "in_file
+00000d40: 222c 2046 696c 6528 6f75 7470 7574 3d46  ", File(output=F
+00000d50: 616c 7365 2c20 6f70 7469 6f6e 616c 3d46  alse, optional=F
+00000d60: 616c 7365 2c20 6465 7363 3d69 6e5f 6669  alse, desc=in_fi
+00000d70: 6c65 5f64 6573 6329 0a20 2020 2020 2020  le_desc).       
+00000d80: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+00000d90: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
+00000da0: 2020 2020 2020 2020 2262 6961 735f 696d          "bias_im
+00000db0: 6167 6522 2c0a 2020 2020 2020 2020 2020  age",.          
+00000dc0: 2020 4669 6c65 286f 7574 7075 743d 4661    File(output=Fa
+00000dd0: 6c73 652c 206f 7074 696f 6e61 6c3d 4661  lse, optional=Fa
+00000de0: 6c73 652c 2064 6573 633d 6269 6173 5f69  lse, desc=bias_i
+00000df0: 6d61 6765 5f64 6573 6329 2c0a 2020 2020  mage_desc),.    
+00000e00: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00000e10: 204f 7574 7075 7473 2074 7261 6974 730a   Outputs traits.
+00000e20: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+00000e30: 5f74 7261 6974 2822 6f75 745f 6669 6c65  _trait("out_file
+00000e40: 222c 2046 696c 6528 6f75 7470 7574 3d54  ", File(output=T
+00000e50: 7275 652c 2064 6573 633d 6f75 745f 6669  rue, desc=out_fi
+00000e60: 6c65 5f64 6573 6329 290a 0a20 2020 2020  le_desc))..     
+00000e70: 2020 2073 656c 662e 696e 6974 5f64 6566     self.init_def
+00000e80: 6175 6c74 5f74 7261 6974 7328 290a 0a20  ault_traits().. 
+00000e90: 2020 2064 6566 206c 6973 745f 6f75 7470     def list_outp
+00000ea0: 7574 7328 7365 6c66 2c20 6973 5f70 6c75  uts(self, is_plu
+00000eb0: 6767 6564 3d4e 6f6e 6529 3a0a 2020 2020  gged=None):.    
+00000ec0: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
+00000ed0: 2074 6f20 7468 6520 696e 6974 6961 6c69   to the initiali
+00000ee0: 7361 7469 6f6e 2073 7465 7020 6f66 2074  sation step of t
+00000ef0: 6865 2062 7269 636b 2e0a 0a20 2020 2020  he brick...     
+00000f00: 2020 2054 6865 206d 6169 6e20 6f62 6a65     The main obje
+00000f10: 6374 6976 6520 6f66 2074 6869 7320 6d65  ctive of this me
+00000f20: 7468 6f64 2069 7320 746f 2070 726f 6475  thod is to produ
+00000f30: 6365 2074 6865 206f 7574 7075 7473 206f  ce the outputs o
+00000f40: 6620 7468 650a 2020 2020 2020 2020 6272  f the.        br
+00000f50: 6963 6b73 2028 7365 6c66 2e6f 7574 7075  icks (self.outpu
+00000f60: 7473 2920 616e 6420 7468 6520 6173 736f  ts) and the asso
+00000f70: 6369 6174 6564 2074 6167 7320 2873 656c  ciated tags (sel
+00000f80: 662e 696e 6865 7269 7461 6e63 655f 6469  f.inheritance_di
+00000f90: 6329 2c0a 2020 2020 2020 2020 6966 2064  c),.        if d
+00000fa0: 6566 696e 6564 2068 6572 652e 2054 6f20  efined here. To 
+00000fb0: 776f 726b 2070 726f 7065 726c 7920 7468  work properly th
+00000fc0: 6973 206d 6574 686f 6420 6d75 7374 2072  is method must r
+00000fd0: 6574 7572 6e0a 2020 2020 2020 2020 7365  eturn.        se
+00000fe0: 6c66 2e6d 616b 655f 696e 6974 5265 7375  lf.make_initResu
+00000ff0: 6c74 2829 206f 626a 6563 742e 0a0a 2020  lt() object...  
+00001000: 2020 2020 2020 3a70 6172 616d 2069 735f        :param is_
+00001010: 706c 7567 6765 643a 2074 6865 2073 7461  plugged: the sta
+00001020: 7465 2c20 6c69 6e6b 6564 206f 7220 6e6f  te, linked or no
+00001030: 742c 206f 6620 7468 6520 706c 7567 732e  t, of the plugs.
+00001040: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00001050: 733a 2061 2064 6963 7469 6f6e 6172 7920  s: a dictionary 
+00001060: 7769 7468 2072 6571 7569 7265 6d65 6e74  with requirement
+00001070: 2c20 6f75 7470 7574 7320 616e 6420 696e  , outputs and in
+00001080: 6865 7269 7461 6e63 655f 6469 6374 2e0a  heritance_dict..
+00001090: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000010a0: 2020 2020 2320 5573 696e 6720 7468 6520      # Using the 
+000010b0: 696e 6865 7269 7461 6e63 6520 746f 2050  inheritance to P
+000010c0: 726f 6365 7373 4d49 4120 636c 6173 732c  rocessMIA class,
+000010d0: 206c 6973 745f 6f75 7470 7574 7320 6d65   list_outputs me
+000010e0: 7468 6f64 0a20 2020 2020 2020 2073 7570  thod.        sup
+000010f0: 6572 2841 7070 6c79 4269 6173 436f 7272  er(ApplyBiasCorr
+00001100: 6563 7469 6f6e 2c20 7365 6c66 292e 6c69  ection, self).li
+00001110: 7374 5f6f 7574 7075 7473 2829 0a0a 2020  st_outputs()..  
+00001120: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
+00001130: 5f66 696c 653a 0a20 2020 2020 2020 2020  _file:.         
+00001140: 2020 2069 6620 7365 6c66 2e6f 7574 7075     if self.outpu
+00001150: 745f 6469 7265 6374 6f72 793a 0a20 2020  t_directory:.   
+00001160: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00001170: 6964 5f65 7874 2c20 696e 5f65 7874 2c20  id_ext, in_ext, 
+00001180: 6669 6c65 4e61 6d65 203d 2063 6865 636b  fileName = check
+00001190: 4669 6c65 4578 7428 7365 6c66 2e69 6e5f  FileExt(self.in_
+000011a0: 6669 6c65 2c20 4558 5429 0a0a 2020 2020  file, EXT)..    
+000011b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000011c0: 6f74 2076 616c 6964 5f65 7874 3a0a 2020  ot valid_ext:.  
+000011d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011e0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
 000011f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001200: 2022 666f 726d 6174 2069 7320 6e6f 7420   "format is not 
-00001210: 7265 636f 676e 697a 6564 2e2e 2e21 220a  recognized...!".
-00001220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001230: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00001240: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00001250: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001260: 2020 7365 6c66 2e6f 7574 7075 7473 5b22    self.outputs["
-00001270: 6f75 745f 6669 6c65 225d 203d 206f 732e  out_file"] = os.
-00001280: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
-00001290: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000012a0: 656c 662e 6f75 7470 7574 5f64 6972 6563  elf.output_direc
-000012b0: 746f 7279 2c20 6669 6c65 4e61 6d65 202b  tory, fileName +
-000012c0: 2022 5f69 6e75 2e22 202b 2069 6e5f 6578   "_inu." + in_ex
-000012d0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000012e0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000012f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00001300: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00001310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001320: 2022 4170 706c 7942 6961 7343 6f72 7265   "ApplyBiasCorre
-00001330: 6374 696f 6e20 6272 6963 6b3a 204e 6f20  ction brick: No 
-00001340: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
-00001350: 2077 6173 2022 0a20 2020 2020 2020 2020   was ".         
-00001360: 2020 2020 2020 2020 2020 2022 666f 756e             "foun
-00001370: 642e 2e2e 215c 6e22 0a20 2020 2020 2020  d...!\n".       
-00001380: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00001390: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000013a0: 6e0a 0a20 2020 2020 2020 2069 6620 7365  n..        if se
-000013b0: 6c66 2e6f 7574 7075 7473 3a0a 2020 2020  lf.outputs:.    
-000013c0: 2020 2020 2020 2020 7365 6c66 2e74 6167          self.tag
-000013d0: 735f 696e 6865 7269 7461 6e63 6528 0a20  s_inheritance(. 
-000013e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000013f0: 6e5f 6669 6c65 3d73 656c 662e 696e 5f66  n_file=self.in_f
-00001400: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
-00001410: 2020 2020 206f 7574 5f66 696c 653d 7365       out_file=se
-00001420: 6c66 2e6f 7574 7075 7473 5b22 6f75 745f  lf.outputs["out_
-00001430: 6669 6c65 225d 2c0a 2020 2020 2020 2020  file"],.        
-00001440: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-00001450: 2052 6574 7572 6e20 7468 6520 7265 7175   Return the requ
-00001460: 6972 656d 656e 742c 206f 7574 7075 7473  irement, outputs
-00001470: 2061 6e64 2069 6e68 6572 6974 616e 6365   and inheritance
-00001480: 5f64 6963 740a 2020 2020 2020 2020 7265  _dict.        re
-00001490: 7475 726e 2073 656c 662e 6d61 6b65 5f69  turn self.make_i
-000014a0: 6e69 7452 6573 756c 7428 290a 0a20 2020  nitResult()..   
-000014b0: 2064 6566 2072 756e 5f70 726f 6365 7373   def run_process
-000014c0: 5f6d 6961 2873 656c 6629 3a0a 2020 2020  _mia(self):.    
-000014d0: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
-000014e0: 2074 6f20 7468 6520 7072 6f63 6573 7320   to the process 
-000014f0: 6c61 756e 6368 2073 7465 7020 6f66 2074  launch step of t
-00001500: 6865 2062 7269 636b 2e22 2222 0a0a 2020  he brick."""..  
-00001510: 2020 2020 2020 7375 7065 7228 4170 706c        super(Appl
-00001520: 7942 6961 7343 6f72 7265 6374 696f 6e2c  yBiasCorrection,
-00001530: 2073 656c 6629 2e72 756e 5f70 726f 6365   self).run_proce
-00001540: 7373 5f6d 6961 2829 0a0a 2020 2020 2020  ss_mia()..      
-00001550: 2020 696e 5f66 696c 6520 3d20 7365 6c66    in_file = self
-00001560: 2e69 6e5f 6669 6c65 0a20 2020 2020 2020  .in_file.       
-00001570: 206f 7574 5f66 696c 6520 3d20 7365 6c66   out_file = self
-00001580: 2e6f 7574 5f66 696c 650a 2020 2020 2020  .out_file.      
-00001590: 2020 6269 6173 5f69 6d61 6765 203d 2073    bias_image = s
-000015a0: 656c 662e 6269 6173 5f69 6d61 6765 0a0a  elf.bias_image..
-000015b0: 2020 2020 2020 2020 696d 6720 3d20 6e69          img = ni
-000015c0: 622e 6c6f 6164 2869 6e5f 6669 6c65 290a  b.load(in_file).
-000015d0: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
-000015e0: 702e 636c 6970 280a 2020 2020 2020 2020  p.clip(.        
-000015f0: 2020 2020 696d 672e 6765 745f 6664 6174      img.get_fdat
-00001600: 6128 2920 2a20 6e69 622e 6c6f 6164 2862  a() * nib.load(b
-00001610: 6961 735f 696d 6167 6529 2e67 6574 5f66  ias_image).get_f
-00001620: 6461 7461 2829 2c0a 2020 2020 2020 2020  data(),.        
-00001630: 2020 2020 615f 6d69 6e3d 302c 0a20 2020      a_min=0,.   
-00001640: 2020 2020 2020 2020 2061 5f6d 6178 3d4e           a_max=N
-00001650: 6f6e 652c 0a20 2020 2020 2020 2029 0a20  one,.        ). 
-00001660: 2020 2020 2020 206f 7574 5f69 6d67 203d         out_img =
-00001670: 2069 6d67 2e5f 5f63 6c61 7373 5f5f 280a   img.__class__(.
-00001680: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00001690: 2e61 7374 7970 6528 696d 672e 6765 745f  .astype(img.get_
-000016a0: 6461 7461 5f64 7479 7065 2829 292c 0a20  data_dtype()),. 
-000016b0: 2020 2020 2020 2020 2020 2069 6d67 2e61             img.a
-000016c0: 6666 696e 652c 0a20 2020 2020 2020 2020  ffine,.         
-000016d0: 2020 2069 6d67 2e68 6561 6465 722c 0a20     img.header,. 
-000016e0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-000016f0: 2020 6f75 745f 696d 672e 746f 5f66 696c    out_img.to_fil
-00001700: 656e 616d 6528 6f75 745f 6669 6c65 290a  ename(out_file).
-00001710: 0a0a 636c 6173 7320 4172 7469 6661 6374  ..class Artifact
-00001720: 4d61 736b 2850 726f 6365 7373 4d49 4129  Mask(ProcessMIA)
-00001730: 3a0a 2020 2020 2222 220a 2020 2020 2a43  :.    """.    *C
-00001740: 6f6d 7075 7465 7320 7468 6520 6172 7469  omputes the arti
-00001750: 6661 6374 206d 6173 6b2a 0a0a 2020 2020  fact mask*..    
-00001760: 506c 6561 7365 2c20 7365 6520 7468 6520  Please, see the 
-00001770: 636f 6d70 6c65 7465 2064 6f63 756d 656e  complete documen
-00001780: 7461 7469 6f6e 2066 6f72 2074 6865 2060  tation for the `
-00001790: 4172 7469 6661 6374 4d61 736b 2062 7269  ArtifactMask bri
-000017a0: 636b 0a20 2020 2069 6e20 7468 6520 6d69  ck.    in the mi
-000017b0: 615f 7072 6f63 6573 7365 7320 7765 6273  a_processes webs
-000017c0: 6974 650a 2020 2020 3c68 7474 7073 3a2f  ite.    <https:/
-000017d0: 2f70 6f70 756c 7365 2e67 6974 6875 622e  /populse.github.
-000017e0: 696f 2f6d 6961 5f70 726f 6365 7373 6573  io/mia_processes
-000017f0: 2f68 746d 6c2f 646f 6375 6d65 6e74 6174  /html/documentat
-00001800: 696f 6e2f 6272 6963 6b73 2f70 7265 7072  ion/bricks/prepr
-00001810: 6f63 6573 732f 6f74 6865 722f 4172 7469  ocess/other/Arti
-00001820: 6661 6374 4d61 736b 2e68 746d 6c3e 605f  factMask.html>`_
-00001830: 0a0a 2020 2020 6164 6170 7465 6420 6672  ..    adapted fr
-00001840: 6f6d 0a20 2020 2068 7474 7073 3a2f 2f67  om.    https://g
-00001850: 6974 6875 622e 636f 6d2f 6e69 7072 6570  ithub.com/niprep
-00001860: 732f 6d72 6971 632f 626c 6f62 2f65 3032  s/mriqc/blob/e02
-00001870: 3130 3038 6461 3061 3265 6631 6334 3865  1008da0a2ef1c48e
-00001880: 3838 3262 6166 3933 3231 3339 6136 3733  882baf932139a673
-00001890: 3334 3966 392f 6d72 6971 632f 696e 7465  349f9/mriqc/inte
-000018a0: 7266 6163 6573 2f61 6e61 746f 6d69 6361  rfaces/anatomica
-000018b0: 6c2e 7079 234c 3330 310a 2020 2020 2222  l.py#L301.    ""
-000018c0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-000018d0: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
-000018e0: 2020 2022 2222 4465 6469 6361 7465 6420     """Dedicated 
-000018f0: 746f 2074 6865 2061 7474 7269 6275 7465  to the attribute
-00001900: 7320 696e 6974 6961 6c69 7361 7469 6f6e  s initialisation
-00001910: 202f 2069 6e73 7461 6e74 6961 7469 6f6e   / instantiation
-00001920: 2e0a 0a20 2020 2020 2020 2054 6865 2069  ...        The i
-00001930: 6e70 7574 2061 6e64 206f 7574 7075 7420  nput and output 
-00001940: 706c 7567 7320 6172 6520 6465 6669 6e65  plugs are define
-00001950: 6420 6865 7265 2e20 5468 6520 7370 6563  d here. The spec
-00001960: 6961 6c0a 2020 2020 2020 2020 2773 656c  ial.        'sel
-00001970: 662e 7265 7175 6972 656d 656e 7427 2061  f.requirement' a
-00001980: 7474 7269 6275 7465 2028 6f70 7469 6f6e  ttribute (option
-00001990: 616c 2920 6973 2075 7365 6420 746f 2064  al) is used to d
-000019a0: 6566 696e 6520 7468 650a 2020 2020 2020  efine the.      
-000019b0: 2020 7468 6972 642d 7061 7274 7920 7072    third-party pr
-000019c0: 6f64 7563 7473 206e 6563 6573 7361 7279  oducts necessary
-000019d0: 2066 6f72 2074 6865 2072 756e 6e69 6e67   for the running
-000019e0: 206f 6620 7468 6520 6272 6963 6b2e 0a20   of the brick.. 
-000019f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001a00: 2020 2023 2049 6e69 7469 616c 6973 6174     # Initialisat
-00001a10: 696f 6e20 6f66 2074 6865 206f 626a 6563  ion of the objec
-00001a20: 7473 206e 6565 6465 6420 666f 7220 7468  ts needed for th
-00001a30: 6520 6c61 756e 6368 206f 6620 7468 6520  e launch of the 
-00001a40: 6272 6963 6b0a 2020 2020 2020 2020 7375  brick.        su
-00001a50: 7065 7228 4172 7469 6661 6374 4d61 736b  per(ArtifactMask
-00001a60: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-00001a70: 2829 0a0a 2020 2020 2020 2020 2320 5468  ()..        # Th
-00001a80: 6972 6420 7061 7274 7920 736f 6674 7761  ird party softwa
-00001a90: 7265 7320 7265 7175 6972 6564 2066 6f72  res required for
-00001aa0: 2074 6865 2065 7865 6375 7469 6f6e 206f   the execution o
-00001ab0: 6620 7468 6520 6272 6963 6b0a 2020 2020  f the brick.    
-00001ac0: 2020 2020 7365 6c66 2e72 6571 7569 7265      self.require
-00001ad0: 6d65 6e74 203d 205b 5d0a 0a20 2020 2020  ment = []..     
-00001ae0: 2020 2023 2049 6e70 7574 7320 6465 7363     # Inputs desc
-00001af0: 7269 7074 696f 6e0a 2020 2020 2020 2020  ription.        
-00001b00: 696e 5f66 696c 655f 6465 7363 203d 2022  in_file_desc = "
-00001b10: 416e 2065 7869 7374 696e 6720 7061 7468  An existing path
-00001b20: 2066 696c 652e 220a 2020 2020 2020 2020   file.".        
-00001b30: 6865 6164 5f6d 6173 6b5f 6465 7363 203d  head_mask_desc =
-00001b40: 2022 416e 2065 7869 7374 696e 6720 7061   "An existing pa
-00001b50: 7468 2066 696c 652e 220a 2020 2020 2020  th file.".      
-00001b60: 2020 726f 745f 6d61 736b 5f64 6573 6320    rot_mask_desc 
-00001b70: 3d20 2241 6e20 6578 6973 7469 6e67 2070  = "An existing p
-00001b80: 6174 6820 6669 6c65 2e22 0a20 2020 2020  ath file.".     
-00001b90: 2020 206e 6173 696f 6e5f 706f 7374 5f6d     nasion_post_m
-00001ba0: 6173 6b5f 6465 7363 203d 2022 416e 2065  ask_desc = "An e
-00001bb0: 7869 7374 696e 6720 7061 7468 2066 696c  xisting path fil
-00001bc0: 652e 220a 2020 2020 2020 2020 7375 6666  e.".        suff
-00001bd0: 6978 5f64 6573 6320 3d20 2253 7566 6669  ix_desc = "Suffi
-00001be0: 7820 6f66 2074 6865 206f 7574 7075 7420  x of the output 
-00001bf0: 696d 6167 6520 2861 2073 7472 696e 6729  image (a string)
-00001c00: 2e22 0a0a 2020 2020 2020 2020 2320 4f75  ."..        # Ou
-00001c10: 7470 7574 7320 6465 7363 7269 7074 696f  tputs descriptio
-00001c20: 6e0a 2020 2020 2020 2020 6f75 745f 6861  n.        out_ha
-00001c30: 745f 6d61 736b 5f64 6573 6320 3d20 280a  t_mask_desc = (.
-00001c40: 2020 2020 2020 2020 2020 2020 2250 6174              "Pat
-00001c50: 6820 6f66 2074 6865 206f 7574 7075 7474  h of the outputt
-00001c60: 6564 2061 6972 206d 6173 6b20 220a 2020  ed air mask ".  
-00001c70: 2020 2020 2020 2020 2020 2228 6120 7061            "(a pa
-00001c80: 7468 6c69 6b65 206f 626a 6563 7420 6f72  thlike object or
-00001c90: 2073 7472 696e 6722 0a20 2020 2020 2020   string".       
-00001ca0: 2020 2020 2022 7265 7072 6573 656e 7469       "representi
-00001cb0: 6e67 2061 2066 696c 6529 2e22 0a20 2020  ng a file).".   
-00001cc0: 2020 2020 2029 0a20 2020 2020 2020 206f       ).        o
-00001cd0: 7574 5f61 7274 5f6d 6173 6b5f 6465 7363  ut_art_mask_desc
-00001ce0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00001cf0: 2022 5061 7468 206f 6620 7468 6520 6f75   "Path of the ou
-00001d00: 7470 7574 7465 6420 6172 7469 6661 6374  tputted artifact
-00001d10: 206d 6173 6b20 220a 2020 2020 2020 2020   mask ".        
-00001d20: 2020 2020 2228 6120 7061 7468 6c69 6b65      "(a pathlike
-00001d30: 206f 626a 6563 7420 6f72 2073 7472 696e   object or strin
-00001d40: 6722 0a20 2020 2020 2020 2020 2020 2022  g".            "
-00001d50: 7265 7072 6573 656e 7469 6e67 2061 2066  representing a f
-00001d60: 696c 6529 2e22 0a20 2020 2020 2020 2029  ile).".        )
-00001d70: 0a20 2020 2020 2020 206f 7574 5f61 6972  .        out_air
-00001d80: 5f6d 6173 6b5f 6465 7363 203d 2028 0a20  _mask_desc = (. 
-00001d90: 2020 2020 2020 2020 2020 2022 5061 7468             "Path
-00001da0: 206f 6620 7468 6520 6f75 7470 7574 7465   of the outputte
-00001db0: 6420 6169 7220 6d61 736b 2022 0a20 2020  d air mask ".   
-00001dc0: 2020 2020 2020 2020 2022 2861 2070 6174           "(a pat
-00001dd0: 686c 696b 6520 6f62 6a65 6374 206f 7220  hlike object or 
-00001de0: 7374 7269 6e67 220a 2020 2020 2020 2020  string".        
-00001df0: 2020 2020 2272 6570 7265 7365 6e74 696e      "representin
-00001e00: 6720 6120 6669 6c65 292e 220a 2020 2020  g a file).".    
-00001e10: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-00001e20: 2049 6e70 7574 7320 7472 6169 7473 0a20   Inputs traits. 
-00001e30: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-00001e40: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-00001e50: 2020 2022 696e 5f66 696c 6522 2c20 4669     "in_file", Fi
-00001e60: 6c65 286f 7574 7075 743d 4661 6c73 652c  le(output=False,
-00001e70: 206f 7074 696f 6e61 6c3d 4661 6c73 652c   optional=False,
-00001e80: 2064 6573 633d 696e 5f66 696c 655f 6465   desc=in_file_de
-00001e90: 7363 290a 2020 2020 2020 2020 290a 0a20  sc).        ).. 
-00001ea0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-00001eb0: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-00001ec0: 2020 2022 6865 6164 5f6d 6173 6b22 2c0a     "head_mask",.
-00001ed0: 2020 2020 2020 2020 2020 2020 4669 6c65              File
-00001ee0: 286f 7574 7075 743d 4661 6c73 652c 206f  (output=False, o
-00001ef0: 7074 696f 6e61 6c3d 4661 6c73 652c 2064  ptional=False, d
-00001f00: 6573 633d 6865 6164 5f6d 6173 6b5f 6465  esc=head_mask_de
-00001f10: 7363 292c 0a20 2020 2020 2020 2029 0a0a  sc),.        )..
-00001f20: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00001f30: 5f74 7261 6974 280a 2020 2020 2020 2020  _trait(.        
-00001f40: 2020 2020 226e 6173 696f 6e5f 706f 7374      "nasion_post
-00001f50: 5f6d 6173 6b22 2c0a 2020 2020 2020 2020  _mask",.        
-00001f60: 2020 2020 4669 6c65 286f 7574 7075 743d      File(output=
-00001f70: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
-00001f80: 4661 6c73 652c 2064 6573 633d 6e61 7369  False, desc=nasi
-00001f90: 6f6e 5f70 6f73 745f 6d61 736b 5f64 6573  on_post_mask_des
-00001fa0: 6329 2c0a 2020 2020 2020 2020 290a 0a20  c),.        ).. 
-00001fb0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-00001fc0: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-00001fd0: 2020 2022 726f 745f 6d61 736b 222c 0a20     "rot_mask",. 
-00001fe0: 2020 2020 2020 2020 2020 2046 696c 6528             File(
-00001ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002000: 2064 6566 6175 6c74 3d4e 6f6e 652c 206f   default=None, o
-00002010: 7574 7075 743d 4661 6c73 652c 206f 7074  utput=False, opt
-00002020: 696f 6e61 6c3d 5472 7565 2c20 6465 7363  ional=True, desc
-00002030: 3d72 6f74 5f6d 6173 6b5f 6465 7363 0a20  =rot_mask_desc. 
-00002040: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00002050: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00002060: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
-00002070: 0a20 2020 2020 2020 2020 2020 2022 7375  .            "su
-00002080: 6666 6978 222c 0a20 2020 2020 2020 2020  ffix",.         
-00002090: 2020 2074 7261 6974 732e 5374 7269 6e67     traits.String
-000020a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000020b0: 2020 225f 6d61 736b 222c 206f 7574 7075    "_mask", outpu
-000020c0: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
-000020d0: 6c3d 5472 7565 2c20 6465 7363 3d73 7566  l=True, desc=suf
-000020e0: 6669 785f 6465 7363 0a20 2020 2020 2020  fix_desc.       
-000020f0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-00002100: 290a 0a20 2020 2020 2020 2023 204f 7574  )..        # Out
-00002110: 7075 7473 2074 7261 6974 730a 2020 2020  puts traits.    
-00002120: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
-00002130: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
-00002140: 226f 7574 5f68 6174 5f6d 6173 6b22 2c20  "out_hat_mask", 
-00002150: 4669 6c65 286f 7574 7075 743d 5472 7565  File(output=True
-00002160: 2c20 6465 7363 3d6f 7574 5f68 6174 5f6d  , desc=out_hat_m
-00002170: 6173 6b5f 6465 7363 290a 2020 2020 2020  ask_desc).      
-00002180: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00002190: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-000021a0: 2020 2020 2020 2020 2022 6f75 745f 6172           "out_ar
-000021b0: 745f 6d61 736b 222c 2046 696c 6528 6f75  t_mask", File(ou
-000021c0: 7470 7574 3d54 7275 652c 2064 6573 633d  tput=True, desc=
-000021d0: 6f75 745f 6172 745f 6d61 736b 5f64 6573  out_art_mask_des
-000021e0: 6329 0a20 2020 2020 2020 2029 0a0a 2020  c).        )..  
-000021f0: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
-00002200: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
-00002210: 2020 226f 7574 5f61 6972 5f6d 6173 6b22    "out_air_mask"
-00002220: 2c20 4669 6c65 286f 7574 7075 743d 5472  , File(output=Tr
-00002230: 7565 2c20 6465 7363 3d6f 7574 5f61 6972  ue, desc=out_air
-00002240: 5f6d 6173 6b5f 6465 7363 290a 2020 2020  _mask_desc).    
-00002250: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-00002260: 656c 662e 696e 6974 5f64 6566 6175 6c74  elf.init_default
-00002270: 5f74 7261 6974 7328 290a 0a20 2020 2064  _traits()..    d
-00002280: 6566 206c 6973 745f 6f75 7470 7574 7328  ef list_outputs(
-00002290: 7365 6c66 2c20 6973 5f70 6c75 6767 6564  self, is_plugged
-000022a0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000022b0: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
-000022c0: 7468 6520 696e 6974 6961 6c69 7361 7469  the initialisati
-000022d0: 6f6e 2073 7465 7020 6f66 2074 6865 2062  on step of the b
-000022e0: 7269 636b 2e0a 0a20 2020 2020 2020 2054  rick...        T
-000022f0: 6865 206d 6169 6e20 6f62 6a65 6374 6976  he main objectiv
-00002300: 6520 6f66 2074 6869 7320 6d65 7468 6f64  e of this method
-00002310: 2069 7320 746f 2070 726f 6475 6365 2074   is to produce t
-00002320: 6865 206f 7574 7075 7473 206f 6620 7468  he outputs of th
-00002330: 650a 2020 2020 2020 2020 6272 6963 6b73  e.        bricks
-00002340: 2028 7365 6c66 2e6f 7574 7075 7473 2920   (self.outputs) 
-00002350: 616e 6420 7468 6520 6173 736f 6369 6174  and the associat
-00002360: 6564 2074 6167 7320 2873 656c 662e 696e  ed tags (self.in
-00002370: 6865 7269 7461 6e63 655f 6469 6329 2c0a  heritance_dic),.
-00002380: 2020 2020 2020 2020 6966 2064 6566 696e          if defin
-00002390: 6564 2068 6572 652e 2054 6f20 776f 726b  ed here. To work
-000023a0: 2070 726f 7065 726c 7920 7468 6973 206d   properly this m
-000023b0: 6574 686f 6420 6d75 7374 2072 6574 7572  ethod must retur
-000023c0: 6e0a 2020 2020 2020 2020 7365 6c66 2e6d  n.        self.m
-000023d0: 616b 655f 696e 6974 5265 7375 6c74 2829  ake_initResult()
-000023e0: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
-000023f0: 2020 3a70 6172 616d 2069 735f 706c 7567    :param is_plug
-00002400: 6765 643a 2074 6865 2073 7461 7465 2c20  ged: the state, 
-00002410: 6c69 6e6b 6564 206f 7220 6e6f 742c 206f  linked or not, o
-00002420: 6620 7468 6520 706c 7567 732e 0a20 2020  f the plugs..   
-00002430: 2020 2020 203a 7265 7475 726e 733a 2061       :returns: a
-00002440: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
-00002450: 2072 6571 7569 7265 6d65 6e74 2c20 6f75   requirement, ou
-00002460: 7470 7574 7320 616e 6420 696e 6865 7269  tputs and inheri
-00002470: 7461 6e63 655f 6469 6374 2e0a 2020 2020  tance_dict..    
-00002480: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00002490: 2320 5573 696e 6720 7468 6520 696e 6865  # Using the inhe
-000024a0: 7269 7461 6e63 6520 746f 2050 726f 6365  ritance to Proce
-000024b0: 7373 4d49 4120 636c 6173 732c 206c 6973  ssMIA class, lis
-000024c0: 745f 6f75 7470 7574 7320 6d65 7468 6f64  t_outputs method
-000024d0: 0a20 2020 2020 2020 2073 7570 6572 2841  .        super(A
-000024e0: 7274 6966 6163 744d 6173 6b2c 2073 656c  rtifactMask, sel
-000024f0: 6629 2e6c 6973 745f 6f75 7470 7574 7328  f).list_outputs(
-00002500: 290a 0a20 2020 2020 2020 2023 204f 7574  )..        # Out
-00002510: 7075 7473 2064 6566 696e 6974 696f 6e0a  puts definition.
-00002520: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00002530: 696e 5f66 696c 653a 0a20 2020 2020 2020  in_file:.       
-00002540: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00002550: 2020 2020 2020 2020 2020 286e 6f74 2073            (not s
-00002560: 656c 662e 7375 6666 6978 290a 2020 2020  elf.suffix).    
-00002570: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-00002580: 7365 6c66 2e73 7566 6669 782e 6973 7370  self.suffix.issp
-00002590: 6163 6528 2929 0a20 2020 2020 2020 2020  ace()).         
-000025a0: 2020 2020 2020 206f 7220 7365 6c66 2e73         or self.s
-000025b0: 7566 6669 7820 696e 205b 556e 6465 6669  uffix in [Undefi
-000025c0: 6e65 642c 2022 3c75 6e64 6566 696e 6564  ned, "<undefined
-000025d0: 3e22 5d0a 2020 2020 2020 2020 2020 2020  >"].            
-000025e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000025f0: 2020 2073 656c 662e 7375 6666 6978 203d     self.suffix =
-00002600: 2022 2022 0a0a 2020 2020 2020 2020 2020   " "..          
-00002610: 2020 6669 6c65 5f68 6174 203d 2022 220a    file_hat = "".
-00002620: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00002630: 5f61 7274 203d 2022 220a 2020 2020 2020  _art = "".      
-00002640: 2020 2020 2020 6669 6c65 5f61 6972 203d        file_air =
-00002650: 2022 220a 0a20 2020 2020 2020 2020 2020   ""..           
-00002660: 2076 616c 6964 5f65 7874 2c20 696e 5f65   valid_ext, in_e
-00002670: 7874 2c20 6669 6c65 4e61 6d65 203d 2063  xt, fileName = c
-00002680: 6865 636b 4669 6c65 4578 7428 7365 6c66  heckFileExt(self
-00002690: 2e69 6e5f 6669 6c65 2c20 4558 5429 0a0a  .in_file, EXT)..
-000026a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000026b0: 6f74 2076 616c 6964 5f65 7874 3a0a 2020  ot valid_ext:.  
-000026c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000026d0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-000026e0: 2020 2020 2020 2020 2022 5c6e 4172 7469           "\nArti
-000026f0: 6661 6374 4d61 736b 2062 7269 636b 3a20  factMask brick: 
-00002700: 5468 6520 696e 7075 7420 696d 6167 6520  The input image 
-00002710: 666f 726d 6174 2069 7320 6e6f 7420 220a  format is not ".
+00001200: 2022 5c6e 4170 706c 7942 6961 7343 6f72   "\nApplyBiasCor
+00001210: 7265 6374 696f 6e20 6272 6963 6b3a 2054  rection brick: T
+00001220: 6865 2069 6e70 7574 2069 6d61 6765 2022  he input image "
+00001230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001240: 2020 2020 2020 2020 2022 666f 726d 6174           "format
+00001250: 2069 7320 6e6f 7420 7265 636f 676e 697a   is not recogniz
+00001260: 6564 2e2e 2e21 220a 2020 2020 2020 2020  ed...!".        
+00001270: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00001280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001290: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+000012a0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+000012b0: 7574 7075 7473 5b22 6f75 745f 6669 6c65  utputs["out_file
+000012c0: 225d 203d 206f 732e 7061 7468 2e6a 6f69  "] = os.path.joi
+000012d0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+000012e0: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
+000012f0: 7574 5f64 6972 6563 746f 7279 2c20 6669  ut_directory, fi
+00001300: 6c65 4e61 6d65 202b 2022 5f69 6e75 2e22  leName + "_inu."
+00001310: 202b 2069 6e5f 6578 740a 2020 2020 2020   + in_ext.      
+00001320: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00001330: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00001340: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00001350: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+00001360: 2020 2020 2020 2020 2022 4170 706c 7942           "ApplyB
+00001370: 6961 7343 6f72 7265 6374 696f 6e20 6272  iasCorrection br
+00001380: 6963 6b3a 204e 6f20 6f75 7470 7574 5f64  ick: No output_d
+00001390: 6972 6563 746f 7279 2077 6173 2022 0a20  irectory was ". 
+000013a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013b0: 2020 2022 666f 756e 642e 2e2e 215c 6e22     "found...!\n"
+000013c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000013d0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+000013e0: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+000013f0: 2020 2069 6620 7365 6c66 2e6f 7574 7075     if self.outpu
+00001400: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00001410: 7365 6c66 2e74 6167 735f 696e 6865 7269  self.tags_inheri
+00001420: 7461 6e63 6528 0a20 2020 2020 2020 2020  tance(.         
+00001430: 2020 2020 2020 2069 6e5f 6669 6c65 3d73         in_file=s
+00001440: 656c 662e 696e 5f66 696c 652c 0a20 2020  elf.in_file,.   
+00001450: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00001460: 5f66 696c 653d 7365 6c66 2e6f 7574 7075  _file=self.outpu
+00001470: 7473 5b22 6f75 745f 6669 6c65 225d 2c0a  ts["out_file"],.
+00001480: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00001490: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
+000014a0: 7468 6520 7265 7175 6972 656d 656e 742c  the requirement,
+000014b0: 206f 7574 7075 7473 2061 6e64 2069 6e68   outputs and inh
+000014c0: 6572 6974 616e 6365 5f64 6963 740a 2020  eritance_dict.  
+000014d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000014e0: 662e 6d61 6b65 5f69 6e69 7452 6573 756c  f.make_initResul
+000014f0: 7428 290a 0a20 2020 2064 6566 2072 756e  t()..    def run
+00001500: 5f70 726f 6365 7373 5f6d 6961 2873 656c  _process_mia(sel
+00001510: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
+00001520: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
+00001530: 7072 6f63 6573 7320 6c61 756e 6368 2073  process launch s
+00001540: 7465 7020 6f66 2074 6865 2062 7269 636b  tep of the brick
+00001550: 2e22 2222 0a0a 2020 2020 2020 2020 7375  ."""..        su
+00001560: 7065 7228 4170 706c 7942 6961 7343 6f72  per(ApplyBiasCor
+00001570: 7265 6374 696f 6e2c 2073 656c 6629 2e72  rection, self).r
+00001580: 756e 5f70 726f 6365 7373 5f6d 6961 2829  un_process_mia()
+00001590: 0a0a 2020 2020 2020 2020 696e 5f66 696c  ..        in_fil
+000015a0: 6520 3d20 7365 6c66 2e69 6e5f 6669 6c65  e = self.in_file
+000015b0: 0a20 2020 2020 2020 206f 7574 5f66 696c  .        out_fil
+000015c0: 6520 3d20 7365 6c66 2e6f 7574 5f66 696c  e = self.out_fil
+000015d0: 650a 2020 2020 2020 2020 6269 6173 5f69  e.        bias_i
+000015e0: 6d61 6765 203d 2073 656c 662e 6269 6173  mage = self.bias
+000015f0: 5f69 6d61 6765 0a0a 2020 2020 2020 2020  _image..        
+00001600: 696d 6720 3d20 6e69 622e 6c6f 6164 2869  img = nib.load(i
+00001610: 6e5f 6669 6c65 290a 2020 2020 2020 2020  n_file).        
+00001620: 6461 7461 203d 206e 702e 636c 6970 280a  data = np.clip(.
+00001630: 2020 2020 2020 2020 2020 2020 696d 672e              img.
+00001640: 6765 745f 6664 6174 6128 2920 2a20 6e69  get_fdata() * ni
+00001650: 622e 6c6f 6164 2862 6961 735f 696d 6167  b.load(bias_imag
+00001660: 6529 2e67 6574 5f66 6461 7461 2829 2c0a  e).get_fdata(),.
+00001670: 2020 2020 2020 2020 2020 2020 615f 6d69              a_mi
+00001680: 6e3d 302c 0a20 2020 2020 2020 2020 2020  n=0,.           
+00001690: 2061 5f6d 6178 3d4e 6f6e 652c 0a20 2020   a_max=None,.   
+000016a0: 2020 2020 2029 0a20 2020 2020 2020 206f       ).        o
+000016b0: 7574 5f69 6d67 203d 2069 6d67 2e5f 5f63  ut_img = img.__c
+000016c0: 6c61 7373 5f5f 280a 2020 2020 2020 2020  lass__(.        
+000016d0: 2020 2020 6461 7461 2e61 7374 7970 6528      data.astype(
+000016e0: 696d 672e 6765 745f 6461 7461 5f64 7479  img.get_data_dty
+000016f0: 7065 2829 292c 0a20 2020 2020 2020 2020  pe()),.         
+00001700: 2020 2069 6d67 2e61 6666 696e 652c 0a20     img.affine,. 
+00001710: 2020 2020 2020 2020 2020 2069 6d67 2e68             img.h
+00001720: 6561 6465 722c 0a20 2020 2020 2020 2029  eader,.        )
+00001730: 0a0a 2020 2020 2020 2020 6f75 745f 696d  ..        out_im
+00001740: 672e 746f 5f66 696c 656e 616d 6528 6f75  g.to_filename(ou
+00001750: 745f 6669 6c65 290a 0a0a 636c 6173 7320  t_file)...class 
+00001760: 4172 7469 6661 6374 4d61 736b 2850 726f  ArtifactMask(Pro
+00001770: 6365 7373 4d49 4129 3a0a 2020 2020 2222  cessMIA):.    ""
+00001780: 220a 2020 2020 2a43 6f6d 7075 7465 7320  ".    *Computes 
+00001790: 7468 6520 6172 7469 6661 6374 206d 6173  the artifact mas
+000017a0: 6b2a 0a0a 2020 2020 506c 6561 7365 2c20  k*..    Please, 
+000017b0: 7365 6520 7468 6520 636f 6d70 6c65 7465  see the complete
+000017c0: 2064 6f63 756d 656e 7461 7469 6f6e 2066   documentation f
+000017d0: 6f72 2074 6865 2060 4172 7469 6661 6374  or the `Artifact
+000017e0: 4d61 736b 2062 7269 636b 0a20 2020 2069  Mask brick.    i
+000017f0: 6e20 7468 6520 6d69 615f 7072 6f63 6573  n the mia_proces
+00001800: 7365 7320 7765 6273 6974 650a 2020 2020  ses website.    
+00001810: 3c68 7474 7073 3a2f 2f70 6f70 756c 7365  <https://populse
+00001820: 2e67 6974 6875 622e 696f 2f6d 6961 5f70  .github.io/mia_p
+00001830: 726f 6365 7373 6573 2f68 746d 6c2f 646f  rocesses/html/do
+00001840: 6375 6d65 6e74 6174 696f 6e2f 6272 6963  cumentation/bric
+00001850: 6b73 2f70 7265 7072 6f63 6573 732f 6f74  ks/preprocess/ot
+00001860: 6865 722f 4172 7469 6661 6374 4d61 736b  her/ArtifactMask
+00001870: 2e68 746d 6c3e 605f 0a0a 2020 2020 6164  .html>`_..    ad
+00001880: 6170 7465 6420 6672 6f6d 0a20 2020 2068  apted from.    h
+00001890: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+000018a0: 6d2f 6e69 7072 6570 732f 6d72 6971 632f  m/nipreps/mriqc/
+000018b0: 626c 6f62 2f65 3032 3130 3038 6461 3061  blob/e021008da0a
+000018c0: 3265 6631 6334 3865 3838 3262 6166 3933  2ef1c48e882baf93
+000018d0: 3231 3339 6136 3733 3334 3966 392f 6d72  2139a673349f9/mr
+000018e0: 6971 632f 696e 7465 7266 6163 6573 2f61  iqc/interfaces/a
+000018f0: 6e61 746f 6d69 6361 6c2e 7079 234c 3330  natomical.py#L30
+00001900: 310a 2020 2020 2222 220a 0a20 2020 2064  1.    """..    d
+00001910: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00001920: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
+00001930: 6469 6361 7465 6420 746f 2074 6865 2061  dicated to the a
+00001940: 7474 7269 6275 7465 7320 696e 6974 6961  ttributes initia
+00001950: 6c69 7361 7469 6f6e 202f 2069 6e73 7461  lisation / insta
+00001960: 6e74 6961 7469 6f6e 2e0a 0a20 2020 2020  ntiation...     
+00001970: 2020 2054 6865 2069 6e70 7574 2061 6e64     The input and
+00001980: 206f 7574 7075 7420 706c 7567 7320 6172   output plugs ar
+00001990: 6520 6465 6669 6e65 6420 6865 7265 2e20  e defined here. 
+000019a0: 5468 6520 7370 6563 6961 6c0a 2020 2020  The special.    
+000019b0: 2020 2020 2773 656c 662e 7265 7175 6972      'self.requir
+000019c0: 656d 656e 7427 2061 7474 7269 6275 7465  ement' attribute
+000019d0: 2028 6f70 7469 6f6e 616c 2920 6973 2075   (optional) is u
+000019e0: 7365 6420 746f 2064 6566 696e 6520 7468  sed to define th
+000019f0: 650a 2020 2020 2020 2020 7468 6972 642d  e.        third-
+00001a00: 7061 7274 7920 7072 6f64 7563 7473 206e  party products n
+00001a10: 6563 6573 7361 7279 2066 6f72 2074 6865  ecessary for the
+00001a20: 2072 756e 6e69 6e67 206f 6620 7468 6520   running of the 
+00001a30: 6272 6963 6b2e 0a20 2020 2020 2020 2022  brick..        "
+00001a40: 2222 0a20 2020 2020 2020 2023 2049 6e69  "".        # Ini
+00001a50: 7469 616c 6973 6174 696f 6e20 6f66 2074  tialisation of t
+00001a60: 6865 206f 626a 6563 7473 206e 6565 6465  he objects neede
+00001a70: 6420 666f 7220 7468 6520 6c61 756e 6368  d for the launch
+00001a80: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
+00001a90: 2020 2020 2020 7375 7065 7228 4172 7469        super(Arti
+00001aa0: 6661 6374 4d61 736b 2c20 7365 6c66 292e  factMask, self).
+00001ab0: 5f5f 696e 6974 5f5f 2829 0a0a 2020 2020  __init__()..    
+00001ac0: 2020 2020 2320 5468 6972 6420 7061 7274      # Third part
+00001ad0: 7920 736f 6674 7761 7265 7320 7265 7175  y softwares requ
+00001ae0: 6972 6564 2066 6f72 2074 6865 2065 7865  ired for the exe
+00001af0: 6375 7469 6f6e 206f 6620 7468 6520 6272  cution of the br
+00001b00: 6963 6b0a 2020 2020 2020 2020 7365 6c66  ick.        self
+00001b10: 2e72 6571 7569 7265 6d65 6e74 203d 205b  .requirement = [
+00001b20: 5d0a 0a20 2020 2020 2020 2023 2049 6e70  ]..        # Inp
+00001b30: 7574 7320 6465 7363 7269 7074 696f 6e0a  uts description.
+00001b40: 2020 2020 2020 2020 696e 5f66 696c 655f          in_file_
+00001b50: 6465 7363 203d 2022 416e 2065 7869 7374  desc = "An exist
+00001b60: 696e 6720 7061 7468 2066 696c 652e 220a  ing path file.".
+00001b70: 2020 2020 2020 2020 6865 6164 5f6d 6173          head_mas
+00001b80: 6b5f 6465 7363 203d 2022 416e 2065 7869  k_desc = "An exi
+00001b90: 7374 696e 6720 7061 7468 2066 696c 652e  sting path file.
+00001ba0: 220a 2020 2020 2020 2020 726f 745f 6d61  ".        rot_ma
+00001bb0: 736b 5f64 6573 6320 3d20 2241 6e20 6578  sk_desc = "An ex
+00001bc0: 6973 7469 6e67 2070 6174 6820 6669 6c65  isting path file
+00001bd0: 2e22 0a20 2020 2020 2020 206e 6173 696f  .".        nasio
+00001be0: 6e5f 706f 7374 5f6d 6173 6b5f 6465 7363  n_post_mask_desc
+00001bf0: 203d 2022 416e 2065 7869 7374 696e 6720   = "An existing 
+00001c00: 7061 7468 2066 696c 652e 220a 2020 2020  path file.".    
+00001c10: 2020 2020 7375 6666 6978 5f64 6573 6320      suffix_desc 
+00001c20: 3d20 2253 7566 6669 7820 6f66 2074 6865  = "Suffix of the
+00001c30: 206f 7574 7075 7420 696d 6167 6520 2861   output image (a
+00001c40: 2073 7472 696e 6729 2e22 0a0a 2020 2020   string)."..    
+00001c50: 2020 2020 2320 4f75 7470 7574 7320 6465      # Outputs de
+00001c60: 7363 7269 7074 696f 6e0a 2020 2020 2020  scription.      
+00001c70: 2020 6f75 745f 6861 745f 6d61 736b 5f64    out_hat_mask_d
+00001c80: 6573 6320 3d20 280a 2020 2020 2020 2020  esc = (.        
+00001c90: 2020 2020 2250 6174 6820 6f66 2074 6865      "Path of the
+00001ca0: 206f 7574 7075 7474 6564 2061 6972 206d   outputted air m
+00001cb0: 6173 6b20 220a 2020 2020 2020 2020 2020  ask ".          
+00001cc0: 2020 2228 6120 7061 7468 6c69 6b65 206f    "(a pathlike o
+00001cd0: 626a 6563 7420 6f72 2073 7472 696e 6722  bject or string"
+00001ce0: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
+00001cf0: 7072 6573 656e 7469 6e67 2061 2066 696c  presenting a fil
+00001d00: 6529 2e22 0a20 2020 2020 2020 2029 0a20  e).".        ). 
+00001d10: 2020 2020 2020 206f 7574 5f61 7274 5f6d         out_art_m
+00001d20: 6173 6b5f 6465 7363 203d 2028 0a20 2020  ask_desc = (.   
+00001d30: 2020 2020 2020 2020 2022 5061 7468 206f           "Path o
+00001d40: 6620 7468 6520 6f75 7470 7574 7465 6420  f the outputted 
+00001d50: 6172 7469 6661 6374 206d 6173 6b20 220a  artifact mask ".
+00001d60: 2020 2020 2020 2020 2020 2020 2228 6120              "(a 
+00001d70: 7061 7468 6c69 6b65 206f 626a 6563 7420  pathlike object 
+00001d80: 6f72 2073 7472 696e 6722 0a20 2020 2020  or string".     
+00001d90: 2020 2020 2020 2022 7265 7072 6573 656e         "represen
+00001da0: 7469 6e67 2061 2066 696c 6529 2e22 0a20  ting a file).". 
+00001db0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00001dc0: 206f 7574 5f61 6972 5f6d 6173 6b5f 6465   out_air_mask_de
+00001dd0: 7363 203d 2028 0a20 2020 2020 2020 2020  sc = (.         
+00001de0: 2020 2022 5061 7468 206f 6620 7468 6520     "Path of the 
+00001df0: 6f75 7470 7574 7465 6420 6169 7220 6d61  outputted air ma
+00001e00: 736b 2022 0a20 2020 2020 2020 2020 2020  sk ".           
+00001e10: 2022 2861 2070 6174 686c 696b 6520 6f62   "(a pathlike ob
+00001e20: 6a65 6374 206f 7220 7374 7269 6e67 220a  ject or string".
+00001e30: 2020 2020 2020 2020 2020 2020 2272 6570              "rep
+00001e40: 7265 7365 6e74 696e 6720 6120 6669 6c65  resenting a file
+00001e50: 292e 220a 2020 2020 2020 2020 290a 0a20  ).".        ).. 
+00001e60: 2020 2020 2020 2023 2049 6e70 7574 7320         # Inputs 
+00001e70: 7472 6169 7473 0a20 2020 2020 2020 2073  traits.        s
+00001e80: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
+00001e90: 2020 2020 2020 2020 2020 2022 696e 5f66             "in_f
+00001ea0: 696c 6522 2c20 4669 6c65 286f 7574 7075  ile", File(outpu
+00001eb0: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
+00001ec0: 6c3d 4661 6c73 652c 2064 6573 633d 696e  l=False, desc=in
+00001ed0: 5f66 696c 655f 6465 7363 290a 2020 2020  _file_desc).    
+00001ee0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+00001ef0: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
+00001f00: 2020 2020 2020 2020 2020 2022 6865 6164             "head
+00001f10: 5f6d 6173 6b22 2c0a 2020 2020 2020 2020  _mask",.        
+00001f20: 2020 2020 4669 6c65 286f 7574 7075 743d      File(output=
+00001f30: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+00001f40: 4661 6c73 652c 2064 6573 633d 6865 6164  False, desc=head
+00001f50: 5f6d 6173 6b5f 6465 7363 292c 0a20 2020  _mask_desc),.   
+00001f60: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00001f70: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+00001f80: 2020 2020 2020 2020 2020 2020 226e 6173              "nas
+00001f90: 696f 6e5f 706f 7374 5f6d 6173 6b22 2c0a  ion_post_mask",.
+00001fa0: 2020 2020 2020 2020 2020 2020 4669 6c65              File
+00001fb0: 286f 7574 7075 743d 4661 6c73 652c 206f  (output=False, o
+00001fc0: 7074 696f 6e61 6c3d 4661 6c73 652c 2064  ptional=False, d
+00001fd0: 6573 633d 6e61 7369 6f6e 5f70 6f73 745f  esc=nasion_post_
+00001fe0: 6d61 736b 5f64 6573 6329 2c0a 2020 2020  mask_desc),.    
+00001ff0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+00002000: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
+00002010: 2020 2020 2020 2020 2020 2022 726f 745f             "rot_
+00002020: 6d61 736b 222c 0a20 2020 2020 2020 2020  mask",.         
+00002030: 2020 2046 696c 6528 0a20 2020 2020 2020     File(.       
+00002040: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00002050: 3d4e 6f6e 652c 206f 7574 7075 743d 4661  =None, output=Fa
+00002060: 6c73 652c 206f 7074 696f 6e61 6c3d 5472  lse, optional=Tr
+00002070: 7565 2c20 6465 7363 3d72 6f74 5f6d 6173  ue, desc=rot_mas
+00002080: 6b5f 6465 7363 0a20 2020 2020 2020 2020  k_desc.         
+00002090: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+000020a0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+000020b0: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+000020c0: 2020 2020 2022 7375 6666 6978 222c 0a20       "suffix",. 
+000020d0: 2020 2020 2020 2020 2020 2074 7261 6974             trait
+000020e0: 732e 5374 7269 6e67 280a 2020 2020 2020  s.String(.      
+000020f0: 2020 2020 2020 2020 2020 225f 6d61 736b            "_mask
+00002100: 222c 206f 7574 7075 743d 4661 6c73 652c  ", output=False,
+00002110: 206f 7074 696f 6e61 6c3d 5472 7565 2c20   optional=True, 
+00002120: 6465 7363 3d73 7566 6669 785f 6465 7363  desc=suffix_desc
+00002130: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00002140: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00002150: 2020 2023 204f 7574 7075 7473 2074 7261     # Outputs tra
+00002160: 6974 730a 2020 2020 2020 2020 7365 6c66  its.        self
+00002170: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
+00002180: 2020 2020 2020 2020 226f 7574 5f68 6174          "out_hat
+00002190: 5f6d 6173 6b22 2c20 4669 6c65 286f 7574  _mask", File(out
+000021a0: 7075 743d 5472 7565 2c20 6465 7363 3d6f  put=True, desc=o
+000021b0: 7574 5f68 6174 5f6d 6173 6b5f 6465 7363  ut_hat_mask_desc
+000021c0: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
+000021d0: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+000021e0: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+000021f0: 2022 6f75 745f 6172 745f 6d61 736b 222c   "out_art_mask",
+00002200: 2046 696c 6528 6f75 7470 7574 3d54 7275   File(output=Tru
+00002210: 652c 2064 6573 633d 6f75 745f 6172 745f  e, desc=out_art_
+00002220: 6d61 736b 5f64 6573 6329 0a20 2020 2020  mask_desc).     
+00002230: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+00002240: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
+00002250: 2020 2020 2020 2020 2020 226f 7574 5f61            "out_a
+00002260: 6972 5f6d 6173 6b22 2c20 4669 6c65 286f  ir_mask", File(o
+00002270: 7574 7075 743d 5472 7565 2c20 6465 7363  utput=True, desc
+00002280: 3d6f 7574 5f61 6972 5f6d 6173 6b5f 6465  =out_air_mask_de
+00002290: 7363 290a 2020 2020 2020 2020 290a 0a20  sc).        ).. 
+000022a0: 2020 2020 2020 2073 656c 662e 696e 6974         self.init
+000022b0: 5f64 6566 6175 6c74 5f74 7261 6974 7328  _default_traits(
+000022c0: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
+000022d0: 6f75 7470 7574 7328 7365 6c66 2c20 6973  outputs(self, is
+000022e0: 5f70 6c75 6767 6564 3d4e 6f6e 6529 3a0a  _plugged=None):.
+000022f0: 2020 2020 2020 2020 2222 2244 6564 6963          """Dedic
+00002300: 6174 6564 2074 6f20 7468 6520 696e 6974  ated to the init
+00002310: 6961 6c69 7361 7469 6f6e 2073 7465 7020  ialisation step 
+00002320: 6f66 2074 6865 2062 7269 636b 2e0a 0a20  of the brick... 
+00002330: 2020 2020 2020 2054 6865 206d 6169 6e20         The main 
+00002340: 6f62 6a65 6374 6976 6520 6f66 2074 6869  objective of thi
+00002350: 7320 6d65 7468 6f64 2069 7320 746f 2070  s method is to p
+00002360: 726f 6475 6365 2074 6865 206f 7574 7075  roduce the outpu
+00002370: 7473 206f 6620 7468 650a 2020 2020 2020  ts of the.      
+00002380: 2020 6272 6963 6b73 2028 7365 6c66 2e6f    bricks (self.o
+00002390: 7574 7075 7473 2920 616e 6420 7468 6520  utputs) and the 
+000023a0: 6173 736f 6369 6174 6564 2074 6167 7320  associated tags 
+000023b0: 2873 656c 662e 696e 6865 7269 7461 6e63  (self.inheritanc
+000023c0: 655f 6469 6329 2c0a 2020 2020 2020 2020  e_dic),.        
+000023d0: 6966 2064 6566 696e 6564 2068 6572 652e  if defined here.
+000023e0: 2054 6f20 776f 726b 2070 726f 7065 726c   To work properl
+000023f0: 7920 7468 6973 206d 6574 686f 6420 6d75  y this method mu
+00002400: 7374 2072 6574 7572 6e0a 2020 2020 2020  st return.      
+00002410: 2020 7365 6c66 2e6d 616b 655f 696e 6974    self.make_init
+00002420: 5265 7375 6c74 2829 206f 626a 6563 742e  Result() object.
+00002430: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00002440: 2069 735f 706c 7567 6765 643a 2074 6865   is_plugged: the
+00002450: 2073 7461 7465 2c20 6c69 6e6b 6564 206f   state, linked o
+00002460: 7220 6e6f 742c 206f 6620 7468 6520 706c  r not, of the pl
+00002470: 7567 732e 0a20 2020 2020 2020 203a 7265  ugs..        :re
+00002480: 7475 726e 733a 2061 2064 6963 7469 6f6e  turns: a diction
+00002490: 6172 7920 7769 7468 2072 6571 7569 7265  ary with require
+000024a0: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
+000024b0: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
+000024c0: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+000024d0: 2020 2020 2020 2020 2320 5573 696e 6720          # Using 
+000024e0: 7468 6520 696e 6865 7269 7461 6e63 6520  the inheritance 
+000024f0: 746f 2050 726f 6365 7373 4d49 4120 636c  to ProcessMIA cl
+00002500: 6173 732c 206c 6973 745f 6f75 7470 7574  ass, list_output
+00002510: 7320 6d65 7468 6f64 0a20 2020 2020 2020  s method.       
+00002520: 2073 7570 6572 2841 7274 6966 6163 744d   super(ArtifactM
+00002530: 6173 6b2c 2073 656c 6629 2e6c 6973 745f  ask, self).list_
+00002540: 6f75 7470 7574 7328 290a 0a20 2020 2020  outputs()..     
+00002550: 2020 2023 204f 7574 7075 7473 2064 6566     # Outputs def
+00002560: 696e 6974 696f 6e0a 2020 2020 2020 2020  inition.        
+00002570: 6966 2073 656c 662e 696e 5f66 696c 653a  if self.in_file:
+00002580: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002590: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000025a0: 2020 286e 6f74 2073 656c 662e 7375 6666    (not self.suff
+000025b0: 6978 290a 2020 2020 2020 2020 2020 2020  ix).            
+000025c0: 2020 2020 6f72 2028 7365 6c66 2e73 7566      or (self.suf
+000025d0: 6669 782e 6973 7370 6163 6528 2929 0a20  fix.isspace()). 
+000025e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000025f0: 7220 7365 6c66 2e73 7566 6669 7820 696e  r self.suffix in
+00002600: 205b 556e 6465 6669 6e65 642c 2022 3c75   [Undefined, "<u
+00002610: 6e64 6566 696e 6564 3e22 5d0a 2020 2020  ndefined>"].    
+00002620: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00002630: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00002640: 7375 6666 6978 203d 2022 2022 0a0a 2020  suffix = " "..  
+00002650: 2020 2020 2020 2020 2020 6669 6c65 5f68            file_h
+00002660: 6174 203d 2022 220a 2020 2020 2020 2020  at = "".        
+00002670: 2020 2020 6669 6c65 5f61 7274 203d 2022      file_art = "
+00002680: 220a 2020 2020 2020 2020 2020 2020 6669  ".            fi
+00002690: 6c65 5f61 6972 203d 2022 220a 0a20 2020  le_air = ""..   
+000026a0: 2020 2020 2020 2020 2076 616c 6964 5f65           valid_e
+000026b0: 7874 2c20 696e 5f65 7874 2c20 6669 6c65  xt, in_ext, file
+000026c0: 4e61 6d65 203d 2063 6865 636b 4669 6c65  Name = checkFile
+000026d0: 4578 7428 7365 6c66 2e69 6e5f 6669 6c65  Ext(self.in_file
+000026e0: 2c20 4558 5429 0a0a 2020 2020 2020 2020  , EXT)..        
+000026f0: 2020 2020 6966 206e 6f74 2076 616c 6964      if not valid
+00002700: 5f65 7874 3a0a 2020 2020 2020 2020 2020  _ext:.          
+00002710: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
 00002720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002730: 2020 2020 2272 6563 6f67 6e69 7a65 642e      "recognized.
-00002740: 2e2e 2122 0a20 2020 2020 2020 2020 2020  ..!".           
-00002750: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00002760: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-00002770: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00002780: 6861 7420 3d20 6f73 2e70 6174 682e 6a6f  hat = os.path.jo
-00002790: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
-000027a0: 2020 2020 7365 6c66 2e6f 7574 7075 745f      self.output_
-000027b0: 6469 7265 6374 6f72 792c 0a20 2020 2020  directory,.     
-000027c0: 2020 2020 2020 2020 2020 2028 2268 6174             ("hat
-000027d0: 5f22 202b 2066 696c 654e 616d 6520 2b20  _" + fileName + 
-000027e0: 7365 6c66 2e73 7566 6669 782e 7374 7269  self.suffix.stri
-000027f0: 7028 2920 2b20 222e 2220 2b20 696e 5f65  p() + "." + in_e
-00002800: 7874 292c 0a20 2020 2020 2020 2020 2020  xt),.           
-00002810: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00002820: 6669 6c65 5f61 7274 203d 206f 732e 7061  file_art = os.pa
-00002830: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
-00002840: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
-00002850: 7470 7574 5f64 6972 6563 746f 7279 2c0a  tput_directory,.
-00002860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002870: 2822 6172 745f 2220 2b20 6669 6c65 4e61  ("art_" + fileNa
-00002880: 6d65 202b 2073 656c 662e 7375 6666 6978  me + self.suffix
-00002890: 2e73 7472 6970 2829 202b 2022 2e22 202b  .strip() + "." +
-000028a0: 2069 6e5f 6578 7429 2c0a 2020 2020 2020   in_ext),.      
-000028b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000028c0: 2020 2020 2066 696c 655f 6169 7220 3d20       file_air = 
-000028d0: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
-000028e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000028f0: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
-00002900: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-00002910: 2020 2020 2028 2261 6972 5f22 202b 2066       ("air_" + f
-00002920: 696c 654e 616d 6520 2b20 7365 6c66 2e73  ileName + self.s
-00002930: 7566 6669 782e 7374 7269 7028 2920 2b20  uffix.strip() + 
-00002940: 222e 2220 2b20 696e 5f65 7874 292c 0a20  "." + in_ext),. 
-00002950: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00002960: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-00002970: 7574 7075 7473 5b22 6f75 745f 6861 745f  utputs["out_hat_
-00002980: 6d61 736b 225d 203d 2066 696c 655f 6861  mask"] = file_ha
-00002990: 740a 2020 2020 2020 2020 2020 2020 7365  t.            se
-000029a0: 6c66 2e6f 7574 7075 7473 5b22 6f75 745f  lf.outputs["out_
-000029b0: 6172 745f 6d61 736b 225d 203d 2066 696c  art_mask"] = fil
-000029c0: 655f 6172 740a 2020 2020 2020 2020 2020  e_art.          
-000029d0: 2020 7365 6c66 2e6f 7574 7075 7473 5b22    self.outputs["
-000029e0: 6f75 745f 6169 725f 6d61 736b 225d 203d  out_air_mask"] =
-000029f0: 2066 696c 655f 6169 720a 0a20 2020 2020   file_air..     
-00002a00: 2020 2020 2020 2023 2074 6167 7320 696e         # tags in
-00002a10: 6865 7269 7461 6e63 6520 286f 7074 696f  heritance (optio
-00002a20: 6e61 6c29 0a20 2020 2020 2020 2020 2020  nal).           
-00002a30: 2069 6620 7365 6c66 2e6f 7574 7075 7473   if self.outputs
-00002a40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002a50: 2020 666f 7220 6b20 696e 2028 226f 7574    for k in ("out
-00002a60: 5f68 6174 5f6d 6173 6b22 2c20 226f 7574  _hat_mask", "out
-00002a70: 5f61 7274 5f6d 6173 6b22 2c20 226f 7574  _art_mask", "out
-00002a80: 5f61 6972 5f6d 6173 6b22 293a 0a20 2020  _air_mask"):.   
-00002a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002aa0: 2073 656c 662e 7461 6773 5f69 6e68 6572   self.tags_inher
-00002ab0: 6974 616e 6365 280a 2020 2020 2020 2020  itance(.        
-00002ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ad0: 696e 5f66 696c 653d 7365 6c66 2e69 6e5f  in_file=self.in_
-00002ae0: 6669 6c65 2c0a 2020 2020 2020 2020 2020  file,.          
-00002af0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00002b00: 745f 6669 6c65 3d73 656c 662e 6f75 7470  t_file=self.outp
-00002b10: 7574 735b 6b5d 2c0a 2020 2020 2020 2020  uts[k],.        
-00002b20: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00002b30: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
-00002b40: 7468 6520 7265 7175 6972 656d 656e 742c  the requirement,
-00002b50: 206f 7574 7075 7473 2061 6e64 2069 6e68   outputs and inh
-00002b60: 6572 6974 616e 6365 5f64 6963 740a 2020  eritance_dict.  
-00002b70: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00002b80: 662e 6d61 6b65 5f69 6e69 7452 6573 756c  f.make_initResul
-00002b90: 7428 290a 0a20 2020 2064 6566 2072 756e  t()..    def run
-00002ba0: 5f70 726f 6365 7373 5f6d 6961 2873 656c  _process_mia(sel
-00002bb0: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
-00002bc0: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
-00002bd0: 7072 6f63 6573 7320 6c61 756e 6368 2073  process launch s
-00002be0: 7465 7020 6f66 2074 6865 2062 7269 636b  tep of the brick
-00002bf0: 2e22 2222 0a20 2020 2020 2020 2073 7570  .""".        sup
-00002c00: 6572 2841 7274 6966 6163 744d 6173 6b2c  er(ArtifactMask,
-00002c10: 2073 656c 6629 2e72 756e 5f70 726f 6365   self).run_proce
-00002c20: 7373 5f6d 6961 2829 0a0a 2020 2020 2020  ss_mia()..      
-00002c30: 2020 6669 6c65 5f6e 616d 6520 3d20 7365    file_name = se
-00002c40: 6c66 2e69 6e5f 6669 6c65 0a20 2020 2020  lf.in_file.     
-00002c50: 2020 2068 6561 645f 6d61 736b 5f6e 616d     head_mask_nam
-00002c60: 6520 3d20 7365 6c66 2e68 6561 645f 6d61  e = self.head_ma
-00002c70: 736b 0a20 2020 2020 2020 2072 6f74 5f6d  sk.        rot_m
-00002c80: 6173 6b5f 6e61 6d65 203d 2073 656c 662e  ask_name = self.
-00002c90: 726f 745f 6d61 736b 0a20 2020 2020 2020  rot_mask.       
-00002ca0: 206e 6173 696f 6e5f 706f 7374 5f6d 6173   nasion_post_mas
-00002cb0: 6b5f 6e61 6d65 203d 2073 656c 662e 6e61  k_name = self.na
-00002cc0: 7369 6f6e 5f70 6f73 745f 6d61 736b 0a0a  sion_post_mask..
-00002cd0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00002ce0: 2020 2020 2020 2020 2069 6d6e 6969 203d           imnii =
-00002cf0: 206e 6962 2e6c 6f61 6428 6669 6c65 5f6e   nib.load(file_n
-00002d00: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00002d10: 2068 6d6e 6969 203d 206e 6962 2e6c 6f61   hmnii = nib.loa
-00002d20: 6428 6865 6164 5f6d 6173 6b5f 6e61 6d65  d(head_mask_name
-00002d30: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00002d40: 2072 6f74 5f6d 6173 6b5f 6e61 6d65 3a0a   rot_mask_name:.
-00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d60: 726d 6e69 6920 3d20 6e69 622e 6c6f 6164  rmnii = nib.load
-00002d70: 2872 6f74 5f6d 6173 6b5f 6e61 6d65 290a  (rot_mask_name).
-00002d80: 2020 2020 2020 2020 2020 2020 6e70 6d6e              npmn
-00002d90: 6969 203d 206e 6962 2e6c 6f61 6428 6e61  ii = nib.load(na
-00002da0: 7369 6f6e 5f70 6f73 745f 6d61 736b 5f6e  sion_post_mask_n
-00002db0: 616d 6529 0a0a 2020 2020 2020 2020 6578  ame)..        ex
-00002dc0: 6365 7074 2028 0a20 2020 2020 2020 2020  cept (.         
-00002dd0: 2020 206e 6962 2e66 696c 6562 6173 6564     nib.filebased
-00002de0: 696d 6167 6573 2e49 6d61 6765 4669 6c65  images.ImageFile
-00002df0: 4572 726f 722c 0a20 2020 2020 2020 2020  Error,.         
-00002e00: 2020 2046 696c 654e 6f74 466f 756e 6445     FileNotFoundE
-00002e10: 7272 6f72 2c0a 2020 2020 2020 2020 2020  rror,.          
-00002e20: 2020 5479 7065 4572 726f 722c 0a20 2020    TypeError,.   
-00002e30: 2020 2020 2029 2061 7320 653a 0a20 2020       ) as e:.   
-00002e40: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00002e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e60: 225c 6e41 7274 6966 6163 744d 6173 6b20  "\nArtifactMask 
-00002e70: 6272 6963 6b3a 2045 7272 6f72 2077 6974  brick: Error wit
-00002e80: 6820 6669 6c65 7320 746f 206d 6173 6b2c  h files to mask,
-00002e90: 2064 7572 696e 6720 220a 2020 2020 2020   during ".      
-00002ea0: 2020 2020 2020 2020 2020 2269 6e69 7469            "initi
-00002eb0: 616c 6973 6174 696f 6e3a 2022 2c0a 2020  alisation: ",.  
-00002ec0: 2020 2020 2020 2020 2020 2020 2020 652c                e,
-00002ed0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00002ee0: 2020 2020 2020 2020 2020 2069 6d6e 6969             imnii
-00002ef0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00002f00: 2020 2020 686d 6e69 6920 3d20 4e6f 6e65      hmnii = None
-00002f10: 0a20 2020 2020 2020 2020 2020 2072 6d6e  .            rmn
-00002f20: 6969 203d 204e 6f6e 650a 2020 2020 2020  ii = None.      
-00002f30: 2020 2020 2020 6e70 6d6e 6969 203d 204e        npmnii = N
-00002f40: 6f6e 650a 0a20 2020 2020 2020 2069 6620  one..        if 
-00002f50: 280a 2020 2020 2020 2020 2020 2020 2869  (.            (i
-00002f60: 6d6e 6969 2069 7320 6e6f 7420 4e6f 6e65  mnii is not None
-00002f70: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
-00002f80: 6420 2868 6d6e 6969 2069 7320 6e6f 7420  d (hmnii is not 
-00002f90: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00002fa0: 2020 616e 6420 2872 6d6e 6969 2069 7320    and (rmnii is 
+00002730: 2022 5c6e 4172 7469 6661 6374 4d61 736b   "\nArtifactMask
+00002740: 2062 7269 636b 3a20 5468 6520 696e 7075   brick: The inpu
+00002750: 7420 696d 6167 6520 666f 726d 6174 2069  t image format i
+00002760: 7320 6e6f 7420 220a 2020 2020 2020 2020  s not ".        
+00002770: 2020 2020 2020 2020 2020 2020 2272 6563              "rec
+00002780: 6f67 6e69 7a65 642e 2e2e 2122 0a20 2020  ognized...!".   
+00002790: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000027a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000027b0: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
+000027c0: 2020 2066 696c 655f 6861 7420 3d20 6f73     file_hat = os
+000027d0: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
+000027e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000027f0: 2e6f 7574 7075 745f 6469 7265 6374 6f72  .output_director
+00002800: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00002810: 2020 2028 2268 6174 5f22 202b 2066 696c     ("hat_" + fil
+00002820: 654e 616d 6520 2b20 7365 6c66 2e73 7566  eName + self.suf
+00002830: 6669 782e 7374 7269 7028 2920 2b20 222e  fix.strip() + ".
+00002840: 2220 2b20 696e 5f65 7874 292c 0a20 2020  " + in_ext),.   
+00002850: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00002860: 2020 2020 2020 2020 6669 6c65 5f61 7274          file_art
+00002870: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00002880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002890: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
+000028a0: 6563 746f 7279 2c0a 2020 2020 2020 2020  ectory,.        
+000028b0: 2020 2020 2020 2020 2822 6172 745f 2220          ("art_" 
+000028c0: 2b20 6669 6c65 4e61 6d65 202b 2073 656c  + fileName + sel
+000028d0: 662e 7375 6666 6978 2e73 7472 6970 2829  f.suffix.strip()
+000028e0: 202b 2022 2e22 202b 2069 6e5f 6578 7429   + "." + in_ext)
+000028f0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00002900: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00002910: 655f 6169 7220 3d20 6f73 2e70 6174 682e  e_air = os.path.
+00002920: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
+00002930: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+00002940: 745f 6469 7265 6374 6f72 792c 0a20 2020  t_directory,.   
+00002950: 2020 2020 2020 2020 2020 2020 2028 2261               ("a
+00002960: 6972 5f22 202b 2066 696c 654e 616d 6520  ir_" + fileName 
+00002970: 2b20 7365 6c66 2e73 7566 6669 782e 7374  + self.suffix.st
+00002980: 7269 7028 2920 2b20 222e 2220 2b20 696e  rip() + "." + in
+00002990: 5f65 7874 292c 0a20 2020 2020 2020 2020  _ext),.         
+000029a0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+000029b0: 2020 7365 6c66 2e6f 7574 7075 7473 5b22    self.outputs["
+000029c0: 6f75 745f 6861 745f 6d61 736b 225d 203d  out_hat_mask"] =
+000029d0: 2066 696c 655f 6861 740a 2020 2020 2020   file_hat.      
+000029e0: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+000029f0: 7473 5b22 6f75 745f 6172 745f 6d61 736b  ts["out_art_mask
+00002a00: 225d 203d 2066 696c 655f 6172 740a 2020  "] = file_art.  
+00002a10: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+00002a20: 7574 7075 7473 5b22 6f75 745f 6169 725f  utputs["out_air_
+00002a30: 6d61 736b 225d 203d 2066 696c 655f 6169  mask"] = file_ai
+00002a40: 720a 0a20 2020 2020 2020 2020 2020 2023  r..            #
+00002a50: 2074 6167 7320 696e 6865 7269 7461 6e63   tags inheritanc
+00002a60: 6520 286f 7074 696f 6e61 6c29 0a20 2020  e (optional).   
+00002a70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00002a80: 2e6f 7574 7075 7473 3a0a 2020 2020 2020  .outputs:.      
+00002a90: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
+00002aa0: 696e 2028 226f 7574 5f68 6174 5f6d 6173  in ("out_hat_mas
+00002ab0: 6b22 2c20 226f 7574 5f61 7274 5f6d 6173  k", "out_art_mas
+00002ac0: 6b22 2c20 226f 7574 5f61 6972 5f6d 6173  k", "out_air_mas
+00002ad0: 6b22 293a 0a20 2020 2020 2020 2020 2020  k"):.           
+00002ae0: 2020 2020 2020 2020 2073 656c 662e 7461           self.ta
+00002af0: 6773 5f69 6e68 6572 6974 616e 6365 280a  gs_inheritance(.
+00002b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b10: 2020 2020 2020 2020 696e 5f66 696c 653d          in_file=
+00002b20: 7365 6c66 2e69 6e5f 6669 6c65 2c0a 2020  self.in_file,.  
+00002b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b40: 2020 2020 2020 6f75 745f 6669 6c65 3d73        out_file=s
+00002b50: 656c 662e 6f75 7470 7574 735b 6b5d 2c0a  elf.outputs[k],.
+00002b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b70: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00002b80: 2052 6574 7572 6e20 7468 6520 7265 7175   Return the requ
+00002b90: 6972 656d 656e 742c 206f 7574 7075 7473  irement, outputs
+00002ba0: 2061 6e64 2069 6e68 6572 6974 616e 6365   and inheritance
+00002bb0: 5f64 6963 740a 2020 2020 2020 2020 7265  _dict.        re
+00002bc0: 7475 726e 2073 656c 662e 6d61 6b65 5f69  turn self.make_i
+00002bd0: 6e69 7452 6573 756c 7428 290a 0a20 2020  nitResult()..   
+00002be0: 2064 6566 2072 756e 5f70 726f 6365 7373   def run_process
+00002bf0: 5f6d 6961 2873 656c 6629 3a0a 2020 2020  _mia(self):.    
+00002c00: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
+00002c10: 2074 6f20 7468 6520 7072 6f63 6573 7320   to the process 
+00002c20: 6c61 756e 6368 2073 7465 7020 6f66 2074  launch step of t
+00002c30: 6865 2062 7269 636b 2e22 2222 0a20 2020  he brick.""".   
+00002c40: 2020 2020 2073 7570 6572 2841 7274 6966       super(Artif
+00002c50: 6163 744d 6173 6b2c 2073 656c 6629 2e72  actMask, self).r
+00002c60: 756e 5f70 726f 6365 7373 5f6d 6961 2829  un_process_mia()
+00002c70: 0a0a 2020 2020 2020 2020 6669 6c65 5f6e  ..        file_n
+00002c80: 616d 6520 3d20 7365 6c66 2e69 6e5f 6669  ame = self.in_fi
+00002c90: 6c65 0a20 2020 2020 2020 2068 6561 645f  le.        head_
+00002ca0: 6d61 736b 5f6e 616d 6520 3d20 7365 6c66  mask_name = self
+00002cb0: 2e68 6561 645f 6d61 736b 0a20 2020 2020  .head_mask.     
+00002cc0: 2020 2072 6f74 5f6d 6173 6b5f 6e61 6d65     rot_mask_name
+00002cd0: 203d 2073 656c 662e 726f 745f 6d61 736b   = self.rot_mask
+00002ce0: 0a20 2020 2020 2020 206e 6173 696f 6e5f  .        nasion_
+00002cf0: 706f 7374 5f6d 6173 6b5f 6e61 6d65 203d  post_mask_name =
+00002d00: 2073 656c 662e 6e61 7369 6f6e 5f70 6f73   self.nasion_pos
+00002d10: 745f 6d61 736b 0a0a 2020 2020 2020 2020  t_mask..        
+00002d20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00002d30: 2069 6d6e 6969 203d 206e 6962 2e6c 6f61   imnii = nib.loa
+00002d40: 6428 6669 6c65 5f6e 616d 6529 0a20 2020  d(file_name).   
+00002d50: 2020 2020 2020 2020 2068 6d6e 6969 203d           hmnii =
+00002d60: 206e 6962 2e6c 6f61 6428 6865 6164 5f6d   nib.load(head_m
+00002d70: 6173 6b5f 6e61 6d65 290a 2020 2020 2020  ask_name).      
+00002d80: 2020 2020 2020 6966 2072 6f74 5f6d 6173        if rot_mas
+00002d90: 6b5f 6e61 6d65 3a0a 2020 2020 2020 2020  k_name:.        
+00002da0: 2020 2020 2020 2020 726d 6e69 6920 3d20          rmnii = 
+00002db0: 6e69 622e 6c6f 6164 2872 6f74 5f6d 6173  nib.load(rot_mas
+00002dc0: 6b5f 6e61 6d65 290a 2020 2020 2020 2020  k_name).        
+00002dd0: 2020 2020 6e70 6d6e 6969 203d 206e 6962      npmnii = nib
+00002de0: 2e6c 6f61 6428 6e61 7369 6f6e 5f70 6f73  .load(nasion_pos
+00002df0: 745f 6d61 736b 5f6e 616d 6529 0a0a 2020  t_mask_name)..  
+00002e00: 2020 2020 2020 6578 6365 7074 2028 0a20        except (. 
+00002e10: 2020 2020 2020 2020 2020 206e 6962 2e66             nib.f
+00002e20: 696c 6562 6173 6564 696d 6167 6573 2e49  ilebasedimages.I
+00002e30: 6d61 6765 4669 6c65 4572 726f 722c 0a20  mageFileError,. 
+00002e40: 2020 2020 2020 2020 2020 2046 696c 654e             FileN
+00002e50: 6f74 466f 756e 6445 7272 6f72 2c0a 2020  otFoundError,.  
+00002e60: 2020 2020 2020 2020 2020 5479 7065 4572            TypeEr
+00002e70: 726f 722c 0a20 2020 2020 2020 2029 2061  ror,.        ) a
+00002e80: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00002e90: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+00002ea0: 2020 2020 2020 2020 225c 6e41 7274 6966          "\nArtif
+00002eb0: 6163 744d 6173 6b20 6272 6963 6b3a 2045  actMask brick: E
+00002ec0: 7272 6f72 2077 6974 6820 6669 6c65 7320  rror with files 
+00002ed0: 746f 206d 6173 6b2c 2064 7572 696e 6720  to mask, during 
+00002ee0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00002ef0: 2020 2269 6e69 7469 616c 6973 6174 696f    "initialisatio
+00002f00: 6e3a 2022 2c0a 2020 2020 2020 2020 2020  n: ",.          
+00002f10: 2020 2020 2020 652c 0a20 2020 2020 2020        e,.       
+00002f20: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00002f30: 2020 2069 6d6e 6969 203d 204e 6f6e 650a     imnii = None.
+00002f40: 2020 2020 2020 2020 2020 2020 686d 6e69              hmni
+00002f50: 6920 3d20 4e6f 6e65 0a20 2020 2020 2020  i = None.       
+00002f60: 2020 2020 2072 6d6e 6969 203d 204e 6f6e       rmnii = Non
+00002f70: 650a 2020 2020 2020 2020 2020 2020 6e70  e.            np
+00002f80: 6d6e 6969 203d 204e 6f6e 650a 0a20 2020  mnii = None..   
+00002f90: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+00002fa0: 2020 2020 2020 2869 6d6e 6969 2069 7320        (imnii is 
 00002fb0: 6e6f 7420 4e6f 6e65 290a 2020 2020 2020  not None).      
-00002fc0: 2020 2020 2020 616e 6420 286e 706d 6e69        and (npmni
-00002fd0: 6920 6973 206e 6f74 204e 6f6e 6529 0a20  i is not None). 
-00002fe0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-00002ff0: 2020 2020 2020 696d 6461 7461 203d 206e        imdata = n
-00003000: 702e 6e61 6e5f 746f 5f6e 756d 2869 6d6e  p.nan_to_num(imn
-00003010: 6969 2e67 6574 5f66 6461 7461 2829 2e61  ii.get_fdata().a
-00003020: 7374 7970 6528 6e70 2e66 6c6f 6174 3332  stype(np.float32
-00003030: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00003040: 2320 5265 6d6f 7665 206e 6567 6174 6976  # Remove negativ
-00003050: 6520 7661 6c75 6573 0a20 2020 2020 2020  e values.       
-00003060: 2020 2020 2069 6d64 6174 615b 696d 6461       imdata[imda
-00003070: 7461 203c 2030 5d20 3d20 300a 0a20 2020  ta < 0] = 0..   
-00003080: 2020 2020 2020 2020 2068 6d64 6174 6120           hmdata 
-00003090: 3d20 6e70 2e61 7361 6e79 6172 7261 7928  = np.asanyarray(
-000030a0: 6e69 622e 6c6f 6164 2868 6561 645f 6d61  nib.load(head_ma
-000030b0: 736b 5f6e 616d 6529 2e64 6174 616f 626a  sk_name).dataobj
-000030c0: 290a 2020 2020 2020 2020 2020 2020 6e70  ).            np
-000030d0: 6461 7461 203d 206e 702e 6173 616e 7961  data = np.asanya
-000030e0: 7272 6179 286e 6962 2e6c 6f61 6428 6e61  rray(nib.load(na
-000030f0: 7369 6f6e 5f70 6f73 745f 6d61 736b 5f6e  sion_post_mask_n
-00003100: 616d 6529 2e64 6174 616f 626a 290a 0a20  ame).dataobj).. 
-00003110: 2020 2020 2020 2020 2020 2023 2049 6e76             # Inv
-00003120: 6572 7420 6865 6164 206d 6173 6b0a 2020  ert head mask.  
-00003130: 2020 2020 2020 2020 2020 6169 7264 6174            airdat
-00003140: 6120 3d20 6e70 2e6f 6e65 735f 6c69 6b65  a = np.ones_like
-00003150: 2868 6d64 6174 612c 2064 7479 7065 3d6e  (hmdata, dtype=n
-00003160: 702e 7569 6e74 3829 0a20 2020 2020 2020  p.uint8).       
-00003170: 2020 2020 2061 6972 6461 7461 5b68 6d64       airdata[hmd
-00003180: 6174 6120 3d3d 2031 5d20 3d20 300a 0a20  ata == 1] = 0.. 
-00003190: 2020 2020 2020 2020 2020 2023 2043 616c             # Cal
-000031a0: 6375 6c61 7465 2064 6973 7461 6e63 6520  culate distance 
-000031b0: 746f 2062 6f72 6465 720a 2020 2020 2020  to border.      
-000031c0: 2020 2020 2020 6469 7374 203d 2073 696d        dist = sim
-000031d0: 2e6d 6f72 7068 6f6c 6f67 792e 6469 7374  .morphology.dist
-000031e0: 616e 6365 5f74 7261 6e73 666f 726d 5f65  ance_transform_e
-000031f0: 6474 2861 6972 6461 7461 290a 0a20 2020  dt(airdata)..   
-00003200: 2020 2020 2020 2020 2023 2041 7070 6c79           # Apply
-00003210: 206e 6173 696f 6e2d 746f 2d70 6f73 7465   nasion-to-poste
-00003220: 7269 6f72 206d 6173 6b0a 2020 2020 2020  rior mask.      
-00003230: 2020 2020 2020 6169 7264 6174 615b 6e70        airdata[np
-00003240: 6461 7461 203d 3d20 315d 203d 2030 0a20  data == 1] = 0. 
-00003250: 2020 2020 2020 2020 2020 2064 6973 745b             dist[
-00003260: 6e70 6461 7461 203d 3d20 315d 203d 2030  npdata == 1] = 0
-00003270: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
-00003280: 7420 2f3d 2064 6973 742e 6d61 7828 290a  t /= dist.max().
-00003290: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
-000032a0: 7070 6c79 2072 6f74 6174 696f 6e20 6d61  pply rotation ma
-000032b0: 736b 2028 6966 2073 7570 706c 6965 6429  sk (if supplied)
-000032c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000032d0: 726f 745f 6d61 736b 5f6e 616d 6520 213d  rot_mask_name !=
-000032e0: 2055 6e64 6566 696e 6564 3a0a 2020 2020   Undefined:.    
-000032f0: 2020 2020 2020 2020 2020 2020 726f 746d              rotm
-00003300: 736b 6461 7461 203d 206e 702e 6173 616e  skdata = np.asan
-00003310: 7961 7272 6179 286e 6962 2e6c 6f61 6428  yarray(nib.load(
-00003320: 726f 745f 6d61 736b 5f6e 616d 6529 2e64  rot_mask_name).d
-00003330: 6174 616f 626a 290a 2020 2020 2020 2020  ataobj).        
-00003340: 2020 2020 2020 2020 6169 7264 6174 615b          airdata[
-00003350: 726f 746d 736b 6461 7461 203d 3d20 315d  rotmskdata == 1]
-00003360: 203d 2030 0a0a 2020 2020 2020 2020 2020   = 0..          
-00003370: 2020 2320 5275 6e20 7468 6520 6172 7469    # Run the arti
-00003380: 6661 6374 2064 6574 6563 7469 6f6e 0a20  fact detection. 
-00003390: 2020 2020 2020 2020 2020 2071 6931 5f69             qi1_i
-000033a0: 6d67 203d 2061 7274 6966 6163 745f 6d61  mg = artifact_ma
-000033b0: 736b 2869 6d64 6174 612c 2061 6972 6461  sk(imdata, airda
-000033c0: 7461 2c20 6469 7374 290a 2020 2020 2020  ta, dist).      
-000033d0: 2020 2020 2020 6864 7220 3d20 696d 6e69        hdr = imni
-000033e0: 692e 6865 6164 6572 2e63 6f70 7928 290a  i.header.copy().
-000033f0: 2020 2020 2020 2020 2020 2020 6864 722e              hdr.
-00003400: 7365 745f 6461 7461 5f64 7479 7065 286e  set_data_dtype(n
-00003410: 702e 7569 6e74 3829 0a0a 2020 2020 2020  p.uint8)..      
-00003420: 2020 2020 2020 2320 496d 6167 6520 7361        # Image sa
-00003430: 7665 0a20 2020 2020 2020 2020 2020 205f  ve.            _
-00003440: 2c20 6669 6c65 5f6e 616d 6520 3d20 6f73  , file_name = os
-00003450: 2e70 6174 682e 7370 6c69 7428 6669 6c65  .path.split(file
-00003460: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
-00003470: 2020 2066 696c 655f 6e61 6d65 5f6e 6f5f     file_name_no_
-00003480: 6578 742c 2066 696c 655f 6578 7465 6e73  ext, file_extens
-00003490: 696f 6e20 3d20 6f73 2e70 6174 682e 7370  ion = os.path.sp
-000034a0: 6c69 7465 7874 2866 696c 655f 6e61 6d65  litext(file_name
-000034b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000034c0: 2066 696c 655f 6578 7465 6e73 696f 6e20   file_extension 
-000034d0: 3d3d 2022 2e67 7a22 3a0a 2020 2020 2020  == ".gz":.      
-000034e0: 2020 2020 2020 2020 2020 2866 696c 655f            (file_
-000034f0: 6e61 6d65 5f6e 6f5f 6578 745f 322c 2066  name_no_ext_2, f
-00003500: 696c 655f 6578 7465 6e73 696f 6e5f 3229  ile_extension_2)
-00003510: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-00003520: 6578 7428 0a20 2020 2020 2020 2020 2020  ext(.           
-00003530: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
-00003540: 6d65 5f6e 6f5f 6578 740a 2020 2020 2020  me_no_ext.      
-00003550: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003560: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00003570: 696c 655f 6578 7465 6e73 696f 6e5f 3220  ile_extension_2 
-00003580: 3d3d 2022 2e6e 6969 223a 0a20 2020 2020  == ".nii":.     
-00003590: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000035a0: 696c 655f 6e61 6d65 5f6e 6f5f 6578 7420  ile_name_no_ext 
-000035b0: 3d20 6669 6c65 5f6e 616d 655f 6e6f 5f65  = file_name_no_e
-000035c0: 7874 5f32 0a20 2020 2020 2020 2020 2020  xt_2.           
-000035d0: 2020 2020 2020 2020 2066 696c 655f 6578           file_ex
-000035e0: 7465 6e73 696f 6e20 3d20 222e 6e69 692e  tension = ".nii.
-000035f0: 677a 220a 0a20 2020 2020 2020 2020 2020  gz"..           
-00003600: 2061 7274 5f66 696c 655f 6f75 7420 3d20   art_file_out = 
-00003610: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
-00003620: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003630: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
-00003640: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-00003650: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-00003660: 2020 2020 2020 2020 2020 2022 6172 745f             "art_
-00003670: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00003680: 2020 2020 2020 2b20 6669 6c65 5f6e 616d        + file_nam
-00003690: 655f 6e6f 5f65 7874 0a20 2020 2020 2020  e_no_ext.       
-000036a0: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-000036b0: 656c 662e 7375 6666 6978 2e73 7472 6970  elf.suffix.strip
-000036c0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000036d0: 2020 2020 2020 202b 2066 696c 655f 6578         + file_ex
-000036e0: 7465 6e73 696f 6e0a 2020 2020 2020 2020  tension.        
-000036f0: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00003700: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00003710: 2020 2020 206e 6962 2e4e 6966 7469 3149       nib.Nifti1I
-00003720: 6d61 6765 2871 6931 5f69 6d67 2c20 696d  mage(qi1_img, im
-00003730: 6e69 692e 6166 6669 6e65 2c20 6864 7229  nii.affine, hdr)
-00003740: 2e74 6f5f 6669 6c65 6e61 6d65 280a 2020  .to_filename(.  
-00003750: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-00003760: 745f 6669 6c65 5f6f 7574 0a20 2020 2020  t_file_out.     
-00003770: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00003780: 2020 2020 2020 6861 745f 6669 6c65 5f6f        hat_file_o
-00003790: 7574 203d 206f 732e 7061 7468 2e6a 6f69  ut = os.path.joi
-000037a0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-000037b0: 2020 2073 656c 662e 6f75 7470 7574 5f64     self.output_d
-000037c0: 6972 6563 746f 7279 2c0a 2020 2020 2020  irectory,.      
-000037d0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-000037e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037f0: 2268 6174 5f22 0a20 2020 2020 2020 2020  "hat_".         
-00003800: 2020 2020 2020 2020 2020 202b 2066 696c             + fil
-00003810: 655f 6e61 6d65 5f6e 6f5f 6578 740a 2020  e_name_no_ext.  
-00003820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003830: 2020 2b20 7365 6c66 2e73 7566 6669 782e    + self.suffix.
-00003840: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-00003850: 2020 2020 2020 2020 2020 2020 2b20 6669              + fi
-00003860: 6c65 5f65 7874 656e 7369 6f6e 0a20 2020  le_extension.   
-00003870: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-00003880: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00003890: 2020 2020 2020 2020 2020 6e69 622e 4e69            nib.Ni
-000038a0: 6674 6931 496d 6167 6528 6169 7264 6174  fti1Image(airdat
-000038b0: 612c 2069 6d6e 6969 2e61 6666 696e 652c  a, imnii.affine,
-000038c0: 2068 6472 292e 746f 5f66 696c 656e 616d   hdr).to_filenam
-000038d0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-000038e0: 2020 2068 6174 5f66 696c 655f 6f75 740a     hat_file_out.
-000038f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00003900: 2020 2020 2020 2020 2020 2061 6972 5f66             air_f
-00003910: 696c 655f 6f75 7420 3d20 6f73 2e70 6174  ile_out = os.pat
-00003920: 682e 6a6f 696e 280a 2020 2020 2020 2020  h.join(.        
-00003930: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
-00003940: 7075 745f 6469 7265 6374 6f72 792c 0a20  put_directory,. 
-00003950: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00003960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003970: 2020 2020 2022 6169 725f 220a 2020 2020       "air_".    
-00003980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003990: 2b20 6669 6c65 5f6e 616d 655f 6e6f 5f65  + file_name_no_e
-000039a0: 7874 0a20 2020 2020 2020 2020 2020 2020  xt.             
-000039b0: 2020 2020 2020 202b 2073 656c 662e 7375         + self.su
-000039c0: 6666 6978 2e73 7472 6970 2829 0a20 2020  ffix.strip().   
-000039d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039e0: 202b 2066 696c 655f 6578 7465 6e73 696f   + file_extensio
-000039f0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00003a00: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
-00003a10: 2029 0a20 2020 2020 2020 2020 2020 2061   ).            a
-00003a20: 6972 6461 7461 5b71 6931 5f69 6d67 203e  irdata[qi1_img >
-00003a30: 2030 5d20 3d20 300a 2020 2020 2020 2020   0] = 0.        
-00003a40: 2020 2020 6e69 622e 4e69 6674 6931 496d      nib.Nifti1Im
-00003a50: 6167 6528 6169 7264 6174 612c 2069 6d6e  age(airdata, imn
-00003a60: 6969 2e61 6666 696e 652c 2068 6472 292e  ii.affine, hdr).
-00003a70: 746f 5f66 696c 656e 616d 6528 0a20 2020  to_filename(.   
-00003a80: 2020 2020 2020 2020 2020 2020 2061 6972               air
-00003a90: 5f66 696c 655f 6f75 740a 2020 2020 2020  _file_out.      
-00003aa0: 2020 2020 2020 290a 0a0a 636c 6173 7320        )...class 
-00003ab0: 4269 6e61 7269 7a65 2850 726f 6365 7373  Binarize(Process
-00003ac0: 4d49 4129 3a0a 2020 2020 2222 220a 2020  MIA):.    """.  
-00003ad0: 2020 2a49 6d61 6765 2062 696e 6172 697a    *Image binariz
-00003ae0: 6174 696f 6e2a 0a0a 2020 2020 506c 6561  ation*..    Plea
-00003af0: 7365 2c20 7365 6520 7468 6520 636f 6d70  se, see the comp
-00003b00: 6c65 7465 2064 6f63 756d 656e 7461 7469  lete documentati
-00003b10: 6f6e 2066 6f72 2074 6865 2060 4269 6e61  on for the `Bina
-00003b20: 7269 7a65 2062 7269 636b 0a20 2020 2069  rize brick.    i
-00003b30: 6e20 7468 6520 6d69 615f 7072 6f63 6573  n the mia_proces
-00003b40: 7365 7320 7765 6273 6974 650a 2020 2020  ses website.    
-00003b50: 3c68 7474 7073 3a2f 2f70 6f70 756c 7365  <https://populse
-00003b60: 2e67 6974 6875 622e 696f 2f6d 6961 5f70  .github.io/mia_p
-00003b70: 726f 6365 7373 6573 2f68 746d 6c2f 646f  rocesses/html/do
-00003b80: 6375 6d65 6e74 6174 696f 6e2f 6272 6963  cumentation/bric
-00003b90: 6b73 2f70 7265 7072 6f63 6573 732f 6f74  ks/preprocess/ot
-00003ba0: 6865 722f 4269 6e61 7269 7a65 2e68 746d  her/Binarize.htm
-00003bb0: 6c3e 605f 0a0a 2020 2020 6164 6170 7465  l>`_..    adapte
-00003bc0: 6420 6672 6f6d 3a0a 2020 2020 6874 7470  d from:.    http
-00003bd0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f6e  s://github.com/n
-00003be0: 6970 7265 7073 2f6e 6977 6f72 6b66 6c6f  ipreps/niworkflo
-00003bf0: 7773 2f62 6c6f 622f 3435 6162 3133 6531  ws/blob/45ab13e1
-00003c00: 6266 3666 6462 6635 6532 3963 3930 6365  bf6fdbf5e29c90ce
-00003c10: 6634 3430 3535 6230 6239 6366 3339 3162  f44055b0b9cf391b
-00003c20: 2f6e 6977 6f72 6b66 6c6f 7773 2f69 6e74  /niworkflows/int
-00003c30: 6572 6661 6365 732f 6e69 6261 6265 6c2e  erfaces/nibabel.
-00003c40: 7079 234c 3932 0a0a 2020 2020 2222 220a  py#L92..    """.
-00003c50: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00003c60: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00003c70: 2022 2222 4465 6469 6361 7465 6420 746f   """Dedicated to
-00003c80: 2074 6865 2061 7474 7269 6275 7465 7320   the attributes 
-00003c90: 696e 6974 6961 6c69 7361 7469 6f6e 202f  initialisation /
-00003ca0: 2069 6e73 7461 6e74 6961 7469 6f6e 2e0a   instantiation..
-00003cb0: 0a20 2020 2020 2020 2054 6865 2069 6e70  .        The inp
-00003cc0: 7574 2061 6e64 206f 7574 7075 7420 706c  ut and output pl
-00003cd0: 7567 7320 6172 6520 6465 6669 6e65 6420  ugs are defined 
-00003ce0: 6865 7265 2e20 5468 6520 7370 6563 6961  here. The specia
-00003cf0: 6c0a 2020 2020 2020 2020 2773 656c 662e  l.        'self.
-00003d00: 7265 7175 6972 656d 656e 7427 2061 7474  requirement' att
-00003d10: 7269 6275 7465 2028 6f70 7469 6f6e 616c  ribute (optional
-00003d20: 2920 6973 2075 7365 6420 746f 2064 6566  ) is used to def
-00003d30: 696e 6520 7468 650a 2020 2020 2020 2020  ine the.        
-00003d40: 7468 6972 642d 7061 7274 7920 7072 6f64  third-party prod
-00003d50: 7563 7473 206e 6563 6573 7361 7279 2066  ucts necessary f
-00003d60: 6f72 2074 6865 2072 756e 6e69 6e67 206f  or the running o
-00003d70: 6620 7468 6520 6272 6963 6b2e 0a20 2020  f the brick..   
-00003d80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00003d90: 2023 2049 6e69 7469 616c 6973 6174 696f   # Initialisatio
-00003da0: 6e20 6f66 2074 6865 206f 626a 6563 7473  n of the objects
-00003db0: 206e 6565 6465 6420 666f 7220 7468 6520   needed for the 
-00003dc0: 6c61 756e 6368 206f 6620 7468 6520 6272  launch of the br
-00003dd0: 6963 6b0a 2020 2020 2020 2020 7375 7065  ick.        supe
-00003de0: 7228 4269 6e61 7269 7a65 2c20 7365 6c66  r(Binarize, self
-00003df0: 292e 5f5f 696e 6974 5f5f 2829 0a0a 2020  ).__init__()..  
-00003e00: 2020 2020 2020 2320 5468 6972 6420 7061        # Third pa
-00003e10: 7274 7920 736f 6674 7761 7265 7320 7265  rty softwares re
-00003e20: 7175 6972 6564 2066 6f72 2074 6865 2065  quired for the e
-00003e30: 7865 6375 7469 6f6e 206f 6620 7468 6520  xecution of the 
-00003e40: 6272 6963 6b0a 2020 2020 2020 2020 7365  brick.        se
-00003e50: 6c66 2e72 6571 7569 7265 6d65 6e74 203d  lf.requirement =
-00003e60: 205b 5d0a 0a20 2020 2020 2020 2023 2049   []..        # I
-00003e70: 6e70 7574 7320 6465 7363 7269 7074 696f  nputs descriptio
-00003e80: 6e0a 2020 2020 2020 2020 696e 5f66 696c  n.        in_fil
-00003e90: 6573 5f64 6573 6320 3d20 280a 2020 2020  es_desc = (.    
-00003ea0: 2020 2020 2020 2020 2241 206c 6973 7420          "A list 
-00003eb0: 6f66 2069 7465 6d73 2077 6974 6820 7374  of items with st
-00003ec0: 7269 6e67 2065 6c65 6d65 6e74 7320 636f  ring elements co
-00003ed0: 7272 6573 706f 6e64 696e 6720 220a 2020  rresponding ".  
-00003ee0: 2020 2020 2020 2020 2020 2274 6f20 6578            "to ex
-00003ef0: 6973 7469 6e67 2070 6174 6820 6669 6c65  isting path file
-00003f00: 732e 220a 2020 2020 2020 2020 290a 2020  s.".        ).  
-00003f10: 2020 2020 2020 7468 7265 7368 5f6c 6f77        thresh_low
-00003f20: 5f64 6573 6320 3d20 224c 6f77 6572 2074  _desc = "Lower t
-00003f30: 6872 6573 686f 6c64 2066 6f72 2062 696e  hreshold for bin
-00003f40: 6172 697a 6174 696f 6e20 2866 6c6f 6174  arization (float
-00003f50: 292e 220a 2020 2020 2020 2020 7072 6566  ).".        pref
-00003f60: 6978 5f64 6573 6320 3d20 2250 7265 6669  ix_desc = "Prefi
-00003f70: 7820 6f66 2074 6865 206f 7574 7075 7420  x of the output 
-00003f80: 696d 6167 6573 2028 6120 7374 7269 6e67  images (a string
-00003f90: 292e 220a 2020 2020 2020 2020 7375 6666  ).".        suff
-00003fa0: 6978 5f64 6573 6320 3d20 2253 7566 6669  ix_desc = "Suffi
-00003fb0: 7820 6f66 2074 6865 206f 7574 7075 7420  x of the output 
-00003fc0: 696d 6167 6573 2028 6120 7374 7269 6e67  images (a string
-00003fd0: 292e 220a 0a20 2020 2020 2020 2023 204f  )."..        # O
-00003fe0: 7574 7075 7473 2064 6573 6372 6970 7469  utputs descripti
-00003ff0: 6f6e 0a20 2020 2020 2020 206f 7574 5f66  on.        out_f
-00004000: 696c 6573 5f64 6573 6320 3d20 280a 2020  iles_desc = (.  
-00004010: 2020 2020 2020 2020 2020 2250 6174 6820            "Path 
-00004020: 6f66 2074 6865 2073 6361 6e20 6166 7465  of the scan afte
-00004030: 7220 6170 706c 6963 6174 696f 6e20 6f66  r application of
-00004040: 2074 6865 220a 2020 2020 2020 2020 2020   the".          
-00004050: 2020 2262 696e 6172 697a 6174 696f 6e20    "binarization 
-00004060: 2861 2070 6174 686c 696b 6520 6f62 6a65  (a pathlike obje
-00004070: 6374 206f 7220 7374 7269 6e67 220a 2020  ct or string".  
-00004080: 2020 2020 2020 2020 2020 2272 6570 7265            "repre
-00004090: 7365 6e74 696e 6720 6120 6669 6c65 2c20  senting a file, 
-000040a0: 6f72 2061 206c 6973 7420 6f66 2070 6174  or a list of pat
-000040b0: 686c 696b 6522 0a20 2020 2020 2020 2020  hlike".         
-000040c0: 2020 2022 6f62 6a65 6374 7320 6f72 2073     "objects or s
-000040d0: 7472 696e 6773 2072 6570 7265 7365 6e74  trings represent
-000040e0: 696e 6720 6120 6669 6c65 292e 220a 2020  ing a file).".  
-000040f0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00004100: 2023 2049 6e70 7574 7320 7472 6169 7473   # Inputs traits
-00004110: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00004120: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
-00004130: 2020 2020 2022 696e 5f66 696c 6573 222c       "in_files",
-00004140: 0a20 2020 2020 2020 2020 2020 2049 6e70  .            Inp
-00004150: 7574 4d75 6c74 6950 6174 6828 0a20 2020  utMultiPath(.   
-00004160: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-00004170: 6974 732e 4569 7468 6572 2846 696c 6528  its.Either(File(
-00004180: 292c 2074 7261 6974 732e 4c69 7374 2846  ), traits.List(F
-00004190: 696c 6528 2929 292c 0a20 2020 2020 2020  ile())),.       
-000041a0: 2020 2020 2020 2020 206f 7574 7075 743d           output=
-000041b0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-000041c0: 2020 2020 2020 2064 6573 633d 696e 5f66         desc=in_f
-000041d0: 696c 6573 5f64 6573 632c 0a20 2020 2020  iles_desc,.     
-000041e0: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-000041f0: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00004200: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-00004210: 2020 2020 2020 2020 2022 7072 6566 6978           "prefix
-00004220: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
-00004230: 7261 6974 732e 5374 7269 6e67 2822 222c  raits.String("",
-00004240: 206f 7574 7075 743d 4661 6c73 652c 206f   output=False, o
-00004250: 7074 696f 6e61 6c3d 5472 7565 2c20 6465  ptional=True, de
-00004260: 7363 3d70 7265 6669 785f 6465 7363 292c  sc=prefix_desc),
-00004270: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00004280: 2020 2073 656c 662e 6164 645f 7472 6169     self.add_trai
-00004290: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
-000042a0: 7375 6666 6978 222c 0a20 2020 2020 2020  suffix",.       
-000042b0: 2020 2020 2074 7261 6974 732e 5374 7269       traits.Stri
-000042c0: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
-000042d0: 2020 2020 225f 6269 6e22 2c20 6f75 7470      "_bin", outp
-000042e0: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
-000042f0: 616c 3d54 7275 652c 2064 6573 633d 7375  al=True, desc=su
-00004300: 6666 6978 5f64 6573 630a 2020 2020 2020  ffix_desc.      
-00004310: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-00004320: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-00004330: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
-00004340: 2020 2020 2020 2020 2274 6872 6573 685f          "thresh_
-00004350: 6c6f 7722 2c0a 2020 2020 2020 2020 2020  low",.          
-00004360: 2020 7472 6169 7473 2e46 6c6f 6174 280a    traits.Float(.
-00004370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004380: 6465 6661 756c 743d 302e 302c 206f 7574  default=0.0, out
-00004390: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
-000043a0: 6e61 6c3d 5472 7565 2c20 6465 7363 3d74  nal=True, desc=t
-000043b0: 6872 6573 685f 6c6f 775f 6465 7363 0a20  hresh_low_desc. 
-000043c0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-000043d0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000043e0: 2023 204f 7574 7075 7473 2074 7261 6974   # Outputs trait
-000043f0: 730a 2020 2020 2020 2020 7365 6c66 2e61  s.        self.a
-00004400: 6464 5f74 7261 6974 280a 2020 2020 2020  dd_trait(.      
-00004410: 2020 2020 2020 226f 7574 5f66 696c 6573        "out_files
-00004420: 222c 0a20 2020 2020 2020 2020 2020 204f  ",.            O
-00004430: 7574 7075 744d 756c 7469 5061 7468 2846  utputMultiPath(F
-00004440: 696c 6528 292c 206f 7574 7075 743d 5472  ile(), output=Tr
-00004450: 7565 2c20 6465 7363 3d6f 7574 5f66 696c  ue, desc=out_fil
-00004460: 6573 5f64 6573 6329 2c0a 2020 2020 2020  es_desc),.      
-00004470: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00004480: 662e 696e 6974 5f64 6566 6175 6c74 5f74  f.init_default_t
-00004490: 7261 6974 7328 290a 0a20 2020 2064 6566  raits()..    def
-000044a0: 206c 6973 745f 6f75 7470 7574 7328 7365   list_outputs(se
-000044b0: 6c66 2c20 6973 5f70 6c75 6767 6564 3d4e  lf, is_plugged=N
-000044c0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-000044d0: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
-000044e0: 6520 696e 6974 6961 6c69 7361 7469 6f6e  e initialisation
-000044f0: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
-00004500: 636b 2e0a 0a20 2020 2020 2020 2054 6865  ck...        The
-00004510: 206d 6169 6e20 6f62 6a65 6374 6976 6520   main objective 
-00004520: 6f66 2074 6869 7320 6d65 7468 6f64 2069  of this method i
-00004530: 7320 746f 2070 726f 6475 6365 2074 6865  s to produce the
-00004540: 206f 7574 7075 7473 206f 6620 7468 650a   outputs of the.
-00004550: 2020 2020 2020 2020 6272 6963 6b73 2028          bricks (
-00004560: 7365 6c66 2e6f 7574 7075 7473 2920 616e  self.outputs) an
-00004570: 6420 7468 6520 6173 736f 6369 6174 6564  d the associated
-00004580: 2074 6167 7320 2873 656c 662e 696e 6865   tags (self.inhe
-00004590: 7269 7461 6e63 655f 6469 6329 2c0a 2020  ritance_dic),.  
-000045a0: 2020 2020 2020 6966 2064 6566 696e 6564        if defined
-000045b0: 2068 6572 652e 2054 6f20 776f 726b 2070   here. To work p
-000045c0: 726f 7065 726c 7920 7468 6973 206d 6574  roperly this met
-000045d0: 686f 6420 6d75 7374 2072 6574 7572 6e0a  hod must return.
-000045e0: 2020 2020 2020 2020 7365 6c66 2e6d 616b          self.mak
-000045f0: 655f 696e 6974 5265 7375 6c74 2829 206f  e_initResult() o
-00004600: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
-00004610: 3a70 6172 616d 2069 735f 706c 7567 6765  :param is_plugge
-00004620: 643a 2074 6865 2073 7461 7465 2c20 6c69  d: the state, li
-00004630: 6e6b 6564 206f 7220 6e6f 742c 206f 6620  nked or not, of 
-00004640: 7468 6520 706c 7567 732e 0a20 2020 2020  the plugs..     
-00004650: 2020 203a 7265 7475 726e 733a 2061 2064     :returns: a d
-00004660: 6963 7469 6f6e 6172 7920 7769 7468 2072  ictionary with r
-00004670: 6571 7569 7265 6d65 6e74 2c20 6f75 7470  equirement, outp
-00004680: 7574 7320 616e 6420 696e 6865 7269 7461  uts and inherita
-00004690: 6e63 655f 6469 6374 2e0a 2020 2020 2020  nce_dict..      
-000046a0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-000046b0: 5573 696e 6720 7468 6520 696e 6865 7269  Using the inheri
-000046c0: 7461 6e63 6520 746f 2050 726f 6365 7373  tance to Process
-000046d0: 4d49 4120 636c 6173 732c 206c 6973 745f  MIA class, list_
-000046e0: 6f75 7470 7574 7320 6d65 7468 6f64 0a20  outputs method. 
-000046f0: 2020 2020 2020 2073 7570 6572 2842 696e         super(Bin
-00004700: 6172 697a 652c 2073 656c 6629 2e6c 6973  arize, self).lis
-00004710: 745f 6f75 7470 7574 7328 290a 0a20 2020  t_outputs()..   
-00004720: 2020 2020 2023 204f 7574 7075 7473 2064       # Outputs d
-00004730: 6566 696e 6974 696f 6e0a 2020 2020 2020  efinition.      
-00004740: 2020 6966 2073 656c 662e 696e 5f66 696c    if self.in_fil
-00004750: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00004760: 6669 6c65 735f 6e61 6d65 203d 2073 656c  files_name = sel
-00004770: 662e 696e 5f66 696c 6573 0a0a 2020 2020  f.in_files..    
-00004780: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00004790: 2020 2020 2020 2020 2020 2020 2028 6e6f               (no
-000047a0: 7420 7365 6c66 2e73 7566 6669 7829 0a20  t self.suffix). 
-000047b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000047c0: 7220 2873 656c 662e 7375 6666 6978 2e69  r (self.suffix.i
-000047d0: 7373 7061 6365 2829 290a 2020 2020 2020  sspace()).      
-000047e0: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
-000047f0: 662e 7375 6666 6978 2069 6e20 5b55 6e64  f.suffix in [Und
-00004800: 6566 696e 6564 2c20 223c 756e 6465 6669  efined, "<undefi
-00004810: 6e65 643e 225d 0a20 2020 2020 2020 2020  ned>"].         
-00004820: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00004830: 2020 2020 2020 7365 6c66 2e73 7566 6669        self.suffi
-00004840: 7820 3d20 2220 220a 0a20 2020 2020 2020  x = " "..       
-00004850: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00004860: 2020 2020 2020 2020 2020 286e 6f74 2073            (not s
-00004870: 656c 662e 7072 6566 6978 290a 2020 2020  elf.prefix).    
-00004880: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-00004890: 7365 6c66 2e70 7265 6669 782e 6973 7370  self.prefix.issp
-000048a0: 6163 6528 2929 0a20 2020 2020 2020 2020  ace()).         
-000048b0: 2020 2020 2020 206f 7220 2873 656c 662e         or (self.
-000048c0: 7072 6566 6978 2069 6e20 5b55 6e64 6566  prefix in [Undef
-000048d0: 696e 6564 2c20 223c 756e 6465 6669 6e65  ined, "<undefine
-000048e0: 643e 225d 290a 2020 2020 2020 2020 2020  d>"]).          
-000048f0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00004900: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
-00004910: 203d 2022 2022 0a0a 2020 2020 2020 2020   = " "..        
-00004920: 2020 2020 6669 6c65 7320 3d20 5b5d 0a20      files = []. 
-00004930: 2020 2020 2020 2020 2020 2066 6c61 6720             flag 
-00004940: 3d20 5472 7565 2020 2320 4966 2046 616c  = True  # If Fal
-00004950: 7365 2c20 7375 662f 7072 6566 2063 6865  se, suf/pref che
-00004960: 636b 2077 696c 6c20 6e6f 7420 6265 2070  ck will not be p
-00004970: 6572 666f 726d 6564 206c 6174 6572 0a0a  erformed later..
-00004980: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004990: 6669 6c65 5f6e 616d 6531 2069 6e20 6669  file_name1 in fi
-000049a0: 6c65 735f 6e61 6d65 3a0a 2020 2020 2020  les_name:.      
-000049b0: 2020 2020 2020 2020 2020 7661 6c69 645f            valid_
-000049c0: 6578 742c 2069 6e5f 6578 742c 2066 696c  ext, in_ext, fil
-000049d0: 654e 616d 6520 3d20 6368 6563 6b46 696c  eName = checkFil
-000049e0: 6545 7874 2866 696c 655f 6e61 6d65 312c  eExt(file_name1,
-000049f0: 2045 5854 290a 2020 2020 2020 2020 2020   EXT).          
-00004a00: 2020 2020 2020 6966 206e 6f74 2076 616c        if not val
-00004a10: 6964 5f65 7874 3a0a 2020 2020 2020 2020  id_ext:.        
-00004a20: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00004a30: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00004a40: 2020 2020 2020 2020 2020 2022 5c6e 4269             "\nBi
-00004a50: 6e61 7269 7a65 2062 7269 636b 3a20 5468  narize brick: Th
-00004a60: 6520 696e 7075 7420 696d 6167 6520 666f  e input image fo
-00004a70: 726d 6174 2069 7320 6e6f 7420 220a 2020  rmat is not ".  
+00002fc0: 2020 2020 2020 616e 6420 2868 6d6e 6969        and (hmnii
+00002fd0: 2069 7320 6e6f 7420 4e6f 6e65 290a 2020   is not None).  
+00002fe0: 2020 2020 2020 2020 2020 616e 6420 2872            and (r
+00002ff0: 6d6e 6969 2069 7320 6e6f 7420 4e6f 6e65  mnii is not None
+00003000: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
+00003010: 6420 286e 706d 6e69 6920 6973 206e 6f74  d (npmnii is not
+00003020: 204e 6f6e 6529 0a20 2020 2020 2020 2029   None).        )
+00003030: 3a0a 2020 2020 2020 2020 2020 2020 696d  :.            im
+00003040: 6461 7461 203d 206e 702e 6e61 6e5f 746f  data = np.nan_to
+00003050: 5f6e 756d 2869 6d6e 6969 2e67 6574 5f66  _num(imnii.get_f
+00003060: 6461 7461 2829 2e61 7374 7970 6528 6e70  data().astype(np
+00003070: 2e66 6c6f 6174 3332 2929 0a0a 2020 2020  .float32))..    
+00003080: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
+00003090: 206e 6567 6174 6976 6520 7661 6c75 6573   negative values
+000030a0: 0a20 2020 2020 2020 2020 2020 2069 6d64  .            imd
+000030b0: 6174 615b 696d 6461 7461 203c 2030 5d20  ata[imdata < 0] 
+000030c0: 3d20 300a 0a20 2020 2020 2020 2020 2020  = 0..           
+000030d0: 2068 6d64 6174 6120 3d20 6e70 2e61 7361   hmdata = np.asa
+000030e0: 6e79 6172 7261 7928 6e69 622e 6c6f 6164  nyarray(nib.load
+000030f0: 2868 6561 645f 6d61 736b 5f6e 616d 6529  (head_mask_name)
+00003100: 2e64 6174 616f 626a 290a 2020 2020 2020  .dataobj).      
+00003110: 2020 2020 2020 6e70 6461 7461 203d 206e        npdata = n
+00003120: 702e 6173 616e 7961 7272 6179 286e 6962  p.asanyarray(nib
+00003130: 2e6c 6f61 6428 6e61 7369 6f6e 5f70 6f73  .load(nasion_pos
+00003140: 745f 6d61 736b 5f6e 616d 6529 2e64 6174  t_mask_name).dat
+00003150: 616f 626a 290a 0a20 2020 2020 2020 2020  aobj)..         
+00003160: 2020 2023 2049 6e76 6572 7420 6865 6164     # Invert head
+00003170: 206d 6173 6b0a 2020 2020 2020 2020 2020   mask.          
+00003180: 2020 6169 7264 6174 6120 3d20 6e70 2e6f    airdata = np.o
+00003190: 6e65 735f 6c69 6b65 2868 6d64 6174 612c  nes_like(hmdata,
+000031a0: 2064 7479 7065 3d6e 702e 7569 6e74 3829   dtype=np.uint8)
+000031b0: 0a20 2020 2020 2020 2020 2020 2061 6972  .            air
+000031c0: 6461 7461 5b68 6d64 6174 6120 3d3d 2031  data[hmdata == 1
+000031d0: 5d20 3d20 300a 0a20 2020 2020 2020 2020  ] = 0..         
+000031e0: 2020 2023 2043 616c 6375 6c61 7465 2064     # Calculate d
+000031f0: 6973 7461 6e63 6520 746f 2062 6f72 6465  istance to borde
+00003200: 720a 2020 2020 2020 2020 2020 2020 6469  r.            di
+00003210: 7374 203d 2073 696d 2e6d 6f72 7068 6f6c  st = sim.morphol
+00003220: 6f67 792e 6469 7374 616e 6365 5f74 7261  ogy.distance_tra
+00003230: 6e73 666f 726d 5f65 6474 2861 6972 6461  nsform_edt(airda
+00003240: 7461 290a 0a20 2020 2020 2020 2020 2020  ta)..           
+00003250: 2023 2041 7070 6c79 206e 6173 696f 6e2d   # Apply nasion-
+00003260: 746f 2d70 6f73 7465 7269 6f72 206d 6173  to-posterior mas
+00003270: 6b0a 2020 2020 2020 2020 2020 2020 6169  k.            ai
+00003280: 7264 6174 615b 6e70 6461 7461 203d 3d20  rdata[npdata == 
+00003290: 315d 203d 2030 0a20 2020 2020 2020 2020  1] = 0.         
+000032a0: 2020 2064 6973 745b 6e70 6461 7461 203d     dist[npdata =
+000032b0: 3d20 315d 203d 2030 0a20 2020 2020 2020  = 1] = 0.       
+000032c0: 2020 2020 2064 6973 7420 2f3d 2064 6973       dist /= dis
+000032d0: 742e 6d61 7828 290a 0a20 2020 2020 2020  t.max()..       
+000032e0: 2020 2020 2023 2041 7070 6c79 2072 6f74       # Apply rot
+000032f0: 6174 696f 6e20 6d61 736b 2028 6966 2073  ation mask (if s
+00003300: 7570 706c 6965 6429 0a20 2020 2020 2020  upplied).       
+00003310: 2020 2020 2069 6620 726f 745f 6d61 736b       if rot_mask
+00003320: 5f6e 616d 6520 213d 2055 6e64 6566 696e  _name != Undefin
+00003330: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00003340: 2020 2020 726f 746d 736b 6461 7461 203d      rotmskdata =
+00003350: 206e 702e 6173 616e 7961 7272 6179 286e   np.asanyarray(n
+00003360: 6962 2e6c 6f61 6428 726f 745f 6d61 736b  ib.load(rot_mask
+00003370: 5f6e 616d 6529 2e64 6174 616f 626a 290a  _name).dataobj).
+00003380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003390: 6169 7264 6174 615b 726f 746d 736b 6461  airdata[rotmskda
+000033a0: 7461 203d 3d20 315d 203d 2030 0a0a 2020  ta == 1] = 0..  
+000033b0: 2020 2020 2020 2020 2020 2320 5275 6e20            # Run 
+000033c0: 7468 6520 6172 7469 6661 6374 2064 6574  the artifact det
+000033d0: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
+000033e0: 2020 2071 6931 5f69 6d67 203d 2061 7274     qi1_img = art
+000033f0: 6966 6163 745f 6d61 736b 2869 6d64 6174  ifact_mask(imdat
+00003400: 612c 2061 6972 6461 7461 2c20 6469 7374  a, airdata, dist
+00003410: 290a 2020 2020 2020 2020 2020 2020 6864  ).            hd
+00003420: 7220 3d20 696d 6e69 692e 6865 6164 6572  r = imnii.header
+00003430: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00003440: 2020 2020 6864 722e 7365 745f 6461 7461      hdr.set_data
+00003450: 5f64 7479 7065 286e 702e 7569 6e74 3829  _dtype(np.uint8)
+00003460: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00003470: 496d 6167 6520 7361 7665 0a20 2020 2020  Image save.     
+00003480: 2020 2020 2020 205f 2c20 6669 6c65 5f6e         _, file_n
+00003490: 616d 6520 3d20 6f73 2e70 6174 682e 7370  ame = os.path.sp
+000034a0: 6c69 7428 6669 6c65 5f6e 616d 6529 0a20  lit(file_name). 
+000034b0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+000034c0: 6e61 6d65 5f6e 6f5f 6578 742c 2066 696c  name_no_ext, fil
+000034d0: 655f 6578 7465 6e73 696f 6e20 3d20 6f73  e_extension = os
+000034e0: 2e70 6174 682e 7370 6c69 7465 7874 2866  .path.splitext(f
+000034f0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+00003500: 2020 2020 2020 6966 2066 696c 655f 6578        if file_ex
+00003510: 7465 6e73 696f 6e20 3d3d 2022 2e67 7a22  tension == ".gz"
+00003520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003530: 2020 2866 696c 655f 6e61 6d65 5f6e 6f5f    (file_name_no_
+00003540: 6578 745f 322c 2066 696c 655f 6578 7465  ext_2, file_exte
+00003550: 6e73 696f 6e5f 3229 203d 206f 732e 7061  nsion_2) = os.pa
+00003560: 7468 2e73 706c 6974 6578 7428 0a20 2020  th.splitext(.   
+00003570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003580: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
+00003590: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000035a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+000035b0: 2020 2020 6966 2066 696c 655f 6578 7465      if file_exte
+000035c0: 6e73 696f 6e5f 3220 3d3d 2022 2e6e 6969  nsion_2 == ".nii
+000035d0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000035e0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+000035f0: 5f6e 6f5f 6578 7420 3d20 6669 6c65 5f6e  _no_ext = file_n
+00003600: 616d 655f 6e6f 5f65 7874 5f32 0a20 2020  ame_no_ext_2.   
+00003610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003620: 2066 696c 655f 6578 7465 6e73 696f 6e20   file_extension 
+00003630: 3d20 222e 6e69 692e 677a 220a 0a20 2020  = ".nii.gz"..   
+00003640: 2020 2020 2020 2020 2061 7274 5f66 696c           art_fil
+00003650: 655f 6f75 7420 3d20 6f73 2e70 6174 682e  e_out = os.path.
+00003660: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
+00003670: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+00003680: 745f 6469 7265 6374 6f72 792c 0a20 2020  t_directory,.   
+00003690: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
+000036a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000036b0: 2020 2022 6172 745f 220a 2020 2020 2020     "art_".      
+000036c0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000036d0: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
+000036e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000036f0: 2020 2020 202b 2073 656c 662e 7375 6666       + self.suff
+00003700: 6978 2e73 7472 6970 2829 0a20 2020 2020  ix.strip().     
+00003710: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00003720: 2066 696c 655f 6578 7465 6e73 696f 6e0a   file_extension.
+00003730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003740: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00003750: 0a20 2020 2020 2020 2020 2020 206e 6962  .            nib
+00003760: 2e4e 6966 7469 3149 6d61 6765 2871 6931  .Nifti1Image(qi1
+00003770: 5f69 6d67 2c20 696d 6e69 692e 6166 6669  _img, imnii.affi
+00003780: 6e65 2c20 6864 7229 2e74 6f5f 6669 6c65  ne, hdr).to_file
+00003790: 6e61 6d65 280a 2020 2020 2020 2020 2020  name(.          
+000037a0: 2020 2020 2020 6172 745f 6669 6c65 5f6f        art_file_o
+000037b0: 7574 0a20 2020 2020 2020 2020 2020 2029  ut.            )
+000037c0: 0a0a 2020 2020 2020 2020 2020 2020 6861  ..            ha
+000037d0: 745f 6669 6c65 5f6f 7574 203d 206f 732e  t_file_out = os.
+000037e0: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
+000037f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003800: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
+00003810: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003820: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00003830: 2020 2020 2020 2020 2268 6174 5f22 0a20          "hat_". 
+00003840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003850: 2020 202b 2066 696c 655f 6e61 6d65 5f6e     + file_name_n
+00003860: 6f5f 6578 740a 2020 2020 2020 2020 2020  o_ext.          
+00003870: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
+00003880: 2e73 7566 6669 782e 7374 7269 7028 290a  .suffix.strip().
+00003890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038a0: 2020 2020 2b20 6669 6c65 5f65 7874 656e      + file_exten
+000038b0: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
+000038c0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+000038d0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000038e0: 2020 6e69 622e 4e69 6674 6931 496d 6167    nib.Nifti1Imag
+000038f0: 6528 6169 7264 6174 612c 2069 6d6e 6969  e(airdata, imnii
+00003900: 2e61 6666 696e 652c 2068 6472 292e 746f  .affine, hdr).to
+00003910: 5f66 696c 656e 616d 6528 0a20 2020 2020  _filename(.     
+00003920: 2020 2020 2020 2020 2020 2068 6174 5f66             hat_f
+00003930: 696c 655f 6f75 740a 2020 2020 2020 2020  ile_out.        
+00003940: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00003950: 2020 2061 6972 5f66 696c 655f 6f75 7420     air_file_out 
+00003960: 3d20 6f73 2e70 6174 682e 6a6f 696e 280a  = os.path.join(.
+00003970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003980: 7365 6c66 2e6f 7574 7075 745f 6469 7265  self.output_dire
+00003990: 6374 6f72 792c 0a20 2020 2020 2020 2020  ctory,.         
+000039a0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+000039b0: 2020 2020 2020 2020 2020 2020 2022 6169               "ai
+000039c0: 725f 220a 2020 2020 2020 2020 2020 2020  r_".            
+000039d0: 2020 2020 2020 2020 2b20 6669 6c65 5f6e          + file_n
+000039e0: 616d 655f 6e6f 5f65 7874 0a20 2020 2020  ame_no_ext.     
+000039f0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00003a00: 2073 656c 662e 7375 6666 6978 2e73 7472   self.suffix.str
+00003a10: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
+00003a20: 2020 2020 2020 2020 202b 2066 696c 655f           + file_
+00003a30: 6578 7465 6e73 696f 6e0a 2020 2020 2020  extension.      
+00003a40: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00003a50: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00003a60: 2020 2020 2020 2061 6972 6461 7461 5b71         airdata[q
+00003a70: 6931 5f69 6d67 203e 2030 5d20 3d20 300a  i1_img > 0] = 0.
+00003a80: 2020 2020 2020 2020 2020 2020 6e69 622e              nib.
+00003a90: 4e69 6674 6931 496d 6167 6528 6169 7264  Nifti1Image(aird
+00003aa0: 6174 612c 2069 6d6e 6969 2e61 6666 696e  ata, imnii.affin
+00003ab0: 652c 2068 6472 292e 746f 5f66 696c 656e  e, hdr).to_filen
+00003ac0: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
+00003ad0: 2020 2020 2061 6972 5f66 696c 655f 6f75       air_file_ou
+00003ae0: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
+00003af0: 0a0a 636c 6173 7320 4269 6e61 7269 7a65  ..class Binarize
+00003b00: 2850 726f 6365 7373 4d49 4129 3a0a 2020  (ProcessMIA):.  
+00003b10: 2020 2222 220a 2020 2020 2a49 6d61 6765    """.    *Image
+00003b20: 2062 696e 6172 697a 6174 696f 6e2a 0a0a   binarization*..
+00003b30: 2020 2020 506c 6561 7365 2c20 7365 6520      Please, see 
+00003b40: 7468 6520 636f 6d70 6c65 7465 2064 6f63  the complete doc
+00003b50: 756d 656e 7461 7469 6f6e 2066 6f72 2074  umentation for t
+00003b60: 6865 2060 4269 6e61 7269 7a65 2062 7269  he `Binarize bri
+00003b70: 636b 0a20 2020 2069 6e20 7468 6520 6d69  ck.    in the mi
+00003b80: 615f 7072 6f63 6573 7365 7320 7765 6273  a_processes webs
+00003b90: 6974 650a 2020 2020 3c68 7474 7073 3a2f  ite.    <https:/
+00003ba0: 2f70 6f70 756c 7365 2e67 6974 6875 622e  /populse.github.
+00003bb0: 696f 2f6d 6961 5f70 726f 6365 7373 6573  io/mia_processes
+00003bc0: 2f68 746d 6c2f 646f 6375 6d65 6e74 6174  /html/documentat
+00003bd0: 696f 6e2f 6272 6963 6b73 2f70 7265 7072  ion/bricks/prepr
+00003be0: 6f63 6573 732f 6f74 6865 722f 4269 6e61  ocess/other/Bina
+00003bf0: 7269 7a65 2e68 746d 6c3e 605f 0a0a 2020  rize.html>`_..  
+00003c00: 2020 6164 6170 7465 6420 6672 6f6d 3a0a    adapted from:.
+00003c10: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
+00003c20: 7562 2e63 6f6d 2f6e 6970 7265 7073 2f6e  ub.com/nipreps/n
+00003c30: 6977 6f72 6b66 6c6f 7773 2f62 6c6f 622f  iworkflows/blob/
+00003c40: 3435 6162 3133 6531 6266 3666 6462 6635  45ab13e1bf6fdbf5
+00003c50: 6532 3963 3930 6365 6634 3430 3535 6230  e29c90cef44055b0
+00003c60: 6239 6366 3339 3162 2f6e 6977 6f72 6b66  b9cf391b/niworkf
+00003c70: 6c6f 7773 2f69 6e74 6572 6661 6365 732f  lows/interfaces/
+00003c80: 6e69 6261 6265 6c2e 7079 234c 3932 0a0a  nibabel.py#L92..
+00003c90: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00003ca0: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
+00003cb0: 0a20 2020 2020 2020 2022 2222 4465 6469  .        """Dedi
+00003cc0: 6361 7465 6420 746f 2074 6865 2061 7474  cated to the att
+00003cd0: 7269 6275 7465 7320 696e 6974 6961 6c69  ributes initiali
+00003ce0: 7361 7469 6f6e 202f 2069 6e73 7461 6e74  sation / instant
+00003cf0: 6961 7469 6f6e 2e0a 0a20 2020 2020 2020  iation...       
+00003d00: 2054 6865 2069 6e70 7574 2061 6e64 206f   The input and o
+00003d10: 7574 7075 7420 706c 7567 7320 6172 6520  utput plugs are 
+00003d20: 6465 6669 6e65 6420 6865 7265 2e20 5468  defined here. Th
+00003d30: 6520 7370 6563 6961 6c0a 2020 2020 2020  e special.      
+00003d40: 2020 2773 656c 662e 7265 7175 6972 656d    'self.requirem
+00003d50: 656e 7427 2061 7474 7269 6275 7465 2028  ent' attribute (
+00003d60: 6f70 7469 6f6e 616c 2920 6973 2075 7365  optional) is use
+00003d70: 6420 746f 2064 6566 696e 6520 7468 650a  d to define the.
+00003d80: 2020 2020 2020 2020 7468 6972 642d 7061          third-pa
+00003d90: 7274 7920 7072 6f64 7563 7473 206e 6563  rty products nec
+00003da0: 6573 7361 7279 2066 6f72 2074 6865 2072  essary for the r
+00003db0: 756e 6e69 6e67 206f 6620 7468 6520 6272  unning of the br
+00003dc0: 6963 6b2e 0a20 2020 2020 2020 2022 2222  ick..        """
+00003dd0: 0a20 2020 2020 2020 2023 2049 6e69 7469  .        # Initi
+00003de0: 616c 6973 6174 696f 6e20 6f66 2074 6865  alisation of the
+00003df0: 206f 626a 6563 7473 206e 6565 6465 6420   objects needed 
+00003e00: 666f 7220 7468 6520 6c61 756e 6368 206f  for the launch o
+00003e10: 6620 7468 6520 6272 6963 6b0a 2020 2020  f the brick.    
+00003e20: 2020 2020 7375 7065 7228 4269 6e61 7269      super(Binari
+00003e30: 7a65 2c20 7365 6c66 292e 5f5f 696e 6974  ze, self).__init
+00003e40: 5f5f 2829 0a0a 2020 2020 2020 2020 2320  __()..        # 
+00003e50: 5468 6972 6420 7061 7274 7920 736f 6674  Third party soft
+00003e60: 7761 7265 7320 7265 7175 6972 6564 2066  wares required f
+00003e70: 6f72 2074 6865 2065 7865 6375 7469 6f6e  or the execution
+00003e80: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
+00003e90: 2020 2020 2020 7365 6c66 2e72 6571 7569        self.requi
+00003ea0: 7265 6d65 6e74 203d 205b 5d0a 0a20 2020  rement = []..   
+00003eb0: 2020 2020 2023 2049 6e70 7574 7320 6465       # Inputs de
+00003ec0: 7363 7269 7074 696f 6e0a 2020 2020 2020  scription.      
+00003ed0: 2020 696e 5f66 696c 6573 5f64 6573 6320    in_files_desc 
+00003ee0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00003ef0: 2241 206c 6973 7420 6f66 2069 7465 6d73  "A list of items
+00003f00: 2077 6974 6820 7374 7269 6e67 2065 6c65   with string ele
+00003f10: 6d65 6e74 7320 636f 7272 6573 706f 6e64  ments correspond
+00003f20: 696e 6720 220a 2020 2020 2020 2020 2020  ing ".          
+00003f30: 2020 2274 6f20 6578 6973 7469 6e67 2070    "to existing p
+00003f40: 6174 6820 6669 6c65 732e 220a 2020 2020  ath files.".    
+00003f50: 2020 2020 290a 2020 2020 2020 2020 7468      ).        th
+00003f60: 7265 7368 5f6c 6f77 5f64 6573 6320 3d20  resh_low_desc = 
+00003f70: 224c 6f77 6572 2074 6872 6573 686f 6c64  "Lower threshold
+00003f80: 2066 6f72 2062 696e 6172 697a 6174 696f   for binarizatio
+00003f90: 6e20 2866 6c6f 6174 292e 220a 2020 2020  n (float).".    
+00003fa0: 2020 2020 7072 6566 6978 5f64 6573 6320      prefix_desc 
+00003fb0: 3d20 2250 7265 6669 7820 6f66 2074 6865  = "Prefix of the
+00003fc0: 206f 7574 7075 7420 696d 6167 6573 2028   output images (
+00003fd0: 6120 7374 7269 6e67 292e 220a 2020 2020  a string).".    
+00003fe0: 2020 2020 7375 6666 6978 5f64 6573 6320      suffix_desc 
+00003ff0: 3d20 2253 7566 6669 7820 6f66 2074 6865  = "Suffix of the
+00004000: 206f 7574 7075 7420 696d 6167 6573 2028   output images (
+00004010: 6120 7374 7269 6e67 292e 220a 0a20 2020  a string)."..   
+00004020: 2020 2020 2023 204f 7574 7075 7473 2064       # Outputs d
+00004030: 6573 6372 6970 7469 6f6e 0a20 2020 2020  escription.     
+00004040: 2020 206f 7574 5f66 696c 6573 5f64 6573     out_files_des
+00004050: 6320 3d20 280a 2020 2020 2020 2020 2020  c = (.          
+00004060: 2020 2250 6174 6820 6f66 2074 6865 2073    "Path of the s
+00004070: 6361 6e20 6166 7465 7220 6170 706c 6963  can after applic
+00004080: 6174 696f 6e20 6f66 2074 6865 220a 2020  ation of the".  
+00004090: 2020 2020 2020 2020 2020 2262 696e 6172            "binar
+000040a0: 697a 6174 696f 6e20 2861 2070 6174 686c  ization (a pathl
+000040b0: 696b 6520 6f62 6a65 6374 206f 7220 7374  ike object or st
+000040c0: 7269 6e67 220a 2020 2020 2020 2020 2020  ring".          
+000040d0: 2020 2272 6570 7265 7365 6e74 696e 6720    "representing 
+000040e0: 6120 6669 6c65 2c20 6f72 2061 206c 6973  a file, or a lis
+000040f0: 7420 6f66 2070 6174 686c 696b 6522 0a20  t of pathlike". 
+00004100: 2020 2020 2020 2020 2020 2022 6f62 6a65             "obje
+00004110: 6374 7320 6f72 2073 7472 696e 6773 2072  cts or strings r
+00004120: 6570 7265 7365 6e74 696e 6720 6120 6669  epresenting a fi
+00004130: 6c65 292e 220a 2020 2020 2020 2020 290a  le).".        ).
+00004140: 0a20 2020 2020 2020 2023 2049 6e70 7574  .        # Input
+00004150: 7320 7472 6169 7473 0a20 2020 2020 2020  s traits.       
+00004160: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+00004170: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
+00004180: 5f66 696c 6573 222c 0a20 2020 2020 2020  _files",.       
+00004190: 2020 2020 2049 6e70 7574 4d75 6c74 6950       InputMultiP
+000041a0: 6174 6828 0a20 2020 2020 2020 2020 2020  ath(.           
+000041b0: 2020 2020 2074 7261 6974 732e 4569 7468       traits.Eith
+000041c0: 6572 2846 696c 6528 292c 2074 7261 6974  er(File(), trait
+000041d0: 732e 4c69 7374 2846 696c 6528 2929 292c  s.List(File())),
+000041e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000041f0: 206f 7574 7075 743d 4661 6c73 652c 0a20   output=False,. 
+00004200: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00004210: 6573 633d 696e 5f66 696c 6573 5f64 6573  esc=in_files_des
+00004220: 632c 0a20 2020 2020 2020 2020 2020 2029  c,.            )
+00004230: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00004240: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+00004250: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+00004260: 2022 7072 6566 6978 222c 0a20 2020 2020   "prefix",.     
+00004270: 2020 2020 2020 2074 7261 6974 732e 5374         traits.St
+00004280: 7269 6e67 2822 222c 206f 7574 7075 743d  ring("", output=
+00004290: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+000042a0: 5472 7565 2c20 6465 7363 3d70 7265 6669  True, desc=prefi
+000042b0: 785f 6465 7363 292c 0a20 2020 2020 2020  x_desc),.       
+000042c0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
+000042d0: 6164 645f 7472 6169 7428 0a20 2020 2020  add_trait(.     
+000042e0: 2020 2020 2020 2022 7375 6666 6978 222c         "suffix",
+000042f0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00004300: 6974 732e 5374 7269 6e67 280a 2020 2020  its.String(.    
+00004310: 2020 2020 2020 2020 2020 2020 225f 6269              "_bi
+00004320: 6e22 2c20 6f75 7470 7574 3d46 616c 7365  n", output=False
+00004330: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
+00004340: 2064 6573 633d 7375 6666 6978 5f64 6573   desc=suffix_des
+00004350: 630a 2020 2020 2020 2020 2020 2020 292c  c.            ),
+00004360: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00004370: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
+00004380: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+00004390: 2274 6872 6573 685f 6c6f 7722 2c0a 2020  "thresh_low",.  
+000043a0: 2020 2020 2020 2020 2020 7472 6169 7473            traits
+000043b0: 2e46 6c6f 6174 280a 2020 2020 2020 2020  .Float(.        
+000043c0: 2020 2020 2020 2020 6465 6661 756c 743d          default=
+000043d0: 302e 302c 206f 7574 7075 743d 4661 6c73  0.0, output=Fals
+000043e0: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
+000043f0: 2c20 6465 7363 3d74 6872 6573 685f 6c6f  , desc=thresh_lo
+00004400: 775f 6465 7363 0a20 2020 2020 2020 2020  w_desc.         
+00004410: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+00004420: 0a20 2020 2020 2020 2023 204f 7574 7075  .        # Outpu
+00004430: 7473 2074 7261 6974 730a 2020 2020 2020  ts traits.      
+00004440: 2020 7365 6c66 2e61 6464 5f74 7261 6974    self.add_trait
+00004450: 280a 2020 2020 2020 2020 2020 2020 226f  (.            "o
+00004460: 7574 5f66 696c 6573 222c 0a20 2020 2020  ut_files",.     
+00004470: 2020 2020 2020 204f 7574 7075 744d 756c         OutputMul
+00004480: 7469 5061 7468 2846 696c 6528 292c 206f  tiPath(File(), o
+00004490: 7574 7075 743d 5472 7565 2c20 6465 7363  utput=True, desc
+000044a0: 3d6f 7574 5f66 696c 6573 5f64 6573 6329  =out_files_desc)
+000044b0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000044c0: 2020 2020 2073 656c 662e 696e 6974 5f64       self.init_d
+000044d0: 6566 6175 6c74 5f74 7261 6974 7328 290a  efault_traits().
+000044e0: 0a20 2020 2064 6566 206c 6973 745f 6f75  .    def list_ou
+000044f0: 7470 7574 7328 7365 6c66 2c20 6973 5f70  tputs(self, is_p
+00004500: 6c75 6767 6564 3d4e 6f6e 6529 3a0a 2020  lugged=None):.  
+00004510: 2020 2020 2020 2222 2244 6564 6963 6174        """Dedicat
+00004520: 6564 2074 6f20 7468 6520 696e 6974 6961  ed to the initia
+00004530: 6c69 7361 7469 6f6e 2073 7465 7020 6f66  lisation step of
+00004540: 2074 6865 2062 7269 636b 2e0a 0a20 2020   the brick...   
+00004550: 2020 2020 2054 6865 206d 6169 6e20 6f62       The main ob
+00004560: 6a65 6374 6976 6520 6f66 2074 6869 7320  jective of this 
+00004570: 6d65 7468 6f64 2069 7320 746f 2070 726f  method is to pro
+00004580: 6475 6365 2074 6865 206f 7574 7075 7473  duce the outputs
+00004590: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+000045a0: 6272 6963 6b73 2028 7365 6c66 2e6f 7574  bricks (self.out
+000045b0: 7075 7473 2920 616e 6420 7468 6520 6173  puts) and the as
+000045c0: 736f 6369 6174 6564 2074 6167 7320 2873  sociated tags (s
+000045d0: 656c 662e 696e 6865 7269 7461 6e63 655f  elf.inheritance_
+000045e0: 6469 6329 2c0a 2020 2020 2020 2020 6966  dic),.        if
+000045f0: 2064 6566 696e 6564 2068 6572 652e 2054   defined here. T
+00004600: 6f20 776f 726b 2070 726f 7065 726c 7920  o work properly 
+00004610: 7468 6973 206d 6574 686f 6420 6d75 7374  this method must
+00004620: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+00004630: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
+00004640: 7375 6c74 2829 206f 626a 6563 742e 0a0a  sult() object...
+00004650: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+00004660: 735f 706c 7567 6765 643a 2074 6865 2073  s_plugged: the s
+00004670: 7461 7465 2c20 6c69 6e6b 6564 206f 7220  tate, linked or 
+00004680: 6e6f 742c 206f 6620 7468 6520 706c 7567  not, of the plug
+00004690: 732e 0a20 2020 2020 2020 203a 7265 7475  s..        :retu
+000046a0: 726e 733a 2061 2064 6963 7469 6f6e 6172  rns: a dictionar
+000046b0: 7920 7769 7468 2072 6571 7569 7265 6d65  y with requireme
+000046c0: 6e74 2c20 6f75 7470 7574 7320 616e 6420  nt, outputs and 
+000046d0: 696e 6865 7269 7461 6e63 655f 6469 6374  inheritance_dict
+000046e0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000046f0: 2020 2020 2020 2320 5573 696e 6720 7468        # Using th
+00004700: 6520 696e 6865 7269 7461 6e63 6520 746f  e inheritance to
+00004710: 2050 726f 6365 7373 4d49 4120 636c 6173   ProcessMIA clas
+00004720: 732c 206c 6973 745f 6f75 7470 7574 7320  s, list_outputs 
+00004730: 6d65 7468 6f64 0a20 2020 2020 2020 2073  method.        s
+00004740: 7570 6572 2842 696e 6172 697a 652c 2073  uper(Binarize, s
+00004750: 656c 6629 2e6c 6973 745f 6f75 7470 7574  elf).list_output
+00004760: 7328 290a 0a20 2020 2020 2020 2023 204f  s()..        # O
+00004770: 7574 7075 7473 2064 6566 696e 6974 696f  utputs definitio
+00004780: 6e0a 2020 2020 2020 2020 6966 2073 656c  n.        if sel
+00004790: 662e 696e 5f66 696c 6573 3a0a 2020 2020  f.in_files:.    
+000047a0: 2020 2020 2020 2020 6669 6c65 735f 6e61          files_na
+000047b0: 6d65 203d 2073 656c 662e 696e 5f66 696c  me = self.in_fil
+000047c0: 6573 0a0a 2020 2020 2020 2020 2020 2020  es..            
+000047d0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+000047e0: 2020 2020 2028 6e6f 7420 7365 6c66 2e73       (not self.s
+000047f0: 7566 6669 7829 0a20 2020 2020 2020 2020  uffix).         
+00004800: 2020 2020 2020 206f 7220 2873 656c 662e         or (self.
+00004810: 7375 6666 6978 2e69 7373 7061 6365 2829  suffix.isspace()
+00004820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004830: 2020 6f72 2073 656c 662e 7375 6666 6978    or self.suffix
+00004840: 2069 6e20 5b55 6e64 6566 696e 6564 2c20   in [Undefined, 
+00004850: 223c 756e 6465 6669 6e65 643e 225d 0a20  "<undefined>"]. 
+00004860: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+00004870: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004880: 6c66 2e73 7566 6669 7820 3d20 2220 220a  lf.suffix = " ".
+00004890: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000048a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000048b0: 2020 286e 6f74 2073 656c 662e 7072 6566    (not self.pref
+000048c0: 6978 290a 2020 2020 2020 2020 2020 2020  ix).            
+000048d0: 2020 2020 6f72 2028 7365 6c66 2e70 7265      or (self.pre
+000048e0: 6669 782e 6973 7370 6163 6528 2929 0a20  fix.isspace()). 
+000048f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00004900: 7220 2873 656c 662e 7072 6566 6978 2069  r (self.prefix i
+00004910: 6e20 5b55 6e64 6566 696e 6564 2c20 223c  n [Undefined, "<
+00004920: 756e 6465 6669 6e65 643e 225d 290a 2020  undefined>"]).  
+00004930: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00004940: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00004950: 662e 7072 6566 6978 203d 2022 2022 0a0a  f.prefix = " "..
+00004960: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00004970: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+00004980: 2020 2066 6c61 6720 3d20 5472 7565 2020     flag = True  
+00004990: 2320 4966 2046 616c 7365 2c20 7375 662f  # If False, suf/
+000049a0: 7072 6566 2063 6865 636b 2077 696c 6c20  pref check will 
+000049b0: 6e6f 7420 6265 2070 6572 666f 726d 6564  not be performed
+000049c0: 206c 6174 6572 0a0a 2020 2020 2020 2020   later..        
+000049d0: 2020 2020 666f 7220 6669 6c65 5f6e 616d      for file_nam
+000049e0: 6531 2069 6e20 6669 6c65 735f 6e61 6d65  e1 in files_name
+000049f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004a00: 2020 7661 6c69 645f 6578 742c 2069 6e5f    valid_ext, in_
+00004a10: 6578 742c 2066 696c 654e 616d 6520 3d20  ext, fileName = 
+00004a20: 6368 6563 6b46 696c 6545 7874 2866 696c  checkFileExt(fil
+00004a30: 655f 6e61 6d65 312c 2045 5854 290a 2020  e_name1, EXT).  
+00004a40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00004a50: 206e 6f74 2076 616c 6964 5f65 7874 3a0a   not valid_ext:.
+00004a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a70: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
 00004a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a90: 2020 2020 2020 2272 6563 6f67 6e69 7a65        "recognize
-00004aa0: 642e 2e2e 2122 0a20 2020 2020 2020 2020  d...!".         
-00004ab0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ad0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-00004ae0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00004af0: 2e73 7566 6669 7820 3d3d 2022 2022 2061  .suffix == " " a
-00004b00: 6e64 2073 656c 662e 7072 6566 6978 203d  nd self.prefix =
-00004b10: 3d20 2220 2220 616e 6420 666c 6167 2069  = " " and flag i
-00004b20: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
-00004b30: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-00004b40: 3d20 514d 6573 7361 6765 426f 7828 290a  = QMessageBox().
-00004b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b60: 2020 2020 6d73 672e 7365 7449 636f 6e28      msg.setIcon(
-00004b70: 514d 6573 7361 6765 426f 782e 5761 726e  QMessageBox.Warn
-00004b80: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
-00004b90: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-00004ba0: 5769 6e64 6f77 5469 746c 6528 0a20 2020  WindowTitle(.   
-00004bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bc0: 2020 2020 2022 6d69 615f 7072 6f63 6573       "mia_proces
-00004bd0: 7365 7320 2d20 4269 6e61 7269 7a65 2062  ses - Binarize b
-00004be0: 7269 636b 2057 6172 6e69 6e67 2122 0a20  rick Warning!". 
-00004bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00004c10: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-00004c20: 5465 7874 280a 2020 2020 2020 2020 2020  Text(.          
-00004c30: 2020 2020 2020 2020 2020 2020 2020 2253                "S
-00004c40: 7566 6669 7820 616e 6420 7072 6566 6978  uffix and prefix
-00004c50: 2069 6e70 7574 2070 6172 616d 6574 6572   input parameter
-00004c60: 7320 6172 6520 6e6f 7420 220a 2020 2020  s are not ".    
+00004a90: 2020 2022 5c6e 4269 6e61 7269 7a65 2062     "\nBinarize b
+00004aa0: 7269 636b 3a20 5468 6520 696e 7075 7420  rick: The input 
+00004ab0: 696d 6167 6520 666f 726d 6174 2069 7320  image format is 
+00004ac0: 6e6f 7420 220a 2020 2020 2020 2020 2020  not ".          
+00004ad0: 2020 2020 2020 2020 2020 2020 2020 2272                "r
+00004ae0: 6563 6f67 6e69 7a65 642e 2e2e 2122 0a20  ecognized...!". 
+00004af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00004b10: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00004b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004b30: 2069 6620 7365 6c66 2e73 7566 6669 7820   if self.suffix 
+00004b40: 3d3d 2022 2022 2061 6e64 2073 656c 662e  == " " and self.
+00004b50: 7072 6566 6978 203d 3d20 2220 2220 616e  prefix == " " an
+00004b60: 6420 666c 6167 2069 7320 5472 7565 3a0a  d flag is True:.
+00004b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b80: 2020 2020 6d73 6720 3d20 514d 6573 7361      msg = QMessa
+00004b90: 6765 426f 7828 290a 2020 2020 2020 2020  geBox().        
+00004ba0: 2020 2020 2020 2020 2020 2020 6d73 672e              msg.
+00004bb0: 7365 7449 636f 6e28 514d 6573 7361 6765  setIcon(QMessage
+00004bc0: 426f 782e 5761 726e 696e 6729 0a20 2020  Box.Warning).   
+00004bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004be0: 206d 7367 2e73 6574 5769 6e64 6f77 5469   msg.setWindowTi
+00004bf0: 746c 6528 0a20 2020 2020 2020 2020 2020  tle(.           
+00004c00: 2020 2020 2020 2020 2020 2020 2022 6d69               "mi
+00004c10: 615f 7072 6f63 6573 7365 7320 2d20 4269  a_processes - Bi
+00004c20: 6e61 7269 7a65 2062 7269 636b 2057 6172  narize brick War
+00004c30: 6e69 6e67 2122 0a20 2020 2020 2020 2020  ning!".         
+00004c40: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c60: 206d 7367 2e73 6574 5465 7874 280a 2020   msg.setText(.  
 00004c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c80: 2020 2020 2264 6566 696e 6564 206f 7220      "defined or 
-00004c90: 636f 6e73 6973 7420 6f6e 6c79 206f 6620  consist only of 
-00004ca0: 6f6e 6520 6f72 206d 6f72 6520 7768 6974  one or more whit
-00004cb0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-00004cc0: 2020 2020 2020 2020 2020 2020 2273 7061              "spa
-00004cd0: 6365 732e 5c6e 5468 6520 7b30 7d20 696e  ces.\nThe {0} in
-00004ce0: 7075 7420 7061 7261 6d65 7465 7220 7769  put parameter wi
-00004cf0: 6c6c 2062 6520 220a 2020 2020 2020 2020  ll be ".        
+00004c80: 2020 2020 2020 2253 7566 6669 7820 616e        "Suffix an
+00004c90: 6420 7072 6566 6978 2069 6e70 7574 2070  d prefix input p
+00004ca0: 6172 616d 6574 6572 7320 6172 6520 6e6f  arameters are no
+00004cb0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
+00004cc0: 2020 2020 2020 2020 2020 2020 2264 6566              "def
+00004cd0: 696e 6564 206f 7220 636f 6e73 6973 7420  ined or consist 
+00004ce0: 6f6e 6c79 206f 6620 6f6e 6520 6f72 206d  only of one or m
+00004cf0: 6f72 6520 7768 6974 6520 220a 2020 2020  ore white ".    
 00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d10: 226f 7665 7277 7269 7474 656e 202e 2e2e  "overwritten ...
-00004d20: 5c6e 2059 6573 206f 7220 220a 2020 2020  \n Yes or ".    
-00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d40: 2020 2020 2241 626f 7274 3f22 2e66 6f72      "Abort?".for
-00004d50: 6d61 7428 6669 6c65 5f6e 616d 6531 290a  mat(file_name1).
-00004d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d70: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00004d80: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
-00004d90: 7453 7461 6e64 6172 6442 7574 746f 6e73  tStandardButtons
-00004da0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00004db0: 2020 2020 2020 2020 2020 514d 6573 7361            QMessa
-00004dc0: 6765 426f 782e 5965 730a 2020 2020 2020  geBox.Yes.      
-00004dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004de0: 2020 7c20 514d 6573 7361 6765 426f 782e    | QMessageBox.
-00004df0: 5965 7354 6f41 6c6c 0a20 2020 2020 2020  YesToAll.       
-00004e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e10: 207c 2051 4d65 7373 6167 6542 6f78 2e41   | QMessageBox.A
-00004e20: 626f 7274 0a20 2020 2020 2020 2020 2020  bort.           
-00004e30: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00004e40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004e50: 6574 7661 6c20 3d20 6d73 672e 6578 6563  etval = msg.exec
-00004e60: 5f28 290a 0a20 2020 2020 2020 2020 2020  _()..           
-00004e70: 2020 2020 2020 2020 2069 6620 7265 7476           if retv
-00004e80: 616c 2021 3d20 514d 6573 7361 6765 426f  al != QMessageBo
-00004e90: 782e 4162 6f72 743a 0a20 2020 2020 2020  x.Abort:.       
-00004ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004eb0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-00004ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ed0: 2020 2020 225c 6e42 696e 6172 697a 6520      "\nBinarize 
-00004ee0: 6272 6963 6b20 7761 726e 696e 673a 2074  brick warning: t
-00004ef0: 6865 206f 7574 5f66 696c 6573 206f 7574  he out_files out
-00004f00: 7075 7420 220a 2020 2020 2020 2020 2020  put ".          
-00004f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f20: 2020 2270 6172 616d 6574 6572 2069 7320    "parameter is 
-00004f30: 7468 6520 7361 6d65 2061 7320 7468 6520  the same as the 
-00004f40: 696e 5f66 696c 6573 2069 6e70 7574 2022  in_files input "
-00004f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004f60: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
-00004f70: 7261 6d65 7465 7220 2873 7566 6669 7820  rameter (suffix 
-00004f80: 616e 6420 7072 6566 6978 2061 7265 206e  and prefix are n
-00004f90: 6f74 2064 6566 696e 6564 293a 220a 2020  ot defined):".  
+00004d10: 2020 2020 2273 7061 6365 732e 5c6e 5468      "spaces.\nTh
+00004d20: 6520 7b30 7d20 696e 7075 7420 7061 7261  e {0} input para
+00004d30: 6d65 7465 7220 7769 6c6c 2062 6520 220a  meter will be ".
+00004d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d50: 2020 2020 2020 2020 226f 7665 7277 7269          "overwri
+00004d60: 7474 656e 202e 2e2e 5c6e 2059 6573 206f  tten ...\n Yes o
+00004d70: 7220 220a 2020 2020 2020 2020 2020 2020  r ".            
+00004d80: 2020 2020 2020 2020 2020 2020 2241 626f              "Abo
+00004d90: 7274 3f22 2e66 6f72 6d61 7428 6669 6c65  rt?".format(file
+00004da0: 5f6e 616d 6531 290a 2020 2020 2020 2020  _name1).        
+00004db0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004dd0: 2020 6d73 672e 7365 7453 7461 6e64 6172    msg.setStandar
+00004de0: 6442 7574 746f 6e73 280a 2020 2020 2020  dButtons(.      
+00004df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e00: 2020 514d 6573 7361 6765 426f 782e 5965    QMessageBox.Ye
+00004e10: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00004e20: 2020 2020 2020 2020 2020 7c20 514d 6573            | QMes
+00004e30: 7361 6765 426f 782e 5965 7354 6f41 6c6c  sageBox.YesToAll
+00004e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004e50: 2020 2020 2020 2020 207c 2051 4d65 7373           | QMess
+00004e60: 6167 6542 6f78 2e41 626f 7274 0a20 2020  ageBox.Abort.   
+00004e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e80: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00004e90: 2020 2020 2020 2072 6574 7661 6c20 3d20         retval = 
+00004ea0: 6d73 672e 6578 6563 5f28 290a 0a20 2020  msg.exec_()..   
+00004eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ec0: 2069 6620 7265 7476 616c 2021 3d20 514d   if retval != QM
+00004ed0: 6573 7361 6765 426f 782e 4162 6f72 743a  essageBox.Abort:
+00004ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004ef0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+00004f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f10: 2020 2020 2020 2020 2020 2020 225c 6e42              "\nB
+00004f20: 696e 6172 697a 6520 6272 6963 6b20 7761  inarize brick wa
+00004f30: 726e 696e 673a 2074 6865 206f 7574 5f66  rning: the out_f
+00004f40: 696c 6573 206f 7574 7075 7420 220a 2020  iles output ".  
+00004f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f60: 2020 2020 2020 2020 2020 2270 6172 616d            "param
+00004f70: 6574 6572 2069 7320 7468 6520 7361 6d65  eter is the same
+00004f80: 2061 7320 7468 6520 696e 5f66 696c 6573   as the in_files
+00004f90: 2069 6e70 7574 2022 0a20 2020 2020 2020   input ".       
 00004fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fb0: 2020 2020 2020 2020 2020 225c 6e7b 307d            "\n{0}
-00004fc0: 2077 696c 6c20 6265 206f 7665 7277 7269   will be overwri
-00004fd0: 7465 6420 2e2e 2e22 2e66 6f72 6d61 7428  ted ...".format(
-00004fe0: 6669 6c65 5f6e 616d 6531 290a 2020 2020  file_name1).    
+00004fb0: 2020 2020 2022 7061 7261 6d65 7465 7220       "parameter 
+00004fc0: 2873 7566 6669 7820 616e 6420 7072 6566  (suffix and pref
+00004fd0: 6978 2061 7265 206e 6f74 2064 6566 696e  ix are not defin
+00004fe0: 6564 293a 220a 2020 2020 2020 2020 2020  ed):".          
 00004ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005000: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00005010: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00005020: 6620 7265 7476 616c 203d 3d20 514d 6573  f retval == QMes
-00005030: 7361 6765 426f 782e 5965 7354 6f41 6c6c  sageBox.YesToAll
-00005040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005050: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00005060: 6167 203d 2046 616c 7365 0a20 2020 2020  ag = False.     
-00005070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005080: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00005000: 2020 225c 6e7b 307d 2077 696c 6c20 6265    "\n{0} will be
+00005010: 206f 7665 7277 7269 7465 6420 2e2e 2e22   overwrited ..."
+00005020: 2e66 6f72 6d61 7428 6669 6c65 5f6e 616d  .format(file_nam
+00005030: 6531 290a 2020 2020 2020 2020 2020 2020  e1).            
+00005040: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00005050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005060: 2020 2020 2020 2069 6620 7265 7476 616c         if retval
+00005070: 203d 3d20 514d 6573 7361 6765 426f 782e   == QMessageBox.
+00005080: 5965 7354 6f41 6c6c 3a0a 2020 2020 2020  YesToAll:.      
 00005090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050a0: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-000050b0: 6e42 696e 6172 697a 6520 6272 6963 6b3a  nBinarize brick:
-000050c0: 2059 6573 546f 416c 6c20 7365 6c65 6374   YesToAll select
-000050d0: 6564 203b 2065 6e64 206f 6620 220a 2020  ed ; end of ".  
+000050a0: 2020 2020 2020 666c 6167 203d 2046 616c        flag = Fal
+000050b0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+000050c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000050d0: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
 000050e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050f0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-00005100: 7665 7277 7269 7465 2063 6865 636b 7320  verwrite checks 
-00005110: 6f6e 2069 6e70 7574 2069 6d61 6765 7320  on input images 
-00005120: 2e2e 2e22 0a20 2020 2020 2020 2020 2020  ...".           
+000050f0: 2020 2020 2020 225c 6e42 696e 6172 697a        "\nBinariz
+00005100: 6520 6272 6963 6b3a 2059 6573 546f 416c  e brick: YesToAl
+00005110: 6c20 7365 6c65 6374 6564 203b 2065 6e64  l selected ; end
+00005120: 206f 6620 220a 2020 2020 2020 2020 2020   of ".          
 00005130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005140: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00005150: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00005160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005170: 2020 2020 2066 696c 6573 5f6e 616d 6520       files_name 
-00005180: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00005190: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000051a0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-000051b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051c0: 225c 6e42 696e 6172 697a 6520 6272 6963  "\nBinarize bric
-000051d0: 6b3a 2049 6e69 7469 616c 697a 6174 696f  k: Initializatio
-000051e0: 6e20 4162 6f72 7465 642e 2050 6c65 6173  n Aborted. Pleas
-000051f0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-00005200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005210: 2263 6865 636b 2079 6f75 7220 696e 7075  "check your inpu
-00005220: 7420 7061 7261 6d65 7465 7273 202e 2e2e  t parameters ...
-00005230: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00005240: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00005250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005260: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00005270: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00005280: 732e 6170 7065 6e64 280a 2020 2020 2020  s.append(.      
-00005290: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-000052a0: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
-000052b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052c0: 2020 2020 7365 6c66 2e6f 7574 7075 745f      self.output_
-000052d0: 6469 7265 6374 6f72 792c 0a20 2020 2020  directory,.     
-000052e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052f0: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
-00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005310: 2073 656c 662e 7072 6566 6978 2e73 7472   self.prefix.str
-00005320: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
-00005330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005340: 202b 2066 696c 654e 616d 650a 2020 2020   + fileName.    
-00005350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005360: 2020 2020 2020 2020 2b20 7365 6c66 2e73          + self.s
-00005370: 7566 6669 782e 7374 7269 7028 290a 2020  uffix.strip().  
-00005380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005390: 2020 2020 2020 2020 2020 2b20 222e 220a            + ".".
+00005140: 2020 2020 2020 226f 7665 7277 7269 7465        "overwrite
+00005150: 2063 6865 636b 7320 6f6e 2069 6e70 7574   checks on input
+00005160: 2069 6d61 6765 7320 2e2e 2e22 0a20 2020   images ...".   
+00005170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005180: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00005190: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000051a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000051b0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+000051c0: 6573 5f6e 616d 6520 3d20 5b5d 0a20 2020  es_name = [].   
+000051d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000051e0: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+000051f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005200: 2020 2020 2020 2020 225c 6e42 696e 6172          "\nBinar
+00005210: 697a 6520 6272 6963 6b3a 2049 6e69 7469  ize brick: Initi
+00005220: 616c 697a 6174 696f 6e20 4162 6f72 7465  alization Aborte
+00005230: 642e 2050 6c65 6173 6520 220a 2020 2020  d. Please ".    
+00005240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005250: 2020 2020 2020 2020 2263 6865 636b 2079          "check y
+00005260: 6f75 7220 696e 7075 7420 7061 7261 6d65  our input parame
+00005270: 7465 7273 202e 2e2e 220a 2020 2020 2020  ters ...".      
+00005280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005290: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+000052a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000052b0: 726e 0a0a 2020 2020 2020 2020 2020 2020  rn..            
+000052c0: 2020 2020 6669 6c65 732e 6170 7065 6e64      files.append
+000052d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000052e0: 2020 2020 2020 6f73 2e70 6174 682e 6a6f        os.path.jo
+000052f0: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
+00005300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005310: 2e6f 7574 7075 745f 6469 7265 6374 6f72  .output_director
+00005320: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00005330: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+00005340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005350: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00005360: 6566 6978 2e73 7472 6970 2829 0a20 2020  efix.strip().   
+00005370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005380: 2020 2020 2020 2020 202b 2066 696c 654e           + fileN
+00005390: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
 000053a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053b0: 2020 2020 2020 2020 2020 2020 2b20 696e              + in
-000053c0: 5f65 7874 0a20 2020 2020 2020 2020 2020  _ext.           
-000053d0: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-000053e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00005400: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00005410: 2020 2020 2069 6620 6669 6c65 733a 0a20       if files:. 
-00005420: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00005430: 656c 662e 6f75 7470 7574 735b 226f 7574  elf.outputs["out
-00005440: 5f66 696c 6573 225d 203d 2066 696c 6573  _files"] = files
-00005450: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00005460: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00005470: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-00005480: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00005490: 2d20 4269 6e61 7269 7a65 2062 7269 636b  - Binarize brick
-000054a0: 3a20 5468 6572 6520 7761 7320 6e6f 206f  : There was no o
-000054b0: 7574 7075 7420 6669 6c65 2064 6564 7563  utput file deduc
-000054c0: 7465 6420 220a 2020 2020 2020 2020 2020  ted ".          
-000054d0: 2020 2020 2020 2020 2020 2264 7572 696e            "durin
-000054e0: 6720 696e 6974 6961 6c69 7a61 7469 6f6e  g initialization
-000054f0: 2e20 506c 6561 7365 2063 6865 636b 2074  . Please check t
-00005500: 6865 2022 0a20 2020 2020 2020 2020 2020  he ".           
-00005510: 2020 2020 2020 2020 2022 696e 7075 7420           "input 
-00005520: 7061 7261 6d65 7465 7273 2e2e 2e21 220a  parameters...!".
-00005530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005540: 290a 0a20 2020 2020 2020 2023 2074 6167  )..        # tag
-00005550: 7320 696e 6865 7269 7461 6e63 6520 286f  s inheritance (o
-00005560: 7074 696f 6e61 6c29 0a20 2020 2020 2020  ptional).       
-00005570: 2069 6620 7365 6c66 2e6f 7574 7075 7473   if self.outputs
-00005580: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00005590: 7220 6b65 792c 2076 616c 2069 6e20 7365  r key, val in se
-000055a0: 6c66 2e6f 7574 7075 7473 2e69 7465 6d73  lf.outputs.items
-000055b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000055c0: 2020 2020 6966 206b 6579 203d 3d20 226f      if key == "o
-000055d0: 7574 5f66 696c 6573 223a 0a20 2020 2020  ut_files":.     
-000055e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000055f0: 6f72 2069 6e5f 7661 6c2c 206f 7574 5f76  or in_val, out_v
-00005600: 616c 2069 6e20 7a69 7028 6669 6c65 735f  al in zip(files_
-00005610: 6e61 6d65 2c20 7661 6c29 3a0a 2020 2020  name, val):.    
-00005620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005630: 2020 2020 5f2c 2066 696c 654f 7661 6c20      _, fileOval 
-00005640: 3d20 6f73 2e70 6174 682e 7370 6c69 7428  = os.path.split(
-00005650: 6f75 745f 7661 6c29 0a20 2020 2020 2020  out_val).       
-00005660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005670: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
-00005680: 2c20 6669 6c65 5f65 7874 656e 7369 6f6e  , file_extension
-00005690: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-000056a0: 6578 7428 0a20 2020 2020 2020 2020 2020  ext(.           
-000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056c0: 2066 696c 654f 7661 6c0a 2020 2020 2020   fileOval.      
-000056d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056e0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-000056f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005700: 6669 6c65 5f65 7874 656e 7369 6f6e 203d  file_extension =
-00005710: 3d20 222e 677a 223a 0a20 2020 2020 2020  = ".gz":.       
-00005720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005730: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-00005740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005750: 2020 2020 2020 2066 696c 654f 7661 6c5f         fileOval_
-00005760: 6e6f 5f65 7874 5f32 2c0a 2020 2020 2020  no_ext_2,.      
-00005770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005780: 2020 2020 2020 2020 2020 6669 6c65 5f65            file_e
-00005790: 7874 656e 7369 6f6e 5f32 2c0a 2020 2020  xtension_2,.    
-000057a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057b0: 2020 2020 2020 2020 2920 3d20 6f73 2e70          ) = os.p
-000057c0: 6174 682e 7370 6c69 7465 7874 2866 696c  ath.splitext(fil
-000057d0: 654f 7661 6c5f 6e6f 5f65 7874 290a 2020  eOval_no_ext).  
-000057e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057f0: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-00005800: 655f 6578 7465 6e73 696f 6e5f 3220 3d3d  e_extension_2 ==
-00005810: 2022 2e6e 6969 223a 0a20 2020 2020 2020   ".nii":.       
-00005820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005830: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
-00005840: 6c5f 6e6f 5f65 7874 203d 2066 696c 654f  l_no_ext = fileO
-00005850: 7661 6c5f 6e6f 5f65 7874 5f32 0a0a 2020  val_no_ext_2..  
-00005860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005870: 2020 2020 2020 5f2c 2066 696c 6549 7661        _, fileIva
-00005880: 6c20 3d20 6f73 2e70 6174 682e 7370 6c69  l = os.path.spli
-00005890: 7428 696e 5f76 616c 290a 2020 2020 2020  t(in_val).      
-000058a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058b0: 2020 6669 6c65 4976 616c 5f6e 6f5f 6578    fileIval_no_ex
-000058c0: 742c 2066 696c 655f 6578 7465 6e73 696f  t, file_extensio
-000058d0: 6e20 3d20 6f73 2e70 6174 682e 7370 6c69  n = os.path.spli
-000058e0: 7465 7874 280a 2020 2020 2020 2020 2020  text(.          
-000058f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005900: 2020 6669 6c65 4976 616c 0a20 2020 2020    fileIval.     
-00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005920: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00005930: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005940: 2066 696c 655f 6578 7465 6e73 696f 6e20   file_extension 
-00005950: 3d3d 2022 2e67 7a22 3a0a 2020 2020 2020  == ".gz":.      
-00005960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005970: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005990: 2020 2020 2020 2020 6669 6c65 4976 616c          fileIval
-000059a0: 5f6e 6f5f 6578 745f 322c 0a20 2020 2020  _no_ext_2,.     
-000059b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059c0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-000059d0: 6578 7465 6e73 696f 6e5f 322c 0a20 2020  extension_2,.   
-000059e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059f0: 2020 2020 2020 2020 2029 203d 206f 732e           ) = os.
-00005a00: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
-00005a10: 6c65 4976 616c 5f6e 6f5f 6578 7429 0a20  leIval_no_ext). 
-00005a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a30: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-00005a40: 6c65 5f65 7874 656e 7369 6f6e 5f32 203d  le_extension_2 =
-00005a50: 3d20 222e 6e69 6922 3a0a 2020 2020 2020  = ".nii":.      
-00005a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a70: 2020 2020 2020 2020 2020 6669 6c65 4976            fileIv
-00005a80: 616c 5f6e 6f5f 6578 7420 3d20 6669 6c65  al_no_ext = file
-00005a90: 4976 616c 5f6e 6f5f 6578 745f 320a 0a20  Ival_no_ext_2.. 
-00005aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ab0: 2020 2020 2020 2069 6620 2873 656c 662e         if (self.
-00005ac0: 7072 6566 6978 2920 616e 6420 280a 2020  prefix) and (.  
-00005ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ae0: 2020 2020 2020 2020 2020 6669 6c65 4f76            fileOv
-00005af0: 616c 5f6e 6f5f 6578 742e 7374 6172 7473  al_no_ext.starts
-00005b00: 7769 7468 2873 656c 662e 7072 6566 6978  with(self.prefix
-00005b10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005b20: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
-00005b50: 6f66 660a 2020 2020 2020 2020 2020 2020  off.            
+000053b0: 2b20 7365 6c66 2e73 7566 6669 782e 7374  + self.suffix.st
+000053c0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
+000053d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000053e0: 2020 2b20 222e 220a 2020 2020 2020 2020    + ".".        
+000053f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005400: 2020 2020 2b20 696e 5f65 7874 0a20 2020      + in_ext.   
+00005410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005420: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00005430: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00005440: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00005450: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005460: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+00005470: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
+00005480: 7574 735b 226f 7574 5f66 696c 6573 225d  uts["out_files"]
+00005490: 203d 2066 696c 6573 0a0a 2020 2020 2020   = files..      
+000054a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000054b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000054c0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+000054d0: 2020 2020 2020 2022 2d20 4269 6e61 7269         "- Binari
+000054e0: 7a65 2062 7269 636b 3a20 5468 6572 6520  ze brick: There 
+000054f0: 7761 7320 6e6f 206f 7574 7075 7420 6669  was no output fi
+00005500: 6c65 2064 6564 7563 7465 6420 220a 2020  le deducted ".  
+00005510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005520: 2020 2264 7572 696e 6720 696e 6974 6961    "during initia
+00005530: 6c69 7a61 7469 6f6e 2e20 506c 6561 7365  lization. Please
+00005540: 2063 6865 636b 2074 6865 2022 0a20 2020   check the ".   
+00005550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005560: 2022 696e 7075 7420 7061 7261 6d65 7465   "input paramete
+00005570: 7273 2e2e 2e21 220a 2020 2020 2020 2020  rs...!".        
+00005580: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00005590: 2020 2023 2074 6167 7320 696e 6865 7269     # tags inheri
+000055a0: 7461 6e63 6520 286f 7074 696f 6e61 6c29  tance (optional)
+000055b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000055c0: 2e6f 7574 7075 7473 3a0a 2020 2020 2020  .outputs:.      
+000055d0: 2020 2020 2020 666f 7220 6b65 792c 2076        for key, v
+000055e0: 616c 2069 6e20 7365 6c66 2e6f 7574 7075  al in self.outpu
+000055f0: 7473 2e69 7465 6d73 2829 3a0a 2020 2020  ts.items():.    
+00005600: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00005610: 6579 203d 3d20 226f 7574 5f66 696c 6573  ey == "out_files
+00005620: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00005630: 2020 2020 2020 2066 6f72 2069 6e5f 7661         for in_va
+00005640: 6c2c 206f 7574 5f76 616c 2069 6e20 7a69  l, out_val in zi
+00005650: 7028 6669 6c65 735f 6e61 6d65 2c20 7661  p(files_name, va
+00005660: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
+00005670: 2020 2020 2020 2020 2020 2020 5f2c 2066              _, f
+00005680: 696c 654f 7661 6c20 3d20 6f73 2e70 6174  ileOval = os.pat
+00005690: 682e 7370 6c69 7428 6f75 745f 7661 6c29  h.split(out_val)
+000056a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000056b0: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
+000056c0: 6c5f 6e6f 5f65 7874 2c20 6669 6c65 5f65  l_no_ext, file_e
+000056d0: 7874 656e 7369 6f6e 203d 206f 732e 7061  xtension = os.pa
+000056e0: 7468 2e73 706c 6974 6578 7428 0a20 2020  th.splitext(.   
+000056f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005700: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
+00005710: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00005720: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00005730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005740: 2020 2020 2069 6620 6669 6c65 5f65 7874       if file_ext
+00005750: 656e 7369 6f6e 203d 3d20 222e 677a 223a  ension == ".gz":
+00005760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005770: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
+00005780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005790: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000057a0: 696c 654f 7661 6c5f 6e6f 5f65 7874 5f32  ileOval_no_ext_2
+000057b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000057c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057d0: 2020 6669 6c65 5f65 7874 656e 7369 6f6e    file_extension
+000057e0: 5f32 2c0a 2020 2020 2020 2020 2020 2020  _2,.            
+000057f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005800: 2920 3d20 6f73 2e70 6174 682e 7370 6c69  ) = os.path.spli
+00005810: 7465 7874 2866 696c 654f 7661 6c5f 6e6f  text(fileOval_no
+00005820: 5f65 7874 290a 2020 2020 2020 2020 2020  _ext).          
+00005830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005840: 2020 6966 2066 696c 655f 6578 7465 6e73    if file_extens
+00005850: 696f 6e5f 3220 3d3d 2022 2e6e 6969 223a  ion_2 == ".nii":
+00005860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005880: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
+00005890: 203d 2066 696c 654f 7661 6c5f 6e6f 5f65   = fileOval_no_e
+000058a0: 7874 5f32 0a0a 2020 2020 2020 2020 2020  xt_2..          
+000058b0: 2020 2020 2020 2020 2020 2020 2020 5f2c                _,
+000058c0: 2066 696c 6549 7661 6c20 3d20 6f73 2e70   fileIval = os.p
+000058d0: 6174 682e 7370 6c69 7428 696e 5f76 616c  ath.split(in_val
+000058e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000058f0: 2020 2020 2020 2020 2020 6669 6c65 4976            fileIv
+00005900: 616c 5f6e 6f5f 6578 742c 2066 696c 655f  al_no_ext, file_
+00005910: 6578 7465 6e73 696f 6e20 3d20 6f73 2e70  extension = os.p
+00005920: 6174 682e 7370 6c69 7465 7874 280a 2020  ath.splitext(.  
+00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005940: 2020 2020 2020 2020 2020 6669 6c65 4976            fileIv
+00005950: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
+00005960: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00005970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005980: 2020 2020 2020 6966 2066 696c 655f 6578        if file_ex
+00005990: 7465 6e73 696f 6e20 3d3d 2022 2e67 7a22  tension == ".gz"
+000059a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000059b0: 2020 2020 2020 2020 2020 2020 2020 280a                (.
+000059c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059e0: 6669 6c65 4976 616c 5f6e 6f5f 6578 745f  fileIval_no_ext_
+000059f0: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+00005a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a10: 2020 2066 696c 655f 6578 7465 6e73 696f     file_extensio
+00005a20: 6e5f 322c 0a20 2020 2020 2020 2020 2020  n_2,.           
+00005a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a40: 2029 203d 206f 732e 7061 7468 2e73 706c   ) = os.path.spl
+00005a50: 6974 6578 7428 6669 6c65 4976 616c 5f6e  itext(fileIval_n
+00005a60: 6f5f 6578 7429 0a20 2020 2020 2020 2020  o_ext).         
+00005a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a80: 2020 2069 6620 6669 6c65 5f65 7874 656e     if file_exten
+00005a90: 7369 6f6e 5f32 203d 3d20 222e 6e69 6922  sion_2 == ".nii"
+00005aa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ac0: 2020 6669 6c65 4976 616c 5f6e 6f5f 6578    fileIval_no_ex
+00005ad0: 7420 3d20 6669 6c65 4976 616c 5f6e 6f5f  t = fileIval_no_
+00005ae0: 6578 745f 320a 0a20 2020 2020 2020 2020  ext_2..         
+00005af0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00005b00: 6620 2873 656c 662e 7072 6566 6978 2920  f (self.prefix) 
+00005b10: 616e 6420 280a 2020 2020 2020 2020 2020  and (.          
+00005b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b30: 2020 6669 6c65 4f76 616c 5f6e 6f5f 6578    fileOval_no_ex
+00005b40: 742e 7374 6172 7473 7769 7468 2873 656c  t.startswith(sel
+00005b50: 662e 7072 6566 6978 290a 2020 2020 2020  f.prefix).      
 00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b70: 6669 6c65 4f76 616c 5f6e 6f5f 6578 7420  fileOval_no_ext 
-00005b80: 3d20 6669 6c65 4f76 616c 5f6e 6f5f 6578  = fileOval_no_ex
-00005b90: 745b 6c65 6e28 0a20 2020 2020 2020 2020  t[len(.         
+00005b70: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00005b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b90: 2023 2066 6d74 3a20 6f66 660a 2020 2020   # fmt: off.    
 00005ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bd0: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
-00005be0: 293a 5d0a 2020 2020 2020 2020 2020 2020  ):].            
+00005bb0: 2020 2020 2020 2020 6669 6c65 4f76 616c          fileOval
+00005bc0: 5f6e 6f5f 6578 7420 3d20 6669 6c65 4f76  _no_ext = fileOv
+00005bd0: 616c 5f6e 6f5f 6578 745b 6c65 6e28 0a20  al_no_ext[len(. 
+00005be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00005bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c00: 2320 666d 743a 206f 6e0a 0a20 2020 2020  # fmt: on..     
-00005c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c20: 2020 2069 6620 2873 656c 662e 7375 6666     if (self.suff
-00005c30: 6978 2920 616e 6420 280a 2020 2020 2020  ix) and (.      
-00005c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c50: 2020 2020 2020 6669 6c65 4f76 616c 5f6e        fileOval_n
-00005c60: 6f5f 6578 742e 656e 6473 7769 7468 2873  o_ext.endswith(s
-00005c70: 656c 662e 7375 6666 6978 290a 2020 2020  elf.suffix).    
-00005c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c90: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00005ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cb0: 2020 2066 696c 654f 7661 6c5f 6e6f 5f65     fileOval_no_e
-00005cc0: 7874 203d 2066 696c 654f 7661 6c5f 6e6f  xt = fileOval_no
-00005cd0: 5f65 7874 5b0a 2020 2020 2020 2020 2020  _ext[.          
+00005c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00005c20: 662e 7072 6566 6978 293a 5d0a 2020 2020  f.prefix):].    
+00005c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c40: 2020 2020 2020 2020 2320 666d 743a 206f          # fmt: o
+00005c50: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+00005c60: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+00005c70: 656c 662e 7375 6666 6978 2920 616e 6420  elf.suffix) and 
+00005c80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005c90: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00005ca0: 6c65 4f76 616c 5f6e 6f5f 6578 742e 656e  leOval_no_ext.en
+00005cb0: 6473 7769 7468 2873 656c 662e 7375 6666  dswith(self.suff
+00005cc0: 6978 290a 2020 2020 2020 2020 2020 2020  ix).            
+00005cd0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
 00005ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cf0: 2020 2020 2020 3a20 2d6c 656e 2873 656c        : -len(sel
-00005d00: 662e 7375 6666 6978 290a 2020 2020 2020  f.suffix).      
-00005d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d20: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
-00005d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d40: 2069 6620 6669 6c65 4f76 616c 5f6e 6f5f   if fileOval_no_
-00005d50: 6578 7420 3d3d 2066 696c 6549 7661 6c5f  ext == fileIval_
-00005d60: 6e6f 5f65 7874 3a0a 2020 2020 2020 2020  no_ext:.        
-00005d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d80: 2020 2020 7365 6c66 2e74 6167 735f 696e      self.tags_in
-00005d90: 6865 7269 7461 6e63 6528 0a20 2020 2020  heritance(.     
-00005da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005db0: 2020 2020 2020 2020 2020 2069 6e5f 6669             in_fi
-00005dc0: 6c65 3d69 6e5f 7661 6c2c 0a20 2020 2020  le=in_val,.     
-00005dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005de0: 2020 2020 2020 2020 2020 206f 7574 5f66             out_f
-00005df0: 696c 653d 6f75 745f 7661 6c2c 0a20 2020  ile=out_val,.   
-00005e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e10: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00005e20: 2020 2020 2320 5265 7475 726e 2074 6865      # Return the
-00005e30: 2072 6571 7569 7265 6d65 6e74 2c20 6f75   requirement, ou
-00005e40: 7470 7574 7320 616e 6420 696e 6865 7269  tputs and inheri
-00005e50: 7461 6e63 655f 6469 6374 0a20 2020 2020  tance_dict.     
-00005e60: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-00005e70: 616b 655f 696e 6974 5265 7375 6c74 2829  ake_initResult()
-00005e80: 0a0a 2020 2020 6465 6620 7275 6e5f 7072  ..    def run_pr
-00005e90: 6f63 6573 735f 6d69 6128 7365 6c66 293a  ocess_mia(self):
-00005ea0: 0a20 2020 2020 2020 2022 2222 4465 6469  .        """Dedi
-00005eb0: 6361 7465 6420 746f 2074 6865 2070 726f  cated to the pro
-00005ec0: 6365 7373 206c 6175 6e63 6820 7374 6570  cess launch step
-00005ed0: 206f 6620 7468 6520 6272 6963 6b2e 2222   of the brick.""
-00005ee0: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
-00005ef0: 4269 6e61 7269 7a65 2c20 7365 6c66 292e  Binarize, self).
-00005f00: 7275 6e5f 7072 6f63 6573 735f 6d69 6128  run_process_mia(
-00005f10: 290a 0a20 2020 2020 2020 2066 696c 6573  )..        files
-00005f20: 5f6e 616d 6520 3d20 7365 6c66 2e69 6e5f  _name = self.in_
-00005f30: 6669 6c65 730a 0a20 2020 2020 2020 2066  files..        f
-00005f40: 6f72 2066 696c 655f 6e61 6d65 2069 6e20  or file_name in 
-00005f50: 6669 6c65 735f 6e61 6d65 3a0a 2020 2020  files_name:.    
-00005f60: 2020 2020 2020 2020 2320 496d 6167 6520          # Image 
-00005f70: 7072 6f63 6573 7369 6e67 0a20 2020 2020  processing.     
-00005f80: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00005f90: 2020 2020 2020 2020 2020 2020 696d 6720              img 
-00005fa0: 3d20 6e69 622e 6c6f 6164 2866 696c 655f  = nib.load(file_
-00005fb0: 6e61 6d65 290a 0a20 2020 2020 2020 2020  name)..         
-00005fc0: 2020 2065 7863 6570 7420 280a 2020 2020     except (.    
-00005fd0: 2020 2020 2020 2020 2020 2020 6e69 622e              nib.
-00005fe0: 6669 6c65 6261 7365 6469 6d61 6765 732e  filebasedimages.
-00005ff0: 496d 6167 6546 696c 6545 7272 6f72 2c0a  ImageFileError,.
-00006000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006010: 4669 6c65 4e6f 7446 6f75 6e64 4572 726f  FileNotFoundErro
-00006020: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00006030: 2020 2054 7970 6545 7272 6f72 2c0a 2020     TypeError,.  
-00006040: 2020 2020 2020 2020 2020 2920 6173 2065            ) as e
-00006050: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006060: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-00006070: 2020 2020 2020 2020 2020 2020 2022 5c6e               "\n
-00006080: 4269 6e61 7269 7a65 2062 7269 636b 3a20  Binarize brick: 
-00006090: 4572 726f 7220 7769 7468 2066 696c 6573  Error with files
-000060a0: 2074 6f20 6269 6e61 7269 7a65 2c20 6475   to binarize, du
-000060b0: 7269 6e67 2022 0a20 2020 2020 2020 2020  ring ".         
-000060c0: 2020 2020 2020 2020 2020 2022 7468 6520             "the 
-000060d0: 7275 6e3a 2022 2c0a 2020 2020 2020 2020  run: ",.        
-000060e0: 2020 2020 2020 2020 2020 2020 652c 0a20              e,. 
-000060f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00006100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006110: 2069 6d67 203d 204e 6f6e 650a 0a20 2020   img = None..   
-00006120: 2020 2020 2020 2020 2069 6620 696d 6720           if img 
-00006130: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00006140: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00006150: 6120 3d20 696d 672e 6765 745f 6664 6174  a = img.get_fdat
-00006160: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
-00006170: 2020 2020 6d61 736b 203d 2064 6174 6120      mask = data 
-00006180: 3e20 7365 6c66 2e74 6872 6573 685f 6c6f  > self.thresh_lo
-00006190: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
-000061a0: 2020 6461 7461 5b7e 6d61 736b 5d20 3d20    data[~mask] = 
-000061b0: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
-000061c0: 2020 2020 696d 672e 6865 6164 6572 2e73      img.header.s
-000061d0: 6574 5f64 6174 615f 6474 7970 6528 2275  et_data_dtype("u
-000061e0: 696e 7438 2229 0a20 2020 2020 2020 2020  int8").         
-000061f0: 2020 2020 2020 206d 6173 6b69 6d67 203d         maskimg =
-00006200: 2069 6d67 2e5f 5f63 6c61 7373 5f5f 280a   img.__class__(.
-00006210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006220: 2020 2020 6d61 736b 2e61 7374 7970 6528      mask.astype(
-00006230: 2275 696e 7438 2229 2c20 696d 672e 6166  "uint8"), img.af
-00006240: 6669 6e65 2c20 696d 672e 6865 6164 6572  fine, img.header
-00006250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006260: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00006270: 2020 2020 2320 496d 6167 6520 7361 7665      # Image save
-00006280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006290: 205f 2c20 6669 6c65 5f6e 616d 6520 3d20   _, file_name = 
-000062a0: 6f73 2e70 6174 682e 7370 6c69 7428 6669  os.path.split(fi
-000062b0: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
-000062c0: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
-000062d0: 6d65 5f6e 6f5f 6578 742c 2066 696c 655f  me_no_ext, file_
-000062e0: 6578 7465 6e73 696f 6e20 3d20 6f73 2e70  extension = os.p
-000062f0: 6174 682e 7370 6c69 7465 7874 2866 696c  ath.splitext(fil
-00006300: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00006310: 2020 2020 2020 2020 6966 2066 696c 655f          if file_
-00006320: 6578 7465 6e73 696f 6e20 3d3d 2022 2e67  extension == ".g
-00006330: 7a22 3a0a 2020 2020 2020 2020 2020 2020  z":.            
-00006340: 2020 2020 2020 2020 2866 696c 655f 6e61          (file_na
-00006350: 6d65 5f6e 6f5f 6578 745f 322c 2066 696c  me_no_ext_2, fil
-00006360: 655f 6578 7465 6e73 696f 6e5f 3229 203d  e_extension_2) =
-00006370: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-00006380: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00006390: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-000063a0: 6e61 6d65 5f6e 6f5f 6578 740a 2020 2020  name_no_ext.    
-000063b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000063d0: 2020 2020 2020 6966 2066 696c 655f 6578        if file_ex
-000063e0: 7465 6e73 696f 6e5f 3220 3d3d 2022 2e6e  tension_2 == ".n
-000063f0: 6969 223a 0a20 2020 2020 2020 2020 2020  ii":.           
-00006400: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00006410: 655f 6e61 6d65 5f6e 6f5f 6578 7420 3d20  e_name_no_ext = 
-00006420: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
-00006430: 5f32 0a20 2020 2020 2020 2020 2020 2020  _2.             
-00006440: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00006450: 6578 7465 6e73 696f 6e20 3d20 222e 6e69  extension = ".ni
-00006460: 692e 677a 220a 0a20 2020 2020 2020 2020  i.gz"..         
-00006470: 2020 2020 2020 2066 696c 655f 6f75 7420         file_out 
-00006480: 3d20 6f73 2e70 6174 682e 6a6f 696e 280a  = os.path.join(.
-00006490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064a0: 2020 2020 7365 6c66 2e6f 7574 7075 745f      self.output_
-000064b0: 6469 7265 6374 6f72 792c 0a20 2020 2020  directory,.     
-000064c0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000064d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000064e0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-000064f0: 6566 6978 2e73 7472 6970 2829 0a20 2020  efix.strip().   
-00006500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006510: 2020 2020 202b 2066 696c 655f 6e61 6d65       + file_name
-00006520: 5f6e 6f5f 6578 740a 2020 2020 2020 2020  _no_ext.        
-00006530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006540: 2b20 7365 6c66 2e73 7566 6669 782e 7374  + self.suffix.st
-00006550: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-00006560: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00006570: 6669 6c65 5f65 7874 656e 7369 6f6e 0a20  file_extension. 
-00006580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006590: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-000065a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000065b0: 2020 2020 2020 2020 6e69 622e 7361 7665          nib.save
-000065c0: 286d 6173 6b69 6d67 2c20 6669 6c65 5f6f  (maskimg, file_o
-000065d0: 7574 290a 0a0a 636c 6173 7320 436f 6e66  ut)...class Conf
-000065e0: 6f72 6d49 6d61 6765 2850 726f 6365 7373  ormImage(Process
-000065f0: 4d49 4129 3a0a 2020 2020 2222 220a 2020  MIA):.    """.  
-00006600: 2020 2a43 6f6e 666f 726d 2054 3177 2069    *Conform T1w i
-00006610: 6d61 6765 2074 6f20 7374 616e 6461 7264  mage to standard
-00006620: 2a0a 0a20 2020 2050 6c65 6173 652c 2073  *..    Please, s
-00006630: 6565 2074 6865 2063 6f6d 706c 6574 6520  ee the complete 
-00006640: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
-00006650: 7220 7468 6520 6043 6f6e 666f 726d 496d  r the `ConformIm
-00006660: 6167 6520 6272 6963 6b0a 2020 2020 696e  age brick.    in
-00006670: 2074 6865 206d 6961 5f70 726f 6365 7373   the mia_process
-00006680: 6573 2077 6562 7369 7465 0a20 2020 203c  es website.    <
-00006690: 6874 7470 733a 2f2f 706f 7075 6c73 652e  https://populse.
-000066a0: 6769 7468 7562 2e69 6f2f 6d69 615f 7072  github.io/mia_pr
-000066b0: 6f63 6573 7365 732f 6874 6d6c 2f64 6f63  ocesses/html/doc
-000066c0: 756d 656e 7461 7469 6f6e 2f62 7269 636b  umentation/brick
-000066d0: 732f 7072 6570 726f 6365 7373 2f6f 7468  s/preprocess/oth
-000066e0: 6572 2f43 6f6e 666f 726d 496d 6167 652e  er/ConformImage.
-000066f0: 6874 6d6c 3e60 5f0a 0a20 2020 2061 6461  html>`_..    ada
-00006700: 7074 6564 2066 726f 6d3a 0a20 2020 2068  pted from:.    h
-00006710: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00006720: 6d2f 6e69 7072 6570 732f 6d72 6971 632f  m/nipreps/mriqc/
-00006730: 626c 6f62 2f65 3032 3130 3038 6461 3061  blob/e021008da0a
-00006740: 3265 6631 6334 3865 3838 3262 6166 3933  2ef1c48e882baf93
-00006750: 3231 3339 6136 3733 3334 3966 392f 6d72  2139a673349f9/mr
-00006760: 6971 632f 696e 7465 7266 6163 6573 2f63  iqc/interfaces/c
-00006770: 6f6d 6d6f 6e2f 636f 6e66 6f72 6d5f 696d  ommon/conform_im
-00006780: 6167 652e 7079 234c 3735 0a0a 2020 2020  age.py#L75..    
-00006790: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-000067a0: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
-000067b0: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
-000067c0: 6420 746f 2074 6865 2061 7474 7269 6275  d to the attribu
-000067d0: 7465 7320 696e 6974 6961 6c69 7361 7469  tes initialisati
-000067e0: 6f6e 202f 2069 6e73 7461 6e74 6961 7469  on / instantiati
-000067f0: 6f6e 2e0a 0a20 2020 2020 2020 2054 6865  on...        The
-00006800: 2069 6e70 7574 2061 6e64 206f 7574 7075   input and outpu
-00006810: 7420 706c 7567 7320 6172 6520 6465 6669  t plugs are defi
-00006820: 6e65 6420 6865 7265 2e20 5468 6520 7370  ned here. The sp
-00006830: 6563 6961 6c0a 2020 2020 2020 2020 2773  ecial.        's
-00006840: 656c 662e 7265 7175 6972 656d 656e 7427  elf.requirement'
-00006850: 2061 7474 7269 6275 7465 2028 6f70 7469   attribute (opti
-00006860: 6f6e 616c 2920 6973 2075 7365 6420 746f  onal) is used to
-00006870: 2064 6566 696e 6520 7468 650a 2020 2020   define the.    
-00006880: 2020 2020 7468 6972 642d 7061 7274 7920      third-party 
-00006890: 7072 6f64 7563 7473 206e 6563 6573 7361  products necessa
-000068a0: 7279 2066 6f72 2074 6865 2072 756e 6e69  ry for the runni
-000068b0: 6e67 206f 6620 7468 6520 6272 6963 6b2e  ng of the brick.
-000068c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000068d0: 2020 2020 2023 2049 6e69 7469 616c 6973       # Initialis
-000068e0: 6174 696f 6e20 6f66 2074 6865 206f 626a  ation of the obj
-000068f0: 6563 7473 206e 6565 6465 6420 666f 7220  ects needed for 
-00006900: 7468 6520 6c61 756e 6368 206f 6620 7468  the launch of th
-00006910: 6520 6272 6963 6b0a 2020 2020 2020 2020  e brick.        
-00006920: 7375 7065 7228 436f 6e66 6f72 6d49 6d61  super(ConformIma
-00006930: 6765 2c20 7365 6c66 292e 5f5f 696e 6974  ge, self).__init
-00006940: 5f5f 2829 0a0a 2020 2020 2020 2020 2320  __()..        # 
-00006950: 5468 6972 6420 7061 7274 7920 736f 6674  Third party soft
-00006960: 7761 7265 7320 7265 7175 6972 6564 2066  wares required f
-00006970: 6f72 2074 6865 2065 7865 6375 7469 6f6e  or the execution
-00006980: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
-00006990: 2020 2020 2020 7365 6c66 2e72 6571 7569        self.requi
-000069a0: 7265 6d65 6e74 203d 205b 5d0a 0a20 2020  rement = []..   
-000069b0: 2020 2020 2023 2049 6e70 7574 7320 6465       # Inputs de
-000069c0: 7363 7269 7074 696f 6e0a 2020 2020 2020  scription.      
-000069d0: 2020 696e 5f66 696c 655f 6465 7363 203d    in_file_desc =
-000069e0: 2022 416e 2065 7869 7374 696e 6720 7061   "An existing pa
-000069f0: 7468 2066 696c 652e 220a 2020 2020 2020  th file.".      
-00006a00: 2020 7072 6566 6978 5f64 6573 6320 3d20    prefix_desc = 
-00006a10: 2250 7265 6669 7820 6f66 2074 6865 206f  "Prefix of the o
-00006a20: 7574 7075 7420 696d 6167 6520 2861 2073  utput image (a s
-00006a30: 7472 696e 6729 2e22 0a20 2020 2020 2020  tring).".       
-00006a40: 2073 7566 6669 785f 6465 7363 203d 2022   suffix_desc = "
-00006a50: 5375 6666 6978 206f 6620 7468 6520 6f75  Suffix of the ou
-00006a60: 7470 7574 2069 6d61 6765 2028 6120 7374  tput image (a st
-00006a70: 7269 6e67 292e 220a 0a20 2020 2020 2020  ring)."..       
-00006a80: 2023 204f 7574 7075 7473 2064 6573 6372   # Outputs descr
-00006a90: 6970 7469 6f6e 0a20 2020 2020 2020 206f  iption.        o
-00006aa0: 7574 5f66 696c 655f 6465 7363 203d 2028  ut_file_desc = (
-00006ab0: 0a20 2020 2020 2020 2020 2020 2022 5061  .            "Pa
-00006ac0: 7468 206f 6620 7468 6520 636f 6e66 6f72  th of the confor
-00006ad0: 6d65 6420 7363 616e 2022 0a20 2020 2020  med scan ".     
-00006ae0: 2020 2020 2020 2022 2861 2070 6174 686c         "(a pathl
-00006af0: 696b 6520 6f62 6a65 6374 206f 7220 7374  ike object or st
-00006b00: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
-00006b10: 6720 6120 6669 6c65 292e 220a 2020 2020  g a file).".    
-00006b20: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-00006b30: 2049 6e70 7574 7320 7472 6169 7473 0a20   Inputs traits. 
-00006b40: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-00006b50: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-00006b60: 2020 2022 696e 5f66 696c 6522 2c20 4669     "in_file", Fi
-00006b70: 6c65 286f 7574 7075 743d 4661 6c73 652c  le(output=False,
-00006b80: 206f 7074 696f 6e61 6c3d 4661 6c73 652c   optional=False,
-00006b90: 2064 6573 633d 696e 5f66 696c 655f 6465   desc=in_file_de
-00006ba0: 7363 290a 2020 2020 2020 2020 290a 0a20  sc).        ).. 
-00006bb0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-00006bc0: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-00006bd0: 2020 2022 7072 6566 6978 222c 0a20 2020     "prefix",.   
-00006be0: 2020 2020 2020 2020 2074 7261 6974 732e           traits.
-00006bf0: 5374 7269 6e67 2822 222c 206f 7574 7075  String("", outpu
-00006c00: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
-00006c10: 6c3d 5472 7565 2c20 6465 7363 3d70 7265  l=True, desc=pre
-00006c20: 6669 785f 6465 7363 292c 0a20 2020 2020  fix_desc),.     
-00006c30: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-00006c40: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
-00006c50: 2020 2020 2020 2020 2020 2273 7566 6669            "suffi
-00006c60: 7822 2c0a 2020 2020 2020 2020 2020 2020  x",.            
-00006c70: 7472 6169 7473 2e53 7472 696e 6728 2222  traits.String(""
-00006c80: 2c20 6f75 7470 7574 3d46 616c 7365 2c20  , output=False, 
-00006c90: 6f70 7469 6f6e 616c 3d54 7275 652c 2064  optional=True, d
-00006ca0: 6573 633d 7375 6666 6978 5f64 6573 6329  esc=suffix_desc)
-00006cb0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00006cc0: 2020 2020 2023 204f 7574 7075 7473 2074       # Outputs t
-00006cd0: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
-00006ce0: 6c66 2e61 6464 5f74 7261 6974 2822 6f75  lf.add_trait("ou
-00006cf0: 745f 6669 6c65 222c 2046 696c 6528 6f75  t_file", File(ou
-00006d00: 7470 7574 3d54 7275 652c 2064 6573 633d  tput=True, desc=
-00006d10: 6f75 745f 6669 6c65 5f64 6573 6329 290a  out_file_desc)).
-00006d20: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00006d30: 6974 5f64 6566 6175 6c74 5f74 7261 6974  it_default_trait
-00006d40: 7328 290a 0a20 2020 2064 6566 206c 6973  s()..    def lis
-00006d50: 745f 6f75 7470 7574 7328 7365 6c66 2c20  t_outputs(self, 
-00006d60: 6973 5f70 6c75 6767 6564 3d4e 6f6e 6529  is_plugged=None)
-00006d70: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
-00006d80: 6963 6174 6564 2074 6f20 7468 6520 696e  icated to the in
-00006d90: 6974 6961 6c69 7361 7469 6f6e 2073 7465  itialisation ste
-00006da0: 7020 6f66 2074 6865 2062 7269 636b 2e0a  p of the brick..
-00006db0: 0a20 2020 2020 2020 2054 6865 206d 6169  .        The mai
-00006dc0: 6e20 6f62 6a65 6374 6976 6520 6f66 2074  n objective of t
-00006dd0: 6869 7320 6d65 7468 6f64 2069 7320 746f  his method is to
-00006de0: 2070 726f 6475 6365 2074 6865 206f 7574   produce the out
-00006df0: 7075 7473 206f 6620 7468 650a 2020 2020  puts of the.    
-00006e00: 2020 2020 6272 6963 6b73 2028 7365 6c66      bricks (self
-00006e10: 2e6f 7574 7075 7473 2920 616e 6420 7468  .outputs) and th
-00006e20: 6520 6173 736f 6369 6174 6564 2074 6167  e associated tag
-00006e30: 7320 2873 656c 662e 696e 6865 7269 7461  s (self.inherita
-00006e40: 6e63 655f 6469 6329 2c0a 2020 2020 2020  nce_dic),.      
-00006e50: 2020 6966 2064 6566 696e 6564 2068 6572    if defined her
-00006e60: 652e 2054 6f20 776f 726b 2070 726f 7065  e. To work prope
-00006e70: 726c 7920 7468 6973 206d 6574 686f 6420  rly this method 
-00006e80: 6d75 7374 2072 6574 7572 6e0a 2020 2020  must return.    
-00006e90: 2020 2020 7365 6c66 2e6d 616b 655f 696e      self.make_in
-00006ea0: 6974 5265 7375 6c74 2829 206f 626a 6563  itResult() objec
-00006eb0: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
-00006ec0: 616d 2069 735f 706c 7567 6765 643a 2074  am is_plugged: t
-00006ed0: 6865 2073 7461 7465 2c20 6c69 6e6b 6564  he state, linked
-00006ee0: 206f 7220 6e6f 742c 206f 6620 7468 6520   or not, of the 
-00006ef0: 706c 7567 732e 0a20 2020 2020 2020 203a  plugs..        :
-00006f00: 7265 7475 726e 733a 2061 2064 6963 7469  returns: a dicti
-00006f10: 6f6e 6172 7920 7769 7468 2072 6571 7569  onary with requi
-00006f20: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
-00006f30: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
-00006f40: 6469 6374 2e0a 2020 2020 2020 2020 2222  dict..        ""
-00006f50: 220a 2020 2020 2020 2020 2320 5573 696e  ".        # Usin
-00006f60: 6720 7468 6520 696e 6865 7269 7461 6e63  g the inheritanc
-00006f70: 6520 746f 2050 726f 6365 7373 4d49 4120  e to ProcessMIA 
-00006f80: 636c 6173 732c 206c 6973 745f 6f75 7470  class, list_outp
-00006f90: 7574 7320 6d65 7468 6f64 0a20 2020 2020  uts method.     
-00006fa0: 2020 2073 7570 6572 2843 6f6e 666f 726d     super(Conform
-00006fb0: 496d 6167 652c 2073 656c 6629 2e6c 6973  Image, self).lis
-00006fc0: 745f 6f75 7470 7574 7328 290a 0a20 2020  t_outputs()..   
-00006fd0: 2020 2020 2023 204f 7574 7075 7473 2064       # Outputs d
-00006fe0: 6566 696e 6974 696f 6e0a 2020 2020 2020  efinition.      
-00006ff0: 2020 6966 2073 656c 662e 696e 5f66 696c    if self.in_fil
-00007000: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00007010: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00007020: 2020 2020 286e 6f74 2073 656c 662e 7375      (not self.su
-00007030: 6666 6978 290a 2020 2020 2020 2020 2020  ffix).          
-00007040: 2020 2020 2020 6f72 2028 7365 6c66 2e73        or (self.s
-00007050: 7566 6669 782e 6973 7370 6163 6528 2929  uffix.isspace())
-00007060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007070: 206f 7220 7365 6c66 2e73 7566 6669 7820   or self.suffix 
-00007080: 696e 205b 556e 6465 6669 6e65 642c 2022  in [Undefined, "
-00007090: 3c75 6e64 6566 696e 6564 3e22 5d0a 2020  <undefined>"].  
-000070a0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-000070b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000070c0: 662e 7375 6666 6978 203d 2022 2022 0a0a  f.suffix = " "..
-000070d0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000070e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000070f0: 2028 6e6f 7420 7365 6c66 2e70 7265 6669   (not self.prefi
-00007100: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
-00007110: 2020 206f 7220 2873 656c 662e 7072 6566     or (self.pref
-00007120: 6978 2e69 7373 7061 6365 2829 290a 2020  ix.isspace()).  
-00007130: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00007140: 2028 7365 6c66 2e70 7265 6669 7820 696e   (self.prefix in
-00007150: 205b 556e 6465 6669 6e65 642c 2022 3c75   [Undefined, "<u
-00007160: 6e64 6566 696e 6564 3e22 5d29 0a20 2020  ndefined>"]).   
-00007170: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-00007180: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007190: 2e70 7265 6669 7820 3d20 2220 220a 0a20  .prefix = " ".. 
-000071a0: 2020 2020 2020 2020 2020 2076 616c 6964             valid
-000071b0: 5f65 7874 2c20 696e 5f65 7874 2c20 6669  _ext, in_ext, fi
-000071c0: 6c65 5f6e 616d 6520 3d20 6368 6563 6b46  le_name = checkF
-000071d0: 696c 6545 7874 2873 656c 662e 696e 5f66  ileExt(self.in_f
-000071e0: 696c 652c 2045 5854 290a 0a20 2020 2020  ile, EXT)..     
-000071f0: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
-00007200: 6c69 645f 6578 743a 0a20 2020 2020 2020  lid_ext:.       
-00007210: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00007220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007230: 2020 2020 225c 6e43 6f6e 666f 726d 496d      "\nConformIm
-00007240: 6167 6520 6272 6963 6b3a 2054 6865 2069  age brick: The i
-00007250: 6e70 7574 2069 6d61 6765 2066 6f72 6d61  nput image forma
-00007260: 7420 6973 206e 6f74 2022 0a20 2020 2020  t is not ".     
-00007270: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00007280: 7265 636f 676e 697a 6564 2e2e 2e21 220a  recognized...!".
-00007290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000072a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000072b0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-000072c0: 2020 2020 2020 7061 7468 2c20 5f20 3d20        path, _ = 
-000072d0: 6f73 2e70 6174 682e 7370 6c69 7428 7365  os.path.split(se
-000072e0: 6c66 2e69 6e5f 6669 6c65 290a 0a20 2020  lf.in_file)..   
-000072f0: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
-00007300: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00007310: 6c66 2e73 7566 6669 7820 3d3d 2022 2022  lf.suffix == " "
-00007320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007330: 2061 6e64 2073 656c 662e 7072 6566 6978   and self.prefix
-00007340: 203d 3d20 2220 220a 2020 2020 2020 2020   == " ".        
-00007350: 2020 2020 2020 2020 616e 6420 7061 7468          and path
-00007360: 203d 3d20 7365 6c66 2e6f 7574 7075 745f   == self.output_
-00007370: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
-00007380: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00007390: 2020 2020 2020 2020 206d 7367 203d 2051           msg = Q
-000073a0: 4d65 7373 6167 6542 6f78 2829 0a20 2020  MessageBox().   
-000073b0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-000073c0: 2e73 6574 4963 6f6e 2851 4d65 7373 6167  .setIcon(QMessag
-000073d0: 6542 6f78 2e57 6172 6e69 6e67 290a 2020  eBox.Warning).  
-000073e0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-000073f0: 672e 7365 7457 696e 646f 7754 6974 6c65  g.setWindowTitle
-00007400: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007410: 2020 2020 2020 226d 6961 5f70 726f 6365        "mia_proce
-00007420: 7373 6573 202d 2043 6f6e 666f 726d 496d  sses - ConformIm
-00007430: 6167 6520 6272 6963 6b20 5761 726e 696e  age brick Warnin
-00007440: 6721 220a 2020 2020 2020 2020 2020 2020  g!".            
-00007450: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00007460: 2020 2020 2020 6d73 672e 7365 7454 6578        msg.setTex
-00007470: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00007480: 2020 2020 2020 2022 5375 6666 6978 2061         "Suffix a
-00007490: 6e64 2070 7265 6669 7820 696e 7075 7420  nd prefix input 
-000074a0: 7061 7261 6d65 7465 7273 2061 7265 206e  parameters are n
-000074b0: 6f74 2022 0a20 2020 2020 2020 2020 2020  ot ".           
-000074c0: 2020 2020 2020 2020 2022 6465 6669 6e65           "define
-000074d0: 6420 6f72 2063 6f6e 7369 7374 206f 6e6c  d or consist onl
-000074e0: 7920 6f66 206f 6e65 206f 7220 6d6f 7265  y of one or more
-000074f0: 2077 6869 7465 2022 0a20 2020 2020 2020   white ".       
-00007500: 2020 2020 2020 2020 2020 2020 2022 7370               "sp
-00007510: 6163 6573 2e5c 6e54 6865 207b 307d 2069  aces.\nThe {0} i
-00007520: 6e70 7574 2070 6172 616d 6574 6572 2077  nput parameter w
-00007530: 696c 6c20 6265 2022 0a20 2020 2020 2020  ill be ".       
-00007540: 2020 2020 2020 2020 2020 2020 2022 6f76               "ov
-00007550: 6572 7772 6974 7465 6e20 2e2e 2e5c 6e20  erwritten ...\n 
-00007560: 5965 7320 6f72 2022 0a20 2020 2020 2020  Yes or ".       
-00007570: 2020 2020 2020 2020 2020 2020 2022 4162               "Ab
-00007580: 6f72 743f 222e 666f 726d 6174 2866 696c  ort?".format(fil
-00007590: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-000075a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000075b0: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
-000075c0: 7453 7461 6e64 6172 6442 7574 746f 6e73  tStandardButtons
-000075d0: 2851 4d65 7373 6167 6542 6f78 2e59 6573  (QMessageBox.Yes
-000075e0: 207c 2051 4d65 7373 6167 6542 6f78 2e41   | QMessageBox.A
-000075f0: 626f 7274 290a 2020 2020 2020 2020 2020  bort).          
-00007600: 2020 2020 2020 7265 7476 616c 203d 206d        retval = m
-00007610: 7367 2e65 7865 635f 2829 0a0a 2020 2020  sg.exec_()..    
-00007620: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00007630: 6574 7661 6c20 213d 2051 4d65 7373 6167  etval != QMessag
-00007640: 6542 6f78 2e41 626f 7274 3a0a 2020 2020  eBox.Abort:.    
-00007650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007660: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00007670: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00007680: 5c6e 436f 6e66 6f72 6d49 6d61 6765 2062  \nConformImage b
-00007690: 7269 636b 2077 6172 6e69 6e67 3a20 7468  rick warning: th
-000076a0: 6520 6f75 745f 6669 6c65 206f 7574 7075  e out_file outpu
-000076b0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-000076c0: 2020 2020 2020 2020 2020 2020 2270 6172              "par
-000076d0: 616d 6574 6572 2069 7320 7468 6520 7361  ameter is the sa
-000076e0: 6d65 2061 7320 7468 6520 696e 5f66 696c  me as the in_fil
-000076f0: 6573 2069 6e70 7574 2022 0a20 2020 2020  es input ".     
+00005cf0: 2020 2020 2020 2020 2020 2066 696c 654f             fileO
+00005d00: 7661 6c5f 6e6f 5f65 7874 203d 2066 696c  val_no_ext = fil
+00005d10: 654f 7661 6c5f 6e6f 5f65 7874 5b0a 2020  eOval_no_ext[.  
+00005d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d30: 2020 2020 2020 2020 2020 2020 2020 3a20                : 
+00005d40: 2d6c 656e 2873 656c 662e 7375 6666 6978  -len(self.suffix
+00005d50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005d60: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00005d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005d80: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00005d90: 4f76 616c 5f6e 6f5f 6578 7420 3d3d 2066  Oval_no_ext == f
+00005da0: 696c 6549 7661 6c5f 6e6f 5f65 7874 3a0a  ileIval_no_ext:.
+00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005dd0: 2e74 6167 735f 696e 6865 7269 7461 6e63  .tags_inheritanc
+00005de0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00005df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e00: 2020 2069 6e5f 6669 6c65 3d69 6e5f 7661     in_file=in_va
+00005e10: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+00005e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e30: 2020 206f 7574 5f66 696c 653d 6f75 745f     out_file=out_
+00005e40: 7661 6c2c 0a20 2020 2020 2020 2020 2020  val,.           
+00005e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e60: 2029 0a0a 2020 2020 2020 2020 2320 5265   )..        # Re
+00005e70: 7475 726e 2074 6865 2072 6571 7569 7265  turn the require
+00005e80: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
+00005e90: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
+00005ea0: 6374 0a20 2020 2020 2020 2072 6574 7572  ct.        retur
+00005eb0: 6e20 7365 6c66 2e6d 616b 655f 696e 6974  n self.make_init
+00005ec0: 5265 7375 6c74 2829 0a0a 2020 2020 6465  Result()..    de
+00005ed0: 6620 7275 6e5f 7072 6f63 6573 735f 6d69  f run_process_mi
+00005ee0: 6128 7365 6c66 293a 0a20 2020 2020 2020  a(self):.       
+00005ef0: 2022 2222 4465 6469 6361 7465 6420 746f   """Dedicated to
+00005f00: 2074 6865 2070 726f 6365 7373 206c 6175   the process lau
+00005f10: 6e63 6820 7374 6570 206f 6620 7468 6520  nch step of the 
+00005f20: 6272 6963 6b2e 2222 220a 2020 2020 2020  brick.""".      
+00005f30: 2020 7375 7065 7228 4269 6e61 7269 7a65    super(Binarize
+00005f40: 2c20 7365 6c66 292e 7275 6e5f 7072 6f63  , self).run_proc
+00005f50: 6573 735f 6d69 6128 290a 0a20 2020 2020  ess_mia()..     
+00005f60: 2020 2066 696c 6573 5f6e 616d 6520 3d20     files_name = 
+00005f70: 7365 6c66 2e69 6e5f 6669 6c65 730a 0a20  self.in_files.. 
+00005f80: 2020 2020 2020 2066 6f72 2066 696c 655f         for file_
+00005f90: 6e61 6d65 2069 6e20 6669 6c65 735f 6e61  name in files_na
+00005fa0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00005fb0: 2320 496d 6167 6520 7072 6f63 6573 7369  # Image processi
+00005fc0: 6e67 0a20 2020 2020 2020 2020 2020 2074  ng.            t
+00005fd0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00005fe0: 2020 2020 696d 6720 3d20 6e69 622e 6c6f      img = nib.lo
+00005ff0: 6164 2866 696c 655f 6e61 6d65 290a 0a20  ad(file_name).. 
+00006000: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00006010: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
+00006020: 2020 2020 6e69 622e 6669 6c65 6261 7365      nib.filebase
+00006030: 6469 6d61 6765 732e 496d 6167 6546 696c  dimages.ImageFil
+00006040: 6545 7272 6f72 2c0a 2020 2020 2020 2020  eError,.        
+00006050: 2020 2020 2020 2020 4669 6c65 4e6f 7446          FileNotF
+00006060: 6f75 6e64 4572 726f 722c 0a20 2020 2020  oundError,.     
+00006070: 2020 2020 2020 2020 2020 2054 7970 6545             TypeE
+00006080: 7272 6f72 2c0a 2020 2020 2020 2020 2020  rror,.          
+00006090: 2020 2920 6173 2065 3a0a 2020 2020 2020    ) as e:.      
+000060a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000060b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000060c0: 2020 2020 2022 5c6e 4269 6e61 7269 7a65       "\nBinarize
+000060d0: 2062 7269 636b 3a20 4572 726f 7220 7769   brick: Error wi
+000060e0: 7468 2066 696c 6573 2074 6f20 6269 6e61  th files to bina
+000060f0: 7269 7a65 2c20 6475 7269 6e67 2022 0a20  rize, during ". 
+00006100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006110: 2020 2022 7468 6520 7275 6e3a 2022 2c0a     "the run: ",.
+00006120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006130: 2020 2020 652c 0a20 2020 2020 2020 2020      e,.         
+00006140: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00006150: 2020 2020 2020 2020 2069 6d67 203d 204e           img = N
+00006160: 6f6e 650a 0a20 2020 2020 2020 2020 2020  one..           
+00006170: 2069 6620 696d 6720 6973 206e 6f74 204e   if img is not N
+00006180: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00006190: 2020 2020 2064 6174 6120 3d20 696d 672e       data = img.
+000061a0: 6765 745f 6664 6174 6128 290a 2020 2020  get_fdata().    
+000061b0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+000061c0: 203d 2064 6174 6120 3e20 7365 6c66 2e74   = data > self.t
+000061d0: 6872 6573 685f 6c6f 770a 2020 2020 2020  hresh_low.      
+000061e0: 2020 2020 2020 2020 2020 6461 7461 5b7e            data[~
+000061f0: 6d61 736b 5d20 3d20 302e 300a 2020 2020  mask] = 0.0.    
+00006200: 2020 2020 2020 2020 2020 2020 696d 672e              img.
+00006210: 6865 6164 6572 2e73 6574 5f64 6174 615f  header.set_data_
+00006220: 6474 7970 6528 2275 696e 7438 2229 0a20  dtype("uint8"). 
+00006230: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00006240: 6173 6b69 6d67 203d 2069 6d67 2e5f 5f63  askimg = img.__c
+00006250: 6c61 7373 5f5f 280a 2020 2020 2020 2020  lass__(.        
+00006260: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00006270: 2e61 7374 7970 6528 2275 696e 7438 2229  .astype("uint8")
+00006280: 2c20 696d 672e 6166 6669 6e65 2c20 696d  , img.affine, im
+00006290: 672e 6865 6164 6572 0a20 2020 2020 2020  g.header.       
+000062a0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000062b0: 2020 2020 2020 2020 2020 2020 2320 496d              # Im
+000062c0: 6167 6520 7361 7665 0a20 2020 2020 2020  age save.       
+000062d0: 2020 2020 2020 2020 205f 2c20 6669 6c65           _, file
+000062e0: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
+000062f0: 7370 6c69 7428 6669 6c65 5f6e 616d 6529  split(file_name)
+00006300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006310: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
+00006320: 742c 2066 696c 655f 6578 7465 6e73 696f  t, file_extensio
+00006330: 6e20 3d20 6f73 2e70 6174 682e 7370 6c69  n = os.path.spli
+00006340: 7465 7874 2866 696c 655f 6e61 6d65 290a  text(file_name).
+00006350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006360: 6966 2066 696c 655f 6578 7465 6e73 696f  if file_extensio
+00006370: 6e20 3d3d 2022 2e67 7a22 3a0a 2020 2020  n == ".gz":.    
+00006380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006390: 2866 696c 655f 6e61 6d65 5f6e 6f5f 6578  (file_name_no_ex
+000063a0: 745f 322c 2066 696c 655f 6578 7465 6e73  t_2, file_extens
+000063b0: 696f 6e5f 3229 203d 206f 732e 7061 7468  ion_2) = os.path
+000063c0: 2e73 706c 6974 6578 7428 0a20 2020 2020  .splitext(.     
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 2020 2066 696c 655f 6e61 6d65 5f6e 6f5f     file_name_no_
+000063f0: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
+00006400: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00006410: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006420: 2066 696c 655f 6578 7465 6e73 696f 6e5f   file_extension_
+00006430: 3220 3d3d 2022 2e6e 6969 223a 0a20 2020  2 == ".nii":.   
+00006440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006450: 2020 2020 2066 696c 655f 6e61 6d65 5f6e       file_name_n
+00006460: 6f5f 6578 7420 3d20 6669 6c65 5f6e 616d  o_ext = file_nam
+00006470: 655f 6e6f 5f65 7874 5f32 0a20 2020 2020  e_no_ext_2.     
+00006480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006490: 2020 2066 696c 655f 6578 7465 6e73 696f     file_extensio
+000064a0: 6e20 3d20 222e 6e69 692e 677a 220a 0a20  n = ".nii.gz".. 
+000064b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000064c0: 696c 655f 6f75 7420 3d20 6f73 2e70 6174  ile_out = os.pat
+000064d0: 682e 6a6f 696e 280a 2020 2020 2020 2020  h.join(.        
+000064e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000064f0: 2e6f 7574 7075 745f 6469 7265 6374 6f72  .output_director
+00006500: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00006510: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00006520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006530: 2073 656c 662e 7072 6566 6978 2e73 7472   self.prefix.str
+00006540: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
+00006550: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+00006560: 696c 655f 6e61 6d65 5f6e 6f5f 6578 740a  ile_name_no_ext.
+00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006580: 2020 2020 2020 2020 2b20 7365 6c66 2e73          + self.s
+00006590: 7566 6669 782e 7374 7269 7028 290a 2020  uffix.strip().  
+000065a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065b0: 2020 2020 2020 2b20 6669 6c65 5f65 7874        + file_ext
+000065c0: 656e 7369 6f6e 0a20 2020 2020 2020 2020  ension.         
+000065d0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+000065e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000065f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006600: 6e69 622e 7361 7665 286d 6173 6b69 6d67  nib.save(maskimg
+00006610: 2c20 6669 6c65 5f6f 7574 290a 0a0a 636c  , file_out)...cl
+00006620: 6173 7320 436f 6e66 6f72 6d49 6d61 6765  ass ConformImage
+00006630: 2850 726f 6365 7373 4d49 4129 3a0a 2020  (ProcessMIA):.  
+00006640: 2020 2222 220a 2020 2020 2a43 6f6e 666f    """.    *Confo
+00006650: 726d 2054 3177 2069 6d61 6765 2074 6f20  rm T1w image to 
+00006660: 7374 616e 6461 7264 2a0a 0a20 2020 2050  standard*..    P
+00006670: 6c65 6173 652c 2073 6565 2074 6865 2063  lease, see the c
+00006680: 6f6d 706c 6574 6520 646f 6375 6d65 6e74  omplete document
+00006690: 6174 696f 6e20 666f 7220 7468 6520 6043  ation for the `C
+000066a0: 6f6e 666f 726d 496d 6167 6520 6272 6963  onformImage bric
+000066b0: 6b0a 2020 2020 696e 2074 6865 206d 6961  k.    in the mia
+000066c0: 5f70 726f 6365 7373 6573 2077 6562 7369  _processes websi
+000066d0: 7465 0a20 2020 203c 6874 7470 733a 2f2f  te.    <https://
+000066e0: 706f 7075 6c73 652e 6769 7468 7562 2e69  populse.github.i
+000066f0: 6f2f 6d69 615f 7072 6f63 6573 7365 732f  o/mia_processes/
+00006700: 6874 6d6c 2f64 6f63 756d 656e 7461 7469  html/documentati
+00006710: 6f6e 2f62 7269 636b 732f 7072 6570 726f  on/bricks/prepro
+00006720: 6365 7373 2f6f 7468 6572 2f43 6f6e 666f  cess/other/Confo
+00006730: 726d 496d 6167 652e 6874 6d6c 3e60 5f0a  rmImage.html>`_.
+00006740: 0a20 2020 2061 6461 7074 6564 2066 726f  .    adapted fro
+00006750: 6d3a 0a20 2020 2068 7474 7073 3a2f 2f67  m:.    https://g
+00006760: 6974 6875 622e 636f 6d2f 6e69 7072 6570  ithub.com/niprep
+00006770: 732f 6d72 6971 632f 626c 6f62 2f65 3032  s/mriqc/blob/e02
+00006780: 3130 3038 6461 3061 3265 6631 6334 3865  1008da0a2ef1c48e
+00006790: 3838 3262 6166 3933 3231 3339 6136 3733  882baf932139a673
+000067a0: 3334 3966 392f 6d72 6971 632f 696e 7465  349f9/mriqc/inte
+000067b0: 7266 6163 6573 2f63 6f6d 6d6f 6e2f 636f  rfaces/common/co
+000067c0: 6e66 6f72 6d5f 696d 6167 652e 7079 234c  nform_image.py#L
+000067d0: 3735 0a0a 2020 2020 2222 220a 0a20 2020  75..    """..   
+000067e0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+000067f0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00006800: 4465 6469 6361 7465 6420 746f 2074 6865  Dedicated to the
+00006810: 2061 7474 7269 6275 7465 7320 696e 6974   attributes init
+00006820: 6961 6c69 7361 7469 6f6e 202f 2069 6e73  ialisation / ins
+00006830: 7461 6e74 6961 7469 6f6e 2e0a 0a20 2020  tantiation...   
+00006840: 2020 2020 2054 6865 2069 6e70 7574 2061       The input a
+00006850: 6e64 206f 7574 7075 7420 706c 7567 7320  nd output plugs 
+00006860: 6172 6520 6465 6669 6e65 6420 6865 7265  are defined here
+00006870: 2e20 5468 6520 7370 6563 6961 6c0a 2020  . The special.  
+00006880: 2020 2020 2020 2773 656c 662e 7265 7175        'self.requ
+00006890: 6972 656d 656e 7427 2061 7474 7269 6275  irement' attribu
+000068a0: 7465 2028 6f70 7469 6f6e 616c 2920 6973  te (optional) is
+000068b0: 2075 7365 6420 746f 2064 6566 696e 6520   used to define 
+000068c0: 7468 650a 2020 2020 2020 2020 7468 6972  the.        thir
+000068d0: 642d 7061 7274 7920 7072 6f64 7563 7473  d-party products
+000068e0: 206e 6563 6573 7361 7279 2066 6f72 2074   necessary for t
+000068f0: 6865 2072 756e 6e69 6e67 206f 6620 7468  he running of th
+00006900: 6520 6272 6963 6b2e 0a20 2020 2020 2020  e brick..       
+00006910: 2022 2222 0a20 2020 2020 2020 2023 2049   """.        # I
+00006920: 6e69 7469 616c 6973 6174 696f 6e20 6f66  nitialisation of
+00006930: 2074 6865 206f 626a 6563 7473 206e 6565   the objects nee
+00006940: 6465 6420 666f 7220 7468 6520 6c61 756e  ded for the laun
+00006950: 6368 206f 6620 7468 6520 6272 6963 6b0a  ch of the brick.
+00006960: 2020 2020 2020 2020 7375 7065 7228 436f          super(Co
+00006970: 6e66 6f72 6d49 6d61 6765 2c20 7365 6c66  nformImage, self
+00006980: 292e 5f5f 696e 6974 5f5f 2829 0a0a 2020  ).__init__()..  
+00006990: 2020 2020 2020 2320 5468 6972 6420 7061        # Third pa
+000069a0: 7274 7920 736f 6674 7761 7265 7320 7265  rty softwares re
+000069b0: 7175 6972 6564 2066 6f72 2074 6865 2065  quired for the e
+000069c0: 7865 6375 7469 6f6e 206f 6620 7468 6520  xecution of the 
+000069d0: 6272 6963 6b0a 2020 2020 2020 2020 7365  brick.        se
+000069e0: 6c66 2e72 6571 7569 7265 6d65 6e74 203d  lf.requirement =
+000069f0: 205b 5d0a 0a20 2020 2020 2020 2023 2049   []..        # I
+00006a00: 6e70 7574 7320 6465 7363 7269 7074 696f  nputs descriptio
+00006a10: 6e0a 2020 2020 2020 2020 696e 5f66 696c  n.        in_fil
+00006a20: 655f 6465 7363 203d 2022 416e 2065 7869  e_desc = "An exi
+00006a30: 7374 696e 6720 7061 7468 2066 696c 652e  sting path file.
+00006a40: 220a 2020 2020 2020 2020 7072 6566 6978  ".        prefix
+00006a50: 5f64 6573 6320 3d20 2250 7265 6669 7820  _desc = "Prefix 
+00006a60: 6f66 2074 6865 206f 7574 7075 7420 696d  of the output im
+00006a70: 6167 6520 2861 2073 7472 696e 6729 2e22  age (a string)."
+00006a80: 0a20 2020 2020 2020 2073 7566 6669 785f  .        suffix_
+00006a90: 6465 7363 203d 2022 5375 6666 6978 206f  desc = "Suffix o
+00006aa0: 6620 7468 6520 6f75 7470 7574 2069 6d61  f the output ima
+00006ab0: 6765 2028 6120 7374 7269 6e67 292e 220a  ge (a string).".
+00006ac0: 0a20 2020 2020 2020 2023 204f 7574 7075  .        # Outpu
+00006ad0: 7473 2064 6573 6372 6970 7469 6f6e 0a20  ts description. 
+00006ae0: 2020 2020 2020 206f 7574 5f66 696c 655f         out_file_
+00006af0: 6465 7363 203d 2028 0a20 2020 2020 2020  desc = (.       
+00006b00: 2020 2020 2022 5061 7468 206f 6620 7468       "Path of th
+00006b10: 6520 636f 6e66 6f72 6d65 6420 7363 616e  e conformed scan
+00006b20: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+00006b30: 2861 2070 6174 686c 696b 6520 6f62 6a65  (a pathlike obje
+00006b40: 6374 206f 7220 7374 7269 6e67 2072 6570  ct or string rep
+00006b50: 7265 7365 6e74 696e 6720 6120 6669 6c65  resenting a file
+00006b60: 292e 220a 2020 2020 2020 2020 290a 0a20  ).".        ).. 
+00006b70: 2020 2020 2020 2023 2049 6e70 7574 7320         # Inputs 
+00006b80: 7472 6169 7473 0a20 2020 2020 2020 2073  traits.        s
+00006b90: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
+00006ba0: 2020 2020 2020 2020 2020 2022 696e 5f66             "in_f
+00006bb0: 696c 6522 2c20 4669 6c65 286f 7574 7075  ile", File(outpu
+00006bc0: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
+00006bd0: 6c3d 4661 6c73 652c 2064 6573 633d 696e  l=False, desc=in
+00006be0: 5f66 696c 655f 6465 7363 290a 2020 2020  _file_desc).    
+00006bf0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+00006c00: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
+00006c10: 2020 2020 2020 2020 2020 2022 7072 6566             "pref
+00006c20: 6978 222c 0a20 2020 2020 2020 2020 2020  ix",.           
+00006c30: 2074 7261 6974 732e 5374 7269 6e67 2822   traits.String("
+00006c40: 222c 206f 7574 7075 743d 4661 6c73 652c  ", output=False,
+00006c50: 206f 7074 696f 6e61 6c3d 5472 7565 2c20   optional=True, 
+00006c60: 6465 7363 3d70 7265 6669 785f 6465 7363  desc=prefix_desc
+00006c70: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00006c80: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00006c90: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+00006ca0: 2020 2273 7566 6669 7822 2c0a 2020 2020    "suffix",.    
+00006cb0: 2020 2020 2020 2020 7472 6169 7473 2e53          traits.S
+00006cc0: 7472 696e 6728 2222 2c20 6f75 7470 7574  tring("", output
+00006cd0: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
+00006ce0: 3d54 7275 652c 2064 6573 633d 7375 6666  =True, desc=suff
+00006cf0: 6978 5f64 6573 6329 2c0a 2020 2020 2020  ix_desc),.      
+00006d00: 2020 290a 0a20 2020 2020 2020 2023 204f    )..        # O
+00006d10: 7574 7075 7473 2074 7261 6974 730a 2020  utputs traits.  
+00006d20: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00006d30: 7261 6974 2822 6f75 745f 6669 6c65 222c  rait("out_file",
+00006d40: 2046 696c 6528 6f75 7470 7574 3d54 7275   File(output=Tru
+00006d50: 652c 2064 6573 633d 6f75 745f 6669 6c65  e, desc=out_file
+00006d60: 5f64 6573 6329 290a 0a20 2020 2020 2020  _desc))..       
+00006d70: 2073 656c 662e 696e 6974 5f64 6566 6175   self.init_defau
+00006d80: 6c74 5f74 7261 6974 7328 290a 0a20 2020  lt_traits()..   
+00006d90: 2064 6566 206c 6973 745f 6f75 7470 7574   def list_output
+00006da0: 7328 7365 6c66 2c20 6973 5f70 6c75 6767  s(self, is_plugg
+00006db0: 6564 3d4e 6f6e 6529 3a0a 2020 2020 2020  ed=None):.      
+00006dc0: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
+00006dd0: 6f20 7468 6520 696e 6974 6961 6c69 7361  o the initialisa
+00006de0: 7469 6f6e 2073 7465 7020 6f66 2074 6865  tion step of the
+00006df0: 2062 7269 636b 2e0a 0a20 2020 2020 2020   brick...       
+00006e00: 2054 6865 206d 6169 6e20 6f62 6a65 6374   The main object
+00006e10: 6976 6520 6f66 2074 6869 7320 6d65 7468  ive of this meth
+00006e20: 6f64 2069 7320 746f 2070 726f 6475 6365  od is to produce
+00006e30: 2074 6865 206f 7574 7075 7473 206f 6620   the outputs of 
+00006e40: 7468 650a 2020 2020 2020 2020 6272 6963  the.        bric
+00006e50: 6b73 2028 7365 6c66 2e6f 7574 7075 7473  ks (self.outputs
+00006e60: 2920 616e 6420 7468 6520 6173 736f 6369  ) and the associ
+00006e70: 6174 6564 2074 6167 7320 2873 656c 662e  ated tags (self.
+00006e80: 696e 6865 7269 7461 6e63 655f 6469 6329  inheritance_dic)
+00006e90: 2c0a 2020 2020 2020 2020 6966 2064 6566  ,.        if def
+00006ea0: 696e 6564 2068 6572 652e 2054 6f20 776f  ined here. To wo
+00006eb0: 726b 2070 726f 7065 726c 7920 7468 6973  rk properly this
+00006ec0: 206d 6574 686f 6420 6d75 7374 2072 6574   method must ret
+00006ed0: 7572 6e0a 2020 2020 2020 2020 7365 6c66  urn.        self
+00006ee0: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
+00006ef0: 2829 206f 626a 6563 742e 0a0a 2020 2020  () object...    
+00006f00: 2020 2020 3a70 6172 616d 2069 735f 706c      :param is_pl
+00006f10: 7567 6765 643a 2074 6865 2073 7461 7465  ugged: the state
+00006f20: 2c20 6c69 6e6b 6564 206f 7220 6e6f 742c  , linked or not,
+00006f30: 206f 6620 7468 6520 706c 7567 732e 0a20   of the plugs.. 
+00006f40: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
+00006f50: 2061 2064 6963 7469 6f6e 6172 7920 7769   a dictionary wi
+00006f60: 7468 2072 6571 7569 7265 6d65 6e74 2c20  th requirement, 
+00006f70: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
+00006f80: 7269 7461 6e63 655f 6469 6374 2e0a 2020  ritance_dict..  
+00006f90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00006fa0: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
+00006fb0: 6865 7269 7461 6e63 6520 746f 2050 726f  heritance to Pro
+00006fc0: 6365 7373 4d49 4120 636c 6173 732c 206c  cessMIA class, l
+00006fd0: 6973 745f 6f75 7470 7574 7320 6d65 7468  ist_outputs meth
+00006fe0: 6f64 0a20 2020 2020 2020 2073 7570 6572  od.        super
+00006ff0: 2843 6f6e 666f 726d 496d 6167 652c 2073  (ConformImage, s
+00007000: 656c 6629 2e6c 6973 745f 6f75 7470 7574  elf).list_output
+00007010: 7328 290a 0a20 2020 2020 2020 2023 204f  s()..        # O
+00007020: 7574 7075 7473 2064 6566 696e 6974 696f  utputs definitio
+00007030: 6e0a 2020 2020 2020 2020 6966 2073 656c  n.        if sel
+00007040: 662e 696e 5f66 696c 653a 0a20 2020 2020  f.in_file:.     
+00007050: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00007060: 2020 2020 2020 2020 2020 2020 286e 6f74              (not
+00007070: 2073 656c 662e 7375 6666 6978 290a 2020   self.suffix).  
+00007080: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00007090: 2028 7365 6c66 2e73 7566 6669 782e 6973   (self.suffix.is
+000070a0: 7370 6163 6528 2929 0a20 2020 2020 2020  space()).       
+000070b0: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+000070c0: 2e73 7566 6669 7820 696e 205b 556e 6465  .suffix in [Unde
+000070d0: 6669 6e65 642c 2022 3c75 6e64 6566 696e  fined, "<undefin
+000070e0: 6564 3e22 5d0a 2020 2020 2020 2020 2020  ed>"].          
+000070f0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00007100: 2020 2020 2073 656c 662e 7375 6666 6978       self.suffix
+00007110: 203d 2022 2022 0a0a 2020 2020 2020 2020   = " "..        
+00007120: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00007130: 2020 2020 2020 2020 2028 6e6f 7420 7365           (not se
+00007140: 6c66 2e70 7265 6669 7829 0a20 2020 2020  lf.prefix).     
+00007150: 2020 2020 2020 2020 2020 206f 7220 2873             or (s
+00007160: 656c 662e 7072 6566 6978 2e69 7373 7061  elf.prefix.isspa
+00007170: 6365 2829 290a 2020 2020 2020 2020 2020  ce()).          
+00007180: 2020 2020 2020 6f72 2028 7365 6c66 2e70        or (self.p
+00007190: 7265 6669 7820 696e 205b 556e 6465 6669  refix in [Undefi
+000071a0: 6e65 642c 2022 3c75 6e64 6566 696e 6564  ned, "<undefined
+000071b0: 3e22 5d29 0a20 2020 2020 2020 2020 2020  >"]).           
+000071c0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+000071d0: 2020 2020 7365 6c66 2e70 7265 6669 7820      self.prefix 
+000071e0: 3d20 2220 220a 0a20 2020 2020 2020 2020  = " "..         
+000071f0: 2020 2076 616c 6964 5f65 7874 2c20 696e     valid_ext, in
+00007200: 5f65 7874 2c20 6669 6c65 5f6e 616d 6520  _ext, file_name 
+00007210: 3d20 6368 6563 6b46 696c 6545 7874 2873  = checkFileExt(s
+00007220: 656c 662e 696e 5f66 696c 652c 2045 5854  elf.in_file, EXT
+00007230: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00007240: 6620 6e6f 7420 7661 6c69 645f 6578 743a  f not valid_ext:
+00007250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007260: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+00007270: 2020 2020 2020 2020 2020 2020 225c 6e43              "\nC
+00007280: 6f6e 666f 726d 496d 6167 6520 6272 6963  onformImage bric
+00007290: 6b3a 2054 6865 2069 6e70 7574 2069 6d61  k: The input ima
+000072a0: 6765 2066 6f72 6d61 7420 6973 206e 6f74  ge format is not
+000072b0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000072c0: 2020 2020 2020 2022 7265 636f 676e 697a         "recogniz
+000072d0: 6564 2e2e 2e21 220a 2020 2020 2020 2020  ed...!".        
+000072e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000072f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007300: 0a0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+00007310: 7468 2c20 5f20 3d20 6f73 2e70 6174 682e  th, _ = os.path.
+00007320: 7370 6c69 7428 7365 6c66 2e69 6e5f 6669  split(self.in_fi
+00007330: 6c65 290a 0a20 2020 2020 2020 2020 2020  le)..           
+00007340: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00007350: 2020 2020 2020 7365 6c66 2e73 7566 6669        self.suffi
+00007360: 7820 3d3d 2022 2022 0a20 2020 2020 2020  x == " ".       
+00007370: 2020 2020 2020 2020 2061 6e64 2073 656c           and sel
+00007380: 662e 7072 6566 6978 203d 3d20 2220 220a  f.prefix == " ".
+00007390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073a0: 616e 6420 7061 7468 203d 3d20 7365 6c66  and path == self
+000073b0: 2e6f 7574 7075 745f 6469 7265 6374 6f72  .output_director
+000073c0: 790a 2020 2020 2020 2020 2020 2020 293a  y.            ):
+000073d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000073e0: 206d 7367 203d 2051 4d65 7373 6167 6542   msg = QMessageB
+000073f0: 6f78 2829 0a20 2020 2020 2020 2020 2020  ox().           
+00007400: 2020 2020 206d 7367 2e73 6574 4963 6f6e       msg.setIcon
+00007410: 2851 4d65 7373 6167 6542 6f78 2e57 6172  (QMessageBox.War
+00007420: 6e69 6e67 290a 2020 2020 2020 2020 2020  ning).          
+00007430: 2020 2020 2020 6d73 672e 7365 7457 696e        msg.setWin
+00007440: 646f 7754 6974 6c65 280a 2020 2020 2020  dowTitle(.      
+00007450: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+00007460: 6961 5f70 726f 6365 7373 6573 202d 2043  ia_processes - C
+00007470: 6f6e 666f 726d 496d 6167 6520 6272 6963  onformImage bric
+00007480: 6b20 5761 726e 696e 6721 220a 2020 2020  k Warning!".    
+00007490: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000074a0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+000074b0: 672e 7365 7454 6578 7428 0a20 2020 2020  g.setText(.     
+000074c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000074d0: 5375 6666 6978 2061 6e64 2070 7265 6669  Suffix and prefi
+000074e0: 7820 696e 7075 7420 7061 7261 6d65 7465  x input paramete
+000074f0: 7273 2061 7265 206e 6f74 2022 0a20 2020  rs are not ".   
+00007500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007510: 2022 6465 6669 6e65 6420 6f72 2063 6f6e   "defined or con
+00007520: 7369 7374 206f 6e6c 7920 6f66 206f 6e65  sist only of one
+00007530: 206f 7220 6d6f 7265 2077 6869 7465 2022   or more white "
+00007540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007550: 2020 2020 2022 7370 6163 6573 2e5c 6e54       "spaces.\nT
+00007560: 6865 207b 307d 2069 6e70 7574 2070 6172  he {0} input par
+00007570: 616d 6574 6572 2077 696c 6c20 6265 2022  ameter will be "
+00007580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007590: 2020 2020 2022 6f76 6572 7772 6974 7465       "overwritte
+000075a0: 6e20 2e2e 2e5c 6e20 5965 7320 6f72 2022  n ...\n Yes or "
+000075b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000075c0: 2020 2020 2022 4162 6f72 743f 222e 666f       "Abort?".fo
+000075d0: 726d 6174 2866 696c 655f 6e61 6d65 290a  rmat(file_name).
+000075e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007600: 2020 6d73 672e 7365 7453 7461 6e64 6172    msg.setStandar
+00007610: 6442 7574 746f 6e73 2851 4d65 7373 6167  dButtons(QMessag
+00007620: 6542 6f78 2e59 6573 207c 2051 4d65 7373  eBox.Yes | QMess
+00007630: 6167 6542 6f78 2e41 626f 7274 290a 2020  ageBox.Abort).  
+00007640: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00007650: 7476 616c 203d 206d 7367 2e65 7865 635f  tval = msg.exec_
+00007660: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00007670: 2020 2020 6966 2072 6574 7661 6c20 213d      if retval !=
+00007680: 2051 4d65 7373 6167 6542 6f78 2e41 626f   QMessageBox.Abo
+00007690: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
+000076a0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+000076b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076c0: 2020 2020 2020 2022 5c6e 436f 6e66 6f72         "\nConfor
+000076d0: 6d49 6d61 6765 2062 7269 636b 2077 6172  mImage brick war
+000076e0: 6e69 6e67 3a20 7468 6520 6f75 745f 6669  ning: the out_fi
+000076f0: 6c65 206f 7574 7075 7420 220a 2020 2020  le output ".    
 00007700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007710: 2020 2022 7061 7261 6d65 7465 7220 2873     "parameter (s
-00007720: 7566 6669 7820 616e 6420 7072 6566 6978  uffix and prefix
-00007730: 2061 7265 206e 6f74 2064 6566 696e 6564   are not defined
-00007740: 293a 220a 2020 2020 2020 2020 2020 2020  ):".            
-00007750: 2020 2020 2020 2020 2020 2020 225c 6e7b              "\n{
-00007760: 307d 2077 696c 6c20 6265 206f 7665 7277  0} will be overw
-00007770: 7269 7474 656e 202e 2e2e 222e 666f 726d  ritten ...".form
-00007780: 6174 2866 696c 655f 6e61 6d65 290a 2020  at(file_name).  
+00007710: 2020 2020 2270 6172 616d 6574 6572 2069      "parameter i
+00007720: 7320 7468 6520 7361 6d65 2061 7320 7468  s the same as th
+00007730: 6520 696e 5f66 696c 6573 2069 6e70 7574  e in_files input
+00007740: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00007750: 2020 2020 2020 2020 2020 2022 7061 7261             "para
+00007760: 6d65 7465 7220 2873 7566 6669 7820 616e  meter (suffix an
+00007770: 6420 7072 6566 6978 2061 7265 206e 6f74  d prefix are not
+00007780: 2064 6566 696e 6564 293a 220a 2020 2020   defined):".    
 00007790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000077b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000077c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000077d0: 696e 7428 225c 6e41 626f 7274 6564 2e20  int("\nAborted. 
-000077e0: 506c 6561 7365 2063 6865 636b 2079 6f75  Please check you
-000077f0: 7220 696e 7075 7420 7061 7261 6d65 7465  r input paramete
-00007800: 7273 202e 2e2e 2229 0a20 2020 2020 2020  rs ...").       
-00007810: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00007820: 7572 6e0a 0a20 2020 2020 2020 2020 2020  urn..           
-00007830: 2066 696c 6520 3d20 6f73 2e70 6174 682e   file = os.path.
-00007840: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
-00007850: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
-00007860: 745f 6469 7265 6374 6f72 792c 0a20 2020  t_directory,.   
-00007870: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
-00007880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007890: 2020 2073 656c 662e 7072 6566 6978 2e73     self.prefix.s
-000078a0: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-000078b0: 2020 2020 2020 2020 2020 202b 2066 696c             + fil
-000078c0: 655f 6e61 6d65 0a20 2020 2020 2020 2020  e_name.         
-000078d0: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
-000078e0: 662e 7375 6666 6978 2e73 7472 6970 2829  f.suffix.strip()
-000078f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007900: 2020 2020 202b 2022 2e22 0a20 2020 2020       + ".".     
-00007910: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00007920: 2069 6e5f 6578 740a 2020 2020 2020 2020   in_ext.        
-00007930: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00007940: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00007950: 2020 2020 2069 6620 6669 6c65 3a0a 2020       if file:.  
-00007960: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00007970: 6c66 2e6f 7574 7075 7473 5b22 6f75 745f  lf.outputs["out_
-00007980: 6669 6c65 225d 203d 2066 696c 650a 2020  file"] = file.  
-00007990: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000079a0: 4649 584d 453a 2049 6e20 7468 6520 6c61  FIXME: In the la
-000079b0: 7465 7374 2076 6572 7369 6f6e 206f 6620  test version of 
-000079c0: 6d69 612c 2069 6e64 6578 696e 6720 6f66  mia, indexing of
-000079d0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-000079e0: 2020 2020 2023 2020 2020 2020 2020 6461       #        da
-000079f0: 7461 6261 7365 2077 6974 6820 7061 7274  tabase with part
-00007a00: 6963 756c 6172 2074 6167 7320 6465 6669  icular tags defi
-00007a10: 6e65 6420 696e 2074 6865 0a20 2020 2020  ned in the.     
-00007a20: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00007a30: 2020 2020 7072 6f63 6573 7365 7320 6973      processes is
-00007a40: 2064 6f6e 6520 6f6e 6c79 2061 7420 7468   done only at th
-00007a50: 6520 656e 6420 6f66 2074 6865 0a20 2020  e end of the.   
-00007a60: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00007a70: 2020 2020 2020 696e 6974 6961 6c69 7361        initialisa
-00007a80: 7469 6f6e 206f 6620 7468 6520 7768 6f6c  tion of the whol
-00007a90: 6520 7069 7065 6c69 6e65 2e20 536f 2077  e pipeline. So w
-00007aa0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00007ab0: 2020 2320 2020 2020 2020 2063 616e 6e6f    #        canno
-00007ac0: 7420 7573 6520 7468 6520 7661 6c75 6520  t use the value 
-00007ad0: 6f66 2074 6865 7365 2074 6167 7320 696e  of these tags in
-00007ae0: 206f 7468 6572 0a20 2020 2020 2020 2020   other.         
-00007af0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00007b00: 7072 6f63 6573 7365 7320 6f66 2074 6865  processes of the
-00007b10: 2070 6970 656c 696e 6520 6174 2074 6865   pipeline at the
-00007b20: 2074 696d 6520 6f66 0a20 2020 2020 2020   time of.       
-00007b30: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-00007b40: 2020 696e 6974 6961 6c69 7361 7469 6f6e    initialisation
-00007b50: 2028 7365 6520 706f 7075 6c73 655f 6d69   (see populse_mi
-00007b60: 6120 2332 3930 292e 2055 6e74 690a 2020  a #290). Unti.  
-00007b70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007b80: 2020 2020 2020 2062 6574 7465 7220 7765         better we
-00007b90: 2075 7365 2061 2071 7569 636b 2061 6e64   use a quick and
-00007ba0: 2064 6972 7479 2068 6163 6b20 7769 7468   dirty hack with
-00007bb0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00007bc0: 2020 2020 2023 2020 2020 2020 2020 7365       #        se
-00007bd0: 745f 6462 4669 656c 6456 616c 7565 2829  t_dbFieldValue()
-00007be0: 2066 756e 6374 696f 6e20 210a 0a20 2020   function !..   
-00007bf0: 2020 2020 2020 2020 2020 2020 2023 2047               # G
-00007c00: 6574 2070 6174 6965 6e74 206e 616d 650a  et patient name.
-00007c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c20: 7061 7469 656e 745f 6e61 6d65 203d 2067  patient_name = g
-00007c30: 6574 5f64 6246 6965 6c64 5661 6c75 6528  et_dbFieldValue(
-00007c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007c50: 2020 2020 2073 656c 662e 7072 6f6a 6563       self.projec
-00007c60: 742c 2073 656c 662e 696e 5f66 696c 652c  t, self.in_file,
-00007c70: 2022 5061 7469 656e 744e 616d 6522 0a20   "PatientName". 
-00007c80: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00007c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007ca0: 2069 6620 7061 7469 656e 745f 6e61 6d65   if patient_name
-00007cb0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00007cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007cd0: 2020 7461 675f 746f 5f61 6464 203d 2064    tag_to_add = d
-00007ce0: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
-00007cf0: 2020 2020 2020 2020 2020 7461 675f 746f            tag_to
-00007d00: 5f61 6464 5b22 6e61 6d65 225d 203d 2022  _add["name"] = "
-00007d10: 5061 7469 656e 744e 616d 6522 0a20 2020  PatientName".   
-00007d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007d30: 2074 6167 5f74 6f5f 6164 645b 2266 6965   tag_to_add["fie
-00007d40: 6c64 5f74 7970 6522 5d20 3d20 2273 7472  ld_type"] = "str
-00007d50: 696e 6722 0a20 2020 2020 2020 2020 2020  ing".           
-00007d60: 2020 2020 2020 2020 2074 6167 5f74 6f5f           tag_to_
-00007d70: 6164 645b 2264 6573 6372 6970 7469 6f6e  add["description
-00007d80: 225d 203d 2022 220a 2020 2020 2020 2020  "] = "".        
-00007d90: 2020 2020 2020 2020 2020 2020 7461 675f              tag_
-00007da0: 746f 5f61 6464 5b22 7669 7369 6269 6c69  to_add["visibili
-00007db0: 7479 225d 203d 2054 7275 650a 2020 2020  ty"] = True.    
-00007dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007dd0: 7461 675f 746f 5f61 6464 5b22 6f72 6967  tag_to_add["orig
-00007de0: 696e 225d 203d 2022 7573 6572 220a 2020  in"] = "user".  
-00007df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e00: 2020 7461 675f 746f 5f61 6464 5b22 756e    tag_to_add["un
-00007e10: 6974 225d 203d 204e 6f6e 650a 2020 2020  it"] = None.    
-00007e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e30: 7461 675f 746f 5f61 6464 5b22 6465 6661  tag_to_add["defa
-00007e40: 756c 745f 7661 6c75 6522 5d20 3d20 4e6f  ult_value"] = No
-00007e50: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00007e60: 2020 2020 2020 2074 6167 5f74 6f5f 6164         tag_to_ad
-00007e70: 645b 2276 616c 7565 225d 203d 2070 6174  d["value"] = pat
-00007e80: 6965 6e74 5f6e 616d 650a 2020 2020 2020  ient_name.      
-00007e90: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00007ea0: 745f 6462 4669 656c 6456 616c 7565 280a  t_dbFieldValue(.
-00007eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ec0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00007ed0: 6a65 6374 2c20 7365 6c66 2e6f 7574 7075  ject, self.outpu
-00007ee0: 7473 5b22 6f75 745f 6669 6c65 225d 2c20  ts["out_file"], 
-00007ef0: 7461 675f 746f 5f61 6464 0a20 2020 2020  tag_to_add.     
-00007f00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00007f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007f20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00007f30: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00007f40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007f50: 2020 2020 2020 2020 2020 2227 5061 7469            "'Pati
-00007f60: 656e 744e 616d 6527 2074 6167 206e 6f74  entName' tag not
-00007f70: 2069 6e20 7468 6520 6461 7461 6261 7365   in the database
-00007f80: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00007f90: 2020 2020 2020 2020 2020 2022 5468 6973             "This
-00007fa0: 206d 6179 2063 6175 7365 2061 6e20 6973   may cause an is
-00007fb0: 7375 6520 6475 7269 6e67 2074 6865 2072  sue during the r
-00007fc0: 6573 7420 6f66 2074 6865 2022 0a20 2020  est of the ".   
+000077a0: 2020 2020 225c 6e7b 307d 2077 696c 6c20      "\n{0} will 
+000077b0: 6265 206f 7665 7277 7269 7474 656e 202e  be overwritten .
+000077c0: 2e2e 222e 666f 726d 6174 2866 696c 655f  ..".format(file_
+000077d0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+000077e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000077f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00007800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007810: 2020 2020 2020 7072 696e 7428 225c 6e41        print("\nA
+00007820: 626f 7274 6564 2e20 506c 6561 7365 2063  borted. Please c
+00007830: 6865 636b 2079 6f75 7220 696e 7075 7420  heck your input 
+00007840: 7061 7261 6d65 7465 7273 202e 2e2e 2229  parameters ...")
+00007850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007860: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00007870: 2020 2020 2020 2020 2066 696c 6520 3d20           file = 
+00007880: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
+00007890: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000078a0: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
+000078b0: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
+000078c0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+000078d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000078e0: 7072 6566 6978 2e73 7472 6970 2829 0a20  prefix.strip(). 
+000078f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007900: 2020 202b 2066 696c 655f 6e61 6d65 0a20     + file_name. 
+00007910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007920: 2020 202b 2073 656c 662e 7375 6666 6978     + self.suffix
+00007930: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00007940: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00007950: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+00007960: 2020 2020 2020 202b 2069 6e5f 6578 740a         + in_ext.
+00007970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007980: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00007990: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000079a0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+000079b0: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+000079c0: 7473 5b22 6f75 745f 6669 6c65 225d 203d  ts["out_file"] =
+000079d0: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+000079e0: 2020 2020 2020 2320 4649 584d 453a 2049        # FIXME: I
+000079f0: 6e20 7468 6520 6c61 7465 7374 2076 6572  n the latest ver
+00007a00: 7369 6f6e 206f 6620 6d69 612c 2069 6e64  sion of mia, ind
+00007a10: 6578 696e 6720 6f66 2074 6865 0a20 2020  exing of the.   
+00007a20: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00007a30: 2020 2020 2020 6461 7461 6261 7365 2077        database w
+00007a40: 6974 6820 7061 7274 6963 756c 6172 2074  ith particular t
+00007a50: 6167 7320 6465 6669 6e65 6420 696e 2074  ags defined in t
+00007a60: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00007a70: 2020 2023 2020 2020 2020 2020 7072 6f63     #        proc
+00007a80: 6573 7365 7320 6973 2064 6f6e 6520 6f6e  esses is done on
+00007a90: 6c79 2061 7420 7468 6520 656e 6420 6f66  ly at the end of
+00007aa0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00007ab0: 2020 2020 2023 2020 2020 2020 2020 696e       #        in
+00007ac0: 6974 6961 6c69 7361 7469 6f6e 206f 6620  itialisation of 
+00007ad0: 7468 6520 7768 6f6c 6520 7069 7065 6c69  the whole pipeli
+00007ae0: 6e65 2e20 536f 2077 650a 2020 2020 2020  ne. So we.      
+00007af0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00007b00: 2020 2063 616e 6e6f 7420 7573 6520 7468     cannot use th
+00007b10: 6520 7661 6c75 6520 6f66 2074 6865 7365  e value of these
+00007b20: 2074 6167 7320 696e 206f 7468 6572 0a20   tags in other. 
+00007b30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00007b40: 2020 2020 2020 2020 7072 6f63 6573 7365          processe
+00007b50: 7320 6f66 2074 6865 2070 6970 656c 696e  s of the pipelin
+00007b60: 6520 6174 2074 6865 2074 696d 6520 6f66  e at the time of
+00007b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007b80: 2023 2020 2020 2020 2020 696e 6974 6961   #        initia
+00007b90: 6c69 7361 7469 6f6e 2028 7365 6520 706f  lisation (see po
+00007ba0: 7075 6c73 655f 6d69 6120 2332 3930 292e  pulse_mia #290).
+00007bb0: 2055 6e74 690a 2020 2020 2020 2020 2020   Unti.          
+00007bc0: 2020 2020 2020 2320 2020 2020 2020 2062        #        b
+00007bd0: 6574 7465 7220 7765 2075 7365 2061 2071  etter we use a q
+00007be0: 7569 636b 2061 6e64 2064 6972 7479 2068  uick and dirty h
+00007bf0: 6163 6b20 7769 7468 2074 6865 0a20 2020  ack with the.   
+00007c00: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00007c10: 2020 2020 2020 7365 745f 6462 4669 656c        set_dbFiel
+00007c20: 6456 616c 7565 2829 2066 756e 6374 696f  dValue() functio
+00007c30: 6e20 210a 0a20 2020 2020 2020 2020 2020  n !..           
+00007c40: 2020 2020 2023 2047 6574 2070 6174 6965       # Get patie
+00007c50: 6e74 206e 616d 650a 2020 2020 2020 2020  nt name.        
+00007c60: 2020 2020 2020 2020 7061 7469 656e 745f          patient_
+00007c70: 6e61 6d65 203d 2067 6574 5f64 6246 6965  name = get_dbFie
+00007c80: 6c64 5661 6c75 6528 0a20 2020 2020 2020  ldValue(.       
+00007c90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00007ca0: 662e 7072 6f6a 6563 742c 2073 656c 662e  f.project, self.
+00007cb0: 696e 5f66 696c 652c 2022 5061 7469 656e  in_file, "Patien
+00007cc0: 744e 616d 6522 0a20 2020 2020 2020 2020  tName".         
+00007cd0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00007ce0: 2020 2020 2020 2020 2069 6620 7061 7469           if pati
+00007cf0: 656e 745f 6e61 6d65 2069 7320 6e6f 7420  ent_name is not 
+00007d00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00007d10: 2020 2020 2020 2020 2020 7461 675f 746f            tag_to
+00007d20: 5f61 6464 203d 2064 6963 7428 290a 2020  _add = dict().  
+00007d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d40: 2020 7461 675f 746f 5f61 6464 5b22 6e61    tag_to_add["na
+00007d50: 6d65 225d 203d 2022 5061 7469 656e 744e  me"] = "PatientN
+00007d60: 616d 6522 0a20 2020 2020 2020 2020 2020  ame".           
+00007d70: 2020 2020 2020 2020 2074 6167 5f74 6f5f           tag_to_
+00007d80: 6164 645b 2266 6965 6c64 5f74 7970 6522  add["field_type"
+00007d90: 5d20 3d20 2273 7472 696e 6722 0a20 2020  ] = "string".   
+00007da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007db0: 2074 6167 5f74 6f5f 6164 645b 2264 6573   tag_to_add["des
+00007dc0: 6372 6970 7469 6f6e 225d 203d 2022 220a  cription"] = "".
+00007dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007de0: 2020 2020 7461 675f 746f 5f61 6464 5b22      tag_to_add["
+00007df0: 7669 7369 6269 6c69 7479 225d 203d 2054  visibility"] = T
+00007e00: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00007e10: 2020 2020 2020 2020 7461 675f 746f 5f61          tag_to_a
+00007e20: 6464 5b22 6f72 6967 696e 225d 203d 2022  dd["origin"] = "
+00007e30: 7573 6572 220a 2020 2020 2020 2020 2020  user".          
+00007e40: 2020 2020 2020 2020 2020 7461 675f 746f            tag_to
+00007e50: 5f61 6464 5b22 756e 6974 225d 203d 204e  _add["unit"] = N
+00007e60: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00007e70: 2020 2020 2020 2020 7461 675f 746f 5f61          tag_to_a
+00007e80: 6464 5b22 6465 6661 756c 745f 7661 6c75  dd["default_valu
+00007e90: 6522 5d20 3d20 4e6f 6e65 0a20 2020 2020  e"] = None.     
+00007ea0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00007eb0: 6167 5f74 6f5f 6164 645b 2276 616c 7565  ag_to_add["value
+00007ec0: 225d 203d 2070 6174 6965 6e74 5f6e 616d  "] = patient_nam
+00007ed0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00007ee0: 2020 2020 2020 7365 745f 6462 4669 656c        set_dbFiel
+00007ef0: 6456 616c 7565 280a 2020 2020 2020 2020  dValue(.        
+00007f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f10: 7365 6c66 2e70 726f 6a65 6374 2c20 7365  self.project, se
+00007f20: 6c66 2e6f 7574 7075 7473 5b22 6f75 745f  lf.outputs["out_
+00007f30: 6669 6c65 225d 2c20 7461 675f 746f 5f61  file"], tag_to_a
+00007f40: 6464 0a20 2020 2020 2020 2020 2020 2020  dd.             
+00007f50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00007f60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f80: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007fa0: 2020 2227 5061 7469 656e 744e 616d 6527    "'PatientName'
+00007fb0: 2074 6167 206e 6f74 2069 6e20 7468 6520   tag not in the 
+00007fc0: 6461 7461 6261 7365 2022 0a20 2020 2020  database ".     
 00007fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007fe0: 2020 2020 2022 7072 6f63 6573 732c 2069       "process, i
-00007ff0: 6620 7468 6973 2062 7269 636b 2069 7320  f this brick is 
-00008000: 7573 6564 2069 6e20 6120 7069 7065 6c69  used in a pipeli
-00008010: 6e65 220a 2020 2020 2020 2020 2020 2020  ne".            
-00008020: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00008030: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00008040: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00008050: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00008060: 2020 2020 2020 2020 222d 2043 6f6e 666f          "- Confo
-00008070: 726d 496d 6167 6520 6272 6963 6b3a 2054  rmImage brick: T
-00008080: 6865 7265 2077 6173 206e 6f20 6f75 7470  here was no outp
-00008090: 7574 2066 696c 6520 6465 6475 6374 6564  ut file deducted
-000080a0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000080b0: 2020 2020 2020 2022 6475 7269 6e67 2069         "during i
-000080c0: 6e69 7469 616c 697a 6174 696f 6e2e 2050  nitialization. P
-000080d0: 6c65 6173 6520 6368 6563 6b20 7468 6520  lease check the 
-000080e0: 696e 7075 7420 220a 2020 2020 2020 2020  input ".        
-000080f0: 2020 2020 2020 2020 2020 2020 2270 6172              "par
-00008100: 616d 6574 6572 732e 2e2e 2122 0a20 2020  ameters...!".   
-00008110: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00008120: 2020 2020 2020 2020 2020 2020 2320 7461              # ta
-00008130: 6773 2069 6e68 6572 6974 616e 6365 2028  gs inheritance (
-00008140: 6f70 7469 6f6e 616c 290a 2020 2020 2020  optional).      
-00008150: 2020 2020 2020 6966 2073 656c 662e 6f75        if self.ou
-00008160: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
-00008170: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00008180: 2020 2073 656c 662e 7461 6773 5f69 6e68     self.tags_inh
-00008190: 6572 6974 616e 6365 280a 2020 2020 2020  eritance(.      
-000081a0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000081b0: 5f66 696c 653d 7365 6c66 2e69 6e5f 6669  _file=self.in_fi
-000081c0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-000081d0: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
-000081e0: 3d73 656c 662e 6f75 7470 7574 735b 226f  =self.outputs["o
-000081f0: 7574 5f66 696c 6522 5d2c 0a20 2020 2020  ut_file"],.     
-00008200: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00008210: 2020 2020 2020 2320 5265 7475 726e 2074        # Return t
-00008220: 6865 2072 6571 7569 7265 6d65 6e74 2c20  he requirement, 
-00008230: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
-00008240: 7269 7461 6e63 655f 6469 6374 0a20 2020  ritance_dict.   
-00008250: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00008260: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
-00008270: 2829 0a0a 2020 2020 6465 6620 7275 6e5f  ()..    def run_
-00008280: 7072 6f63 6573 735f 6d69 6128 7365 6c66  process_mia(self
-00008290: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
-000082a0: 6469 6361 7465 6420 746f 2074 6865 2070  dicated to the p
-000082b0: 726f 6365 7373 206c 6175 6e63 6820 7374  rocess launch st
-000082c0: 6570 206f 6620 7468 6520 6272 6963 6b2e  ep of the brick.
-000082d0: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
-000082e0: 7228 436f 6e66 6f72 6d49 6d61 6765 2c20  r(ConformImage, 
-000082f0: 7365 6c66 292e 7275 6e5f 7072 6f63 6573  self).run_proces
-00008300: 735f 6d69 6128 290a 0a20 2020 2020 2020  s_mia()..       
-00008310: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
-00008320: 662e 696e 5f66 696c 650a 0a20 2020 2020  f.in_file..     
-00008330: 2020 2023 2049 6d61 6765 2070 726f 6365     # Image proce
-00008340: 7373 696e 670a 2020 2020 2020 2020 7472  ssing.        tr
-00008350: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-00008360: 6d67 203d 206e 6962 2e6c 6f61 6428 6669  mg = nib.load(fi
-00008370: 6c65 5f6e 616d 6529 0a0a 2020 2020 2020  le_name)..      
-00008380: 2020 6578 6365 7074 2028 0a20 2020 2020    except (.     
-00008390: 2020 2020 2020 206e 6962 2e66 696c 6562         nib.fileb
-000083a0: 6173 6564 696d 6167 6573 2e49 6d61 6765  asedimages.Image
-000083b0: 4669 6c65 4572 726f 722c 0a20 2020 2020  FileError,.     
-000083c0: 2020 2020 2020 2046 696c 654e 6f74 466f         FileNotFo
-000083d0: 756e 6445 7272 6f72 2c0a 2020 2020 2020  undError,.      
-000083e0: 2020 2020 2020 5479 7065 4572 726f 722c        TypeError,
-000083f0: 0a20 2020 2020 2020 2029 2061 7320 653a  .        ) as e:
-00008400: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00008410: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00008420: 2020 2020 225c 6e43 6f6e 666f 726d 496d      "\nConformIm
-00008430: 6167 6520 6272 6963 6b3a 2045 7272 6f72  age brick: Error
-00008440: 2077 6974 6820 6669 6c65 2074 6f20 636f   with file to co
-00008450: 6e66 6f72 6d2c 2064 7572 696e 6720 7468  nform, during th
-00008460: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-00008470: 2020 2020 2272 756e 3a20 222c 0a20 2020      "run: ",.   
-00008480: 2020 2020 2020 2020 2020 2020 2065 2c0a               e,.
-00008490: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000084a0: 2020 2020 2020 2020 2020 696d 6720 3d20            img = 
-000084b0: 4e6f 6e65 0a0a 2020 2020 2020 2020 6966  None..        if
-000084c0: 2069 6d67 2069 7320 6e6f 7420 4e6f 6e65   img is not None
-000084d0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-000084e0: 745f 696d 6720 3d20 6e69 622e 7371 7565  t_img = nib.sque
-000084f0: 657a 655f 696d 6167 6528 696d 6729 0a20  eze_image(img). 
-00008500: 2020 2020 2020 2020 2020 206f 7574 5f69             out_i
-00008510: 6d67 203d 206e 6962 2e61 735f 636c 6f73  mg = nib.as_clos
-00008520: 6573 745f 6361 6e6f 6e69 6361 6c28 6f75  est_canonical(ou
-00008530: 745f 696d 6729 0a0a 2020 2020 2020 2020  t_img)..        
-00008540: 2020 2020 2320 496d 6167 6520 7361 7665      # Image save
-00008550: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
-00008560: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
-00008570: 6174 682e 7370 6c69 7428 6669 6c65 5f6e  ath.split(file_n
-00008580: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00008590: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
-000085a0: 742c 2066 696c 655f 6578 7465 6e73 696f  t, file_extensio
-000085b0: 6e20 3d20 6f73 2e70 6174 682e 7370 6c69  n = os.path.spli
-000085c0: 7465 7874 2866 696c 655f 6e61 6d65 290a  text(file_name).
-000085d0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-000085e0: 696c 655f 6578 7465 6e73 696f 6e20 3d3d  ile_extension ==
-000085f0: 2022 2e67 7a22 3a0a 2020 2020 2020 2020   ".gz":.        
-00008600: 2020 2020 2020 2020 2866 696c 655f 6e61          (file_na
-00008610: 6d65 5f6e 6f5f 6578 745f 322c 2066 696c  me_no_ext_2, fil
-00008620: 655f 6578 7465 6e73 696f 6e5f 3229 203d  e_extension_2) =
-00008630: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-00008640: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00008650: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00008660: 5f6e 6f5f 6578 740a 2020 2020 2020 2020  _no_ext.        
-00008670: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00008680: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-00008690: 655f 6578 7465 6e73 696f 6e5f 3220 3d3d  e_extension_2 ==
-000086a0: 2022 2e6e 6969 223a 0a20 2020 2020 2020   ".nii":.       
-000086b0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-000086c0: 655f 6e61 6d65 5f6e 6f5f 6578 7420 3d20  e_name_no_ext = 
-000086d0: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
-000086e0: 5f32 0a20 2020 2020 2020 2020 2020 2020  _2.             
-000086f0: 2020 2020 2020 2066 696c 655f 6578 7465         file_exte
-00008700: 6e73 696f 6e20 3d20 222e 6e69 692e 677a  nsion = ".nii.gz
-00008710: 220a 0a20 2020 2020 2020 2020 2020 2066  "..            f
-00008720: 696c 655f 6f75 7420 3d20 6f73 2e70 6174  ile_out = os.pat
-00008730: 682e 6a6f 696e 280a 2020 2020 2020 2020  h.join(.        
-00008740: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
-00008750: 7075 745f 6469 7265 6374 6f72 792c 0a20  put_directory,. 
-00008760: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00008770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008780: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
-00008790: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-000087a0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-000087b0: 696c 655f 6e61 6d65 5f6e 6f5f 6578 740a  ile_name_no_ext.
-000087c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087d0: 2020 2020 2b20 7365 6c66 2e73 7566 6669      + self.suffi
-000087e0: 782e 7374 7269 7028 290a 2020 2020 2020  x.strip().      
-000087f0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00008800: 6669 6c65 5f65 7874 656e 7369 6f6e 0a20  file_extension. 
-00008810: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00008820: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00008830: 2020 2020 2020 2020 2020 2020 6e69 622e              nib.
-00008840: 7361 7665 286f 7574 5f69 6d67 2c20 6669  save(out_img, fi
-00008850: 6c65 5f6f 7574 290a 0a0a 636c 6173 7320  le_out)...class 
-00008860: 436f 6e76 524f 4928 5072 6f63 6573 734d  ConvROI(ProcessM
-00008870: 4941 293a 0a20 2020 2022 2222 0a20 2020  IA):.    """.   
-00008880: 202a 496d 6167 6520 636f 6e76 6f6c 7574   *Image convolut
-00008890: 696f 6e20 7769 7468 206f 6e65 2069 6d61  ion with one ima
-000088a0: 6765 2a0a 0a20 2020 202d 2052 6573 616d  ge*..    - Resam
-000088b0: 706c 696e 6720 7468 6520 636f 6e76 6f6c  pling the convol
-000088c0: 7665 5f77 6974 6820 746f 2074 6865 2073  ve_with to the s
-000088d0: 697a 6520 6f66 2069 6d61 6765 735f 746f  ize of images_to
-000088e0: 5f63 6f6e 766f 6c76 652e 0a20 2020 202d  _convolve..    -
-000088f0: 2054 6865 6e20 636f 6e76 6f6c 7665 2065   Then convolve e
-00008900: 6163 6820 656c 656d 656e 7420 6f66 2069  ach element of i
-00008910: 6d61 6765 735f 746f 5f63 6f6e 766f 6c76  mages_to_convolv
-00008920: 6520 7769 7468 2072 6573 697a 6564 0a20  e with resized. 
-00008930: 2020 2020 2063 6f6e 766f 6c76 655f 7769       convolve_wi
-00008940: 7468 2e0a 2020 2020 2d20 5468 6520 6f75  th..    - The ou
-00008950: 7470 7574 5f64 6972 6563 746f 7279 2f50  tput_directory/P
-00008960: 6174 6965 6e74 4e61 6d65 5f64 6174 612f  atientName_data/
-00008970: 524f 495f 6461 7461 2f63 6f6e 7652 4f49  ROI_data/convROI
-00008980: 5f42 4f4c 4420 6469 7265 6374 6f72 7920  _BOLD directory 
-00008990: 6973 0a20 2020 2020 2063 7265 6174 6564  is.      created
-000089a0: 2074 6f20 7265 6365 6976 6520 7468 6520   to receive the 
-000089b0: 636f 6e76 6f6c 7665 6420 696d 6167 6573  convolved images
-000089c0: 2e20 4966 2074 6869 7320 6469 7265 6374  . If this direct
-000089d0: 6f72 7920 6578 6973 7473 2061 740a 2020  ory exists at.  
-000089e0: 2020 2020 7275 6e74 696d 6520 6974 2069      runtime it i
-000089f0: 7320 6465 6c65 7465 642e 0a20 2020 202d  s deleted..    -
-00008a00: 2054 6f20 776f 726b 2063 6f72 7265 6374   To work correct
-00008a10: 6c79 2c20 7468 6520 6461 7461 6261 7365  ly, the database
-00008a20: 2065 6e74 7279 2066 6f72 2074 6865 2063   entry for the c
-00008a30: 6f6e 766f 6c76 655f 7769 7468 0a20 2020  onvolve_with.   
-00008a40: 2020 2070 6172 616d 6574 6572 206d 7573     parameter mus
-00008a50: 7420 6861 7665 2074 6865 2022 5061 7469  t have the "Pati
-00008a60: 656e 744e 616d 6522 2074 6167 2066 696c  entName" tag fil
-00008a70: 6c65 6420 696e 2e0a 0a20 2020 2050 6c65  led in...    Ple
-00008a80: 6173 652c 2073 6565 2074 6865 2063 6f6d  ase, see the com
-00008a90: 706c 6574 6520 646f 6375 6d65 6e74 6174  plete documentat
-00008aa0: 696f 6e20 666f 7220 7468 6520 6043 6f6e  ion for the `Con
-00008ab0: 7652 4f49 2062 7269 636b 0a20 2020 2069  vROI brick.    i
-00008ac0: 6e20 7468 6520 6d69 615f 7072 6f63 6573  n the mia_proces
-00008ad0: 7365 7320 7765 6273 6974 650a 2020 2020  ses website.    
-00008ae0: 3c68 7474 7073 3a2f 2f70 6f70 756c 7365  <https://populse
-00008af0: 2e67 6974 6875 622e 696f 2f6d 6961 5f70  .github.io/mia_p
-00008b00: 726f 6365 7373 6573 2f68 746d 6c2f 646f  rocesses/html/do
-00008b10: 6375 6d65 6e74 6174 696f 6e2f 6272 6963  cumentation/bric
-00008b20: 6b73 2f70 7265 7072 6f63 6573 732f 6f74  ks/preprocess/ot
-00008b30: 6865 722f 436f 6e76 524f 492e 6874 6d6c  her/ConvROI.html
-00008b40: 3e60 5f0a 2020 2020 2222 220a 0a20 2020  >`_.    """..   
-00008b50: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00008b60: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00008b70: 4465 6469 6361 7465 6420 746f 2074 6865  Dedicated to the
-00008b80: 2061 7474 7269 6275 7465 7320 696e 6974   attributes init
-00008b90: 6961 6c69 7361 7469 6f6e 2f69 6e73 7461  ialisation/insta
-00008ba0: 6e74 6961 7469 6f6e 2e0a 0a20 2020 2020  ntiation...     
-00008bb0: 2020 2054 6865 2069 6e70 7574 2061 6e64     The input and
-00008bc0: 206f 7574 7075 7420 706c 7567 7320 6172   output plugs ar
-00008bd0: 6520 6465 6669 6e65 6420 6865 7265 2e20  e defined here. 
-00008be0: 5468 6520 7370 6563 6961 6c0a 2020 2020  The special.    
-00008bf0: 2020 2020 2773 656c 662e 7265 7175 6972      'self.requir
-00008c00: 656d 656e 7427 2061 7474 7269 6275 7465  ement' attribute
-00008c10: 2028 6f70 7469 6f6e 616c 2920 6973 2075   (optional) is u
-00008c20: 7365 6420 746f 2064 6566 696e 6520 7468  sed to define th
-00008c30: 650a 2020 2020 2020 2020 7468 6972 642d  e.        third-
-00008c40: 7061 7274 7920 7072 6f64 7563 7473 206e  party products n
-00008c50: 6563 6573 7361 7279 2066 6f72 2074 6865  ecessary for the
-00008c60: 2072 756e 6e69 6e67 206f 6620 7468 6520   running of the 
-00008c70: 6272 6963 6b2e 0a20 2020 2020 2020 2022  brick..        "
-00008c80: 2222 0a20 2020 2020 2020 2023 2049 6e69  "".        # Ini
-00008c90: 7469 616c 6973 6174 696f 6e20 6f66 2074  tialisation of t
-00008ca0: 6865 206f 626a 6563 7473 206e 6565 6465  he objects neede
-00008cb0: 6420 666f 7220 7468 6520 6c61 756e 6368  d for the launch
-00008cc0: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
-00008cd0: 2020 2020 2020 7375 7065 7228 436f 6e76        super(Conv
-00008ce0: 524f 492c 2073 656c 6629 2e5f 5f69 6e69  ROI, self).__ini
-00008cf0: 745f 5f28 290a 0a20 2020 2020 2020 2023  t__()..        #
-00008d00: 2049 6e70 7574 7320 6465 7363 7269 7074   Inputs descript
-00008d10: 696f 6e0a 2020 2020 2020 2020 696d 6167  ion.        imag
-00008d20: 6573 5f74 6f5f 636f 6e76 6f6c 7665 5f64  es_to_convolve_d
-00008d30: 6573 6320 3d20 280a 2020 2020 2020 2020  esc = (.        
-00008d40: 2020 2020 2241 206c 6973 7420 6f66 2069      "A list of i
-00008d50: 6d61 6765 7320 746f 2063 6f6e 766f 6c76  mages to convolv
-00008d60: 6520 7769 7468 2063 6f6e 766f 6c76 655f  e with convolve_
-00008d70: 7769 7468 2069 6d61 6765 220a 2020 2020  with image".    
-00008d80: 2020 2020 290a 2020 2020 2020 2020 636f      ).        co
-00008d90: 6e76 6f6c 7665 5f77 6974 685f 6465 7363  nvolve_with_desc
-00008da0: 203d 2022 4161 2073 7472 696e 6720 7265   = "Aa string re
-00008db0: 7072 6573 656e 7469 6e67 2061 2070 6174  presenting a pat
-00008dc0: 6820 746f 2074 6865 2066 696c 6522 0a20  h to the file". 
-00008dd0: 2020 2020 2020 2070 7265 6669 785f 6465         prefix_de
-00008de0: 7363 203d 2022 5468 6520 7072 6566 6978  sc = "The prefix
-00008df0: 2066 6f72 2074 6865 206f 7574 5f69 6d61   for the out_ima
-00008e00: 6765 7320 2861 2073 7472 696e 6729 220a  ges (a string)".
-00008e10: 0a20 2020 2020 2020 2023 204f 7574 7075  .        # Outpu
-00008e20: 7473 2064 6573 6372 6970 7469 6f6e 0a20  ts description. 
-00008e30: 2020 2020 2020 206f 7574 5f69 6d61 6765         out_image
-00008e40: 735f 6465 7363 203d 2022 5468 6520 636f  s_desc = "The co
-00008e50: 6e76 6f6c 7574 6564 2069 6d61 6765 7322  nvoluted images"
-00008e60: 0a0a 2020 2020 2020 2020 2320 496e 7075  ..        # Inpu
-00008e70: 7473 2074 7261 6974 730a 2020 2020 2020  ts traits.      
-00008e80: 2020 7365 6c66 2e61 6464 5f74 7261 6974    self.add_trait
-00008e90: 280a 2020 2020 2020 2020 2020 2020 2269  (.            "i
-00008ea0: 6d61 6765 735f 746f 5f63 6f6e 766f 6c76  mages_to_convolv
-00008eb0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00008ec0: 496e 7075 744d 756c 7469 5061 7468 280a  InputMultiPath(.
-00008ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ee0: 496d 6167 6546 696c 6553 504d 2829 2c0a  ImageFileSPM(),.
-00008ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f00: 6f75 7470 7574 3d46 616c 7365 2c0a 2020  output=False,.  
-00008f10: 2020 2020 2020 2020 2020 2020 2020 6f70                op
-00008f20: 7469 6f6e 616c 3d46 616c 7365 2c0a 2020  tional=False,.  
-00008f30: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00008f40: 7363 3d69 6d61 6765 735f 746f 5f63 6f6e  sc=images_to_con
-00008f50: 766f 6c76 655f 6465 7363 2c0a 2020 2020  volve_desc,.    
-00008f60: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00008f70: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-00008f80: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-00008f90: 2020 2020 2020 2020 2022 636f 6e76 6f6c           "convol
-00008fa0: 7665 5f77 6974 6822 2c0a 2020 2020 2020  ve_with",.      
-00008fb0: 2020 2020 2020 496d 6167 6546 696c 6553        ImageFileS
-00008fc0: 504d 280a 2020 2020 2020 2020 2020 2020  PM(.            
-00008fd0: 2020 2020 6f75 7470 7574 3d46 616c 7365      output=False
-00008fe0: 2c20 6f70 7469 6f6e 616c 3d46 616c 7365  , optional=False
-00008ff0: 2c20 6465 7363 3d63 6f6e 766f 6c76 655f  , desc=convolve_
-00009000: 7769 7468 5f64 6573 630a 2020 2020 2020  with_desc.      
-00009010: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-00009020: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-00009030: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
-00009040: 2020 2020 2020 2020 2270 7265 6669 7822          "prefix"
-00009050: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
-00009060: 6169 7473 2e53 7472 696e 6728 0a20 2020  aits.String(.   
-00009070: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-00009080: 6e76 222c 206f 7574 7075 743d 4661 6c73  nv", output=Fals
-00009090: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
-000090a0: 2c20 6465 7363 3d70 7265 6669 785f 6465  , desc=prefix_de
-000090b0: 7363 0a20 2020 2020 2020 2020 2020 2029  sc.            )
-000090c0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-000090d0: 2020 2020 2023 204f 7574 7075 7473 2074       # Outputs t
-000090e0: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
-000090f0: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
-00009100: 2020 2020 2020 2020 2020 226f 7574 5f69            "out_i
-00009110: 6d61 6765 7322 2c0a 2020 2020 2020 2020  mages",.        
-00009120: 2020 2020 4f75 7470 7574 4d75 6c74 6950      OutputMultiP
-00009130: 6174 6828 4669 6c65 2829 2c20 6f75 7470  ath(File(), outp
-00009140: 7574 3d54 7275 652c 2064 6573 633d 6f75  ut=True, desc=ou
-00009150: 745f 696d 6167 6573 5f64 6573 6329 2c0a  t_images_desc),.
-00009160: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00009170: 2020 2023 2053 7065 6369 616c 2070 6172     # Special par
-00009180: 616d 6574 6572 2075 7365 6420 6173 2061  ameter used as a
-00009190: 206d 6573 7365 6e67 6572 2066 6f72 2074   messenger for t
-000091a0: 6865 2072 756e 5f70 726f 6365 7373 5f6d  he run_process_m
-000091b0: 6961 206d 6574 686f 640a 2020 2020 2020  ia method.      
-000091c0: 2020 7365 6c66 2e61 6464 5f74 7261 6974    self.add_trait
-000091d0: 280a 2020 2020 2020 2020 2020 2020 2264  (.            "d
-000091e0: 6963 7434 7275 6e74 696d 6522 2c0a 2020  ict4runtime",.  
-000091f0: 2020 2020 2020 2020 2020 7472 6169 7473            traits
-00009200: 2e44 6963 7428 6f75 7470 7574 3d46 616c  .Dict(output=Fal
-00009210: 7365 2c20 6f70 7469 6f6e 616c 3d54 7275  se, optional=Tru
-00009220: 652c 2075 7365 726c 6576 656c 3d31 292c  e, userlevel=1),
-00009230: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00009240: 2020 2020 7365 6c66 2e69 6e69 745f 6465      self.init_de
-00009250: 6661 756c 745f 7472 6169 7473 2829 0a0a  fault_traits()..
-00009260: 2020 2020 6465 6620 6c69 7374 5f6f 7574      def list_out
-00009270: 7075 7473 2873 656c 662c 2069 735f 706c  puts(self, is_pl
-00009280: 7567 6765 643d 4e6f 6e65 293a 0a20 2020  ugged=None):.   
-00009290: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
-000092a0: 6420 746f 2074 6865 2069 6e69 7469 616c  d to the initial
-000092b0: 6973 6174 696f 6e20 7374 6570 206f 6620  isation step of 
-000092c0: 7468 6520 6272 6963 6b2e 0a0a 2020 2020  the brick...    
-000092d0: 2020 2020 5468 6520 6d61 696e 206f 626a      The main obj
-000092e0: 6563 7469 7665 206f 6620 7468 6973 206d  ective of this m
-000092f0: 6574 686f 6420 6973 2074 6f20 7072 6f64  ethod is to prod
-00009300: 7563 6520 7468 6520 6f75 7470 7574 7320  uce the outputs 
-00009310: 6f66 2074 6865 0a20 2020 2020 2020 2062  of the.        b
-00009320: 7269 636b 7320 2873 656c 662e 6f75 7470  ricks (self.outp
-00009330: 7574 7329 2061 6e64 2074 6865 2061 7373  uts) and the ass
-00009340: 6f63 6961 7465 6420 7461 6773 2028 7365  ociated tags (se
-00009350: 6c66 2e69 6e68 6572 6974 616e 6365 5f64  lf.inheritance_d
-00009360: 6963 292c 0a20 2020 2020 2020 2069 6620  ic),.        if 
-00009370: 6465 6669 6e65 6420 6865 7265 2e20 496e  defined here. In
-00009380: 206f 7264 6572 206e 6f74 2074 6f20 696e   order not to in
-00009390: 636c 7564 6520 616e 206f 7574 7075 7420  clude an output 
-000093a0: 696e 2074 6865 2064 6174 6162 6173 652c  in the database,
-000093b0: 0a20 2020 2020 2020 2074 6869 7320 6f75  .        this ou
-000093c0: 7470 7574 206d 7573 7420 6265 2061 2076  tput must be a v
-000093d0: 616c 7565 206f 6620 7468 6520 6f70 7469  alue of the opti
-000093e0: 6f6e 616c 206b 6579 2027 6e6f 7449 6e44  onal key 'notInD
-000093f0: 6227 206f 6620 7468 650a 2020 2020 2020  b' of the.      
-00009400: 2020 7365 6c66 2e6f 7574 7075 7473 2064    self.outputs d
-00009410: 6963 7469 6f6e 6172 792e 2054 6f20 776f  ictionary. To wo
-00009420: 726b 2070 726f 7065 726c 7920 7468 6973  rk properly this
-00009430: 206d 6574 686f 6420 6d75 7374 2072 6574   method must ret
-00009440: 7572 6e0a 2020 2020 2020 2020 7365 6c66  urn.        self
-00009450: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
-00009460: 2829 206f 626a 6563 742e 0a0a 2020 2020  () object...    
-00009470: 2020 2020 3a70 6172 616d 2069 735f 706c      :param is_pl
-00009480: 7567 6765 643a 2074 6865 2073 7461 7465  ugged: the state
-00009490: 2c20 6c69 6e6b 6564 206f 7220 6e6f 742c  , linked or not,
-000094a0: 206f 6620 7468 6520 706c 7567 732e 0a20   of the plugs.. 
-000094b0: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
-000094c0: 2061 2064 6963 7469 6f6e 6172 7920 7769   a dictionary wi
-000094d0: 7468 2072 6571 7569 7265 6d65 6e74 2c20  th requirement, 
-000094e0: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
-000094f0: 7269 7461 6e63 655f 6469 6374 2e0a 2020  ritance_dict..  
-00009500: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00009510: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
-00009520: 6865 7269 7461 6e63 6520 746f 2050 726f  heritance to Pro
-00009530: 6365 7373 4d49 4120 636c 6173 732c 206c  cessMIA class, l
-00009540: 6973 745f 6f75 7470 7574 7320 6d65 7468  ist_outputs meth
-00009550: 6f64 0a20 2020 2020 2020 2073 7570 6572  od.        super
-00009560: 2843 6f6e 7652 4f49 2c20 7365 6c66 292e  (ConvROI, self).
-00009570: 6c69 7374 5f6f 7574 7075 7473 2829 0a0a  list_outputs()..
-00009580: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
-00009590: 7320 6465 6669 6e69 7469 6f6e 2061 6e64  s definition and
-000095a0: 2074 6167 7320 696e 6865 7269 7461 6e63   tags inheritanc
-000095b0: 6520 286f 7074 696f 6e61 6c29 0a20 2020  e (optional).   
-000095c0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-000095d0: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
-000095e0: 735f 746f 5f63 6f6e 766f 6c76 6520 213d  s_to_convolve !=
-000095f0: 2055 6e64 6566 696e 6564 0a20 2020 2020   Undefined.     
-00009600: 2020 2020 2020 2061 6e64 2073 656c 662e         and self.
-00009610: 636f 6e76 6f6c 7665 5f77 6974 6820 213d  convolve_with !=
-00009620: 2055 6e64 6566 696e 6564 0a20 2020 2020   Undefined.     
-00009630: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00009640: 2020 7061 7469 656e 745f 6e61 6d65 203d    patient_name =
-00009650: 2067 6574 5f64 6246 6965 6c64 5661 6c75   get_dbFieldValu
-00009660: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00009670: 2020 2073 656c 662e 7072 6f6a 6563 742c     self.project,
-00009680: 2073 656c 662e 636f 6e76 6f6c 7665 5f77   self.convolve_w
-00009690: 6974 682c 2022 5061 7469 656e 744e 616d  ith, "PatientNam
-000096a0: 6522 0a20 2020 2020 2020 2020 2020 2029  e".            )
-000096b0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000096c0: 2070 6174 6965 6e74 5f6e 616d 6520 6973   patient_name is
-000096d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000096e0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-000096f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009700: 2020 275c 6e43 6f6e 7652 4f49 2062 7269    '\nConvROI bri
-00009710: 636b 3a5c 6e20 5468 6520 2250 6174 6965  ck:\n The "Patie
-00009720: 6e74 4e61 6d65 2220 7461 6720 6973 206e  ntName" tag is n
-00009730: 6f74 2066 696c 6c65 6420 270a 2020 2020  ot filled '.    
-00009740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009750: 2269 6e20 7468 6520 6461 7461 6261 7365  "in the database
-00009760: 2066 6f72 2074 6865 207b 7d20 6669 6c65   for the {} file
-00009770: 202e 2e2e 5c6e 2054 6865 2063 616c 6375   ...\n The calcu
-00009780: 6c61 7469 6f6e 220a 2020 2020 2020 2020  lation".        
-00009790: 2020 2020 2020 2020 2020 2020 2269 7320              "is 
-000097a0: 6162 6f72 7465 642e 2e2e 222e 666f 726d  aborted...".form
-000097b0: 6174 2873 656c 662e 636f 6e76 6f6c 7665  at(self.convolve
-000097c0: 5f77 6974 6829 0a20 2020 2020 2020 2020  _with).         
-000097d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000097e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000097f0: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
-00009800: 7375 6c74 2829 0a0a 2020 2020 2020 2020  sult()..        
-00009810: 2020 2020 7365 6c66 2e64 6963 7434 7275      self.dict4ru
-00009820: 6e74 696d 655b 2270 6174 6965 6e74 5f6e  ntime["patient_n
-00009830: 616d 6522 5d20 3d20 7061 7469 656e 745f  ame"] = patient_
-00009840: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-00009850: 2063 6f6e 765f 6469 7220 3d20 6f73 2e70   conv_dir = os.p
-00009860: 6174 682e 6a6f 696e 280a 2020 2020 2020  ath.join(.      
-00009870: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-00009880: 7574 7075 745f 6469 7265 6374 6f72 792c  utput_directory,
-00009890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000098a0: 2070 6174 6965 6e74 5f6e 616d 6520 2b20   patient_name + 
-000098b0: 225f 6461 7461 222c 0a20 2020 2020 2020  "_data",.       
-000098c0: 2020 2020 2020 2020 2022 524f 495f 6461           "ROI_da
-000098d0: 7461 222c 0a20 2020 2020 2020 2020 2020  ta",.           
-000098e0: 2020 2020 2022 636f 6e76 524f 495f 424f       "convROI_BO
-000098f0: 4c44 222c 0a20 2020 2020 2020 2020 2020  LD",.           
-00009900: 2029 0a20 2020 2020 2020 2020 2020 206c   ).            l
-00009910: 6973 745f 6f75 7420 3d20 5b5d 0a0a 2020  ist_out = []..  
-00009920: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00009930: 662e 7072 6566 6978 2e69 7373 7061 6365  f.prefix.isspace
-00009940: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00009950: 2020 2020 7365 6c66 2e70 7265 6669 7820      self.prefix 
-00009960: 3d20 2222 0a0a 2020 2020 2020 2020 2020  = ""..          
-00009970: 2020 666f 7220 726f 695f 6669 6c65 2069    for roi_file i
-00009980: 6e20 7365 6c66 2e69 6d61 6765 735f 746f  n self.images_to
-00009990: 5f63 6f6e 766f 6c76 653a 0a20 2020 2020  _convolve:.     
-000099a0: 2020 2020 2020 2020 2020 206c 6973 745f             list_
-000099b0: 6f75 742e 6170 7065 6e64 280a 2020 2020  out.append(.    
-000099c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099d0: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
-000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099f0: 2020 2020 2020 636f 6e76 5f64 6972 2c20        conv_dir, 
-00009a00: 7365 6c66 2e70 7265 6669 7820 2b20 6f73  self.prefix + os
-00009a10: 2e70 6174 682e 6261 7365 6e61 6d65 2872  .path.basename(r
-00009a20: 6f69 5f66 696c 6529 0a20 2020 2020 2020  oi_file).       
-00009a30: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00009a40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00009a50: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00009a60: 6c66 2e6f 7574 7075 7473 5b22 6f75 745f  lf.outputs["out_
-00009a70: 696d 6167 6573 225d 203d 206c 6973 745f  images"] = list_
-00009a80: 6f75 740a 0a20 2020 2020 2020 2023 2052  out..        # R
-00009a90: 6574 7572 6e20 7468 6520 7265 7175 6972  eturn the requir
-00009aa0: 656d 656e 742c 206f 7574 7075 7473 2061  ement, outputs a
-00009ab0: 6e64 2069 6e68 6572 6974 616e 6365 5f64  nd inheritance_d
-00009ac0: 6963 740a 2020 2020 2020 2020 7265 7475  ict.        retu
-00009ad0: 726e 2073 656c 662e 6d61 6b65 5f69 6e69  rn self.make_ini
-00009ae0: 7452 6573 756c 7428 290a 0a20 2020 2064  tResult()..    d
-00009af0: 6566 2072 756e 5f70 726f 6365 7373 5f6d  ef run_process_m
-00009b00: 6961 2873 656c 6629 3a0a 2020 2020 2020  ia(self):.      
-00009b10: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
-00009b20: 6f20 7468 6520 7072 6f63 6573 7320 6c61  o the process la
-00009b30: 756e 6368 2073 7465 7020 6f66 2074 6865  unch step of the
-00009b40: 2062 7269 636b 2e22 2222 0a0a 2020 2020   brick."""..    
-00009b50: 2020 2020 2320 4e6f 206e 6565 6420 7468      # No need th
-00009b60: 6520 6e65 7874 206c 696e 6520 2877 6520  e next line (we 
-00009b70: 646f 6e27 7420 7573 6520 7365 6c66 2e70  don't use self.p
-00009b80: 726f 6365 7373 2065 7420 5350 4d29 0a20  rocess et SPM). 
-00009b90: 2020 2020 2020 2023 2073 7570 6572 2843         # super(C
-00009ba0: 6f6e 7652 4f49 2c20 7365 6c66 292e 7275  onvROI, self).ru
-00009bb0: 6e5f 7072 6f63 6573 735f 6d69 6128 290a  n_process_mia().
-00009bc0: 0a20 2020 2020 2020 2070 6174 5f6e 616d  .        pat_nam
-00009bd0: 655f 6469 7220 3d20 6f73 2e70 6174 682e  e_dir = os.path.
-00009be0: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
-00009bf0: 2020 7365 6c66 2e6f 7574 7075 745f 6469    self.output_di
-00009c00: 7265 6374 6f72 792c 2073 656c 662e 6469  rectory, self.di
-00009c10: 6374 3472 756e 7469 6d65 5b22 7061 7469  ct4runtime["pati
-00009c20: 656e 745f 6e61 6d65 225d 202b 2022 5f64  ent_name"] + "_d
-00009c30: 6174 6122 0a20 2020 2020 2020 2029 0a0a  ata".        )..
-00009c40: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00009c50: 732e 7061 7468 2e65 7869 7374 7328 7061  s.path.exists(pa
-00009c60: 745f 6e61 6d65 5f64 6972 293a 0a20 2020  t_name_dir):.   
-00009c70: 2020 2020 2020 2020 206f 732e 6d6b 6469           os.mkdi
-00009c80: 7228 7061 745f 6e61 6d65 5f64 6972 290a  r(pat_name_dir).
-00009c90: 0a20 2020 2020 2020 2072 6f69 5f64 6174  .        roi_dat
-00009ca0: 615f 6469 7220 3d20 6f73 2e70 6174 682e  a_dir = os.path.
-00009cb0: 6a6f 696e 2870 6174 5f6e 616d 655f 6469  join(pat_name_di
-00009cc0: 722c 2022 524f 495f 6461 7461 2229 0a0a  r, "ROI_data")..
-00009cd0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00009ce0: 732e 7061 7468 2e65 7869 7374 7328 726f  s.path.exists(ro
-00009cf0: 695f 6461 7461 5f64 6972 293a 0a20 2020  i_data_dir):.   
-00009d00: 2020 2020 2020 2020 206f 732e 6d6b 6469           os.mkdi
-00009d10: 7228 726f 695f 6461 7461 5f64 6972 290a  r(roi_data_dir).
-00009d20: 0a20 2020 2020 2020 2063 6f6e 765f 6469  .        conv_di
-00009d30: 7220 3d20 6f73 2e70 6174 682e 6a6f 696e  r = os.path.join
-00009d40: 2872 6f69 5f64 6174 615f 6469 722c 2022  (roi_data_dir, "
-00009d50: 636f 6e76 524f 495f 424f 4c44 2229 0a20  convROI_BOLD"). 
-00009d60: 2020 2020 2020 2074 6d70 203d 2022 4e6f         tmp = "No
-00009d70: 6e65 220a 0a20 2020 2020 2020 2069 6620  ne"..        if 
-00009d80: 6f73 2e70 6174 682e 6973 6469 7228 636f  os.path.isdir(co
-00009d90: 6e76 5f64 6972 293a 0a20 2020 2020 2020  nv_dir):.       
-00009da0: 2020 2020 2074 6d70 203d 2074 656d 7066       tmp = tempf
-00009db0: 696c 652e 6d6b 7465 6d70 2864 6972 3d6f  ile.mktemp(dir=o
-00009dc0: 732e 7061 7468 2e64 6972 6e61 6d65 2872  s.path.dirname(r
-00009dd0: 6f69 5f64 6174 615f 6469 7229 290a 2020  oi_data_dir)).  
-00009de0: 2020 2020 2020 2020 2020 6f73 2e6d 6b64            os.mkd
-00009df0: 6972 2874 6d70 290a 2020 2020 2020 2020  ir(tmp).        
-00009e00: 2020 2020 7368 7574 696c 2e6d 6f76 6528      shutil.move(
-00009e10: 636f 6e76 5f64 6972 2c20 6f73 2e70 6174  conv_dir, os.pat
-00009e20: 682e 6a6f 696e 2874 6d70 2c20 2263 6f6e  h.join(tmp, "con
-00009e30: 7652 4f49 5f42 4f4c 4422 2929 0a20 2020  vROI_BOLD")).   
-00009e40: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00009e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e60: 275c 6e43 6f6e 7652 4f49 2062 7269 636b  '\nConvROI brick
-00009e70: 3a5c 6e41 2022 7b7d 2220 666f 6c64 6572  :\nA "{}" folder
-00009e80: 2061 6c72 6561 6479 2065 7869 7374 732c   already exists,
-00009e90: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
-00009ea0: 2020 2022 6974 2077 696c 6c20 6265 206f     "it will be o
-00009eb0: 7665 7277 7269 7474 656e 2062 7920 7468  verwritten by th
-00009ec0: 6973 206e 6577 2022 0a20 2020 2020 2020  is new ".       
-00009ed0: 2020 2020 2020 2020 2022 6361 6c63 756c           "calcul
-00009ee0: 6174 696f 6e2e 2e2e 222e 666f 726d 6174  ation...".format
-00009ef0: 2863 6f6e 765f 6469 7229 0a20 2020 2020  (conv_dir).     
-00009f00: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00009f10: 206f 732e 6d6b 6469 7228 636f 6e76 5f64   os.mkdir(conv_d
-00009f20: 6972 290a 0a20 2020 2020 2020 2069 6620  ir)..        if 
-00009f30: 6f73 2e70 6174 682e 6973 6469 7228 746d  os.path.isdir(tm
-00009f40: 7029 3a0a 2020 2020 2020 2020 2020 2020  p):.            
-00009f50: 7368 7574 696c 2e72 6d74 7265 6528 746d  shutil.rmtree(tm
-00009f60: 7029 0a0a 2020 2020 2020 2020 2320 5265  p)..        # Re
-00009f70: 7361 6d70 6c65 2074 6865 2063 6f6e 766f  sample the convo
-00009f80: 6c76 655f 7769 7468 2074 6f20 7468 6520  lve_with to the 
-00009f90: 7369 7a65 206f 6620 696d 6167 6573 5f74  size of images_t
-00009fa0: 6f5f 636f 6e76 6f6c 7665 2c20 7468 656e  o_convolve, then
-00009fb0: 0a20 2020 2020 2020 2023 2063 6f6e 766f  .        # convo
-00009fc0: 6c76 6520 6561 6368 2069 6d61 6765 735f  lve each images_
-00009fd0: 746f 5f63 6f6e 766f 6c76 6520 7769 7468  to_convolve with
-00009fe0: 2072 6573 697a 6564 2063 6f6e 766f 6c76   resized convolv
-00009ff0: 655f 7769 7468 2e0a 2020 2020 2020 2020  e_with..        
-0000a000: 6d61 736b 5f74 6872 6573 6820 3d20 7468  mask_thresh = th
-0000a010: 7265 7368 6f6c 6428 7365 6c66 2e63 6f6e  reshold(self.con
-0000a020: 766f 6c76 655f 7769 7468 2c20 302e 3529  volve_with, 0.5)
-0000a030: 2e67 6574 5f66 6461 7461 2829 0a0a 2020  .get_fdata()..  
-0000a040: 2020 2020 2020 666f 7220 726f 695f 6669        for roi_fi
-0000a050: 6c65 2069 6e20 7365 6c66 2e69 6d61 6765  le in self.image
-0000a060: 735f 746f 5f63 6f6e 766f 6c76 653a 0a20  s_to_convolve:. 
-0000a070: 2020 2020 2020 2020 2020 2072 6f69 5f69             roi_i
-0000a080: 6d67 203d 206e 6962 2e6c 6f61 6428 726f  mg = nib.load(ro
-0000a090: 695f 6669 6c65 290a 2020 2020 2020 2020  i_file).        
-0000a0a0: 2020 2020 726f 695f 6461 7461 203d 2072      roi_data = r
-0000a0b0: 6f69 5f69 6d67 2e67 6574 5f66 6461 7461  oi_img.get_fdata
-0000a0c0: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-0000a0d0: 6f69 5f73 697a 6520 3d20 726f 695f 6461  oi_size = roi_da
-0000a0e0: 7461 2e73 6861 7065 5b3a 335d 0a20 2020  ta.shape[:3].   
-0000a0f0: 2020 2020 2020 2020 2072 6573 697a 6564           resized
-0000a100: 5f6d 6173 6b20 3d20 7265 7369 7a65 286d  _mask = resize(m
-0000a110: 6173 6b5f 7468 7265 7368 2c20 726f 695f  ask_thresh, roi_
-0000a120: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
-0000a130: 2020 6d75 6c74 203d 2028 726f 695f 6461    mult = (roi_da
-0000a140: 7461 202a 2072 6573 697a 6564 5f6d 6173  ta * resized_mas
-0000a150: 6b29 2e61 7374 7970 6528 666c 6f61 7429  k).astype(float)
-0000a160: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-0000a170: 4f44 4f3a 2053 686f 756c 6420 7765 2074  ODO: Should we t
-0000a180: 616b 6520 696e 666f 2066 726f 6d20 696d  ake info from im
-0000a190: 6167 6573 5f74 6f5f 636f 6e76 6f6c 7665  ages_to_convolve
-0000a1a0: 206f 7220 6672 6f6d 0a20 2020 2020 2020   or from.       
-0000a1b0: 2020 2020 2023 2020 2020 2020 2063 6f6e       #       con
-0000a1c0: 766f 6c76 655f 7769 7468 203f 0a20 2020  volve_with ?.   
-0000a1d0: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-0000a1e0: 2043 7572 7265 6e74 6c79 2077 6520 7461   Currently we ta
-0000a1f0: 6b65 2066 726f 6d20 696d 6167 6573 5f74  ke from images_t
-0000a200: 6f5f 636f 6e76 6f6c 7665 0a20 2020 2020  o_convolve.     
-0000a210: 2020 2020 2020 206d 756c 745f 696d 6720         mult_img 
-0000a220: 3d20 6e69 622e 4e69 6674 6931 496d 6167  = nib.Nifti1Imag
-0000a230: 6528 6d75 6c74 2c20 726f 695f 696d 672e  e(mult, roi_img.
-0000a240: 6166 6669 6e65 2c20 726f 695f 696d 672e  affine, roi_img.
-0000a250: 6865 6164 6572 290a 0a20 2020 2020 2020  header)..       
-0000a260: 2020 2020 2023 2049 6d61 6765 2073 6176       # Image sav
-0000a270: 6520 696e 2063 6f6e 765f 6469 720a 2020  e in conv_dir.  
-0000a280: 2020 2020 2020 2020 2020 6f75 745f 6669            out_fi
-0000a290: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
-0000a2a0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0000a2b0: 2020 2063 6f6e 765f 6469 722c 2073 656c     conv_dir, sel
-0000a2c0: 662e 7072 6566 6978 202b 206f 732e 7061  f.prefix + os.pa
-0000a2d0: 7468 2e62 6173 656e 616d 6528 726f 695f  th.basename(roi_
-0000a2e0: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-0000a2f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000a300: 6e69 622e 7361 7665 286d 756c 745f 696d  nib.save(mult_im
-0000a310: 672c 206f 7574 5f66 696c 6529 0a20 2020  g, out_file).   
-0000a320: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0000a330: 7b30 7d20 7361 7665 6422 2e66 6f72 6d61  {0} saved".forma
-0000a340: 7428 6f75 745f 6669 6c65 2929 0a0a 0a63  t(out_file))...c
-0000a350: 6c61 7373 2045 6e68 616e 6365 2850 726f  lass Enhance(Pro
-0000a360: 6365 7373 4d49 4129 3a0a 2020 2020 2222  cessMIA):.    ""
-0000a370: 220a 2020 2020 2a49 6d61 6765 2065 6e68  ".    *Image enh
-0000a380: 616e 6369 6e67 2a0a 0a20 2020 2050 6c65  ancing*..    Ple
-0000a390: 6173 652c 2073 6565 2074 6865 2063 6f6d  ase, see the com
-0000a3a0: 706c 6574 6520 646f 6375 6d65 6e74 6174  plete documentat
-0000a3b0: 696f 6e20 666f 7220 7468 6520 6045 6e68  ion for the `Enh
-0000a3c0: 616e 6365 2062 7269 636b 0a20 2020 2069  ance brick.    i
-0000a3d0: 6e20 7468 6520 6d69 615f 7072 6f63 6573  n the mia_proces
-0000a3e0: 7365 7320 7765 6273 6974 650a 2020 2020  ses website.    
-0000a3f0: 3c68 7474 7073 3a2f 2f70 6f70 756c 7365  <https://populse
-0000a400: 2e67 6974 6875 622e 696f 2f6d 6961 5f70  .github.io/mia_p
-0000a410: 726f 6365 7373 6573 2f68 746d 6c2f 646f  rocesses/html/do
-0000a420: 6375 6d65 6e74 6174 696f 6e2f 6272 6963  cumentation/bric
-0000a430: 6b73 2f70 7265 7072 6f63 6573 732f 6f74  ks/preprocess/ot
-0000a440: 6865 722f 456e 6861 6e63 652e 6874 6d6c  her/Enhance.html
-0000a450: 3e60 5f0a 0a20 2020 2061 6461 7074 6564  >`_..    adapted
-0000a460: 2066 726f 6d3a 0a20 2020 2068 7474 7073   from:.    https
-0000a470: 3a2f 2f67 6974 6875 622e 636f 6d2f 6e69  ://github.com/ni
-0000a480: 7072 6570 732f 6d72 6971 632f 626c 6f62  preps/mriqc/blob
-0000a490: 2f32 322e 302e 362f 6d72 6971 632f 776f  /22.0.6/mriqc/wo
-0000a4a0: 726b 666c 6f77 732f 616e 6174 6f6d 6963  rkflows/anatomic
-0000a4b0: 616c 2e70 7923 4c39 3734 0a0a 2020 2020  al.py#L974..    
-0000a4c0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-0000a4d0: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
-0000a4e0: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
-0000a4f0: 6420 746f 2074 6865 2061 7474 7269 6275  d to the attribu
-0000a500: 7465 7320 696e 6974 6961 6c69 7361 7469  tes initialisati
-0000a510: 6f6e 202f 2069 6e73 7461 6e74 6961 7469  on / instantiati
-0000a520: 6f6e 2e0a 0a20 2020 2020 2020 2054 6865  on...        The
-0000a530: 2069 6e70 7574 2061 6e64 206f 7574 7075   input and outpu
-0000a540: 7420 706c 7567 7320 6172 6520 6465 6669  t plugs are defi
-0000a550: 6e65 6420 6865 7265 2e20 5468 6520 7370  ned here. The sp
-0000a560: 6563 6961 6c0a 2020 2020 2020 2020 2773  ecial.        's
-0000a570: 656c 662e 7265 7175 6972 656d 656e 7427  elf.requirement'
-0000a580: 2061 7474 7269 6275 7465 2028 6f70 7469   attribute (opti
-0000a590: 6f6e 616c 2920 6973 2075 7365 6420 746f  onal) is used to
-0000a5a0: 2064 6566 696e 6520 7468 650a 2020 2020   define the.    
-0000a5b0: 2020 2020 7468 6972 642d 7061 7274 7920      third-party 
-0000a5c0: 7072 6f64 7563 7473 206e 6563 6573 7361  products necessa
-0000a5d0: 7279 2066 6f72 2074 6865 2072 756e 6e69  ry for the runni
-0000a5e0: 6e67 206f 6620 7468 6520 6272 6963 6b2e  ng of the brick.
-0000a5f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000a600: 2020 2020 2023 2049 6e69 7469 616c 6973       # Initialis
-0000a610: 6174 696f 6e20 6f66 2074 6865 206f 626a  ation of the obj
-0000a620: 6563 7473 206e 6565 6465 6420 666f 7220  ects needed for 
-0000a630: 7468 6520 6c61 756e 6368 206f 6620 7468  the launch of th
-0000a640: 6520 6272 6963 6b0a 2020 2020 2020 2020  e brick.        
-0000a650: 7375 7065 7228 456e 6861 6e63 652c 2073  super(Enhance, s
-0000a660: 656c 6629 2e5f 5f69 6e69 745f 5f28 290a  elf).__init__().
-0000a670: 0a20 2020 2020 2020 2023 2054 6869 7264  .        # Third
-0000a680: 2070 6172 7479 2073 6f66 7477 6172 6573   party softwares
-0000a690: 2072 6571 7569 7265 6420 666f 7220 7468   required for th
-0000a6a0: 6520 6578 6563 7574 696f 6e20 6f66 2074  e execution of t
-0000a6b0: 6865 2062 7269 636b 0a20 2020 2020 2020  he brick.       
-0000a6c0: 2073 656c 662e 7265 7175 6972 656d 656e   self.requiremen
-0000a6d0: 7420 3d20 5b5d 0a0a 2020 2020 2020 2020  t = []..        
-0000a6e0: 2320 496e 7075 7473 2064 6573 6372 6970  # Inputs descrip
-0000a6f0: 7469 6f6e 0a20 2020 2020 2020 2069 6e5f  tion.        in_
-0000a700: 6669 6c65 735f 6465 7363 203d 2028 0a20  files_desc = (. 
-0000a710: 2020 2020 2020 2020 2020 2022 4120 6c69             "A li
-0000a720: 7374 206f 6620 6974 656d 7320 7769 7468  st of items with
-0000a730: 2073 7472 696e 6720 656c 656d 656e 7473   string elements
-0000a740: 2063 6f72 7265 7370 6f6e 6469 6e67 2022   corresponding "
-0000a750: 0a20 2020 2020 2020 2020 2020 2022 746f  .            "to
-0000a760: 2065 7869 7374 696e 6720 7061 7468 2066   existing path f
-0000a770: 696c 6573 2e22 0a20 2020 2020 2020 2029  iles.".        )
-0000a780: 0a20 2020 2020 2020 2070 7265 6669 785f  .        prefix_
-0000a790: 6465 7363 203d 2022 5072 6566 6978 206f  desc = "Prefix o
-0000a7a0: 6620 7468 6520 6f75 7470 7574 2069 6d61  f the output ima
-0000a7b0: 6765 2028 6120 7374 7269 6e67 292e 220a  ge (a string).".
-0000a7c0: 2020 2020 2020 2020 7375 6666 6978 5f64          suffix_d
-0000a7d0: 6573 6320 3d20 2253 7566 6669 7820 6f66  esc = "Suffix of
-0000a7e0: 2074 6865 206f 7574 7075 7420 696d 6167   the output imag
-0000a7f0: 6520 2861 2073 7472 696e 6729 2e22 0a0a  e (a string)."..
-0000a800: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
-0000a810: 7320 6465 7363 7269 7074 696f 6e0a 2020  s description.  
-0000a820: 2020 2020 2020 6f75 745f 6669 6c65 735f        out_files_
-0000a830: 6465 7363 203d 2028 0a20 2020 2020 2020  desc = (.       
-0000a840: 2020 2020 2022 5061 7468 206f 6620 7468       "Path of th
-0000a850: 6520 7363 616e 2061 6674 6572 2065 6e68  e scan after enh
-0000a860: 616e 6369 6e67 2022 0a20 2020 2020 2020  ancing ".       
-0000a870: 2020 2020 2022 2861 2070 6174 686c 696b       "(a pathlik
-0000a880: 6520 6f62 6a65 6374 206f 7220 7374 7269  e object or stri
-0000a890: 6e67 2072 6570 7265 7365 6e74 696e 6720  ng representing 
-0000a8a0: 6120 6669 6c65 2c20 6f72 2022 0a20 2020  a file, or ".   
-0000a8b0: 2020 2020 2020 2020 2022 6120 6c69 7374           "a list
-0000a8c0: 206f 6620 7061 7468 6c69 6b65 206f 626a   of pathlike obj
-0000a8d0: 6563 7473 206f 7220 7374 7269 6e67 7320  ects or strings 
-0000a8e0: 7265 7072 6573 656e 7469 6e67 2061 2022  representing a "
-0000a8f0: 0a20 2020 2020 2020 2020 2020 2022 6669  .            "fi
-0000a900: 6c65 292e 220a 2020 2020 2020 2020 290a  le).".        ).
-0000a910: 0a20 2020 2020 2020 2023 2049 6e70 7574  .        # Input
-0000a920: 7320 7472 6169 7473 0a20 2020 2020 2020  s traits.       
-0000a930: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
-0000a940: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
-0000a950: 5f66 696c 6573 222c 0a20 2020 2020 2020  _files",.       
-0000a960: 2020 2020 2049 6e70 7574 4d75 6c74 6950       InputMultiP
-0000a970: 6174 6828 0a20 2020 2020 2020 2020 2020  ath(.           
-0000a980: 2020 2020 2074 7261 6974 732e 4569 7468       traits.Eith
-0000a990: 6572 2846 696c 6528 292c 2074 7261 6974  er(File(), trait
-0000a9a0: 732e 4c69 7374 2846 696c 6528 2929 292c  s.List(File())),
-0000a9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a9c0: 206f 7574 7075 743d 4661 6c73 652c 0a20   output=False,. 
-0000a9d0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000a9e0: 6573 633d 696e 5f66 696c 6573 5f64 6573  esc=in_files_des
-0000a9f0: 632c 0a20 2020 2020 2020 2020 2020 2029  c,.            )
-0000aa00: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000aa10: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-0000aa20: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-0000aa30: 2022 7072 6566 6978 222c 0a20 2020 2020   "prefix",.     
-0000aa40: 2020 2020 2020 2074 7261 6974 732e 5374         traits.St
-0000aa50: 7269 6e67 2822 222c 206f 7574 7075 743d  ring("", output=
-0000aa60: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
-0000aa70: 5472 7565 2c20 6465 7363 3d70 7265 6669  True, desc=prefi
-0000aa80: 785f 6465 7363 292c 0a20 2020 2020 2020  x_desc),.       
-0000aa90: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-0000aaa0: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
-0000aab0: 2020 2020 2020 2020 2273 7566 6669 7822          "suffix"
-0000aac0: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
-0000aad0: 6169 7473 2e53 7472 696e 6728 0a20 2020  aits.String(.   
-0000aae0: 2020 2020 2020 2020 2020 2020 2022 5f65               "_e
-0000aaf0: 6e68 222c 206f 7574 7075 743d 4661 6c73  nh", output=Fals
-0000ab00: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
-0000ab10: 2c20 6465 7363 3d73 7566 6669 785f 6465  , desc=suffix_de
-0000ab20: 7363 0a20 2020 2020 2020 2020 2020 2029  sc.            )
-0000ab30: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000ab40: 2020 2020 2023 204f 7574 7075 7473 2074       # Outputs t
-0000ab50: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
-0000ab60: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
-0000ab70: 2020 2020 2020 2020 2020 226f 7574 5f66            "out_f
-0000ab80: 696c 6573 222c 0a20 2020 2020 2020 2020  iles",.         
-0000ab90: 2020 204f 7574 7075 744d 756c 7469 5061     OutputMultiPa
-0000aba0: 7468 2846 696c 6528 292c 206f 7574 7075  th(File(), outpu
-0000abb0: 743d 5472 7565 2c20 6465 7363 3d6f 7574  t=True, desc=out
-0000abc0: 5f66 696c 6573 5f64 6573 6329 2c0a 2020  _files_desc),.  
-0000abd0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000abe0: 2073 656c 662e 696e 6974 5f64 6566 6175   self.init_defau
-0000abf0: 6c74 5f74 7261 6974 7328 290a 0a20 2020  lt_traits()..   
-0000ac00: 2064 6566 206c 6973 745f 6f75 7470 7574   def list_output
-0000ac10: 7328 7365 6c66 2c20 6973 5f70 6c75 6767  s(self, is_plugg
-0000ac20: 6564 3d4e 6f6e 6529 3a0a 2020 2020 2020  ed=None):.      
-0000ac30: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
-0000ac40: 6f20 7468 6520 696e 6974 6961 6c69 7361  o the initialisa
-0000ac50: 7469 6f6e 2073 7465 7020 6f66 2074 6865  tion step of the
-0000ac60: 2062 7269 636b 2e0a 0a20 2020 2020 2020   brick...       
-0000ac70: 2054 6865 206d 6169 6e20 6f62 6a65 6374   The main object
-0000ac80: 6976 6520 6f66 2074 6869 7320 6d65 7468  ive of this meth
-0000ac90: 6f64 2069 7320 746f 2070 726f 6475 6365  od is to produce
-0000aca0: 2074 6865 206f 7574 7075 7473 206f 6620   the outputs of 
-0000acb0: 7468 650a 2020 2020 2020 2020 6272 6963  the.        bric
-0000acc0: 6b73 2028 7365 6c66 2e6f 7574 7075 7473  ks (self.outputs
-0000acd0: 2920 616e 6420 7468 6520 6173 736f 6369  ) and the associ
-0000ace0: 6174 6564 2074 6167 7320 2873 656c 662e  ated tags (self.
-0000acf0: 696e 6865 7269 7461 6e63 655f 6469 6329  inheritance_dic)
-0000ad00: 2c0a 2020 2020 2020 2020 6966 2064 6566  ,.        if def
-0000ad10: 696e 6564 2068 6572 652e 2054 6f20 776f  ined here. To wo
-0000ad20: 726b 2070 726f 7065 726c 7920 7468 6973  rk properly this
-0000ad30: 206d 6574 686f 6420 6d75 7374 2072 6574   method must ret
-0000ad40: 7572 6e0a 2020 2020 2020 2020 7365 6c66  urn.        self
-0000ad50: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
-0000ad60: 2829 206f 626a 6563 742e 0a0a 2020 2020  () object...    
-0000ad70: 2020 2020 3a70 6172 616d 2069 735f 706c      :param is_pl
-0000ad80: 7567 6765 643a 2074 6865 2073 7461 7465  ugged: the state
-0000ad90: 2c20 6c69 6e6b 6564 206f 7220 6e6f 742c  , linked or not,
-0000ada0: 206f 6620 7468 6520 706c 7567 732e 0a20   of the plugs.. 
-0000adb0: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
-0000adc0: 2061 2064 6963 7469 6f6e 6172 7920 7769   a dictionary wi
-0000add0: 7468 2072 6571 7569 7265 6d65 6e74 2c20  th requirement, 
-0000ade0: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
-0000adf0: 7269 7461 6e63 655f 6469 6374 2e0a 2020  ritance_dict..  
-0000ae00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000ae10: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
-0000ae20: 6865 7269 7461 6e63 6520 746f 2050 726f  heritance to Pro
-0000ae30: 6365 7373 4d49 4120 636c 6173 732c 206c  cessMIA class, l
-0000ae40: 6973 745f 6f75 7470 7574 7320 6d65 7468  ist_outputs meth
-0000ae50: 6f64 0a20 2020 2020 2020 2073 7570 6572  od.        super
-0000ae60: 2845 6e68 616e 6365 2c20 7365 6c66 292e  (Enhance, self).
-0000ae70: 6c69 7374 5f6f 7574 7075 7473 2829 0a0a  list_outputs()..
-0000ae80: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
-0000ae90: 7320 6465 6669 6e69 7469 6f6e 0a20 2020  s definition.   
-0000aea0: 2020 2020 2069 6620 7365 6c66 2e69 6e5f       if self.in_
-0000aeb0: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
-0000aec0: 2020 2066 696c 6573 5f6e 616d 6520 3d20     files_name = 
-0000aed0: 7365 6c66 2e69 6e5f 6669 6c65 730a 0a20  self.in_files.. 
-0000aee0: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
-0000aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af00: 286e 6f74 2073 656c 662e 7375 6666 6978  (not self.suffix
-0000af10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000af20: 2020 6f72 2028 7365 6c66 2e73 7566 6669    or (self.suffi
-0000af30: 782e 6973 7370 6163 6528 2929 0a20 2020  x.isspace()).   
-0000af40: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-0000af50: 7365 6c66 2e73 7566 6669 7820 696e 205b  self.suffix in [
-0000af60: 556e 6465 6669 6e65 642c 2022 3c75 6e64  Undefined, "<und
-0000af70: 6566 696e 6564 3e22 5d0a 2020 2020 2020  efined>"].      
-0000af80: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-0000af90: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
-0000afa0: 6666 6978 203d 2022 2022 0a0a 2020 2020  ffix = " "..    
-0000afb0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-0000afc0: 2020 2020 2020 2020 2020 2020 2028 6e6f               (no
-0000afd0: 7420 7365 6c66 2e70 7265 6669 7829 0a20  t self.prefix). 
-0000afe0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000aff0: 7220 2873 656c 662e 7072 6566 6978 2e69  r (self.prefix.i
-0000b000: 7373 7061 6365 2829 290a 2020 2020 2020  sspace()).      
-0000b010: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
-0000b020: 6c66 2e70 7265 6669 7820 696e 205b 556e  lf.prefix in [Un
-0000b030: 6465 6669 6e65 642c 2022 3c75 6e64 6566  defined, "<undef
-0000b040: 696e 6564 3e22 5d29 0a20 2020 2020 2020  ined>"]).       
-0000b050: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-0000b060: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-0000b070: 6669 7820 3d20 2220 220a 0a20 2020 2020  fix = " "..     
-0000b080: 2020 2020 2020 2066 696c 6573 203d 205b         files = [
-0000b090: 5d0a 2020 2020 2020 2020 2020 2020 666c  ].            fl
-0000b0a0: 6167 203d 2054 7275 6520 2023 2049 6620  ag = True  # If 
-0000b0b0: 4661 6c73 652c 2073 7566 2f70 7265 6620  False, suf/pref 
-0000b0c0: 6368 6563 6b20 7769 6c6c 206e 6f74 2062  check will not b
-0000b0d0: 6520 7065 7266 6f72 6d65 6420 6c61 7465  e performed late
-0000b0e0: 720a 0a20 2020 2020 2020 2020 2020 2066  r..            f
-0000b0f0: 6f72 2066 696c 655f 6e61 6d65 3120 696e  or file_name1 in
-0000b100: 2066 696c 6573 5f6e 616d 653a 0a20 2020   files_name:.   
-0000b110: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0000b120: 6964 5f65 7874 2c20 696e 5f65 7874 2c20  id_ext, in_ext, 
-0000b130: 6669 6c65 4e61 6d65 203d 2063 6865 636b  fileName = check
-0000b140: 4669 6c65 4578 7428 6669 6c65 5f6e 616d  FileExt(file_nam
-0000b150: 6531 2c20 4558 5429 0a0a 2020 2020 2020  e1, EXT)..      
-0000b160: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000b170: 2076 616c 6964 5f65 7874 3a0a 2020 2020   valid_ext:.    
-0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b190: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000b1b0: 5c6e 456e 6861 6e63 6520 6272 6963 6b3a  \nEnhance brick:
-0000b1c0: 2054 6865 2069 6e70 7574 2069 6d61 6765   The input image
-0000b1d0: 2066 6f72 6d61 7420 6973 206e 6f74 2022   format is not "
-0000b1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b1f0: 2020 2020 2020 2020 2022 7265 636f 676e           "recogn
-0000b200: 697a 6564 2e2e 2e21 220a 2020 2020 2020  ized...!".      
-0000b210: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b230: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0000b240: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-0000b250: 205f 203d 206f 732e 7061 7468 2e73 706c   _ = os.path.spl
-0000b260: 6974 2866 696c 655f 6e61 6d65 3129 0a0a  it(file_name1)..
-0000b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b280: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-0000b290: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
-0000b2a0: 6666 6978 203d 3d20 2220 220a 2020 2020  ffix == " ".    
-0000b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2c0: 616e 6420 7365 6c66 2e70 7265 6669 7820  and self.prefix 
-0000b2d0: 3d3d 2022 2022 0a20 2020 2020 2020 2020  == " ".         
-0000b2e0: 2020 2020 2020 2020 2020 2061 6e64 2070             and p
-0000b2f0: 6174 6820 3d3d 2073 656c 662e 6f75 7470  ath == self.outp
-0000b300: 7574 5f64 6972 6563 746f 7279 0a20 2020  ut_directory.   
-0000b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b320: 2061 6e64 2066 6c61 6720 6973 2054 7275   and flag is Tru
-0000b330: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000b340: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000b350: 2020 2020 2020 2020 206d 7367 203d 2051           msg = Q
-0000b360: 4d65 7373 6167 6542 6f78 2829 0a20 2020  MessageBox().   
-0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b380: 206d 7367 2e73 6574 4963 6f6e 2851 4d65   msg.setIcon(QMe
-0000b390: 7373 6167 6542 6f78 2e57 6172 6e69 6e67  ssageBox.Warning
-0000b3a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b3b0: 2020 2020 2020 6d73 672e 7365 7457 696e        msg.setWin
-0000b3c0: 646f 7754 6974 6c65 280a 2020 2020 2020  dowTitle(.      
-0000b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3e0: 2020 226d 6961 5f70 726f 6365 7373 6573    "mia_processes
-0000b3f0: 202d 2045 6e68 616e 6365 2062 7269 636b   - Enhance brick
-0000b400: 2057 6172 6e69 6e67 2122 0a20 2020 2020   Warning!".     
-0000b410: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000b420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b430: 2020 2020 206d 7367 2e73 6574 5465 7874       msg.setText
-0000b440: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000b450: 2020 2020 2020 2020 2020 2253 7566 6669            "Suffi
-0000b460: 7820 616e 6420 7072 6566 6978 2069 6e70  x and prefix inp
-0000b470: 7574 2070 6172 616d 6574 6572 7320 6172  ut parameters ar
-0000b480: 6520 6e6f 7420 220a 2020 2020 2020 2020  e not ".        
-0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4a0: 2264 6566 696e 6564 206f 7220 636f 6e73  "defined or cons
-0000b4b0: 6973 7420 6f6e 6c79 206f 6620 6f6e 6520  ist only of one 
-0000b4c0: 6f72 206d 6f72 6520 7768 6974 6520 220a  or more white ".
-0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4e0: 2020 2020 2020 2020 2273 7061 6365 732e          "spaces.
-0000b4f0: 5c6e 5468 6520 7b30 7d20 696e 7075 7420  \nThe {0} input 
-0000b500: 7061 7261 6d65 7465 7220 7769 6c6c 2062  parameter will b
-0000b510: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-0000b520: 2020 2020 2020 2020 2020 2020 226f 7665              "ove
-0000b530: 7277 7269 7474 656e 202e 2e2e 5c6e 2059  rwritten ...\n Y
-0000b540: 6573 206f 7220 220a 2020 2020 2020 2020  es or ".        
+00007fe0: 2020 2022 5468 6973 206d 6179 2063 6175     "This may cau
+00007ff0: 7365 2061 6e20 6973 7375 6520 6475 7269  se an issue duri
+00008000: 6e67 2074 6865 2072 6573 7420 6f66 2074  ng the rest of t
+00008010: 6865 2022 0a20 2020 2020 2020 2020 2020  he ".           
+00008020: 2020 2020 2020 2020 2020 2020 2022 7072               "pr
+00008030: 6f63 6573 732c 2069 6620 7468 6973 2062  ocess, if this b
+00008040: 7269 636b 2069 7320 7573 6564 2069 6e20  rick is used in 
+00008050: 6120 7069 7065 6c69 6e65 220a 2020 2020  a pipeline".    
+00008060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008070: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00008080: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00008090: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+000080a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080b0: 222d 2043 6f6e 666f 726d 496d 6167 6520  "- ConformImage 
+000080c0: 6272 6963 6b3a 2054 6865 7265 2077 6173  brick: There was
+000080d0: 206e 6f20 6f75 7470 7574 2066 696c 6520   no output file 
+000080e0: 6465 6475 6374 6564 2022 0a20 2020 2020  deducted ".     
+000080f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00008100: 6475 7269 6e67 2069 6e69 7469 616c 697a  during initializ
+00008110: 6174 696f 6e2e 2050 6c65 6173 6520 6368  ation. Please ch
+00008120: 6563 6b20 7468 6520 696e 7075 7420 220a  eck the input ".
+00008130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008140: 2020 2020 2270 6172 616d 6574 6572 732e      "parameters.
+00008150: 2e2e 2122 0a20 2020 2020 2020 2020 2020  ..!".           
+00008160: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00008170: 2020 2020 2320 7461 6773 2069 6e68 6572      # tags inher
+00008180: 6974 616e 6365 2028 6f70 7469 6f6e 616c  itance (optional
+00008190: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000081a0: 2073 656c 662e 6f75 7470 7574 735b 226f   self.outputs["o
+000081b0: 7574 5f66 696c 6522 5d3a 0a20 2020 2020  ut_file"]:.     
+000081c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000081d0: 7461 6773 5f69 6e68 6572 6974 616e 6365  tags_inheritance
+000081e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000081f0: 2020 2020 2020 696e 5f66 696c 653d 7365        in_file=se
+00008200: 6c66 2e69 6e5f 6669 6c65 2c0a 2020 2020  lf.in_file,.    
+00008210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008220: 6f75 745f 6669 6c65 3d73 656c 662e 6f75  out_file=self.ou
+00008230: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
+00008240: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00008250: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00008260: 5265 7475 726e 2074 6865 2072 6571 7569  Return the requi
+00008270: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
+00008280: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
+00008290: 6469 6374 0a20 2020 2020 2020 2072 6574  dict.        ret
+000082a0: 7572 6e20 7365 6c66 2e6d 616b 655f 696e  urn self.make_in
+000082b0: 6974 5265 7375 6c74 2829 0a0a 2020 2020  itResult()..    
+000082c0: 6465 6620 7275 6e5f 7072 6f63 6573 735f  def run_process_
+000082d0: 6d69 6128 7365 6c66 293a 0a20 2020 2020  mia(self):.     
+000082e0: 2020 2022 2222 4465 6469 6361 7465 6420     """Dedicated 
+000082f0: 746f 2074 6865 2070 726f 6365 7373 206c  to the process l
+00008300: 6175 6e63 6820 7374 6570 206f 6620 7468  aunch step of th
+00008310: 6520 6272 6963 6b2e 2222 220a 2020 2020  e brick.""".    
+00008320: 2020 2020 7375 7065 7228 436f 6e66 6f72      super(Confor
+00008330: 6d49 6d61 6765 2c20 7365 6c66 292e 7275  mImage, self).ru
+00008340: 6e5f 7072 6f63 6573 735f 6d69 6128 290a  n_process_mia().
+00008350: 0a20 2020 2020 2020 2066 696c 655f 6e61  .        file_na
+00008360: 6d65 203d 2073 656c 662e 696e 5f66 696c  me = self.in_fil
+00008370: 650a 0a20 2020 2020 2020 2023 2049 6d61  e..        # Ima
+00008380: 6765 2070 726f 6365 7373 696e 670a 2020  ge processing.  
+00008390: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000083a0: 2020 2020 2020 2069 6d67 203d 206e 6962         img = nib
+000083b0: 2e6c 6f61 6428 6669 6c65 5f6e 616d 6529  .load(file_name)
+000083c0: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+000083d0: 2028 0a20 2020 2020 2020 2020 2020 206e   (.            n
+000083e0: 6962 2e66 696c 6562 6173 6564 696d 6167  ib.filebasedimag
+000083f0: 6573 2e49 6d61 6765 4669 6c65 4572 726f  es.ImageFileErro
+00008400: 722c 0a20 2020 2020 2020 2020 2020 2046  r,.            F
+00008410: 696c 654e 6f74 466f 756e 6445 7272 6f72  ileNotFoundError
+00008420: 2c0a 2020 2020 2020 2020 2020 2020 5479  ,.            Ty
+00008430: 7065 4572 726f 722c 0a20 2020 2020 2020  peError,.       
+00008440: 2029 2061 7320 653a 0a20 2020 2020 2020   ) as e:.       
+00008450: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+00008460: 2020 2020 2020 2020 2020 2020 225c 6e43              "\nC
+00008470: 6f6e 666f 726d 496d 6167 6520 6272 6963  onformImage bric
+00008480: 6b3a 2045 7272 6f72 2077 6974 6820 6669  k: Error with fi
+00008490: 6c65 2074 6f20 636f 6e66 6f72 6d2c 2064  le to conform, d
+000084a0: 7572 696e 6720 7468 6520 220a 2020 2020  uring the ".    
+000084b0: 2020 2020 2020 2020 2020 2020 2272 756e              "run
+000084c0: 3a20 222c 0a20 2020 2020 2020 2020 2020  : ",.           
+000084d0: 2020 2020 2065 2c0a 2020 2020 2020 2020       e,.        
+000084e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000084f0: 2020 696d 6720 3d20 4e6f 6e65 0a0a 2020    img = None..  
+00008500: 2020 2020 2020 6966 2069 6d67 2069 7320        if img is 
+00008510: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00008520: 2020 2020 2020 6f75 745f 696d 6720 3d20        out_img = 
+00008530: 6e69 622e 7371 7565 657a 655f 696d 6167  nib.squeeze_imag
+00008540: 6528 696d 6729 0a20 2020 2020 2020 2020  e(img).         
+00008550: 2020 206f 7574 5f69 6d67 203d 206e 6962     out_img = nib
+00008560: 2e61 735f 636c 6f73 6573 745f 6361 6e6f  .as_closest_cano
+00008570: 6e69 6361 6c28 6f75 745f 696d 6729 0a0a  nical(out_img)..
+00008580: 2020 2020 2020 2020 2020 2020 2320 496d              # Im
+00008590: 6167 6520 7361 7665 0a20 2020 2020 2020  age save.       
+000085a0: 2020 2020 205f 2c20 6669 6c65 5f6e 616d       _, file_nam
+000085b0: 6520 3d20 6f73 2e70 6174 682e 7370 6c69  e = os.path.spli
+000085c0: 7428 6669 6c65 5f6e 616d 6529 0a20 2020  t(file_name).   
+000085d0: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
+000085e0: 6d65 5f6e 6f5f 6578 742c 2066 696c 655f  me_no_ext, file_
+000085f0: 6578 7465 6e73 696f 6e20 3d20 6f73 2e70  extension = os.p
+00008600: 6174 682e 7370 6c69 7465 7874 2866 696c  ath.splitext(fil
+00008610: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+00008620: 2020 2020 6966 2066 696c 655f 6578 7465      if file_exte
+00008630: 6e73 696f 6e20 3d3d 2022 2e67 7a22 3a0a  nsion == ".gz":.
+00008640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008650: 2866 696c 655f 6e61 6d65 5f6e 6f5f 6578  (file_name_no_ex
+00008660: 745f 322c 2066 696c 655f 6578 7465 6e73  t_2, file_extens
+00008670: 696f 6e5f 3229 203d 206f 732e 7061 7468  ion_2) = os.path
+00008680: 2e73 706c 6974 6578 7428 0a20 2020 2020  .splitext(.     
+00008690: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000086a0: 696c 655f 6e61 6d65 5f6e 6f5f 6578 740a  ile_name_no_ext.
+000086b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000086d0: 2020 6966 2066 696c 655f 6578 7465 6e73    if file_extens
+000086e0: 696f 6e5f 3220 3d3d 2022 2e6e 6969 223a  ion_2 == ".nii":
+000086f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008700: 2020 2020 2066 696c 655f 6e61 6d65 5f6e       file_name_n
+00008710: 6f5f 6578 7420 3d20 6669 6c65 5f6e 616d  o_ext = file_nam
+00008720: 655f 6e6f 5f65 7874 5f32 0a20 2020 2020  e_no_ext_2.     
+00008730: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00008740: 696c 655f 6578 7465 6e73 696f 6e20 3d20  ile_extension = 
+00008750: 222e 6e69 692e 677a 220a 0a20 2020 2020  ".nii.gz"..     
+00008760: 2020 2020 2020 2066 696c 655f 6f75 7420         file_out 
+00008770: 3d20 6f73 2e70 6174 682e 6a6f 696e 280a  = os.path.join(.
+00008780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008790: 7365 6c66 2e6f 7574 7075 745f 6469 7265  self.output_dire
+000087a0: 6374 6f72 792c 0a20 2020 2020 2020 2020  ctory,.         
+000087b0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+000087c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000087d0: 662e 7072 6566 6978 2e73 7472 6970 2829  f.prefix.strip()
+000087e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000087f0: 2020 2020 202b 2066 696c 655f 6e61 6d65       + file_name
+00008800: 5f6e 6f5f 6578 740a 2020 2020 2020 2020  _no_ext.        
+00008810: 2020 2020 2020 2020 2020 2020 2b20 7365              + se
+00008820: 6c66 2e73 7566 6669 782e 7374 7269 7028  lf.suffix.strip(
+00008830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00008840: 2020 2020 2020 2b20 6669 6c65 5f65 7874        + file_ext
+00008850: 656e 7369 6f6e 0a20 2020 2020 2020 2020  ension.         
+00008860: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+00008870: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00008880: 2020 2020 6e69 622e 7361 7665 286f 7574      nib.save(out
+00008890: 5f69 6d67 2c20 6669 6c65 5f6f 7574 290a  _img, file_out).
+000088a0: 0a0a 636c 6173 7320 436f 6e76 524f 4928  ..class ConvROI(
+000088b0: 5072 6f63 6573 734d 4941 293a 0a20 2020  ProcessMIA):.   
+000088c0: 2022 2222 0a20 2020 202a 496d 6167 6520   """.    *Image 
+000088d0: 636f 6e76 6f6c 7574 696f 6e20 7769 7468  convolution with
+000088e0: 206f 6e65 2069 6d61 6765 2a0a 0a20 2020   one image*..   
+000088f0: 202d 2052 6573 616d 706c 696e 6720 7468   - Resampling th
+00008900: 6520 696d 6167 6573 5f74 6f5f 636f 6e76  e images_to_conv
+00008910: 6f6c 7665 2074 6f20 7468 6520 7369 7a65  olve to the size
+00008920: 206f 6620 636f 6e76 6f6c 7665 5f77 6974   of convolve_wit
+00008930: 682e 0a20 2020 202d 2054 6865 6e20 636f  h..    - Then co
+00008940: 6e76 6f6c 7665 2065 6163 6820 656c 656d  nvolve each elem
+00008950: 656e 7420 6f66 2072 6573 697a 6564 2069  ent of resized i
+00008960: 6d61 6765 735f 746f 5f63 6f6e 766f 6c76  mages_to_convolv
+00008970: 6520 7769 7468 0a20 2020 2020 2063 6f6e  e with.      con
+00008980: 766f 6c76 655f 7769 7468 2e0a 2020 2020  volve_with..    
+00008990: 2d20 5468 6520 6f75 7470 7574 5f64 6972  - The output_dir
+000089a0: 6563 746f 7279 2f50 6174 6965 6e74 4e61  ectory/PatientNa
+000089b0: 6d65 5f64 6174 612f 524f 495f 6461 7461  me_data/ROI_data
+000089c0: 2f63 6f6e 7652 4f49 5f42 4f4c 4420 6469  /convROI_BOLD di
+000089d0: 7265 6374 6f72 7920 6973 0a20 2020 2020  rectory is.     
+000089e0: 2063 7265 6174 6564 2074 6f20 7265 6365   created to rece
+000089f0: 6976 6520 7468 6520 636f 6e76 6f6c 7665  ive the convolve
+00008a00: 6420 696d 6167 6573 2e20 4966 2074 6869  d images. If thi
+00008a10: 7320 6469 7265 6374 6f72 7920 6578 6973  s directory exis
+00008a20: 7473 2061 740a 2020 2020 2020 7275 6e74  ts at.      runt
+00008a30: 696d 6520 6974 2069 7320 6465 6c65 7465  ime it is delete
+00008a40: 642e 0a20 2020 202d 2054 6f20 776f 726b  d..    - To work
+00008a50: 2063 6f72 7265 6374 6c79 2c20 7468 6520   correctly, the 
+00008a60: 6461 7461 6261 7365 2065 6e74 7279 2066  database entry f
+00008a70: 6f72 2074 6865 2063 6f6e 766f 6c76 655f  or the convolve_
+00008a80: 7769 7468 0a20 2020 2020 2070 6172 616d  with.      param
+00008a90: 6574 6572 206d 7573 7420 6861 7665 2074  eter must have t
+00008aa0: 6865 2022 5061 7469 656e 744e 616d 6522  he "PatientName"
+00008ab0: 2074 6167 2066 696c 6c65 6420 696e 2e0a   tag filled in..
+00008ac0: 0a20 2020 2050 6c65 6173 652c 2073 6565  .    Please, see
+00008ad0: 2074 6865 2063 6f6d 706c 6574 6520 646f   the complete do
+00008ae0: 6375 6d65 6e74 6174 696f 6e20 666f 7220  cumentation for 
+00008af0: 7468 6520 6043 6f6e 7652 4f49 2062 7269  the `ConvROI bri
+00008b00: 636b 0a20 2020 2069 6e20 7468 6520 6d69  ck.    in the mi
+00008b10: 615f 7072 6f63 6573 7365 7320 7765 6273  a_processes webs
+00008b20: 6974 650a 2020 2020 3c68 7474 7073 3a2f  ite.    <https:/
+00008b30: 2f70 6f70 756c 7365 2e67 6974 6875 622e  /populse.github.
+00008b40: 696f 2f6d 6961 5f70 726f 6365 7373 6573  io/mia_processes
+00008b50: 2f68 746d 6c2f 646f 6375 6d65 6e74 6174  /html/documentat
+00008b60: 696f 6e2f 6272 6963 6b73 2f70 7265 7072  ion/bricks/prepr
+00008b70: 6f63 6573 732f 6f74 6865 722f 436f 6e76  ocess/other/Conv
+00008b80: 524f 492e 6874 6d6c 3e60 5f0a 2020 2020  ROI.html>`_.    
+00008b90: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+00008ba0: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
+00008bb0: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
+00008bc0: 6420 746f 2074 6865 2061 7474 7269 6275  d to the attribu
+00008bd0: 7465 7320 696e 6974 6961 6c69 7361 7469  tes initialisati
+00008be0: 6f6e 2f69 6e73 7461 6e74 6961 7469 6f6e  on/instantiation
+00008bf0: 2e0a 0a20 2020 2020 2020 2054 6865 2069  ...        The i
+00008c00: 6e70 7574 2061 6e64 206f 7574 7075 7420  nput and output 
+00008c10: 706c 7567 7320 6172 6520 6465 6669 6e65  plugs are define
+00008c20: 6420 6865 7265 2e20 5468 6520 7370 6563  d here. The spec
+00008c30: 6961 6c0a 2020 2020 2020 2020 2773 656c  ial.        'sel
+00008c40: 662e 7265 7175 6972 656d 656e 7427 2061  f.requirement' a
+00008c50: 7474 7269 6275 7465 2028 6f70 7469 6f6e  ttribute (option
+00008c60: 616c 2920 6973 2075 7365 6420 746f 2064  al) is used to d
+00008c70: 6566 696e 6520 7468 650a 2020 2020 2020  efine the.      
+00008c80: 2020 7468 6972 642d 7061 7274 7920 7072    third-party pr
+00008c90: 6f64 7563 7473 206e 6563 6573 7361 7279  oducts necessary
+00008ca0: 2066 6f72 2074 6865 2072 756e 6e69 6e67   for the running
+00008cb0: 206f 6620 7468 6520 6272 6963 6b2e 0a20   of the brick.. 
+00008cc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00008cd0: 2020 2023 2049 6e69 7469 616c 6973 6174     # Initialisat
+00008ce0: 696f 6e20 6f66 2074 6865 206f 626a 6563  ion of the objec
+00008cf0: 7473 206e 6565 6465 6420 666f 7220 7468  ts needed for th
+00008d00: 6520 6c61 756e 6368 206f 6620 7468 6520  e launch of the 
+00008d10: 6272 6963 6b0a 2020 2020 2020 2020 7375  brick.        su
+00008d20: 7065 7228 436f 6e76 524f 492c 2073 656c  per(ConvROI, sel
+00008d30: 6629 2e5f 5f69 6e69 745f 5f28 290a 0a20  f).__init__().. 
+00008d40: 2020 2020 2020 2023 2049 6e70 7574 7320         # Inputs 
+00008d50: 6465 7363 7269 7074 696f 6e0a 2020 2020  description.    
+00008d60: 2020 2020 696d 6167 6573 5f74 6f5f 636f      images_to_co
+00008d70: 6e76 6f6c 7665 5f64 6573 6320 3d20 280a  nvolve_desc = (.
+00008d80: 2020 2020 2020 2020 2020 2020 2241 206c              "A l
+00008d90: 6973 7420 6f66 2069 6d61 6765 7320 746f  ist of images to
+00008da0: 2063 6f6e 766f 6c76 6520 7769 7468 2063   convolve with c
+00008db0: 6f6e 766f 6c76 655f 7769 7468 2069 6d61  onvolve_with ima
+00008dc0: 6765 220a 2020 2020 2020 2020 290a 2020  ge".        ).  
+00008dd0: 2020 2020 2020 636f 6e76 6f6c 7665 5f77        convolve_w
+00008de0: 6974 685f 6465 7363 203d 2022 4161 2073  ith_desc = "Aa s
+00008df0: 7472 696e 6720 7265 7072 6573 656e 7469  tring representi
+00008e00: 6e67 2061 2070 6174 6820 746f 2074 6865  ng a path to the
+00008e10: 2066 696c 6522 0a20 2020 2020 2020 2070   file".        p
+00008e20: 7265 6669 785f 6465 7363 203d 2022 5468  refix_desc = "Th
+00008e30: 6520 7072 6566 6978 2066 6f72 2074 6865  e prefix for the
+00008e40: 206f 7574 5f69 6d61 6765 7320 2861 2073   out_images (a s
+00008e50: 7472 696e 6729 220a 0a20 2020 2020 2020  tring)"..       
+00008e60: 2023 204f 7574 7075 7473 2064 6573 6372   # Outputs descr
+00008e70: 6970 7469 6f6e 0a20 2020 2020 2020 206f  iption.        o
+00008e80: 7574 5f69 6d61 6765 735f 6465 7363 203d  ut_images_desc =
+00008e90: 2022 5468 6520 636f 6e76 6f6c 7574 6564   "The convoluted
+00008ea0: 2069 6d61 6765 7322 0a0a 2020 2020 2020   images"..      
+00008eb0: 2020 2320 496e 7075 7473 2074 7261 6974    # Inputs trait
+00008ec0: 730a 2020 2020 2020 2020 7365 6c66 2e61  s.        self.a
+00008ed0: 6464 5f74 7261 6974 280a 2020 2020 2020  dd_trait(.      
+00008ee0: 2020 2020 2020 2269 6d61 6765 735f 746f        "images_to
+00008ef0: 5f63 6f6e 766f 6c76 6522 2c0a 2020 2020  _convolve",.    
+00008f00: 2020 2020 2020 2020 496e 7075 744d 756c          InputMul
+00008f10: 7469 5061 7468 280a 2020 2020 2020 2020  tiPath(.        
+00008f20: 2020 2020 2020 2020 496d 6167 6546 696c          ImageFil
+00008f30: 6553 504d 2829 2c0a 2020 2020 2020 2020  eSPM(),.        
+00008f40: 2020 2020 2020 2020 6f75 7470 7574 3d46          output=F
+00008f50: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00008f60: 2020 2020 2020 6f70 7469 6f6e 616c 3d46        optional=F
+00008f70: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00008f80: 2020 2020 2020 6465 7363 3d69 6d61 6765        desc=image
+00008f90: 735f 746f 5f63 6f6e 766f 6c76 655f 6465  s_to_convolve_de
+00008fa0: 7363 2c0a 2020 2020 2020 2020 2020 2020  sc,.            
+00008fb0: 292c 0a20 2020 2020 2020 2029 0a20 2020  ),.        ).   
+00008fc0: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+00008fd0: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+00008fe0: 2022 636f 6e76 6f6c 7665 5f77 6974 6822   "convolve_with"
+00008ff0: 2c0a 2020 2020 2020 2020 2020 2020 496d  ,.            Im
+00009000: 6167 6546 696c 6553 504d 280a 2020 2020  ageFileSPM(.    
+00009010: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00009020: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
+00009030: 616c 3d46 616c 7365 2c20 6465 7363 3d63  al=False, desc=c
+00009040: 6f6e 766f 6c76 655f 7769 7468 5f64 6573  onvolve_with_des
+00009050: 630a 2020 2020 2020 2020 2020 2020 292c  c.            ),
+00009060: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00009070: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
+00009080: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+00009090: 2270 7265 6669 7822 2c0a 2020 2020 2020  "prefix",.      
+000090a0: 2020 2020 2020 7472 6169 7473 2e53 7472        traits.Str
+000090b0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+000090c0: 2020 2020 2022 636f 6e76 222c 206f 7574       "conv", out
+000090d0: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
+000090e0: 6e61 6c3d 5472 7565 2c20 6465 7363 3d70  nal=True, desc=p
+000090f0: 7265 6669 785f 6465 7363 0a20 2020 2020  refix_desc.     
+00009100: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+00009110: 2020 290a 0a20 2020 2020 2020 2023 204f    )..        # O
+00009120: 7574 7075 7473 2074 7261 6974 730a 2020  utputs traits.  
+00009130: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00009140: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+00009150: 2020 226f 7574 5f69 6d61 6765 7322 2c0a    "out_images",.
+00009160: 2020 2020 2020 2020 2020 2020 4f75 7470              Outp
+00009170: 7574 4d75 6c74 6950 6174 6828 4669 6c65  utMultiPath(File
+00009180: 2829 2c20 6f75 7470 7574 3d54 7275 652c  (), output=True,
+00009190: 2064 6573 633d 6f75 745f 696d 6167 6573   desc=out_images
+000091a0: 5f64 6573 6329 2c0a 2020 2020 2020 2020  _desc),.        
+000091b0: 290a 0a20 2020 2020 2020 2023 2053 7065  )..        # Spe
+000091c0: 6369 616c 2070 6172 616d 6574 6572 2075  cial parameter u
+000091d0: 7365 6420 6173 2061 206d 6573 7365 6e67  sed as a messeng
+000091e0: 6572 2066 6f72 2074 6865 2072 756e 5f70  er for the run_p
+000091f0: 726f 6365 7373 5f6d 6961 206d 6574 686f  rocess_mia metho
+00009200: 640a 2020 2020 2020 2020 7365 6c66 2e61  d.        self.a
+00009210: 6464 5f74 7261 6974 280a 2020 2020 2020  dd_trait(.      
+00009220: 2020 2020 2020 2264 6963 7434 7275 6e74        "dict4runt
+00009230: 696d 6522 2c0a 2020 2020 2020 2020 2020  ime",.          
+00009240: 2020 7472 6169 7473 2e44 6963 7428 6f75    traits.Dict(ou
+00009250: 7470 7574 3d46 616c 7365 2c20 6f70 7469  tput=False, opti
+00009260: 6f6e 616c 3d54 7275 652c 2075 7365 726c  onal=True, userl
+00009270: 6576 656c 3d31 292c 0a20 2020 2020 2020  evel=1),.       
+00009280: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+00009290: 2e69 6e69 745f 6465 6661 756c 745f 7472  .init_default_tr
+000092a0: 6169 7473 2829 0a0a 2020 2020 6465 6620  aits()..    def 
+000092b0: 6c69 7374 5f6f 7574 7075 7473 2873 656c  list_outputs(sel
+000092c0: 662c 2069 735f 706c 7567 6765 643d 4e6f  f, is_plugged=No
+000092d0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+000092e0: 4465 6469 6361 7465 6420 746f 2074 6865  Dedicated to the
+000092f0: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
+00009300: 7374 6570 206f 6620 7468 6520 6272 6963  step of the bric
+00009310: 6b2e 0a0a 2020 2020 2020 2020 5468 6520  k...        The 
+00009320: 6d61 696e 206f 626a 6563 7469 7665 206f  main objective o
+00009330: 6620 7468 6973 206d 6574 686f 6420 6973  f this method is
+00009340: 2074 6f20 7072 6f64 7563 6520 7468 6520   to produce the 
+00009350: 6f75 7470 7574 7320 6f66 2074 6865 0a20  outputs of the. 
+00009360: 2020 2020 2020 2062 7269 636b 7320 2873         bricks (s
+00009370: 656c 662e 6f75 7470 7574 7329 2061 6e64  elf.outputs) and
+00009380: 2074 6865 2061 7373 6f63 6961 7465 6420   the associated 
+00009390: 7461 6773 2028 7365 6c66 2e69 6e68 6572  tags (self.inher
+000093a0: 6974 616e 6365 5f64 6963 292c 0a20 2020  itance_dic),.   
+000093b0: 2020 2020 2069 6620 6465 6669 6e65 6420       if defined 
+000093c0: 6865 7265 2e20 496e 206f 7264 6572 206e  here. In order n
+000093d0: 6f74 2074 6f20 696e 636c 7564 6520 616e  ot to include an
+000093e0: 206f 7574 7075 7420 696e 2074 6865 2064   output in the d
+000093f0: 6174 6162 6173 652c 0a20 2020 2020 2020  atabase,.       
+00009400: 2074 6869 7320 6f75 7470 7574 206d 7573   this output mus
+00009410: 7420 6265 2061 2076 616c 7565 206f 6620  t be a value of 
+00009420: 7468 6520 6f70 7469 6f6e 616c 206b 6579  the optional key
+00009430: 2027 6e6f 7449 6e44 6227 206f 6620 7468   'notInDb' of th
+00009440: 650a 2020 2020 2020 2020 7365 6c66 2e6f  e.        self.o
+00009450: 7574 7075 7473 2064 6963 7469 6f6e 6172  utputs dictionar
+00009460: 792e 2054 6f20 776f 726b 2070 726f 7065  y. To work prope
+00009470: 726c 7920 7468 6973 206d 6574 686f 6420  rly this method 
+00009480: 6d75 7374 2072 6574 7572 6e0a 2020 2020  must return.    
+00009490: 2020 2020 7365 6c66 2e6d 616b 655f 696e      self.make_in
+000094a0: 6974 5265 7375 6c74 2829 206f 626a 6563  itResult() objec
+000094b0: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
+000094c0: 616d 2069 735f 706c 7567 6765 643a 2074  am is_plugged: t
+000094d0: 6865 2073 7461 7465 2c20 6c69 6e6b 6564  he state, linked
+000094e0: 206f 7220 6e6f 742c 206f 6620 7468 6520   or not, of the 
+000094f0: 706c 7567 732e 0a20 2020 2020 2020 203a  plugs..        :
+00009500: 7265 7475 726e 733a 2061 2064 6963 7469  returns: a dicti
+00009510: 6f6e 6172 7920 7769 7468 2072 6571 7569  onary with requi
+00009520: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
+00009530: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
+00009540: 6469 6374 2e0a 2020 2020 2020 2020 2222  dict..        ""
+00009550: 220a 2020 2020 2020 2020 2320 5573 696e  ".        # Usin
+00009560: 6720 7468 6520 696e 6865 7269 7461 6e63  g the inheritanc
+00009570: 6520 746f 2050 726f 6365 7373 4d49 4120  e to ProcessMIA 
+00009580: 636c 6173 732c 206c 6973 745f 6f75 7470  class, list_outp
+00009590: 7574 7320 6d65 7468 6f64 0a20 2020 2020  uts method.     
+000095a0: 2020 2073 7570 6572 2843 6f6e 7652 4f49     super(ConvROI
+000095b0: 2c20 7365 6c66 292e 6c69 7374 5f6f 7574  , self).list_out
+000095c0: 7075 7473 2829 0a0a 2020 2020 2020 2020  puts()..        
+000095d0: 2320 4f75 7470 7574 7320 6465 6669 6e69  # Outputs defini
+000095e0: 7469 6f6e 2061 6e64 2074 6167 7320 696e  tion and tags in
+000095f0: 6865 7269 7461 6e63 6520 286f 7074 696f  heritance (optio
+00009600: 6e61 6c29 0a20 2020 2020 2020 2069 6620  nal).        if 
+00009610: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00009620: 6c66 2e69 6d61 6765 735f 746f 5f63 6f6e  lf.images_to_con
+00009630: 766f 6c76 6520 213d 2055 6e64 6566 696e  volve != Undefin
+00009640: 6564 0a20 2020 2020 2020 2020 2020 2061  ed.            a
+00009650: 6e64 2073 656c 662e 636f 6e76 6f6c 7665  nd self.convolve
+00009660: 5f77 6974 6820 213d 2055 6e64 6566 696e  _with != Undefin
+00009670: 6564 0a20 2020 2020 2020 2029 3a0a 2020  ed.        ):.  
+00009680: 2020 2020 2020 2020 2020 7061 7469 656e            patien
+00009690: 745f 6e61 6d65 203d 2067 6574 5f64 6246  t_name = get_dbF
+000096a0: 6965 6c64 5661 6c75 6528 0a20 2020 2020  ieldValue(.     
+000096b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000096c0: 7072 6f6a 6563 742c 2073 656c 662e 636f  project, self.co
+000096d0: 6e76 6f6c 7665 5f77 6974 682c 2022 5061  nvolve_with, "Pa
+000096e0: 7469 656e 744e 616d 6522 0a20 2020 2020  tientName".     
+000096f0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00009700: 2020 2020 2020 6966 2070 6174 6965 6e74        if patient
+00009710: 5f6e 616d 6520 6973 204e 6f6e 653a 0a20  _name is None:. 
+00009720: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00009730: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+00009740: 2020 2020 2020 2020 2020 275c 6e43 6f6e            '\nCon
+00009750: 7652 4f49 2062 7269 636b 3a5c 6e20 5468  vROI brick:\n Th
+00009760: 6520 2250 6174 6965 6e74 4e61 6d65 2220  e "PatientName" 
+00009770: 7461 6720 6973 206e 6f74 2066 696c 6c65  tag is not fille
+00009780: 6420 270a 2020 2020 2020 2020 2020 2020  d '.            
+00009790: 2020 2020 2020 2020 2269 6e20 7468 6520          "in the 
+000097a0: 6461 7461 6261 7365 2066 6f72 2074 6865  database for the
+000097b0: 207b 7d20 6669 6c65 202e 2e2e 5c6e 2054   {} file ...\n T
+000097c0: 6865 2063 616c 6375 6c61 7469 6f6e 220a  he calculation".
+000097d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097e0: 2020 2020 2269 7320 6162 6f72 7465 642e      "is aborted.
+000097f0: 2e2e 222e 666f 726d 6174 2873 656c 662e  ..".format(self.
+00009800: 636f 6e76 6f6c 7665 5f77 6974 6829 0a20  convolve_with). 
+00009810: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00009820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009830: 2072 6574 7572 6e20 7365 6c66 2e6d 616b   return self.mak
+00009840: 655f 696e 6974 5265 7375 6c74 2829 0a0a  e_initResult()..
+00009850: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009860: 2e64 6963 7434 7275 6e74 696d 655b 2270  .dict4runtime["p
+00009870: 6174 6965 6e74 5f6e 616d 6522 5d20 3d20  atient_name"] = 
+00009880: 7061 7469 656e 745f 6e61 6d65 0a20 2020  patient_name.   
+00009890: 2020 2020 2020 2020 2063 6f6e 765f 6469           conv_di
+000098a0: 7220 3d20 6f73 2e70 6174 682e 6a6f 696e  r = os.path.join
+000098b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000098c0: 2020 7365 6c66 2e6f 7574 7075 745f 6469    self.output_di
+000098d0: 7265 6374 6f72 792c 0a20 2020 2020 2020  rectory,.       
+000098e0: 2020 2020 2020 2020 2070 6174 6965 6e74           patient
+000098f0: 5f6e 616d 6520 2b20 225f 6461 7461 222c  _name + "_data",
+00009900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009910: 2022 524f 495f 6461 7461 222c 0a20 2020   "ROI_data",.   
+00009920: 2020 2020 2020 2020 2020 2020 2022 636f               "co
+00009930: 6e76 524f 495f 424f 4c44 222c 0a20 2020  nvROI_BOLD",.   
+00009940: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00009950: 2020 2020 2020 206c 6973 745f 6f75 7420         list_out 
+00009960: 3d20 5b5d 0a0a 2020 2020 2020 2020 2020  = []..          
+00009970: 2020 6966 2073 656c 662e 7072 6566 6978    if self.prefix
+00009980: 2e69 7373 7061 6365 2829 3a0a 2020 2020  .isspace():.    
+00009990: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000099a0: 2e70 7265 6669 7820 3d20 2222 0a0a 2020  .prefix = ""..  
+000099b0: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
+000099c0: 695f 6669 6c65 2069 6e20 7365 6c66 2e69  i_file in self.i
+000099d0: 6d61 6765 735f 746f 5f63 6f6e 766f 6c76  mages_to_convolv
+000099e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000099f0: 2020 206c 6973 745f 6f75 742e 6170 7065     list_out.appe
+00009a00: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00009a10: 2020 2020 2020 2020 6f73 2e70 6174 682e          os.path.
+00009a20: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
+00009a30: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00009a40: 6e76 5f64 6972 2c20 7365 6c66 2e70 7265  nv_dir, self.pre
+00009a50: 6669 7820 2b20 6f73 2e70 6174 682e 6261  fix + os.path.ba
+00009a60: 7365 6e61 6d65 2872 6f69 5f66 696c 6529  sename(roi_file)
+00009a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009a80: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00009a90: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00009aa0: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+00009ab0: 7473 5b22 6f75 745f 696d 6167 6573 225d  ts["out_images"]
+00009ac0: 203d 206c 6973 745f 6f75 740a 0a20 2020   = list_out..   
+00009ad0: 2020 2020 2023 2052 6574 7572 6e20 7468       # Return th
+00009ae0: 6520 7265 7175 6972 656d 656e 742c 206f  e requirement, o
+00009af0: 7574 7075 7473 2061 6e64 2069 6e68 6572  utputs and inher
+00009b00: 6974 616e 6365 5f64 6963 740a 2020 2020  itance_dict.    
+00009b10: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00009b20: 6d61 6b65 5f69 6e69 7452 6573 756c 7428  make_initResult(
+00009b30: 290a 0a20 2020 2064 6566 2072 756e 5f70  )..    def run_p
+00009b40: 726f 6365 7373 5f6d 6961 2873 656c 6629  rocess_mia(self)
+00009b50: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
+00009b60: 6963 6174 6564 2074 6f20 7468 6520 7072  icated to the pr
+00009b70: 6f63 6573 7320 6c61 756e 6368 2073 7465  ocess launch ste
+00009b80: 7020 6f66 2074 6865 2062 7269 636b 2e22  p of the brick."
+00009b90: 2222 0a0a 2020 2020 2020 2020 2320 4e6f  ""..        # No
+00009ba0: 206e 6565 6420 7468 6520 6e65 7874 206c   need the next l
+00009bb0: 696e 6520 2877 6520 646f 6e27 7420 7573  ine (we don't us
+00009bc0: 6520 7365 6c66 2e70 726f 6365 7373 2065  e self.process e
+00009bd0: 7420 5350 4d29 0a20 2020 2020 2020 2023  t SPM).        #
+00009be0: 2073 7570 6572 2843 6f6e 7652 4f49 2c20   super(ConvROI, 
+00009bf0: 7365 6c66 292e 7275 6e5f 7072 6f63 6573  self).run_proces
+00009c00: 735f 6d69 6128 290a 0a20 2020 2020 2020  s_mia()..       
+00009c10: 2070 6174 5f6e 616d 655f 6469 7220 3d20   pat_name_dir = 
+00009c20: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
+00009c30: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+00009c40: 7574 7075 745f 6469 7265 6374 6f72 792c  utput_directory,
+00009c50: 2073 656c 662e 6469 6374 3472 756e 7469   self.dict4runti
+00009c60: 6d65 5b22 7061 7469 656e 745f 6e61 6d65  me["patient_name
+00009c70: 225d 202b 2022 5f64 6174 6122 0a20 2020  "] + "_data".   
+00009c80: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00009c90: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00009ca0: 7869 7374 7328 7061 745f 6e61 6d65 5f64  xists(pat_name_d
+00009cb0: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
+00009cc0: 206f 732e 6d6b 6469 7228 7061 745f 6e61   os.mkdir(pat_na
+00009cd0: 6d65 5f64 6972 290a 0a20 2020 2020 2020  me_dir)..       
+00009ce0: 2072 6f69 5f64 6174 615f 6469 7220 3d20   roi_data_dir = 
+00009cf0: 6f73 2e70 6174 682e 6a6f 696e 2870 6174  os.path.join(pat
+00009d00: 5f6e 616d 655f 6469 722c 2022 524f 495f  _name_dir, "ROI_
+00009d10: 6461 7461 2229 0a0a 2020 2020 2020 2020  data")..        
+00009d20: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00009d30: 7869 7374 7328 726f 695f 6461 7461 5f64  xists(roi_data_d
+00009d40: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
+00009d50: 206f 732e 6d6b 6469 7228 726f 695f 6461   os.mkdir(roi_da
+00009d60: 7461 5f64 6972 290a 0a20 2020 2020 2020  ta_dir)..       
+00009d70: 2063 6f6e 765f 6469 7220 3d20 6f73 2e70   conv_dir = os.p
+00009d80: 6174 682e 6a6f 696e 2872 6f69 5f64 6174  ath.join(roi_dat
+00009d90: 615f 6469 722c 2022 636f 6e76 524f 495f  a_dir, "convROI_
+00009da0: 424f 4c44 2229 0a20 2020 2020 2020 2074  BOLD").        t
+00009db0: 6d70 203d 2022 4e6f 6e65 220a 0a20 2020  mp = "None"..   
+00009dc0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00009dd0: 6973 6469 7228 636f 6e76 5f64 6972 293a  isdir(conv_dir):
+00009de0: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
+00009df0: 203d 2074 656d 7066 696c 652e 6d6b 7465   = tempfile.mkte
+00009e00: 6d70 2864 6972 3d6f 732e 7061 7468 2e64  mp(dir=os.path.d
+00009e10: 6972 6e61 6d65 2872 6f69 5f64 6174 615f  irname(roi_data_
+00009e20: 6469 7229 290a 2020 2020 2020 2020 2020  dir)).          
+00009e30: 2020 6f73 2e6d 6b64 6972 2874 6d70 290a    os.mkdir(tmp).
+00009e40: 2020 2020 2020 2020 2020 2020 7368 7574              shut
+00009e50: 696c 2e6d 6f76 6528 636f 6e76 5f64 6972  il.move(conv_dir
+00009e60: 2c20 6f73 2e70 6174 682e 6a6f 696e 2874  , os.path.join(t
+00009e70: 6d70 2c20 2263 6f6e 7652 4f49 5f42 4f4c  mp, "convROI_BOL
+00009e80: 4422 2929 0a20 2020 2020 2020 2020 2020  D")).           
+00009e90: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+00009ea0: 2020 2020 2020 2020 275c 6e43 6f6e 7652          '\nConvR
+00009eb0: 4f49 2062 7269 636b 3a5c 6e41 2022 7b7d  OI brick:\nA "{}
+00009ec0: 2220 666f 6c64 6572 2061 6c72 6561 6479  " folder already
+00009ed0: 2065 7869 7374 732c 2027 0a20 2020 2020   exists, '.     
+00009ee0: 2020 2020 2020 2020 2020 2022 6974 2077             "it w
+00009ef0: 696c 6c20 6265 206f 7665 7277 7269 7474  ill be overwritt
+00009f00: 656e 2062 7920 7468 6973 206e 6577 2022  en by this new "
+00009f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009f20: 2022 6361 6c63 756c 6174 696f 6e2e 2e2e   "calculation...
+00009f30: 222e 666f 726d 6174 2863 6f6e 765f 6469  ".format(conv_di
+00009f40: 7229 0a20 2020 2020 2020 2020 2020 2029  r).            )
+00009f50: 0a20 2020 2020 2020 206f 732e 6d6b 6469  .        os.mkdi
+00009f60: 7228 636f 6e76 5f64 6972 290a 0a20 2020  r(conv_dir)..   
+00009f70: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00009f80: 6973 6469 7228 746d 7029 3a0a 2020 2020  isdir(tmp):.    
+00009f90: 2020 2020 2020 2020 7368 7574 696c 2e72          shutil.r
+00009fa0: 6d74 7265 6528 746d 7029 0a0a 2020 2020  mtree(tmp)..    
+00009fb0: 2020 2020 2320 5265 7361 6d70 6c65 2074      # Resample t
+00009fc0: 6865 2069 6d61 6765 735f 746f 5f63 6f6e  he images_to_con
+00009fd0: 766f 6c76 6520 746f 2074 6865 2073 697a  volve to the siz
+00009fe0: 6520 6f66 2063 6f6e 766f 6c76 655f 7769  e of convolve_wi
+00009ff0: 7468 2c20 7468 656e 0a20 2020 2020 2020  th, then.       
+0000a000: 2023 2063 6f6e 766f 6c76 6520 6561 6368   # convolve each
+0000a010: 2072 6573 697a 6564 2069 6d61 6765 735f   resized images_
+0000a020: 746f 5f63 6f6e 766f 6c76 6520 7769 7468  to_convolve with
+0000a030: 2063 6f6e 766f 6c76 655f 7769 7468 2061   convolve_with a
+0000a040: 740a 2020 2020 2020 2020 2320 7468 7265  t.        # thre
+0000a050: 7368 6f6c 6420 302e 350a 2020 2020 2020  shold 0.5.      
+0000a060: 2020 6d61 736b 5f69 6d67 203d 206e 6962    mask_img = nib
+0000a070: 2e6c 6f61 6428 7365 6c66 2e63 6f6e 766f  .load(self.convo
+0000a080: 6c76 655f 7769 7468 290a 2020 2020 2020  lve_with).      
+0000a090: 2020 6d61 736b 5f64 6174 6120 3d20 6d61    mask_data = ma
+0000a0a0: 736b 5f69 6d67 2e67 6574 5f66 6461 7461  sk_img.get_fdata
+0000a0b0: 2829 0a20 2020 2020 2020 2074 6872 6573  ().        thres
+0000a0c0: 203d 2030 2e35 0a0a 2020 2020 2020 2020   = 0.5..        
+0000a0d0: 666f 7220 726f 695f 6669 6c65 2069 6e20  for roi_file in 
+0000a0e0: 7365 6c66 2e69 6d61 6765 735f 746f 5f63  self.images_to_c
+0000a0f0: 6f6e 766f 6c76 653a 0a20 2020 2020 2020  onvolve:.       
+0000a100: 2020 2020 2072 6f69 5f69 6d67 203d 206e       roi_img = n
+0000a110: 6962 2e6c 6f61 6428 726f 695f 6669 6c65  ib.load(roi_file
+0000a120: 290a 2020 2020 2020 2020 2020 2020 726f  ).            ro
+0000a130: 695f 6461 7461 5f72 6573 616d 706c 6564  i_data_resampled
+0000a140: 203d 2072 6573 616d 706c 655f 746f 5f69   = resample_to_i
+0000a150: 6d67 280a 2020 2020 2020 2020 2020 2020  mg(.            
+0000a160: 2020 2020 726f 695f 696d 672c 206d 6173      roi_img, mas
+0000a170: 6b5f 696d 672c 2069 6e74 6572 706f 6c61  k_img, interpola
+0000a180: 7469 6f6e 3d22 6c69 6e65 6172 220a 2020  tion="linear".  
+0000a190: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000a1a0: 2020 2020 2020 2020 6669 6e61 6c5f 6461          final_da
+0000a1b0: 7461 203d 2072 6f69 5f64 6174 615f 7265  ta = roi_data_re
+0000a1c0: 7361 6d70 6c65 642e 6765 745f 6664 6174  sampled.get_fdat
+0000a1d0: 6128 292e 6173 7479 7065 286e 702e 666c  a().astype(np.fl
+0000a1e0: 6f61 7433 3229 0a20 2020 2020 2020 2020  oat32).         
+0000a1f0: 2020 2072 6573 756c 745f 6461 7461 203d     result_data =
+0000a200: 206e 702e 7768 6572 6528 6d61 736b 5f64   np.where(mask_d
+0000a210: 6174 6120 3e20 7468 7265 732c 2066 696e  ata > thres, fin
+0000a220: 616c 5f64 6174 612c 2030 290a 2020 2020  al_data, 0).    
+0000a230: 2020 2020 2020 2020 7265 7375 6c74 5f69          result_i
+0000a240: 6d67 203d 206e 6962 2e4e 6966 7469 3149  mg = nib.Nifti1I
+0000a250: 6d61 6765 280a 2020 2020 2020 2020 2020  mage(.          
+0000a260: 2020 2020 2020 7265 7375 6c74 5f64 6174        result_dat
+0000a270: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+0000a280: 2020 2072 6f69 5f64 6174 615f 7265 7361     roi_data_resa
+0000a290: 6d70 6c65 642e 6166 6669 6e65 2c0a 2020  mpled.affine,.  
+0000a2a0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+0000a2b0: 695f 6461 7461 5f72 6573 616d 706c 6564  i_data_resampled
+0000a2c0: 2e68 6561 6465 722c 0a20 2020 2020 2020  .header,.       
+0000a2d0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000a2e0: 2020 2023 2049 6d61 6765 2073 6176 6520     # Image save 
+0000a2f0: 696e 2063 6f6e 765f 6469 720a 2020 2020  in conv_dir.    
+0000a300: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
+0000a310: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+0000a320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a330: 2063 6f6e 765f 6469 722c 2073 656c 662e   conv_dir, self.
+0000a340: 7072 6566 6978 202b 206f 732e 7061 7468  prefix + os.path
+0000a350: 2e62 6173 656e 616d 6528 726f 695f 6669  .basename(roi_fi
+0000a360: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+0000a370: 290a 2020 2020 2020 2020 2020 2020 6e69  ).            ni
+0000a380: 622e 7361 7665 2872 6573 756c 745f 696d  b.save(result_im
+0000a390: 672c 206f 7574 5f66 696c 6529 0a20 2020  g, out_file).   
+0000a3a0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0000a3b0: 7b30 7d20 7361 7665 6422 2e66 6f72 6d61  {0} saved".forma
+0000a3c0: 7428 6f75 745f 6669 6c65 2929 0a0a 0a63  t(out_file))...c
+0000a3d0: 6c61 7373 2045 6e68 616e 6365 2850 726f  lass Enhance(Pro
+0000a3e0: 6365 7373 4d49 4129 3a0a 2020 2020 2222  cessMIA):.    ""
+0000a3f0: 220a 2020 2020 2a49 6d61 6765 2065 6e68  ".    *Image enh
+0000a400: 616e 6369 6e67 2a0a 0a20 2020 2050 6c65  ancing*..    Ple
+0000a410: 6173 652c 2073 6565 2074 6865 2063 6f6d  ase, see the com
+0000a420: 706c 6574 6520 646f 6375 6d65 6e74 6174  plete documentat
+0000a430: 696f 6e20 666f 7220 7468 6520 6045 6e68  ion for the `Enh
+0000a440: 616e 6365 2062 7269 636b 0a20 2020 2069  ance brick.    i
+0000a450: 6e20 7468 6520 6d69 615f 7072 6f63 6573  n the mia_proces
+0000a460: 7365 7320 7765 6273 6974 650a 2020 2020  ses website.    
+0000a470: 3c68 7474 7073 3a2f 2f70 6f70 756c 7365  <https://populse
+0000a480: 2e67 6974 6875 622e 696f 2f6d 6961 5f70  .github.io/mia_p
+0000a490: 726f 6365 7373 6573 2f68 746d 6c2f 646f  rocesses/html/do
+0000a4a0: 6375 6d65 6e74 6174 696f 6e2f 6272 6963  cumentation/bric
+0000a4b0: 6b73 2f70 7265 7072 6f63 6573 732f 6f74  ks/preprocess/ot
+0000a4c0: 6865 722f 456e 6861 6e63 652e 6874 6d6c  her/Enhance.html
+0000a4d0: 3e60 5f0a 0a20 2020 2061 6461 7074 6564  >`_..    adapted
+0000a4e0: 2066 726f 6d3a 0a20 2020 2068 7474 7073   from:.    https
+0000a4f0: 3a2f 2f67 6974 6875 622e 636f 6d2f 6e69  ://github.com/ni
+0000a500: 7072 6570 732f 6d72 6971 632f 626c 6f62  preps/mriqc/blob
+0000a510: 2f32 322e 302e 362f 6d72 6971 632f 776f  /22.0.6/mriqc/wo
+0000a520: 726b 666c 6f77 732f 616e 6174 6f6d 6963  rkflows/anatomic
+0000a530: 616c 2e70 7923 4c39 3734 0a0a 2020 2020  al.py#L974..    
+0000a540: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+0000a550: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
+0000a560: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
+0000a570: 6420 746f 2074 6865 2061 7474 7269 6275  d to the attribu
+0000a580: 7465 7320 696e 6974 6961 6c69 7361 7469  tes initialisati
+0000a590: 6f6e 202f 2069 6e73 7461 6e74 6961 7469  on / instantiati
+0000a5a0: 6f6e 2e0a 0a20 2020 2020 2020 2054 6865  on...        The
+0000a5b0: 2069 6e70 7574 2061 6e64 206f 7574 7075   input and outpu
+0000a5c0: 7420 706c 7567 7320 6172 6520 6465 6669  t plugs are defi
+0000a5d0: 6e65 6420 6865 7265 2e20 5468 6520 7370  ned here. The sp
+0000a5e0: 6563 6961 6c0a 2020 2020 2020 2020 2773  ecial.        's
+0000a5f0: 656c 662e 7265 7175 6972 656d 656e 7427  elf.requirement'
+0000a600: 2061 7474 7269 6275 7465 2028 6f70 7469   attribute (opti
+0000a610: 6f6e 616c 2920 6973 2075 7365 6420 746f  onal) is used to
+0000a620: 2064 6566 696e 6520 7468 650a 2020 2020   define the.    
+0000a630: 2020 2020 7468 6972 642d 7061 7274 7920      third-party 
+0000a640: 7072 6f64 7563 7473 206e 6563 6573 7361  products necessa
+0000a650: 7279 2066 6f72 2074 6865 2072 756e 6e69  ry for the runni
+0000a660: 6e67 206f 6620 7468 6520 6272 6963 6b2e  ng of the brick.
+0000a670: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000a680: 2020 2020 2023 2049 6e69 7469 616c 6973       # Initialis
+0000a690: 6174 696f 6e20 6f66 2074 6865 206f 626a  ation of the obj
+0000a6a0: 6563 7473 206e 6565 6465 6420 666f 7220  ects needed for 
+0000a6b0: 7468 6520 6c61 756e 6368 206f 6620 7468  the launch of th
+0000a6c0: 6520 6272 6963 6b0a 2020 2020 2020 2020  e brick.        
+0000a6d0: 7375 7065 7228 456e 6861 6e63 652c 2073  super(Enhance, s
+0000a6e0: 656c 6629 2e5f 5f69 6e69 745f 5f28 290a  elf).__init__().
+0000a6f0: 0a20 2020 2020 2020 2023 2054 6869 7264  .        # Third
+0000a700: 2070 6172 7479 2073 6f66 7477 6172 6573   party softwares
+0000a710: 2072 6571 7569 7265 6420 666f 7220 7468   required for th
+0000a720: 6520 6578 6563 7574 696f 6e20 6f66 2074  e execution of t
+0000a730: 6865 2062 7269 636b 0a20 2020 2020 2020  he brick.       
+0000a740: 2073 656c 662e 7265 7175 6972 656d 656e   self.requiremen
+0000a750: 7420 3d20 5b5d 0a0a 2020 2020 2020 2020  t = []..        
+0000a760: 2320 496e 7075 7473 2064 6573 6372 6970  # Inputs descrip
+0000a770: 7469 6f6e 0a20 2020 2020 2020 2069 6e5f  tion.        in_
+0000a780: 6669 6c65 735f 6465 7363 203d 2028 0a20  files_desc = (. 
+0000a790: 2020 2020 2020 2020 2020 2022 4120 6c69             "A li
+0000a7a0: 7374 206f 6620 6974 656d 7320 7769 7468  st of items with
+0000a7b0: 2073 7472 696e 6720 656c 656d 656e 7473   string elements
+0000a7c0: 2063 6f72 7265 7370 6f6e 6469 6e67 2022   corresponding "
+0000a7d0: 0a20 2020 2020 2020 2020 2020 2022 746f  .            "to
+0000a7e0: 2065 7869 7374 696e 6720 7061 7468 2066   existing path f
+0000a7f0: 696c 6573 2e22 0a20 2020 2020 2020 2029  iles.".        )
+0000a800: 0a20 2020 2020 2020 2070 7265 6669 785f  .        prefix_
+0000a810: 6465 7363 203d 2022 5072 6566 6978 206f  desc = "Prefix o
+0000a820: 6620 7468 6520 6f75 7470 7574 2069 6d61  f the output ima
+0000a830: 6765 2028 6120 7374 7269 6e67 292e 220a  ge (a string).".
+0000a840: 2020 2020 2020 2020 7375 6666 6978 5f64          suffix_d
+0000a850: 6573 6320 3d20 2253 7566 6669 7820 6f66  esc = "Suffix of
+0000a860: 2074 6865 206f 7574 7075 7420 696d 6167   the output imag
+0000a870: 6520 2861 2073 7472 696e 6729 2e22 0a0a  e (a string)."..
+0000a880: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
+0000a890: 7320 6465 7363 7269 7074 696f 6e0a 2020  s description.  
+0000a8a0: 2020 2020 2020 6f75 745f 6669 6c65 735f        out_files_
+0000a8b0: 6465 7363 203d 2028 0a20 2020 2020 2020  desc = (.       
+0000a8c0: 2020 2020 2022 5061 7468 206f 6620 7468       "Path of th
+0000a8d0: 6520 7363 616e 2061 6674 6572 2065 6e68  e scan after enh
+0000a8e0: 616e 6369 6e67 2022 0a20 2020 2020 2020  ancing ".       
+0000a8f0: 2020 2020 2022 2861 2070 6174 686c 696b       "(a pathlik
+0000a900: 6520 6f62 6a65 6374 206f 7220 7374 7269  e object or stri
+0000a910: 6e67 2072 6570 7265 7365 6e74 696e 6720  ng representing 
+0000a920: 6120 6669 6c65 2c20 6f72 2022 0a20 2020  a file, or ".   
+0000a930: 2020 2020 2020 2020 2022 6120 6c69 7374           "a list
+0000a940: 206f 6620 7061 7468 6c69 6b65 206f 626a   of pathlike obj
+0000a950: 6563 7473 206f 7220 7374 7269 6e67 7320  ects or strings 
+0000a960: 7265 7072 6573 656e 7469 6e67 2061 2022  representing a "
+0000a970: 0a20 2020 2020 2020 2020 2020 2022 6669  .            "fi
+0000a980: 6c65 292e 220a 2020 2020 2020 2020 290a  le).".        ).
+0000a990: 0a20 2020 2020 2020 2023 2049 6e70 7574  .        # Input
+0000a9a0: 7320 7472 6169 7473 0a20 2020 2020 2020  s traits.       
+0000a9b0: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+0000a9c0: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
+0000a9d0: 5f66 696c 6573 222c 0a20 2020 2020 2020  _files",.       
+0000a9e0: 2020 2020 2049 6e70 7574 4d75 6c74 6950       InputMultiP
+0000a9f0: 6174 6828 0a20 2020 2020 2020 2020 2020  ath(.           
+0000aa00: 2020 2020 2074 7261 6974 732e 4569 7468       traits.Eith
+0000aa10: 6572 2846 696c 6528 292c 2074 7261 6974  er(File(), trait
+0000aa20: 732e 4c69 7374 2846 696c 6528 2929 292c  s.List(File())),
+0000aa30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aa40: 206f 7574 7075 743d 4661 6c73 652c 0a20   output=False,. 
+0000aa50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000aa60: 6573 633d 696e 5f66 696c 6573 5f64 6573  esc=in_files_des
+0000aa70: 632c 0a20 2020 2020 2020 2020 2020 2029  c,.            )
+0000aa80: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000aa90: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+0000aaa0: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+0000aab0: 2022 7072 6566 6978 222c 0a20 2020 2020   "prefix",.     
+0000aac0: 2020 2020 2020 2074 7261 6974 732e 5374         traits.St
+0000aad0: 7269 6e67 2822 222c 206f 7574 7075 743d  ring("", output=
+0000aae0: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+0000aaf0: 5472 7565 2c20 6465 7363 3d70 7265 6669  True, desc=prefi
+0000ab00: 785f 6465 7363 292c 0a20 2020 2020 2020  x_desc),.       
+0000ab10: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+0000ab20: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
+0000ab30: 2020 2020 2020 2020 2273 7566 6669 7822          "suffix"
+0000ab40: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
+0000ab50: 6169 7473 2e53 7472 696e 6728 0a20 2020  aits.String(.   
+0000ab60: 2020 2020 2020 2020 2020 2020 2022 5f65               "_e
+0000ab70: 6e68 222c 206f 7574 7075 743d 4661 6c73  nh", output=Fals
+0000ab80: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
+0000ab90: 2c20 6465 7363 3d73 7566 6669 785f 6465  , desc=suffix_de
+0000aba0: 7363 0a20 2020 2020 2020 2020 2020 2029  sc.            )
+0000abb0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000abc0: 2020 2020 2023 204f 7574 7075 7473 2074       # Outputs t
+0000abd0: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
+0000abe0: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
+0000abf0: 2020 2020 2020 2020 2020 226f 7574 5f66            "out_f
+0000ac00: 696c 6573 222c 0a20 2020 2020 2020 2020  iles",.         
+0000ac10: 2020 204f 7574 7075 744d 756c 7469 5061     OutputMultiPa
+0000ac20: 7468 2846 696c 6528 292c 206f 7574 7075  th(File(), outpu
+0000ac30: 743d 5472 7565 2c20 6465 7363 3d6f 7574  t=True, desc=out
+0000ac40: 5f66 696c 6573 5f64 6573 6329 2c0a 2020  _files_desc),.  
+0000ac50: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000ac60: 2073 656c 662e 696e 6974 5f64 6566 6175   self.init_defau
+0000ac70: 6c74 5f74 7261 6974 7328 290a 0a20 2020  lt_traits()..   
+0000ac80: 2064 6566 206c 6973 745f 6f75 7470 7574   def list_output
+0000ac90: 7328 7365 6c66 2c20 6973 5f70 6c75 6767  s(self, is_plugg
+0000aca0: 6564 3d4e 6f6e 6529 3a0a 2020 2020 2020  ed=None):.      
+0000acb0: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
+0000acc0: 6f20 7468 6520 696e 6974 6961 6c69 7361  o the initialisa
+0000acd0: 7469 6f6e 2073 7465 7020 6f66 2074 6865  tion step of the
+0000ace0: 2062 7269 636b 2e0a 0a20 2020 2020 2020   brick...       
+0000acf0: 2054 6865 206d 6169 6e20 6f62 6a65 6374   The main object
+0000ad00: 6976 6520 6f66 2074 6869 7320 6d65 7468  ive of this meth
+0000ad10: 6f64 2069 7320 746f 2070 726f 6475 6365  od is to produce
+0000ad20: 2074 6865 206f 7574 7075 7473 206f 6620   the outputs of 
+0000ad30: 7468 650a 2020 2020 2020 2020 6272 6963  the.        bric
+0000ad40: 6b73 2028 7365 6c66 2e6f 7574 7075 7473  ks (self.outputs
+0000ad50: 2920 616e 6420 7468 6520 6173 736f 6369  ) and the associ
+0000ad60: 6174 6564 2074 6167 7320 2873 656c 662e  ated tags (self.
+0000ad70: 696e 6865 7269 7461 6e63 655f 6469 6329  inheritance_dic)
+0000ad80: 2c0a 2020 2020 2020 2020 6966 2064 6566  ,.        if def
+0000ad90: 696e 6564 2068 6572 652e 2054 6f20 776f  ined here. To wo
+0000ada0: 726b 2070 726f 7065 726c 7920 7468 6973  rk properly this
+0000adb0: 206d 6574 686f 6420 6d75 7374 2072 6574   method must ret
+0000adc0: 7572 6e0a 2020 2020 2020 2020 7365 6c66  urn.        self
+0000add0: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
+0000ade0: 2829 206f 626a 6563 742e 0a0a 2020 2020  () object...    
+0000adf0: 2020 2020 3a70 6172 616d 2069 735f 706c      :param is_pl
+0000ae00: 7567 6765 643a 2074 6865 2073 7461 7465  ugged: the state
+0000ae10: 2c20 6c69 6e6b 6564 206f 7220 6e6f 742c  , linked or not,
+0000ae20: 206f 6620 7468 6520 706c 7567 732e 0a20   of the plugs.. 
+0000ae30: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
+0000ae40: 2061 2064 6963 7469 6f6e 6172 7920 7769   a dictionary wi
+0000ae50: 7468 2072 6571 7569 7265 6d65 6e74 2c20  th requirement, 
+0000ae60: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
+0000ae70: 7269 7461 6e63 655f 6469 6374 2e0a 2020  ritance_dict..  
+0000ae80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ae90: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
+0000aea0: 6865 7269 7461 6e63 6520 746f 2050 726f  heritance to Pro
+0000aeb0: 6365 7373 4d49 4120 636c 6173 732c 206c  cessMIA class, l
+0000aec0: 6973 745f 6f75 7470 7574 7320 6d65 7468  ist_outputs meth
+0000aed0: 6f64 0a20 2020 2020 2020 2073 7570 6572  od.        super
+0000aee0: 2845 6e68 616e 6365 2c20 7365 6c66 292e  (Enhance, self).
+0000aef0: 6c69 7374 5f6f 7574 7075 7473 2829 0a0a  list_outputs()..
+0000af00: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
+0000af10: 7320 6465 6669 6e69 7469 6f6e 0a20 2020  s definition.   
+0000af20: 2020 2020 2069 6620 7365 6c66 2e69 6e5f       if self.in_
+0000af30: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+0000af40: 2020 2066 696c 6573 5f6e 616d 6520 3d20     files_name = 
+0000af50: 7365 6c66 2e69 6e5f 6669 6c65 730a 0a20  self.in_files.. 
+0000af60: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
+0000af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af80: 286e 6f74 2073 656c 662e 7375 6666 6978  (not self.suffix
+0000af90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000afa0: 2020 6f72 2028 7365 6c66 2e73 7566 6669    or (self.suffi
+0000afb0: 782e 6973 7370 6163 6528 2929 0a20 2020  x.isspace()).   
+0000afc0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+0000afd0: 7365 6c66 2e73 7566 6669 7820 696e 205b  self.suffix in [
+0000afe0: 556e 6465 6669 6e65 642c 2022 3c75 6e64  Undefined, "<und
+0000aff0: 6566 696e 6564 3e22 5d0a 2020 2020 2020  efined>"].      
+0000b000: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0000b010: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
+0000b020: 6666 6978 203d 2022 2022 0a0a 2020 2020  ffix = " "..    
+0000b030: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+0000b040: 2020 2020 2020 2020 2020 2020 2028 6e6f               (no
+0000b050: 7420 7365 6c66 2e70 7265 6669 7829 0a20  t self.prefix). 
+0000b060: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000b070: 7220 2873 656c 662e 7072 6566 6978 2e69  r (self.prefix.i
+0000b080: 7373 7061 6365 2829 290a 2020 2020 2020  sspace()).      
+0000b090: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
+0000b0a0: 6c66 2e70 7265 6669 7820 696e 205b 556e  lf.prefix in [Un
+0000b0b0: 6465 6669 6e65 642c 2022 3c75 6e64 6566  defined, "<undef
+0000b0c0: 696e 6564 3e22 5d29 0a20 2020 2020 2020  ined>"]).       
+0000b0d0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0000b0e0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+0000b0f0: 6669 7820 3d20 2220 220a 0a20 2020 2020  fix = " "..     
+0000b100: 2020 2020 2020 2066 696c 6573 203d 205b         files = [
+0000b110: 5d0a 2020 2020 2020 2020 2020 2020 666c  ].            fl
+0000b120: 6167 203d 2054 7275 6520 2023 2049 6620  ag = True  # If 
+0000b130: 4661 6c73 652c 2073 7566 2f70 7265 6620  False, suf/pref 
+0000b140: 6368 6563 6b20 7769 6c6c 206e 6f74 2062  check will not b
+0000b150: 6520 7065 7266 6f72 6d65 6420 6c61 7465  e performed late
+0000b160: 720a 0a20 2020 2020 2020 2020 2020 2066  r..            f
+0000b170: 6f72 2066 696c 655f 6e61 6d65 3120 696e  or file_name1 in
+0000b180: 2066 696c 6573 5f6e 616d 653a 0a20 2020   files_name:.   
+0000b190: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0000b1a0: 6964 5f65 7874 2c20 696e 5f65 7874 2c20  id_ext, in_ext, 
+0000b1b0: 6669 6c65 4e61 6d65 203d 2063 6865 636b  fileName = check
+0000b1c0: 4669 6c65 4578 7428 6669 6c65 5f6e 616d  FileExt(file_nam
+0000b1d0: 6531 2c20 4558 5429 0a0a 2020 2020 2020  e1, EXT)..      
+0000b1e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000b1f0: 2076 616c 6964 5f65 7874 3a0a 2020 2020   valid_ext:.    
+0000b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b210: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0000b220: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000b230: 5c6e 456e 6861 6e63 6520 6272 6963 6b3a  \nEnhance brick:
+0000b240: 2054 6865 2069 6e70 7574 2069 6d61 6765   The input image
+0000b250: 2066 6f72 6d61 7420 6973 206e 6f74 2022   format is not "
+0000b260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b270: 2020 2020 2020 2020 2022 7265 636f 676e           "recogn
+0000b280: 697a 6564 2e2e 2e21 220a 2020 2020 2020  ized...!".      
+0000b290: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2b0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+0000b2c0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+0000b2d0: 205f 203d 206f 732e 7061 7468 2e73 706c   _ = os.path.spl
+0000b2e0: 6974 2866 696c 655f 6e61 6d65 3129 0a0a  it(file_name1)..
+0000b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b300: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+0000b310: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
+0000b320: 6666 6978 203d 3d20 2220 220a 2020 2020  ffix == " ".    
+0000b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b340: 616e 6420 7365 6c66 2e70 7265 6669 7820  and self.prefix 
+0000b350: 3d3d 2022 2022 0a20 2020 2020 2020 2020  == " ".         
+0000b360: 2020 2020 2020 2020 2020 2061 6e64 2070             and p
+0000b370: 6174 6820 3d3d 2073 656c 662e 6f75 7470  ath == self.outp
+0000b380: 7574 5f64 6972 6563 746f 7279 0a20 2020  ut_directory.   
+0000b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3a0: 2061 6e64 2066 6c61 6720 6973 2054 7275   and flag is Tru
+0000b3b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000b3c0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000b3d0: 2020 2020 2020 2020 206d 7367 203d 2051           msg = Q
+0000b3e0: 4d65 7373 6167 6542 6f78 2829 0a20 2020  MessageBox().   
+0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b400: 206d 7367 2e73 6574 4963 6f6e 2851 4d65   msg.setIcon(QMe
+0000b410: 7373 6167 6542 6f78 2e57 6172 6e69 6e67  ssageBox.Warning
+0000b420: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b430: 2020 2020 2020 6d73 672e 7365 7457 696e        msg.setWin
+0000b440: 646f 7754 6974 6c65 280a 2020 2020 2020  dowTitle(.      
+0000b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b460: 2020 226d 6961 5f70 726f 6365 7373 6573    "mia_processes
+0000b470: 202d 2045 6e68 616e 6365 2062 7269 636b   - Enhance brick
+0000b480: 2057 6172 6e69 6e67 2122 0a20 2020 2020   Warning!".     
+0000b490: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000b4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b4b0: 2020 2020 206d 7367 2e73 6574 5465 7874       msg.setText
+0000b4c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000b4d0: 2020 2020 2020 2020 2020 2253 7566 6669            "Suffi
+0000b4e0: 7820 616e 6420 7072 6566 6978 2069 6e70  x and prefix inp
+0000b4f0: 7574 2070 6172 616d 6574 6572 7320 6172  ut parameters ar
+0000b500: 6520 6e6f 7420 220a 2020 2020 2020 2020  e not ".        
+0000b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b520: 2264 6566 696e 6564 206f 7220 636f 6e73  "defined or cons
+0000b530: 6973 7420 6f6e 6c79 206f 6620 6f6e 6520  ist only of one 
+0000b540: 6f72 206d 6f72 6520 7768 6974 6520 220a  or more white ".
 0000b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b560: 2241 626f 7274 3f22 2e66 6f72 6d61 7428  "Abort?".format(
-0000b570: 6669 6c65 5f6e 616d 6531 290a 2020 2020  file_name1).    
-0000b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b590: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b5a0: 2020 2020 2020 6d73 672e 7365 7453 7461        msg.setSta
-0000b5b0: 6e64 6172 6442 7574 746f 6e73 280a 2020  ndardButtons(.  
-0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5d0: 2020 2020 2020 514d 6573 7361 6765 426f        QMessageBo
-0000b5e0: 782e 5965 730a 2020 2020 2020 2020 2020  x.Yes.          
-0000b5f0: 2020 2020 2020 2020 2020 2020 2020 7c20                | 
-0000b600: 514d 6573 7361 6765 426f 782e 5965 7354  QMessageBox.YesT
-0000b610: 6f41 6c6c 0a20 2020 2020 2020 2020 2020  oAll.           
-0000b620: 2020 2020 2020 2020 2020 2020 207c 2051               | Q
-0000b630: 4d65 7373 6167 6542 6f78 2e41 626f 7274  MessageBox.Abort
-0000b640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b650: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000b660: 2020 2020 2020 2020 2020 2072 6574 7661             retva
-0000b670: 6c20 3d20 6d73 672e 6578 6563 5f28 290a  l = msg.exec_().
-0000b680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b690: 2020 2020 2069 6620 7265 7476 616c 2021       if retval !
-0000b6a0: 3d20 514d 6573 7361 6765 426f 782e 4162  = QMessageBox.Ab
-0000b6b0: 6f72 743a 0a20 2020 2020 2020 2020 2020  ort:.           
-0000b6c0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000b6d0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0000b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6f0: 225c 6e45 6e68 616e 6365 2062 7269 636b  "\nEnhance brick
-0000b700: 2077 6172 6e69 6e67 3a20 7468 6520 6f75   warning: the ou
-0000b710: 745f 6669 6c65 7320 6f75 7470 7574 2022  t_files output "
-0000b720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b730: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
-0000b740: 7261 6d65 7465 7220 6973 2074 6865 2073  rameter is the s
-0000b750: 616d 6520 6173 2074 6865 2069 6e5f 6669  ame as the in_fi
-0000b760: 6c65 7320 696e 7075 7420 220a 2020 2020  les input ".    
-0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b780: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
-0000b790: 6572 2028 7375 6666 6978 2061 6e64 2070  er (suffix and p
-0000b7a0: 7265 6669 7820 6172 6520 6e6f 7420 6465  refix are not de
-0000b7b0: 6669 6e65 6429 3a22 0a20 2020 2020 2020  fined):".       
-0000b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7d0: 2020 2020 2022 5c6e 7b30 7d20 7769 6c6c       "\n{0} will
-0000b7e0: 2062 6520 6f76 6572 7772 6974 6564 202e   be overwrited .
-0000b7f0: 2e2e 222e 666f 726d 6174 2866 696c 655f  ..".format(file_
-0000b800: 6e61 6d65 3129 0a20 2020 2020 2020 2020  name1).         
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000b820: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b830: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
-0000b840: 7661 6c20 3d3d 2051 4d65 7373 6167 6542  val == QMessageB
-0000b850: 6f78 2e59 6573 546f 416c 6c3a 0a20 2020  ox.YesToAll:.   
-0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b870: 2020 2020 2020 2020 2066 6c61 6720 3d20           flag = 
-0000b880: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8a0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8c0: 2020 2020 2020 2020 2022 5c6e 456e 6861           "\nEnha
-0000b8d0: 6e63 6520 6272 6963 6b20 6272 6963 6b3a  nce brick brick:
-0000b8e0: 2059 6573 546f 416c 6c20 7365 6c65 6374   YesToAll select
-0000b8f0: 6564 203b 2022 0a20 2020 2020 2020 2020  ed ; ".         
-0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b910: 2020 2020 2020 2022 656e 6420 6f66 206f         "end of o
-0000b920: 7665 7277 7269 7465 2063 6865 636b 7320  verwrite checks 
-0000b930: 6f6e 2069 6e70 7574 2069 6d61 6765 7320  on input images 
-0000b940: 2e2e 2e22 0a20 2020 2020 2020 2020 2020  ...".           
-0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b960: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000b970: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000b560: 2020 2020 2020 2020 2273 7061 6365 732e          "spaces.
+0000b570: 5c6e 5468 6520 7b30 7d20 696e 7075 7420  \nThe {0} input 
+0000b580: 7061 7261 6d65 7465 7220 7769 6c6c 2062  parameter will b
+0000b590: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+0000b5a0: 2020 2020 2020 2020 2020 2020 226f 7665              "ove
+0000b5b0: 7277 7269 7474 656e 202e 2e2e 5c6e 2059  rwritten ...\n Y
+0000b5c0: 6573 206f 7220 220a 2020 2020 2020 2020  es or ".        
+0000b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5e0: 2241 626f 7274 3f22 2e66 6f72 6d61 7428  "Abort?".format(
+0000b5f0: 6669 6c65 5f6e 616d 6531 290a 2020 2020  file_name1).    
+0000b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b610: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b620: 2020 2020 2020 6d73 672e 7365 7453 7461        msg.setSta
+0000b630: 6e64 6172 6442 7574 746f 6e73 280a 2020  ndardButtons(.  
+0000b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b650: 2020 2020 2020 514d 6573 7361 6765 426f        QMessageBo
+0000b660: 782e 5965 730a 2020 2020 2020 2020 2020  x.Yes.          
+0000b670: 2020 2020 2020 2020 2020 2020 2020 7c20                | 
+0000b680: 514d 6573 7361 6765 426f 782e 5965 7354  QMessageBox.YesT
+0000b690: 6f41 6c6c 0a20 2020 2020 2020 2020 2020  oAll.           
+0000b6a0: 2020 2020 2020 2020 2020 2020 207c 2051               | Q
+0000b6b0: 4d65 7373 6167 6542 6f78 2e41 626f 7274  MessageBox.Abort
+0000b6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b6d0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000b6e0: 2020 2020 2020 2020 2020 2072 6574 7661             retva
+0000b6f0: 6c20 3d20 6d73 672e 6578 6563 5f28 290a  l = msg.exec_().
+0000b700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b710: 2020 2020 2069 6620 7265 7476 616c 2021       if retval !
+0000b720: 3d20 514d 6573 7361 6765 426f 782e 4162  = QMessageBox.Ab
+0000b730: 6f72 743a 0a20 2020 2020 2020 2020 2020  ort:.           
+0000b740: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000b750: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0000b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b770: 225c 6e45 6e68 616e 6365 2062 7269 636b  "\nEnhance brick
+0000b780: 2077 6172 6e69 6e67 3a20 7468 6520 6f75   warning: the ou
+0000b790: 745f 6669 6c65 7320 6f75 7470 7574 2022  t_files output "
+0000b7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b7b0: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
+0000b7c0: 7261 6d65 7465 7220 6973 2074 6865 2073  rameter is the s
+0000b7d0: 616d 6520 6173 2074 6865 2069 6e5f 6669  ame as the in_fi
+0000b7e0: 6c65 7320 696e 7075 7420 220a 2020 2020  les input ".    
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
+0000b810: 6572 2028 7375 6666 6978 2061 6e64 2070  er (suffix and p
+0000b820: 7265 6669 7820 6172 6520 6e6f 7420 6465  refix are not de
+0000b830: 6669 6e65 6429 3a22 0a20 2020 2020 2020  fined):".       
+0000b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b850: 2020 2020 2022 5c6e 7b30 7d20 7769 6c6c       "\n{0} will
+0000b860: 2062 6520 6f76 6572 7772 6974 6564 202e   be overwrited .
+0000b870: 2e2e 222e 666f 726d 6174 2866 696c 655f  ..".format(file_
+0000b880: 6e61 6d65 3129 0a20 2020 2020 2020 2020  name1).         
+0000b890: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000b8a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b8b0: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
+0000b8c0: 7661 6c20 3d3d 2051 4d65 7373 6167 6542  val == QMessageB
+0000b8d0: 6f78 2e59 6573 546f 416c 6c3a 0a20 2020  ox.YesToAll:.   
+0000b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8f0: 2020 2020 2020 2020 2066 6c61 6720 3d20           flag = 
+0000b900: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b920: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+0000b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b940: 2020 2020 2020 2020 2022 5c6e 456e 6861           "\nEnha
+0000b950: 6e63 6520 6272 6963 6b20 6272 6963 6b3a  nce brick brick:
+0000b960: 2059 6573 546f 416c 6c20 7365 6c65 6374   YesToAll select
+0000b970: 6564 203b 2022 0a20 2020 2020 2020 2020  ed ; ".         
 0000b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b990: 2020 2020 2066 696c 6573 5f6e 616d 6520       files_name 
-0000b9a0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0000b9b0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000b9c0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0000b990: 2020 2020 2020 2022 656e 6420 6f66 206f         "end of o
+0000b9a0: 7665 7277 7269 7465 2063 6865 636b 7320  verwrite checks 
+0000b9b0: 6f6e 2069 6e70 7574 2069 6d61 6765 7320  on input images 
+0000b9c0: 2e2e 2e22 0a20 2020 2020 2020 2020 2020  ...".           
 0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9e0: 225c 6e45 6e68 616e 6365 2062 7269 636b  "\nEnhance brick
-0000b9f0: 2062 7269 636b 3a20 4162 6f72 7465 6420   brick: Aborted 
-0000ba00: 3b20 506c 6561 7365 2063 6865 636b 2022  ; Please check "
-0000ba10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ba20: 2020 2020 2020 2020 2020 2020 2022 796f               "yo
-0000ba30: 7572 2069 6e70 7574 2070 6172 616d 6574  ur input paramet
-0000ba40: 6572 7320 2e2e 2e22 0a20 2020 2020 2020  ers ...".       
+0000b9e0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000b9f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba10: 2020 2020 2066 696c 6573 5f6e 616d 6520       files_name 
+0000ba20: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0000ba30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000ba40: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
 0000ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba60: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000ba70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000ba80: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
-0000ba90: 2020 2066 696c 6573 2e61 7070 656e 6428     files.append(
-0000baa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bab0: 2020 2020 206f 732e 7061 7468 2e6a 6f69       os.path.joi
-0000bac0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0000bad0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000bae0: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
-0000baf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bb00: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-0000bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb20: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-0000bb30: 6669 782e 7374 7269 7028 290a 2020 2020  fix.strip().    
-0000bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb50: 2020 2020 2020 2020 2b20 6669 6c65 4e61          + fileNa
-0000bb60: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0000bb70: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000bb80: 2073 656c 662e 7375 6666 6978 2e73 7472   self.suffix.str
-0000bb90: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
-0000bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbb0: 202b 2022 2e22 0a20 2020 2020 2020 2020   + ".".         
+0000ba60: 225c 6e45 6e68 616e 6365 2062 7269 636b  "\nEnhance brick
+0000ba70: 2062 7269 636b 3a20 4162 6f72 7465 6420   brick: Aborted 
+0000ba80: 3b20 506c 6561 7365 2063 6865 636b 2022  ; Please check "
+0000ba90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000baa0: 2020 2020 2020 2020 2020 2020 2022 796f               "yo
+0000bab0: 7572 2069 6e70 7574 2070 6172 616d 6574  ur input paramet
+0000bac0: 6572 7320 2e2e 2e22 0a20 2020 2020 2020  ers ...".       
+0000bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bae0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000baf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000bb00: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+0000bb10: 2020 2066 696c 6573 2e61 7070 656e 6428     files.append(
+0000bb20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bb30: 2020 2020 206f 732e 7061 7468 2e6a 6f69       os.path.joi
+0000bb40: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+0000bb50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000bb60: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
+0000bb70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000bb80: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+0000bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bba0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+0000bbb0: 6669 782e 7374 7269 7028 290a 2020 2020  fix.strip().    
 0000bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbd0: 2020 202b 2069 6e5f 6578 740a 2020 2020     + in_ext.    
-0000bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbf0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-0000bc00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000bc10: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0000bc20: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0000bc30: 696c 6573 5f6e 616d 653a 0a20 2020 2020  iles_name:.     
-0000bc40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000bc50: 6f75 7470 7574 735b 226f 7574 5f66 696c  outputs["out_fil
-0000bc60: 6573 225d 203d 2066 696c 6573 0a0a 2020  es"] = files..  
-0000bc70: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc90: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0000bca0: 2020 2020 2020 2020 2020 2022 2d20 456e             "- En
-0000bcb0: 6861 6e63 6520 6272 6963 6b3a 2054 6865  hance brick: The
-0000bcc0: 7265 2077 6173 206e 6f20 6f75 7470 7574  re was no output
-0000bcd0: 2066 696c 6520 6465 6475 6374 6564 2022   file deducted "
-0000bce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bcf0: 2020 2020 2022 6475 7269 6e67 2069 6e69       "during ini
-0000bd00: 7469 616c 6973 6174 696f 6e2e 2050 6c65  tialisation. Ple
-0000bd10: 6173 6520 6368 6563 6b20 7468 6520 696e  ase check the in
-0000bd20: 7075 7420 220a 2020 2020 2020 2020 2020  put ".          
-0000bd30: 2020 2020 2020 2020 2020 2270 6172 616d            "param
-0000bd40: 6574 6572 732e 2e2e 2122 0a20 2020 2020  eters...!".     
-0000bd50: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000bd60: 2020 2020 2020 2320 7461 6773 2069 6e68        # tags inh
-0000bd70: 6572 6974 616e 6365 2028 6f70 7469 6f6e  eritance (option
-0000bd80: 616c 290a 2020 2020 2020 2020 6966 2073  al).        if s
-0000bd90: 656c 662e 6f75 7470 7574 733a 0a20 2020  elf.outputs:.   
-0000bda0: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
-0000bdb0: 2c20 7661 6c20 696e 2073 656c 662e 6f75  , val in self.ou
-0000bdc0: 7470 7574 732e 6974 656d 7328 293a 0a20  tputs.items():. 
-0000bdd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000bde0: 6620 6b65 7920 3d3d 2022 6f75 745f 6669  f key == "out_fi
-0000bdf0: 6c65 7322 3a0a 2020 2020 2020 2020 2020  les":.          
-0000be00: 2020 2020 2020 2020 2020 666f 7220 696e            for in
-0000be10: 5f76 616c 2c20 6f75 745f 7661 6c20 696e  _val, out_val in
-0000be20: 207a 6970 2866 696c 6573 5f6e 616d 652c   zip(files_name,
-0000be30: 2076 616c 293a 0a20 2020 2020 2020 2020   val):.         
-0000be40: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000be50: 2c20 6669 6c65 4f76 616c 203d 206f 732e  , fileOval = os.
-0000be60: 7061 7468 2e73 706c 6974 286f 7574 5f76  path.split(out_v
-0000be70: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-0000be80: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000be90: 4f76 616c 5f6e 6f5f 6578 742c 2066 696c  Oval_no_ext, fil
-0000bea0: 655f 6578 7465 6e73 696f 6e20 3d20 6f73  e_extension = os
-0000beb0: 2e70 6174 682e 7370 6c69 7465 7874 280a  .path.splitext(.
-0000bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bed0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000bee0: 4f76 616c 0a20 2020 2020 2020 2020 2020  Oval.           
-0000bef0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf10: 2020 2020 2020 2069 6620 6669 6c65 5f65         if file_e
-0000bf20: 7874 656e 7369 6f6e 203d 3d20 222e 677a  xtension == ".gz
-0000bf30: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0000bf40: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000bf50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf70: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
-0000bf80: 5f32 2c0a 2020 2020 2020 2020 2020 2020  _2,.            
-0000bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfa0: 2020 2020 6669 6c65 5f65 7874 656e 7369      file_extensi
-0000bfb0: 6f6e 5f32 2c0a 2020 2020 2020 2020 2020  on_2,.          
-0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfd0: 2020 2920 3d20 6f73 2e70 6174 682e 7370    ) = os.path.sp
-0000bfe0: 6c69 7465 7874 2866 696c 654f 7661 6c5f  litext(fileOval_
-0000bff0: 6e6f 5f65 7874 290a 2020 2020 2020 2020  no_ext).        
-0000c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c010: 2020 2020 6966 2066 696c 655f 6578 7465      if file_exte
-0000c020: 6e73 696f 6e5f 3220 3d3d 2022 2e6e 6969  nsion_2 == ".nii
-0000c030: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000bbd0: 2020 2020 2020 2020 2b20 6669 6c65 4e61          + fileNa
+0000bbe0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0000bbf0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000bc00: 2073 656c 662e 7375 6666 6978 2e73 7472   self.suffix.str
+0000bc10: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
+0000bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc30: 202b 2022 2e22 0a20 2020 2020 2020 2020   + ".".         
+0000bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc50: 2020 202b 2069 6e5f 6578 740a 2020 2020     + in_ext.    
+0000bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc70: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0000bc80: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000bc90: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+0000bca0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0000bcb0: 696c 6573 5f6e 616d 653a 0a20 2020 2020  iles_name:.     
+0000bcc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000bcd0: 6f75 7470 7574 735b 226f 7574 5f66 696c  outputs["out_fil
+0000bce0: 6573 225d 203d 2066 696c 6573 0a0a 2020  es"] = files..  
+0000bcf0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd10: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0000bd20: 2020 2020 2020 2020 2020 2022 2d20 456e             "- En
+0000bd30: 6861 6e63 6520 6272 6963 6b3a 2054 6865  hance brick: The
+0000bd40: 7265 2077 6173 206e 6f20 6f75 7470 7574  re was no output
+0000bd50: 2066 696c 6520 6465 6475 6374 6564 2022   file deducted "
+0000bd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bd70: 2020 2020 2022 6475 7269 6e67 2069 6e69       "during ini
+0000bd80: 7469 616c 6973 6174 696f 6e2e 2050 6c65  tialisation. Ple
+0000bd90: 6173 6520 6368 6563 6b20 7468 6520 696e  ase check the in
+0000bda0: 7075 7420 220a 2020 2020 2020 2020 2020  put ".          
+0000bdb0: 2020 2020 2020 2020 2020 2270 6172 616d            "param
+0000bdc0: 6574 6572 732e 2e2e 2122 0a20 2020 2020  eters...!".     
+0000bdd0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000bde0: 2020 2020 2020 2320 7461 6773 2069 6e68        # tags inh
+0000bdf0: 6572 6974 616e 6365 2028 6f70 7469 6f6e  eritance (option
+0000be00: 616c 290a 2020 2020 2020 2020 6966 2073  al).        if s
+0000be10: 656c 662e 6f75 7470 7574 733a 0a20 2020  elf.outputs:.   
+0000be20: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+0000be30: 2c20 7661 6c20 696e 2073 656c 662e 6f75  , val in self.ou
+0000be40: 7470 7574 732e 6974 656d 7328 293a 0a20  tputs.items():. 
+0000be50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000be60: 6620 6b65 7920 3d3d 2022 6f75 745f 6669  f key == "out_fi
+0000be70: 6c65 7322 3a0a 2020 2020 2020 2020 2020  les":.          
+0000be80: 2020 2020 2020 2020 2020 666f 7220 696e            for in
+0000be90: 5f76 616c 2c20 6f75 745f 7661 6c20 696e  _val, out_val in
+0000bea0: 207a 6970 2866 696c 6573 5f6e 616d 652c   zip(files_name,
+0000beb0: 2076 616c 293a 0a20 2020 2020 2020 2020   val):.         
+0000bec0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0000bed0: 2c20 6669 6c65 4f76 616c 203d 206f 732e  , fileOval = os.
+0000bee0: 7061 7468 2e73 706c 6974 286f 7574 5f76  path.split(out_v
+0000bef0: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+0000bf00: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000bf10: 4f76 616c 5f6e 6f5f 6578 742c 2066 696c  Oval_no_ext, fil
+0000bf20: 655f 6578 7465 6e73 696f 6e20 3d20 6f73  e_extension = os
+0000bf30: 2e70 6174 682e 7370 6c69 7465 7874 280a  .path.splitext(.
+0000bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf50: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000bf60: 4f76 616c 0a20 2020 2020 2020 2020 2020  Oval.           
+0000bf70: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf90: 2020 2020 2020 2069 6620 6669 6c65 5f65         if file_e
+0000bfa0: 7874 656e 7369 6f6e 203d 3d20 222e 677a  xtension == ".gz
+0000bfb0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000bfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bff0: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
+0000c000: 5f32 2c0a 2020 2020 2020 2020 2020 2020  _2,.            
+0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c020: 2020 2020 6669 6c65 5f65 7874 656e 7369      file_extensi
+0000c030: 6f6e 5f32 2c0a 2020 2020 2020 2020 2020  on_2,.          
 0000c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c050: 2020 2066 696c 654f 7661 6c5f 6e6f 5f65     fileOval_no_e
-0000c060: 7874 203d 2066 696c 654f 7661 6c5f 6e6f  xt = fileOval_no
-0000c070: 5f65 7874 5f32 0a0a 2020 2020 2020 2020  _ext_2..        
+0000c050: 2020 2920 3d20 6f73 2e70 6174 682e 7370    ) = os.path.sp
+0000c060: 6c69 7465 7874 2866 696c 654f 7661 6c5f  litext(fileOval_
+0000c070: 6e6f 5f65 7874 290a 2020 2020 2020 2020  no_ext).        
 0000c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c090: 5f2c 2066 696c 6549 7661 6c20 3d20 6f73  _, fileIval = os
-0000c0a0: 2e70 6174 682e 7370 6c69 7428 696e 5f76  .path.split(in_v
-0000c0b0: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-0000c0c0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000c0d0: 4976 616c 5f6e 6f5f 6578 742c 2066 696c  Ival_no_ext, fil
-0000c0e0: 655f 6578 7465 6e73 696f 6e20 3d20 6f73  e_extension = os
-0000c0f0: 2e70 6174 682e 7370 6c69 7465 7874 280a  .path.splitext(.
+0000c090: 2020 2020 6966 2066 696c 655f 6578 7465      if file_exte
+0000c0a0: 6e73 696f 6e5f 3220 3d3d 2022 2e6e 6969  nsion_2 == ".nii
+0000c0b0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0d0: 2020 2066 696c 654f 7661 6c5f 6e6f 5f65     fileOval_no_e
+0000c0e0: 7874 203d 2066 696c 654f 7661 6c5f 6e6f  xt = fileOval_no
+0000c0f0: 5f65 7874 5f32 0a0a 2020 2020 2020 2020  _ext_2..        
 0000c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c110: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000c120: 4976 616c 0a20 2020 2020 2020 2020 2020  Ival.           
-0000c130: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c150: 2020 2020 2020 2069 6620 6669 6c65 5f65         if file_e
-0000c160: 7874 656e 7369 6f6e 203d 3d20 222e 677a  xtension == ".gz
-0000c170: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0000c180: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000c190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1b0: 2066 696c 6549 7661 6c5f 6e6f 5f65 7874   fileIval_no_ext
-0000c1c0: 5f32 2c0a 2020 2020 2020 2020 2020 2020  _2,.            
-0000c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1e0: 2020 2020 6669 6c65 5f65 7874 656e 7369      file_extensi
-0000c1f0: 6f6e 5f32 2c0a 2020 2020 2020 2020 2020  on_2,.          
-0000c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c210: 2020 2920 3d20 6f73 2e70 6174 682e 7370    ) = os.path.sp
-0000c220: 6c69 7465 7874 2866 696c 6549 7661 6c5f  litext(fileIval_
-0000c230: 6e6f 5f65 7874 290a 2020 2020 2020 2020  no_ext).        
-0000c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c250: 2020 2020 6966 2066 696c 655f 6578 7465      if file_exte
-0000c260: 6e73 696f 6e5f 3220 3d3d 2022 2e6e 6969  nsion_2 == ".nii
-0000c270: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000c110: 5f2c 2066 696c 6549 7661 6c20 3d20 6f73  _, fileIval = os
+0000c120: 2e70 6174 682e 7370 6c69 7428 696e 5f76  .path.split(in_v
+0000c130: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+0000c140: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000c150: 4976 616c 5f6e 6f5f 6578 742c 2066 696c  Ival_no_ext, fil
+0000c160: 655f 6578 7465 6e73 696f 6e20 3d20 6f73  e_extension = os
+0000c170: 2e70 6174 682e 7370 6c69 7465 7874 280a  .path.splitext(.
+0000c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c190: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000c1a0: 4976 616c 0a20 2020 2020 2020 2020 2020  Ival.           
+0000c1b0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1d0: 2020 2020 2020 2069 6620 6669 6c65 5f65         if file_e
+0000c1e0: 7874 656e 7369 6f6e 203d 3d20 222e 677a  xtension == ".gz
+0000c1f0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000c200: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000c210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c230: 2066 696c 6549 7661 6c5f 6e6f 5f65 7874   fileIval_no_ext
+0000c240: 5f32 2c0a 2020 2020 2020 2020 2020 2020  _2,.            
+0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c260: 2020 2020 6669 6c65 5f65 7874 656e 7369      file_extensi
+0000c270: 6f6e 5f32 2c0a 2020 2020 2020 2020 2020  on_2,.          
 0000c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c290: 2020 2066 696c 6549 7661 6c5f 6e6f 5f65     fileIval_no_e
-0000c2a0: 7874 203d 2066 696c 6549 7661 6c5f 6e6f  xt = fileIval_no
-0000c2b0: 5f65 7874 5f32 0a0a 2020 2020 2020 2020  _ext_2..        
+0000c290: 2020 2920 3d20 6f73 2e70 6174 682e 7370    ) = os.path.sp
+0000c2a0: 6c69 7465 7874 2866 696c 6549 7661 6c5f  litext(fileIval_
+0000c2b0: 6e6f 5f65 7874 290a 2020 2020 2020 2020  no_ext).        
 0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2d0: 6966 2028 7365 6c66 2e70 7265 6669 7829  if (self.prefix)
-0000c2e0: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
-0000c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c300: 2020 2066 696c 654f 7661 6c5f 6e6f 5f65     fileOval_no_e
-0000c310: 7874 2e73 7461 7274 7377 6974 6828 7365  xt.startswith(se
-0000c320: 6c66 2e70 7265 6669 7829 0a20 2020 2020  lf.prefix).     
-0000c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c340: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-0000c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c360: 2020 2320 666d 743a 206f 6666 0a20 2020    # fmt: off.   
+0000c2d0: 2020 2020 6966 2066 696c 655f 6578 7465      if file_exte
+0000c2e0: 6e73 696f 6e5f 3220 3d3d 2022 2e6e 6969  nsion_2 == ".nii
+0000c2f0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c310: 2020 2066 696c 6549 7661 6c5f 6e6f 5f65     fileIval_no_e
+0000c320: 7874 203d 2066 696c 6549 7661 6c5f 6e6f  xt = fileIval_no
+0000c330: 5f65 7874 5f32 0a0a 2020 2020 2020 2020  _ext_2..        
+0000c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c350: 6966 2028 7365 6c66 2e70 7265 6669 7829  if (self.prefix)
+0000c360: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
 0000c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c380: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
-0000c390: 6c5f 6e6f 5f65 7874 203d 2066 696c 654f  l_no_ext = fileO
-0000c3a0: 7661 6c5f 6e6f 5f65 7874 5b6c 656e 280a  val_no_ext[len(.
+0000c380: 2020 2066 696c 654f 7661 6c5f 6e6f 5f65     fileOval_no_e
+0000c390: 7874 2e73 7461 7274 7377 6974 6828 7365  xt.startswith(se
+0000c3a0: 6c66 2e70 7265 6669 7829 0a20 2020 2020  lf.prefix).     
 0000c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3c0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
 0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000c3f0: 6c66 2e70 7265 6669 7829 3a5d 0a20 2020  lf.prefix):].   
-0000c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c410: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
-0000c420: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-0000c430: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
-0000c440: 656c 662e 7375 6666 6978 2920 616e 6420  elf.suffix) and 
-0000c450: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000c460: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000c470: 6c65 4f76 616c 5f6e 6f5f 6578 742e 656e  leOval_no_ext.en
-0000c480: 6473 7769 7468 2873 656c 662e 7375 6666  dswith(self.suff
-0000c490: 6978 290a 2020 2020 2020 2020 2020 2020  ix).            
-0000c4a0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4c0: 2020 2020 2020 2020 2020 2066 696c 654f             fileO
-0000c4d0: 7661 6c5f 6e6f 5f65 7874 203d 2066 696c  val_no_ext = fil
-0000c4e0: 654f 7661 6c5f 6e6f 5f65 7874 5b0a 2020  eOval_no_ext[.  
-0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c500: 2020 2020 2020 2020 2020 2020 2020 3a20                : 
-0000c510: 2d6c 656e 2873 656c 662e 7375 6666 6978  -len(self.suffix
-0000c520: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c530: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-0000c540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c550: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-0000c560: 4f76 616c 5f6e 6f5f 6578 7420 3d3d 2066  Oval_no_ext == f
-0000c570: 696c 6549 7661 6c5f 6e6f 5f65 7874 3a0a  ileIval_no_ext:.
-0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c5a0: 2e74 6167 735f 696e 6865 7269 7461 6e63  .tags_inheritanc
-0000c5b0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5d0: 2020 2069 6e5f 6669 6c65 3d69 6e5f 7661     in_file=in_va
-0000c5e0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-0000c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c600: 2020 206f 7574 5f66 696c 653d 6f75 745f     out_file=out_
-0000c610: 7661 6c2c 0a20 2020 2020 2020 2020 2020  val,.           
-0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c630: 2029 0a0a 2020 2020 2020 2020 2320 5265   )..        # Re
-0000c640: 7475 726e 2074 6865 2072 6571 7569 7265  turn the require
-0000c650: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
-0000c660: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
-0000c670: 6374 0a20 2020 2020 2020 2072 6574 7572  ct.        retur
-0000c680: 6e20 7365 6c66 2e6d 616b 655f 696e 6974  n self.make_init
-0000c690: 5265 7375 6c74 2829 0a0a 2020 2020 6465  Result()..    de
-0000c6a0: 6620 7275 6e5f 7072 6f63 6573 735f 6d69  f run_process_mi
-0000c6b0: 6128 7365 6c66 293a 0a20 2020 2020 2020  a(self):.       
-0000c6c0: 2022 2222 4465 6469 6361 7465 6420 746f   """Dedicated to
-0000c6d0: 2074 6865 2070 726f 6365 7373 206c 6175   the process lau
-0000c6e0: 6e63 6820 7374 6570 206f 6620 7468 6520  nch step of the 
-0000c6f0: 6272 6963 6b2e 2222 220a 2020 2020 2020  brick.""".      
-0000c700: 2020 7375 7065 7228 456e 6861 6e63 652c    super(Enhance,
-0000c710: 2073 656c 6629 2e72 756e 5f70 726f 6365   self).run_proce
-0000c720: 7373 5f6d 6961 2829 0a0a 2020 2020 2020  ss_mia()..      
-0000c730: 2020 6669 6c65 735f 6e61 6d65 203d 2073    files_name = s
-0000c740: 656c 662e 696e 5f66 696c 6573 0a0a 2020  elf.in_files..  
-0000c750: 2020 2020 2020 666f 7220 6669 6c65 5f6e        for file_n
-0000c760: 616d 6520 696e 2066 696c 6573 5f6e 616d  ame in files_nam
-0000c770: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-0000c780: 2049 6d61 6765 2070 726f 6365 7373 696e   Image processin
-0000c790: 670a 2020 2020 2020 2020 2020 2020 7472  g.            tr
-0000c7a0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000c7b0: 2020 2069 6d67 203d 206e 6962 2e6c 6f61     img = nib.loa
-0000c7c0: 6428 6669 6c65 5f6e 616d 6529 0a0a 2020  d(file_name)..  
-0000c7d0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000c7e0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0000c7f0: 2020 206e 6962 2e66 696c 6562 6173 6564     nib.filebased
-0000c800: 696d 6167 6573 2e49 6d61 6765 4669 6c65  images.ImageFile
-0000c810: 4572 726f 722c 0a20 2020 2020 2020 2020  Error,.         
-0000c820: 2020 2020 2020 2046 696c 654e 6f74 466f         FileNotFo
-0000c830: 756e 6445 7272 6f72 2c0a 2020 2020 2020  undError,.      
-0000c840: 2020 2020 2020 2020 2020 5479 7065 4572            TypeEr
-0000c850: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
-0000c860: 2029 2061 7320 653a 0a20 2020 2020 2020   ) as e:.       
-0000c870: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c890: 2020 2020 225c 6e45 6e68 616e 6365 2062      "\nEnhance b
-0000c8a0: 7269 636b 3a20 4572 726f 7220 7769 7468  rick: Error with
-0000c8b0: 2066 696c 6520 746f 2065 6e68 616e 6365   file to enhance
-0000c8c0: 2c20 6475 7269 6e67 2074 6865 2022 0a20  , during the ". 
-0000c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8e0: 2020 2022 7275 6e3a 2022 2c0a 2020 2020     "run: ",.    
-0000c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c900: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000c910: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000c920: 2020 2020 2069 6d67 203d 204e 6f6e 650a       img = None.
-0000c930: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c940: 696d 6720 6973 206e 6f74 204e 6f6e 653a  img is not None:
-0000c950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c960: 2064 6174 6120 3d20 696d 672e 6765 745f   data = img.get_
-0000c970: 6664 6174 6128 292e 6173 7479 7065 286e  fdata().astype(n
-0000c980: 702e 666c 6f61 7433 3229 0a20 2020 2020  p.float32).     
-0000c990: 2020 2020 2020 2020 2020 2072 616e 6765             range
-0000c9a0: 5f6d 6178 203d 206e 702e 7065 7263 656e  _max = np.percen
-0000c9b0: 7469 6c65 2864 6174 615b 6461 7461 203e  tile(data[data >
-0000c9c0: 2030 5d2c 2039 392e 3938 290a 2020 2020   0], 99.98).    
-0000c9d0: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
-0000c9e0: 655f 6d69 6e20 3d20 6e70 2e6d 6564 6961  e_min = np.media
-0000c9f0: 6e28 6461 7461 5b64 6174 6120 3e20 305d  n(data[data > 0]
-0000ca00: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000ca10: 2020 2023 2052 6573 616d 706c 6520 7369     # Resample si
-0000ca20: 676e 616c 2065 7863 6573 7320 7069 7865  gnal excess pixe
-0000ca30: 6c73 0a20 2020 2020 2020 2020 2020 2020  ls.             
-0000ca40: 2020 2065 7863 6573 7320 3d20 6e70 2e77     excess = np.w
-0000ca50: 6865 7265 2864 6174 6120 3e20 7261 6e67  here(data > rang
-0000ca60: 655f 6d61 7829 0a20 2020 2020 2020 2020  e_max).         
-0000ca70: 2020 2020 2020 2064 6174 615b 6578 6365         data[exce
-0000ca80: 7373 5d20 3d20 300a 2020 2020 2020 2020  ss] = 0.        
-0000ca90: 2020 2020 2020 2020 6461 7461 5b65 7863          data[exc
-0000caa0: 6573 735d 203d 206e 702e 7261 6e64 6f6d  ess] = np.random
-0000cab0: 2e63 686f 6963 6528 0a20 2020 2020 2020  .choice(.       
-0000cac0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0000cad0: 615b 6461 7461 203e 2072 616e 6765 5f6d  a[data > range_m
-0000cae0: 696e 5d2c 2073 697a 653d 6c65 6e28 6578  in], size=len(ex
-0000caf0: 6365 7373 5b30 5d29 0a20 2020 2020 2020  cess[0]).       
-0000cb00: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000cb10: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0000cb20: 696d 6167 6520 3d20 696d 672e 5f5f 636c  image = img.__cl
-0000cb30: 6173 735f 5f28 6461 7461 2c20 696d 672e  ass__(data, img.
-0000cb40: 6166 6669 6e65 2c20 696d 672e 6865 6164  affine, img.head
-0000cb50: 6572 290a 0a20 2020 2020 2020 2020 2020  er)..           
-0000cb60: 2020 2020 2023 2049 6d61 6765 2073 6176       # Image sav
-0000cb70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000cb80: 2020 5f2c 2066 696c 655f 6e61 6d65 203d    _, file_name =
-0000cb90: 206f 732e 7061 7468 2e73 706c 6974 2866   os.path.split(f
-0000cba0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
-0000cbb0: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
-0000cbc0: 616d 655f 6e6f 5f65 7874 2c20 6669 6c65  ame_no_ext, file
-0000cbd0: 5f65 7874 656e 7369 6f6e 203d 206f 732e  _extension = os.
-0000cbe0: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
-0000cbf0: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
-0000cc00: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-0000cc10: 5f65 7874 656e 7369 6f6e 203d 3d20 222e  _extension == ".
-0000cc20: 677a 223a 0a20 2020 2020 2020 2020 2020  gz":.           
-0000cc30: 2020 2020 2020 2020 2028 6669 6c65 5f6e           (file_n
-0000cc40: 616d 655f 6e6f 5f65 7874 5f32 2c20 6669  ame_no_ext_2, fi
-0000cc50: 6c65 5f65 7874 656e 7369 6f6e 5f32 2920  le_extension_2) 
-0000cc60: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
-0000cc70: 7874 280a 2020 2020 2020 2020 2020 2020  xt(.            
-0000cc80: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000cc90: 5f6e 616d 655f 6e6f 5f65 7874 0a20 2020  _name_no_ext.   
-0000cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ccb0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000ccc0: 2020 2020 2020 2069 6620 6669 6c65 5f65         if file_e
-0000ccd0: 7874 656e 7369 6f6e 5f32 203d 3d20 222e  xtension_2 == ".
-0000cce0: 6e69 6922 3a0a 2020 2020 2020 2020 2020  nii":.          
-0000ccf0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000cd00: 6c65 5f6e 616d 655f 6e6f 5f65 7874 203d  le_name_no_ext =
-0000cd10: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
-0000cd20: 745f 320a 2020 2020 2020 2020 2020 2020  t_2.            
-0000cd30: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000cd40: 5f65 7874 656e 7369 6f6e 203d 2022 2e6e  _extension = ".n
-0000cd50: 6969 2e67 7a22 0a0a 2020 2020 2020 2020  ii.gz"..        
-0000cd60: 2020 2020 2020 2020 6669 6c65 5f6f 7574          file_out
-0000cd70: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
-0000cd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cd90: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
-0000cda0: 5f64 6972 6563 746f 7279 2c0a 2020 2020  _directory,.    
-0000cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000cdd0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000cde0: 7265 6669 782e 7374 7269 7028 290a 2020  refix.strip().  
-0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce00: 2020 2020 2020 2b20 6669 6c65 5f6e 616d        + file_nam
-0000ce10: 655f 6e6f 5f65 7874 0a20 2020 2020 2020  e_no_ext.       
-0000ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce30: 202b 2073 656c 662e 7375 6666 6978 2e73   + self.suffix.s
-0000ce40: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-0000ce50: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000ce60: 2066 696c 655f 6578 7465 6e73 696f 6e0a   file_extension.
+0000c3e0: 2020 2320 666d 743a 206f 6666 0a20 2020    # fmt: off.   
+0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c400: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
+0000c410: 6c5f 6e6f 5f65 7874 203d 2066 696c 654f  l_no_ext = fileO
+0000c420: 7661 6c5f 6e6f 5f65 7874 5b6c 656e 280a  val_no_ext[len(.
+0000c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c460: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000c470: 6c66 2e70 7265 6669 7829 3a5d 0a20 2020  lf.prefix):].   
+0000c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c490: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
+0000c4a0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+0000c4b0: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+0000c4c0: 656c 662e 7375 6666 6978 2920 616e 6420  elf.suffix) and 
+0000c4d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000c4e0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000c4f0: 6c65 4f76 616c 5f6e 6f5f 6578 742e 656e  leOval_no_ext.en
+0000c500: 6473 7769 7468 2873 656c 662e 7375 6666  dswith(self.suff
+0000c510: 6978 290a 2020 2020 2020 2020 2020 2020  ix).            
+0000c520: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+0000c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c540: 2020 2020 2020 2020 2020 2066 696c 654f             fileO
+0000c550: 7661 6c5f 6e6f 5f65 7874 203d 2066 696c  val_no_ext = fil
+0000c560: 654f 7661 6c5f 6e6f 5f65 7874 5b0a 2020  eOval_no_ext[.  
+0000c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c580: 2020 2020 2020 2020 2020 2020 2020 3a20                : 
+0000c590: 2d6c 656e 2873 656c 662e 7375 6666 6978  -len(self.suffix
+0000c5a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+0000c5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c5d0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+0000c5e0: 4f76 616c 5f6e 6f5f 6578 7420 3d3d 2066  Oval_no_ext == f
+0000c5f0: 696c 6549 7661 6c5f 6e6f 5f65 7874 3a0a  ileIval_no_ext:.
+0000c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c610: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c620: 2e74 6167 735f 696e 6865 7269 7461 6e63  .tags_inheritanc
+0000c630: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c650: 2020 2069 6e5f 6669 6c65 3d69 6e5f 7661     in_file=in_va
+0000c660: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+0000c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c680: 2020 206f 7574 5f66 696c 653d 6f75 745f     out_file=out_
+0000c690: 7661 6c2c 0a20 2020 2020 2020 2020 2020  val,.           
+0000c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6b0: 2029 0a0a 2020 2020 2020 2020 2320 5265   )..        # Re
+0000c6c0: 7475 726e 2074 6865 2072 6571 7569 7265  turn the require
+0000c6d0: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
+0000c6e0: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
+0000c6f0: 6374 0a20 2020 2020 2020 2072 6574 7572  ct.        retur
+0000c700: 6e20 7365 6c66 2e6d 616b 655f 696e 6974  n self.make_init
+0000c710: 5265 7375 6c74 2829 0a0a 2020 2020 6465  Result()..    de
+0000c720: 6620 7275 6e5f 7072 6f63 6573 735f 6d69  f run_process_mi
+0000c730: 6128 7365 6c66 293a 0a20 2020 2020 2020  a(self):.       
+0000c740: 2022 2222 4465 6469 6361 7465 6420 746f   """Dedicated to
+0000c750: 2074 6865 2070 726f 6365 7373 206c 6175   the process lau
+0000c760: 6e63 6820 7374 6570 206f 6620 7468 6520  nch step of the 
+0000c770: 6272 6963 6b2e 2222 220a 2020 2020 2020  brick.""".      
+0000c780: 2020 7375 7065 7228 456e 6861 6e63 652c    super(Enhance,
+0000c790: 2073 656c 6629 2e72 756e 5f70 726f 6365   self).run_proce
+0000c7a0: 7373 5f6d 6961 2829 0a0a 2020 2020 2020  ss_mia()..      
+0000c7b0: 2020 6669 6c65 735f 6e61 6d65 203d 2073    files_name = s
+0000c7c0: 656c 662e 696e 5f66 696c 6573 0a0a 2020  elf.in_files..  
+0000c7d0: 2020 2020 2020 666f 7220 6669 6c65 5f6e        for file_n
+0000c7e0: 616d 6520 696e 2066 696c 6573 5f6e 616d  ame in files_nam
+0000c7f0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+0000c800: 2049 6d61 6765 2070 726f 6365 7373 696e   Image processin
+0000c810: 670a 2020 2020 2020 2020 2020 2020 7472  g.            tr
+0000c820: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000c830: 2020 2069 6d67 203d 206e 6962 2e6c 6f61     img = nib.loa
+0000c840: 6428 6669 6c65 5f6e 616d 6529 0a0a 2020  d(file_name)..  
+0000c850: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000c860: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000c870: 2020 206e 6962 2e66 696c 6562 6173 6564     nib.filebased
+0000c880: 696d 6167 6573 2e49 6d61 6765 4669 6c65  images.ImageFile
+0000c890: 4572 726f 722c 0a20 2020 2020 2020 2020  Error,.         
+0000c8a0: 2020 2020 2020 2046 696c 654e 6f74 466f         FileNotFo
+0000c8b0: 756e 6445 7272 6f72 2c0a 2020 2020 2020  undError,.      
+0000c8c0: 2020 2020 2020 2020 2020 5479 7065 4572            TypeEr
+0000c8d0: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
+0000c8e0: 2029 2061 7320 653a 0a20 2020 2020 2020   ) as e:.       
+0000c8f0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+0000c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c910: 2020 2020 225c 6e45 6e68 616e 6365 2062      "\nEnhance b
+0000c920: 7269 636b 3a20 4572 726f 7220 7769 7468  rick: Error with
+0000c930: 2066 696c 6520 746f 2065 6e68 616e 6365   file to enhance
+0000c940: 2c20 6475 7269 6e67 2074 6865 2022 0a20  , during the ". 
+0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c960: 2020 2022 7275 6e3a 2022 2c0a 2020 2020     "run: ",.    
+0000c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c980: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000c990: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000c9a0: 2020 2020 2069 6d67 203d 204e 6f6e 650a       img = None.
+0000c9b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c9c0: 696d 6720 6973 206e 6f74 204e 6f6e 653a  img is not None:
+0000c9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c9e0: 2064 6174 6120 3d20 696d 672e 6765 745f   data = img.get_
+0000c9f0: 6664 6174 6128 292e 6173 7479 7065 286e  fdata().astype(n
+0000ca00: 702e 666c 6f61 7433 3229 0a20 2020 2020  p.float32).     
+0000ca10: 2020 2020 2020 2020 2020 2072 616e 6765             range
+0000ca20: 5f6d 6178 203d 206e 702e 7065 7263 656e  _max = np.percen
+0000ca30: 7469 6c65 2864 6174 615b 6461 7461 203e  tile(data[data >
+0000ca40: 2030 5d2c 2039 392e 3938 290a 2020 2020   0], 99.98).    
+0000ca50: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
+0000ca60: 655f 6d69 6e20 3d20 6e70 2e6d 6564 6961  e_min = np.media
+0000ca70: 6e28 6461 7461 5b64 6174 6120 3e20 305d  n(data[data > 0]
+0000ca80: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000ca90: 2020 2023 2052 6573 616d 706c 6520 7369     # Resample si
+0000caa0: 676e 616c 2065 7863 6573 7320 7069 7865  gnal excess pixe
+0000cab0: 6c73 0a20 2020 2020 2020 2020 2020 2020  ls.             
+0000cac0: 2020 2065 7863 6573 7320 3d20 6e70 2e77     excess = np.w
+0000cad0: 6865 7265 2864 6174 6120 3e20 7261 6e67  here(data > rang
+0000cae0: 655f 6d61 7829 0a20 2020 2020 2020 2020  e_max).         
+0000caf0: 2020 2020 2020 2064 6174 615b 6578 6365         data[exce
+0000cb00: 7373 5d20 3d20 300a 2020 2020 2020 2020  ss] = 0.        
+0000cb10: 2020 2020 2020 2020 6461 7461 5b65 7863          data[exc
+0000cb20: 6573 735d 203d 206e 702e 7261 6e64 6f6d  ess] = np.random
+0000cb30: 2e63 686f 6963 6528 0a20 2020 2020 2020  .choice(.       
+0000cb40: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0000cb50: 615b 6461 7461 203e 2072 616e 6765 5f6d  a[data > range_m
+0000cb60: 696e 5d2c 2073 697a 653d 6c65 6e28 6578  in], size=len(ex
+0000cb70: 6365 7373 5b30 5d29 0a20 2020 2020 2020  cess[0]).       
+0000cb80: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000cb90: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000cba0: 696d 6167 6520 3d20 696d 672e 5f5f 636c  image = img.__cl
+0000cbb0: 6173 735f 5f28 6461 7461 2c20 696d 672e  ass__(data, img.
+0000cbc0: 6166 6669 6e65 2c20 696d 672e 6865 6164  affine, img.head
+0000cbd0: 6572 290a 0a20 2020 2020 2020 2020 2020  er)..           
+0000cbe0: 2020 2020 2023 2049 6d61 6765 2073 6176       # Image sav
+0000cbf0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000cc00: 2020 5f2c 2066 696c 655f 6e61 6d65 203d    _, file_name =
+0000cc10: 206f 732e 7061 7468 2e73 706c 6974 2866   os.path.split(f
+0000cc20: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+0000cc30: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
+0000cc40: 616d 655f 6e6f 5f65 7874 2c20 6669 6c65  ame_no_ext, file
+0000cc50: 5f65 7874 656e 7369 6f6e 203d 206f 732e  _extension = os.
+0000cc60: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
+0000cc70: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
+0000cc80: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+0000cc90: 5f65 7874 656e 7369 6f6e 203d 3d20 222e  _extension == ".
+0000cca0: 677a 223a 0a20 2020 2020 2020 2020 2020  gz":.           
+0000ccb0: 2020 2020 2020 2020 2028 6669 6c65 5f6e           (file_n
+0000ccc0: 616d 655f 6e6f 5f65 7874 5f32 2c20 6669  ame_no_ext_2, fi
+0000ccd0: 6c65 5f65 7874 656e 7369 6f6e 5f32 2920  le_extension_2) 
+0000cce0: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
+0000ccf0: 7874 280a 2020 2020 2020 2020 2020 2020  xt(.            
+0000cd00: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000cd10: 5f6e 616d 655f 6e6f 5f65 7874 0a20 2020  _name_no_ext.   
+0000cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd30: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000cd40: 2020 2020 2020 2069 6620 6669 6c65 5f65         if file_e
+0000cd50: 7874 656e 7369 6f6e 5f32 203d 3d20 222e  xtension_2 == ".
+0000cd60: 6e69 6922 3a0a 2020 2020 2020 2020 2020  nii":.          
+0000cd70: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000cd80: 6c65 5f6e 616d 655f 6e6f 5f65 7874 203d  le_name_no_ext =
+0000cd90: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
+0000cda0: 745f 320a 2020 2020 2020 2020 2020 2020  t_2.            
+0000cdb0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000cdc0: 5f65 7874 656e 7369 6f6e 203d 2022 2e6e  _extension = ".n
+0000cdd0: 6969 2e67 7a22 0a0a 2020 2020 2020 2020  ii.gz"..        
+0000cde0: 2020 2020 2020 2020 6669 6c65 5f6f 7574          file_out
+0000cdf0: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+0000ce00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ce10: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
+0000ce20: 5f64 6972 6563 746f 7279 2c0a 2020 2020  _directory,.    
+0000ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000ce50: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000ce60: 7265 6669 782e 7374 7269 7028 290a 2020  refix.strip().  
 0000ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce80: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-0000ce90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000cea0: 2020 2020 2020 2020 206e 6962 2e73 6176           nib.sav
-0000ceb0: 6528 6f75 745f 696d 6167 652c 2066 696c  e(out_image, fil
-0000cec0: 655f 6f75 7429 0a0a 0a63 6c61 7373 2045  e_out)...class E
-0000ced0: 7374 696d 6174 6553 4e52 2850 726f 6365  stimateSNR(Proce
-0000cee0: 7373 4d49 4129 3a0a 2020 2020 2222 220a  ssMIA):.    """.
-0000cef0: 2020 2020 2a45 7374 696d 6174 6520 534e      *Estimate SN
-0000cf00: 5220 7573 696e 6720 6120 7365 676d 656e  R using a segmen
-0000cf10: 7461 7469 6f6e 2066 696c 652a 0a0a 2020  tation file*..  
-0000cf20: 2020 506c 6561 7365 2c20 7365 6520 7468    Please, see th
-0000cf30: 6520 636f 6d70 6c65 7465 2064 6f63 756d  e complete docum
-0000cf40: 656e 7461 7469 6f6e 2066 6f72 2074 6865  entation for the
-0000cf50: 2060 4573 7469 6d61 7465 534e 5220 6272   `EstimateSNR br
-0000cf60: 6963 6b0a 2020 2020 696e 2074 6865 206d  ick.    in the m
-0000cf70: 6961 5f70 726f 6365 7373 6573 2077 6562  ia_processes web
-0000cf80: 7369 7465 0a20 2020 203c 6874 7470 733a  site.    <https:
-0000cf90: 2f2f 706f 7075 6c73 652e 6769 7468 7562  //populse.github
-0000cfa0: 2e69 6f2f 6d69 615f 7072 6f63 6573 7365  .io/mia_processe
-0000cfb0: 732f 6874 6d6c 2f64 6f63 756d 656e 7461  s/html/documenta
-0000cfc0: 7469 6f6e 2f62 7269 636b 732f 7072 6570  tion/bricks/prep
-0000cfd0: 726f 6365 7373 2f6f 7468 6572 2f45 7374  rocess/other/Est
-0000cfe0: 696d 6174 6553 4e52 2e68 746d 6c3e 605f  imateSNR.html>`_
-0000cff0: 0a0a 2020 2020 6164 6170 7465 6420 6672  ..    adapted fr
-0000d000: 6f6d 3a0a 2020 2020 6874 7470 733a 2f2f  om:.    https://
-0000d010: 6769 7468 7562 2e63 6f6d 2f6e 6970 7265  github.com/nipre
-0000d020: 7073 2f6d 7269 7163 2f62 6c6f 622f 3232  ps/mriqc/blob/22
-0000d030: 2e30 2e36 2f6d 7269 7163 2f77 6f72 6b66  .0.6/mriqc/workf
-0000d040: 6c6f 7773 2f61 6e61 746f 6d69 6361 6c2e  lows/anatomical.
-0000d050: 7079 234c 3937 300a 0a20 2020 2022 2222  py#L970..    """
-0000d060: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0000d070: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-0000d080: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
-0000d090: 6f20 7468 6520 6174 7472 6962 7574 6573  o the attributes
-0000d0a0: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
-0000d0b0: 2f20 696e 7374 616e 7469 6174 696f 6e2e  / instantiation.
-0000d0c0: 0a0a 2020 2020 2020 2020 5468 6520 696e  ..        The in
-0000d0d0: 7075 7420 616e 6420 6f75 7470 7574 2070  put and output p
-0000d0e0: 6c75 6773 2061 7265 2064 6566 696e 6564  lugs are defined
-0000d0f0: 2068 6572 652e 2054 6865 2073 7065 6369   here. The speci
-0000d100: 616c 0a20 2020 2020 2020 2027 7365 6c66  al.        'self
-0000d110: 2e72 6571 7569 7265 6d65 6e74 2720 6174  .requirement' at
-0000d120: 7472 6962 7574 6520 286f 7074 696f 6e61  tribute (optiona
-0000d130: 6c29 2069 7320 7573 6564 2074 6f20 6465  l) is used to de
-0000d140: 6669 6e65 2074 6865 0a20 2020 2020 2020  fine the.       
-0000d150: 2074 6869 7264 2d70 6172 7479 2070 726f   third-party pro
-0000d160: 6475 6374 7320 6e65 6365 7373 6172 7920  ducts necessary 
-0000d170: 666f 7220 7468 6520 7275 6e6e 696e 6720  for the running 
-0000d180: 6f66 2074 6865 2062 7269 636b 2e0a 2020  of the brick..  
-0000d190: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000d1a0: 2020 2320 496e 6974 6961 6c69 7361 7469    # Initialisati
-0000d1b0: 6f6e 206f 6620 7468 6520 6f62 6a65 6374  on of the object
-0000d1c0: 7320 6e65 6564 6564 2066 6f72 2074 6865  s needed for the
-0000d1d0: 206c 6175 6e63 6820 6f66 2074 6865 2062   launch of the b
-0000d1e0: 7269 636b 0a20 2020 2020 2020 2073 7570  rick.        sup
-0000d1f0: 6572 2845 7374 696d 6174 6553 4e52 2c20  er(EstimateSNR, 
-0000d200: 7365 6c66 292e 5f5f 696e 6974 5f5f 2829  self).__init__()
-0000d210: 0a0a 2020 2020 2020 2020 2320 5468 6972  ..        # Thir
-0000d220: 6420 7061 7274 7920 736f 6674 7761 7265  d party software
-0000d230: 7320 7265 7175 6972 6564 2066 6f72 2074  s required for t
-0000d240: 6865 2065 7865 6375 7469 6f6e 206f 6620  he execution of 
-0000d250: 7468 6520 6272 6963 6b0a 2020 2020 2020  the brick.      
-0000d260: 2020 7365 6c66 2e72 6571 7569 7265 6d65    self.requireme
-0000d270: 6e74 203d 205b 5d0a 0a20 2020 2020 2020  nt = []..       
-0000d280: 2023 2049 6e70 7574 7320 6465 7363 7269   # Inputs descri
-0000d290: 7074 696f 6e0a 2020 2020 2020 2020 696e  ption.        in
-0000d2a0: 5f66 696c 655f 6465 7363 203d 2028 0a20  _file_desc = (. 
-0000d2b0: 2020 2020 2020 2020 2020 2022 496e 7075             "Inpu
-0000d2c0: 7420 6669 6c65 2028 6120 7061 7468 6c69  t file (a pathli
-0000d2d0: 6b65 206f 626a 6563 7420 6f72 2073 7472  ke object or str
-0000d2e0: 696e 6720 7265 7072 6573 656e 7469 6e67  ing representing
-0000d2f0: 2061 2066 696c 6529 2e22 0a20 2020 2020   a file).".     
-0000d300: 2020 2029 0a20 2020 2020 2020 2073 6567     ).        seg
-0000d310: 5f66 696c 655f 6465 7363 203d 2028 0a20  _file_desc = (. 
-0000d320: 2020 2020 2020 2020 2020 2022 4120 7365             "A se
-0000d330: 676d 656e 7461 7469 6f6e 2066 696c 6520  gmentation file 
-0000d340: 746f 2063 616c 6375 6c61 7465 2053 4e52  to calculate SNR
-0000d350: 2028 6120 7061 7468 6c69 6b65 2022 0a20   (a pathlike ". 
-0000d360: 2020 2020 2020 2020 2020 2022 6f62 6a65             "obje
-0000d370: 6374 206f 7220 7374 7269 6e67 2072 6570  ct or string rep
-0000d380: 7265 7365 6e74 696e 6720 6120 6669 6c65  resenting a file
-0000d390: 292e 220a 2020 2020 2020 2020 290a 2020  ).".        ).  
-0000d3a0: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
-0000d3b0: 6465 7363 7269 7074 696f 6e0a 2020 2020  description.    
-0000d3c0: 2020 2020 6f75 745f 736e 725f 6465 7363      out_snr_desc
-0000d3d0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0000d3e0: 2022 4573 7469 6d61 7465 6420 534e 5220   "Estimated SNR 
-0000d3f0: 2861 2070 6174 686c 696b 6520 6f62 6a65  (a pathlike obje
-0000d400: 6374 206f 7220 7374 7269 6e67 2072 6570  ct or string rep
-0000d410: 7265 7365 6e74 696e 6720 6120 6669 6c65  resenting a file
-0000d420: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
-0000d430: 2020 2020 2023 2049 6e70 7574 7320 7472       # Inputs tr
-0000d440: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
-0000d450: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-0000d460: 2020 2020 2020 2020 2022 696e 5f66 696c           "in_fil
-0000d470: 6522 2c20 4669 6c65 286f 7574 7075 743d  e", File(output=
-0000d480: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
-0000d490: 4661 6c73 652c 2064 6573 633d 696e 5f66  False, desc=in_f
-0000d4a0: 696c 655f 6465 7363 290a 2020 2020 2020  ile_desc).      
-0000d4b0: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-0000d4c0: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-0000d4d0: 2020 2020 2020 2020 2022 7365 675f 6669           "seg_fi
-0000d4e0: 6c65 222c 2046 696c 6528 6f75 7470 7574  le", File(output
-0000d4f0: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
-0000d500: 3d46 616c 7365 2c20 6465 7363 3d73 6567  =False, desc=seg
-0000d510: 5f66 696c 655f 6465 7363 290a 2020 2020  _file_desc).    
-0000d520: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-0000d530: 204f 7574 7075 7473 2074 7261 6974 730a   Outputs traits.
-0000d540: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-0000d550: 5f74 7261 6974 2822 6f75 745f 736e 7222  _trait("out_snr"
-0000d560: 2c20 7472 6169 7473 2e46 6c6f 6174 286f  , traits.Float(o
-0000d570: 7574 7075 743d 5472 7565 2c20 6465 7363  utput=True, desc
-0000d580: 3d6f 7574 5f73 6e72 5f64 6573 6329 290a  =out_snr_desc)).
-0000d590: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-0000d5a0: 6974 5f64 6566 6175 6c74 5f74 7261 6974  it_default_trait
-0000d5b0: 7328 290a 0a20 2020 2064 6566 206c 6973  s()..    def lis
-0000d5c0: 745f 6f75 7470 7574 7328 7365 6c66 2c20  t_outputs(self, 
-0000d5d0: 6973 5f70 6c75 6767 6564 3d4e 6f6e 6529  is_plugged=None)
-0000d5e0: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
-0000d5f0: 6963 6174 6564 2074 6f20 7468 6520 696e  icated to the in
-0000d600: 6974 6961 6c69 7361 7469 6f6e 2073 7465  itialisation ste
-0000d610: 7020 6f66 2074 6865 2062 7269 636b 2e0a  p of the brick..
-0000d620: 0a20 2020 2020 2020 2054 6865 206d 6169  .        The mai
-0000d630: 6e20 6f62 6a65 6374 6976 6520 6f66 2074  n objective of t
-0000d640: 6869 7320 6d65 7468 6f64 2069 7320 746f  his method is to
-0000d650: 2070 726f 6475 6365 2074 6865 206f 7574   produce the out
-0000d660: 7075 7473 206f 6620 7468 650a 2020 2020  puts of the.    
-0000d670: 2020 2020 6272 6963 6b73 2028 7365 6c66      bricks (self
-0000d680: 2e6f 7574 7075 7473 2920 616e 6420 7468  .outputs) and th
-0000d690: 6520 6173 736f 6369 6174 6564 2074 6167  e associated tag
-0000d6a0: 7320 2873 656c 662e 696e 6865 7269 7461  s (self.inherita
-0000d6b0: 6e63 655f 6469 6329 2c0a 2020 2020 2020  nce_dic),.      
-0000d6c0: 2020 6966 2064 6566 696e 6564 2068 6572    if defined her
-0000d6d0: 652e 2054 6f20 776f 726b 2070 726f 7065  e. To work prope
-0000d6e0: 726c 7920 7468 6973 206d 6574 686f 6420  rly this method 
-0000d6f0: 6d75 7374 2072 6574 7572 6e0a 2020 2020  must return.    
-0000d700: 2020 2020 7365 6c66 2e6d 616b 655f 696e      self.make_in
-0000d710: 6974 5265 7375 6c74 2829 206f 626a 6563  itResult() objec
-0000d720: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
-0000d730: 616d 2069 735f 706c 7567 6765 643a 2074  am is_plugged: t
-0000d740: 6865 2073 7461 7465 2c20 6c69 6e6b 6564  he state, linked
-0000d750: 206f 7220 6e6f 742c 206f 6620 7468 6520   or not, of the 
-0000d760: 706c 7567 732e 0a20 2020 2020 2020 203a  plugs..        :
-0000d770: 7265 7475 726e 733a 2061 2064 6963 7469  returns: a dicti
-0000d780: 6f6e 6172 7920 7769 7468 2072 6571 7569  onary with requi
-0000d790: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
-0000d7a0: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
-0000d7b0: 6469 6374 2e0a 2020 2020 2020 2020 2222  dict..        ""
-0000d7c0: 220a 2020 2020 2020 2020 2320 5573 696e  ".        # Usin
-0000d7d0: 6720 7468 6520 696e 6865 7269 7461 6e63  g the inheritanc
-0000d7e0: 6520 746f 2050 726f 6365 7373 4d49 4120  e to ProcessMIA 
-0000d7f0: 636c 6173 732c 206c 6973 745f 6f75 7470  class, list_outp
-0000d800: 7574 7320 6d65 7468 6f64 0a20 2020 2020  uts method.     
-0000d810: 2020 2073 7570 6572 2845 7374 696d 6174     super(Estimat
-0000d820: 6553 4e52 2c20 7365 6c66 292e 6c69 7374  eSNR, self).list
-0000d830: 5f6f 7574 7075 7473 2829 0a0a 2020 2020  _outputs()..    
-0000d840: 2020 2020 2320 4f75 7470 7574 7320 6465      # Outputs de
-0000d850: 6669 6e69 7469 6f6e 0a20 2020 2020 2020  finition.       
-0000d860: 2069 6620 7365 6c66 2e69 6e5f 6669 6c65   if self.in_file
-0000d870: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000d880: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
-0000d890: 6563 746f 7279 3a0a 2020 2020 2020 2020  ectory:.        
-0000d8a0: 2020 2020 2020 2020 7661 6c69 645f 6578          valid_ex
-0000d8b0: 742c 2069 6e5f 6578 742c 2066 696c 654e  t, in_ext, fileN
-0000d8c0: 616d 6520 3d20 6368 6563 6b46 696c 6545  ame = checkFileE
-0000d8d0: 7874 2873 656c 662e 696e 5f66 696c 652c  xt(self.in_file,
-0000d8e0: 2045 5854 290a 0a20 2020 2020 2020 2020   EXT)..         
-0000d8f0: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
-0000d900: 6c69 645f 6578 743a 0a20 2020 2020 2020  lid_ext:.       
-0000d910: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000d920: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0000d930: 2020 2020 2020 2020 2020 2020 225c 6e45              "\nE
-0000d940: 7374 696d 6174 6553 4e52 2062 7269 636b  stimateSNR brick
-0000d950: 3a20 5468 6520 696e 7075 7420 696d 6167  : The input imag
-0000d960: 6520 666f 726d 6174 2069 7320 6e6f 7420  e format is not 
-0000d970: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000d980: 2020 2020 2020 2020 2020 2272 6563 6f67            "recog
-0000d990: 6e69 7a65 642e 2e2e 2122 0a20 2020 2020  nized...!".     
-0000d9a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000d9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d9c0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-0000d9d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000d9e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d9f0: 7269 6e74 2822 4573 7469 6d61 7465 534e  rint("EstimateSN
-0000da00: 5220 6272 6963 6b3a 204e 6f20 6f75 7470  R brick: No outp
-0000da10: 7574 5f64 6972 6563 746f 7279 2077 6173  ut_directory was
-0000da20: 2066 6f75 6e64 2e2e 2e21 5c6e 2229 0a20   found...!\n"). 
-0000da30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000da40: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
-0000da50: 2052 6574 7572 6e20 7468 6520 7265 7175   Return the requ
-0000da60: 6972 656d 656e 742c 206f 7574 7075 7473  irement, outputs
-0000da70: 2061 6e64 2069 6e68 6572 6974 616e 6365   and inheritance
-0000da80: 5f64 6963 740a 2020 2020 2020 2020 7265  _dict.        re
-0000da90: 7475 726e 2073 656c 662e 6d61 6b65 5f69  turn self.make_i
-0000daa0: 6e69 7452 6573 756c 7428 290a 0a20 2020  nitResult()..   
-0000dab0: 2064 6566 2072 756e 5f70 726f 6365 7373   def run_process
-0000dac0: 5f6d 6961 2873 656c 6629 3a0a 2020 2020  _mia(self):.    
-0000dad0: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
-0000dae0: 2074 6f20 7468 6520 7072 6f63 6573 7320   to the process 
-0000daf0: 6c61 756e 6368 2073 7465 7020 6f66 2074  launch step of t
-0000db00: 6865 2062 7269 636b 2e22 2222 0a20 2020  he brick.""".   
-0000db10: 2020 2020 2073 7570 6572 2845 7374 696d       super(Estim
-0000db20: 6174 6553 4e52 2c20 7365 6c66 292e 7275  ateSNR, self).ru
-0000db30: 6e5f 7072 6f63 6573 735f 6d69 6128 290a  n_process_mia().
-0000db40: 0a20 2020 2020 2020 2066 696c 655f 6e61  .        file_na
-0000db50: 6d65 203d 2073 656c 662e 696e 5f66 696c  me = self.in_fil
-0000db60: 650a 2020 2020 2020 2020 7365 675f 6669  e.        seg_fi
-0000db70: 6c65 5f6e 616d 6520 3d20 7365 6c66 2e73  le_name = self.s
-0000db80: 6567 5f66 696c 650a 0a20 2020 2020 2020  eg_file..       
-0000db90: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000dba0: 2020 696d 6720 3d20 6e69 622e 6c6f 6164    img = nib.load
-0000dbb0: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
-0000dbc0: 2020 2020 2020 2020 7365 675f 696d 6720          seg_img 
-0000dbd0: 3d20 6e69 622e 6c6f 6164 2873 6567 5f66  = nib.load(seg_f
-0000dbe0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
-0000dbf0: 2020 6578 6365 7074 2028 0a20 2020 2020    except (.     
-0000dc00: 2020 2020 2020 206e 6962 2e66 696c 6562         nib.fileb
-0000dc10: 6173 6564 696d 6167 6573 2e49 6d61 6765  asedimages.Image
-0000dc20: 4669 6c65 4572 726f 722c 0a20 2020 2020  FileError,.     
-0000dc30: 2020 2020 2020 2046 696c 654e 6f74 466f         FileNotFo
-0000dc40: 756e 6445 7272 6f72 2c0a 2020 2020 2020  undError,.      
-0000dc50: 2020 2020 2020 5479 7065 4572 726f 722c        TypeError,
-0000dc60: 0a20 2020 2020 2020 2029 2061 7320 653a  .        ) as e:
-0000dc70: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000dc80: 6e74 2822 5c6e 4573 7469 6d61 7465 534e  nt("\nEstimateSN
-0000dc90: 5220 6272 6963 6b3a 2045 7272 6f72 2077  R brick: Error w
-0000dca0: 6974 6820 6669 6c65 732c 2064 7572 696e  ith files, durin
-0000dcb0: 6720 7468 6520 7275 6e3a 2022 2c20 6529  g the run: ", e)
-0000dcc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000dcd0: 7572 6e0a 0a20 2020 2020 2020 2064 6174  urn..        dat
-0000dce0: 6120 3d20 696d 672e 6765 745f 6664 6174  a = img.get_fdat
-0000dcf0: 6128 290a 2020 2020 2020 2020 6d61 736b  a().        mask
-0000dd00: 203d 2073 6567 5f69 6d67 2e67 6574 5f66   = seg_img.get_f
-0000dd10: 6461 7461 2829 203d 3d20 3220 2023 2057  data() == 2  # W
-0000dd20: 4d20 6c61 6265 6c0a 2020 2020 2020 2020  M label.        
-0000dd30: 7365 6c66 2e6f 7574 5f73 6e72 203d 2066  self.out_snr = f
-0000dd40: 6c6f 6174 280a 2020 2020 2020 2020 2020  loat(.          
-0000dd50: 2020 6e70 2e6d 6561 6e28 6461 7461 5b6d    np.mean(data[m
-0000dd60: 6173 6b5d 290a 2020 2020 2020 2020 2020  ask]).          
-0000dd70: 2020 2f20 2864 6174 615b 6d61 736b 5d2e    / (data[mask].
-0000dd80: 7374 6428 2920 2a20 6e70 2e73 7172 7428  std() * np.sqrt(
-0000dd90: 6d61 736b 2e73 756d 2829 202f 2028 6d61  mask.sum() / (ma
-0000dda0: 736b 2e73 756d 2829 202d 2031 2929 290a  sk.sum() - 1))).
-0000ddb0: 2020 2020 2020 2020 290a 0a0a 636c 6173          )...clas
-0000ddc0: 7320 4772 6164 6965 6e74 5468 7265 7368  s GradientThresh
-0000ddd0: 6f6c 6428 5072 6f63 6573 734d 4941 293a  old(ProcessMIA):
-0000dde0: 0a20 2020 2022 2222 0a20 2020 202a 436f  .    """.    *Co
-0000ddf0: 6d70 7574 6573 2061 2074 6872 6573 686f  mputes a thresho
-0000de00: 6c64 2066 726f 6d20 7468 6520 6869 7374  ld from the hist
-0000de10: 6f67 7261 6d20 6f66 2074 6865 206d 6167  ogram of the mag
-0000de20: 6e69 7475 6465 2067 7261 6469 656e 7420  nitude gradient 
-0000de30: 696d 6167 652a 0a0a 2020 2020 506c 6561  image*..    Plea
-0000de40: 7365 2c20 7365 6520 7468 6520 636f 6d70  se, see the comp
-0000de50: 6c65 7465 2064 6f63 756d 656e 7461 7469  lete documentati
-0000de60: 6f6e 2066 6f72 2074 6865 2060 4772 6164  on for the `Grad
-0000de70: 6965 6e74 5468 7265 7368 6f6c 6420 6272  ientThreshold br
-0000de80: 6963 6b0a 2020 2020 696e 2074 6865 206d  ick.    in the m
-0000de90: 6961 5f70 726f 6365 7373 6573 2077 6562  ia_processes web
-0000dea0: 7369 7465 0a20 2020 203c 6874 7470 733a  site.    <https:
-0000deb0: 2f2f 706f 7075 6c73 652e 6769 7468 7562  //populse.github
-0000dec0: 2e69 6f2f 6d69 615f 7072 6f63 6573 7365  .io/mia_processe
-0000ded0: 732f 6874 6d6c 2f64 6f63 756d 656e 7461  s/html/documenta
-0000dee0: 7469 6f6e 2f62 7269 636b 732f 7072 6570  tion/bricks/prep
-0000def0: 726f 6365 7373 2f6f 7468 6572 2f47 7261  rocess/other/Gra
-0000df00: 6469 656e 7454 6872 6573 686f 6c64 2e68  dientThreshold.h
-0000df10: 746d 6c3e 605f 0a0a 2020 2020 6164 6170  tml>`_..    adap
-0000df20: 7465 6420 6672 6f6d 3a0a 2020 2020 6874  ted from:.    ht
-0000df30: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-0000df40: 2f6e 6970 7265 7073 2f6d 7269 7163 2f62  /nipreps/mriqc/b
-0000df50: 6c6f 622f 6530 3231 3030 3864 6130 6132  lob/e021008da0a2
-0000df60: 6566 3163 3438 6538 3832 6261 6639 3332  ef1c48e882baf932
-0000df70: 3133 3961 3637 3333 3439 6639 2f6d 7269  139a673349f9/mri
-0000df80: 7163 2f77 6f72 6b66 6c6f 7773 2f61 6e61  qc/workflows/ana
-0000df90: 746f 6d69 6361 6c2e 7079 234c 3130 3339  tomical.py#L1039
-0000dfa0: 0a0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-0000dfb0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-0000dfc0: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
-0000dfd0: 6469 6361 7465 6420 746f 2074 6865 2061  dicated to the a
-0000dfe0: 7474 7269 6275 7465 7320 696e 6974 6961  ttributes initia
-0000dff0: 6c69 7361 7469 6f6e 202f 2069 6e73 7461  lisation / insta
-0000e000: 6e74 6961 7469 6f6e 2e0a 0a20 2020 2020  ntiation...     
-0000e010: 2020 2054 6865 2069 6e70 7574 2061 6e64     The input and
-0000e020: 206f 7574 7075 7420 706c 7567 7320 6172   output plugs ar
-0000e030: 6520 6465 6669 6e65 6420 6865 7265 2e20  e defined here. 
-0000e040: 5468 6520 7370 6563 6961 6c0a 2020 2020  The special.    
-0000e050: 2020 2020 2773 656c 662e 7265 7175 6972      'self.requir
-0000e060: 656d 656e 7427 2061 7474 7269 6275 7465  ement' attribute
-0000e070: 2028 6f70 7469 6f6e 616c 2920 6973 2075   (optional) is u
-0000e080: 7365 6420 746f 2064 6566 696e 6520 7468  sed to define th
-0000e090: 650a 2020 2020 2020 2020 7468 6972 642d  e.        third-
-0000e0a0: 7061 7274 7920 7072 6f64 7563 7473 206e  party products n
-0000e0b0: 6563 6573 7361 7279 2066 6f72 2074 6865  ecessary for the
-0000e0c0: 2072 756e 6e69 6e67 206f 6620 7468 6520   running of the 
-0000e0d0: 6272 6963 6b2e 0a20 2020 2020 2020 2022  brick..        "
-0000e0e0: 2222 0a20 2020 2020 2020 2023 2049 6e69  "".        # Ini
-0000e0f0: 7469 616c 6973 6174 696f 6e20 6f66 2074  tialisation of t
-0000e100: 6865 206f 626a 6563 7473 206e 6565 6465  he objects neede
-0000e110: 6420 666f 7220 7468 6520 6c61 756e 6368  d for the launch
-0000e120: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
-0000e130: 2020 2020 2020 7375 7065 7228 4772 6164        super(Grad
-0000e140: 6965 6e74 5468 7265 7368 6f6c 642c 2073  ientThreshold, s
-0000e150: 656c 6629 2e5f 5f69 6e69 745f 5f28 290a  elf).__init__().
-0000e160: 0a20 2020 2020 2020 2023 2054 6869 7264  .        # Third
-0000e170: 2070 6172 7479 2073 6f66 7477 6172 6573   party softwares
-0000e180: 2072 6571 7569 7265 6420 666f 7220 7468   required for th
-0000e190: 6520 6578 6563 7574 696f 6e20 6f66 2074  e execution of t
-0000e1a0: 6865 2062 7269 636b 0a20 2020 2020 2020  he brick.       
-0000e1b0: 2073 656c 662e 7265 7175 6972 656d 656e   self.requiremen
-0000e1c0: 7420 3d20 5b5d 0a0a 2020 2020 2020 2020  t = []..        
-0000e1d0: 2320 496e 7075 7473 2064 6573 6372 6970  # Inputs descrip
-0000e1e0: 7469 6f6e 0a20 2020 2020 2020 2069 6e5f  tion.        in_
-0000e1f0: 6669 6c65 5f64 6573 6320 3d20 2241 6e20  file_desc = "An 
-0000e200: 6578 6973 7469 6e67 2070 6174 6820 6669  existing path fi
-0000e210: 6c65 2e22 0a20 2020 2020 2020 2073 6567  le.".        seg
-0000e220: 5f66 696c 655f 6465 7363 203d 2022 416e  _file_desc = "An
-0000e230: 2065 7869 7374 696e 6720 7061 7468 206f   existing path o
-0000e240: 6620 7365 676d 656e 7461 7469 6f6e 2066  f segmentation f
-0000e250: 696c 652e 220a 2020 2020 2020 2020 7072  ile.".        pr
-0000e260: 6566 6978 5f64 6573 6320 3d20 2250 7265  efix_desc = "Pre
-0000e270: 6669 7820 6f66 2074 6865 206f 7574 7075  fix of the outpu
-0000e280: 7420 696d 6167 6520 2861 2073 7472 696e  t image (a strin
-0000e290: 6729 2e22 0a20 2020 2020 2020 2073 7566  g).".        suf
-0000e2a0: 6669 785f 6465 7363 203d 2022 5375 6666  fix_desc = "Suff
-0000e2b0: 6978 206f 6620 7468 6520 6f75 7470 7574  ix of the output
-0000e2c0: 2069 6d61 6765 2028 6120 7374 7269 6e67   image (a string
-0000e2d0: 292e 220a 0a20 2020 2020 2020 2023 204f  )."..        # O
-0000e2e0: 7574 7075 7473 2064 6573 6372 6970 7469  utputs descripti
-0000e2f0: 6f6e 0a20 2020 2020 2020 206f 7574 5f66  on.        out_f
-0000e300: 696c 655f 6465 7363 203d 2028 0a20 2020  ile_desc = (.   
-0000e310: 2020 2020 2020 2020 2022 5061 7468 206f           "Path o
-0000e320: 6620 7468 6520 7468 7265 7368 6f6c 6465  f the thresholde
-0000e330: 6420 7363 616e 2022 0a20 2020 2020 2020  d scan ".       
-0000e340: 2020 2020 2022 2861 2070 6174 686c 696b       "(a pathlik
-0000e350: 6520 6f62 6a65 6374 206f 7220 7374 7269  e object or stri
-0000e360: 6e67 2072 6570 7265 7365 6e74 696e 6720  ng representing 
-0000e370: 6120 6669 6c65 292e 220a 2020 2020 2020  a file).".      
-0000e380: 2020 290a 0a20 2020 2020 2020 2023 2049    )..        # I
-0000e390: 6e70 7574 7320 7472 6169 7473 0a20 2020  nputs traits.   
-0000e3a0: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-0000e3b0: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-0000e3c0: 2022 696e 5f66 696c 6522 2c20 4669 6c65   "in_file", File
-0000e3d0: 286f 7574 7075 743d 4661 6c73 652c 206f  (output=False, o
-0000e3e0: 7074 696f 6e61 6c3d 4661 6c73 652c 2064  ptional=False, d
-0000e3f0: 6573 633d 696e 5f66 696c 655f 6465 7363  esc=in_file_desc
-0000e400: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-0000e410: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-0000e420: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-0000e430: 2022 7365 675f 6669 6c65 222c 2046 696c   "seg_file", Fil
-0000e440: 6528 6f75 7470 7574 3d46 616c 7365 2c20  e(output=False, 
-0000e450: 6f70 7469 6f6e 616c 3d46 616c 7365 2c20  optional=False, 
-0000e460: 6465 7363 3d73 6567 5f66 696c 655f 6465  desc=seg_file_de
-0000e470: 7363 290a 2020 2020 2020 2020 290a 0a20  sc).        ).. 
-0000e480: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000e490: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-0000e4a0: 2020 2022 7072 6566 6978 222c 0a20 2020     "prefix",.   
-0000e4b0: 2020 2020 2020 2020 2074 7261 6974 732e           traits.
-0000e4c0: 5374 7269 6e67 2822 222c 206f 7574 7075  String("", outpu
-0000e4d0: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
-0000e4e0: 6c3d 5472 7565 2c20 6465 7363 3d70 7265  l=True, desc=pre
-0000e4f0: 6669 785f 6465 7363 292c 0a20 2020 2020  fix_desc),.     
-0000e500: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-0000e510: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-0000e520: 2020 2020 2020 2020 2022 7375 6666 6978           "suffix
-0000e530: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
-0000e540: 7261 6974 732e 5374 7269 6e67 280a 2020  raits.String(.  
-0000e550: 2020 2020 2020 2020 2020 2020 2020 225f                "_
-0000e560: 6772 6164 222c 206f 7574 7075 743d 4661  grad", output=Fa
-0000e570: 6c73 652c 206f 7074 696f 6e61 6c3d 5472  lse, optional=Tr
-0000e580: 7565 2c20 6465 7363 3d73 7566 6669 785f  ue, desc=suffix_
-0000e590: 6465 7363 0a20 2020 2020 2020 2020 2020  desc.           
-0000e5a0: 2029 2c0a 2020 2020 2020 2020 290a 0a20   ),.        ).. 
-0000e5b0: 2020 2020 2020 2023 204f 7574 7075 7473         # Outputs
-0000e5c0: 2074 7261 6974 730a 2020 2020 2020 2020   traits.        
-0000e5d0: 7365 6c66 2e61 6464 5f74 7261 6974 2822  self.add_trait("
-0000e5e0: 6f75 745f 6669 6c65 222c 2046 696c 6528  out_file", File(
-0000e5f0: 6f75 7470 7574 3d54 7275 652c 2064 6573  output=True, des
-0000e600: 633d 6f75 745f 6669 6c65 5f64 6573 6329  c=out_file_desc)
-0000e610: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000e620: 696e 6974 5f64 6566 6175 6c74 5f74 7261  init_default_tra
-0000e630: 6974 7328 290a 0a20 2020 2064 6566 206c  its()..    def l
-0000e640: 6973 745f 6f75 7470 7574 7328 7365 6c66  ist_outputs(self
-0000e650: 2c20 6973 5f70 6c75 6767 6564 3d4e 6f6e  , is_plugged=Non
-0000e660: 6529 3a0a 2020 2020 2020 2020 2222 2244  e):.        """D
-0000e670: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
-0000e680: 696e 6974 6961 6c69 7361 7469 6f6e 2073  initialisation s
-0000e690: 7465 7020 6f66 2074 6865 2062 7269 636b  tep of the brick
-0000e6a0: 2e0a 0a20 2020 2020 2020 2054 6865 206d  ...        The m
-0000e6b0: 6169 6e20 6f62 6a65 6374 6976 6520 6f66  ain objective of
-0000e6c0: 2074 6869 7320 6d65 7468 6f64 2069 7320   this method is 
-0000e6d0: 746f 2070 726f 6475 6365 2074 6865 206f  to produce the o
-0000e6e0: 7574 7075 7473 206f 6620 7468 650a 2020  utputs of the.  
-0000e6f0: 2020 2020 2020 6272 6963 6b73 2028 7365        bricks (se
-0000e700: 6c66 2e6f 7574 7075 7473 2920 616e 6420  lf.outputs) and 
-0000e710: 7468 6520 6173 736f 6369 6174 6564 2074  the associated t
-0000e720: 6167 7320 2873 656c 662e 696e 6865 7269  ags (self.inheri
-0000e730: 7461 6e63 655f 6469 6329 2c0a 2020 2020  tance_dic),.    
-0000e740: 2020 2020 6966 2064 6566 696e 6564 2068      if defined h
-0000e750: 6572 652e 2054 6f20 776f 726b 2070 726f  ere. To work pro
-0000e760: 7065 726c 7920 7468 6973 206d 6574 686f  perly this metho
-0000e770: 6420 6d75 7374 2072 6574 7572 6e0a 2020  d must return.  
-0000e780: 2020 2020 2020 7365 6c66 2e6d 616b 655f        self.make_
-0000e790: 696e 6974 5265 7375 6c74 2829 206f 626a  initResult() obj
-0000e7a0: 6563 742e 0a0a 2020 2020 2020 2020 3a70  ect...        :p
-0000e7b0: 6172 616d 2069 735f 706c 7567 6765 643a  aram is_plugged:
-0000e7c0: 2074 6865 2073 7461 7465 2c20 6c69 6e6b   the state, link
-0000e7d0: 6564 206f 7220 6e6f 742c 206f 6620 7468  ed or not, of th
-0000e7e0: 6520 706c 7567 732e 0a20 2020 2020 2020  e plugs..       
-0000e7f0: 203a 7265 7475 726e 733a 2061 2064 6963   :returns: a dic
-0000e800: 7469 6f6e 6172 7920 7769 7468 2072 6571  tionary with req
-0000e810: 7569 7265 6d65 6e74 2c20 6f75 7470 7574  uirement, output
-0000e820: 7320 616e 6420 696e 6865 7269 7461 6e63  s and inheritanc
-0000e830: 655f 6469 6374 2e0a 2020 2020 2020 2020  e_dict..        
-0000e840: 2222 220a 2020 2020 2020 2020 2320 5573  """.        # Us
-0000e850: 696e 6720 7468 6520 696e 6865 7269 7461  ing the inherita
-0000e860: 6e63 6520 746f 2050 726f 6365 7373 4d49  nce to ProcessMI
-0000e870: 4120 636c 6173 732c 206c 6973 745f 6f75  A class, list_ou
-0000e880: 7470 7574 7320 6d65 7468 6f64 0a20 2020  tputs method.   
-0000e890: 2020 2020 2073 7570 6572 2847 7261 6469       super(Gradi
-0000e8a0: 656e 7454 6872 6573 686f 6c64 2c20 7365  entThreshold, se
-0000e8b0: 6c66 292e 6c69 7374 5f6f 7574 7075 7473  lf).list_outputs
-0000e8c0: 2829 0a0a 2020 2020 2020 2020 2320 4f75  ()..        # Ou
-0000e8d0: 7470 7574 7320 6465 6669 6e69 7469 6f6e  tputs definition
-0000e8e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000e8f0: 2e69 6e5f 6669 6c65 3a0a 2020 2020 2020  .in_file:.      
-0000e900: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-0000e910: 2020 2020 2020 2020 2020 2028 6e6f 7420             (not 
-0000e920: 7365 6c66 2e73 7566 6669 7829 0a20 2020  self.suffix).   
-0000e930: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-0000e940: 2873 656c 662e 7375 6666 6978 2e69 7373  (self.suffix.iss
-0000e950: 7061 6365 2829 290a 2020 2020 2020 2020  pace()).        
-0000e960: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
-0000e970: 7375 6666 6978 2069 6e20 5b55 6e64 6566  suffix in [Undef
-0000e980: 696e 6564 2c20 223c 756e 6465 6669 6e65  ined, "<undefine
-0000e990: 643e 225d 0a20 2020 2020 2020 2020 2020  d>"].           
-0000e9a0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0000e9b0: 2020 2020 7365 6c66 2e73 7566 6669 7820      self.suffix 
-0000e9c0: 3d20 2220 220a 0a20 2020 2020 2020 2020  = " "..         
-0000e9d0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-0000e9e0: 2020 2020 2020 2020 286e 6f74 2073 656c          (not sel
-0000e9f0: 662e 7072 6566 6978 290a 2020 2020 2020  f.prefix).      
-0000ea00: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
-0000ea10: 6c66 2e70 7265 6669 782e 6973 7370 6163  lf.prefix.isspac
-0000ea20: 6528 2929 0a20 2020 2020 2020 2020 2020  e()).           
-0000ea30: 2020 2020 206f 7220 2873 656c 662e 7072       or (self.pr
-0000ea40: 6566 6978 2069 6e20 5b55 6e64 6566 696e  efix in [Undefin
-0000ea50: 6564 2c20 223c 756e 6465 6669 6e65 643e  ed, "<undefined>
-0000ea60: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-0000ea70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000ea80: 2020 2073 656c 662e 7072 6566 6978 203d     self.prefix =
-0000ea90: 2022 2022 0a0a 2020 2020 2020 2020 2020   " "..          
-0000eaa0: 2020 7661 6c69 645f 6578 742c 2069 6e5f    valid_ext, in_
-0000eab0: 6578 742c 2066 696c 654e 616d 6520 3d20  ext, fileName = 
-0000eac0: 6368 6563 6b46 696c 6545 7874 2873 656c  checkFileExt(sel
-0000ead0: 662e 696e 5f66 696c 652c 2045 5854 290a  f.in_file, EXT).
-0000eae0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000eaf0: 6e6f 7420 7661 6c69 645f 6578 743a 0a20  not valid_ext:. 
-0000eb00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000eb10: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-0000eb20: 2020 2020 2020 2020 2020 225c 6e47 7261            "\nGra
-0000eb30: 6469 656e 7454 6872 6573 686f 6c64 2062  dientThreshold b
-0000eb40: 7269 636b 3a20 5468 6520 696e 7075 7420  rick: The input 
-0000eb50: 696d 6167 6520 666f 726d 6174 2069 7320  image format is 
-0000eb60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000eb70: 2020 2020 2020 226e 6f74 2072 6563 6f67        "not recog
-0000eb80: 6e69 7a65 642e 2e2e 2122 0a20 2020 2020  nized...!".     
-0000eb90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000eba0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000ebb0: 7572 6e0a 0a20 2020 2020 2020 2020 2020  urn..           
-0000ebc0: 2070 6174 682c 205f 203d 206f 732e 7061   path, _ = os.pa
-0000ebd0: 7468 2e73 706c 6974 2873 656c 662e 696e  th.split(self.in
-0000ebe0: 5f66 696c 6529 0a0a 2020 2020 2020 2020  _file)..        
-0000ebf0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-0000ec00: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
-0000ec10: 6666 6978 203d 3d20 2220 220a 2020 2020  ffix == " ".    
-0000ec20: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000ec30: 7365 6c66 2e70 7265 6669 7820 3d3d 2022  self.prefix == "
-0000ec40: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000ec50: 2020 2061 6e64 2070 6174 6820 3d3d 2073     and path == s
-0000ec60: 656c 662e 6f75 7470 7574 5f64 6972 6563  elf.output_direc
-0000ec70: 746f 7279 0a20 2020 2020 2020 2020 2020  tory.           
-0000ec80: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0000ec90: 2020 2020 6d73 6720 3d20 514d 6573 7361      msg = QMessa
-0000eca0: 6765 426f 7828 290a 2020 2020 2020 2020  geBox().        
-0000ecb0: 2020 2020 2020 2020 6d73 672e 7365 7449          msg.setI
-0000ecc0: 636f 6e28 514d 6573 7361 6765 426f 782e  con(QMessageBox.
-0000ecd0: 5761 726e 696e 6729 0a20 2020 2020 2020  Warning).       
-0000ece0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-0000ecf0: 5769 6e64 6f77 5469 746c 6528 0a20 2020  WindowTitle(.   
-0000ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed10: 2022 6d69 615f 7072 6f63 6573 7365 7320   "mia_processes 
-0000ed20: 2d20 4772 6164 6965 6e74 5468 7265 7368  - GradientThresh
-0000ed30: 6f6c 6420 6272 6963 6b20 5761 726e 696e  old brick Warnin
-0000ed40: 6721 220a 2020 2020 2020 2020 2020 2020  g!".            
-0000ed50: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000ed60: 2020 2020 2020 6d73 672e 7365 7454 6578        msg.setTex
-0000ed70: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000ed80: 2020 2020 2020 2022 5375 6666 6978 2061         "Suffix a
-0000ed90: 6e64 2070 7265 6669 7820 696e 7075 7420  nd prefix input 
-0000eda0: 7061 7261 6d65 7465 7273 2061 7265 206e  parameters are n
-0000edb0: 6f74 2022 0a20 2020 2020 2020 2020 2020  ot ".           
-0000edc0: 2020 2020 2020 2020 2022 6465 6669 6e65           "define
-0000edd0: 6420 6f72 2063 6f6e 7369 7374 206f 6e6c  d or consist onl
-0000ede0: 7920 6f66 206f 6e65 206f 7220 6d6f 7265  y of one or more
-0000edf0: 2077 6869 7465 2022 0a20 2020 2020 2020   white ".       
-0000ee00: 2020 2020 2020 2020 2020 2020 2022 7370               "sp
-0000ee10: 6163 6573 2e5c 6e54 6865 207b 307d 2069  aces.\nThe {0} i
-0000ee20: 6e70 7574 2070 6172 616d 6574 6572 2077  nput parameter w
-0000ee30: 696c 6c20 6265 2022 0a20 2020 2020 2020  ill be ".       
-0000ee40: 2020 2020 2020 2020 2020 2020 2022 6f76               "ov
-0000ee50: 6572 7772 6974 7465 6e20 2e2e 2e5c 6e20  erwritten ...\n 
-0000ee60: 5965 7320 6f72 2022 0a20 2020 2020 2020  Yes or ".       
-0000ee70: 2020 2020 2020 2020 2020 2020 2022 4162               "Ab
-0000ee80: 6f72 743f 222e 666f 726d 6174 2866 696c  ort?".format(fil
-0000ee90: 654e 616d 6529 0a20 2020 2020 2020 2020  eName).         
-0000eea0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000eeb0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-0000eec0: 5374 616e 6461 7264 4275 7474 6f6e 7328  StandardButtons(
-0000eed0: 514d 6573 7361 6765 426f 782e 5965 7320  QMessageBox.Yes 
-0000eee0: 7c20 514d 6573 7361 6765 426f 782e 4162  | QMessageBox.Ab
-0000eef0: 6f72 7429 0a20 2020 2020 2020 2020 2020  ort).           
-0000ef00: 2020 2020 2072 6574 7661 6c20 3d20 6d73       retval = ms
-0000ef10: 672e 6578 6563 5f28 290a 0a20 2020 2020  g.exec_()..     
-0000ef20: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0000ef30: 7476 616c 2021 3d20 514d 6573 7361 6765  tval != QMessage
-0000ef40: 426f 782e 4162 6f72 743a 0a20 2020 2020  Box.Abort:.     
-0000ef50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000ef60: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-0000ef70: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-0000ef80: 6e47 7261 6469 656e 7454 6872 6573 686f  nGradientThresho
-0000ef90: 6c64 2062 7269 636b 2077 6172 6e69 6e67  ld brick warning
-0000efa0: 3a20 7468 6520 6f75 745f 6669 6c65 220a  : the out_file".
-0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efc0: 2020 2020 2020 2020 226f 7574 7075 7420          "output 
-0000efd0: 7061 7261 6d65 7465 7220 6973 2074 6865  parameter is the
-0000efe0: 2073 616d 6520 6173 2074 6865 2069 6e5f   same as the in_
-0000eff0: 6669 6c65 2069 6e70 7574 2022 0a20 2020  file input ".   
-0000f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f010: 2020 2020 2022 7061 7261 6d65 7465 7220       "parameter 
-0000f020: 2873 7566 6669 7820 616e 6420 7072 6566  (suffix and pref
-0000f030: 6978 2061 7265 206e 6f74 2064 6566 696e  ix are not defin
-0000f040: 6564 293a 220a 2020 2020 2020 2020 2020  ed):".          
-0000f050: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-0000f060: 6e7b 307d 2077 696c 6c20 6265 206f 7665  n{0} will be ove
-0000f070: 7277 7269 7474 656e 202e 2e2e 222e 666f  rwritten ...".fo
-0000f080: 726d 6174 2866 696c 654e 616d 6529 0a20  rmat(fileName). 
-0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0a0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0000f0b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0d0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000f0f0: 5c6e 4772 6164 6965 6e74 5468 7265 7368  \nGradientThresh
-0000f100: 6f6c 6420 6272 6963 6b20 4162 6f72 7465  old brick Aborte
-0000f110: 642e 2050 6c65 6173 6520 6368 6563 6b20  d. Please check 
-0000f120: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000f130: 2020 2020 2020 2020 2020 2279 6f75 7220            "your 
-0000f140: 696e 7075 7420 7061 7261 6d65 7465 7273  input parameters
-0000f150: 202e 2e2e 220a 2020 2020 2020 2020 2020   ...".          
-0000f160: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f180: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-0000f190: 2020 2020 6669 6c65 203d 206f 732e 7061      file = os.pa
-0000f1a0: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
-0000f1b0: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
-0000f1c0: 7470 7574 5f64 6972 6563 746f 7279 2c0a  tput_directory,.
-0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000f1f0: 2020 2020 2020 7365 6c66 2e70 7265 6669        self.prefi
-0000f200: 782e 7374 7269 7028 290a 2020 2020 2020  x.strip().      
-0000f210: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000f220: 6669 6c65 4e61 6d65 0a20 2020 2020 2020  fileName.       
-0000f230: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-0000f240: 656c 662e 7375 6666 6978 2e73 7472 6970  elf.suffix.strip
-0000f250: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000f260: 2020 2020 2020 202b 2022 2e22 0a20 2020         + ".".   
-0000f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f280: 202b 2069 6e5f 6578 740a 2020 2020 2020   + in_ext.      
-0000f290: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-0000f2a0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000f2b0: 2020 2020 2020 2020 6966 2066 696c 653a          if file:
-0000f2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f2d0: 2073 656c 662e 6f75 7470 7574 735b 226f   self.outputs["o
-0000f2e0: 7574 5f66 696c 6522 5d20 3d20 6669 6c65  ut_file"] = file
-0000f2f0: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0000f300: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000f310: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0000f320: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000f330: 2d20 4772 6164 6965 6e74 5468 7265 7368  - GradientThresh
-0000f340: 6f6c 6420 6272 6963 6b3a 2054 6865 7265  old brick: There
-0000f350: 2077 6173 206e 6f20 6f75 7470 7574 2066   was no output f
-0000f360: 696c 6520 220a 2020 2020 2020 2020 2020  ile ".          
-0000f370: 2020 2020 2020 2020 2020 2264 6564 7563            "deduc
-0000f380: 7465 6420 6475 7269 6e67 2069 6e69 7469  ted during initi
-0000f390: 616c 697a 6174 696f 6e2e 2050 6c65 6173  alization. Pleas
-0000f3a0: 6520 6368 6563 6b20 7468 6520 696e 7075  e check the inpu
-0000f3b0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-0000f3c0: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
-0000f3d0: 6572 732e 2e2e 2122 0a20 2020 2020 2020  ers...!".       
-0000f3e0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000f3f0: 2020 2020 2020 2020 2320 7461 6773 2069          # tags i
-0000f400: 6e68 6572 6974 616e 6365 2028 6f70 7469  nheritance (opti
-0000f410: 6f6e 616c 290a 2020 2020 2020 2020 2020  onal).          
-0000f420: 2020 6966 2073 656c 662e 6f75 7470 7574    if self.output
-0000f430: 735b 226f 7574 5f66 696c 6522 5d3a 0a20  s["out_file"]:. 
-0000f440: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f450: 656c 662e 7461 6773 5f69 6e68 6572 6974  elf.tags_inherit
-0000f460: 616e 6365 280a 2020 2020 2020 2020 2020  ance(.          
-0000f470: 2020 2020 2020 2020 2020 696e 5f66 696c            in_fil
-0000f480: 653d 7365 6c66 2e69 6e5f 6669 6c65 2c0a  e=self.in_file,.
-0000f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4a0: 2020 2020 6f75 745f 6669 6c65 3d73 656c      out_file=sel
-0000f4b0: 662e 6f75 7470 7574 735b 226f 7574 5f66  f.outputs["out_f
-0000f4c0: 696c 6522 5d2c 0a20 2020 2020 2020 2020  ile"],.         
-0000f4d0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000f4e0: 2020 2320 5265 7475 726e 2074 6865 2072    # Return the r
-0000f4f0: 6571 7569 7265 6d65 6e74 2c20 6f75 7470  equirement, outp
-0000f500: 7574 7320 616e 6420 696e 6865 7269 7461  uts and inherita
-0000f510: 6e63 655f 6469 6374 0a20 2020 2020 2020  nce_dict.       
-0000f520: 2072 6574 7572 6e20 7365 6c66 2e6d 616b   return self.mak
-0000f530: 655f 696e 6974 5265 7375 6c74 2829 0a0a  e_initResult()..
-0000f540: 2020 2020 6465 6620 7275 6e5f 7072 6f63      def run_proc
-0000f550: 6573 735f 6d69 6128 7365 6c66 293a 0a20  ess_mia(self):. 
-0000f560: 2020 2020 2020 2022 2222 4465 6469 6361         """Dedica
-0000f570: 7465 6420 746f 2074 6865 2070 726f 6365  ted to the proce
-0000f580: 7373 206c 6175 6e63 6820 7374 6570 206f  ss launch step o
-0000f590: 6620 7468 6520 6272 6963 6b2e 2222 220a  f the brick.""".
-0000f5a0: 2020 2020 2020 2020 7375 7065 7228 4772          super(Gr
-0000f5b0: 6164 6965 6e74 5468 7265 7368 6f6c 642c  adientThreshold,
-0000f5c0: 2073 656c 6629 2e72 756e 5f70 726f 6365   self).run_proce
-0000f5d0: 7373 5f6d 6961 2829 0a0a 2020 2020 2020  ss_mia()..      
-0000f5e0: 2020 6669 6c65 5f6e 616d 6520 3d20 7365    file_name = se
-0000f5f0: 6c66 2e69 6e5f 6669 6c65 0a20 2020 2020  lf.in_file.     
-0000f600: 2020 2073 6567 5f66 696c 655f 6e61 6d65     seg_file_name
-0000f610: 203d 2073 656c 662e 7365 675f 6669 6c65   = self.seg_file
-0000f620: 0a0a 2020 2020 2020 2020 2320 496d 6167  ..        # Imag
-0000f630: 6520 7072 6f63 6573 7369 6e67 0a20 2020  e processing.   
-0000f640: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000f650: 2020 2020 2020 696d 6720 3d20 6e69 622e        img = nib.
-0000f660: 6c6f 6164 2866 696c 655f 6e61 6d65 290a  load(file_name).
-0000f670: 2020 2020 2020 2020 2020 2020 7365 675f              seg_
-0000f680: 696d 6720 3d20 6e69 622e 6c6f 6164 2873  img = nib.load(s
-0000f690: 6567 5f66 696c 655f 6e61 6d65 290a 0a20  eg_file_name).. 
-0000f6a0: 2020 2020 2020 2065 7863 6570 7420 280a         except (.
-0000f6b0: 2020 2020 2020 2020 2020 2020 6e69 622e              nib.
-0000f6c0: 6669 6c65 6261 7365 6469 6d61 6765 732e  filebasedimages.
-0000f6d0: 496d 6167 6546 696c 6545 7272 6f72 2c0a  ImageFileError,.
-0000f6e0: 2020 2020 2020 2020 2020 2020 4669 6c65              File
-0000f6f0: 4e6f 7446 6f75 6e64 4572 726f 722c 0a20  NotFoundError,. 
-0000f700: 2020 2020 2020 2020 2020 2054 7970 6545             TypeE
-0000f710: 7272 6f72 2c0a 2020 2020 2020 2020 2920  rror,.        ) 
-0000f720: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000f730: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-0000f740: 2020 2020 2020 2020 2022 5c6e 4772 6164           "\nGrad
-0000f750: 6965 6e74 5468 7265 7368 6f6c 6420 6272  ientThreshold br
-0000f760: 6963 6b3a 2045 7272 6f72 2077 6974 6820  ick: Error with 
-0000f770: 6669 6c65 2074 6f20 656e 6861 6e63 652c  file to enhance,
-0000f780: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000f790: 2020 2022 6475 7269 6e67 2074 6865 2072     "during the r
-0000f7a0: 756e 3a20 222c 0a20 2020 2020 2020 2020  un: ",.         
-0000f7b0: 2020 2020 2020 2065 2c0a 2020 2020 2020         e,.      
-0000f7c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000f7d0: 2020 2020 696d 6720 3d20 4e6f 6e65 0a20      img = None. 
-0000f7e0: 2020 2020 2020 2020 2020 2073 6567 5f69             seg_i
-0000f7f0: 6d67 203d 204e 6f6e 650a 0a20 2020 2020  mg = None..     
-0000f800: 2020 2069 6620 2869 6d67 2069 7320 6e6f     if (img is no
-0000f810: 7420 4e6f 6e65 2920 616e 6420 2873 6567  t None) and (seg
-0000f820: 5f69 6d67 2069 7320 6e6f 7420 4e6f 6e65  _img is not None
-0000f830: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-0000f840: 2049 6d61 6765 2067 7261 6469 656e 740a   Image gradient.
-0000f850: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0000f860: 203d 2069 6d67 2e67 6574 5f66 6461 7461   = img.get_fdata
-0000f870: 2829 2e61 7374 7970 6528 6e70 2e66 6c6f  ().astype(np.flo
-0000f880: 6174 3332 290a 2020 2020 2020 2020 2020  at32).          
-0000f890: 2020 6461 7461 5f6d 6178 203d 206e 702e    data_max = np.
-0000f8a0: 7065 7263 656e 7469 6c65 2864 6174 612e  percentile(data.
-0000f8b0: 7265 7368 6170 6528 2d31 292c 2039 392e  reshape(-1), 99.
-0000f8c0: 3529 0a20 2020 2020 2020 2020 2020 2064  5).            d
-0000f8d0: 6174 6120 2a3d 2031 3030 202f 2064 6174  ata *= 100 / dat
-0000f8e0: 615f 6d61 780a 2020 2020 2020 2020 2020  a_max.          
-0000f8f0: 2020 6772 6164 203d 2073 696d 2e67 6175    grad = sim.gau
-0000f900: 7373 6961 6e5f 6772 6164 6965 6e74 5f6d  ssian_gradient_m
-0000f910: 6167 6e69 7475 6465 2864 6174 612c 2033  agnitude(data, 3
-0000f920: 2e30 290a 2020 2020 2020 2020 2020 2020  .0).            
-0000f930: 6772 6164 5f6d 6178 203d 206e 702e 7065  grad_max = np.pe
-0000f940: 7263 656e 7469 6c65 2867 7261 642e 7265  rcentile(grad.re
-0000f950: 7368 6170 6528 2d31 292c 2039 392e 3529  shape(-1), 99.5)
-0000f960: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
-0000f970: 6420 2a3d 2031 3030 2e30 0a20 2020 2020  d *= 100.0.     
-0000f980: 2020 2020 2020 2067 7261 6420 2f3d 2067         grad /= g
-0000f990: 7261 645f 6d61 780a 0a20 2020 2020 2020  rad_max..       
-0000f9a0: 2020 2020 2023 2047 7261 6469 656e 7420       # Gradient 
-0000f9b0: 7468 7265 7368 6f6c 640a 2020 2020 2020  threshold.      
-0000f9c0: 2020 2020 2020 7374 7275 6320 3d20 7369        struc = si
-0000f9d0: 6d2e 6974 6572 6174 655f 7374 7275 6374  m.iterate_struct
-0000f9e0: 7572 6528 0a20 2020 2020 2020 2020 2020  ure(.           
-0000f9f0: 2020 2020 2073 696d 2e67 656e 6572 6174       sim.generat
-0000fa00: 655f 6269 6e61 7279 5f73 7472 7563 7475  e_binary_structu
-0000fa10: 7265 2833 2c20 3229 2c20 320a 2020 2020  re(3, 2), 2.    
-0000fa20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000fa30: 2020 2020 2020 6d61 736b 203d 206e 702e        mask = np.
-0000fa40: 7a65 726f 735f 6c69 6b65 2867 7261 642c  zeros_like(grad,
-0000fa50: 2064 7479 7065 3d6e 702e 7569 6e74 3829   dtype=np.uint8)
-0000fa60: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-0000fa70: 6b5b 6772 6164 203e 2031 352e 305d 203d  k[grad > 15.0] =
-0000fa80: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
-0000fa90: 7365 675f 6461 7461 203d 2073 6567 5f69  seg_data = seg_i
-0000faa0: 6d67 2e67 6574 5f66 6461 7461 2829 2e61  mg.get_fdata().a
-0000fab0: 7374 7970 6528 6e70 2e75 696e 7438 290a  stype(np.uint8).
-0000fac0: 2020 2020 2020 2020 2020 2020 7365 675f              seg_
-0000fad0: 6461 7461 5b73 6567 5f64 6174 6120 3e20  data[seg_data > 
-0000fae0: 305d 203d 2031 0a20 2020 2020 2020 2020  0] = 1.         
-0000faf0: 2020 2073 6567 5f64 6174 6120 3d20 7369     seg_data = si
-0000fb00: 6d2e 6269 6e61 7279 5f64 696c 6174 696f  m.binary_dilatio
-0000fb10: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0000fb20: 2020 2073 6567 5f64 6174 612c 2073 7472     seg_data, str
-0000fb30: 7563 2c20 6974 6572 6174 696f 6e73 3d32  uc, iterations=2
-0000fb40: 2c20 626f 7264 6572 5f76 616c 7565 3d31  , border_value=1
-0000fb50: 0a20 2020 2020 2020 2020 2020 2029 2e61  .            ).a
-0000fb60: 7374 7970 6528 6e70 2e75 696e 7438 290a  stype(np.uint8).
-0000fb70: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-0000fb80: 5b73 6567 5f64 6174 6120 3e20 305d 203d  [seg_data > 0] =
-0000fb90: 2031 0a20 2020 2020 2020 2020 2020 206d   1.            m
-0000fba0: 6173 6b20 3d20 7369 6d2e 6269 6e61 7279  ask = sim.binary
-0000fbb0: 5f63 6c6f 7369 6e67 286d 6173 6b2c 2073  _closing(mask, s
-0000fbc0: 7472 7563 2c20 6974 6572 6174 696f 6e73  truc, iterations
-0000fbd0: 3d32 292e 6173 7479 7065 280a 2020 2020  =2).astype(.    
-0000fbe0: 2020 2020 2020 2020 2020 2020 6e70 2e75              np.u
-0000fbf0: 696e 7438 0a20 2020 2020 2020 2020 2020  int8.           
-0000fc00: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-0000fc10: 6c61 6265 6c5f 696d 2c20 6e62 5f6c 6162  label_im, nb_lab
-0000fc20: 656c 7320 3d20 7369 6d2e 6c61 6265 6c28  els = sim.label(
-0000fc30: 6d61 736b 290a 2020 2020 2020 2020 2020  mask).          
-0000fc40: 2020 6172 746d 736b 203d 206e 702e 7a65    artmsk = np.ze
-0000fc50: 726f 735f 6c69 6b65 286d 6173 6b29 0a20  ros_like(mask). 
-0000fc60: 2020 2020 2020 2020 2020 2069 6620 6e62             if nb
-0000fc70: 5f6c 6162 656c 7320 3e20 323a 0a20 2020  _labels > 2:.   
-0000fc80: 2020 2020 2020 2020 2020 2020 2073 697a               siz
-0000fc90: 6573 203d 2073 696d 2e73 756d 286d 6173  es = sim.sum(mas
-0000fca0: 6b2c 206c 6162 656c 5f69 6d2c 206c 6973  k, label_im, lis
-0000fcb0: 7428 7261 6e67 6528 6e62 5f6c 6162 656c  t(range(nb_label
-0000fcc0: 7320 2b20 3129 2929 0a20 2020 2020 2020  s + 1))).       
-0000fcd0: 2020 2020 2020 2020 206f 7264 6572 6564           ordered
-0000fce0: 203d 206c 6973 7428 0a20 2020 2020 2020   = list(.       
-0000fcf0: 2020 2020 2020 2020 2020 2020 2072 6576               rev
-0000fd00: 6572 7365 6428 736f 7274 6564 287a 6970  ersed(sorted(zip
-0000fd10: 2873 697a 6573 2c20 6c69 7374 2872 616e  (sizes, list(ran
-0000fd20: 6765 286e 625f 6c61 6265 6c73 202b 2031  ge(nb_labels + 1
-0000fd30: 2929 2929 290a 2020 2020 2020 2020 2020  ))))).          
-0000fd40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000fd50: 2020 2020 2020 2020 666f 7220 5f2c 206c          for _, l
-0000fd60: 6162 656c 2069 6e20 6f72 6465 7265 645b  abel in ordered[
-0000fd70: 323a 5d3a 0a20 2020 2020 2020 2020 2020  2:]:.           
-0000fd80: 2020 2020 2020 2020 206d 6173 6b5b 6c61           mask[la
-0000fd90: 6265 6c5f 696d 203d 3d20 6c61 6265 6c5d  bel_im == label]
-0000fda0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0000fdb0: 2020 2020 2020 2020 2061 7274 6d73 6b5b           artmsk[
-0000fdc0: 6c61 6265 6c5f 696d 203d 3d20 6c61 6265  label_im == labe
-0000fdd0: 6c5d 203d 2031 0a0a 2020 2020 2020 2020  l] = 1..        
-0000fde0: 2020 2020 6d61 736b 203d 2073 696d 2e62      mask = sim.b
-0000fdf0: 696e 6172 795f 6669 6c6c 5f68 6f6c 6573  inary_fill_holes
-0000fe00: 286d 6173 6b2c 2073 7472 7563 292e 6173  (mask, struc).as
-0000fe10: 7479 7065 286e 702e 7569 6e74 3829 0a0a  type(np.uint8)..
-0000fe20: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0000fe30: 696d 6167 6520 3d20 696d 672e 5f5f 636c  image = img.__cl
-0000fe40: 6173 735f 5f28 6d61 736b 2c20 696d 672e  ass__(mask, img.
-0000fe50: 6166 6669 6e65 2c20 696d 672e 6865 6164  affine, img.head
-0000fe60: 6572 290a 0a20 2020 2020 2020 2020 2020  er)..           
-0000fe70: 2023 2049 6d61 6765 2073 6176 650a 2020   # Image save.  
-0000fe80: 2020 2020 2020 2020 2020 5f2c 2066 696c            _, fil
-0000fe90: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-0000fea0: 2e73 706c 6974 2866 696c 655f 6e61 6d65  .split(file_name
-0000feb0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-0000fec0: 6c65 5f6e 616d 655f 6e6f 5f65 7874 2c20  le_name_no_ext, 
-0000fed0: 6669 6c65 5f65 7874 656e 7369 6f6e 203d  file_extension =
-0000fee0: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-0000fef0: 7428 6669 6c65 5f6e 616d 6529 0a20 2020  t(file_name).   
-0000ff00: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-0000ff10: 5f65 7874 656e 7369 6f6e 203d 3d20 222e  _extension == ".
-0000ff20: 677a 223a 0a20 2020 2020 2020 2020 2020  gz":.           
-0000ff30: 2020 2020 2028 6669 6c65 5f6e 616d 655f       (file_name_
-0000ff40: 6e6f 5f65 7874 5f32 2c20 6669 6c65 5f65  no_ext_2, file_e
-0000ff50: 7874 656e 7369 6f6e 5f32 2920 3d20 6f73  xtension_2) = os
-0000ff60: 2e70 6174 682e 7370 6c69 7465 7874 280a  .path.splitext(.
-0000ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff80: 2020 2020 6669 6c65 5f6e 616d 655f 6e6f      file_name_no
-0000ff90: 5f65 7874 0a20 2020 2020 2020 2020 2020  _ext.           
-0000ffa0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000ffb0: 2020 2020 2020 2069 6620 6669 6c65 5f65         if file_e
-0000ffc0: 7874 656e 7369 6f6e 5f32 203d 3d20 222e  xtension_2 == ".
-0000ffd0: 6e69 6922 3a0a 2020 2020 2020 2020 2020  nii":.          
-0000ffe0: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
-0000fff0: 616d 655f 6e6f 5f65 7874 203d 2066 696c  ame_no_ext = fil
-00010000: 655f 6e61 6d65 5f6e 6f5f 6578 745f 320a  e_name_no_ext_2.
-00010010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010020: 2020 2020 6669 6c65 5f65 7874 656e 7369      file_extensi
-00010030: 6f6e 203d 2022 2e6e 6969 2e67 7a22 0a0a  on = ".nii.gz"..
-00010040: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00010050: 5f6f 7574 203d 206f 732e 7061 7468 2e6a  _out = os.path.j
-00010060: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
-00010070: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
-00010080: 5f64 6972 6563 746f 7279 2c0a 2020 2020  _directory,.    
-00010090: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-000100a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100b0: 2020 7365 6c66 2e70 7265 6669 782e 7374    self.prefix.st
-000100c0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-000100d0: 2020 2020 2020 2020 2020 2b20 6669 6c65            + file
-000100e0: 5f6e 616d 655f 6e6f 5f65 7874 0a20 2020  _name_no_ext.   
-000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010100: 202b 2073 656c 662e 7375 6666 6978 2e73   + self.suffix.s
-00010110: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-00010120: 2020 2020 2020 2020 2020 202b 2066 696c             + fil
-00010130: 655f 6578 7465 6e73 696f 6e0a 2020 2020  e_extension.    
-00010140: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-00010150: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00010160: 2020 2020 2020 2020 206e 6962 2e73 6176           nib.sav
-00010170: 6528 6f75 745f 696d 6167 652c 2066 696c  e(out_image, fil
-00010180: 655f 6f75 7429 0a0a 0a63 6c61 7373 2048  e_out)...class H
-00010190: 6172 6d6f 6e69 7a65 2850 726f 6365 7373  armonize(Process
-000101a0: 4d49 4129 3a0a 2020 2020 2222 220a 2020  MIA):.    """.  
-000101b0: 2020 2a48 6172 6d6f 6e69 7a65 2069 6e70    *Harmonize inp
-000101c0: 7574 2069 6d61 6765 2075 7369 6e67 2061  ut image using a
-000101d0: 2077 6869 7465 206d 6174 7465 7220 6d61   white matter ma
-000101e0: 736b 2a0a 0a20 2020 2050 6c65 6173 652c  sk*..    Please,
-000101f0: 2073 6565 2074 6865 2063 6f6d 706c 6574   see the complet
-00010200: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-00010210: 666f 7220 7468 6520 6048 6172 6d6f 6e69  for the `Harmoni
-00010220: 7a65 2062 7269 636b 0a20 2020 2069 6e20  ze brick.    in 
-00010230: 7468 6520 6d69 615f 7072 6f63 6573 7365  the mia_processe
-00010240: 7320 7765 6273 6974 650a 2020 2020 3c68  s website.    <h
-00010250: 7474 7073 3a2f 2f70 6f70 756c 7365 2e67  ttps://populse.g
-00010260: 6974 6875 622e 696f 2f6d 6961 5f70 726f  ithub.io/mia_pro
-00010270: 6365 7373 6573 2f68 746d 6c2f 646f 6375  cesses/html/docu
-00010280: 6d65 6e74 6174 696f 6e2f 6272 6963 6b73  mentation/bricks
-00010290: 2f70 7265 7072 6f63 6573 732f 6f74 6865  /preprocess/othe
-000102a0: 722f 4861 726d 6f6e 697a 652e 6874 6d6c  r/Harmonize.html
-000102b0: 3e60 5f0a 0a20 2020 2061 6461 7074 6564  >`_..    adapted
-000102c0: 2066 726f 6d3a 0a20 2020 2068 7474 7073   from:.    https
-000102d0: 3a2f 2f67 6974 6875 622e 636f 6d2f 6e69  ://github.com/ni
-000102e0: 7072 6570 732f 6d72 6971 632f 626c 6f62  preps/mriqc/blob
-000102f0: 2f65 3032 3130 3038 6461 3061 3265 6631  /e021008da0a2ef1
-00010300: 6334 3865 3838 3262 6166 3933 3231 3339  c48e882baf932139
-00010310: 6136 3733 3334 3966 392f 6d72 6971 632f  a673349f9/mriqc/
-00010320: 696e 7465 7266 6163 6573 2f61 6e61 746f  interfaces/anato
-00010330: 6d69 6361 6c2e 7079 234c 3430 350a 0a20  mical.py#L405.. 
-00010340: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-00010350: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0a  __init__(self):.
-00010360: 2020 2020 2020 2020 2222 2244 6564 6963          """Dedic
-00010370: 6174 6564 2074 6f20 7468 6520 6174 7472  ated to the attr
-00010380: 6962 7574 6573 2069 6e69 7469 616c 6973  ibutes initialis
-00010390: 6174 696f 6e20 2f20 696e 7374 616e 7469  ation / instanti
-000103a0: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-000103b0: 5468 6520 696e 7075 7420 616e 6420 6f75  The input and ou
-000103c0: 7470 7574 2070 6c75 6773 2061 7265 2064  tput plugs are d
-000103d0: 6566 696e 6564 2068 6572 652e 2054 6865  efined here. The
-000103e0: 2073 7065 6369 616c 0a20 2020 2020 2020   special.       
-000103f0: 2027 7365 6c66 2e72 6571 7569 7265 6d65   'self.requireme
-00010400: 6e74 2720 6174 7472 6962 7574 6520 286f  nt' attribute (o
-00010410: 7074 696f 6e61 6c29 2069 7320 7573 6564  ptional) is used
-00010420: 2074 6f20 6465 6669 6e65 2074 6865 0a20   to define the. 
-00010430: 2020 2020 2020 2074 6869 7264 2d70 6172         third-par
-00010440: 7479 2070 726f 6475 6374 7320 6e65 6365  ty products nece
-00010450: 7373 6172 7920 666f 7220 7468 6520 7275  ssary for the ru
-00010460: 6e6e 696e 6720 6f66 2074 6865 2062 7269  nning of the bri
-00010470: 636b 2e0a 2020 2020 2020 2020 2222 220a  ck..        """.
-00010480: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
-00010490: 6c69 7361 7469 6f6e 206f 6620 7468 6520  lisation of the 
-000104a0: 6f62 6a65 6374 7320 6e65 6564 6564 2066  objects needed f
-000104b0: 6f72 2074 6865 206c 6175 6e63 6820 6f66  or the launch of
-000104c0: 2074 6865 2062 7269 636b 0a20 2020 2020   the brick.     
-000104d0: 2020 2073 7570 6572 2848 6172 6d6f 6e69     super(Harmoni
-000104e0: 7a65 2c20 7365 6c66 292e 5f5f 696e 6974  ze, self).__init
-000104f0: 5f5f 2829 0a0a 2020 2020 2020 2020 2320  __()..        # 
-00010500: 5468 6972 6420 7061 7274 7920 736f 6674  Third party soft
-00010510: 7761 7265 7320 7265 7175 6972 6564 2066  wares required f
-00010520: 6f72 2074 6865 2065 7865 6375 7469 6f6e  or the execution
-00010530: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
-00010540: 2020 2020 2020 7365 6c66 2e72 6571 7569        self.requi
-00010550: 7265 6d65 6e74 203d 205b 5d0a 0a20 2020  rement = []..   
-00010560: 2020 2020 2023 2049 6e70 7574 7320 6465       # Inputs de
-00010570: 7363 7269 7074 696f 6e0a 2020 2020 2020  scription.      
-00010580: 2020 696e 5f66 696c 655f 6465 7363 203d    in_file_desc =
-00010590: 2022 416e 2065 7869 7374 696e 6720 7061   "An existing pa
-000105a0: 7468 2066 696c 652e 220a 2020 2020 2020  th file.".      
-000105b0: 2020 776d 5f6d 6173 6b5f 6465 7363 203d    wm_mask_desc =
-000105c0: 2022 416e 2065 7869 7374 696e 6720 7061   "An existing pa
-000105d0: 7468 206f 6620 6120 574d 206d 6173 6b20  th of a WM mask 
-000105e0: 6669 6c65 2e22 0a20 2020 2020 2020 2065  file.".        e
-000105f0: 726f 6465 6d61 736b 5f64 6573 6320 3d20  rodemask_desc = 
-00010600: 2242 6f6f 6c65 616e 2028 6120 7374 7269  "Boolean (a stri
-00010610: 6e67 292e 220a 2020 2020 2020 2020 7375  ng).".        su
-00010620: 6666 6978 5f64 6573 6320 3d20 2253 7566  ffix_desc = "Suf
-00010630: 6669 7820 6f66 2074 6865 206f 7574 7075  fix of the outpu
-00010640: 7420 696d 6167 6520 2861 2073 7472 696e  t image (a strin
-00010650: 6729 2e22 0a20 2020 2020 2020 2070 7265  g).".        pre
-00010660: 6669 785f 6465 7363 203d 2022 5072 6566  fix_desc = "Pref
-00010670: 6978 206f 6620 7468 6520 6f75 7470 7574  ix of the output
-00010680: 2069 6d61 6765 2028 6120 7374 7269 6e67   image (a string
-00010690: 292e 220a 0a20 2020 2020 2020 2023 204f  )."..        # O
-000106a0: 7574 7075 7473 2064 6573 6372 6970 7469  utputs descripti
-000106b0: 6f6e 0a20 2020 2020 2020 206f 7574 5f66  on.        out_f
-000106c0: 696c 655f 6465 7363 203d 2028 0a20 2020  ile_desc = (.   
-000106d0: 2020 2020 2020 2020 2022 5061 7468 206f           "Path o
-000106e0: 6620 7468 6520 6861 726d 6f6e 697a 6564  f the harmonized
-000106f0: 2069 6d61 6765 2022 0a20 2020 2020 2020   image ".       
-00010700: 2020 2020 2022 2861 2070 6174 686c 696b       "(a pathlik
-00010710: 6520 6f62 6a65 6374 206f 7220 7374 7269  e object or stri
-00010720: 6e67 2072 6570 7265 7365 6e74 696e 6720  ng representing 
-00010730: 6120 6669 6c65 292e 220a 2020 2020 2020  a file).".      
-00010740: 2020 290a 0a20 2020 2020 2020 2023 2049    )..        # I
-00010750: 6e70 7574 7320 7472 6169 7473 0a20 2020  nputs traits.   
-00010760: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-00010770: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-00010780: 2022 696e 5f66 696c 6522 2c20 4669 6c65   "in_file", File
-00010790: 286f 7574 7075 743d 4661 6c73 652c 206f  (output=False, o
-000107a0: 7074 696f 6e61 6c3d 4661 6c73 652c 2064  ptional=False, d
-000107b0: 6573 633d 696e 5f66 696c 655f 6465 7363  esc=in_file_desc
-000107c0: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-000107d0: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-000107e0: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-000107f0: 2022 776d 5f6d 6173 6b22 2c20 4669 6c65   "wm_mask", File
-00010800: 286f 7574 7075 743d 4661 6c73 652c 206f  (output=False, o
-00010810: 7074 696f 6e61 6c3d 4661 6c73 652c 2064  ptional=False, d
-00010820: 6573 633d 776d 5f6d 6173 6b5f 6465 7363  esc=wm_mask_desc
-00010830: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-00010840: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-00010850: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-00010860: 2022 6572 6f64 656d 6173 6b22 2c0a 2020   "erodemask",.  
-00010870: 2020 2020 2020 2020 2020 7472 6169 7473            traits
-00010880: 2e42 6f6f 6c28 0a20 2020 2020 2020 2020  .Bool(.         
-00010890: 2020 2020 2020 2054 7275 652c 206f 7574         True, out
-000108a0: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
-000108b0: 6e61 6c3d 5472 7565 2c20 6465 7363 3d65  nal=True, desc=e
-000108c0: 726f 6465 6d61 736b 5f64 6573 630a 2020  rodemask_desc.  
-000108d0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-000108e0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-000108f0: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-00010900: 2020 2020 2020 2020 2020 2022 7072 6566             "pref
-00010910: 6978 222c 0a20 2020 2020 2020 2020 2020  ix",.           
-00010920: 2074 7261 6974 732e 5374 7269 6e67 2822   traits.String("
-00010930: 222c 206f 7574 7075 743d 4661 6c73 652c  ", output=False,
-00010940: 206f 7074 696f 6e61 6c3d 5472 7565 2c20   optional=True, 
-00010950: 6465 7363 3d70 7265 6669 785f 6465 7363  desc=prefix_desc
-00010960: 292c 0a20 2020 2020 2020 2029 0a20 2020  ),.        ).   
-00010970: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-00010980: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-00010990: 2022 7375 6666 6978 222c 0a20 2020 2020   "suffix",.     
-000109a0: 2020 2020 2020 2074 7261 6974 732e 5374         traits.St
-000109b0: 7269 6e67 280a 2020 2020 2020 2020 2020  ring(.          
-000109c0: 2020 2020 2020 225f 6861 726d 6f6e 697a        "_harmoniz
-000109d0: 6564 222c 206f 7574 7075 743d 4661 6c73  ed", output=Fals
-000109e0: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
-000109f0: 2c20 6465 7363 3d73 7566 6669 785f 6465  , desc=suffix_de
-00010a00: 7363 0a20 2020 2020 2020 2020 2020 2029  sc.            )
-00010a10: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00010a20: 2020 2020 2023 204f 7574 7075 7473 2074       # Outputs t
-00010a30: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
-00010a40: 6c66 2e61 6464 5f74 7261 6974 2822 6f75  lf.add_trait("ou
-00010a50: 745f 6669 6c65 222c 2046 696c 6528 6f75  t_file", File(ou
-00010a60: 7470 7574 3d54 7275 652c 2064 6573 633d  tput=True, desc=
-00010a70: 6f75 745f 6669 6c65 5f64 6573 6329 290a  out_file_desc)).
-00010a80: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00010a90: 6974 5f64 6566 6175 6c74 5f74 7261 6974  it_default_trait
-00010aa0: 7328 290a 0a20 2020 2064 6566 206c 6973  s()..    def lis
-00010ab0: 745f 6f75 7470 7574 7328 7365 6c66 2c20  t_outputs(self, 
-00010ac0: 6973 5f70 6c75 6767 6564 3d4e 6f6e 6529  is_plugged=None)
-00010ad0: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
-00010ae0: 6963 6174 6564 2074 6f20 7468 6520 696e  icated to the in
-00010af0: 6974 6961 6c69 7361 7469 6f6e 2073 7465  itialisation ste
-00010b00: 7020 6f66 2074 6865 2062 7269 636b 2e0a  p of the brick..
-00010b10: 0a20 2020 2020 2020 2054 6865 206d 6169  .        The mai
-00010b20: 6e20 6f62 6a65 6374 6976 6520 6f66 2074  n objective of t
-00010b30: 6869 7320 6d65 7468 6f64 2069 7320 746f  his method is to
-00010b40: 2070 726f 6475 6365 2074 6865 206f 7574   produce the out
-00010b50: 7075 7473 206f 6620 7468 650a 2020 2020  puts of the.    
-00010b60: 2020 2020 6272 6963 6b73 2028 7365 6c66      bricks (self
-00010b70: 2e6f 7574 7075 7473 2920 616e 6420 7468  .outputs) and th
-00010b80: 6520 6173 736f 6369 6174 6564 2074 6167  e associated tag
-00010b90: 7320 2873 656c 662e 696e 6865 7269 7461  s (self.inherita
-00010ba0: 6e63 655f 6469 6329 2c0a 2020 2020 2020  nce_dic),.      
-00010bb0: 2020 6966 2064 6566 696e 6564 2068 6572    if defined her
-00010bc0: 652e 2054 6f20 776f 726b 2070 726f 7065  e. To work prope
-00010bd0: 726c 7920 7468 6973 206d 6574 686f 6420  rly this method 
-00010be0: 6d75 7374 2072 6574 7572 6e0a 2020 2020  must return.    
-00010bf0: 2020 2020 7365 6c66 2e6d 616b 655f 696e      self.make_in
-00010c00: 6974 5265 7375 6c74 2829 206f 626a 6563  itResult() objec
-00010c10: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
-00010c20: 616d 2069 735f 706c 7567 6765 643a 2074  am is_plugged: t
-00010c30: 6865 2073 7461 7465 2c20 6c69 6e6b 6564  he state, linked
-00010c40: 206f 7220 6e6f 742c 206f 6620 7468 6520   or not, of the 
-00010c50: 706c 7567 732e 0a20 2020 2020 2020 203a  plugs..        :
-00010c60: 7265 7475 726e 733a 2061 2064 6963 7469  returns: a dicti
-00010c70: 6f6e 6172 7920 7769 7468 2072 6571 7569  onary with requi
-00010c80: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
-00010c90: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
-00010ca0: 6469 6374 2e0a 2020 2020 2020 2020 2222  dict..        ""
-00010cb0: 220a 2020 2020 2020 2020 2320 5573 696e  ".        # Usin
-00010cc0: 6720 7468 6520 696e 6865 7269 7461 6e63  g the inheritanc
-00010cd0: 6520 746f 2050 726f 6365 7373 4d49 4120  e to ProcessMIA 
-00010ce0: 636c 6173 732c 206c 6973 745f 6f75 7470  class, list_outp
-00010cf0: 7574 7320 6d65 7468 6f64 0a20 2020 2020  uts method.     
-00010d00: 2020 2073 7570 6572 2848 6172 6d6f 6e69     super(Harmoni
-00010d10: 7a65 2c20 7365 6c66 292e 6c69 7374 5f6f  ze, self).list_o
-00010d20: 7574 7075 7473 2829 0a0a 2020 2020 2020  utputs()..      
-00010d30: 2020 2320 4f75 7470 7574 7320 6465 6669    # Outputs defi
-00010d40: 6e69 7469 6f6e 0a20 2020 2020 2020 2069  nition.        i
-00010d50: 6620 7365 6c66 2e69 6e5f 6669 6c65 3a0a  f self.in_file:.
-00010d60: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
-00010d70: 645f 6578 742c 2069 6e5f 6578 742c 2066  d_ext, in_ext, f
-00010d80: 696c 654e 616d 6520 3d20 6368 6563 6b46  ileName = checkF
-00010d90: 696c 6545 7874 2873 656c 662e 696e 5f66  ileExt(self.in_f
-00010da0: 696c 652c 2045 5854 290a 0a20 2020 2020  ile, EXT)..     
-00010db0: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
-00010dc0: 6c69 645f 6578 743a 0a20 2020 2020 2020  lid_ext:.       
-00010dd0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00010de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010df0: 2020 2020 225c 6e48 6172 6d6f 6e69 7a65      "\nHarmonize
-00010e00: 2062 7269 636b 3a20 5468 6520 696e 7075   brick: The inpu
-00010e10: 7420 696d 6167 6520 666f 726d 6174 2069  t image format i
-00010e20: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
-00010e30: 2020 2020 2020 2020 226e 6f74 2072 6563          "not rec
-00010e40: 6f67 6e69 7a65 642e 2e2e 2122 0a20 2020  ognized...!".   
-00010e50: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00010e60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00010e70: 6574 7572 6e0a 0a20 2020 2020 2020 2020  eturn..         
-00010e80: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00010e90: 2020 2020 2020 2020 286e 6f74 2073 656c          (not sel
-00010ea0: 662e 7375 6666 6978 290a 2020 2020 2020  f.suffix).      
-00010eb0: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
-00010ec0: 6c66 2e73 7566 6669 782e 6973 7370 6163  lf.suffix.isspac
-00010ed0: 6528 2929 0a20 2020 2020 2020 2020 2020  e()).           
-00010ee0: 2020 2020 206f 7220 7365 6c66 2e73 7566       or self.suf
-00010ef0: 6669 7820 696e 205b 556e 6465 6669 6e65  fix in [Undefine
-00010f00: 642c 2022 3c75 6e64 6566 696e 6564 3e22  d, "<undefined>"
-00010f10: 5d0a 2020 2020 2020 2020 2020 2020 293a  ].            ):
-00010f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010f30: 2073 656c 662e 7375 6666 6978 203d 2022   self.suffix = "
-00010f40: 2022 0a0a 2020 2020 2020 2020 2020 2020   "..            
-00010f50: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00010f60: 2020 2020 2028 6e6f 7420 7365 6c66 2e70       (not self.p
-00010f70: 7265 6669 7829 0a20 2020 2020 2020 2020  refix).         
-00010f80: 2020 2020 2020 206f 7220 2873 656c 662e         or (self.
-00010f90: 7072 6566 6978 2e69 7373 7061 6365 2829  prefix.isspace()
-00010fa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00010fb0: 2020 6f72 2028 7365 6c66 2e70 7265 6669    or (self.prefi
-00010fc0: 7820 696e 205b 556e 6465 6669 6e65 642c  x in [Undefined,
-00010fd0: 2022 3c75 6e64 6566 696e 6564 3e22 5d29   "<undefined>"])
-00010fe0: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011000: 7365 6c66 2e70 7265 6669 7820 3d20 2220  self.prefix = " 
-00011010: 220a 0a20 2020 2020 2020 2020 2020 2070  "..            p
-00011020: 6174 682c 205f 203d 206f 732e 7061 7468  ath, _ = os.path
-00011030: 2e73 706c 6974 2873 656c 662e 696e 5f66  .split(self.in_f
-00011040: 696c 6529 0a0a 2020 2020 2020 2020 2020  ile)..          
-00011050: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00011060: 2020 2020 2020 2073 656c 662e 7375 6666         self.suff
-00011070: 6978 203d 3d20 2220 220a 2020 2020 2020  ix == " ".      
-00011080: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-00011090: 6c66 2e70 7265 6669 7820 3d3d 2022 2022  lf.prefix == " "
-000110a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000110b0: 2061 6e64 2070 6174 6820 3d3d 2073 656c   and path == sel
-000110c0: 662e 6f75 7470 7574 5f64 6972 6563 746f  f.output_directo
-000110d0: 7279 0a20 2020 2020 2020 2020 2020 2029  ry.            )
-000110e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000110f0: 2020 6d73 6720 3d20 514d 6573 7361 6765    msg = QMessage
-00011100: 426f 7828 290a 2020 2020 2020 2020 2020  Box().          
-00011110: 2020 2020 2020 6d73 672e 7365 7449 636f        msg.setIco
-00011120: 6e28 514d 6573 7361 6765 426f 782e 5761  n(QMessageBox.Wa
-00011130: 726e 696e 6729 0a20 2020 2020 2020 2020  rning).         
-00011140: 2020 2020 2020 206d 7367 2e73 6574 5769         msg.setWi
-00011150: 6e64 6f77 5469 746c 6528 226d 6961 5f70  ndowTitle("mia_p
-00011160: 726f 6365 7373 6573 202d 2048 6172 6d6f  rocesses - Harmo
-00011170: 6e69 7a65 2062 7269 636b 2057 6172 6e69  nize brick Warni
-00011180: 6e67 2122 290a 2020 2020 2020 2020 2020  ng!").          
-00011190: 2020 2020 2020 6d73 672e 7365 7454 6578        msg.setTex
-000111a0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-000111b0: 2020 2020 2020 2022 5375 6666 6978 2061         "Suffix a
-000111c0: 6e64 2070 7265 6669 7820 696e 7075 7420  nd prefix input 
-000111d0: 7061 7261 6d65 7465 7273 2061 7265 206e  parameters are n
-000111e0: 6f74 2022 0a20 2020 2020 2020 2020 2020  ot ".           
-000111f0: 2020 2020 2020 2020 2022 6465 6669 6e65           "define
-00011200: 6420 6f72 2063 6f6e 7369 7374 206f 6e6c  d or consist onl
-00011210: 7920 6f66 206f 6e65 206f 7220 6d6f 7265  y of one or more
-00011220: 2077 6869 7465 2022 0a20 2020 2020 2020   white ".       
-00011230: 2020 2020 2020 2020 2020 2020 2022 7370               "sp
-00011240: 6163 6573 2e5c 6e54 6865 207b 307d 2069  aces.\nThe {0} i
-00011250: 6e70 7574 2070 6172 616d 6574 6572 2077  nput parameter w
-00011260: 696c 6c20 6265 2022 0a20 2020 2020 2020  ill be ".       
-00011270: 2020 2020 2020 2020 2020 2020 2022 6f76               "ov
-00011280: 6572 7772 6974 7465 6e20 2e2e 2e5c 6e20  erwritten ...\n 
-00011290: 5965 7320 6f72 2022 0a20 2020 2020 2020  Yes or ".       
-000112a0: 2020 2020 2020 2020 2020 2020 2022 4162               "Ab
-000112b0: 6f72 743f 222e 666f 726d 6174 2866 696c  ort?".format(fil
-000112c0: 654e 616d 6529 0a20 2020 2020 2020 2020  eName).         
-000112d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000112e0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-000112f0: 5374 616e 6461 7264 4275 7474 6f6e 7328  StandardButtons(
-00011300: 514d 6573 7361 6765 426f 782e 5965 7320  QMessageBox.Yes 
-00011310: 7c20 514d 6573 7361 6765 426f 782e 4162  | QMessageBox.Ab
-00011320: 6f72 7429 0a20 2020 2020 2020 2020 2020  ort).           
-00011330: 2020 2020 2072 6574 7661 6c20 3d20 6d73       retval = ms
-00011340: 672e 6578 6563 5f28 290a 0a20 2020 2020  g.exec_()..     
-00011350: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00011360: 7476 616c 2021 3d20 514d 6573 7361 6765  tval != QMessage
-00011370: 426f 782e 4162 6f72 743a 0a20 2020 2020  Box.Abort:.     
-00011380: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00011390: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-000113a0: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-000113b0: 6e48 6172 6d6f 6e69 7a65 2062 7269 636b  nHarmonize brick
-000113c0: 2077 6172 6e69 6e67 3a20 7468 6520 6f75   warning: the ou
-000113d0: 745f 6669 6c65 206f 7574 7075 7420 220a  t_file output ".
-000113e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113f0: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
-00011400: 6572 2069 7320 7468 6520 7361 6d65 2061  er is the same a
-00011410: 7320 7468 6520 696e 5f66 696c 6520 696e  s the in_file in
-00011420: 7075 7420 220a 2020 2020 2020 2020 2020  put ".          
-00011430: 2020 2020 2020 2020 2020 2020 2020 2270                "p
-00011440: 6172 616d 6574 6572 2028 7375 6666 6978  arameter (suffix
-00011450: 2061 6e64 2070 7265 6669 7820 6172 6520   and prefix are 
-00011460: 6e6f 7420 6465 6669 6e65 6429 3a22 0a20  not defined):". 
-00011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011480: 2020 2020 2020 2022 5c6e 7b30 7d20 7769         "\n{0} wi
-00011490: 6c6c 2062 6520 6f76 6572 7772 6974 6564  ll be overwrited
-000114a0: 202e 2e2e 222e 666f 726d 6174 2866 696c   ...".format(fil
-000114b0: 654e 616d 6529 0a20 2020 2020 2020 2020  eName).         
-000114c0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000114d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000114e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000114f0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-00011500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011510: 2020 2020 2020 2022 5c6e 4861 726d 6f6e         "\nHarmon
-00011520: 697a 6520 6272 6963 6b3a 2041 626f 7274  ize brick: Abort
-00011530: 6564 2e20 506c 6561 7365 2063 6865 636b  ed. Please check
-00011540: 2079 6f75 7220 220a 2020 2020 2020 2020   your ".        
-00011550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011560: 2269 6e70 7574 2070 6172 616d 6574 6572  "input parameter
-00011570: 7320 2e2e 2e22 0a20 2020 2020 2020 2020  s ...".         
-00011580: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00011590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115a0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-000115b0: 2020 2020 2066 696c 6520 3d20 6f73 2e70       file = os.p
-000115c0: 6174 682e 6a6f 696e 280a 2020 2020 2020  ath.join(.      
-000115d0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-000115e0: 7574 7075 745f 6469 7265 6374 6f72 792c  utput_directory,
-000115f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011600: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00011610: 2020 2020 2020 2073 656c 662e 7072 6566         self.pref
-00011620: 6978 2e73 7472 6970 2829 0a20 2020 2020  ix.strip().     
-00011630: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00011640: 2066 696c 654e 616d 650a 2020 2020 2020   fileName.      
-00011650: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00011660: 7365 6c66 2e73 7566 6669 782e 7374 7269  self.suffix.stri
-00011670: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00011680: 2020 2020 2020 2020 2b20 222e 220a 2020          + ".".  
-00011690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116a0: 2020 2b20 696e 5f65 7874 0a20 2020 2020    + in_ext.     
-000116b0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-000116c0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000116d0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-000116e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000116f0: 2020 7365 6c66 2e6f 7574 7075 7473 5b22    self.outputs["
-00011700: 6f75 745f 6669 6c65 225d 203d 2066 696c  out_file"] = fil
-00011710: 650a 0a20 2020 2020 2020 2020 2020 2065  e..            e
-00011720: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00011730: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
-00011740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011750: 222d 2048 6172 6d6f 6e69 7a65 2062 7269  "- Harmonize bri
-00011760: 636b 3a20 5468 6572 6520 7761 7320 6e6f  ck: There was no
-00011770: 206f 7574 7075 7420 6669 6c65 2064 6564   output file ded
-00011780: 7563 7465 6420 220a 2020 2020 2020 2020  ucted ".        
-00011790: 2020 2020 2020 2020 2020 2020 2264 7572              "dur
-000117a0: 696e 6720 696e 6974 6961 6c69 7a61 7469  ing initializati
-000117b0: 6f6e 2e20 506c 6561 7365 2063 6865 636b  on. Please check
-000117c0: 2074 6865 2069 6e70 7574 2022 0a20 2020   the input ".   
-000117d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117e0: 2022 7061 7261 6d65 7465 7273 2e2e 2e21   "parameters...!
-000117f0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00011800: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00011810: 2023 2074 6167 7320 696e 6865 7269 7461   # tags inherita
-00011820: 6e63 6520 286f 7074 696f 6e61 6c29 0a20  nce (optional). 
-00011830: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00011840: 6c66 2e6f 7574 7075 7473 5b22 6f75 745f  lf.outputs["out_
-00011850: 6669 6c65 225d 3a0a 2020 2020 2020 2020  file"]:.        
-00011860: 2020 2020 2020 2020 7365 6c66 2e74 6167          self.tag
-00011870: 735f 696e 6865 7269 7461 6e63 6528 0a20  s_inheritance(. 
-00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011890: 2020 2069 6e5f 6669 6c65 3d73 656c 662e     in_file=self.
-000118a0: 696e 5f66 696c 652c 0a20 2020 2020 2020  in_file,.       
-000118b0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-000118c0: 5f66 696c 653d 7365 6c66 2e6f 7574 7075  _file=self.outpu
-000118d0: 7473 5b22 6f75 745f 6669 6c65 225d 2c0a  ts["out_file"],.
-000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118f0: 290a 0a20 2020 2020 2020 2023 2052 6574  )..        # Ret
-00011900: 7572 6e20 7468 6520 7265 7175 6972 656d  urn the requirem
-00011910: 656e 742c 206f 7574 7075 7473 2061 6e64  ent, outputs and
-00011920: 2069 6e68 6572 6974 616e 6365 5f64 6963   inheritance_dic
-00011930: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
-00011940: 2073 656c 662e 6d61 6b65 5f69 6e69 7452   self.make_initR
-00011950: 6573 756c 7428 290a 0a20 2020 2064 6566  esult()..    def
-00011960: 2072 756e 5f70 726f 6365 7373 5f6d 6961   run_process_mia
-00011970: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00011980: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
-00011990: 7468 6520 7072 6f63 6573 7320 6c61 756e  the process laun
-000119a0: 6368 2073 7465 7020 6f66 2074 6865 2062  ch step of the b
-000119b0: 7269 636b 2e22 2222 0a20 2020 2020 2020  rick.""".       
-000119c0: 2073 7570 6572 2848 6172 6d6f 6e69 7a65   super(Harmonize
-000119d0: 2c20 7365 6c66 292e 7275 6e5f 7072 6f63  , self).run_proc
-000119e0: 6573 735f 6d69 6128 290a 0a20 2020 2020  ess_mia()..     
-000119f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00011a00: 2020 2020 696d 6720 3d20 6e69 622e 6c6f      img = nib.lo
-00011a10: 6164 2873 656c 662e 696e 5f66 696c 6529  ad(self.in_file)
-00011a20: 0a20 2020 2020 2020 2020 2020 2077 6d5f  .            wm_
-00011a30: 696d 6720 3d20 6e69 622e 6c6f 6164 2873  img = nib.load(s
-00011a40: 656c 662e 776d 5f6d 6173 6b29 2e67 6574  elf.wm_mask).get
-00011a50: 5f66 6461 7461 2829 0a20 2020 2020 2020  _fdata().       
-00011a60: 2065 7863 6570 7420 280a 2020 2020 2020   except (.      
-00011a70: 2020 2020 2020 6e69 622e 6669 6c65 6261        nib.fileba
-00011a80: 7365 6469 6d61 6765 732e 496d 6167 6546  sedimages.ImageF
-00011a90: 696c 6545 7272 6f72 2c0a 2020 2020 2020  ileError,.      
-00011aa0: 2020 2020 2020 4669 6c65 4e6f 7446 6f75        FileNotFou
-00011ab0: 6e64 4572 726f 722c 0a20 2020 2020 2020  ndError,.       
-00011ac0: 2020 2020 2054 7970 6545 7272 6f72 2c0a       TypeError,.
-00011ad0: 2020 2020 2020 2020 2920 6173 2065 3a0a          ) as e:.
-00011ae0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00011af0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00011b00: 2020 2022 5c6e 4861 726d 6f6e 697a 6520     "\nHarmonize 
-00011b10: 6272 6963 6b3a 2045 7272 6f72 2077 6974  brick: Error wit
-00011b20: 6820 6669 6c65 2074 6f20 656e 6861 6e63  h file to enhanc
-00011b30: 652c 2064 7572 696e 6720 7468 6520 220a  e, during the ".
-00011b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b50: 2272 756e 3a20 222c 0a20 2020 2020 2020  "run: ",.       
-00011b60: 2020 2020 2020 2020 2065 2c0a 2020 2020           e,.    
-00011b70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00011b80: 2020 2020 2020 696d 6720 3d20 4e6f 6e65        img = None
-00011b90: 0a20 2020 2020 2020 2020 2020 2077 6d5f  .            wm_
-00011ba0: 696d 6720 3d20 4e6f 6e65 0a0a 2020 2020  img = None..    
-00011bb0: 2020 2020 6966 2028 696d 6720 6973 206e      if (img is n
-00011bc0: 6f74 204e 6f6e 6529 2061 6e64 2028 776d  ot None) and (wm
-00011bd0: 5f69 6d67 2069 7320 6e6f 7420 4e6f 6e65  _img is not None
-00011be0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
-00011bf0: 6d5f 696d 675b 776d 5f69 6d67 203c 2030  m_img[wm_img < 0
-00011c00: 2e39 5d20 3d20 300a 2020 2020 2020 2020  .9] = 0.        
-00011c10: 2020 2020 776d 5f69 6d67 5b77 6d5f 696d      wm_img[wm_im
-00011c20: 6720 3e20 305d 203d 2031 0a20 2020 2020  g > 0] = 1.     
-00011c30: 2020 2020 2020 2077 6d5f 6d61 736b 203d         wm_mask =
-00011c40: 2077 6d5f 696d 672e 6173 7479 7065 286e   wm_img.astype(n
-00011c50: 702e 7569 6e74 3829 0a0a 2020 2020 2020  p.uint8)..      
-00011c60: 2020 2020 2020 6966 2073 656c 662e 6572        if self.er
-00011c70: 6f64 656d 6173 6b3a 0a20 2020 2020 2020  odemask:.       
-00011c80: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
-00011c90: 6520 6120 7374 7275 6374 7572 616c 2065  e a structural e
-00011ca0: 6c65 6d65 6e74 2074 6f20 6265 2075 7365  lement to be use
-00011cb0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00011cc0: 2020 2320 696e 2061 6e20 6f70 656e 696e    # in an openin
-00011cd0: 6720 6f70 6572 6174 696f 6e2e 0a20 2020  g operation..   
-00011ce0: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00011cf0: 7563 203d 2073 696d 2e67 656e 6572 6174  uc = sim.generat
-00011d00: 655f 6269 6e61 7279 5f73 7472 7563 7475  e_binary_structu
-00011d10: 7265 2833 2c20 3229 0a20 2020 2020 2020  re(3, 2).       
-00011d20: 2020 2020 2020 2020 2023 2050 6572 666f           # Perfo
-00011d30: 726d 2061 6e20 6f70 656e 696e 6720 6f70  rm an opening op
-00011d40: 6572 6174 696f 6e20 6f6e 2074 6865 2062  eration on the b
-00011d50: 6163 6b67 726f 756e 6420 6461 7461 2e0a  ackground data..
-00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d70: 776d 5f6d 6173 6b20 3d20 7369 6d2e 6269  wm_mask = sim.bi
-00011d80: 6e61 7279 5f65 726f 7369 6f6e 2877 6d5f  nary_erosion(wm_
-00011d90: 6d61 736b 2c20 7374 7275 6374 7572 653d  mask, structure=
-00011da0: 7374 7275 6329 2e61 7374 7970 6528 0a20  struc).astype(. 
-00011db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011dc0: 2020 206e 702e 7569 6e74 380a 2020 2020     np.uint8.    
-00011dd0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00011de0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00011df0: 3d20 696d 672e 6765 745f 6664 6174 6128  = img.get_fdata(
-00011e00: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-00011e10: 7461 203d 2064 6174 6120 2a20 2831 3030  ta = data * (100
-00011e20: 302e 3020 2f20 6e70 2e6d 6564 6961 6e28  0.0 / np.median(
-00011e30: 6461 7461 5b77 6d5f 6d61 736b 203e 2030  data[wm_mask > 0
-00011e40: 5d29 290a 0a20 2020 2020 2020 2020 2020  ]))..           
-00011e50: 206f 7574 5f69 6d67 203d 2069 6d67 2e5f   out_img = img._
-00011e60: 5f63 6c61 7373 5f5f 2864 6174 612c 2069  _class__(data, i
-00011e70: 6d67 2e61 6666 696e 652c 2069 6d67 2e68  mg.affine, img.h
-00011e80: 6561 6465 7229 0a0a 2020 2020 2020 2020  eader)..        
-00011e90: 2020 2020 2320 496d 6167 6520 7361 7665      # Image save
-00011ea0: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
-00011eb0: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
-00011ec0: 6174 682e 7370 6c69 7428 7365 6c66 2e69  ath.split(self.i
-00011ed0: 6e5f 6669 6c65 290a 2020 2020 2020 2020  n_file).        
-00011ee0: 2020 2020 6669 6c65 5f6e 616d 655f 6e6f      file_name_no
-00011ef0: 5f65 7874 2c20 6669 6c65 5f65 7874 656e  _ext, file_exten
-00011f00: 7369 6f6e 203d 206f 732e 7061 7468 2e73  sion = os.path.s
-00011f10: 706c 6974 6578 7428 6669 6c65 5f6e 616d  plitext(file_nam
-00011f20: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-00011f30: 6620 6669 6c65 5f65 7874 656e 7369 6f6e  f file_extension
-00011f40: 203d 3d20 222e 677a 223a 0a20 2020 2020   == ".gz":.     
-00011f50: 2020 2020 2020 2020 2020 2028 6669 6c65             (file
-00011f60: 5f6e 616d 655f 6e6f 5f65 7874 5f32 2c20  _name_no_ext_2, 
-00011f70: 6669 6c65 5f65 7874 656e 7369 6f6e 5f32  file_extension_2
-00011f80: 2920 3d20 6f73 2e70 6174 682e 7370 6c69  ) = os.path.spli
-00011f90: 7465 7874 280a 2020 2020 2020 2020 2020  text(.          
-00011fa0: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
-00011fb0: 616d 655f 6e6f 5f65 7874 0a20 2020 2020  ame_no_ext.     
-00011fc0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00011fd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00011fe0: 6669 6c65 5f65 7874 656e 7369 6f6e 5f32  file_extension_2
-00011ff0: 203d 3d20 222e 6e69 6922 3a0a 2020 2020   == ".nii":.    
-00012000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012010: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
-00012020: 203d 2066 696c 655f 6e61 6d65 5f6e 6f5f   = file_name_no_
-00012030: 6578 745f 320a 2020 2020 2020 2020 2020  ext_2.          
-00012040: 2020 2020 2020 2020 2020 6669 6c65 5f65            file_e
-00012050: 7874 656e 7369 6f6e 203d 2022 2e6e 6969  xtension = ".nii
-00012060: 2e67 7a22 0a0a 2020 2020 2020 2020 2020  .gz"..          
-00012070: 2020 6669 6c65 5f6f 7574 203d 206f 732e    file_out = os.
-00012080: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
-00012090: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000120a0: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
-000120b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000120c0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-000120d0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-000120e0: 6669 782e 7374 7269 7028 290a 2020 2020  fix.strip().    
-000120f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012100: 2b20 6669 6c65 5f6e 616d 655f 6e6f 5f65  + file_name_no_e
-00012110: 7874 0a20 2020 2020 2020 2020 2020 2020  xt.             
-00012120: 2020 2020 2020 202b 2073 656c 662e 7375         + self.su
-00012130: 6666 6978 2e73 7472 6970 2829 0a20 2020  ffix.strip().   
+0000ce80: 2020 2020 2020 2b20 6669 6c65 5f6e 616d        + file_nam
+0000ce90: 655f 6e6f 5f65 7874 0a20 2020 2020 2020  e_no_ext.       
+0000cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ceb0: 202b 2073 656c 662e 7375 6666 6978 2e73   + self.suffix.s
+0000cec0: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+0000ced0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000cee0: 2066 696c 655f 6578 7465 6e73 696f 6e0a   file_extension.
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf00: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0000cf10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000cf20: 2020 2020 2020 2020 206e 6962 2e73 6176           nib.sav
+0000cf30: 6528 6f75 745f 696d 6167 652c 2066 696c  e(out_image, fil
+0000cf40: 655f 6f75 7429 0a0a 0a63 6c61 7373 2045  e_out)...class E
+0000cf50: 7374 696d 6174 6553 4e52 2850 726f 6365  stimateSNR(Proce
+0000cf60: 7373 4d49 4129 3a0a 2020 2020 2222 220a  ssMIA):.    """.
+0000cf70: 2020 2020 2a45 7374 696d 6174 6520 534e      *Estimate SN
+0000cf80: 5220 7573 696e 6720 6120 7365 676d 656e  R using a segmen
+0000cf90: 7461 7469 6f6e 2066 696c 652a 0a0a 2020  tation file*..  
+0000cfa0: 2020 506c 6561 7365 2c20 7365 6520 7468    Please, see th
+0000cfb0: 6520 636f 6d70 6c65 7465 2064 6f63 756d  e complete docum
+0000cfc0: 656e 7461 7469 6f6e 2066 6f72 2074 6865  entation for the
+0000cfd0: 2060 4573 7469 6d61 7465 534e 5220 6272   `EstimateSNR br
+0000cfe0: 6963 6b0a 2020 2020 696e 2074 6865 206d  ick.    in the m
+0000cff0: 6961 5f70 726f 6365 7373 6573 2077 6562  ia_processes web
+0000d000: 7369 7465 0a20 2020 203c 6874 7470 733a  site.    <https:
+0000d010: 2f2f 706f 7075 6c73 652e 6769 7468 7562  //populse.github
+0000d020: 2e69 6f2f 6d69 615f 7072 6f63 6573 7365  .io/mia_processe
+0000d030: 732f 6874 6d6c 2f64 6f63 756d 656e 7461  s/html/documenta
+0000d040: 7469 6f6e 2f62 7269 636b 732f 7072 6570  tion/bricks/prep
+0000d050: 726f 6365 7373 2f6f 7468 6572 2f45 7374  rocess/other/Est
+0000d060: 696d 6174 6553 4e52 2e68 746d 6c3e 605f  imateSNR.html>`_
+0000d070: 0a0a 2020 2020 6164 6170 7465 6420 6672  ..    adapted fr
+0000d080: 6f6d 3a0a 2020 2020 6874 7470 733a 2f2f  om:.    https://
+0000d090: 6769 7468 7562 2e63 6f6d 2f6e 6970 7265  github.com/nipre
+0000d0a0: 7073 2f6d 7269 7163 2f62 6c6f 622f 3232  ps/mriqc/blob/22
+0000d0b0: 2e30 2e36 2f6d 7269 7163 2f77 6f72 6b66  .0.6/mriqc/workf
+0000d0c0: 6c6f 7773 2f61 6e61 746f 6d69 6361 6c2e  lows/anatomical.
+0000d0d0: 7079 234c 3937 300a 0a20 2020 2022 2222  py#L970..    """
+0000d0e0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0000d0f0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0000d100: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
+0000d110: 6f20 7468 6520 6174 7472 6962 7574 6573  o the attributes
+0000d120: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
+0000d130: 2f20 696e 7374 616e 7469 6174 696f 6e2e  / instantiation.
+0000d140: 0a0a 2020 2020 2020 2020 5468 6520 696e  ..        The in
+0000d150: 7075 7420 616e 6420 6f75 7470 7574 2070  put and output p
+0000d160: 6c75 6773 2061 7265 2064 6566 696e 6564  lugs are defined
+0000d170: 2068 6572 652e 2054 6865 2073 7065 6369   here. The speci
+0000d180: 616c 0a20 2020 2020 2020 2027 7365 6c66  al.        'self
+0000d190: 2e72 6571 7569 7265 6d65 6e74 2720 6174  .requirement' at
+0000d1a0: 7472 6962 7574 6520 286f 7074 696f 6e61  tribute (optiona
+0000d1b0: 6c29 2069 7320 7573 6564 2074 6f20 6465  l) is used to de
+0000d1c0: 6669 6e65 2074 6865 0a20 2020 2020 2020  fine the.       
+0000d1d0: 2074 6869 7264 2d70 6172 7479 2070 726f   third-party pro
+0000d1e0: 6475 6374 7320 6e65 6365 7373 6172 7920  ducts necessary 
+0000d1f0: 666f 7220 7468 6520 7275 6e6e 696e 6720  for the running 
+0000d200: 6f66 2074 6865 2062 7269 636b 2e0a 2020  of the brick..  
+0000d210: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000d220: 2020 2320 496e 6974 6961 6c69 7361 7469    # Initialisati
+0000d230: 6f6e 206f 6620 7468 6520 6f62 6a65 6374  on of the object
+0000d240: 7320 6e65 6564 6564 2066 6f72 2074 6865  s needed for the
+0000d250: 206c 6175 6e63 6820 6f66 2074 6865 2062   launch of the b
+0000d260: 7269 636b 0a20 2020 2020 2020 2073 7570  rick.        sup
+0000d270: 6572 2845 7374 696d 6174 6553 4e52 2c20  er(EstimateSNR, 
+0000d280: 7365 6c66 292e 5f5f 696e 6974 5f5f 2829  self).__init__()
+0000d290: 0a0a 2020 2020 2020 2020 2320 5468 6972  ..        # Thir
+0000d2a0: 6420 7061 7274 7920 736f 6674 7761 7265  d party software
+0000d2b0: 7320 7265 7175 6972 6564 2066 6f72 2074  s required for t
+0000d2c0: 6865 2065 7865 6375 7469 6f6e 206f 6620  he execution of 
+0000d2d0: 7468 6520 6272 6963 6b0a 2020 2020 2020  the brick.      
+0000d2e0: 2020 7365 6c66 2e72 6571 7569 7265 6d65    self.requireme
+0000d2f0: 6e74 203d 205b 5d0a 0a20 2020 2020 2020  nt = []..       
+0000d300: 2023 2049 6e70 7574 7320 6465 7363 7269   # Inputs descri
+0000d310: 7074 696f 6e0a 2020 2020 2020 2020 696e  ption.        in
+0000d320: 5f66 696c 655f 6465 7363 203d 2028 0a20  _file_desc = (. 
+0000d330: 2020 2020 2020 2020 2020 2022 496e 7075             "Inpu
+0000d340: 7420 6669 6c65 2028 6120 7061 7468 6c69  t file (a pathli
+0000d350: 6b65 206f 626a 6563 7420 6f72 2073 7472  ke object or str
+0000d360: 696e 6720 7265 7072 6573 656e 7469 6e67  ing representing
+0000d370: 2061 2066 696c 6529 2e22 0a20 2020 2020   a file).".     
+0000d380: 2020 2029 0a20 2020 2020 2020 2073 6567     ).        seg
+0000d390: 5f66 696c 655f 6465 7363 203d 2028 0a20  _file_desc = (. 
+0000d3a0: 2020 2020 2020 2020 2020 2022 4120 7365             "A se
+0000d3b0: 676d 656e 7461 7469 6f6e 2066 696c 6520  gmentation file 
+0000d3c0: 746f 2063 616c 6375 6c61 7465 2053 4e52  to calculate SNR
+0000d3d0: 2028 6120 7061 7468 6c69 6b65 2022 0a20   (a pathlike ". 
+0000d3e0: 2020 2020 2020 2020 2020 2022 6f62 6a65             "obje
+0000d3f0: 6374 206f 7220 7374 7269 6e67 2072 6570  ct or string rep
+0000d400: 7265 7365 6e74 696e 6720 6120 6669 6c65  resenting a file
+0000d410: 292e 220a 2020 2020 2020 2020 290a 2020  ).".        ).  
+0000d420: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
+0000d430: 6465 7363 7269 7074 696f 6e0a 2020 2020  description.    
+0000d440: 2020 2020 6f75 745f 736e 725f 6465 7363      out_snr_desc
+0000d450: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0000d460: 2022 4573 7469 6d61 7465 6420 534e 5220   "Estimated SNR 
+0000d470: 2861 2070 6174 686c 696b 6520 6f62 6a65  (a pathlike obje
+0000d480: 6374 206f 7220 7374 7269 6e67 2072 6570  ct or string rep
+0000d490: 7265 7365 6e74 696e 6720 6120 6669 6c65  resenting a file
+0000d4a0: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+0000d4b0: 2020 2020 2023 2049 6e70 7574 7320 7472       # Inputs tr
+0000d4c0: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
+0000d4d0: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
+0000d4e0: 2020 2020 2020 2020 2022 696e 5f66 696c           "in_fil
+0000d4f0: 6522 2c20 4669 6c65 286f 7574 7075 743d  e", File(output=
+0000d500: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+0000d510: 4661 6c73 652c 2064 6573 633d 696e 5f66  False, desc=in_f
+0000d520: 696c 655f 6465 7363 290a 2020 2020 2020  ile_desc).      
+0000d530: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
+0000d540: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
+0000d550: 2020 2020 2020 2020 2022 7365 675f 6669           "seg_fi
+0000d560: 6c65 222c 2046 696c 6528 6f75 7470 7574  le", File(output
+0000d570: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
+0000d580: 3d46 616c 7365 2c20 6465 7363 3d73 6567  =False, desc=seg
+0000d590: 5f66 696c 655f 6465 7363 290a 2020 2020  _file_desc).    
+0000d5a0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+0000d5b0: 204f 7574 7075 7473 2074 7261 6974 730a   Outputs traits.
+0000d5c0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+0000d5d0: 5f74 7261 6974 2822 6f75 745f 736e 7222  _trait("out_snr"
+0000d5e0: 2c20 7472 6169 7473 2e46 6c6f 6174 286f  , traits.Float(o
+0000d5f0: 7574 7075 743d 5472 7565 2c20 6465 7363  utput=True, desc
+0000d600: 3d6f 7574 5f73 6e72 5f64 6573 6329 290a  =out_snr_desc)).
+0000d610: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+0000d620: 6974 5f64 6566 6175 6c74 5f74 7261 6974  it_default_trait
+0000d630: 7328 290a 0a20 2020 2064 6566 206c 6973  s()..    def lis
+0000d640: 745f 6f75 7470 7574 7328 7365 6c66 2c20  t_outputs(self, 
+0000d650: 6973 5f70 6c75 6767 6564 3d4e 6f6e 6529  is_plugged=None)
+0000d660: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
+0000d670: 6963 6174 6564 2074 6f20 7468 6520 696e  icated to the in
+0000d680: 6974 6961 6c69 7361 7469 6f6e 2073 7465  itialisation ste
+0000d690: 7020 6f66 2074 6865 2062 7269 636b 2e0a  p of the brick..
+0000d6a0: 0a20 2020 2020 2020 2054 6865 206d 6169  .        The mai
+0000d6b0: 6e20 6f62 6a65 6374 6976 6520 6f66 2074  n objective of t
+0000d6c0: 6869 7320 6d65 7468 6f64 2069 7320 746f  his method is to
+0000d6d0: 2070 726f 6475 6365 2074 6865 206f 7574   produce the out
+0000d6e0: 7075 7473 206f 6620 7468 650a 2020 2020  puts of the.    
+0000d6f0: 2020 2020 6272 6963 6b73 2028 7365 6c66      bricks (self
+0000d700: 2e6f 7574 7075 7473 2920 616e 6420 7468  .outputs) and th
+0000d710: 6520 6173 736f 6369 6174 6564 2074 6167  e associated tag
+0000d720: 7320 2873 656c 662e 696e 6865 7269 7461  s (self.inherita
+0000d730: 6e63 655f 6469 6329 2c0a 2020 2020 2020  nce_dic),.      
+0000d740: 2020 6966 2064 6566 696e 6564 2068 6572    if defined her
+0000d750: 652e 2054 6f20 776f 726b 2070 726f 7065  e. To work prope
+0000d760: 726c 7920 7468 6973 206d 6574 686f 6420  rly this method 
+0000d770: 6d75 7374 2072 6574 7572 6e0a 2020 2020  must return.    
+0000d780: 2020 2020 7365 6c66 2e6d 616b 655f 696e      self.make_in
+0000d790: 6974 5265 7375 6c74 2829 206f 626a 6563  itResult() objec
+0000d7a0: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
+0000d7b0: 616d 2069 735f 706c 7567 6765 643a 2074  am is_plugged: t
+0000d7c0: 6865 2073 7461 7465 2c20 6c69 6e6b 6564  he state, linked
+0000d7d0: 206f 7220 6e6f 742c 206f 6620 7468 6520   or not, of the 
+0000d7e0: 706c 7567 732e 0a20 2020 2020 2020 203a  plugs..        :
+0000d7f0: 7265 7475 726e 733a 2061 2064 6963 7469  returns: a dicti
+0000d800: 6f6e 6172 7920 7769 7468 2072 6571 7569  onary with requi
+0000d810: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
+0000d820: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
+0000d830: 6469 6374 2e0a 2020 2020 2020 2020 2222  dict..        ""
+0000d840: 220a 2020 2020 2020 2020 2320 5573 696e  ".        # Usin
+0000d850: 6720 7468 6520 696e 6865 7269 7461 6e63  g the inheritanc
+0000d860: 6520 746f 2050 726f 6365 7373 4d49 4120  e to ProcessMIA 
+0000d870: 636c 6173 732c 206c 6973 745f 6f75 7470  class, list_outp
+0000d880: 7574 7320 6d65 7468 6f64 0a20 2020 2020  uts method.     
+0000d890: 2020 2073 7570 6572 2845 7374 696d 6174     super(Estimat
+0000d8a0: 6553 4e52 2c20 7365 6c66 292e 6c69 7374  eSNR, self).list
+0000d8b0: 5f6f 7574 7075 7473 2829 0a0a 2020 2020  _outputs()..    
+0000d8c0: 2020 2020 2320 4f75 7470 7574 7320 6465      # Outputs de
+0000d8d0: 6669 6e69 7469 6f6e 0a20 2020 2020 2020  finition.       
+0000d8e0: 2069 6620 7365 6c66 2e69 6e5f 6669 6c65   if self.in_file
+0000d8f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000d900: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
+0000d910: 6563 746f 7279 3a0a 2020 2020 2020 2020  ectory:.        
+0000d920: 2020 2020 2020 2020 7661 6c69 645f 6578          valid_ex
+0000d930: 742c 2069 6e5f 6578 742c 2066 696c 654e  t, in_ext, fileN
+0000d940: 616d 6520 3d20 6368 6563 6b46 696c 6545  ame = checkFileE
+0000d950: 7874 2873 656c 662e 696e 5f66 696c 652c  xt(self.in_file,
+0000d960: 2045 5854 290a 0a20 2020 2020 2020 2020   EXT)..         
+0000d970: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
+0000d980: 6c69 645f 6578 743a 0a20 2020 2020 2020  lid_ext:.       
+0000d990: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000d9a0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0000d9b0: 2020 2020 2020 2020 2020 2020 225c 6e45              "\nE
+0000d9c0: 7374 696d 6174 6553 4e52 2062 7269 636b  stimateSNR brick
+0000d9d0: 3a20 5468 6520 696e 7075 7420 696d 6167  : The input imag
+0000d9e0: 6520 666f 726d 6174 2069 7320 6e6f 7420  e format is not 
+0000d9f0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000da00: 2020 2020 2020 2020 2020 2272 6563 6f67            "recog
+0000da10: 6e69 7a65 642e 2e2e 2122 0a20 2020 2020  nized...!".     
+0000da20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000da30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da40: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0000da50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000da60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000da70: 7269 6e74 2822 4573 7469 6d61 7465 534e  rint("EstimateSN
+0000da80: 5220 6272 6963 6b3a 204e 6f20 6f75 7470  R brick: No outp
+0000da90: 7574 5f64 6972 6563 746f 7279 2077 6173  ut_directory was
+0000daa0: 2066 6f75 6e64 2e2e 2e21 5c6e 2229 0a20   found...!\n"). 
+0000dab0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000dac0: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
+0000dad0: 2052 6574 7572 6e20 7468 6520 7265 7175   Return the requ
+0000dae0: 6972 656d 656e 742c 206f 7574 7075 7473  irement, outputs
+0000daf0: 2061 6e64 2069 6e68 6572 6974 616e 6365   and inheritance
+0000db00: 5f64 6963 740a 2020 2020 2020 2020 7265  _dict.        re
+0000db10: 7475 726e 2073 656c 662e 6d61 6b65 5f69  turn self.make_i
+0000db20: 6e69 7452 6573 756c 7428 290a 0a20 2020  nitResult()..   
+0000db30: 2064 6566 2072 756e 5f70 726f 6365 7373   def run_process
+0000db40: 5f6d 6961 2873 656c 6629 3a0a 2020 2020  _mia(self):.    
+0000db50: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
+0000db60: 2074 6f20 7468 6520 7072 6f63 6573 7320   to the process 
+0000db70: 6c61 756e 6368 2073 7465 7020 6f66 2074  launch step of t
+0000db80: 6865 2062 7269 636b 2e22 2222 0a20 2020  he brick.""".   
+0000db90: 2020 2020 2073 7570 6572 2845 7374 696d       super(Estim
+0000dba0: 6174 6553 4e52 2c20 7365 6c66 292e 7275  ateSNR, self).ru
+0000dbb0: 6e5f 7072 6f63 6573 735f 6d69 6128 290a  n_process_mia().
+0000dbc0: 0a20 2020 2020 2020 2066 696c 655f 6e61  .        file_na
+0000dbd0: 6d65 203d 2073 656c 662e 696e 5f66 696c  me = self.in_fil
+0000dbe0: 650a 2020 2020 2020 2020 7365 675f 6669  e.        seg_fi
+0000dbf0: 6c65 5f6e 616d 6520 3d20 7365 6c66 2e73  le_name = self.s
+0000dc00: 6567 5f66 696c 650a 0a20 2020 2020 2020  eg_file..       
+0000dc10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000dc20: 2020 696d 6720 3d20 6e69 622e 6c6f 6164    img = nib.load
+0000dc30: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
+0000dc40: 2020 2020 2020 2020 7365 675f 696d 6720          seg_img 
+0000dc50: 3d20 6e69 622e 6c6f 6164 2873 6567 5f66  = nib.load(seg_f
+0000dc60: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+0000dc70: 2020 6578 6365 7074 2028 0a20 2020 2020    except (.     
+0000dc80: 2020 2020 2020 206e 6962 2e66 696c 6562         nib.fileb
+0000dc90: 6173 6564 696d 6167 6573 2e49 6d61 6765  asedimages.Image
+0000dca0: 4669 6c65 4572 726f 722c 0a20 2020 2020  FileError,.     
+0000dcb0: 2020 2020 2020 2046 696c 654e 6f74 466f         FileNotFo
+0000dcc0: 756e 6445 7272 6f72 2c0a 2020 2020 2020  undError,.      
+0000dcd0: 2020 2020 2020 5479 7065 4572 726f 722c        TypeError,
+0000dce0: 0a20 2020 2020 2020 2029 2061 7320 653a  .        ) as e:
+0000dcf0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000dd00: 6e74 2822 5c6e 4573 7469 6d61 7465 534e  nt("\nEstimateSN
+0000dd10: 5220 6272 6963 6b3a 2045 7272 6f72 2077  R brick: Error w
+0000dd20: 6974 6820 6669 6c65 732c 2064 7572 696e  ith files, durin
+0000dd30: 6720 7468 6520 7275 6e3a 2022 2c20 6529  g the run: ", e)
+0000dd40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000dd50: 7572 6e0a 0a20 2020 2020 2020 2064 6174  urn..        dat
+0000dd60: 6120 3d20 696d 672e 6765 745f 6664 6174  a = img.get_fdat
+0000dd70: 6128 290a 2020 2020 2020 2020 6d61 736b  a().        mask
+0000dd80: 203d 2073 6567 5f69 6d67 2e67 6574 5f66   = seg_img.get_f
+0000dd90: 6461 7461 2829 203d 3d20 3220 2023 2057  data() == 2  # W
+0000dda0: 4d20 6c61 6265 6c0a 2020 2020 2020 2020  M label.        
+0000ddb0: 7365 6c66 2e6f 7574 5f73 6e72 203d 2066  self.out_snr = f
+0000ddc0: 6c6f 6174 280a 2020 2020 2020 2020 2020  loat(.          
+0000ddd0: 2020 6e70 2e6d 6561 6e28 6461 7461 5b6d    np.mean(data[m
+0000dde0: 6173 6b5d 290a 2020 2020 2020 2020 2020  ask]).          
+0000ddf0: 2020 2f20 2864 6174 615b 6d61 736b 5d2e    / (data[mask].
+0000de00: 7374 6428 2920 2a20 6e70 2e73 7172 7428  std() * np.sqrt(
+0000de10: 6d61 736b 2e73 756d 2829 202f 2028 6d61  mask.sum() / (ma
+0000de20: 736b 2e73 756d 2829 202d 2031 2929 290a  sk.sum() - 1))).
+0000de30: 2020 2020 2020 2020 290a 0a0a 636c 6173          )...clas
+0000de40: 7320 4578 7472 6163 7452 4f49 6279 4c61  s ExtractROIbyLa
+0000de50: 6265 6c28 5072 6f63 6573 734d 4941 293a  bel(ProcessMIA):
+0000de60: 0a20 2020 2022 2222 0a20 2020 202a 4578  .    """.    *Ex
+0000de70: 7472 6163 7420 6120 7370 6563 6966 6963  tract a specific
+0000de80: 2052 4f49 2066 726f 6d20 6120 7365 676d   ROI from a segm
+0000de90: 656e 7461 7469 6f6e 2066 696c 6520 7573  entation file us
+0000dea0: 696e 6720 6120 6c61 6265 6c2a 0a0a 2020  ing a label*..  
+0000deb0: 2020 506c 6561 7365 2c20 7365 6520 7468    Please, see th
+0000dec0: 6520 636f 6d70 6c65 7465 2064 6f63 756d  e complete docum
+0000ded0: 656e 7461 7469 6f6e 2066 6f72 2074 6865  entation for the
+0000dee0: 2060 4578 7472 6163 7452 4f49 6279 4c61   `ExtractROIbyLa
+0000def0: 6265 6c20 6272 6963 6b0a 2020 2020 696e  bel brick.    in
+0000df00: 2074 6865 206d 6961 5f70 726f 6365 7373   the mia_process
+0000df10: 6573 2077 6562 7369 7465 0a20 2020 203c  es website.    <
+0000df20: 6874 7470 733a 2f2f 706f 7075 6c73 652e  https://populse.
+0000df30: 6769 7468 7562 2e69 6f2f 6d69 615f 7072  github.io/mia_pr
+0000df40: 6f63 6573 7365 732f 6874 6d6c 2f64 6f63  ocesses/html/doc
+0000df50: 756d 656e 7461 7469 6f6e 2f62 7269 636b  umentation/brick
+0000df60: 732f 7072 6570 726f 6365 7373 2f6f 7468  s/preprocess/oth
+0000df70: 6572 2f45 7874 7261 6374 524f 4962 794c  er/ExtractROIbyL
+0000df80: 6162 656c 2e68 746d 6c3e 605f 0a0a 2020  abel.html>`_..  
+0000df90: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+0000dfa0: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
+0000dfb0: 2020 2020 2020 2022 2222 4465 6469 6361         """Dedica
+0000dfc0: 7465 6420 746f 2074 6865 2061 7474 7269  ted to the attri
+0000dfd0: 6275 7465 7320 696e 6974 6961 6c69 7361  butes initialisa
+0000dfe0: 7469 6f6e 202f 2069 6e73 7461 6e74 6961  tion / instantia
+0000dff0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2054  tion...        T
+0000e000: 6865 2069 6e70 7574 2061 6e64 206f 7574  he input and out
+0000e010: 7075 7420 706c 7567 7320 6172 6520 6465  put plugs are de
+0000e020: 6669 6e65 6420 6865 7265 2e20 5468 6520  fined here. The 
+0000e030: 7370 6563 6961 6c0a 2020 2020 2020 2020  special.        
+0000e040: 2773 656c 662e 7265 7175 6972 656d 656e  'self.requiremen
+0000e050: 7427 2061 7474 7269 6275 7465 2028 6f70  t' attribute (op
+0000e060: 7469 6f6e 616c 2920 6973 2075 7365 6420  tional) is used 
+0000e070: 746f 2064 6566 696e 6520 7468 650a 2020  to define the.  
+0000e080: 2020 2020 2020 7468 6972 642d 7061 7274        third-part
+0000e090: 7920 7072 6f64 7563 7473 206e 6563 6573  y products neces
+0000e0a0: 7361 7279 2066 6f72 2074 6865 2072 756e  sary for the run
+0000e0b0: 6e69 6e67 206f 6620 7468 6520 6272 6963  ning of the bric
+0000e0c0: 6b2e 0a20 2020 2020 2020 2022 2222 0a20  k..        """. 
+0000e0d0: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
+0000e0e0: 6973 6174 696f 6e20 6f66 2074 6865 206f  isation of the o
+0000e0f0: 626a 6563 7473 206e 6565 6465 6420 666f  bjects needed fo
+0000e100: 7220 7468 6520 6c61 756e 6368 206f 6620  r the launch of 
+0000e110: 7468 6520 6272 6963 6b0a 2020 2020 2020  the brick.      
+0000e120: 2020 7375 7065 7228 4578 7472 6163 7452    super(ExtractR
+0000e130: 4f49 6279 4c61 6265 6c2c 2073 656c 6629  OIbyLabel, self)
+0000e140: 2e5f 5f69 6e69 745f 5f28 290a 0a20 2020  .__init__()..   
+0000e150: 2020 2020 2023 2054 6869 7264 2070 6172       # Third par
+0000e160: 7479 2073 6f66 7477 6172 6573 2072 6571  ty softwares req
+0000e170: 7569 7265 6420 666f 7220 7468 6520 6578  uired for the ex
+0000e180: 6563 7574 696f 6e20 6f66 2074 6865 2062  ecution of the b
+0000e190: 7269 636b 0a20 2020 2020 2020 2073 656c  rick.        sel
+0000e1a0: 662e 7265 7175 6972 656d 656e 7420 3d20  f.requirement = 
+0000e1b0: 5b5d 0a0a 2020 2020 2020 2020 2320 496e  []..        # In
+0000e1c0: 7075 7473 2064 6573 6372 6970 7469 6f6e  puts description
+0000e1d0: 0a20 2020 2020 2020 2069 6e5f 6669 6c65  .        in_file
+0000e1e0: 5f64 6573 6320 3d20 280a 2020 2020 2020  _desc = (.      
+0000e1f0: 2020 2020 2020 2249 6e70 7574 2073 6567        "Input seg
+0000e200: 6d65 6e74 6564 2066 696c 6520 7769 7468  mented file with
+0000e210: 206c 6162 656c 2022 0a20 2020 2020 2020   label ".       
+0000e220: 2020 2020 2022 2861 2070 6174 686c 696b       "(a pathlik
+0000e230: 6520 6f62 6a65 6374 206f 7220 7374 7269  e object or stri
+0000e240: 6e67 2072 6570 7265 7365 6e74 696e 6720  ng representing 
+0000e250: 6120 6669 6c65 292e 220a 2020 2020 2020  a file).".      
+0000e260: 2020 290a 2020 2020 2020 2020 6c61 6265    ).        labe
+0000e270: 6c73 5f64 6573 6320 3d20 224c 6973 7420  ls_desc = "List 
+0000e280: 6f66 2074 6865 206c 6162 656c 206f 6620  of the label of 
+0000e290: 7468 6520 524f 4920 746f 2065 7874 7261  the ROI to extra
+0000e2a0: 6374 2028 6120 6c69 7374 206f 6620 696e  ct (a list of in
+0000e2b0: 7429 220a 2020 2020 2020 2020 7361 7665  t)".        save
+0000e2c0: 5f65 6163 685f 726f 695f 6465 7363 203d  _each_roi_desc =
+0000e2d0: 2022 5361 7665 2061 2065 6163 6820 7265   "Save a each re
+0000e2e0: 6769 6f6e 7320 6173 2061 204e 4966 5449  gions as a NIfTI
+0000e2f0: 2066 696c 6520 2861 2062 6f6f 6c65 616e   file (a boolean
+0000e300: 2922 0a20 2020 2020 2020 2073 6176 655f  )".        save_
+0000e310: 636f 6e63 6174 655f 726f 695f 6465 7363  concate_roi_desc
+0000e320: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0000e330: 2022 5361 7665 2061 2063 6f6e 6361 7465   "Save a concate
+0000e340: 6e61 7469 6f6e 206f 6620 7265 6769 6f6e  nation of region
+0000e350: 7320 6173 2061 204e 4966 5449 2066 696c  s as a NIfTI fil
+0000e360: 6520 2861 2062 6f6f 6c65 616e 2922 0a20  e (a boolean)". 
+0000e370: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000e380: 2073 7566 6669 785f 6465 7363 203d 2022   suffix_desc = "
+0000e390: 5375 6666 6978 2066 6f72 206f 7574 6f75  Suffix for outou
+0000e3a0: 7420 6669 6c65 2028 2073 7472 696e 6729  t file ( string)
+0000e3b0: 220a 2020 2020 2020 2020 2320 4f75 7470  ".        # Outp
+0000e3c0: 7574 7320 6465 7363 7269 7074 696f 6e0a  uts description.
+0000e3d0: 2020 2020 2020 2020 2320 6f75 745f 6e69          # out_ni
+0000e3e0: 6261 6265 6c5f 6465 7363 203d 2028 0a20  babel_desc = (. 
+0000e3f0: 2020 2020 2020 2023 2020 2020 2022 4578         #     "Ex
+0000e400: 7472 6163 7465 6420 524f 4920 286e 6962  tracted ROI (nib
+0000e410: 6162 656c 204e 6966 7469 3149 6d61 6765  abel Nifti1Image
+0000e420: 2066 6f72 6d61 7429 220a 2020 2020 2020   format)".      
+0000e430: 2020 2320 290a 0a20 2020 2020 2020 206f    # )..        o
+0000e440: 7574 5f66 696c 6573 5f64 6573 6320 3d20  ut_files_desc = 
+0000e450: 280a 2020 2020 2020 2020 2020 2020 2245  (.            "E
+0000e460: 7874 7261 6374 6564 2052 4f49 2066 696c  xtracted ROI fil
+0000e470: 6573 286c 6973 7420 6f66 2070 6174 686c  es(list of pathl
+0000e480: 696b 6520 6f62 6a65 6374 206f 7220 7374  ike object or st
+0000e490: 7269 6e67 2022 0a20 2020 2020 2020 2020  ring ".         
+0000e4a0: 2020 2022 7265 7072 6573 656e 7469 6e67     "representing
+0000e4b0: 2061 2066 696c 6529 220a 2020 2020 2020   a file)".      
+0000e4c0: 2020 290a 2020 2020 2020 2020 6f75 745f    ).        out_
+0000e4d0: 636f 6e63 6174 655f 6465 7363 203d 2028  concate_desc = (
+0000e4e0: 0a20 2020 2020 2020 2020 2020 2022 496d  .            "Im
+0000e4f0: 6167 6520 7769 7468 2061 6c6c 2052 4f49  age with all ROI
+0000e500: 2069 6e20 6c61 6265 6c73 2070 6172 616d   in labels param
+0000e510: 6574 6572 286c 6973 7420 6f66 2070 6174  eter(list of pat
+0000e520: 686c 696b 6520 220a 2020 2020 2020 2020  hlike ".        
+0000e530: 2020 2020 226f 626a 6563 7420 6f72 2073      "object or s
+0000e540: 7472 696e 6720 7265 7072 6573 656e 7469  tring representi
+0000e550: 6e67 2061 2066 696c 6529 220a 2020 2020  ng a file)".    
+0000e560: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+0000e570: 2049 6e70 7574 7320 7472 6169 7473 0a20   Inputs traits. 
+0000e580: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+0000e590: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
+0000e5a0: 2020 2022 696e 5f66 696c 6522 2c20 4669     "in_file", Fi
+0000e5b0: 6c65 286f 7574 7075 743d 4661 6c73 652c  le(output=False,
+0000e5c0: 206f 7074 696f 6e61 6c3d 4661 6c73 652c   optional=False,
+0000e5d0: 2064 6573 633d 696e 5f66 696c 655f 6465   desc=in_file_de
+0000e5e0: 7363 290a 2020 2020 2020 2020 290a 2020  sc).        ).  
+0000e5f0: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+0000e600: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+0000e610: 2020 226c 6162 656c 7322 2c0a 2020 2020    "labels",.    
+0000e620: 2020 2020 2020 2020 7472 6169 7473 2e4c          traits.L
+0000e630: 6973 7428 0a20 2020 2020 2020 2020 2020  ist(.           
+0000e640: 2020 2020 2074 7261 6974 732e 496e 7428       traits.Int(
+0000e650: 292c 206f 7574 7075 743d 4661 6c73 652c  ), output=False,
+0000e660: 206f 7074 696f 6e61 6c3d 4661 6c73 652c   optional=False,
+0000e670: 2064 6573 633d 6c61 6265 6c73 5f64 6573   desc=labels_des
+0000e680: 630a 2020 2020 2020 2020 2020 2020 292c  c.            ),
+0000e690: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000e6a0: 2020 2073 656c 662e 6164 645f 7472 6169     self.add_trai
+0000e6b0: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
+0000e6c0: 7361 7665 5f65 6163 685f 726f 6922 2c0a  save_each_roi",.
+0000e6d0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+0000e6e0: 7473 2e42 6f6f 6c28 4661 6c73 652c 206f  ts.Bool(False, o
+0000e6f0: 7074 696f 6e61 6c3d 5472 7565 2c20 6465  ptional=True, de
+0000e700: 7363 3d73 6176 655f 6561 6368 5f72 6f69  sc=save_each_roi
+0000e710: 5f64 6573 6329 2c0a 2020 2020 2020 2020  _desc),.        
+0000e720: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000e730: 6464 5f74 7261 6974 280a 2020 2020 2020  dd_trait(.      
+0000e740: 2020 2020 2020 2273 6176 655f 636f 6e63        "save_conc
+0000e750: 6174 655f 726f 6922 2c0a 2020 2020 2020  ate_roi",.      
+0000e760: 2020 2020 2020 7472 6169 7473 2e42 6f6f        traits.Boo
+0000e770: 6c28 5472 7565 2c20 6f70 7469 6f6e 616c  l(True, optional
+0000e780: 3d54 7275 652c 2064 6573 633d 7361 7665  =True, desc=save
+0000e790: 5f63 6f6e 6361 7465 5f72 6f69 5f64 6573  _concate_roi_des
+0000e7a0: 6329 2c0a 2020 2020 2020 2020 290a 2020  c),.        ).  
+0000e7b0: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+0000e7c0: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+0000e7d0: 2020 2273 7566 6669 7822 2c0a 2020 2020    "suffix",.    
+0000e7e0: 2020 2020 2020 2020 7472 6169 7473 2e53          traits.S
+0000e7f0: 7472 696e 6728 6f75 7470 7574 3d46 616c  tring(output=Fal
+0000e800: 7365 2c20 6f70 7469 6f6e 616c 3d54 7275  se, optional=Tru
+0000e810: 652c 2064 6573 633d 7375 6666 6978 5f64  e, desc=suffix_d
+0000e820: 6573 6329 2c0a 2020 2020 2020 2020 290a  esc),.        ).
+0000e830: 0a20 2020 2020 2020 2023 204f 7574 7075  .        # Outpu
+0000e840: 7473 2074 7261 6974 730a 2020 2020 2020  ts traits.      
+0000e850: 2020 2320 4649 584d 453a 2077 6861 7420    # FIXME: what 
+0000e860: 7472 6169 7473 2075 7365 6420 666f 7220  traits used for 
+0000e870: 6e69 6261 6265 6c20 4e69 6674 6931 496d  nibabel Nifti1Im
+0000e880: 6167 6520 666f 726d 6174 3f0a 2020 2020  age format?.    
+0000e890: 2020 2020 2320 7365 6c66 2e61 6464 5f74      # self.add_t
+0000e8a0: 7261 6974 280a 2020 2020 2020 2020 2320  rait(.        # 
+0000e8b0: 2020 2020 226f 7574 5f6e 6962 6162 656c      "out_nibabel
+0000e8c0: 222c 0a20 2020 2020 2020 2023 2020 2020  ",.        #    
+0000e8d0: 2074 7261 6974 732e 286f 7574 7075 743d   traits.(output=
+0000e8e0: 5472 7565 2c20 6465 7363 3d72 6f69 5f6e  True, desc=roi_n
+0000e8f0: 6962 6162 656c 5f64 6573 6329 0a20 2020  ibabel_desc).   
+0000e900: 2020 2020 2023 2020 2020 2029 0a20 2020       #     ).   
+0000e910: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+0000e920: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+0000e930: 2022 6f75 745f 6669 6c65 7322 2c0a 2020   "out_files",.  
+0000e940: 2020 2020 2020 2020 2020 4f75 7470 7574            Output
+0000e950: 4d75 6c74 6950 6174 6828 0a20 2020 2020  MultiPath(.     
+0000e960: 2020 2020 2020 2020 2020 2046 696c 6528             File(
+0000e970: 292c 206f 7574 7075 743d 5472 7565 2c20  ), output=True, 
+0000e980: 6f70 7469 6f6e 616c 3d54 7275 652c 2064  optional=True, d
+0000e990: 6573 633d 6f75 745f 6669 6c65 735f 6465  esc=out_files_de
+0000e9a0: 7363 0a20 2020 2020 2020 2020 2020 2029  sc.            )
+0000e9b0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+0000e9c0: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
+0000e9d0: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+0000e9e0: 226f 7574 5f63 6f6e 6361 7465 222c 0a20  "out_concate",. 
+0000e9f0: 2020 2020 2020 2020 2020 2046 696c 6528             File(
+0000ea00: 6f75 7470 7574 3d54 7275 652c 206f 7074  output=True, opt
+0000ea10: 696f 6e61 6c3d 5472 7565 2c20 6465 7363  ional=True, desc
+0000ea20: 3d6f 7574 5f63 6f6e 6361 7465 5f64 6573  =out_concate_des
+0000ea30: 6329 2c0a 2020 2020 2020 2020 290a 0a20  c),.        ).. 
+0000ea40: 2020 2020 2020 2073 656c 662e 696e 6974         self.init
+0000ea50: 5f64 6566 6175 6c74 5f74 7261 6974 7328  _default_traits(
+0000ea60: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
+0000ea70: 6f75 7470 7574 7328 7365 6c66 2c20 6973  outputs(self, is
+0000ea80: 5f70 6c75 6767 6564 3d4e 6f6e 6529 3a0a  _plugged=None):.
+0000ea90: 2020 2020 2020 2020 2222 2244 6564 6963          """Dedic
+0000eaa0: 6174 6564 2074 6f20 7468 6520 696e 6974  ated to the init
+0000eab0: 6961 6c69 7361 7469 6f6e 2073 7465 7020  ialisation step 
+0000eac0: 6f66 2074 6865 2062 7269 636b 2e0a 0a20  of the brick... 
+0000ead0: 2020 2020 2020 2054 6865 206d 6169 6e20         The main 
+0000eae0: 6f62 6a65 6374 6976 6520 6f66 2074 6869  objective of thi
+0000eaf0: 7320 6d65 7468 6f64 2069 7320 746f 2070  s method is to p
+0000eb00: 726f 6475 6365 2074 6865 206f 7574 7075  roduce the outpu
+0000eb10: 7473 206f 6620 7468 650a 2020 2020 2020  ts of the.      
+0000eb20: 2020 6272 6963 6b73 2028 7365 6c66 2e6f    bricks (self.o
+0000eb30: 7574 7075 7473 2920 616e 6420 7468 6520  utputs) and the 
+0000eb40: 6173 736f 6369 6174 6564 2074 6167 7320  associated tags 
+0000eb50: 2873 656c 662e 696e 6865 7269 7461 6e63  (self.inheritanc
+0000eb60: 655f 6469 6329 2c0a 2020 2020 2020 2020  e_dic),.        
+0000eb70: 6966 2064 6566 696e 6564 2068 6572 652e  if defined here.
+0000eb80: 2054 6f20 776f 726b 2070 726f 7065 726c   To work properl
+0000eb90: 7920 7468 6973 206d 6574 686f 6420 6d75  y this method mu
+0000eba0: 7374 2072 6574 7572 6e0a 2020 2020 2020  st return.      
+0000ebb0: 2020 7365 6c66 2e6d 616b 655f 696e 6974    self.make_init
+0000ebc0: 5265 7375 6c74 2829 206f 626a 6563 742e  Result() object.
+0000ebd0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000ebe0: 2069 735f 706c 7567 6765 643a 2074 6865   is_plugged: the
+0000ebf0: 2073 7461 7465 2c20 6c69 6e6b 6564 206f   state, linked o
+0000ec00: 7220 6e6f 742c 206f 6620 7468 6520 706c  r not, of the pl
+0000ec10: 7567 732e 0a20 2020 2020 2020 203a 7265  ugs..        :re
+0000ec20: 7475 726e 733a 2061 2064 6963 7469 6f6e  turns: a diction
+0000ec30: 6172 7920 7769 7468 2072 6571 7569 7265  ary with require
+0000ec40: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
+0000ec50: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
+0000ec60: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+0000ec70: 2020 2020 2020 2020 2320 5573 696e 6720          # Using 
+0000ec80: 7468 6520 696e 6865 7269 7461 6e63 6520  the inheritance 
+0000ec90: 746f 2050 726f 6365 7373 4d49 4120 636c  to ProcessMIA cl
+0000eca0: 6173 732c 206c 6973 745f 6f75 7470 7574  ass, list_output
+0000ecb0: 7320 6d65 7468 6f64 0a20 2020 2020 2020  s method.       
+0000ecc0: 2073 7570 6572 2845 7874 7261 6374 524f   super(ExtractRO
+0000ecd0: 4962 794c 6162 656c 2c20 7365 6c66 292e  IbyLabel, self).
+0000ece0: 6c69 7374 5f6f 7574 7075 7473 2829 0a0a  list_outputs()..
+0000ecf0: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
+0000ed00: 7320 6465 6669 6e69 7469 6f6e 0a20 2020  s definition.   
+0000ed10: 2020 2020 2069 6620 7365 6c66 2e69 6e5f       if self.in_
+0000ed20: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+0000ed30: 2020 6966 2073 656c 662e 6f75 7470 7574    if self.output
+0000ed40: 5f64 6972 6563 746f 7279 3a0a 2020 2020  _directory:.    
+0000ed50: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
+0000ed60: 645f 6578 742c 2069 6e5f 6578 742c 2066  d_ext, in_ext, f
+0000ed70: 696c 655f 6e61 6d65 203d 2063 6865 636b  ile_name = check
+0000ed80: 4669 6c65 4578 7428 7365 6c66 2e69 6e5f  FileExt(self.in_
+0000ed90: 6669 6c65 2c20 4558 5429 0a20 2020 2020  file, EXT).     
+0000eda0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000edb0: 7420 7661 6c69 645f 6578 743a 0a20 2020  t valid_ext:.   
+0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edd0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 2245 7874 7261 6374 524f 4962 794c 6162  "ExtractROIbyLab
+0000ee00: 656c 2062 7269 636b 3a20 220a 2020 2020  el brick: ".    
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee20: 2020 2020 2254 6865 2069 6e70 7574 2069      "The input i
+0000ee30: 6d61 6765 2066 6f72 6d61 7420 6973 206e  mage format is n
+0000ee40: 6f74 2072 6563 6f67 6e69 7a65 642e 2e2e  ot recognized...
+0000ee50: 2122 0a20 2020 2020 2020 2020 2020 2020  !".             
+0000ee60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000ee70: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000ee80: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+0000ee90: 2020 2020 6c61 6265 6c73 203d 2022 220a      labels = "".
+0000eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eeb0: 6f75 745f 6669 6c65 7320 3d20 5b5d 0a20  out_files = []. 
+0000eec0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000eed0: 6620 7365 6c66 2e73 7566 6669 783a 0a20  f self.suffix:. 
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eef0: 2020 206c 6162 656c 7320 3d20 225f 2220     labels = "_" 
+0000ef00: 2b20 7365 6c66 2e73 7566 6669 780a 2020  + self.suffix.  
+0000ef10: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000ef20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000ef30: 2020 2020 2020 2020 666f 7220 6c61 6265          for labe
+0000ef40: 6c20 696e 2073 656c 662e 6c61 6265 6c73  l in self.labels
+0000ef50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ef60: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
+0000ef70: 202b 3d20 225f 2220 2b20 7374 7228 6c61   += "_" + str(la
+0000ef80: 6265 6c29 0a20 2020 2020 2020 2020 2020  bel).           
+0000ef90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000efa0: 7365 6c66 2e73 6176 655f 6561 6368 5f72  self.save_each_r
+0000efb0: 6f69 3a0a 2020 2020 2020 2020 2020 2020  oi:.            
+0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efd0: 6f75 745f 6669 6c65 732e 6170 7065 6e64  out_files.append
+0000efe0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f000: 2020 6f73 2e70 6174 682e 6a6f 696e 280a    os.path.join(.
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f030: 2020 2020 7365 6c66 2e6f 7574 7075 745f      self.output_
+0000f040: 6469 7265 6374 6f72 792c 0a20 2020 2020  directory,.     
+0000f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000f070: 696c 655f 6e61 6d65 0a20 2020 2020 2020  ile_name.       
+0000f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f090: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000f0a0: 5f22 0a20 2020 2020 2020 2020 2020 2020  _".             
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0c0: 2020 2020 2020 202b 2073 7472 286c 6162         + str(lab
+0000f0d0: 656c 290a 2020 2020 2020 2020 2020 2020  el).            
+0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0f0: 2020 2020 2020 2020 2b20 222e 220a 2020          + ".".  
+0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f120: 2020 2b20 696e 5f65 7874 2c0a 2020 2020    + in_ext,.    
+0000f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f140: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f160: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000f170: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000f180: 7365 6c66 2e73 6176 655f 6561 6368 5f72  self.save_each_r
+0000f190: 6f69 2061 6e64 206f 7574 5f66 696c 6573  oi and out_files
+0000f1a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f1b0: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+0000f1c0: 7473 5b22 6f75 745f 6669 6c65 7322 5d20  ts["out_files"] 
+0000f1d0: 3d20 6f75 745f 6669 6c65 730a 0a20 2020  = out_files..   
+0000f1e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000f1f0: 7365 6c66 2e73 6176 655f 636f 6e63 6174  self.save_concat
+0000f200: 655f 726f 693a 0a20 2020 2020 2020 2020  e_roi:.         
+0000f210: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f220: 6f75 7470 7574 735b 226f 7574 5f63 6f6e  outputs["out_con
+0000f230: 6361 7465 225d 203d 206f 732e 7061 7468  cate"] = os.path
+0000f240: 2e6a 6f69 6e28 0a20 2020 2020 2020 2020  .join(.         
+0000f250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f260: 656c 662e 6f75 7470 7574 5f64 6972 6563  elf.output_direc
+0000f270: 746f 7279 2c0a 2020 2020 2020 2020 2020  tory,.          
+0000f280: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000f290: 6c65 5f6e 616d 6520 2b20 225f 636f 6e63  le_name + "_conc
+0000f2a0: 6174 6522 202b 2073 7472 286c 6162 656c  ate" + str(label
+0000f2b0: 7329 202b 2022 2e22 202b 2069 6e5f 6578  s) + "." + in_ex
+0000f2c0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0000f2d0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000f2e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000f2f0: 662e 6f75 7470 7574 733a 0a20 2020 2020  f.outputs:.     
+0000f300: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000f310: 6620 7365 6c66 2e73 6176 655f 6561 6368  f self.save_each
+0000f320: 5f72 6f69 3a0a 2020 2020 2020 2020 2020  _roi:.          
+0000f330: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000f340: 7220 6f75 745f 7661 6c20 696e 2073 656c  r out_val in sel
+0000f350: 662e 6f75 7470 7574 735b 226f 7574 5f66  f.outputs["out_f
+0000f360: 696c 6573 225d 3a0a 2020 2020 2020 2020  iles"]:.        
+0000f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f380: 2020 2020 7365 6c66 2e74 6167 735f 696e      self.tags_in
+0000f390: 6865 7269 7461 6e63 6528 0a20 2020 2020  heritance(.     
+0000f3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3b0: 2020 2020 2020 2020 2020 2069 6e5f 6669             in_fi
+0000f3c0: 6c65 3d73 656c 662e 696e 5f66 696c 652c  le=self.in_file,
+0000f3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3f0: 206f 7574 5f66 696c 653d 6f75 745f 7661   out_file=out_va
+0000f400: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+0000f410: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000f420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f430: 2020 2020 2069 6620 7365 6c66 2e73 6176       if self.sav
+0000f440: 655f 636f 6e63 6174 655f 726f 693a 0a20  e_concate_roi:. 
+0000f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f460: 2020 2020 2020 2073 656c 662e 7461 6773         self.tags
+0000f470: 5f69 6e68 6572 6974 616e 6365 280a 2020  _inheritance(.  
+0000f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f490: 2020 2020 2020 2020 2020 696e 5f66 696c            in_fil
+0000f4a0: 653d 7365 6c66 2e69 6e5f 6669 6c65 2c0a  e=self.in_file,.
+0000f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4c0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000f4d0: 6669 6c65 3d73 656c 662e 6f75 7470 7574  file=self.output
+0000f4e0: 735b 226f 7574 5f63 6f6e 6361 7465 225d  s["out_concate"]
+0000f4f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f500: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000f510: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000f520: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000f530: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0000f540: 2020 2020 2020 2020 2022 4578 7472 6163           "Extrac
+0000f550: 7452 4f49 6279 4c61 6265 6c20 6272 6963  tROIbyLabel bric
+0000f560: 6b3a 2022 0a20 2020 2020 2020 2020 2020  k: ".           
+0000f570: 2020 2020 2020 2020 2022 4e6f 206f 7574           "No out
+0000f580: 7075 745f 6469 7265 6374 6f72 7920 7761  put_directory wa
+0000f590: 7320 666f 756e 642e 2e2e 215c 6e22 0a20  s found...!\n". 
+0000f5a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f5c0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+0000f5d0: 2023 2052 6574 7572 6e20 7468 6520 7265   # Return the re
+0000f5e0: 7175 6972 656d 656e 742c 206f 7574 7075  quirement, outpu
+0000f5f0: 7473 2061 6e64 2069 6e68 6572 6974 616e  ts and inheritan
+0000f600: 6365 5f64 6963 740a 2020 2020 2020 2020  ce_dict.        
+0000f610: 7265 7475 726e 2073 656c 662e 6d61 6b65  return self.make
+0000f620: 5f69 6e69 7452 6573 756c 7428 290a 0a20  _initResult().. 
+0000f630: 2020 2064 6566 2072 756e 5f70 726f 6365     def run_proce
+0000f640: 7373 5f6d 6961 2873 656c 6629 3a0a 2020  ss_mia(self):.  
+0000f650: 2020 2020 2020 2222 2244 6564 6963 6174        """Dedicat
+0000f660: 6564 2074 6f20 7468 6520 7072 6f63 6573  ed to the proces
+0000f670: 7320 6c61 756e 6368 2073 7465 7020 6f66  s launch step of
+0000f680: 2074 6865 2062 7269 636b 2e22 2222 0a20   the brick.""". 
+0000f690: 2020 2020 2020 2073 7570 6572 2845 7874         super(Ext
+0000f6a0: 7261 6374 524f 4962 794c 6162 656c 2c20  ractROIbyLabel, 
+0000f6b0: 7365 6c66 292e 7275 6e5f 7072 6f63 6573  self).run_proces
+0000f6c0: 735f 6d69 6128 290a 0a20 2020 2020 2020  s_mia()..       
+0000f6d0: 2073 6567 5f76 6f6c 756d 6520 3d20 6e70   seg_volume = np
+0000f6e0: 2e61 7361 7272 6179 286e 6962 2e6c 6f61  .asarray(nib.loa
+0000f6f0: 6428 7365 6c66 2e69 6e5f 6669 6c65 292e  d(self.in_file).
+0000f700: 6461 7461 6f62 6a29 0a20 2020 2020 2020  dataobj).       
+0000f710: 2063 6f6e 6361 7465 5f72 6f69 203d 204e   concate_roi = N
+0000f720: 6f6e 650a 2020 2020 2020 2020 6920 3d20  one.        i = 
+0000f730: 300a 2020 2020 2020 2020 666f 7220 6c61  0.        for la
+0000f740: 6265 6c20 696e 2073 656c 662e 6c61 6265  bel in self.labe
+0000f750: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+0000f760: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+0000f770: 6c66 2e6f 7574 5f66 696c 6573 2c20 5472  lf.out_files, Tr
+0000f780: 6169 744c 6973 744f 626a 6563 7429 3a0a  aitListObject):.
+0000f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7a0: 6f75 745f 6669 6c65 203d 2073 656c 662e  out_file = self.
+0000f7b0: 6f75 745f 6669 6c65 735b 695d 0a0a 2020  out_files[i]..  
+0000f7c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7e0: 6f75 745f 6669 6c65 203d 2073 656c 662e  out_file = self.
+0000f7f0: 6f75 745f 6669 6c65 730a 2020 2020 2020  out_files.      
+0000f800: 2020 2020 2020 6c61 6265 6c5f 7365 675f        label_seg_
+0000f810: 766f 6c75 6d65 203d 206e 702e 7768 6572  volume = np.wher
+0000f820: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0000f830: 2020 2073 6567 5f76 6f6c 756d 6520 3d3d     seg_volume ==
+0000f840: 2069 6e74 286c 6162 656c 292c 2069 6e74   int(label), int
+0000f850: 286c 6162 656c 292c 2030 0a20 2020 2020  (label), 0.     
+0000f860: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000f870: 2020 2020 206c 6162 656c 5f73 6567 5f69       label_seg_i
+0000f880: 6d61 6765 203d 206e 6962 2e4e 6966 7469  mage = nib.Nifti
+0000f890: 3149 6d61 6765 280a 2020 2020 2020 2020  1Image(.        
+0000f8a0: 2020 2020 2020 2020 6c61 6265 6c5f 7365          label_se
+0000f8b0: 675f 766f 6c75 6d65 2c0a 2020 2020 2020  g_volume,.      
+0000f8c0: 2020 2020 2020 2020 2020 6e69 622e 6c6f            nib.lo
+0000f8d0: 6164 2873 656c 662e 696e 5f66 696c 6529  ad(self.in_file)
+0000f8e0: 2e61 6666 696e 652c 0a20 2020 2020 2020  .affine,.       
+0000f8f0: 2020 2020 2020 2020 206e 6962 2e6c 6f61           nib.loa
+0000f900: 6428 7365 6c66 2e69 6e5f 6669 6c65 292e  d(self.in_file).
+0000f910: 6865 6164 6572 2c0a 2020 2020 2020 2020  header,.        
+0000f920: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000f930: 2020 6966 2073 656c 662e 7361 7665 5f65    if self.save_e
+0000f940: 6163 685f 726f 693a 0a20 2020 2020 2020  ach_roi:.       
+0000f950: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+0000f960: 6174 682e 6578 6973 7473 286f 7574 5f66  ath.exists(out_f
+0000f970: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+0000f980: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
+0000f990: 6f76 6528 6f75 745f 6669 6c65 290a 2020  ove(out_file).  
+0000f9a0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000f9b0: 6265 6c5f 7365 675f 696d 6167 652e 746f  bel_seg_image.to
+0000f9c0: 5f66 696c 656e 616d 6528 6f75 745f 6669  _filename(out_fi
+0000f9d0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+0000f9e0: 6966 2063 6f6e 6361 7465 5f72 6f69 2069  if concate_roi i
+0000f9f0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0000fa00: 2020 2020 2020 2020 636f 6e63 6174 655f          concate_
+0000fa10: 726f 6920 3d20 6c61 6265 6c5f 7365 675f  roi = label_seg_
+0000fa20: 766f 6c75 6d65 203e 2030 0a20 2020 2020  volume > 0.     
+0000fa30: 2020 2020 2020 2063 6f6e 6361 7465 5f72         concate_r
+0000fa40: 6f69 203d 206e 702e 7768 6572 6528 0a20  oi = np.where(. 
+0000fa50: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000fa60: 6162 656c 5f73 6567 5f76 6f6c 756d 6520  abel_seg_volume 
+0000fa70: 3e20 302c 206c 6162 656c 5f73 6567 5f76  > 0, label_seg_v
+0000fa80: 6f6c 756d 652c 2063 6f6e 6361 7465 5f72  olume, concate_r
+0000fa90: 6f69 0a20 2020 2020 2020 2020 2020 2029  oi.            )
+0000faa0: 0a0a 2020 2020 2020 2020 2020 2020 6920  ..            i 
+0000fab0: 2b3d 2031 0a0a 2020 2020 2020 2020 6966  += 1..        if
+0000fac0: 2073 656c 662e 7361 7665 5f63 6f6e 6361   self.save_conca
+0000fad0: 7465 5f72 6f69 3a0a 2020 2020 2020 2020  te_roi:.        
+0000fae0: 2020 2020 636f 6e63 6174 655f 726f 695f      concate_roi_
+0000faf0: 696d 6167 6520 3d20 6e69 622e 4e69 6674  image = nib.Nift
+0000fb00: 6931 496d 6167 6528 0a20 2020 2020 2020  i1Image(.       
+0000fb10: 2020 2020 2020 2020 2063 6f6e 6361 7465           concate
+0000fb20: 5f72 6f69 2c0a 2020 2020 2020 2020 2020  _roi,.          
+0000fb30: 2020 2020 2020 6e69 622e 6c6f 6164 2873        nib.load(s
+0000fb40: 656c 662e 696e 5f66 696c 6529 2e61 6666  elf.in_file).aff
+0000fb50: 696e 652c 0a20 2020 2020 2020 2020 2020  ine,.           
+0000fb60: 2020 2020 2068 6561 6465 723d 6e69 622e       header=nib.
+0000fb70: 6c6f 6164 2873 656c 662e 696e 5f66 696c  load(self.in_fil
+0000fb80: 6529 2e68 6561 6465 722c 0a20 2020 2020  e).header,.     
+0000fb90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000fba0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+0000fbb0: 6578 6973 7473 2873 656c 662e 6f75 745f  exists(self.out_
+0000fbc0: 636f 6e63 6174 6529 3a0a 2020 2020 2020  concate):.      
+0000fbd0: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
+0000fbe0: 6f76 6528 7365 6c66 2e6f 7574 5f63 6f6e  ove(self.out_con
+0000fbf0: 6361 7465 290a 2020 2020 2020 2020 2020  cate).          
+0000fc00: 2020 636f 6e63 6174 655f 726f 695f 696d    concate_roi_im
+0000fc10: 6167 652e 746f 5f66 696c 656e 616d 6528  age.to_filename(
+0000fc20: 7365 6c66 2e6f 7574 5f63 6f6e 6361 7465  self.out_concate
+0000fc30: 290a 0a0a 636c 6173 7320 4578 7472 6163  )...class Extrac
+0000fc40: 7453 6967 6e61 6c52 4f49 2850 726f 6365  tSignalROI(Proce
+0000fc50: 7373 4d49 4129 3a0a 2020 2020 2222 220a  ssMIA):.    """.
+0000fc60: 2020 2020 2a45 7874 7261 6374 2073 6967      *Extract sig
+0000fc70: 6e61 6c20 6672 6f6d 2052 4f49 2075 7369  nal from ROI usi
+0000fc80: 6e67 2061 2073 6567 6d65 6e74 6174 696f  ng a segmentatio
+0000fc90: 6e20 6669 6c65 2077 6974 6820 6c61 6265  n file with labe
+0000fca0: 6c2a 0a0a 2020 2020 506c 6561 7365 2c20  l*..    Please, 
+0000fcb0: 7365 6520 7468 6520 636f 6d70 6c65 7465  see the complete
+0000fcc0: 2064 6f63 756d 656e 7461 7469 6f6e 2066   documentation f
+0000fcd0: 6f72 2074 6865 2060 4578 7472 6163 7453  or the `ExtractS
+0000fce0: 6967 6e61 6c52 4f49 2062 7269 636b 0a20  ignalROI brick. 
+0000fcf0: 2020 2069 6e20 7468 6520 6d69 615f 7072     in the mia_pr
+0000fd00: 6f63 6573 7365 7320 7765 6273 6974 650a  ocesses website.
+0000fd10: 2020 2020 3c68 7474 7073 3a2f 2f70 6f70      <https://pop
+0000fd20: 756c 7365 2e67 6974 6875 622e 696f 2f6d  ulse.github.io/m
+0000fd30: 6961 5f70 726f 6365 7373 6573 2f68 746d  ia_processes/htm
+0000fd40: 6c2f 646f 6375 6d65 6e74 6174 696f 6e2f  l/documentation/
+0000fd50: 6272 6963 6b73 2f70 7265 7072 6f63 6573  bricks/preproces
+0000fd60: 732f 6f74 6865 722f 4578 7472 6163 7453  s/other/ExtractS
+0000fd70: 6967 6e61 6c52 4f49 2e68 746d 6c3e 605f  ignalROI.html>`_
+0000fd80: 0a0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+0000fd90: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0000fda0: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
+0000fdb0: 6469 6361 7465 6420 746f 2074 6865 2061  dicated to the a
+0000fdc0: 7474 7269 6275 7465 7320 696e 6974 6961  ttributes initia
+0000fdd0: 6c69 7361 7469 6f6e 202f 2069 6e73 7461  lisation / insta
+0000fde0: 6e74 6961 7469 6f6e 2e0a 0a20 2020 2020  ntiation...     
+0000fdf0: 2020 2054 6865 2069 6e70 7574 2061 6e64     The input and
+0000fe00: 206f 7574 7075 7420 706c 7567 7320 6172   output plugs ar
+0000fe10: 6520 6465 6669 6e65 6420 6865 7265 2e20  e defined here. 
+0000fe20: 5468 6520 7370 6563 6961 6c0a 2020 2020  The special.    
+0000fe30: 2020 2020 2773 656c 662e 7265 7175 6972      'self.requir
+0000fe40: 656d 656e 7427 2061 7474 7269 6275 7465  ement' attribute
+0000fe50: 2028 6f70 7469 6f6e 616c 2920 6973 2075   (optional) is u
+0000fe60: 7365 6420 746f 2064 6566 696e 6520 7468  sed to define th
+0000fe70: 650a 2020 2020 2020 2020 7468 6972 642d  e.        third-
+0000fe80: 7061 7274 7920 7072 6f64 7563 7473 206e  party products n
+0000fe90: 6563 6573 7361 7279 2066 6f72 2074 6865  ecessary for the
+0000fea0: 2072 756e 6e69 6e67 206f 6620 7468 6520   running of the 
+0000feb0: 6272 6963 6b2e 0a20 2020 2020 2020 2022  brick..        "
+0000fec0: 2222 0a20 2020 2020 2020 2023 2049 6e69  "".        # Ini
+0000fed0: 7469 616c 6973 6174 696f 6e20 6f66 2074  tialisation of t
+0000fee0: 6865 206f 626a 6563 7473 206e 6565 6465  he objects neede
+0000fef0: 6420 666f 7220 7468 6520 6c61 756e 6368  d for the launch
+0000ff00: 206f 6620 7468 6520 6272 6963 6b0a 2020   of the brick.  
+0000ff10: 2020 2020 2020 7375 7065 7228 4578 7472        super(Extr
+0000ff20: 6163 7453 6967 6e61 6c52 4f49 2c20 7365  actSignalROI, se
+0000ff30: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a0a  lf).__init__()..
+0000ff40: 2020 2020 2020 2020 2320 5468 6972 6420          # Third 
+0000ff50: 7061 7274 7920 736f 6674 7761 7265 7320  party softwares 
+0000ff60: 7265 7175 6972 6564 2066 6f72 2074 6865  required for the
+0000ff70: 2065 7865 6375 7469 6f6e 206f 6620 7468   execution of th
+0000ff80: 6520 6272 6963 6b0a 2020 2020 2020 2020  e brick.        
+0000ff90: 7365 6c66 2e72 6571 7569 7265 6d65 6e74  self.requirement
+0000ffa0: 203d 205b 5d0a 0a20 2020 2020 2020 2023   = []..        #
+0000ffb0: 2049 6e70 7574 7320 6465 7363 7269 7074   Inputs descript
+0000ffc0: 696f 6e0a 2020 2020 2020 2020 696e 5f66  ion.        in_f
+0000ffd0: 696c 655f 6465 7363 203d 2028 0a20 2020  ile_desc = (.   
+0000ffe0: 2020 2020 2020 2020 2022 496e 7075 7420           "Input 
+0000fff0: 696d 6167 6520 6672 6f6d 2077 6869 6368  image from which
+00010000: 2074 6f20 6578 7472 6163 7420 7468 6520   to extract the 
+00010010: 7369 676e 616c 220a 2020 2020 2020 2020  signal".        
+00010020: 2020 2020 2228 6120 7061 7468 6c69 6b65      "(a pathlike
+00010030: 206f 626a 6563 7420 6f72 2073 7472 696e   object or strin
+00010040: 6720 7265 7072 6573 656e 7469 6e67 2061  g representing a
+00010050: 2066 696c 6529 2e22 0a20 2020 2020 2020   file).".       
+00010060: 2029 0a20 2020 2020 2020 2069 6e5f 7365   ).        in_se
+00010070: 675f 6465 7363 203d 2028 0a20 2020 2020  g_desc = (.     
+00010080: 2020 2020 2020 2022 496e 7075 7420 7365         "Input se
+00010090: 676d 656e 7465 6420 6669 6c65 2077 6974  gmented file wit
+000100a0: 6820 6c61 6265 6c20 2869 6e20 696e 2d66  h label (in in-f
+000100b0: 696c 6520 7370 6163 6529 2022 0a20 2020  ile space) ".   
+000100c0: 2020 2020 2020 2020 2022 2861 2070 6174           "(a pat
+000100d0: 686c 696b 6520 6f62 6a65 6374 206f 7220  hlike object or 
+000100e0: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
+000100f0: 696e 6720 6120 6669 6c65 292e 220a 2020  ing a file).".  
+00010100: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00010110: 6c61 6265 6c73 5f64 6573 6320 3d20 280a  labels_desc = (.
+00010120: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+00010130: 206c 6162 656c 206c 6973 7420 6f66 2074   label list of t
+00010140: 6865 2052 4f49 2074 6f20 6578 7472 6163  he ROI to extrac
+00010150: 7420 7468 6520 7369 676e 616c 2028 6120  t the signal (a 
+00010160: 6c69 7374 206f 6620 696e 7429 220a 2020  list of int)".  
+00010170: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00010180: 7375 6666 6978 5f64 6573 6320 3d20 2253  suffix_desc = "S
+00010190: 7566 6669 7820 666f 7220 6f75 746f 7574  uffix for outout
+000101a0: 2066 696c 6520 2820 7374 7269 6e67 2922   file ( string)"
+000101b0: 0a0a 2020 2020 2020 2020 2320 4f75 7470  ..        # Outp
+000101c0: 7574 7320 6465 7363 7269 7074 696f 6e0a  uts description.
+000101d0: 2020 2020 2020 2020 2320 726f 695f 6e69          # roi_ni
+000101e0: 6261 6265 6c5f 6465 7363 203d 2028 0a20  babel_desc = (. 
+000101f0: 2020 2020 2020 2023 2020 2020 2022 4578         #     "Ex
+00010200: 7472 6163 7465 6420 524f 4920 286e 6962  tracted ROI (nib
+00010210: 6162 656c 204e 6966 7469 3149 6d61 6765  abel Nifti1Image
+00010220: 2066 6f72 6d61 7429 220a 2020 2020 2020   format)".      
+00010230: 2020 2320 290a 0a20 2020 2020 2020 2073    # )..        s
+00010240: 6967 6e61 6c73 5f64 6573 6320 3d20 280a  ignals_desc = (.
+00010250: 2020 2020 2020 2020 2020 2020 2245 7874              "Ext
+00010260: 7261 6374 6564 2073 6967 6e61 6c20 666f  racted signal fo
+00010270: 7220 6561 6368 2052 4f49 2069 6e20 6120  r each ROI in a 
+00010280: 6373 7620 6669 6c65 2022 0a20 2020 2020  csv file ".     
+00010290: 2020 2020 2020 2022 2861 2070 6174 686c         "(a pathl
+000102a0: 696b 6520 6f62 6a65 6374 206f 7220 7374  ike object or st
+000102b0: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
+000102c0: 6720 6120 6669 6c65 2922 0a20 2020 2020  g a file)".     
+000102d0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+000102e0: 496e 7075 7473 2074 7261 6974 730a 2020  Inputs traits.  
+000102f0: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00010300: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+00010310: 2020 2269 6e5f 6669 6c65 222c 2046 696c    "in_file", Fil
+00010320: 6528 6f75 7470 7574 3d46 616c 7365 2c20  e(output=False, 
+00010330: 6f70 7469 6f6e 616c 3d46 616c 7365 2c20  optional=False, 
+00010340: 6465 7363 3d69 6e5f 6669 6c65 5f64 6573  desc=in_file_des
+00010350: 6329 0a20 2020 2020 2020 2029 0a20 2020  c).        ).   
+00010360: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+00010370: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+00010380: 2022 696e 5f73 6567 222c 2046 696c 6528   "in_seg", File(
+00010390: 6f75 7470 7574 3d46 616c 7365 2c20 6f70  output=False, op
+000103a0: 7469 6f6e 616c 3d46 616c 7365 2c20 6465  tional=False, de
+000103b0: 7363 3d69 6e5f 7365 675f 6465 7363 290a  sc=in_seg_desc).
+000103c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000103d0: 2020 7365 6c66 2e61 6464 5f74 7261 6974    self.add_trait
+000103e0: 280a 2020 2020 2020 2020 2020 2020 226c  (.            "l
+000103f0: 6162 656c 7322 2c0a 2020 2020 2020 2020  abels",.        
+00010400: 2020 2020 7472 6169 7473 2e4c 6973 7428      traits.List(
+00010410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010420: 205b 315d 2c0a 2020 2020 2020 2020 2020   [1],.          
+00010430: 2020 2020 2020 7472 6169 7473 2e49 6e74        traits.Int
+00010440: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+00010450: 2020 2020 6f75 7470 7574 3d46 616c 7365      output=False
+00010460: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010470: 2020 6f70 7469 6f6e 616c 3d54 7275 652c    optional=True,
+00010480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010490: 2064 6573 633d 6c61 6265 6c73 5f64 6573   desc=labels_des
+000104a0: 632c 0a20 2020 2020 2020 2020 2020 2029  c,.            )
+000104b0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+000104c0: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
+000104d0: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+000104e0: 2273 7566 6669 7822 2c0a 2020 2020 2020  "suffix",.      
+000104f0: 2020 2020 2020 7472 6169 7473 2e53 7472        traits.Str
+00010500: 696e 6728 6f75 7470 7574 3d46 616c 7365  ing(output=False
+00010510: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
+00010520: 2064 6573 633d 7375 6666 6978 5f64 6573   desc=suffix_des
+00010530: 6329 2c0a 2020 2020 2020 2020 290a 0a20  c),.        ).. 
+00010540: 2020 2020 2020 2023 204f 7574 7075 7473         # Outputs
+00010550: 2074 7261 6974 730a 2020 2020 2020 2020   traits.        
+00010560: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+00010570: 2020 2020 2020 2020 2020 2020 2273 6967              "sig
+00010580: 6e61 6c73 222c 2046 696c 6528 6f75 7470  nals", File(outp
+00010590: 7574 3d54 7275 652c 206f 7074 696f 6e61  ut=True, optiona
+000105a0: 6c3d 4661 6c73 652c 2064 6573 633d 7369  l=False, desc=si
+000105b0: 676e 616c 735f 6465 7363 290a 2020 2020  gnals_desc).    
+000105c0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+000105d0: 656c 662e 696e 6974 5f64 6566 6175 6c74  elf.init_default
+000105e0: 5f74 7261 6974 7328 290a 0a20 2020 2064  _traits()..    d
+000105f0: 6566 206c 6973 745f 6f75 7470 7574 7328  ef list_outputs(
+00010600: 7365 6c66 2c20 6973 5f70 6c75 6767 6564  self, is_plugged
+00010610: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00010620: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
+00010630: 7468 6520 696e 6974 6961 6c69 7361 7469  the initialisati
+00010640: 6f6e 2073 7465 7020 6f66 2074 6865 2062  on step of the b
+00010650: 7269 636b 2e0a 0a20 2020 2020 2020 2054  rick...        T
+00010660: 6865 206d 6169 6e20 6f62 6a65 6374 6976  he main objectiv
+00010670: 6520 6f66 2074 6869 7320 6d65 7468 6f64  e of this method
+00010680: 2069 7320 746f 2070 726f 6475 6365 2074   is to produce t
+00010690: 6865 206f 7574 7075 7473 206f 6620 7468  he outputs of th
+000106a0: 650a 2020 2020 2020 2020 6272 6963 6b73  e.        bricks
+000106b0: 2028 7365 6c66 2e6f 7574 7075 7473 2920   (self.outputs) 
+000106c0: 616e 6420 7468 6520 6173 736f 6369 6174  and the associat
+000106d0: 6564 2074 6167 7320 2873 656c 662e 696e  ed tags (self.in
+000106e0: 6865 7269 7461 6e63 655f 6469 6329 2c0a  heritance_dic),.
+000106f0: 2020 2020 2020 2020 6966 2064 6566 696e          if defin
+00010700: 6564 2068 6572 652e 2054 6f20 776f 726b  ed here. To work
+00010710: 2070 726f 7065 726c 7920 7468 6973 206d   properly this m
+00010720: 6574 686f 6420 6d75 7374 2072 6574 7572  ethod must retur
+00010730: 6e0a 2020 2020 2020 2020 7365 6c66 2e6d  n.        self.m
+00010740: 616b 655f 696e 6974 5265 7375 6c74 2829  ake_initResult()
+00010750: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
+00010760: 2020 3a70 6172 616d 2069 735f 706c 7567    :param is_plug
+00010770: 6765 643a 2074 6865 2073 7461 7465 2c20  ged: the state, 
+00010780: 6c69 6e6b 6564 206f 7220 6e6f 742c 206f  linked or not, o
+00010790: 6620 7468 6520 706c 7567 732e 0a20 2020  f the plugs..   
+000107a0: 2020 2020 203a 7265 7475 726e 733a 2061       :returns: a
+000107b0: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
+000107c0: 2072 6571 7569 7265 6d65 6e74 2c20 6f75   requirement, ou
+000107d0: 7470 7574 7320 616e 6420 696e 6865 7269  tputs and inheri
+000107e0: 7461 6e63 655f 6469 6374 2e0a 2020 2020  tance_dict..    
+000107f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010800: 2320 5573 696e 6720 7468 6520 696e 6865  # Using the inhe
+00010810: 7269 7461 6e63 6520 746f 2050 726f 6365  ritance to Proce
+00010820: 7373 4d49 4120 636c 6173 732c 206c 6973  ssMIA class, lis
+00010830: 745f 6f75 7470 7574 7320 6d65 7468 6f64  t_outputs method
+00010840: 0a20 2020 2020 2020 2073 7570 6572 2845  .        super(E
+00010850: 7874 7261 6374 5369 676e 616c 524f 492c  xtractSignalROI,
+00010860: 2073 656c 6629 2e6c 6973 745f 6f75 7470   self).list_outp
+00010870: 7574 7328 290a 0a20 2020 2020 2020 2023  uts()..        #
+00010880: 204f 7574 7075 7473 2064 6566 696e 6974   Outputs definit
+00010890: 696f 6e0a 2020 2020 2020 2020 6966 2073  ion.        if s
+000108a0: 656c 662e 696e 5f66 696c 653a 0a20 2020  elf.in_file:.   
+000108b0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000108c0: 2e6f 7574 7075 745f 6469 7265 6374 6f72  .output_director
+000108d0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000108e0: 2020 2076 616c 6964 5f65 7874 2c20 696e     valid_ext, in
+000108f0: 5f65 7874 2c20 6669 6c65 5f6e 616d 6520  _ext, file_name 
+00010900: 3d20 6368 6563 6b46 696c 6545 7874 2873  = checkFileExt(s
+00010910: 656c 662e 696e 5f66 696c 652c 2045 5854  elf.in_file, EXT
+00010920: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010930: 2020 6966 206e 6f74 2076 616c 6964 5f65    if not valid_e
+00010940: 7874 3a0a 2020 2020 2020 2020 2020 2020  xt:.            
+00010950: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00010960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010970: 2020 2020 2020 2022 4578 7472 6163 7452         "ExtractR
+00010980: 4f49 6279 4c61 6265 6c20 6272 6963 6b3a  OIbyLabel brick:
+00010990: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000109a0: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
+000109b0: 696e 7075 7420 696d 6167 6520 666f 726d  input image form
+000109c0: 6174 2069 7320 6e6f 7420 7265 636f 676e  at is not recogn
+000109d0: 697a 6564 2e2e 2e21 220a 2020 2020 2020  ized...!".      
+000109e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000109f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a00: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00010a10: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00010a20: 7320 3d20 2222 0a20 2020 2020 2020 2020  s = "".         
+00010a30: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
+00010a40: 7566 6669 783a 0a20 2020 2020 2020 2020  uffix:.         
+00010a50: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00010a60: 7320 3d20 225f 2220 2b20 7365 6c66 2e73  s = "_" + self.s
+00010a70: 7566 6669 780a 2020 2020 2020 2020 2020  uffix.          
+00010a80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010aa0: 666f 7220 6c61 6265 6c20 696e 2073 656c  for label in sel
+00010ab0: 662e 6c61 6265 6c73 3a0a 2020 2020 2020  f.labels:.      
+00010ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ad0: 2020 6c61 6265 6c73 202b 3d20 225f 2220    labels += "_" 
+00010ae0: 2b20 7374 7228 6c61 6265 6c29 0a20 2020  + str(label).   
+00010af0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00010b00: 662e 6f75 7470 7574 735b 2273 6967 6e61  f.outputs["signa
+00010b10: 6c73 225d 203d 206f 732e 7061 7468 2e6a  ls"] = os.path.j
+00010b20: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
+00010b30: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
+00010b40: 7470 7574 5f64 6972 6563 746f 7279 2c0a  tput_directory,.
+00010b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b60: 2020 2020 6669 6c65 5f6e 616d 6520 2b20      file_name + 
+00010b70: 225f 6578 7472 6163 7465 645f 7369 676e  "_extracted_sign
+00010b80: 616c 7322 202b 206c 6162 656c 7320 2b20  als" + labels + 
+00010b90: 222e 6373 7622 2c0a 2020 2020 2020 2020  ".csv",.        
+00010ba0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00010bb0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00010bc0: 6c66 2e6f 7574 7075 7473 3a0a 2020 2020  lf.outputs:.    
+00010bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010be0: 7365 6c66 2e74 6167 735f 696e 6865 7269  self.tags_inheri
+00010bf0: 7461 6e63 6528 0a20 2020 2020 2020 2020  tance(.         
+00010c00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010c10: 6e5f 6669 6c65 3d73 656c 662e 696e 5f66  n_file=self.in_f
+00010c20: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
+00010c30: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00010c40: 5f66 696c 653d 7365 6c66 2e6f 7574 7075  _file=self.outpu
+00010c50: 7473 5b22 7369 676e 616c 7322 5d2c 0a20  ts["signals"],. 
+00010c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c70: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00010c80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00010c90: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00010ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cb0: 2020 2245 7874 7261 6374 524f 4962 794c    "ExtractROIbyL
+00010cc0: 6162 656c 2062 7269 636b 3a20 220a 2020  abel brick: ".  
+00010cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ce0: 2020 224e 6f20 6f75 7470 7574 5f64 6972    "No output_dir
+00010cf0: 6563 746f 7279 2077 6173 2066 6f75 6e64  ectory was found
+00010d00: 2e2e 2e21 5c6e 220a 2020 2020 2020 2020  ...!\n".        
+00010d10: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00010d20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010d30: 0a0a 2020 2020 2020 2020 2320 5265 7475  ..        # Retu
+00010d40: 726e 2074 6865 2072 6571 7569 7265 6d65  rn the requireme
+00010d50: 6e74 2c20 6f75 7470 7574 7320 616e 6420  nt, outputs and 
+00010d60: 696e 6865 7269 7461 6e63 655f 6469 6374  inheritance_dict
+00010d70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00010d80: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
+00010d90: 7375 6c74 2829 0a0a 2020 2020 6465 6620  sult()..    def 
+00010da0: 7275 6e5f 7072 6f63 6573 735f 6d69 6128  run_process_mia(
+00010db0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00010dc0: 2222 4465 6469 6361 7465 6420 746f 2074  ""Dedicated to t
+00010dd0: 6865 2070 726f 6365 7373 206c 6175 6e63  he process launc
+00010de0: 6820 7374 6570 206f 6620 7468 6520 6272  h step of the br
+00010df0: 6963 6b2e 2222 220a 2020 2020 2020 2020  ick.""".        
+00010e00: 7375 7065 7228 4578 7472 6163 7453 6967  super(ExtractSig
+00010e10: 6e61 6c52 4f49 2c20 7365 6c66 292e 7275  nalROI, self).ru
+00010e20: 6e5f 7072 6f63 6573 735f 6d69 6128 290a  n_process_mia().
+00010e30: 0a20 2020 2020 2020 206d 6173 6b65 7220  .        masker 
+00010e40: 3d20 4e69 6674 694c 6162 656c 734d 6173  = NiftiLabelsMas
+00010e50: 6b65 7228 0a20 2020 2020 2020 2020 2020  ker(.           
+00010e60: 206c 6162 656c 735f 696d 673d 7365 6c66   labels_img=self
+00010e70: 2e69 6e5f 7365 672c 206c 6162 656c 733d  .in_seg, labels=
+00010e80: 7365 6c66 2e6c 6162 656c 732c 2073 7461  self.labels, sta
+00010e90: 6e64 6172 6469 7a65 3d46 616c 7365 0a20  ndardize=False. 
+00010ea0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00010eb0: 206d 6173 6b65 722e 6669 7428 290a 2020   masker.fit().  
+00010ec0: 2020 2020 2020 7369 676e 616c 7320 3d20        signals = 
+00010ed0: 6d61 736b 6572 2e66 6974 5f74 7261 6e73  masker.fit_trans
+00010ee0: 666f 726d 2873 656c 662e 696e 5f66 696c  form(self.in_fil
+00010ef0: 6529 0a0a 2020 2020 2020 2020 2320 5265  e)..        # Re
+00010f00: 6f72 6761 6e69 7365 2073 6967 6e61 6c73  organise signals
+00010f10: 2061 7272 6179 0a20 2020 2020 2020 2073   array.        s
+00010f20: 6967 6e61 6c73 203d 2073 6967 6e61 6c73  ignals = signals
+00010f30: 2e54 0a20 2020 2020 2020 2064 6620 3d20  .T.        df = 
+00010f40: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
+00010f50: 613d 7369 676e 616c 732c 2069 6e64 6578  a=signals, index
+00010f60: 3d73 656c 662e 6c61 6265 6c73 290a 2020  =self.labels).  
+00010f70: 2020 2020 2020 6466 2e74 6f5f 6373 7628        df.to_csv(
+00010f80: 7365 6c66 2e73 6967 6e61 6c73 290a 0a0a  self.signals)...
+00010f90: 636c 6173 7320 4772 6164 6965 6e74 5468  class GradientTh
+00010fa0: 7265 7368 6f6c 6428 5072 6f63 6573 734d  reshold(ProcessM
+00010fb0: 4941 293a 0a20 2020 2022 2222 0a20 2020  IA):.    """.   
+00010fc0: 202a 436f 6d70 7574 6573 2061 2074 6872   *Computes a thr
+00010fd0: 6573 686f 6c64 2066 726f 6d20 7468 6520  eshold from the 
+00010fe0: 6869 7374 6f67 7261 6d20 6f66 2074 6865  histogram of the
+00010ff0: 206d 6167 6e69 7475 6465 2067 7261 6469   magnitude gradi
+00011000: 656e 7420 696d 6167 652a 0a0a 2020 2020  ent image*..    
+00011010: 506c 6561 7365 2c20 7365 6520 7468 6520  Please, see the 
+00011020: 636f 6d70 6c65 7465 2064 6f63 756d 656e  complete documen
+00011030: 7461 7469 6f6e 2066 6f72 2074 6865 2060  tation for the `
+00011040: 4772 6164 6965 6e74 5468 7265 7368 6f6c  GradientThreshol
+00011050: 6420 6272 6963 6b0a 2020 2020 696e 2074  d brick.    in t
+00011060: 6865 206d 6961 5f70 726f 6365 7373 6573  he mia_processes
+00011070: 2077 6562 7369 7465 0a20 2020 203c 6874   website.    <ht
+00011080: 7470 733a 2f2f 706f 7075 6c73 652e 6769  tps://populse.gi
+00011090: 7468 7562 2e69 6f2f 6d69 615f 7072 6f63  thub.io/mia_proc
+000110a0: 6573 7365 732f 6874 6d6c 2f64 6f63 756d  esses/html/docum
+000110b0: 656e 7461 7469 6f6e 2f62 7269 636b 732f  entation/bricks/
+000110c0: 7072 6570 726f 6365 7373 2f6f 7468 6572  preprocess/other
+000110d0: 2f47 7261 6469 656e 7454 6872 6573 686f  /GradientThresho
+000110e0: 6c64 2e68 746d 6c3e 605f 0a0a 2020 2020  ld.html>`_..    
+000110f0: 6164 6170 7465 6420 6672 6f6d 3a0a 2020  adapted from:.  
+00011100: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
+00011110: 2e63 6f6d 2f6e 6970 7265 7073 2f6d 7269  .com/nipreps/mri
+00011120: 7163 2f62 6c6f 622f 6530 3231 3030 3864  qc/blob/e021008d
+00011130: 6130 6132 6566 3163 3438 6538 3832 6261  a0a2ef1c48e882ba
+00011140: 6639 3332 3133 3961 3637 3333 3439 6639  f932139a673349f9
+00011150: 2f6d 7269 7163 2f77 6f72 6b66 6c6f 7773  /mriqc/workflows
+00011160: 2f61 6e61 746f 6d69 6361 6c2e 7079 234c  /anatomical.py#L
+00011170: 3130 3339 0a0a 2020 2020 2222 220a 0a20  1039..    """.. 
+00011180: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00011190: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+000111a0: 2222 4465 6469 6361 7465 6420 746f 2074  ""Dedicated to t
+000111b0: 6865 2061 7474 7269 6275 7465 7320 696e  he attributes in
+000111c0: 6974 6961 6c69 7361 7469 6f6e 202f 2069  itialisation / i
+000111d0: 6e73 7461 6e74 6961 7469 6f6e 2e0a 0a20  nstantiation... 
+000111e0: 2020 2020 2020 2054 6865 2069 6e70 7574         The input
+000111f0: 2061 6e64 206f 7574 7075 7420 706c 7567   and output plug
+00011200: 7320 6172 6520 6465 6669 6e65 6420 6865  s are defined he
+00011210: 7265 2e20 5468 6520 7370 6563 6961 6c0a  re. The special.
+00011220: 2020 2020 2020 2020 2773 656c 662e 7265          'self.re
+00011230: 7175 6972 656d 656e 7427 2061 7474 7269  quirement' attri
+00011240: 6275 7465 2028 6f70 7469 6f6e 616c 2920  bute (optional) 
+00011250: 6973 2075 7365 6420 746f 2064 6566 696e  is used to defin
+00011260: 6520 7468 650a 2020 2020 2020 2020 7468  e the.        th
+00011270: 6972 642d 7061 7274 7920 7072 6f64 7563  ird-party produc
+00011280: 7473 206e 6563 6573 7361 7279 2066 6f72  ts necessary for
+00011290: 2074 6865 2072 756e 6e69 6e67 206f 6620   the running of 
+000112a0: 7468 6520 6272 6963 6b2e 0a20 2020 2020  the brick..     
+000112b0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+000112c0: 2049 6e69 7469 616c 6973 6174 696f 6e20   Initialisation 
+000112d0: 6f66 2074 6865 206f 626a 6563 7473 206e  of the objects n
+000112e0: 6565 6465 6420 666f 7220 7468 6520 6c61  eeded for the la
+000112f0: 756e 6368 206f 6620 7468 6520 6272 6963  unch of the bric
+00011300: 6b0a 2020 2020 2020 2020 7375 7065 7228  k.        super(
+00011310: 4772 6164 6965 6e74 5468 7265 7368 6f6c  GradientThreshol
+00011320: 642c 2073 656c 6629 2e5f 5f69 6e69 745f  d, self).__init_
+00011330: 5f28 290a 0a20 2020 2020 2020 2023 2054  _()..        # T
+00011340: 6869 7264 2070 6172 7479 2073 6f66 7477  hird party softw
+00011350: 6172 6573 2072 6571 7569 7265 6420 666f  ares required fo
+00011360: 7220 7468 6520 6578 6563 7574 696f 6e20  r the execution 
+00011370: 6f66 2074 6865 2062 7269 636b 0a20 2020  of the brick.   
+00011380: 2020 2020 2073 656c 662e 7265 7175 6972       self.requir
+00011390: 656d 656e 7420 3d20 5b5d 0a0a 2020 2020  ement = []..    
+000113a0: 2020 2020 2320 496e 7075 7473 2064 6573      # Inputs des
+000113b0: 6372 6970 7469 6f6e 0a20 2020 2020 2020  cription.       
+000113c0: 2069 6e5f 6669 6c65 5f64 6573 6320 3d20   in_file_desc = 
+000113d0: 2241 6e20 6578 6973 7469 6e67 2070 6174  "An existing pat
+000113e0: 6820 6669 6c65 2e22 0a20 2020 2020 2020  h file.".       
+000113f0: 2073 6567 5f66 696c 655f 6465 7363 203d   seg_file_desc =
+00011400: 2022 416e 2065 7869 7374 696e 6720 7061   "An existing pa
+00011410: 7468 206f 6620 7365 676d 656e 7461 7469  th of segmentati
+00011420: 6f6e 2066 696c 652e 220a 2020 2020 2020  on file.".      
+00011430: 2020 7072 6566 6978 5f64 6573 6320 3d20    prefix_desc = 
+00011440: 2250 7265 6669 7820 6f66 2074 6865 206f  "Prefix of the o
+00011450: 7574 7075 7420 696d 6167 6520 2861 2073  utput image (a s
+00011460: 7472 696e 6729 2e22 0a20 2020 2020 2020  tring).".       
+00011470: 2073 7566 6669 785f 6465 7363 203d 2022   suffix_desc = "
+00011480: 5375 6666 6978 206f 6620 7468 6520 6f75  Suffix of the ou
+00011490: 7470 7574 2069 6d61 6765 2028 6120 7374  tput image (a st
+000114a0: 7269 6e67 292e 220a 0a20 2020 2020 2020  ring)."..       
+000114b0: 2023 204f 7574 7075 7473 2064 6573 6372   # Outputs descr
+000114c0: 6970 7469 6f6e 0a20 2020 2020 2020 206f  iption.        o
+000114d0: 7574 5f66 696c 655f 6465 7363 203d 2028  ut_file_desc = (
+000114e0: 0a20 2020 2020 2020 2020 2020 2022 5061  .            "Pa
+000114f0: 7468 206f 6620 7468 6520 7468 7265 7368  th of the thresh
+00011500: 6f6c 6465 6420 7363 616e 2022 0a20 2020  olded scan ".   
+00011510: 2020 2020 2020 2020 2022 2861 2070 6174           "(a pat
+00011520: 686c 696b 6520 6f62 6a65 6374 206f 7220  hlike object or 
+00011530: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
+00011540: 696e 6720 6120 6669 6c65 292e 220a 2020  ing a file).".  
+00011550: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00011560: 2023 2049 6e70 7574 7320 7472 6169 7473   # Inputs traits
+00011570: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00011580: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00011590: 2020 2020 2022 696e 5f66 696c 6522 2c20       "in_file", 
+000115a0: 4669 6c65 286f 7574 7075 743d 4661 6c73  File(output=Fals
+000115b0: 652c 206f 7074 696f 6e61 6c3d 4661 6c73  e, optional=Fals
+000115c0: 652c 2064 6573 633d 696e 5f66 696c 655f  e, desc=in_file_
+000115d0: 6465 7363 290a 2020 2020 2020 2020 290a  desc).        ).
+000115e0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+000115f0: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00011600: 2020 2020 2022 7365 675f 6669 6c65 222c       "seg_file",
+00011610: 2046 696c 6528 6f75 7470 7574 3d46 616c   File(output=Fal
+00011620: 7365 2c20 6f70 7469 6f6e 616c 3d46 616c  se, optional=Fal
+00011630: 7365 2c20 6465 7363 3d73 6567 5f66 696c  se, desc=seg_fil
+00011640: 655f 6465 7363 290a 2020 2020 2020 2020  e_desc).        
+00011650: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00011660: 6164 645f 7472 6169 7428 0a20 2020 2020  add_trait(.     
+00011670: 2020 2020 2020 2022 7072 6566 6978 222c         "prefix",
+00011680: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00011690: 6974 732e 5374 7269 6e67 2822 222c 206f  its.String("", o
+000116a0: 7574 7075 743d 4661 6c73 652c 206f 7074  utput=False, opt
+000116b0: 696f 6e61 6c3d 5472 7565 2c20 6465 7363  ional=True, desc
+000116c0: 3d70 7265 6669 785f 6465 7363 292c 0a20  =prefix_desc),. 
+000116d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000116e0: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+000116f0: 0a20 2020 2020 2020 2020 2020 2022 7375  .            "su
+00011700: 6666 6978 222c 0a20 2020 2020 2020 2020  ffix",.         
+00011710: 2020 2074 7261 6974 732e 5374 7269 6e67     traits.String
+00011720: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00011730: 2020 225f 6772 6164 222c 206f 7574 7075    "_grad", outpu
+00011740: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
+00011750: 6c3d 5472 7565 2c20 6465 7363 3d73 7566  l=True, desc=suf
+00011760: 6669 785f 6465 7363 0a20 2020 2020 2020  fix_desc.       
+00011770: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00011780: 290a 0a20 2020 2020 2020 2023 204f 7574  )..        # Out
+00011790: 7075 7473 2074 7261 6974 730a 2020 2020  puts traits.    
+000117a0: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
+000117b0: 6974 2822 6f75 745f 6669 6c65 222c 2046  it("out_file", F
+000117c0: 696c 6528 6f75 7470 7574 3d54 7275 652c  ile(output=True,
+000117d0: 2064 6573 633d 6f75 745f 6669 6c65 5f64   desc=out_file_d
+000117e0: 6573 6329 290a 0a20 2020 2020 2020 2073  esc))..        s
+000117f0: 656c 662e 696e 6974 5f64 6566 6175 6c74  elf.init_default
+00011800: 5f74 7261 6974 7328 290a 0a20 2020 2064  _traits()..    d
+00011810: 6566 206c 6973 745f 6f75 7470 7574 7328  ef list_outputs(
+00011820: 7365 6c66 2c20 6973 5f70 6c75 6767 6564  self, is_plugged
+00011830: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00011840: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
+00011850: 7468 6520 696e 6974 6961 6c69 7361 7469  the initialisati
+00011860: 6f6e 2073 7465 7020 6f66 2074 6865 2062  on step of the b
+00011870: 7269 636b 2e0a 0a20 2020 2020 2020 2054  rick...        T
+00011880: 6865 206d 6169 6e20 6f62 6a65 6374 6976  he main objectiv
+00011890: 6520 6f66 2074 6869 7320 6d65 7468 6f64  e of this method
+000118a0: 2069 7320 746f 2070 726f 6475 6365 2074   is to produce t
+000118b0: 6865 206f 7574 7075 7473 206f 6620 7468  he outputs of th
+000118c0: 650a 2020 2020 2020 2020 6272 6963 6b73  e.        bricks
+000118d0: 2028 7365 6c66 2e6f 7574 7075 7473 2920   (self.outputs) 
+000118e0: 616e 6420 7468 6520 6173 736f 6369 6174  and the associat
+000118f0: 6564 2074 6167 7320 2873 656c 662e 696e  ed tags (self.in
+00011900: 6865 7269 7461 6e63 655f 6469 6329 2c0a  heritance_dic),.
+00011910: 2020 2020 2020 2020 6966 2064 6566 696e          if defin
+00011920: 6564 2068 6572 652e 2054 6f20 776f 726b  ed here. To work
+00011930: 2070 726f 7065 726c 7920 7468 6973 206d   properly this m
+00011940: 6574 686f 6420 6d75 7374 2072 6574 7572  ethod must retur
+00011950: 6e0a 2020 2020 2020 2020 7365 6c66 2e6d  n.        self.m
+00011960: 616b 655f 696e 6974 5265 7375 6c74 2829  ake_initResult()
+00011970: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
+00011980: 2020 3a70 6172 616d 2069 735f 706c 7567    :param is_plug
+00011990: 6765 643a 2074 6865 2073 7461 7465 2c20  ged: the state, 
+000119a0: 6c69 6e6b 6564 206f 7220 6e6f 742c 206f  linked or not, o
+000119b0: 6620 7468 6520 706c 7567 732e 0a20 2020  f the plugs..   
+000119c0: 2020 2020 203a 7265 7475 726e 733a 2061       :returns: a
+000119d0: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
+000119e0: 2072 6571 7569 7265 6d65 6e74 2c20 6f75   requirement, ou
+000119f0: 7470 7574 7320 616e 6420 696e 6865 7269  tputs and inheri
+00011a00: 7461 6e63 655f 6469 6374 2e0a 2020 2020  tance_dict..    
+00011a10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00011a20: 2320 5573 696e 6720 7468 6520 696e 6865  # Using the inhe
+00011a30: 7269 7461 6e63 6520 746f 2050 726f 6365  ritance to Proce
+00011a40: 7373 4d49 4120 636c 6173 732c 206c 6973  ssMIA class, lis
+00011a50: 745f 6f75 7470 7574 7320 6d65 7468 6f64  t_outputs method
+00011a60: 0a20 2020 2020 2020 2073 7570 6572 2847  .        super(G
+00011a70: 7261 6469 656e 7454 6872 6573 686f 6c64  radientThreshold
+00011a80: 2c20 7365 6c66 292e 6c69 7374 5f6f 7574  , self).list_out
+00011a90: 7075 7473 2829 0a0a 2020 2020 2020 2020  puts()..        
+00011aa0: 2320 4f75 7470 7574 7320 6465 6669 6e69  # Outputs defini
+00011ab0: 7469 6f6e 0a20 2020 2020 2020 2069 6620  tion.        if 
+00011ac0: 7365 6c66 2e69 6e5f 6669 6c65 3a0a 2020  self.in_file:.  
+00011ad0: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+00011ae0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00011af0: 6e6f 7420 7365 6c66 2e73 7566 6669 7829  not self.suffix)
+00011b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011b10: 206f 7220 2873 656c 662e 7375 6666 6978   or (self.suffix
+00011b20: 2e69 7373 7061 6365 2829 290a 2020 2020  .isspace()).    
+00011b30: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
+00011b40: 656c 662e 7375 6666 6978 2069 6e20 5b55  elf.suffix in [U
+00011b50: 6e64 6566 696e 6564 2c20 223c 756e 6465  ndefined, "<unde
+00011b60: 6669 6e65 643e 225d 0a20 2020 2020 2020  fined>"].       
+00011b70: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00011b80: 2020 2020 2020 2020 7365 6c66 2e73 7566          self.suf
+00011b90: 6669 7820 3d20 2220 220a 0a20 2020 2020  fix = " "..     
+00011ba0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00011bb0: 2020 2020 2020 2020 2020 2020 286e 6f74              (not
+00011bc0: 2073 656c 662e 7072 6566 6978 290a 2020   self.prefix).  
+00011bd0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00011be0: 2028 7365 6c66 2e70 7265 6669 782e 6973   (self.prefix.is
+00011bf0: 7370 6163 6528 2929 0a20 2020 2020 2020  space()).       
+00011c00: 2020 2020 2020 2020 206f 7220 2873 656c           or (sel
+00011c10: 662e 7072 6566 6978 2069 6e20 5b55 6e64  f.prefix in [Und
+00011c20: 6566 696e 6564 2c20 223c 756e 6465 6669  efined, "<undefi
+00011c30: 6e65 643e 225d 290a 2020 2020 2020 2020  ned>"]).        
+00011c40: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00011c50: 2020 2020 2020 2073 656c 662e 7072 6566         self.pref
+00011c60: 6978 203d 2022 2022 0a0a 2020 2020 2020  ix = " "..      
+00011c70: 2020 2020 2020 7661 6c69 645f 6578 742c        valid_ext,
+00011c80: 2069 6e5f 6578 742c 2066 696c 654e 616d   in_ext, fileNam
+00011c90: 6520 3d20 6368 6563 6b46 696c 6545 7874  e = checkFileExt
+00011ca0: 2873 656c 662e 696e 5f66 696c 652c 2045  (self.in_file, E
+00011cb0: 5854 290a 0a20 2020 2020 2020 2020 2020  XT)..           
+00011cc0: 2069 6620 6e6f 7420 7661 6c69 645f 6578   if not valid_ex
+00011cd0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00011ce0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+00011cf0: 2020 2020 2020 2020 2020 2020 2020 225c                "\
+00011d00: 6e47 7261 6469 656e 7454 6872 6573 686f  nGradientThresho
+00011d10: 6c64 2062 7269 636b 3a20 5468 6520 696e  ld brick: The in
+00011d20: 7075 7420 696d 6167 6520 666f 726d 6174  put image format
+00011d30: 2069 7320 220a 2020 2020 2020 2020 2020   is ".          
+00011d40: 2020 2020 2020 2020 2020 226e 6f74 2072            "not r
+00011d50: 6563 6f67 6e69 7a65 642e 2e2e 2122 0a20  ecognized...!". 
+00011d60: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00011d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011d80: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+00011d90: 2020 2020 2070 6174 682c 205f 203d 206f       path, _ = o
+00011da0: 732e 7061 7468 2e73 706c 6974 2873 656c  s.path.split(sel
+00011db0: 662e 696e 5f66 696c 6529 0a0a 2020 2020  f.in_file)..    
+00011dc0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00011dd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00011de0: 662e 7375 6666 6978 203d 3d20 2220 220a  f.suffix == " ".
+00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e00: 616e 6420 7365 6c66 2e70 7265 6669 7820  and self.prefix 
+00011e10: 3d3d 2022 2022 0a20 2020 2020 2020 2020  == " ".         
+00011e20: 2020 2020 2020 2061 6e64 2070 6174 6820         and path 
+00011e30: 3d3d 2073 656c 662e 6f75 7470 7574 5f64  == self.output_d
+00011e40: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
+00011e50: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00011e60: 2020 2020 2020 2020 6d73 6720 3d20 514d          msg = QM
+00011e70: 6573 7361 6765 426f 7828 290a 2020 2020  essageBox().    
+00011e80: 2020 2020 2020 2020 2020 2020 6d73 672e              msg.
+00011e90: 7365 7449 636f 6e28 514d 6573 7361 6765  setIcon(QMessage
+00011ea0: 426f 782e 5761 726e 696e 6729 0a20 2020  Box.Warning).   
+00011eb0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+00011ec0: 2e73 6574 5769 6e64 6f77 5469 746c 6528  .setWindowTitle(
+00011ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ee0: 2020 2020 2022 6d69 615f 7072 6f63 6573       "mia_proces
+00011ef0: 7365 7320 2d20 4772 6164 6965 6e74 5468  ses - GradientTh
+00011f00: 7265 7368 6f6c 6420 6272 6963 6b20 5761  reshold brick Wa
+00011f10: 726e 696e 6721 220a 2020 2020 2020 2020  rning!".        
+00011f20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00011f30: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
+00011f40: 7454 6578 7428 0a20 2020 2020 2020 2020  tText(.         
+00011f50: 2020 2020 2020 2020 2020 2022 5375 6666             "Suff
+00011f60: 6978 2061 6e64 2070 7265 6669 7820 696e  ix and prefix in
+00011f70: 7075 7420 7061 7261 6d65 7465 7273 2061  put parameters a
+00011f80: 7265 206e 6f74 2022 0a20 2020 2020 2020  re not ".       
+00011f90: 2020 2020 2020 2020 2020 2020 2022 6465               "de
+00011fa0: 6669 6e65 6420 6f72 2063 6f6e 7369 7374  fined or consist
+00011fb0: 206f 6e6c 7920 6f66 206f 6e65 206f 7220   only of one or 
+00011fc0: 6d6f 7265 2077 6869 7465 2022 0a20 2020  more white ".   
+00011fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fe0: 2022 7370 6163 6573 2e5c 6e54 6865 207b   "spaces.\nThe {
+00011ff0: 307d 2069 6e70 7574 2070 6172 616d 6574  0} input paramet
+00012000: 6572 2077 696c 6c20 6265 2022 0a20 2020  er will be ".   
+00012010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012020: 2022 6f76 6572 7772 6974 7465 6e20 2e2e   "overwritten ..
+00012030: 2e5c 6e20 5965 7320 6f72 2022 0a20 2020  .\n Yes or ".   
+00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012050: 2022 4162 6f72 743f 222e 666f 726d 6174   "Abort?".format
+00012060: 2866 696c 654e 616d 6529 0a20 2020 2020  (fileName).     
+00012070: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00012080: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+00012090: 2e73 6574 5374 616e 6461 7264 4275 7474  .setStandardButt
+000120a0: 6f6e 7328 514d 6573 7361 6765 426f 782e  ons(QMessageBox.
+000120b0: 5965 7320 7c20 514d 6573 7361 6765 426f  Yes | QMessageBo
+000120c0: 782e 4162 6f72 7429 0a20 2020 2020 2020  x.Abort).       
+000120d0: 2020 2020 2020 2020 2072 6574 7661 6c20           retval 
+000120e0: 3d20 6d73 672e 6578 6563 5f28 290a 0a20  = msg.exec_().. 
+000120f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012100: 6620 7265 7476 616c 2021 3d20 514d 6573  f retval != QMes
+00012110: 7361 6765 426f 782e 4162 6f72 743a 0a20  sageBox.Abort:. 
+00012120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012130: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
 00012140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012150: 202b 2066 696c 655f 6578 7465 6e73 696f   + file_extensio
-00012160: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00012170: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
-00012180: 2029 0a20 2020 2020 2020 2020 2020 206e   ).            n
-00012190: 6962 2e73 6176 6528 6f75 745f 696d 672c  ib.save(out_img,
-000121a0: 2066 696c 655f 6f75 7429 0a0a 0a63 6c61   file_out)...cla
-000121b0: 7373 2049 6e74 656e 7369 7479 436c 6970  ss IntensityClip
-000121c0: 2850 726f 6365 7373 4d49 4129 3a0a 2020  (ProcessMIA):.  
-000121d0: 2020 2222 220a 2020 2020 2a43 6c69 7020    """.    *Clip 
-000121e0: 7468 6520 696e 7465 6e73 6974 7920 7261  the intensity ra
-000121f0: 6e67 6520 6173 2070 7265 7363 7269 6265  nge as prescribe
-00012200: 6420 6279 2074 6865 2070 6572 6365 6e74  d by the percent
-00012210: 696c 6573 2a0a 0a20 2020 2050 6c65 6173  iles*..    Pleas
-00012220: 652c 2073 6565 2074 6865 2063 6f6d 706c  e, see the compl
-00012230: 6574 6520 646f 6375 6d65 6e74 6174 696f  ete documentatio
-00012240: 6e20 666f 7220 7468 6520 6049 6e74 656e  n for the `Inten
-00012250: 7369 7479 436c 6970 2062 7269 636b 2069  sityClip brick i
-00012260: 6e0a 2020 2020 7468 6520 6d69 615f 7072  n.    the mia_pr
-00012270: 6f63 6573 7365 7320 7765 6273 6974 650a  ocesses website.
-00012280: 2020 2020 3c68 7474 7073 3a2f 2f70 6f70      <https://pop
-00012290: 756c 7365 2e67 6974 6875 622e 696f 2f6d  ulse.github.io/m
-000122a0: 6961 5f70 726f 6365 7373 6573 2f68 746d  ia_processes/htm
-000122b0: 6c2f 646f 6375 6d65 6e74 6174 696f 6e2f  l/documentation/
-000122c0: 6272 6963 6b73 2f70 7265 7072 6f63 6573  bricks/preproces
-000122d0: 732f 6f74 6865 722f 496e 7465 6e73 6974  s/other/Intensit
-000122e0: 7943 6c69 702e 6874 6d6c 3e60 5f0a 0a20  yClip.html>`_.. 
-000122f0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-00012300: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0a  __init__(self):.
-00012310: 2020 2020 2020 2020 2222 2244 6564 6963          """Dedic
-00012320: 6174 6564 2074 6f20 7468 6520 6174 7472  ated to the attr
-00012330: 6962 7574 6573 2069 6e69 7469 616c 6973  ibutes initialis
-00012340: 6174 696f 6e20 2f20 696e 7374 616e 7469  ation / instanti
-00012350: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00012360: 5468 6520 696e 7075 7420 616e 6420 6f75  The input and ou
-00012370: 7470 7574 2070 6c75 6773 2061 7265 2064  tput plugs are d
-00012380: 6566 696e 6564 2068 6572 652e 2054 6865  efined here. The
-00012390: 2073 7065 6369 616c 0a20 2020 2020 2020   special.       
-000123a0: 2027 7365 6c66 2e72 6571 7569 7265 6d65   'self.requireme
-000123b0: 6e74 2720 6174 7472 6962 7574 6520 286f  nt' attribute (o
-000123c0: 7074 696f 6e61 6c29 2069 7320 7573 6564  ptional) is used
-000123d0: 2074 6f20 6465 6669 6e65 2074 6865 0a20   to define the. 
-000123e0: 2020 2020 2020 2074 6869 7264 2d70 6172         third-par
-000123f0: 7479 2070 726f 6475 6374 7320 6e65 6365  ty products nece
-00012400: 7373 6172 7920 666f 7220 7468 6520 7275  ssary for the ru
-00012410: 6e6e 696e 6720 6f66 2074 6865 2062 7269  nning of the bri
-00012420: 636b 2e0a 2020 2020 2020 2020 2222 220a  ck..        """.
-00012430: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
-00012440: 6c69 7361 7469 6f6e 206f 6620 7468 6520  lisation of the 
-00012450: 6f62 6a65 6374 7320 6e65 6564 6564 2066  objects needed f
-00012460: 6f72 2074 6865 206c 6175 6e63 6820 6f66  or the launch of
-00012470: 2074 6865 2062 7269 636b 0a20 2020 2020   the brick.     
-00012480: 2020 2073 7570 6572 2849 6e74 656e 7369     super(Intensi
-00012490: 7479 436c 6970 2c20 7365 6c66 292e 5f5f  tyClip, self).__
-000124a0: 696e 6974 5f5f 2829 0a0a 2020 2020 2020  init__()..      
-000124b0: 2020 2320 5468 6972 6420 7061 7274 7920    # Third party 
-000124c0: 736f 6674 7761 7265 7320 7265 7175 6972  softwares requir
-000124d0: 6564 2066 6f72 2074 6865 2065 7865 6375  ed for the execu
-000124e0: 7469 6f6e 206f 6620 7468 6520 6272 6963  tion of the bric
-000124f0: 6b0a 2020 2020 2020 2020 7365 6c66 2e72  k.        self.r
-00012500: 6571 7569 7265 6d65 6e74 203d 205b 5d0a  equirement = [].
-00012510: 0a20 2020 2020 2020 2023 2049 6e70 7574  .        # Input
-00012520: 7320 6465 7363 7269 7074 696f 6e0a 2020  s description.  
-00012530: 2020 2020 2020 696e 5f66 696c 655f 6465        in_file_de
-00012540: 7363 203d 2022 3344 2066 696c 6520 7768  sc = "3D file wh
-00012550: 6963 6820 696e 7465 6e73 6974 7920 7769  ich intensity wi
-00012560: 6c6c 2062 6520 636c 6970 7065 6422 0a20  ll be clipped". 
-00012570: 2020 2020 2020 2070 5f6d 696e 5f64 6573         p_min_des
-00012580: 6320 3d20 2250 6572 6365 6e74 696c 6520  c = "Percentile 
-00012590: 666f 7220 7468 6520 6c6f 7765 7220 626f  for the lower bo
-000125a0: 756e 6422 0a20 2020 2020 2020 2070 5f6d  und".        p_m
-000125b0: 6178 5f64 6573 6320 3d20 2250 6572 6365  ax_desc = "Perce
-000125c0: 6e74 696c 6520 666f 7220 7468 6520 7570  ntile for the up
-000125d0: 7065 7220 626f 756e 6422 0a20 2020 2020  per bound".     
-000125e0: 2020 2064 7479 7065 5f64 6573 6320 3d20     dtype_desc = 
-000125f0: 224f 7574 7075 7420 6461 7461 7479 7065  "Output datatype
-00012600: 220a 2020 2020 2020 2020 6e6f 6e6e 6567  ".        nonneg
-00012610: 6174 6976 655f 6465 7363 203d 2022 5768  ative_desc = "Wh
-00012620: 6574 6865 7220 696e 7075 7420 696e 7465  ether input inte
-00012630: 6e73 6974 6965 7320 6d75 7374 2062 6520  nsities must be 
-00012640: 706f 7369 7469 7665 220a 2020 2020 2020  positive".      
-00012650: 2020 696e 7665 7274 5f64 6573 6320 3d20    invert_desc = 
-00012660: 2246 696e 616c 697a 6520 6279 2069 6e76  "Finalize by inv
-00012670: 6572 7469 6e67 2063 6f6e 7472 6173 7422  erting contrast"
-00012680: 0a0a 2020 2020 2020 2020 2320 4f75 7470  ..        # Outp
-00012690: 7574 7320 6465 7363 7269 7074 696f 6e0a  uts description.
-000126a0: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
-000126b0: 5f64 6573 6320 3d20 2246 696c 6520 6166  _desc = "File af
-000126c0: 7465 7220 636c 6970 7069 6e67 220a 0a20  ter clipping".. 
-000126d0: 2020 2020 2020 2023 204d 616e 6461 746f         # Mandato
-000126e0: 7279 2069 6e70 7574 7320 7472 6169 7473  ry inputs traits
-000126f0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00012700: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
-00012710: 2020 2020 2022 696e 5f66 696c 6522 2c20       "in_file", 
-00012720: 4669 6c65 286f 7574 7075 743d 4661 6c73  File(output=Fals
-00012730: 652c 206f 7074 696f 6e61 6c3d 4661 6c73  e, optional=Fals
-00012740: 652c 2064 6573 633d 696e 5f66 696c 655f  e, desc=in_file_
-00012750: 6465 7363 290a 2020 2020 2020 2020 290a  desc).        ).
-00012760: 0a20 2020 2020 2020 2023 204f 7074 696f  .        # Optio
-00012770: 6e61 6c20 696e 7075 7473 2077 6974 6820  nal inputs with 
-00012780: 6465 6661 756c 7420 7661 6c75 6520 7472  default value tr
-00012790: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
-000127a0: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-000127b0: 2020 2020 2020 2020 2022 6474 7970 6522           "dtype"
-000127c0: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
-000127d0: 6169 7473 2e45 6e75 6d28 0a20 2020 2020  aits.Enum(.     
-000127e0: 2020 2020 2020 2020 2020 2022 696e 7431             "int1
-000127f0: 3622 2c0a 2020 2020 2020 2020 2020 2020  6",.            
-00012800: 2020 2020 2266 6c6f 6174 3332 222c 0a20      "float32",. 
-00012810: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00012820: 7569 6e74 3822 2c0a 2020 2020 2020 2020  uint8",.        
-00012830: 2020 2020 2020 2020 6f75 7470 7574 3d46          output=F
-00012840: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00012850: 2020 2020 2020 6f70 7469 6f6e 616c 3d54        optional=T
-00012860: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00012870: 2020 2020 2064 6573 633d 6474 7970 655f       desc=dtype_
-00012880: 6465 7363 2c0a 2020 2020 2020 2020 2020  desc,.          
-00012890: 2020 292c 0a20 2020 2020 2020 2029 0a0a    ),.        )..
-000128a0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-000128b0: 5f74 7261 6974 280a 2020 2020 2020 2020  _trait(.        
-000128c0: 2020 2020 2269 6e76 6572 7422 2c0a 2020      "invert",.  
-000128d0: 2020 2020 2020 2020 2020 7472 6169 7473            traits
-000128e0: 2e42 6f6f 6c28 0a20 2020 2020 2020 2020  .Bool(.         
-000128f0: 2020 2020 2020 2064 6566 6175 6c74 5f76         default_v
-00012900: 616c 7565 3d46 616c 7365 2c0a 2020 2020  alue=False,.    
-00012910: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-00012920: 7574 3d46 616c 7365 2c0a 2020 2020 2020  ut=False,.      
-00012930: 2020 2020 2020 2020 2020 6f70 7469 6f6e            option
-00012940: 616c 3d54 7275 652c 0a20 2020 2020 2020  al=True,.       
-00012950: 2020 2020 2020 2020 2064 6573 633d 696e           desc=in
-00012960: 7665 7274 5f64 6573 632c 0a20 2020 2020  vert_desc,.     
-00012970: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00012980: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00012990: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-000129a0: 2020 2020 2020 2020 2022 6e6f 6e6e 6567           "nonneg
-000129b0: 6174 6976 6522 2c0a 2020 2020 2020 2020  ative",.        
-000129c0: 2020 2020 7472 6169 7473 2e42 6f6f 6c28      traits.Bool(
-000129d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000129e0: 2064 6566 6175 6c74 5f76 616c 7565 3d54   default_value=T
-000129f0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00012a00: 2020 2020 206f 7574 7075 743d 4661 6c73       output=Fals
-00012a10: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00012a20: 2020 206f 7074 696f 6e61 6c3d 5472 7565     optional=True
-00012a30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012a40: 2020 6465 7363 3d6e 6f6e 6e65 6761 7469    desc=nonnegati
-00012a50: 7665 5f64 6573 632c 0a20 2020 2020 2020  ve_desc,.       
-00012a60: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-00012a70: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00012a80: 6164 645f 7472 6169 7428 0a20 2020 2020  add_trait(.     
-00012a90: 2020 2020 2020 2022 705f 6d61 7822 2c0a         "p_max",.
-00012aa0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
-00012ab0: 7473 2e46 6c6f 6174 280a 2020 2020 2020  ts.Float(.      
-00012ac0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00012ad0: 745f 7661 6c75 653d 3939 2e39 2c0a 2020  t_value=99.9,.  
-00012ae0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00012af0: 7470 7574 3d46 616c 7365 2c0a 2020 2020  tput=False,.    
-00012b00: 2020 2020 2020 2020 2020 2020 6f70 7469              opti
-00012b10: 6f6e 616c 3d54 7275 652c 0a20 2020 2020  onal=True,.     
-00012b20: 2020 2020 2020 2020 2020 2064 6573 633d             desc=
-00012b30: 705f 6d61 785f 6465 7363 2c0a 2020 2020  p_max_desc,.    
-00012b40: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00012b50: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-00012b60: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
-00012b70: 2020 2020 2020 2020 2020 2270 5f6d 696e            "p_min
-00012b80: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
-00012b90: 7261 6974 732e 466c 6f61 7428 0a20 2020  raits.Float(.   
-00012ba0: 2020 2020 2020 2020 2020 2020 2064 6566               def
-00012bb0: 6175 6c74 5f76 616c 7565 3d31 302e 302c  ault_value=10.0,
-00012bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012bd0: 206f 7574 7075 743d 4661 6c73 652c 0a20   output=False,. 
-00012be0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00012bf0: 7074 696f 6e61 6c3d 5472 7565 2c0a 2020  ptional=True,.  
-00012c00: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00012c10: 7363 3d70 5f6d 696e 5f64 6573 632c 0a20  sc=p_min_desc,. 
-00012c20: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00012c30: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00012c40: 2023 204f 7574 7075 7473 2074 7261 6974   # Outputs trait
-00012c50: 730a 2020 2020 2020 2020 7365 6c66 2e61  s.        self.a
-00012c60: 6464 5f74 7261 6974 2822 6f75 745f 6669  dd_trait("out_fi
-00012c70: 6c65 222c 2046 696c 6528 6f75 7470 7574  le", File(output
-00012c80: 3d54 7275 652c 2064 6573 633d 6f75 745f  =True, desc=out_
-00012c90: 6669 6c65 5f64 6573 6329 290a 0a20 2020  file_desc))..   
-00012ca0: 2020 2020 2073 656c 662e 696e 6974 5f64       self.init_d
-00012cb0: 6566 6175 6c74 5f74 7261 6974 7328 290a  efault_traits().
-00012cc0: 0a20 2020 2064 6566 206c 6973 745f 6f75  .    def list_ou
-00012cd0: 7470 7574 7328 7365 6c66 2c20 6973 5f70  tputs(self, is_p
-00012ce0: 6c75 6767 6564 3d4e 6f6e 6529 3a0a 2020  lugged=None):.  
-00012cf0: 2020 2020 2020 2222 2244 6564 6963 6174        """Dedicat
-00012d00: 6564 2074 6f20 7468 6520 696e 6974 6961  ed to the initia
-00012d10: 6c69 7361 7469 6f6e 2073 7465 7020 6f66  lisation step of
-00012d20: 2074 6865 2062 7269 636b 2e0a 0a20 2020   the brick...   
-00012d30: 2020 2020 2054 6865 206d 6169 6e20 6f62       The main ob
-00012d40: 6a65 6374 6976 6520 6f66 2074 6869 7320  jective of this 
-00012d50: 6d65 7468 6f64 2069 7320 746f 2070 726f  method is to pro
-00012d60: 6475 6365 2074 6865 206f 7574 7075 7473  duce the outputs
-00012d70: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00012d80: 6272 6963 6b73 2028 7365 6c66 2e6f 7574  bricks (self.out
-00012d90: 7075 7473 2920 616e 6420 7468 6520 6173  puts) and the as
-00012da0: 736f 6369 6174 6564 2074 6167 7320 2873  sociated tags (s
-00012db0: 656c 662e 696e 6865 7269 7461 6e63 655f  elf.inheritance_
-00012dc0: 6469 6329 2c0a 2020 2020 2020 2020 6966  dic),.        if
-00012dd0: 2064 6566 696e 6564 2068 6572 652e 2054   defined here. T
-00012de0: 6f20 776f 726b 2070 726f 7065 726c 7920  o work properly 
-00012df0: 7468 6973 206d 6574 686f 6420 6d75 7374  this method must
-00012e00: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-00012e10: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
-00012e20: 7375 6c74 2829 206f 626a 6563 742e 0a0a  sult() object...
-00012e30: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-00012e40: 735f 706c 7567 6765 643a 2074 6865 2073  s_plugged: the s
-00012e50: 7461 7465 2c20 6c69 6e6b 6564 206f 7220  tate, linked or 
-00012e60: 6e6f 742c 206f 6620 7468 6520 706c 7567  not, of the plug
-00012e70: 732e 0a20 2020 2020 2020 203a 7265 7475  s..        :retu
-00012e80: 726e 733a 2061 2064 6963 7469 6f6e 6172  rns: a dictionar
-00012e90: 7920 7769 7468 2072 6571 7569 7265 6d65  y with requireme
-00012ea0: 6e74 2c20 6f75 7470 7574 7320 616e 6420  nt, outputs and 
-00012eb0: 696e 6865 7269 7461 6e63 655f 6469 6374  inheritance_dict
-00012ec0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00012ed0: 2020 2020 2020 2320 5573 696e 6720 7468        # Using th
-00012ee0: 6520 696e 6865 7269 7461 6e63 6520 746f  e inheritance to
-00012ef0: 2050 726f 6365 7373 4d49 4120 636c 6173   ProcessMIA clas
-00012f00: 732c 206c 6973 745f 6f75 7470 7574 7320  s, list_outputs 
-00012f10: 6d65 7468 6f64 0a20 2020 2020 2020 2073  method.        s
-00012f20: 7570 6572 2849 6e74 656e 7369 7479 436c  uper(IntensityCl
-00012f30: 6970 2c20 7365 6c66 292e 6c69 7374 5f6f  ip, self).list_o
-00012f40: 7574 7075 7473 2829 0a0a 2020 2020 2020  utputs()..      
-00012f50: 2020 6966 2073 656c 662e 696e 5f66 696c    if self.in_fil
-00012f60: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00012f70: 6620 7365 6c66 2e6f 7574 7075 745f 6469  f self.output_di
-00012f80: 7265 6374 6f72 793a 0a20 2020 2020 2020  rectory:.       
-00012f90: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
-00012fa0: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
-00012fb0: 5d20 3d20 6f73 2e70 6174 682e 6a6f 696e  ] = os.path.join
-00012fc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00012fd0: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
-00012fe0: 745f 6469 7265 6374 6f72 792c 0a20 2020  t_directory,.   
-00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013000: 206f 732e 7061 7468 2e73 706c 6974 2873   os.path.split(s
-00013010: 656c 662e 696e 5f66 696c 6529 5b31 5d2e  elf.in_file)[1].
-00013020: 7265 706c 6163 6528 0a20 2020 2020 2020  replace(.       
-00013030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013040: 2022 2e6e 6969 222c 2022 5f63 6c69 7070   ".nii", "_clipp
-00013050: 6564 2e6e 6969 220a 2020 2020 2020 2020  ed.nii".        
-00013060: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-00013070: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00013080: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00013090: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000130a0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-000130b0: 2020 2020 2020 2020 2020 2020 2020 2249                "I
-000130c0: 6e74 656e 7369 7479 436c 6970 2062 7269  ntensityClip bri
-000130d0: 636b 3a20 4e6f 206f 7574 7075 745f 6469  ck: No output_di
-000130e0: 7265 6374 6f72 7920 7761 7320 220a 2020  rectory was ".  
-000130f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013100: 2020 2266 6f75 6e64 2e2e 2e21 5c6e 220a    "found...!\n".
-00013110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013120: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013130: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-00013140: 2020 6966 2073 656c 662e 6f75 7470 7574    if self.output
-00013150: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00013160: 656c 662e 7461 6773 5f69 6e68 6572 6974  elf.tags_inherit
-00013170: 616e 6365 280a 2020 2020 2020 2020 2020  ance(.          
-00013180: 2020 2020 2020 696e 5f66 696c 653d 7365        in_file=se
-00013190: 6c66 2e69 6e5f 6669 6c65 2c0a 2020 2020  lf.in_file,.    
-000131a0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-000131b0: 6669 6c65 3d73 656c 662e 6f75 7470 7574  file=self.output
-000131c0: 735b 226f 7574 5f66 696c 6522 5d2c 0a20  s["out_file"],. 
-000131d0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000131e0: 2020 2020 2020 2320 5265 7475 726e 2074        # Return t
-000131f0: 6865 2072 6571 7569 7265 6d65 6e74 2c20  he requirement, 
-00013200: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
-00013210: 7269 7461 6e63 655f 6469 6374 0a20 2020  ritance_dict.   
-00013220: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00013230: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
-00013240: 2829 0a0a 2020 2020 6465 6620 7275 6e5f  ()..    def run_
-00013250: 7072 6f63 6573 735f 6d69 6128 7365 6c66  process_mia(self
-00013260: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
-00013270: 6469 6361 7465 6420 746f 2074 6865 2070  dicated to the p
-00013280: 726f 6365 7373 206c 6175 6e63 6820 7374  rocess launch st
-00013290: 6570 206f 6620 7468 6520 6272 6963 6b2e  ep of the brick.
-000132a0: 2222 220a 0a20 2020 2020 2020 2073 7570  """..        sup
-000132b0: 6572 2849 6e74 656e 7369 7479 436c 6970  er(IntensityClip
-000132c0: 2c20 7365 6c66 292e 7275 6e5f 7072 6f63  , self).run_proc
-000132d0: 6573 735f 6d69 6128 290a 0a20 2020 2020  ess_mia()..     
-000132e0: 2020 2069 6e5f 6669 6c65 203d 2073 656c     in_file = sel
-000132f0: 662e 696e 5f66 696c 650a 2020 2020 2020  f.in_file.      
-00013300: 2020 6f75 745f 6669 6c65 203d 2073 656c    out_file = sel
-00013310: 662e 6f75 745f 6669 6c65 0a20 2020 2020  f.out_file.     
-00013320: 2020 206e 6f6e 6e65 6761 7469 7665 203d     nonnegative =
-00013330: 2073 656c 662e 6e6f 6e6e 6567 6174 6976   self.nonnegativ
-00013340: 650a 2020 2020 2020 2020 705f 6d69 6e20  e.        p_min 
-00013350: 3d20 7365 6c66 2e70 5f6d 696e 0a20 2020  = self.p_min.   
-00013360: 2020 2020 2070 5f6d 6178 203d 2073 656c       p_max = sel
-00013370: 662e 705f 6d61 780a 2020 2020 2020 2020  f.p_max.        
-00013380: 696e 7665 7274 203d 2073 656c 662e 696e  invert = self.in
-00013390: 7665 7274 0a20 2020 2020 2020 2064 7479  vert.        dty
-000133a0: 7065 203d 2073 656c 662e 6474 7970 650a  pe = self.dtype.
-000133b0: 0a20 2020 2020 2020 2023 204c 6f61 6420  .        # Load 
-000133c0: 6461 7461 0a20 2020 2020 2020 2069 6d67  data.        img
-000133d0: 203d 206e 6962 2e73 7175 6565 7a65 5f69   = nib.squeeze_i
-000133e0: 6d61 6765 286e 6962 2e6c 6f61 6428 696e  mage(nib.load(in
-000133f0: 5f66 696c 6529 290a 2020 2020 2020 2020  _file)).        
-00013400: 6966 206c 656e 2869 6d67 2e73 6861 7065  if len(img.shape
-00013410: 2920 213d 2033 3a0a 2020 2020 2020 2020  ) != 3:.        
-00013420: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
-00013430: 6545 7272 6f72 2866 223c 7b69 6e5f 6669  eError(f"<{in_fi
-00013440: 6c65 7d3e 2069 7320 6e6f 7420 6120 3344  le}> is not a 3D
-00013450: 2066 696c 652e 2229 0a20 2020 2020 2020   file.").       
-00013460: 2064 6174 6120 3d20 696d 672e 6765 745f   data = img.get_
-00013470: 6664 6174 6128 6474 7970 653d 2266 6c6f  fdata(dtype="flo
-00013480: 6174 3332 2229 0a0a 2020 2020 2020 2020  at32")..        
-00013490: 2320 4361 6c63 756c 6174 6520 7374 6174  # Calculate stat
-000134a0: 7320 6f6e 2064 656e 6f69 7365 6420 7665  s on denoised ve
-000134b0: 7273 696f 6e2c 2074 6f20 7072 6565 6d70  rsion, to preemp
-000134c0: 7420 6f75 746c 6965 7273 2066 726f 6d20  t outliers from 
-000134d0: 6269 6173 696e 670a 2020 2020 2020 2020  biasing.        
-000134e0: 6465 6e6f 6973 6564 203d 2073 696d 2e6d  denoised = sim.m
-000134f0: 6564 6961 6e5f 6669 6c74 6572 2864 6174  edian_filter(dat
-00013500: 612c 2066 6f6f 7470 7269 6e74 3d62 616c  a, footprint=bal
-00013510: 6c28 3329 290a 0a20 2020 2020 2020 2061  l(3))..        a
-00013520: 5f6d 696e 203d 206e 702e 7065 7263 656e  _min = np.percen
-00013530: 7469 6c65 280a 2020 2020 2020 2020 2020  tile(.          
-00013540: 2020 6465 6e6f 6973 6564 5b64 656e 6f69    denoised[denoi
-00013550: 7365 6420 3e20 305d 2069 6620 6e6f 6e6e  sed > 0] if nonn
-00013560: 6567 6174 6976 6520 656c 7365 2064 656e  egative else den
-00013570: 6f69 7365 642c 2070 5f6d 696e 0a20 2020  oised, p_min.   
-00013580: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
-00013590: 5f6d 6178 203d 206e 702e 7065 7263 656e  _max = np.percen
-000135a0: 7469 6c65 280a 2020 2020 2020 2020 2020  tile(.          
-000135b0: 2020 6465 6e6f 6973 6564 5b64 656e 6f69    denoised[denoi
-000135c0: 7365 6420 3e20 305d 2069 6620 6e6f 6e6e  sed > 0] if nonn
-000135d0: 6567 6174 6976 6520 656c 7365 2064 656e  egative else den
-000135e0: 6f69 7365 642c 2070 5f6d 6178 0a20 2020  oised, p_max.   
-000135f0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00013600: 2320 436c 6970 2061 6e64 2063 6173 740a  # Clip and cast.
-00013610: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
-00013620: 702e 636c 6970 2864 6174 612c 2061 5f6d  p.clip(data, a_m
-00013630: 696e 3d61 5f6d 696e 2c20 615f 6d61 783d  in=a_min, a_max=
-00013640: 615f 6d61 7829 0a20 2020 2020 2020 2064  a_max).        d
-00013650: 6174 6120 2d3d 2064 6174 612e 6d69 6e28  ata -= data.min(
-00013660: 290a 2020 2020 2020 2020 6461 7461 202f  ).        data /
-00013670: 3d20 6461 7461 2e6d 6178 2829 0a0a 2020  = data.max()..  
-00013680: 2020 2020 2020 6966 2069 6e76 6572 743a        if invert:
-00013690: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-000136a0: 6120 3d20 312e 3020 2d20 6461 7461 0a0a  a = 1.0 - data..
-000136b0: 2020 2020 2020 2020 6966 2064 7479 7065          if dtype
-000136c0: 2069 6e20 2822 7569 6e74 3822 2c20 2269   in ("uint8", "i
-000136d0: 6e74 3136 2229 3a0a 2020 2020 2020 2020  nt16"):.        
-000136e0: 2020 2020 6461 7461 203d 206e 702e 726f      data = np.ro
-000136f0: 756e 6428 3235 3520 2a20 6461 7461 292e  und(255 * data).
-00013700: 6173 7479 7065 2864 7479 7065 290a 0a20  astype(dtype).. 
-00013710: 2020 2020 2020 2068 6472 203d 2069 6d67         hdr = img
-00013720: 2e68 6561 6465 722e 636f 7079 2829 0a20  .header.copy(). 
-00013730: 2020 2020 2020 2068 6472 2e73 6574 5f64         hdr.set_d
-00013740: 6174 615f 6474 7970 6528 6474 7970 6529  ata_dtype(dtype)
-00013750: 0a20 2020 2020 2020 2069 6d67 2e5f 5f63  .        img.__c
-00013760: 6c61 7373 5f5f 2864 6174 612c 2069 6d67  lass__(data, img
-00013770: 2e61 6666 696e 652c 2068 6472 292e 746f  .affine, hdr).to
-00013780: 5f66 696c 656e 616d 6528 6f75 745f 6669  _filename(out_fi
-00013790: 6c65 290a 0a0a 636c 6173 7320 4d61 736b  le)...class Mask
-000137a0: 2850 726f 6365 7373 4d49 4129 3a0a 2020  (ProcessMIA):.  
-000137b0: 2020 2222 220a 2020 2020 2a41 7070 6c79    """.    *Apply
-000137c0: 2061 2062 696e 6172 7920 6d61 736b 2074   a binary mask t
-000137d0: 6f20 616e 2069 6d61 6765 2a0a 0a20 2020  o an image*..   
-000137e0: 2050 6c65 6173 652c 2073 6565 2074 6865   Please, see the
-000137f0: 2063 6f6d 706c 6574 6520 646f 6375 6d65   complete docume
-00013800: 6e74 6174 696f 6e20 666f 7220 7468 6520  ntation for the 
-00013810: 604d 6173 6b20 6272 6963 6b0a 2020 2020  `Mask brick.    
-00013820: 696e 2074 6865 206d 6961 5f70 726f 6365  in the mia_proce
-00013830: 7373 6573 2077 6562 7369 7465 0a20 2020  sses website.   
-00013840: 203c 6874 7470 733a 2f2f 706f 7075 6c73   <https://populs
-00013850: 652e 6769 7468 7562 2e69 6f2f 6d69 615f  e.github.io/mia_
-00013860: 7072 6f63 6573 7365 732f 6874 6d6c 2f64  processes/html/d
-00013870: 6f63 756d 656e 7461 7469 6f6e 2f62 7269  ocumentation/bri
-00013880: 636b 732f 7072 6570 726f 6365 7373 2f6f  cks/preprocess/o
-00013890: 7468 6572 2f4d 6173 6b2e 6874 6d6c 3e60  ther/Mask.html>`
-000138a0: 5f0a 0a20 2020 2061 6461 7074 6564 2066  _..    adapted f
-000138b0: 726f 6d3a 0a20 2020 2068 7474 7073 3a2f  rom:.    https:/
-000138c0: 2f67 6974 6875 622e 636f 6d2f 6e69 7072  /github.com/nipr
-000138d0: 6570 732f 6e69 776f 726b 666c 6f77 732f  eps/niworkflows/
-000138e0: 626c 6f62 2f34 3561 6231 3365 3162 6636  blob/45ab13e1bf6
-000138f0: 6664 6266 3565 3239 6339 3063 6566 3434  fdbf5e29c90cef44
-00013900: 3035 3562 3062 3963 6633 3931 622f 6e69  055b0b9cf391b/ni
-00013910: 776f 726b 666c 6f77 732f 696e 7465 7266  workflows/interf
-00013920: 6163 6573 2f6e 6f72 6d2e 7079 234c 3437  aces/norm.py#L47
-00013930: 340a 0a20 2020 2022 2222 0a0a 2020 2020  4..    """..    
-00013940: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00013950: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
-00013960: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
-00013970: 6174 7472 6962 7574 6573 2069 6e69 7469  attributes initi
-00013980: 616c 6973 6174 696f 6e20 2f20 696e 7374  alisation / inst
-00013990: 616e 7469 6174 696f 6e2e 0a0a 2020 2020  antiation...    
-000139a0: 2020 2020 5468 6520 696e 7075 7420 616e      The input an
-000139b0: 6420 6f75 7470 7574 2070 6c75 6773 2061  d output plugs a
-000139c0: 7265 2064 6566 696e 6564 2068 6572 652e  re defined here.
-000139d0: 2054 6865 2073 7065 6369 616c 0a20 2020   The special.   
-000139e0: 2020 2020 2027 7365 6c66 2e72 6571 7569       'self.requi
-000139f0: 7265 6d65 6e74 2720 6174 7472 6962 7574  rement' attribut
-00013a00: 6520 286f 7074 696f 6e61 6c29 2069 7320  e (optional) is 
-00013a10: 7573 6564 2074 6f20 6465 6669 6e65 2074  used to define t
-00013a20: 6865 0a20 2020 2020 2020 2074 6869 7264  he.        third
-00013a30: 2d70 6172 7479 2070 726f 6475 6374 7320  -party products 
-00013a40: 6e65 6365 7373 6172 7920 666f 7220 7468  necessary for th
-00013a50: 6520 7275 6e6e 696e 6720 6f66 2074 6865  e running of the
-00013a60: 2062 7269 636b 2e0a 2020 2020 2020 2020   brick..        
-00013a70: 2222 220a 2020 2020 2020 2020 2320 496e  """.        # In
-00013a80: 6974 6961 6c69 7361 7469 6f6e 206f 6620  itialisation of 
-00013a90: 7468 6520 6f62 6a65 6374 7320 6e65 6564  the objects need
-00013aa0: 6564 2066 6f72 2074 6865 206c 6175 6e63  ed for the launc
-00013ab0: 6820 6f66 2074 6865 2062 7269 636b 0a20  h of the brick. 
-00013ac0: 2020 2020 2020 2073 7570 6572 284d 6173         super(Mas
-00013ad0: 6b2c 2073 656c 6629 2e5f 5f69 6e69 745f  k, self).__init_
-00013ae0: 5f28 290a 0a20 2020 2020 2020 2023 2054  _()..        # T
-00013af0: 6869 7264 2070 6172 7479 2073 6f66 7477  hird party softw
-00013b00: 6172 6573 2072 6571 7569 7265 6420 666f  ares required fo
-00013b10: 7220 7468 6520 6578 6563 7574 696f 6e20  r the execution 
-00013b20: 6f66 2074 6865 2062 7269 636b 0a20 2020  of the brick.   
-00013b30: 2020 2020 2073 656c 662e 7265 7175 6972       self.requir
-00013b40: 656d 656e 7420 3d20 5b5d 0a0a 2020 2020  ement = []..    
-00013b50: 2020 2020 2320 496e 7075 7473 2064 6573      # Inputs des
-00013b60: 6372 6970 7469 6f6e 0a20 2020 2020 2020  cription.       
-00013b70: 2069 6e5f 6669 6c65 5f64 6573 6320 3d20   in_file_desc = 
-00013b80: 2241 6e20 6578 6973 7469 6e67 2070 6174  "An existing pat
-00013b90: 6820 6669 6c65 2e22 0a20 2020 2020 2020  h file.".       
-00013ba0: 206d 6173 6b5f 6669 6c65 5f64 6573 6320   mask_file_desc 
-00013bb0: 3d20 2241 6e20 6578 6973 7469 6e67 2070  = "An existing p
-00013bc0: 6174 6820 6669 6c65 2e22 0a20 2020 2020  ath file.".     
-00013bd0: 2020 2070 7265 6669 785f 6465 7363 203d     prefix_desc =
-00013be0: 2022 5072 6566 6978 206f 6620 7468 6520   "Prefix of the 
-00013bf0: 6f75 7470 7574 2069 6d61 6765 2028 6120  output image (a 
-00013c00: 7374 7269 6e67 292e 220a 2020 2020 2020  string).".      
-00013c10: 2020 7375 6666 6978 5f64 6573 6320 3d20    suffix_desc = 
-00013c20: 2253 7566 6669 7820 6f66 2074 6865 206f  "Suffix of the o
-00013c30: 7574 7075 7420 696d 6167 6520 2861 2073  utput image (a s
-00013c40: 7472 696e 6729 2e22 0a0a 2020 2020 2020  tring)."..      
-00013c50: 2020 2320 4f75 7470 7574 7320 6465 7363    # Outputs desc
-00013c60: 7269 7074 696f 6e0a 2020 2020 2020 2020  ription.        
-00013c70: 6f75 745f 6669 6c65 5f64 6573 6320 3d20  out_file_desc = 
-00013c80: 280a 2020 2020 2020 2020 2020 2020 2250  (.            "P
-00013c90: 6174 6820 6f66 2074 6865 2073 6361 6e20  ath of the scan 
-00013ca0: 6166 7465 7220 6d61 736b 696e 6720 220a  after masking ".
-00013cb0: 2020 2020 2020 2020 2020 2020 2228 6120              "(a 
-00013cc0: 7061 7468 6c69 6b65 206f 626a 6563 7420  pathlike object 
-00013cd0: 6f72 2073 7472 696e 6720 7265 7072 6573  or string repres
-00013ce0: 656e 7469 6e67 2061 2066 696c 6529 2e22  enting a file)."
-00013cf0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00013d00: 2020 2020 2320 496e 7075 7473 2074 7261      # Inputs tra
-00013d10: 6974 730a 2020 2020 2020 2020 7365 6c66  its.        self
-00013d20: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
-00013d30: 2020 2020 2020 2020 2269 6e5f 6669 6c65          "in_file
-00013d40: 222c 2046 696c 6528 6f75 7470 7574 3d46  ", File(output=F
-00013d50: 616c 7365 2c20 6f70 7469 6f6e 616c 3d46  alse, optional=F
-00013d60: 616c 7365 2c20 6465 7363 3d69 6e5f 6669  alse, desc=in_fi
-00013d70: 6c65 5f64 6573 6329 0a20 2020 2020 2020  le_desc).       
-00013d80: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-00013d90: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
-00013da0: 2020 2020 2020 2020 226d 6173 6b5f 6669          "mask_fi
-00013db0: 6c65 222c 0a20 2020 2020 2020 2020 2020  le",.           
-00013dc0: 2046 696c 6528 6f75 7470 7574 3d46 616c   File(output=Fal
-00013dd0: 7365 2c20 6f70 7469 6f6e 616c 3d46 616c  se, optional=Fal
-00013de0: 7365 2c20 6465 7363 3d6d 6173 6b5f 6669  se, desc=mask_fi
-00013df0: 6c65 5f64 6573 6329 2c0a 2020 2020 2020  le_desc),.      
-00013e00: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00013e10: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-00013e20: 2020 2020 2020 2020 2022 7072 6566 6978           "prefix
-00013e30: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
-00013e40: 7261 6974 732e 5374 7269 6e67 2822 222c  raits.String("",
-00013e50: 206f 7574 7075 743d 4661 6c73 652c 206f   output=False, o
-00013e60: 7074 696f 6e61 6c3d 5472 7565 2c20 6465  ptional=True, de
-00013e70: 7363 3d70 7265 6669 785f 6465 7363 292c  sc=prefix_desc),
-00013e80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00013e90: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
-00013ea0: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
-00013eb0: 2273 7566 6669 7822 2c0a 2020 2020 2020  "suffix",.      
-00013ec0: 2020 2020 2020 7472 6169 7473 2e53 7472        traits.Str
-00013ed0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-00013ee0: 2020 2020 2022 5f6d 6173 6b65 6422 2c20       "_masked", 
-00013ef0: 6f75 7470 7574 3d46 616c 7365 2c20 6f70  output=False, op
-00013f00: 7469 6f6e 616c 3d54 7275 652c 2064 6573  tional=True, des
-00013f10: 633d 7375 6666 6978 5f64 6573 630a 2020  c=suffix_desc.  
-00013f20: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00013f30: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00013f40: 2320 4f75 7470 7574 7320 7472 6169 7473  # Outputs traits
-00013f50: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00013f60: 645f 7472 6169 7428 226f 7574 5f66 696c  d_trait("out_fil
-00013f70: 6522 2c20 4669 6c65 286f 7574 7075 743d  e", File(output=
-00013f80: 5472 7565 2c20 6465 7363 3d6f 7574 5f66  True, desc=out_f
-00013f90: 696c 655f 6465 7363 2929 0a0a 2020 2020  ile_desc))..    
-00013fa0: 2020 2020 7365 6c66 2e69 6e69 745f 6465      self.init_de
-00013fb0: 6661 756c 745f 7472 6169 7473 2829 0a0a  fault_traits()..
-00013fc0: 2020 2020 6465 6620 6c69 7374 5f6f 7574      def list_out
-00013fd0: 7075 7473 2873 656c 662c 2069 735f 706c  puts(self, is_pl
-00013fe0: 7567 6765 643d 4e6f 6e65 293a 0a20 2020  ugged=None):.   
-00013ff0: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
-00014000: 6420 746f 2074 6865 2069 6e69 7469 616c  d to the initial
-00014010: 6973 6174 696f 6e20 7374 6570 206f 6620  isation step of 
-00014020: 7468 6520 6272 6963 6b2e 0a0a 2020 2020  the brick...    
-00014030: 2020 2020 5468 6520 6d61 696e 206f 626a      The main obj
-00014040: 6563 7469 7665 206f 6620 7468 6973 206d  ective of this m
-00014050: 6574 686f 6420 6973 2074 6f20 7072 6f64  ethod is to prod
-00014060: 7563 6520 7468 6520 6f75 7470 7574 7320  uce the outputs 
-00014070: 6f66 2074 6865 0a20 2020 2020 2020 2062  of the.        b
-00014080: 7269 636b 7320 2873 656c 662e 6f75 7470  ricks (self.outp
-00014090: 7574 7329 2061 6e64 2074 6865 2061 7373  uts) and the ass
-000140a0: 6f63 6961 7465 6420 7461 6773 2028 7365  ociated tags (se
-000140b0: 6c66 2e69 6e68 6572 6974 616e 6365 5f64  lf.inheritance_d
-000140c0: 6963 292c 0a20 2020 2020 2020 2069 6620  ic),.        if 
-000140d0: 6465 6669 6e65 6420 6865 7265 2e20 546f  defined here. To
-000140e0: 2077 6f72 6b20 7072 6f70 6572 6c79 2074   work properly t
-000140f0: 6869 7320 6d65 7468 6f64 206d 7573 7420  his method must 
-00014100: 7265 7475 726e 0a20 2020 2020 2020 2073  return.        s
-00014110: 656c 662e 6d61 6b65 5f69 6e69 7452 6573  elf.make_initRes
-00014120: 756c 7428 2920 6f62 6a65 6374 2e0a 0a20  ult() object... 
-00014130: 2020 2020 2020 203a 7061 7261 6d20 6973         :param is
-00014140: 5f70 6c75 6767 6564 3a20 7468 6520 7374  _plugged: the st
-00014150: 6174 652c 206c 696e 6b65 6420 6f72 206e  ate, linked or n
-00014160: 6f74 2c20 6f66 2074 6865 2070 6c75 6773  ot, of the plugs
-00014170: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-00014180: 6e73 3a20 6120 6469 6374 696f 6e61 7279  ns: a dictionary
-00014190: 2077 6974 6820 7265 7175 6972 656d 656e   with requiremen
-000141a0: 742c 206f 7574 7075 7473 2061 6e64 2069  t, outputs and i
-000141b0: 6e68 6572 6974 616e 6365 5f64 6963 742e  nheritance_dict.
-000141c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000141d0: 2020 2020 2023 2055 7369 6e67 2074 6865       # Using the
-000141e0: 2069 6e68 6572 6974 616e 6365 2074 6f20   inheritance to 
-000141f0: 5072 6f63 6573 734d 4941 2063 6c61 7373  ProcessMIA class
-00014200: 2c20 6c69 7374 5f6f 7574 7075 7473 206d  , list_outputs m
-00014210: 6574 686f 640a 2020 2020 2020 2020 7375  ethod.        su
-00014220: 7065 7228 4d61 736b 2c20 7365 6c66 292e  per(Mask, self).
-00014230: 6c69 7374 5f6f 7574 7075 7473 2829 0a0a  list_outputs()..
-00014240: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
-00014250: 7320 6465 6669 6e69 7469 6f6e 0a20 2020  s definition.   
-00014260: 2020 2020 2069 6620 7365 6c66 2e69 6e5f       if self.in_
-00014270: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-00014280: 2020 7661 6c69 645f 6578 742c 2069 6e5f    valid_ext, in_
-00014290: 6578 742c 2066 696c 654e 616d 6520 3d20  ext, fileName = 
-000142a0: 6368 6563 6b46 696c 6545 7874 2873 656c  checkFileExt(sel
-000142b0: 662e 696e 5f66 696c 652c 2045 5854 290a  f.in_file, EXT).
-000142c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000142d0: 6e6f 7420 7661 6c69 645f 6578 743a 0a20  not valid_ext:. 
-000142e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000142f0: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-00014300: 2020 2020 2020 2020 2020 225c 6e4d 6173            "\nMas
-00014310: 6b20 6272 6963 6b3a 2054 6865 2069 6e70  k brick: The inp
-00014320: 7574 2069 6d61 6765 2066 6f72 6d61 7420  ut image format 
-00014330: 6973 206e 6f74 2022 0a20 2020 2020 2020  is not ".       
-00014340: 2020 2020 2020 2020 2020 2020 2022 7265               "re
-00014350: 636f 676e 697a 6564 2e2e 2e21 220a 2020  cognized...!".  
-00014360: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014380: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-00014390: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-000143a0: 2020 2020 2020 2020 2028 6e6f 7420 7365           (not se
-000143b0: 6c66 2e73 7566 6669 7829 0a20 2020 2020  lf.suffix).     
-000143c0: 2020 2020 2020 2020 2020 206f 7220 2873             or (s
-000143d0: 656c 662e 7375 6666 6978 2e69 7373 7061  elf.suffix.isspa
-000143e0: 6365 2829 290a 2020 2020 2020 2020 2020  ce()).          
-000143f0: 2020 2020 2020 6f72 2073 656c 662e 7375        or self.su
-00014400: 6666 6978 2069 6e20 5b55 6e64 6566 696e  ffix in [Undefin
-00014410: 6564 2c20 223c 756e 6465 6669 6e65 643e  ed, "<undefined>
-00014420: 225d 0a20 2020 2020 2020 2020 2020 2029  "].            )
-00014430: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014440: 2020 7365 6c66 2e73 7566 6669 7820 3d20    self.suffix = 
-00014450: 2220 220a 0a20 2020 2020 2020 2020 2020  " "..           
-00014460: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-00014470: 2020 2020 2020 286e 6f74 2073 656c 662e        (not self.
-00014480: 7072 6566 6978 290a 2020 2020 2020 2020  prefix).        
-00014490: 2020 2020 2020 2020 6f72 2028 7365 6c66          or (self
-000144a0: 2e70 7265 6669 782e 6973 7370 6163 6528  .prefix.isspace(
-000144b0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-000144c0: 2020 206f 7220 2873 656c 662e 7072 6566     or (self.pref
-000144d0: 6978 2069 6e20 5b55 6e64 6566 696e 6564  ix in [Undefined
-000144e0: 2c20 223c 756e 6465 6669 6e65 643e 225d  , "<undefined>"]
-000144f0: 290a 2020 2020 2020 2020 2020 2020 293a  ).            ):
-00014500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014510: 2073 656c 662e 7072 6566 6978 203d 2022   self.prefix = "
-00014520: 2022 0a0a 2020 2020 2020 2020 2020 2020   "..            
-00014530: 7061 7468 2c20 5f20 3d20 6f73 2e70 6174  path, _ = os.pat
-00014540: 682e 7370 6c69 7428 7365 6c66 2e69 6e5f  h.split(self.in_
-00014550: 6669 6c65 290a 0a20 2020 2020 2020 2020  file)..         
-00014560: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00014570: 2020 2020 2020 2020 7365 6c66 2e73 7566          self.suf
-00014580: 6669 7820 3d3d 2022 2022 0a20 2020 2020  fix == " ".     
-00014590: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
-000145a0: 656c 662e 7072 6566 6978 203d 3d20 2220  elf.prefix == " 
-000145b0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000145c0: 2020 616e 6420 7061 7468 203d 3d20 7365    and path == se
-000145d0: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
-000145e0: 6f72 790a 2020 2020 2020 2020 2020 2020  ory.            
-000145f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014600: 2020 206d 7367 203d 2051 4d65 7373 6167     msg = QMessag
-00014610: 6542 6f78 2829 0a20 2020 2020 2020 2020  eBox().         
-00014620: 2020 2020 2020 206d 7367 2e73 6574 4963         msg.setIc
-00014630: 6f6e 2851 4d65 7373 6167 6542 6f78 2e57  on(QMessageBox.W
-00014640: 6172 6e69 6e67 290a 2020 2020 2020 2020  arning).        
-00014650: 2020 2020 2020 2020 6d73 672e 7365 7457          msg.setW
-00014660: 696e 646f 7754 6974 6c65 2822 6d69 615f  indowTitle("mia_
-00014670: 7072 6f63 6573 7365 7320 2d20 4d61 736b  processes - Mask
-00014680: 2062 7269 636b 2057 6172 6e69 6e67 2122   brick Warning!"
-00014690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000146a0: 2020 6d73 672e 7365 7454 6578 7428 0a20    msg.setText(. 
-000146b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146c0: 2020 2022 5375 6666 6978 2061 6e64 2070     "Suffix and p
-000146d0: 7265 6669 7820 696e 7075 7420 7061 7261  refix input para
-000146e0: 6d65 7465 7273 2061 7265 206e 6f74 2022  meters are not "
-000146f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014700: 2020 2020 2022 6465 6669 6e65 6420 6f72       "defined or
-00014710: 2063 6f6e 7369 7374 206f 6e6c 7920 6f66   consist only of
-00014720: 206f 6e65 206f 7220 6d6f 7265 2077 6869   one or more whi
-00014730: 7465 2022 0a20 2020 2020 2020 2020 2020  te ".           
-00014740: 2020 2020 2020 2020 2022 7370 6163 6573           "spaces
-00014750: 2e5c 6e54 6865 207b 307d 2069 6e70 7574  .\nThe {0} input
-00014760: 2070 6172 616d 6574 6572 2077 696c 6c20   parameter will 
-00014770: 6265 2022 0a20 2020 2020 2020 2020 2020  be ".           
-00014780: 2020 2020 2020 2020 2022 6f76 6572 7772           "overwr
-00014790: 6974 7465 6e20 2e2e 2e5c 6e20 5965 7320  itten ...\n Yes 
-000147a0: 6f72 2022 0a20 2020 2020 2020 2020 2020  or ".           
-000147b0: 2020 2020 2020 2020 2022 4162 6f72 743f           "Abort?
-000147c0: 222e 666f 726d 6174 2866 696c 654e 616d  ".format(fileNam
-000147d0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000147e0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000147f0: 2020 2020 206d 7367 2e73 6574 5374 616e       msg.setStan
-00014800: 6461 7264 4275 7474 6f6e 7328 514d 6573  dardButtons(QMes
-00014810: 7361 6765 426f 782e 5965 7320 7c20 514d  sageBox.Yes | QM
-00014820: 6573 7361 6765 426f 782e 4162 6f72 7429  essageBox.Abort)
-00014830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014840: 2072 6574 7661 6c20 3d20 6d73 672e 6578   retval = msg.ex
-00014850: 6563 5f28 290a 0a20 2020 2020 2020 2020  ec_()..         
-00014860: 2020 2020 2020 2069 6620 7265 7476 616c         if retval
-00014870: 2021 3d20 514d 6573 7361 6765 426f 782e   != QMessageBox.
-00014880: 4162 6f72 743a 0a20 2020 2020 2020 2020  Abort:.         
-00014890: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000148a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000148b0: 2020 2020 2020 2020 2020 225c 6e4d 6173            "\nMas
-000148c0: 6b20 6272 6963 6b20 7761 726e 696e 673a  k brick warning:
-000148d0: 2074 6865 206f 7574 5f66 696c 6520 6f75   the out_file ou
-000148e0: 7470 7574 2022 0a20 2020 2020 2020 2020  tput ".         
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014900: 7061 7261 6d65 7465 7220 6973 2074 6865  parameter is the
-00014910: 2073 616d 6520 6173 2074 6865 2069 6e5f   same as the in_
-00014920: 6669 6c65 7320 696e 7075 7420 220a 2020  files input ".  
-00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014940: 2020 2020 2020 2270 6172 616d 6574 6572        "parameter
-00014950: 2028 7375 6666 6978 2061 6e64 2070 7265   (suffix and pre
-00014960: 6669 7820 6172 6520 6e6f 7420 6465 6669  fix are not defi
-00014970: 6e65 6429 3a22 0a20 2020 2020 2020 2020  ned):".         
-00014980: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014990: 5c6e 7b30 7d20 7769 6c6c 2062 6520 6f76  \n{0} will be ov
-000149a0: 6572 7772 6974 6564 202e 2e2e 222e 666f  erwrited ...".fo
-000149b0: 726d 6174 2866 696c 654e 616d 6529 0a20  rmat(fileName). 
-000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-000149e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000149f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a00: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00014a10: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014a20: 5c6e 4d61 736b 2062 7269 636b 3a20 4162  \nMask brick: Ab
-00014a30: 6f72 7465 642e 2050 6c65 6173 6520 6368  orted. Please ch
-00014a40: 6563 6b20 796f 7572 2069 6e70 7574 2022  eck your input "
-00014a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014a60: 2020 2020 2020 2020 2022 7061 7261 6d65           "parame
-00014a70: 7465 7273 202e 2e2e 220a 2020 2020 2020  ters ...".      
-00014a80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00014a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014aa0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00014ab0: 2020 2020 2020 2020 6669 6c65 203d 206f          file = o
-00014ac0: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
-00014ad0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00014ae0: 662e 6f75 7470 7574 5f64 6972 6563 746f  f.output_directo
-00014af0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-00014b00: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-00014b10: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00014b20: 7265 6669 782e 7374 7269 7028 290a 2020  refix.strip().  
-00014b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b40: 2020 2b20 6669 6c65 4e61 6d65 0a20 2020    + fileName.   
-00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b60: 202b 2073 656c 662e 7375 6666 6978 2e73   + self.suffix.s
-00014b70: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-00014b80: 2020 2020 2020 2020 2020 202b 2022 2e22             + "."
-00014b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ba0: 2020 2020 202b 2069 6e5f 6578 740a 2020       + in_ext.  
-00014bb0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-00014bc0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00014bd0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00014be0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00014bf0: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
-00014c00: 735b 226f 7574 5f66 696c 6522 5d20 3d20  s["out_file"] = 
-00014c10: 6669 6c65 0a0a 2020 2020 2020 2020 2020  file..          
-00014c20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00014c30: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c50: 2020 2022 2d20 4d61 736b 2062 7269 636b     "- Mask brick
-00014c60: 3a20 5468 6572 6520 7761 7320 6e6f 206f  : There was no o
-00014c70: 7574 7075 7420 6669 6c65 2064 6564 7563  utput file deduc
-00014c80: 7465 6420 6475 7269 6e67 2022 0a20 2020  ted during ".   
-00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ca0: 2022 696e 6974 6961 6c69 7a61 7469 6f6e   "initialization
-00014cb0: 2e20 506c 6561 7365 2063 6865 636b 2074  . Please check t
-00014cc0: 6865 2069 6e70 7574 2070 6172 616d 6574  he input paramet
-00014cd0: 6572 732e 2e2e 2122 0a20 2020 2020 2020  ers...!".       
-00014ce0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00014cf0: 2020 2020 2320 7461 6773 2069 6e68 6572      # tags inher
-00014d00: 6974 616e 6365 2028 6f70 7469 6f6e 616c  itance (optional
-00014d10: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-00014d20: 662e 6f75 7470 7574 735b 226f 7574 5f66  f.outputs["out_f
-00014d30: 696c 6522 5d3a 0a20 2020 2020 2020 2020  ile"]:.         
-00014d40: 2020 2073 656c 662e 7461 6773 5f69 6e68     self.tags_inh
-00014d50: 6572 6974 616e 6365 280a 2020 2020 2020  eritance(.      
-00014d60: 2020 2020 2020 2020 2020 696e 5f66 696c            in_fil
-00014d70: 653d 7365 6c66 2e69 6e5f 6669 6c65 2c0a  e=self.in_file,.
-00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d90: 6f75 745f 6669 6c65 3d73 656c 662e 6f75  out_file=self.ou
-00014da0: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
-00014db0: 5d2c 0a20 2020 2020 2020 2020 2020 2029  ],.            )
-00014dc0: 0a0a 2020 2020 2020 2020 2320 5265 7475  ..        # Retu
-00014dd0: 726e 2074 6865 2072 6571 7569 7265 6d65  rn the requireme
-00014de0: 6e74 2c20 6f75 7470 7574 7320 616e 6420  nt, outputs and 
-00014df0: 696e 6865 7269 7461 6e63 655f 6469 6374  inheritance_dict
-00014e00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014e10: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
-00014e20: 7375 6c74 2829 0a0a 2020 2020 6465 6620  sult()..    def 
-00014e30: 7275 6e5f 7072 6f63 6573 735f 6d69 6128  run_process_mia(
-00014e40: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00014e50: 2222 4465 6469 6361 7465 6420 746f 2074  ""Dedicated to t
-00014e60: 6865 2070 726f 6365 7373 206c 6175 6e63  he process launc
-00014e70: 6820 7374 6570 206f 6620 7468 6520 6272  h step of the br
-00014e80: 6963 6b2e 2222 220a 2020 2020 2020 2020  ick.""".        
-00014e90: 7375 7065 7228 4d61 736b 2c20 7365 6c66  super(Mask, self
-00014ea0: 292e 7275 6e5f 7072 6f63 6573 735f 6d69  ).run_process_mi
-00014eb0: 6128 290a 0a20 2020 2020 2020 2066 696c  a()..        fil
-00014ec0: 655f 6e61 6d65 203d 2073 656c 662e 696e  e_name = self.in
-00014ed0: 5f66 696c 650a 2020 2020 2020 2020 6d61  _file.        ma
-00014ee0: 736b 5f6e 616d 6520 3d20 7365 6c66 2e6d  sk_name = self.m
-00014ef0: 6173 6b5f 6669 6c65 0a0a 2020 2020 2020  ask_file..      
-00014f00: 2020 2320 496d 6167 6520 7072 6f63 6573    # Image proces
-00014f10: 7369 6e67 0a20 2020 2020 2020 2074 7279  sing.        try
-00014f20: 3a0a 2020 2020 2020 2020 2020 2020 696d  :.            im
-00014f30: 6720 3d20 6e69 622e 6c6f 6164 2866 696c  g = nib.load(fil
-00014f40: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00014f50: 2020 2020 6d61 736b 5f69 6d67 203d 206e      mask_img = n
-00014f60: 6962 2e6c 6f61 6428 6d61 736b 5f6e 616d  ib.load(mask_nam
-00014f70: 6529 0a0a 2020 2020 2020 2020 6578 6365  e)..        exce
-00014f80: 7074 2028 0a20 2020 2020 2020 2020 2020  pt (.           
-00014f90: 206e 6962 2e66 696c 6562 6173 6564 696d   nib.filebasedim
-00014fa0: 6167 6573 2e49 6d61 6765 4669 6c65 4572  ages.ImageFileEr
-00014fb0: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
-00014fc0: 2046 696c 654e 6f74 466f 756e 6445 7272   FileNotFoundErr
-00014fd0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00014fe0: 5479 7065 4572 726f 722c 0a20 2020 2020  TypeError,.     
-00014ff0: 2020 2029 2061 7320 653a 0a20 2020 2020     ) as e:.     
-00015000: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-00015010: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-00015020: 6e4d 6173 6b20 6272 6963 6b3a 2045 7272  nMask brick: Err
-00015030: 6f72 2077 6974 6820 6669 6c65 7320 746f  or with files to
-00015040: 206d 6173 6b2c 2064 7572 696e 6720 7468   mask, during th
-00015050: 6520 7275 6e3a 2022 2c0a 2020 2020 2020  e run: ",.      
-00015060: 2020 2020 2020 2020 2020 652c 0a20 2020            e,.   
-00015070: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00015080: 2020 2020 2020 2069 6d67 203d 204e 6f6e         img = Non
-00015090: 650a 0a20 2020 2020 2020 2069 6620 2869  e..        if (i
-000150a0: 6d67 2069 7320 6e6f 7420 4e6f 6e65 2920  mg is not None) 
-000150b0: 616e 6420 286d 6173 6b5f 696d 6720 6973  and (mask_img is
-000150c0: 206e 6f74 204e 6f6e 6529 3a0a 2020 2020   not None):.    
-000150d0: 2020 2020 2020 2020 6461 7461 203d 2069          data = i
-000150e0: 6d67 2e67 6574 5f66 6461 7461 2829 0a20  mg.get_fdata(). 
-000150f0: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-00015100: 6e70 2e61 7361 6e79 6172 7261 7928 6d61  np.asanyarray(ma
-00015110: 736b 5f69 6d67 2e64 6174 616f 626a 2920  sk_img.dataobj) 
-00015120: 3d3d 2030 5d20 3d20 300a 0a20 2020 2020  == 0] = 0..     
-00015130: 2020 2020 2020 206d 6173 6b69 6d67 203d         maskimg =
-00015140: 2069 6d67 2e5f 5f63 6c61 7373 5f5f 2864   img.__class__(d
-00015150: 6174 612c 2069 6d67 2e61 6666 696e 652c  ata, img.affine,
-00015160: 2069 6d67 2e68 6561 6465 7229 0a0a 2020   img.header)..  
-00015170: 2020 2020 2020 2020 2020 2320 496d 6167            # Imag
-00015180: 6520 7361 7665 0a20 2020 2020 2020 2020  e save.         
-00015190: 2020 205f 2c20 6669 6c65 5f6e 616d 6520     _, file_name 
-000151a0: 3d20 6f73 2e70 6174 682e 7370 6c69 7428  = os.path.split(
-000151b0: 6669 6c65 5f6e 616d 6529 0a20 2020 2020  file_name).     
-000151c0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-000151d0: 5f6e 6f5f 6578 742c 2066 696c 655f 6578  _no_ext, file_ex
-000151e0: 7465 6e73 696f 6e20 3d20 6f73 2e70 6174  tension = os.pat
-000151f0: 682e 7370 6c69 7465 7874 2866 696c 655f  h.splitext(file_
-00015200: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00015210: 2020 6966 2066 696c 655f 6578 7465 6e73    if file_extens
-00015220: 696f 6e20 3d3d 2022 2e67 7a22 3a0a 2020  ion == ".gz":.  
-00015230: 2020 2020 2020 2020 2020 2020 2020 2866                (f
-00015240: 696c 655f 6e61 6d65 5f6e 6f5f 6578 745f  ile_name_no_ext_
-00015250: 322c 2066 696c 655f 6578 7465 6e73 696f  2, file_extensio
-00015260: 6e5f 3229 203d 206f 732e 7061 7468 2e73  n_2) = os.path.s
-00015270: 706c 6974 6578 7428 0a20 2020 2020 2020  plitext(.       
-00015280: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00015290: 655f 6e61 6d65 5f6e 6f5f 6578 740a 2020  e_name_no_ext.  
-000152a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152c0: 6966 2066 696c 655f 6578 7465 6e73 696f  if file_extensio
-000152d0: 6e5f 3220 3d3d 2022 2e6e 6969 223a 0a20  n_2 == ".nii":. 
-000152e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152f0: 2020 2066 696c 655f 6e61 6d65 5f6e 6f5f     file_name_no_
-00015300: 6578 7420 3d20 6669 6c65 5f6e 616d 655f  ext = file_name_
-00015310: 6e6f 5f65 7874 5f32 0a20 2020 2020 2020  no_ext_2.       
-00015320: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00015330: 655f 6578 7465 6e73 696f 6e20 3d20 222e  e_extension = ".
-00015340: 6e69 692e 677a 220a 0a20 2020 2020 2020  nii.gz"..       
-00015350: 2020 2020 2066 696c 655f 6f75 7420 3d20       file_out = 
-00015360: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
-00015370: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00015380: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
-00015390: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-000153a0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-000153b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000153c0: 7072 6566 6978 2e73 7472 6970 2829 0a20  prefix.strip(). 
-000153d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153e0: 2020 202b 2066 696c 655f 6e61 6d65 5f6e     + file_name_n
-000153f0: 6f5f 6578 740a 2020 2020 2020 2020 2020  o_ext.          
-00015400: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
-00015410: 2e73 7566 6669 782e 7374 7269 7028 290a  .suffix.strip().
-00015420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015430: 2020 2020 2b20 6669 6c65 5f65 7874 656e      + file_exten
-00015440: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
-00015450: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-00015460: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00015470: 2020 6e69 622e 7361 7665 286d 6173 6b69    nib.save(maski
-00015480: 6d67 2c20 6669 6c65 5f6f 7574 290a 0a0a  mg, file_out)...
-00015490: 636c 6173 7320 4e6f 6e53 7465 6164 7953  class NonSteadyS
-000154a0: 7461 7465 4465 7465 6374 6f72 2850 726f  tateDetector(Pro
-000154b0: 6365 7373 4d49 4129 3a0a 2020 2020 2222  cessMIA):.    ""
-000154c0: 220a 2020 2020 2a44 6574 6563 7420 6e6f  ".    *Detect no
-000154d0: 6e2d 7374 6561 6479 2d73 7461 7465 2061  n-steady-state a
-000154e0: 7420 7468 6520 6265 6769 6e6e 696e 6720  t the beginning 
-000154f0: 6f66 2061 2062 6f6c 6420 3444 2069 6d61  of a bold 4D ima
-00015500: 6765 2a0a 0a20 2020 2050 6c65 6173 652c  ge*..    Please,
-00015510: 2073 6565 2074 6865 2063 6f6d 706c 6574   see the complet
-00015520: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-00015530: 666f 7220 7468 650a 2020 2020 604e 6f6e  for the.    `Non
-00015540: 5374 6561 6479 5374 6174 6544 6574 6563  SteadyStateDetec
-00015550: 746f 7220 6272 6963 6b20 696e 2074 6865  tor brick in the
-00015560: 206d 6961 5f70 726f 6365 7373 6573 2077   mia_processes w
-00015570: 6562 7369 7465 0a20 2020 203c 6874 7470  ebsite.    <http
-00015580: 733a 2f2f 706f 7075 6c73 652e 6769 7468  s://populse.gith
-00015590: 7562 2e69 6f2f 6d69 615f 7072 6f63 6573  ub.io/mia_proces
-000155a0: 7365 732f 6874 6d6c 2f64 6f63 756d 656e  ses/html/documen
-000155b0: 7461 7469 6f6e 2f62 7269 636b 732f 7072  tation/bricks/pr
-000155c0: 6570 726f 6365 7373 2f6f 7468 6572 2f4e  eprocess/other/N
-000155d0: 6f6e 5374 6561 6479 5374 6174 6544 6574  onSteadyStateDet
-000155e0: 6563 746f 722e 6874 6d6c 3e60 5f0a 0a20  ector.html>`_.. 
-000155f0: 2020 2061 6461 7074 6564 2066 726f 6d3a     adapted from:
-00015600: 0a20 2020 2068 7474 7073 3a2f 2f67 6974  .    https://git
-00015610: 6875 622e 636f 6d2f 6e69 7079 2f6e 6970  hub.com/nipy/nip
-00015620: 7970 652f 626c 6f62 2f66 3636 3261 6366  ype/blob/f662acf
-00015630: 6365 3864 6566 3437 3137 6530 6333 3431  ce8def4717e0c341
-00015640: 3436 3138 6633 6135 6465 3539 3133 6233  4618f3a5de5913b3
-00015650: 312f 6e69 7079 7065 2f61 6c67 6f72 6974  1/nipype/algorit
-00015660: 686d 732f 636f 6e66 6f75 6e64 732e 7079  hms/confounds.py
-00015670: 234c 3937 340a 0a20 2020 2022 2222 0a0a  #L974..    """..
-00015680: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00015690: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000156a0: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
-000156b0: 7468 6520 6174 7472 6962 7574 6573 2069  the attributes i
-000156c0: 6e69 7469 616c 6973 6174 696f 6e20 2f20  nitialisation / 
-000156d0: 696e 7374 616e 7469 6174 696f 6e2e 0a0a  instantiation...
-000156e0: 2020 2020 2020 2020 5468 6520 696e 7075          The inpu
-000156f0: 7420 616e 6420 6f75 7470 7574 2070 6c75  t and output plu
-00015700: 6773 2061 7265 2064 6566 696e 6564 2068  gs are defined h
-00015710: 6572 652e 2054 6865 2073 7065 6369 616c  ere. The special
-00015720: 0a20 2020 2020 2020 2027 7365 6c66 2e72  .        'self.r
-00015730: 6571 7569 7265 6d65 6e74 2720 6174 7472  equirement' attr
-00015740: 6962 7574 6520 286f 7074 696f 6e61 6c29  ibute (optional)
-00015750: 2069 7320 7573 6564 2074 6f20 6465 6669   is used to defi
-00015760: 6e65 2074 6865 0a20 2020 2020 2020 2074  ne the.        t
-00015770: 6869 7264 2d70 6172 7479 2070 726f 6475  hird-party produ
-00015780: 6374 7320 6e65 6365 7373 6172 7920 666f  cts necessary fo
-00015790: 7220 7468 6520 7275 6e6e 696e 6720 6f66  r the running of
-000157a0: 2074 6865 2062 7269 636b 2e0a 2020 2020   the brick..    
-000157b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000157c0: 2320 496e 6974 6961 6c69 7361 7469 6f6e  # Initialisation
-000157d0: 206f 6620 7468 6520 6f62 6a65 6374 7320   of the objects 
-000157e0: 6e65 6564 6564 2066 6f72 2074 6865 206c  needed for the l
-000157f0: 6175 6e63 6820 6f66 2074 6865 2062 7269  aunch of the bri
-00015800: 636b 0a20 2020 2020 2020 2073 7570 6572  ck.        super
-00015810: 284e 6f6e 5374 6561 6479 5374 6174 6544  (NonSteadyStateD
-00015820: 6574 6563 746f 722c 2073 656c 6629 2e5f  etector, self)._
-00015830: 5f69 6e69 745f 5f28 290a 0a20 2020 2020  _init__()..     
-00015840: 2020 2023 2054 6869 7264 2070 6172 7479     # Third party
-00015850: 2073 6f66 7477 6172 6573 2072 6571 7569   softwares requi
-00015860: 7265 6420 666f 7220 7468 6520 6578 6563  red for the exec
-00015870: 7574 696f 6e20 6f66 2074 6865 2062 7269  ution of the bri
-00015880: 636b 0a20 2020 2020 2020 2073 656c 662e  ck.        self.
-00015890: 7265 7175 6972 656d 656e 7420 3d20 5b5d  requirement = []
-000158a0: 0a0a 2020 2020 2020 2020 2320 496e 7075  ..        # Inpu
-000158b0: 7473 2064 6573 6372 6970 7469 6f6e 0a20  ts description. 
-000158c0: 2020 2020 2020 2069 6e5f 6669 6c65 5f64         in_file_d
-000158d0: 6573 6320 3d20 2241 6e20 6578 6973 7469  esc = "An existi
-000158e0: 6e67 2070 6174 6820 6669 6c65 2e22 0a0a  ng path file."..
-000158f0: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
-00015900: 7320 6465 7363 7269 7074 696f 6e0a 2020  s description.  
-00015910: 2020 2020 2020 6e5f 766f 6c75 6d65 735f        n_volumes_
-00015920: 746f 5f64 6973 6361 7264 5f64 6573 6320  to_discard_desc 
-00015930: 3d20 224e 756d 6265 7220 6f66 206e 6f6e  = "Number of non
-00015940: 2073 7465 6164 7920 7374 6174 6520 766f   steady state vo
-00015950: 6c75 6d65 7322 0a0a 2020 2020 2020 2020  lumes"..        
-00015960: 2320 496e 7075 7473 2074 7261 6974 730a  # Inputs traits.
-00015970: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00015980: 5f74 7261 6974 280a 2020 2020 2020 2020  _trait(.        
-00015990: 2020 2020 2269 6e5f 6669 6c65 222c 2046      "in_file", F
-000159a0: 696c 6528 6f75 7470 7574 3d46 616c 7365  ile(output=False
-000159b0: 2c20 6f70 7469 6f6e 616c 3d46 616c 7365  , optional=False
-000159c0: 2c20 6465 7363 3d69 6e5f 6669 6c65 5f64  , desc=in_file_d
-000159d0: 6573 6329 0a20 2020 2020 2020 2029 0a0a  esc).        )..
-000159e0: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
-000159f0: 7320 7472 6169 7473 0a20 2020 2020 2020  s traits.       
-00015a00: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
-00015a10: 0a20 2020 2020 2020 2020 2020 2022 6e5f  .            "n_
-00015a20: 766f 6c75 6d65 735f 746f 5f64 6973 6361  volumes_to_disca
-00015a30: 7264 222c 0a20 2020 2020 2020 2020 2020  rd",.           
-00015a40: 2074 7261 6974 732e 496e 7428 6f75 7470   traits.Int(outp
-00015a50: 7574 3d54 7275 652c 2064 6573 633d 6e5f  ut=True, desc=n_
-00015a60: 766f 6c75 6d65 735f 746f 5f64 6973 6361  volumes_to_disca
-00015a70: 7264 5f64 6573 6329 2c0a 2020 2020 2020  rd_desc),.      
-00015a80: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00015a90: 662e 696e 6974 5f64 6566 6175 6c74 5f74  f.init_default_t
-00015aa0: 7261 6974 7328 290a 0a20 2020 2064 6566  raits()..    def
-00015ab0: 206c 6973 745f 6f75 7470 7574 7328 7365   list_outputs(se
-00015ac0: 6c66 2c20 6973 5f70 6c75 6767 6564 3d4e  lf, is_plugged=N
-00015ad0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00015ae0: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
-00015af0: 6520 696e 6974 6961 6c69 7361 7469 6f6e  e initialisation
-00015b00: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
-00015b10: 636b 2e0a 0a20 2020 2020 2020 2054 6865  ck...        The
-00015b20: 206d 6169 6e20 6f62 6a65 6374 6976 6520   main objective 
-00015b30: 6f66 2074 6869 7320 6d65 7468 6f64 2069  of this method i
-00015b40: 7320 746f 2070 726f 6475 6365 2074 6865  s to produce the
-00015b50: 206f 7574 7075 7473 206f 6620 7468 650a   outputs of the.
-00015b60: 2020 2020 2020 2020 6272 6963 6b73 2028          bricks (
-00015b70: 7365 6c66 2e6f 7574 7075 7473 2920 616e  self.outputs) an
-00015b80: 6420 7468 6520 6173 736f 6369 6174 6564  d the associated
-00015b90: 2074 6167 7320 2873 656c 662e 696e 6865   tags (self.inhe
-00015ba0: 7269 7461 6e63 655f 6469 6329 2c0a 2020  ritance_dic),.  
-00015bb0: 2020 2020 2020 6966 2064 6566 696e 6564        if defined
-00015bc0: 2068 6572 652e 2054 6f20 776f 726b 2070   here. To work p
-00015bd0: 726f 7065 726c 7920 7468 6973 206d 6574  roperly this met
-00015be0: 686f 6420 6d75 7374 2072 6574 7572 6e0a  hod must return.
-00015bf0: 2020 2020 2020 2020 7365 6c66 2e6d 616b          self.mak
-00015c00: 655f 696e 6974 5265 7375 6c74 2829 206f  e_initResult() o
-00015c10: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
-00015c20: 3a70 6172 616d 2069 735f 706c 7567 6765  :param is_plugge
-00015c30: 643a 2074 6865 2073 7461 7465 2c20 6c69  d: the state, li
-00015c40: 6e6b 6564 206f 7220 6e6f 742c 206f 6620  nked or not, of 
-00015c50: 7468 6520 706c 7567 732e 0a20 2020 2020  the plugs..     
-00015c60: 2020 203a 7265 7475 726e 733a 2061 2064     :returns: a d
-00015c70: 6963 7469 6f6e 6172 7920 7769 7468 2072  ictionary with r
-00015c80: 6571 7569 7265 6d65 6e74 2c20 6f75 7470  equirement, outp
-00015c90: 7574 7320 616e 6420 696e 6865 7269 7461  uts and inherita
-00015ca0: 6e63 655f 6469 6374 2e0a 2020 2020 2020  nce_dict..      
-00015cb0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-00015cc0: 5573 696e 6720 7468 6520 696e 6865 7269  Using the inheri
-00015cd0: 7461 6e63 6520 746f 2050 726f 6365 7373  tance to Process
-00015ce0: 4d49 4120 636c 6173 732c 206c 6973 745f  MIA class, list_
-00015cf0: 6f75 7470 7574 7320 6d65 7468 6f64 0a20  outputs method. 
-00015d00: 2020 2020 2020 2073 7570 6572 284e 6f6e         super(Non
-00015d10: 5374 6561 6479 5374 6174 6544 6574 6563  SteadyStateDetec
-00015d20: 746f 722c 2073 656c 6629 2e6c 6973 745f  tor, self).list_
-00015d30: 6f75 7470 7574 7328 290a 0a20 2020 2020  outputs()..     
-00015d40: 2020 2023 204f 7574 7075 7473 2064 6566     # Outputs def
-00015d50: 696e 6974 696f 6e0a 2020 2020 2020 2020  inition.        
-00015d60: 6966 2073 656c 662e 696e 5f66 696c 653a  if self.in_file:
-00015d70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00015d80: 662e 6f75 7470 7574 735b 226e 5f76 6f6c  f.outputs["n_vol
-00015d90: 756d 6573 5f74 6f5f 6469 7363 6172 6422  umes_to_discard"
-00015da0: 5d20 3d20 300a 0a20 2020 2020 2020 2023  ] = 0..        #
-00015db0: 2052 6574 7572 6e20 7468 6520 7265 7175   Return the requ
-00015dc0: 6972 656d 656e 742c 206f 7574 7075 7473  irement, outputs
-00015dd0: 2061 6e64 2069 6e68 6572 6974 616e 6365   and inheritance
-00015de0: 5f64 6963 740a 2020 2020 2020 2020 7265  _dict.        re
-00015df0: 7475 726e 2073 656c 662e 6d61 6b65 5f69  turn self.make_i
-00015e00: 6e69 7452 6573 756c 7428 290a 0a20 2020  nitResult()..   
-00015e10: 2064 6566 2072 756e 5f70 726f 6365 7373   def run_process
-00015e20: 5f6d 6961 2873 656c 6629 3a0a 2020 2020  _mia(self):.    
-00015e30: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
-00015e40: 2074 6f20 7468 6520 7072 6f63 6573 7320   to the process 
-00015e50: 6c61 756e 6368 2073 7465 7020 6f66 2074  launch step of t
-00015e60: 6865 2062 7269 636b 2e22 2222 0a20 2020  he brick.""".   
-00015e70: 2020 2020 2073 7570 6572 284e 6f6e 5374       super(NonSt
-00015e80: 6561 6479 5374 6174 6544 6574 6563 746f  eadyStateDetecto
-00015e90: 722c 2073 656c 6629 2e72 756e 5f70 726f  r, self).run_pro
-00015ea0: 6365 7373 5f6d 6961 2829 0a0a 2020 2020  cess_mia()..    
-00015eb0: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
-00015ec0: 7365 6c66 2e69 6e5f 6669 6c65 0a0a 2020  self.in_file..  
-00015ed0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00015ee0: 2020 2020 2020 2069 6e5f 6e69 6920 3d20         in_nii = 
-00015ef0: 6e69 622e 6c6f 6164 2866 696c 655f 6e61  nib.load(file_na
-00015f00: 6d65 290a 2020 2020 2020 2020 6578 6365  me).        exce
-00015f10: 7074 2028 0a20 2020 2020 2020 2020 2020  pt (.           
-00015f20: 206e 6962 2e66 696c 6562 6173 6564 696d   nib.filebasedim
-00015f30: 6167 6573 2e49 6d61 6765 4669 6c65 4572  ages.ImageFileEr
-00015f40: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
-00015f50: 2046 696c 654e 6f74 466f 756e 6445 7272   FileNotFoundErr
-00015f60: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00015f70: 5479 7065 4572 726f 722c 0a20 2020 2020  TypeError,.     
-00015f80: 2020 2029 2061 7320 653a 0a20 2020 2020     ) as e:.     
-00015f90: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-00015fa0: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-00015fb0: 6e4e 6f6e 5374 6561 6479 5374 6174 6544  nNonSteadyStateD
-00015fc0: 6574 6563 746f 7220 6272 6963 6b3a 2045  etector brick: E
-00015fd0: 7272 6f72 2077 6974 6820 6669 6c65 2074  rror with file t
-00015fe0: 6f20 656e 6861 6e63 652c 2022 0a20 2020  o enhance, ".   
-00015ff0: 2020 2020 2020 2020 2020 2020 2022 6475               "du
-00016000: 7269 6e67 2074 6865 2072 756e 3a20 222c  ring the run: ",
-00016010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016020: 2065 2c0a 2020 2020 2020 2020 2020 2020   e,.            
-00016030: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-00016040: 5f6e 6969 203d 204e 6f6e 650a 0a20 2020  _nii = None..   
-00016050: 2020 2020 2069 6620 696e 5f6e 6969 2069       if in_nii i
-00016060: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00016070: 2020 2020 2020 2020 676c 6f62 616c 5f73          global_s
-00016080: 6967 6e61 6c20 3d20 280a 2020 2020 2020  ignal = (.      
-00016090: 2020 2020 2020 2020 2020 696e 5f6e 6969            in_nii
-000160a0: 2e64 6174 616f 626a 5b3a 2c20 3a2c 203a  .dataobj[:, :, :
-000160b0: 2c20 3a35 305d 0a20 2020 2020 2020 2020  , :50].         
-000160c0: 2020 2020 2020 202e 6d65 616e 2861 7869         .mean(axi
-000160d0: 733d 3029 0a20 2020 2020 2020 2020 2020  s=0).           
-000160e0: 2020 2020 202e 6d65 616e 2861 7869 733d       .mean(axis=
-000160f0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00016100: 2020 202e 6d65 616e 2861 7869 733d 3029     .mean(axis=0)
-00016110: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00016120: 2020 2020 2020 2020 7365 6c66 2e6e 5f76          self.n_v
-00016130: 6f6c 756d 6573 5f74 6f5f 6469 7363 6172  olumes_to_discar
-00016140: 6420 3d20 6973 5f6f 7574 6c69 6572 2867  d = is_outlier(g
-00016150: 6c6f 6261 6c5f 7369 676e 616c 290a 0a0a  lobal_signal)...
-00016160: 636c 6173 7320 5265 7361 6d70 6c65 3128  class Resample1(
-00016170: 5072 6f63 6573 734d 4941 293a 0a20 2020  ProcessMIA):.   
-00016180: 2022 2222 0a20 2020 202a 5265 7361 6d70   """.    *Resamp
-00016190: 6c65 7320 616e 2069 6d61 6765 2074 6f20  les an image to 
-000161a0: 7468 6520 7265 736f 6c75 7469 6f6e 206f  the resolution o
-000161b0: 6620 6120 7265 6665 7265 6e63 6520 696d  f a reference im
-000161c0: 6167 652a 0a0a 2020 2020 2d20 5573 6573  age*..    - Uses
-000161d0: 206e 6962 6162 656c 2e70 726f 6365 7373   nibabel.process
-000161e0: 696e 672e 7265 7361 6d70 6c65 5f66 726f  ing.resample_fro
-000161f0: 6d5f 746f 2829 2e0a 0a20 2020 2050 6c65  m_to()...    Ple
-00016200: 6173 652c 2073 6565 2074 6865 2063 6f6d  ase, see the com
-00016210: 706c 6574 6520 646f 6375 6d65 6e74 6174  plete documentat
-00016220: 696f 6e20 666f 7220 7468 650a 2020 2020  ion for the.    
-00016230: 6052 6573 616d 706c 6531 2062 7269 636b  `Resample1 brick
-00016240: 2069 6e20 7468 6520 6d69 615f 7072 6f63   in the mia_proc
-00016250: 6573 7365 7320 7765 6273 6974 650a 2020  esses website.  
-00016260: 2020 3c68 7474 7073 3a2f 2f70 6f70 756c    <https://popul
-00016270: 7365 2e67 6974 6875 622e 696f 2f6d 6961  se.github.io/mia
-00016280: 5f70 726f 6365 7373 6573 2f68 746d 6c2f  _processes/html/
-00016290: 646f 6375 6d65 6e74 6174 696f 6e2f 6272  documentation/br
-000162a0: 6963 6b73 2f70 7265 7072 6f63 6573 732f  icks/preprocess/
-000162b0: 6f74 6865 722f 5265 7361 6d70 6c65 312e  other/Resample1.
-000162c0: 6874 6d6c 3e60 5f0a 0a20 2020 2022 2222  html>`_..    """
-000162d0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-000162e0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-000162f0: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
-00016300: 6f20 7468 6520 6174 7472 6962 7574 6573  o the attributes
-00016310: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
-00016320: 2f20 696e 7374 616e 7469 6174 696f 6e2e  / instantiation.
-00016330: 0a0a 2020 2020 2020 2020 5468 6520 696e  ..        The in
-00016340: 7075 7420 616e 6420 6f75 7470 7574 2070  put and output p
-00016350: 6c75 6773 2061 7265 2064 6566 696e 6564  lugs are defined
-00016360: 2068 6572 652e 2054 6865 2073 7065 6369   here. The speci
-00016370: 616c 0a20 2020 2020 2020 2027 7365 6c66  al.        'self
-00016380: 2e72 6571 7569 7265 6d65 6e74 2720 6174  .requirement' at
-00016390: 7472 6962 7574 6520 286f 7074 696f 6e61  tribute (optiona
-000163a0: 6c29 2069 7320 7573 6564 2074 6f20 6465  l) is used to de
-000163b0: 6669 6e65 2074 6865 0a20 2020 2020 2020  fine the.       
-000163c0: 2074 6869 7264 2d70 6172 7479 2070 726f   third-party pro
-000163d0: 6475 6374 7320 6e65 6365 7373 6172 7920  ducts necessary 
-000163e0: 666f 7220 7468 6520 7275 6e6e 696e 6720  for the running 
-000163f0: 6f66 2074 6865 2062 7269 636b 2e0a 2020  of the brick..  
-00016400: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016410: 2020 2320 496e 6974 6961 6c69 7361 7469    # Initialisati
-00016420: 6f6e 206f 6620 7468 6520 6f62 6a65 6374  on of the object
-00016430: 7320 6e65 6564 6564 2066 6f72 2074 6865  s needed for the
-00016440: 206c 6175 6e63 6820 6f66 2074 6865 2062   launch of the b
-00016450: 7269 636b 0a20 2020 2020 2020 2073 7570  rick.        sup
-00016460: 6572 2852 6573 616d 706c 6531 2c20 7365  er(Resample1, se
-00016470: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a0a  lf).__init__()..
-00016480: 2020 2020 2020 2020 2320 5468 6972 6420          # Third 
-00016490: 7061 7274 7920 736f 6674 7761 7265 7320  party softwares 
-000164a0: 7265 7175 6972 6564 2066 6f72 2074 6865  required for the
-000164b0: 2065 7865 6375 7469 6f6e 206f 6620 7468   execution of th
-000164c0: 6520 6272 6963 6b0a 2020 2020 2020 2020  e brick.        
-000164d0: 7365 6c66 2e72 6571 7569 7265 6d65 6e74  self.requirement
-000164e0: 203d 205b 5d0a 0a20 2020 2020 2020 2023   = []..        #
-000164f0: 2049 6e70 7574 7320 6465 7363 7269 7074   Inputs descript
-00016500: 696f 6e0a 2020 2020 2020 2020 6669 6c65  ion.        file
-00016510: 735f 746f 5f72 6573 616d 706c 655f 6465  s_to_resample_de
-00016520: 7363 203d 2028 0a20 2020 2020 2020 2020  sc = (.         
-00016530: 2020 2022 5468 6520 3344 2069 6d61 6765     "The 3D image
-00016540: 7320 7468 6174 2077 696c 6c20 6265 2072  s that will be r
-00016550: 6573 616d 706c 6564 2028 6120 220a 2020  esampled (a ".  
-00016560: 2020 2020 2020 2020 2020 226c 6973 7420            "list 
-00016570: 6f66 2070 6174 686c 696b 6520 6f62 6a65  of pathlike obje
-00016580: 6374 206f 7220 7374 7269 6e67 2022 0a20  ct or string ". 
-00016590: 2020 2020 2020 2020 2020 2022 7265 7072             "repr
-000165a0: 6573 656e 7469 6e67 2061 2066 696c 6520  esenting a file 
-000165b0: 6f72 2061 206c 6973 7420 6f66 2069 7465  or a list of ite
-000165c0: 6d73 2022 0a20 2020 2020 2020 2020 2020  ms ".           
-000165d0: 2022 7768 6963 6820 6172 6520 6120 7061   "which are a pa
-000165e0: 7468 6c69 6b65 206f 626a 6563 7420 6f72  thlike object or
-000165f0: 2073 7472 696e 6720 220a 2020 2020 2020   string ".      
-00016600: 2020 2020 2020 2272 6570 7265 7365 6e74        "represent
-00016610: 696e 6720 6120 6669 6c65 2c20 7661 6c69  ing a file, vali
-00016620: 6420 6578 7465 6e73 696f 6e73 3a20 220a  d extensions: ".
-00016630: 2020 2020 2020 2020 2020 2020 225b 2e69              "[.i
-00016640: 6d67 2c20 2e6e 6969 2c20 2e68 6472 5d29  mg, .nii, .hdr])
-00016650: 2e22 0a20 2020 2020 2020 2029 0a20 2020  .".        ).   
-00016660: 2020 2020 2072 6566 6572 656e 6365 5f69       reference_i
-00016670: 6d61 6765 5f64 6573 6320 3d20 280a 2020  mage_desc = (.  
-00016680: 2020 2020 2020 2020 2020 2241 2033 4420            "A 3D 
-00016690: 6f72 2034 4420 696d 6167 6520 7573 6564  or 4D image used
-000166a0: 2061 7320 7265 6665 7265 6e63 6520 746f   as reference to
-000166b0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-000166c0: 7265 7361 6d70 6c65 2074 6865 2066 696c  resample the fil
-000166d0: 6573 5f74 6f5f 7265 7361 6d70 6c65 2069  es_to_resample i
-000166e0: 6d61 6765 7320 2861 2022 0a20 2020 2020  mages (a ".     
-000166f0: 2020 2020 2020 2022 7061 7468 6c69 6b65         "pathlike
-00016700: 206f 626a 6563 7420 6f72 2073 7472 696e   object or strin
-00016710: 6720 7265 7072 6573 656e 7469 6e67 2061  g representing a
-00016720: 2066 696c 6520 220a 2020 2020 2020 2020   file ".        
-00016730: 2020 2020 2277 6974 6820 6578 7465 6e73      "with extens
-00016740: 696f 6e20 696e 205b 2e69 6d67 2c20 2e6e  ion in [.img, .n
-00016750: 6969 2c20 2e68 6472 5d29 2e22 0a20 2020  ii, .hdr]).".   
-00016760: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-00016770: 6e74 6572 705f 6465 7363 203d 2028 0a20  nterp_desc = (. 
-00016780: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
-00016790: 6f72 6465 7220 6f66 2074 6865 2073 706c  order of the spl
-000167a0: 696e 6520 696e 7465 7270 6f6c 6174 696f  ine interpolatio
-000167b0: 6e20 2861 6e20 696e 7465 6765 7220 220a  n (an integer ".
-000167c0: 2020 2020 2020 2020 2020 2020 2262 6574              "bet
-000167d0: 7765 656e 2030 2061 6e64 2035 3b20 7472  ween 0 and 5; tr
-000167e0: 696c 696e 6561 7220 3d3d 2033 292e 220a  ilinear == 3).".
-000167f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00016800: 2020 7072 6566 6978 5f64 6573 6320 3d20    prefix_desc = 
-00016810: 2254 6865 2070 7265 6669 7820 666f 7220  "The prefix for 
-00016820: 7468 6520 6f75 745f 6669 6c65 7320 696d  the out_files im
-00016830: 6167 6520 2861 2073 7472 696e 6729 2e22  age (a string)."
-00016840: 0a20 2020 2020 2020 2073 7566 6669 785f  .        suffix_
-00016850: 746f 5f64 656c 6574 655f 6465 7363 203d  to_delete_desc =
-00016860: 2028 0a20 2020 2020 2020 2020 2020 2022   (.            "
-00016870: 5468 6520 7375 6666 6978 2074 6f20 6465  The suffix to de
-00016880: 6c65 7465 2066 726f 6d20 7468 6520 220a  lete from the ".
-00016890: 2020 2020 2020 2020 2020 2020 2266 696c              "fil
-000168a0: 6573 5f74 6f5f 7265 7361 6d70 6c65 2c20  es_to_resample, 
-000168b0: 7768 656e 2063 7265 6174 696e 6720 7468  when creating th
-000168c0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-000168d0: 226f 7574 5f66 696c 6573 2028 6120 7374  "out_files (a st
-000168e0: 7269 6e67 292e 220a 2020 2020 2020 2020  ring).".        
-000168f0: 290a 2020 2020 2020 2020 7375 6666 6978  ).        suffix
-00016900: 5f64 6573 6320 3d20 2254 6865 2073 7566  _desc = "The suf
-00016910: 6669 7820 666f 7220 7468 6520 6f75 745f  fix for the out_
-00016920: 6669 6c65 7320 696d 6167 6520 2861 2073  files image (a s
-00016930: 7472 696e 6729 2e22 0a0a 2020 2020 2020  tring)."..      
-00016940: 2020 2320 4f75 7470 7574 7320 6465 7363    # Outputs desc
-00016950: 7269 7074 696f 6e0a 2020 2020 2020 2020  ription.        
-00016960: 6f75 745f 6669 6c65 735f 6465 7363 203d  out_files_desc =
-00016970: 2028 0a20 2020 2020 2020 2020 2020 2022   (.            "
-00016980: 5468 6520 7265 7375 6c74 696e 6720 696d  The resulting im
-00016990: 6167 6573 2061 6674 6572 2072 6573 616d  ages after resam
-000169a0: 706c 696e 6720 2861 2070 6174 686c 696b  pling (a pathlik
-000169b0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-000169c0: 226f 626a 6563 7420 6f72 2073 7472 696e  "object or strin
-000169d0: 6720 7265 7072 6573 656e 7469 6e67 2061  g representing a
-000169e0: 2066 696c 652c 206f 7220 6120 6c69 7374   file, or a list
-000169f0: 206f 6620 220a 2020 2020 2020 2020 2020   of ".          
-00016a00: 2020 2270 6174 686c 696b 6520 6f62 6a65    "pathlike obje
-00016a10: 6374 7320 6f72 2073 7472 696e 6773 2072  cts or strings r
-00016a20: 6570 7265 7365 6e74 696e 6720 6120 6669  epresenting a fi
-00016a30: 6c65 292e 220a 2020 2020 2020 2020 290a  le).".        ).
-00016a40: 0a20 2020 2020 2020 2023 2049 6e70 7574  .        # Input
-00016a50: 7320 7472 6169 7473 0a20 2020 2020 2020  s traits.       
-00016a60: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
-00016a70: 0a20 2020 2020 2020 2020 2020 2022 6669  .            "fi
-00016a80: 6c65 735f 746f 5f72 6573 616d 706c 6522  les_to_resample"
-00016a90: 2c0a 2020 2020 2020 2020 2020 2020 496e  ,.            In
-00016aa0: 7075 744d 756c 7469 5061 7468 280a 2020  putMultiPath(.  
-00016ab0: 2020 2020 2020 2020 2020 2020 2020 496d                Im
-00016ac0: 6167 6546 696c 6553 504d 2829 2c20 6f75  ageFileSPM(), ou
-00016ad0: 7470 7574 3d46 616c 7365 2c20 6465 7363  tput=False, desc
-00016ae0: 3d66 696c 6573 5f74 6f5f 7265 7361 6d70  =files_to_resamp
-00016af0: 6c65 5f64 6573 630a 2020 2020 2020 2020  le_desc.        
-00016b00: 2020 2020 292c 0a20 2020 2020 2020 2029      ),.        )
-00016b10: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00016b20: 6464 5f74 7261 6974 280a 2020 2020 2020  dd_trait(.      
-00016b30: 2020 2020 2020 2272 6566 6572 656e 6365        "reference
-00016b40: 5f69 6d61 6765 222c 0a20 2020 2020 2020  _image",.       
-00016b50: 2020 2020 2049 6d61 6765 4669 6c65 5350       ImageFileSP
-00016b60: 4d28 6f75 7470 7574 3d46 616c 7365 2c20  M(output=False, 
-00016b70: 6465 7363 3d72 6566 6572 656e 6365 5f69  desc=reference_i
-00016b80: 6d61 6765 5f64 6573 6329 2c0a 2020 2020  mage_desc),.    
-00016b90: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-00016ba0: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-00016bb0: 2020 2020 2020 2020 2020 2022 696e 7465             "inte
-00016bc0: 7270 222c 0a20 2020 2020 2020 2020 2020  rp",.           
-00016bd0: 2074 7261 6974 732e 5261 6e67 6528 0a20   traits.Range(. 
-00016be0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00016bf0: 616c 7565 3d33 2c0a 2020 2020 2020 2020  alue=3,.        
-00016c00: 2020 2020 2020 2020 6c6f 773d 302c 0a20          low=0,. 
-00016c10: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00016c20: 6967 683d 352c 0a20 2020 2020 2020 2020  igh=5,.         
-00016c30: 2020 2020 2020 206f 7574 7075 743d 4661         output=Fa
-00016c40: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00016c50: 2020 2020 206f 7074 696f 6e61 6c3d 5472       optional=Tr
-00016c60: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00016c70: 2020 2020 6465 7363 3d69 6e74 6572 705f      desc=interp_
-00016c80: 6465 7363 2c0a 2020 2020 2020 2020 2020  desc,.          
-00016c90: 2020 292c 0a20 2020 2020 2020 2029 0a0a    ),.        )..
-00016ca0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00016cb0: 5f74 7261 6974 280a 2020 2020 2020 2020  _trait(.        
-00016cc0: 2020 2020 2270 7265 6669 7822 2c0a 2020      "prefix",.  
-00016cd0: 2020 2020 2020 2020 2020 7472 6169 7473            traits
-00016ce0: 2e53 7472 696e 6728 2220 222c 206f 7574  .String(" ", out
-00016cf0: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
-00016d00: 6e61 6c3d 5472 7565 2c20 6465 7363 3d70  nal=True, desc=p
-00016d10: 7265 6669 785f 6465 7363 292c 0a20 2020  refix_desc),.   
-00016d20: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00016d30: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
-00016d40: 2020 2020 2020 2020 2020 2020 2273 7566              "suf
-00016d50: 6669 785f 746f 5f64 656c 6574 6522 2c0a  fix_to_delete",.
-00016d60: 2020 2020 2020 2020 2020 2020 7472 6169              trai
-00016d70: 7473 2e53 7472 696e 6728 0a20 2020 2020  ts.String(.     
-00016d80: 2020 2020 2020 2020 2020 2022 5f30 3032             "_002
-00016d90: 222c 206f 7574 7075 743d 4661 6c73 652c  ", output=False,
-00016da0: 206f 7074 696f 6e61 6c3d 5472 7565 2c20   optional=True, 
-00016db0: 6465 7363 3d73 7566 6669 785f 746f 5f64  desc=suffix_to_d
-00016dc0: 656c 6574 655f 6465 7363 0a20 2020 2020  elete_desc.     
-00016dd0: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00016de0: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00016df0: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-00016e00: 2020 2020 2020 2020 2022 7375 6666 6978           "suffix
-00016e10: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
-00016e20: 7261 6974 732e 5374 7269 6e67 280a 2020  raits.String(.  
-00016e30: 2020 2020 2020 2020 2020 2020 2020 225f                "_
-00016e40: 3030 3322 2c20 6f75 7470 7574 3d46 616c  003", output=Fal
-00016e50: 7365 2c20 6f70 7469 6f6e 616c 3d54 7275  se, optional=Tru
-00016e60: 652c 2064 6573 633d 7375 6666 6978 5f64  e, desc=suffix_d
-00016e70: 6573 630a 2020 2020 2020 2020 2020 2020  esc.            
-00016e80: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-00016e90: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
-00016ea0: 7472 6169 7473 0a20 2020 2020 2020 2073  traits.        s
-00016eb0: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-00016ec0: 2020 2020 2020 2020 2020 2022 6f75 745f             "out_
-00016ed0: 6669 6c65 7322 2c0a 2020 2020 2020 2020  files",.        
-00016ee0: 2020 2020 4f75 7470 7574 4d75 6c74 6950      OutputMultiP
-00016ef0: 6174 6828 4669 6c65 2829 2c20 6f75 7470  ath(File(), outp
-00016f00: 7574 3d54 7275 652c 2064 6573 633d 6f75  ut=True, desc=ou
-00016f10: 745f 6669 6c65 735f 6465 7363 292c 0a20  t_files_desc),. 
-00016f20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00016f30: 2020 7365 6c66 2e69 6e69 745f 6465 6661    self.init_defa
-00016f40: 756c 745f 7472 6169 7473 2829 0a0a 2020  ult_traits()..  
-00016f50: 2020 6465 6620 6c69 7374 5f6f 7574 7075    def list_outpu
-00016f60: 7473 2873 656c 662c 2069 735f 706c 7567  ts(self, is_plug
-00016f70: 6765 643d 4e6f 6e65 293a 0a20 2020 2020  ged=None):.     
-00016f80: 2020 2022 2222 4465 6469 6361 7465 6420     """Dedicated 
-00016f90: 746f 2074 6865 2069 6e69 7469 616c 6973  to the initialis
-00016fa0: 6174 696f 6e20 7374 6570 206f 6620 7468  ation step of th
-00016fb0: 6520 6272 6963 6b2e 0a0a 2020 2020 2020  e brick...      
-00016fc0: 2020 5468 6520 6d61 696e 206f 626a 6563    The main objec
-00016fd0: 7469 7665 206f 6620 7468 6973 206d 6574  tive of this met
-00016fe0: 686f 6420 6973 2074 6f20 7072 6f64 7563  hod is to produc
-00016ff0: 6520 7468 6520 6f75 7470 7574 7320 6f66  e the outputs of
-00017000: 2074 6865 0a20 2020 2020 2020 2062 7269   the.        bri
-00017010: 636b 7320 2873 656c 662e 6f75 7470 7574  cks (self.output
-00017020: 7329 2061 6e64 2074 6865 2061 7373 6f63  s) and the assoc
-00017030: 6961 7465 6420 7461 6773 2028 7365 6c66  iated tags (self
-00017040: 2e69 6e68 6572 6974 616e 6365 5f64 6963  .inheritance_dic
-00017050: 292c 0a20 2020 2020 2020 2069 6620 6465  ),.        if de
-00017060: 6669 6e65 6420 6865 7265 2e20 546f 2077  fined here. To w
-00017070: 6f72 6b20 7072 6f70 6572 6c79 2074 6869  ork properly thi
-00017080: 7320 6d65 7468 6f64 206d 7573 7420 7265  s method must re
-00017090: 7475 726e 0a20 2020 2020 2020 2073 656c  turn.        sel
-000170a0: 662e 6d61 6b65 5f69 6e69 7452 6573 756c  f.make_initResul
-000170b0: 7428 2920 6f62 6a65 6374 2e0a 0a20 2020  t() object...   
-000170c0: 2020 2020 203a 7061 7261 6d20 6973 5f70       :param is_p
-000170d0: 6c75 6767 6564 3a20 7468 6520 7374 6174  lugged: the stat
-000170e0: 652c 206c 696e 6b65 6420 6f72 206e 6f74  e, linked or not
-000170f0: 2c20 6f66 2074 6865 2070 6c75 6773 2e0a  , of the plugs..
-00017100: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
-00017110: 3a20 6120 6469 6374 696f 6e61 7279 2077  : a dictionary w
-00017120: 6974 6820 7265 7175 6972 656d 656e 742c  ith requirement,
-00017130: 206f 7574 7075 7473 2061 6e64 2069 6e68   outputs and inh
-00017140: 6572 6974 616e 6365 5f64 6963 742e 0a20  eritance_dict.. 
-00017150: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00017160: 2020 2023 2055 7369 6e67 2074 6865 2069     # Using the i
-00017170: 6e68 6572 6974 616e 6365 2074 6f20 5072  nheritance to Pr
-00017180: 6f63 6573 734d 4941 2063 6c61 7373 2c20  ocessMIA class, 
-00017190: 6c69 7374 5f6f 7574 7075 7473 206d 6574  list_outputs met
-000171a0: 686f 640a 2020 2020 2020 2020 7375 7065  hod.        supe
-000171b0: 7228 5265 7361 6d70 6c65 312c 2073 656c  r(Resample1, sel
-000171c0: 6629 2e6c 6973 745f 6f75 7470 7574 7328  f).list_outputs(
-000171d0: 290a 0a20 2020 2020 2020 2023 204f 7574  )..        # Out
-000171e0: 7075 7473 2064 6566 696e 6974 696f 6e0a  puts definition.
-000171f0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00017200: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-00017210: 6665 7265 6e63 655f 696d 6167 6520 213d  ference_image !=
-00017220: 2055 6e64 6566 696e 6564 0a20 2020 2020   Undefined.     
-00017230: 2020 2020 2020 2061 6e64 2073 656c 662e         and self.
-00017240: 6669 6c65 735f 746f 5f72 6573 616d 706c  files_to_resampl
-00017250: 6520 213d 2055 6e64 6566 696e 6564 0a20  e != Undefined. 
-00017260: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
-00017270: 656c 662e 696e 7465 7270 2021 3d20 556e  elf.interp != Un
-00017280: 6465 6669 6e65 640a 2020 2020 2020 2020  defined.        
-00017290: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-000172a0: 696c 6573 203d 205b 5d0a 2020 2020 2020  iles = [].      
-000172b0: 2020 2020 2020 6669 6c65 735f 6e61 6d65        files_name
-000172c0: 203d 2073 656c 662e 6669 6c65 735f 746f   = self.files_to
-000172d0: 5f72 6573 616d 706c 650a 0a20 2020 2020  _resample..     
-000172e0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000172f0: 2020 2020 2020 2020 2020 2020 7265 664e              refN
-00017300: 616d 6520 3d20 6e69 622e 6c6f 6164 2873  ame = nib.load(s
-00017310: 656c 662e 7265 6665 7265 6e63 655f 696d  elf.reference_im
-00017320: 6167 6529 0a0a 2020 2020 2020 2020 2020  age)..          
-00017330: 2020 6578 6365 7074 2028 0a20 2020 2020    except (.     
-00017340: 2020 2020 2020 2020 2020 206e 6962 2e66             nib.f
-00017350: 696c 6562 6173 6564 696d 6167 6573 2e49  ilebasedimages.I
-00017360: 6d61 6765 4669 6c65 4572 726f 722c 0a20  mageFileError,. 
-00017370: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-00017380: 696c 654e 6f74 466f 756e 6445 7272 6f72  ileNotFoundError
-00017390: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000173a0: 2020 5479 7065 4572 726f 722c 0a20 2020    TypeError,.   
-000173b0: 2020 2020 2020 2020 2029 2061 7320 653a           ) as e:
-000173c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000173d0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-000173e0: 2020 2020 2020 2020 2020 2020 225c 6e52              "\nR
-000173f0: 6573 616d 706c 6531 2062 7269 636b 3a20  esample1 brick: 
-00017400: 4572 726f 7220 7769 7468 2072 6566 6572  Error with refer
-00017410: 656e 6365 5f69 6d61 6765 2c20 6475 7269  ence_image, duri
-00017420: 6e67 2022 0a20 2020 2020 2020 2020 2020  ng ".           
-00017430: 2020 2020 2020 2020 2022 696e 6974 6961           "initia
-00017440: 6c69 7361 7469 6f6e 3a20 222c 0a20 2020  lisation: ",.   
-00017450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017460: 2065 2c0a 2020 2020 2020 2020 2020 2020   e,.            
-00017470: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00017480: 2020 2020 2020 7265 664e 616d 6520 3d20        refName = 
-00017490: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
-000174a0: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-000174b0: 2020 2020 2020 2028 6e6f 7420 7365 6c66         (not self
-000174c0: 2e73 7566 6669 785f 746f 5f64 656c 6574  .suffix_to_delet
-000174d0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000174e0: 2020 206f 7220 2873 656c 662e 7375 6666     or (self.suff
-000174f0: 6978 5f74 6f5f 6465 6c65 7465 2e69 7373  ix_to_delete.iss
-00017500: 7061 6365 2829 290a 2020 2020 2020 2020  pace()).        
-00017510: 2020 2020 2020 2020 6f72 2028 7365 6c66          or (self
-00017520: 2e73 7566 6669 785f 746f 5f64 656c 6574  .suffix_to_delet
-00017530: 6520 696e 205b 556e 6465 6669 6e65 642c  e in [Undefined,
-00017540: 2022 3c75 6e64 6566 696e 6564 3e22 5d29   "<undefined>"])
-00017550: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-00017560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017570: 7365 6c66 2e73 7566 6669 785f 746f 5f64  self.suffix_to_d
-00017580: 656c 6574 6520 3d20 2220 220a 0a20 2020  elete = " "..   
-00017590: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
-000175a0: 2020 2020 2020 2020 2020 2020 2020 286e                (n
-000175b0: 6f74 2073 656c 662e 7375 6666 6978 290a  ot self.suffix).
-000175c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175d0: 6f72 2028 7365 6c66 2e73 7566 6669 782e  or (self.suffix.
-000175e0: 6973 7370 6163 6528 2929 0a20 2020 2020  isspace()).     
-000175f0: 2020 2020 2020 2020 2020 206f 7220 2873             or (s
-00017600: 656c 662e 7375 6666 6978 2069 6e20 5b55  elf.suffix in [U
-00017610: 6e64 6566 696e 6564 2c20 223c 756e 6465  ndefined, "<unde
-00017620: 6669 6e65 643e 225d 290a 2020 2020 2020  fined>"]).      
-00017630: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00017640: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
-00017650: 6666 6978 203d 2022 2022 0a0a 2020 2020  ffix = " "..    
-00017660: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00017670: 2020 2020 2020 2020 2020 2020 2028 6e6f               (no
-00017680: 7420 7365 6c66 2e70 7265 6669 7829 0a20  t self.prefix). 
-00017690: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000176a0: 7220 2873 656c 662e 7072 6566 6978 2e69  r (self.prefix.i
-000176b0: 7373 7061 6365 2829 290a 2020 2020 2020  sspace()).      
-000176c0: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
-000176d0: 6c66 2e70 7265 6669 7820 696e 205b 556e  lf.prefix in [Un
-000176e0: 6465 6669 6e65 642c 2022 3c75 6e64 6566  defined, "<undef
-000176f0: 696e 6564 3e22 5d29 0a20 2020 2020 2020  ined>"]).       
-00017700: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00017710: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-00017720: 6669 7820 3d20 2220 220a 0a20 2020 2020  fix = " "..     
-00017730: 2020 2020 2020 2066 6f72 2066 696c 655f         for file_
-00017740: 6e61 6d65 2069 6e20 6669 6c65 735f 6e61  name in files_na
-00017750: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-00017760: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00017770: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00017780: 654e 616d 6520 3d20 6e69 622e 6c6f 6164  eName = nib.load
-00017790: 2866 696c 655f 6e61 6d65 290a 0a20 2020  (file_name)..   
-000177a0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000177b0: 6570 7420 280a 2020 2020 2020 2020 2020  ept (.          
-000177c0: 2020 2020 2020 2020 2020 6e69 622e 6669            nib.fi
-000177d0: 6c65 6261 7365 6469 6d61 6765 732e 496d  lebasedimages.Im
-000177e0: 6167 6546 696c 6545 7272 6f72 2c0a 2020  ageFileError,.  
-000177f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017800: 2020 4669 6c65 4e6f 7446 6f75 6e64 4572    FileNotFoundEr
-00017810: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
-00017820: 2020 2020 2020 2020 2054 7970 6545 7272           TypeErr
-00017830: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00017840: 2020 2020 2920 6173 2065 3a0a 2020 2020      ) as e:.    
-00017850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017860: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00017870: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00017880: 5c6e 5265 7361 6d70 6c65 3120 6272 6963  \nResample1 bric
-00017890: 6b3a 2045 7272 6f72 2077 6974 6820 6669  k: Error with fi
-000178a0: 6c65 735f 746f 5f72 6573 616d 706c 652c  les_to_resample,
-000178b0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000178c0: 2020 2020 2020 2020 2020 2022 6475 7269             "duri
-000178d0: 6e67 2069 6e69 7469 616c 6973 6174 696f  ng initialisatio
-000178e0: 6e3a 2022 2c0a 2020 2020 2020 2020 2020  n: ",.          
-000178f0: 2020 2020 2020 2020 2020 2020 2020 652c                e,
-00017900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017910: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00017920: 2020 2020 2020 2020 2020 2066 696c 654e             fileN
-00017930: 616d 6520 3d20 4e6f 6e65 0a0a 2020 2020  ame = None..    
-00017940: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00017950: 7265 664e 616d 6529 2061 6e64 2028 6669  refName) and (fi
-00017960: 6c65 4e61 6d65 293a 0a20 2020 2020 2020  leName):.       
-00017970: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017980: 286c 656e 2866 696c 654e 616d 652e 7368  (len(fileName.sh
-00017990: 6170 6529 2021 3d20 3329 206f 7220 280a  ape) != 3) or (.
-000179a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179b0: 2020 2020 2020 2020 3320 3e20 6c65 6e28          3 > len(
-000179c0: 7265 664e 616d 652e 7368 6170 6529 203e  refName.shape) >
-000179d0: 2034 0a20 2020 2020 2020 2020 2020 2020   4.             
-000179e0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-000179f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a00: 2020 6d73 6720 3d20 514d 6573 7361 6765    msg = QMessage
-00017a10: 426f 7828 290a 2020 2020 2020 2020 2020  Box().          
-00017a20: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-00017a30: 672e 7365 7449 636f 6e28 514d 6573 7361  g.setIcon(QMessa
-00017a40: 6765 426f 782e 5761 726e 696e 6729 0a20  geBox.Warning). 
-00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a60: 2020 2020 2020 206d 7367 2e73 6574 5769         msg.setWi
-00017a70: 6e64 6f77 5469 746c 6528 0a20 2020 2020  ndowTitle(.     
-00017a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a90: 2020 2020 2020 2022 6d69 615f 7072 6f63         "mia_proc
-00017aa0: 6573 7365 7320 2d20 5265 7361 6d70 6c65  esses - Resample
-00017ab0: 3120 6272 6963 6b20 5761 726e 696e 6721  1 brick Warning!
-00017ac0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00017ad0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00017ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017af0: 2020 2020 6d73 672e 7365 7454 6578 7428      msg.setText(
-00017b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017b10: 2020 2020 2020 2020 2020 2020 2022 4375               "Cu
-00017b20: 7272 656e 746c 792c 2074 6865 2052 6573  rrently, the Res
-00017b30: 616d 706c 6531 2062 7269 636b 206f 6e6c  ample1 brick onl
-00017b40: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
+00012150: 2020 225c 6e47 7261 6469 656e 7454 6872    "\nGradientThr
+00012160: 6573 686f 6c64 2062 7269 636b 2077 6172  eshold brick war
+00012170: 6e69 6e67 3a20 7468 6520 6f75 745f 6669  ning: the out_fi
+00012180: 6c65 220a 2020 2020 2020 2020 2020 2020  le".            
+00012190: 2020 2020 2020 2020 2020 2020 226f 7574              "out
+000121a0: 7075 7420 7061 7261 6d65 7465 7220 6973  put parameter is
+000121b0: 2074 6865 2073 616d 6520 6173 2074 6865   the same as the
+000121c0: 2069 6e5f 6669 6c65 2069 6e70 7574 2022   in_file input "
+000121d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000121e0: 2020 2020 2020 2020 2022 7061 7261 6d65           "parame
+000121f0: 7465 7220 2873 7566 6669 7820 616e 6420  ter (suffix and 
+00012200: 7072 6566 6978 2061 7265 206e 6f74 2064  prefix are not d
+00012210: 6566 696e 6564 293a 220a 2020 2020 2020  efined):".      
+00012220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012230: 2020 225c 6e7b 307d 2077 696c 6c20 6265    "\n{0} will be
+00012240: 206f 7665 7277 7269 7474 656e 202e 2e2e   overwritten ...
+00012250: 222e 666f 726d 6174 2866 696c 654e 616d  ".format(fileNam
+00012260: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00012270: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00012280: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00012290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122a0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+000122b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122c0: 2020 2022 5c6e 4772 6164 6965 6e74 5468     "\nGradientTh
+000122d0: 7265 7368 6f6c 6420 6272 6963 6b20 4162  reshold brick Ab
+000122e0: 6f72 7465 642e 2050 6c65 6173 6520 6368  orted. Please ch
+000122f0: 6563 6b20 220a 2020 2020 2020 2020 2020  eck ".          
+00012300: 2020 2020 2020 2020 2020 2020 2020 2279                "y
+00012310: 6f75 7220 696e 7075 7420 7061 7261 6d65  our input parame
+00012320: 7465 7273 202e 2e2e 220a 2020 2020 2020  ters ...".      
+00012330: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00012340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012350: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00012360: 2020 2020 2020 2020 6669 6c65 203d 206f          file = o
+00012370: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+00012380: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012390: 662e 6f75 7470 7574 5f64 6972 6563 746f  f.output_directo
+000123a0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+000123b0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+000123c0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000123d0: 7265 6669 782e 7374 7269 7028 290a 2020  refix.strip().  
+000123e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123f0: 2020 2b20 6669 6c65 4e61 6d65 0a20 2020    + fileName.   
+00012400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012410: 202b 2073 656c 662e 7375 6666 6978 2e73   + self.suffix.s
+00012420: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+00012430: 2020 2020 2020 2020 2020 202b 2022 2e22             + "."
+00012440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012450: 2020 2020 202b 2069 6e5f 6578 740a 2020       + in_ext.  
+00012460: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00012470: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00012480: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00012490: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+000124a0: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
+000124b0: 735b 226f 7574 5f66 696c 6522 5d20 3d20  s["out_file"] = 
+000124c0: 6669 6c65 0a0a 2020 2020 2020 2020 2020  file..          
+000124d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000124e0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+000124f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012500: 2020 2022 2d20 4772 6164 6965 6e74 5468     "- GradientTh
+00012510: 7265 7368 6f6c 6420 6272 6963 6b3a 2054  reshold brick: T
+00012520: 6865 7265 2077 6173 206e 6f20 6f75 7470  here was no outp
+00012530: 7574 2066 696c 6520 220a 2020 2020 2020  ut file ".      
+00012540: 2020 2020 2020 2020 2020 2020 2020 2264                "d
+00012550: 6564 7563 7465 6420 6475 7269 6e67 2069  educted during i
+00012560: 6e69 7469 616c 697a 6174 696f 6e2e 2050  nitialization. P
+00012570: 6c65 6173 6520 6368 6563 6b20 7468 6520  lease check the 
+00012580: 696e 7075 7420 220a 2020 2020 2020 2020  input ".        
+00012590: 2020 2020 2020 2020 2020 2020 2270 6172              "par
+000125a0: 616d 6574 6572 732e 2e2e 2122 0a20 2020  ameters...!".   
+000125b0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+000125c0: 2020 2020 2020 2020 2020 2020 2320 7461              # ta
+000125d0: 6773 2069 6e68 6572 6974 616e 6365 2028  gs inheritance (
+000125e0: 6f70 7469 6f6e 616c 290a 2020 2020 2020  optional).      
+000125f0: 2020 2020 2020 6966 2073 656c 662e 6f75        if self.ou
+00012600: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
+00012610: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00012620: 2020 2073 656c 662e 7461 6773 5f69 6e68     self.tags_inh
+00012630: 6572 6974 616e 6365 280a 2020 2020 2020  eritance(.      
+00012640: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00012650: 5f66 696c 653d 7365 6c66 2e69 6e5f 6669  _file=self.in_fi
+00012660: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00012670: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
+00012680: 3d73 656c 662e 6f75 7470 7574 735b 226f  =self.outputs["o
+00012690: 7574 5f66 696c 6522 5d2c 0a20 2020 2020  ut_file"],.     
+000126a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000126b0: 2020 2020 2020 2320 5265 7475 726e 2074        # Return t
+000126c0: 6865 2072 6571 7569 7265 6d65 6e74 2c20  he requirement, 
+000126d0: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
+000126e0: 7269 7461 6e63 655f 6469 6374 0a20 2020  ritance_dict.   
+000126f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00012700: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
+00012710: 2829 0a0a 2020 2020 6465 6620 7275 6e5f  ()..    def run_
+00012720: 7072 6f63 6573 735f 6d69 6128 7365 6c66  process_mia(self
+00012730: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
+00012740: 6469 6361 7465 6420 746f 2074 6865 2070  dicated to the p
+00012750: 726f 6365 7373 206c 6175 6e63 6820 7374  rocess launch st
+00012760: 6570 206f 6620 7468 6520 6272 6963 6b2e  ep of the brick.
+00012770: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
+00012780: 7228 4772 6164 6965 6e74 5468 7265 7368  r(GradientThresh
+00012790: 6f6c 642c 2073 656c 6629 2e72 756e 5f70  old, self).run_p
+000127a0: 726f 6365 7373 5f6d 6961 2829 0a0a 2020  rocess_mia()..  
+000127b0: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
+000127c0: 3d20 7365 6c66 2e69 6e5f 6669 6c65 0a20  = self.in_file. 
+000127d0: 2020 2020 2020 2073 6567 5f66 696c 655f         seg_file_
+000127e0: 6e61 6d65 203d 2073 656c 662e 7365 675f  name = self.seg_
+000127f0: 6669 6c65 0a0a 2020 2020 2020 2020 2320  file..        # 
+00012800: 496d 6167 6520 7072 6f63 6573 7369 6e67  Image processing
+00012810: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00012820: 2020 2020 2020 2020 2020 696d 6720 3d20            img = 
+00012830: 6e69 622e 6c6f 6164 2866 696c 655f 6e61  nib.load(file_na
+00012840: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00012850: 7365 675f 696d 6720 3d20 6e69 622e 6c6f  seg_img = nib.lo
+00012860: 6164 2873 6567 5f66 696c 655f 6e61 6d65  ad(seg_file_name
+00012870: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
+00012880: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
+00012890: 6e69 622e 6669 6c65 6261 7365 6469 6d61  nib.filebasedima
+000128a0: 6765 732e 496d 6167 6546 696c 6545 7272  ges.ImageFileErr
+000128b0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+000128c0: 4669 6c65 4e6f 7446 6f75 6e64 4572 726f  FileNotFoundErro
+000128d0: 722c 0a20 2020 2020 2020 2020 2020 2054  r,.            T
+000128e0: 7970 6545 7272 6f72 2c0a 2020 2020 2020  ypeError,.      
+000128f0: 2020 2920 6173 2065 3a0a 2020 2020 2020    ) as e:.      
+00012900: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+00012910: 2020 2020 2020 2020 2020 2020 2022 5c6e               "\n
+00012920: 4772 6164 6965 6e74 5468 7265 7368 6f6c  GradientThreshol
+00012930: 6420 6272 6963 6b3a 2045 7272 6f72 2077  d brick: Error w
+00012940: 6974 6820 6669 6c65 2074 6f20 656e 6861  ith file to enha
+00012950: 6e63 652c 2022 0a20 2020 2020 2020 2020  nce, ".         
+00012960: 2020 2020 2020 2022 6475 7269 6e67 2074         "during t
+00012970: 6865 2072 756e 3a20 222c 0a20 2020 2020  he run: ",.     
+00012980: 2020 2020 2020 2020 2020 2065 2c0a 2020             e,.  
+00012990: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000129a0: 2020 2020 2020 2020 696d 6720 3d20 4e6f          img = No
+000129b0: 6e65 0a20 2020 2020 2020 2020 2020 2073  ne.            s
+000129c0: 6567 5f69 6d67 203d 204e 6f6e 650a 0a20  eg_img = None.. 
+000129d0: 2020 2020 2020 2069 6620 2869 6d67 2069         if (img i
+000129e0: 7320 6e6f 7420 4e6f 6e65 2920 616e 6420  s not None) and 
+000129f0: 2873 6567 5f69 6d67 2069 7320 6e6f 7420  (seg_img is not 
+00012a00: 4e6f 6e65 293a 0a20 2020 2020 2020 2020  None):.         
+00012a10: 2020 2023 2049 6d61 6765 2067 7261 6469     # Image gradi
+00012a20: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00012a30: 6461 7461 203d 2069 6d67 2e67 6574 5f66  data = img.get_f
+00012a40: 6461 7461 2829 2e61 7374 7970 6528 6e70  data().astype(np
+00012a50: 2e66 6c6f 6174 3332 290a 2020 2020 2020  .float32).      
+00012a60: 2020 2020 2020 6461 7461 5f6d 6178 203d        data_max =
+00012a70: 206e 702e 7065 7263 656e 7469 6c65 2864   np.percentile(d
+00012a80: 6174 612e 7265 7368 6170 6528 2d31 292c  ata.reshape(-1),
+00012a90: 2039 392e 3529 0a20 2020 2020 2020 2020   99.5).         
+00012aa0: 2020 2064 6174 6120 2a3d 2031 3030 202f     data *= 100 /
+00012ab0: 2064 6174 615f 6d61 780a 2020 2020 2020   data_max.      
+00012ac0: 2020 2020 2020 6772 6164 203d 2073 696d        grad = sim
+00012ad0: 2e67 6175 7373 6961 6e5f 6772 6164 6965  .gaussian_gradie
+00012ae0: 6e74 5f6d 6167 6e69 7475 6465 2864 6174  nt_magnitude(dat
+00012af0: 612c 2033 2e30 290a 2020 2020 2020 2020  a, 3.0).        
+00012b00: 2020 2020 6772 6164 5f6d 6178 203d 206e      grad_max = n
+00012b10: 702e 7065 7263 656e 7469 6c65 2867 7261  p.percentile(gra
+00012b20: 642e 7265 7368 6170 6528 2d31 292c 2039  d.reshape(-1), 9
+00012b30: 392e 3529 0a20 2020 2020 2020 2020 2020  9.5).           
+00012b40: 2067 7261 6420 2a3d 2031 3030 2e30 0a20   grad *= 100.0. 
+00012b50: 2020 2020 2020 2020 2020 2067 7261 6420             grad 
+00012b60: 2f3d 2067 7261 645f 6d61 780a 0a20 2020  /= grad_max..   
+00012b70: 2020 2020 2020 2020 2023 2047 7261 6469           # Gradi
+00012b80: 656e 7420 7468 7265 7368 6f6c 640a 2020  ent threshold.  
+00012b90: 2020 2020 2020 2020 2020 7374 7275 6320            struc 
+00012ba0: 3d20 7369 6d2e 6974 6572 6174 655f 7374  = sim.iterate_st
+00012bb0: 7275 6374 7572 6528 0a20 2020 2020 2020  ructure(.       
+00012bc0: 2020 2020 2020 2020 2073 696d 2e67 656e           sim.gen
+00012bd0: 6572 6174 655f 6269 6e61 7279 5f73 7472  erate_binary_str
+00012be0: 7563 7475 7265 2833 2c20 3229 2c20 320a  ucture(3, 2), 2.
+00012bf0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00012c00: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
+00012c10: 206e 702e 7a65 726f 735f 6c69 6b65 2867   np.zeros_like(g
+00012c20: 7261 642c 2064 7479 7065 3d6e 702e 7569  rad, dtype=np.ui
+00012c30: 6e74 3829 0a20 2020 2020 2020 2020 2020  nt8).           
+00012c40: 206d 6173 6b5b 6772 6164 203e 2031 352e   mask[grad > 15.
+00012c50: 305d 203d 2031 0a0a 2020 2020 2020 2020  0] = 1..        
+00012c60: 2020 2020 7365 675f 6461 7461 203d 2073      seg_data = s
+00012c70: 6567 5f69 6d67 2e67 6574 5f66 6461 7461  eg_img.get_fdata
+00012c80: 2829 2e61 7374 7970 6528 6e70 2e75 696e  ().astype(np.uin
+00012c90: 7438 290a 2020 2020 2020 2020 2020 2020  t8).            
+00012ca0: 7365 675f 6461 7461 5b73 6567 5f64 6174  seg_data[seg_dat
+00012cb0: 6120 3e20 305d 203d 2031 0a20 2020 2020  a > 0] = 1.     
+00012cc0: 2020 2020 2020 2073 6567 5f64 6174 6120         seg_data 
+00012cd0: 3d20 7369 6d2e 6269 6e61 7279 5f64 696c  = sim.binary_dil
+00012ce0: 6174 696f 6e28 0a20 2020 2020 2020 2020  ation(.         
+00012cf0: 2020 2020 2020 2073 6567 5f64 6174 612c         seg_data,
+00012d00: 2073 7472 7563 2c20 6974 6572 6174 696f   struc, iteratio
+00012d10: 6e73 3d32 2c20 626f 7264 6572 5f76 616c  ns=2, border_val
+00012d20: 7565 3d31 0a20 2020 2020 2020 2020 2020  ue=1.           
+00012d30: 2029 2e61 7374 7970 6528 6e70 2e75 696e   ).astype(np.uin
+00012d40: 7438 290a 2020 2020 2020 2020 2020 2020  t8).            
+00012d50: 6d61 736b 5b73 6567 5f64 6174 6120 3e20  mask[seg_data > 
+00012d60: 305d 203d 2031 0a20 2020 2020 2020 2020  0] = 1.         
+00012d70: 2020 206d 6173 6b20 3d20 7369 6d2e 6269     mask = sim.bi
+00012d80: 6e61 7279 5f63 6c6f 7369 6e67 286d 6173  nary_closing(mas
+00012d90: 6b2c 2073 7472 7563 2c20 6974 6572 6174  k, struc, iterat
+00012da0: 696f 6e73 3d32 292e 6173 7479 7065 280a  ions=2).astype(.
+00012db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012dc0: 6e70 2e75 696e 7438 0a20 2020 2020 2020  np.uint8.       
+00012dd0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00012de0: 2020 2020 6c61 6265 6c5f 696d 2c20 6e62      label_im, nb
+00012df0: 5f6c 6162 656c 7320 3d20 7369 6d2e 6c61  _labels = sim.la
+00012e00: 6265 6c28 6d61 736b 290a 2020 2020 2020  bel(mask).      
+00012e10: 2020 2020 2020 6172 746d 736b 203d 206e        artmsk = n
+00012e20: 702e 7a65 726f 735f 6c69 6b65 286d 6173  p.zeros_like(mas
+00012e30: 6b29 0a20 2020 2020 2020 2020 2020 2069  k).            i
+00012e40: 6620 6e62 5f6c 6162 656c 7320 3e20 323a  f nb_labels > 2:
+00012e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012e60: 2073 697a 6573 203d 2073 696d 2e73 756d   sizes = sim.sum
+00012e70: 286d 6173 6b2c 206c 6162 656c 5f69 6d2c  (mask, label_im,
+00012e80: 206c 6973 7428 7261 6e67 6528 6e62 5f6c   list(range(nb_l
+00012e90: 6162 656c 7320 2b20 3129 2929 0a20 2020  abels + 1))).   
+00012ea0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+00012eb0: 6572 6564 203d 206c 6973 7428 0a20 2020  ered = list(.   
+00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ed0: 2072 6576 6572 7365 6428 736f 7274 6564   reversed(sorted
+00012ee0: 287a 6970 2873 697a 6573 2c20 6c69 7374  (zip(sizes, list
+00012ef0: 2872 616e 6765 286e 625f 6c61 6265 6c73  (range(nb_labels
+00012f00: 202b 2031 2929 2929 290a 2020 2020 2020   + 1))))).      
+00012f10: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00012f20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00012f30: 5f2c 206c 6162 656c 2069 6e20 6f72 6465  _, label in orde
+00012f40: 7265 645b 323a 5d3a 0a20 2020 2020 2020  red[2:]:.       
+00012f50: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+00012f60: 6b5b 6c61 6265 6c5f 696d 203d 3d20 6c61  k[label_im == la
+00012f70: 6265 6c5d 203d 2030 0a20 2020 2020 2020  bel] = 0.       
+00012f80: 2020 2020 2020 2020 2020 2020 2061 7274               art
+00012f90: 6d73 6b5b 6c61 6265 6c5f 696d 203d 3d20  msk[label_im == 
+00012fa0: 6c61 6265 6c5d 203d 2031 0a0a 2020 2020  label] = 1..    
+00012fb0: 2020 2020 2020 2020 6d61 736b 203d 2073          mask = s
+00012fc0: 696d 2e62 696e 6172 795f 6669 6c6c 5f68  im.binary_fill_h
+00012fd0: 6f6c 6573 286d 6173 6b2c 2073 7472 7563  oles(mask, struc
+00012fe0: 292e 6173 7479 7065 286e 702e 7569 6e74  ).astype(np.uint
+00012ff0: 3829 0a0a 2020 2020 2020 2020 2020 2020  8)..            
+00013000: 6f75 745f 696d 6167 6520 3d20 696d 672e  out_image = img.
+00013010: 5f5f 636c 6173 735f 5f28 6d61 736b 2c20  __class__(mask, 
+00013020: 696d 672e 6166 6669 6e65 2c20 696d 672e  img.affine, img.
+00013030: 6865 6164 6572 290a 0a20 2020 2020 2020  header)..       
+00013040: 2020 2020 2023 2049 6d61 6765 2073 6176       # Image sav
+00013050: 650a 2020 2020 2020 2020 2020 2020 5f2c  e.            _,
+00013060: 2066 696c 655f 6e61 6d65 203d 206f 732e   file_name = os.
+00013070: 7061 7468 2e73 706c 6974 2866 696c 655f  path.split(file_
+00013080: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00013090: 2020 6669 6c65 5f6e 616d 655f 6e6f 5f65    file_name_no_e
+000130a0: 7874 2c20 6669 6c65 5f65 7874 656e 7369  xt, file_extensi
+000130b0: 6f6e 203d 206f 732e 7061 7468 2e73 706c  on = os.path.spl
+000130c0: 6974 6578 7428 6669 6c65 5f6e 616d 6529  itext(file_name)
+000130d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000130e0: 6669 6c65 5f65 7874 656e 7369 6f6e 203d  file_extension =
+000130f0: 3d20 222e 677a 223a 0a20 2020 2020 2020  = ".gz":.       
+00013100: 2020 2020 2020 2020 2028 6669 6c65 5f6e           (file_n
+00013110: 616d 655f 6e6f 5f65 7874 5f32 2c20 6669  ame_no_ext_2, fi
+00013120: 6c65 5f65 7874 656e 7369 6f6e 5f32 2920  le_extension_2) 
+00013130: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
+00013140: 7874 280a 2020 2020 2020 2020 2020 2020  xt(.            
+00013150: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00013160: 655f 6e6f 5f65 7874 0a20 2020 2020 2020  e_no_ext.       
+00013170: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00013180: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00013190: 6c65 5f65 7874 656e 7369 6f6e 5f32 203d  le_extension_2 =
+000131a0: 3d20 222e 6e69 6922 3a0a 2020 2020 2020  = ".nii":.      
+000131b0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000131c0: 6c65 5f6e 616d 655f 6e6f 5f65 7874 203d  le_name_no_ext =
+000131d0: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
+000131e0: 745f 320a 2020 2020 2020 2020 2020 2020  t_2.            
+000131f0: 2020 2020 2020 2020 6669 6c65 5f65 7874          file_ext
+00013200: 656e 7369 6f6e 203d 2022 2e6e 6969 2e67  ension = ".nii.g
+00013210: 7a22 0a0a 2020 2020 2020 2020 2020 2020  z"..            
+00013220: 6669 6c65 5f6f 7574 203d 206f 732e 7061  file_out = os.pa
+00013230: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
+00013240: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
+00013250: 7470 7574 5f64 6972 6563 746f 7279 2c0a  tput_directory,.
+00013260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013270: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00013280: 2020 2020 2020 7365 6c66 2e70 7265 6669        self.prefi
+00013290: 782e 7374 7269 7028 290a 2020 2020 2020  x.strip().      
+000132a0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000132b0: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
+000132c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000132d0: 2020 2020 202b 2073 656c 662e 7375 6666       + self.suff
+000132e0: 6978 2e73 7472 6970 2829 0a20 2020 2020  ix.strip().     
+000132f0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00013300: 2066 696c 655f 6578 7465 6e73 696f 6e0a   file_extension.
+00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013320: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00013330: 0a20 2020 2020 2020 2020 2020 206e 6962  .            nib
+00013340: 2e73 6176 6528 6f75 745f 696d 6167 652c  .save(out_image,
+00013350: 2066 696c 655f 6f75 7429 0a0a 0a63 6c61   file_out)...cla
+00013360: 7373 2048 6172 6d6f 6e69 7a65 2850 726f  ss Harmonize(Pro
+00013370: 6365 7373 4d49 4129 3a0a 2020 2020 2222  cessMIA):.    ""
+00013380: 220a 2020 2020 2a48 6172 6d6f 6e69 7a65  ".    *Harmonize
+00013390: 2069 6e70 7574 2069 6d61 6765 2075 7369   input image usi
+000133a0: 6e67 2061 2077 6869 7465 206d 6174 7465  ng a white matte
+000133b0: 7220 6d61 736b 2a0a 0a20 2020 2050 6c65  r mask*..    Ple
+000133c0: 6173 652c 2073 6565 2074 6865 2063 6f6d  ase, see the com
+000133d0: 706c 6574 6520 646f 6375 6d65 6e74 6174  plete documentat
+000133e0: 696f 6e20 666f 7220 7468 6520 6048 6172  ion for the `Har
+000133f0: 6d6f 6e69 7a65 2062 7269 636b 0a20 2020  monize brick.   
+00013400: 2069 6e20 7468 6520 6d69 615f 7072 6f63   in the mia_proc
+00013410: 6573 7365 7320 7765 6273 6974 650a 2020  esses website.  
+00013420: 2020 3c68 7474 7073 3a2f 2f70 6f70 756c    <https://popul
+00013430: 7365 2e67 6974 6875 622e 696f 2f6d 6961  se.github.io/mia
+00013440: 5f70 726f 6365 7373 6573 2f68 746d 6c2f  _processes/html/
+00013450: 646f 6375 6d65 6e74 6174 696f 6e2f 6272  documentation/br
+00013460: 6963 6b73 2f70 7265 7072 6f63 6573 732f  icks/preprocess/
+00013470: 6f74 6865 722f 4861 726d 6f6e 697a 652e  other/Harmonize.
+00013480: 6874 6d6c 3e60 5f0a 0a20 2020 2061 6461  html>`_..    ada
+00013490: 7074 6564 2066 726f 6d3a 0a20 2020 2068  pted from:.    h
+000134a0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+000134b0: 6d2f 6e69 7072 6570 732f 6d72 6971 632f  m/nipreps/mriqc/
+000134c0: 626c 6f62 2f65 3032 3130 3038 6461 3061  blob/e021008da0a
+000134d0: 3265 6631 6334 3865 3838 3262 6166 3933  2ef1c48e882baf93
+000134e0: 3231 3339 6136 3733 3334 3966 392f 6d72  2139a673349f9/mr
+000134f0: 6971 632f 696e 7465 7266 6163 6573 2f61  iqc/interfaces/a
+00013500: 6e61 746f 6d69 6361 6c2e 7079 234c 3430  natomical.py#L40
+00013510: 350a 0a20 2020 2022 2222 0a0a 2020 2020  5..    """..    
+00013520: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00013530: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
+00013540: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
+00013550: 6174 7472 6962 7574 6573 2069 6e69 7469  attributes initi
+00013560: 616c 6973 6174 696f 6e20 2f20 696e 7374  alisation / inst
+00013570: 616e 7469 6174 696f 6e2e 0a0a 2020 2020  antiation...    
+00013580: 2020 2020 5468 6520 696e 7075 7420 616e      The input an
+00013590: 6420 6f75 7470 7574 2070 6c75 6773 2061  d output plugs a
+000135a0: 7265 2064 6566 696e 6564 2068 6572 652e  re defined here.
+000135b0: 2054 6865 2073 7065 6369 616c 0a20 2020   The special.   
+000135c0: 2020 2020 2027 7365 6c66 2e72 6571 7569       'self.requi
+000135d0: 7265 6d65 6e74 2720 6174 7472 6962 7574  rement' attribut
+000135e0: 6520 286f 7074 696f 6e61 6c29 2069 7320  e (optional) is 
+000135f0: 7573 6564 2074 6f20 6465 6669 6e65 2074  used to define t
+00013600: 6865 0a20 2020 2020 2020 2074 6869 7264  he.        third
+00013610: 2d70 6172 7479 2070 726f 6475 6374 7320  -party products 
+00013620: 6e65 6365 7373 6172 7920 666f 7220 7468  necessary for th
+00013630: 6520 7275 6e6e 696e 6720 6f66 2074 6865  e running of the
+00013640: 2062 7269 636b 2e0a 2020 2020 2020 2020   brick..        
+00013650: 2222 220a 2020 2020 2020 2020 2320 496e  """.        # In
+00013660: 6974 6961 6c69 7361 7469 6f6e 206f 6620  itialisation of 
+00013670: 7468 6520 6f62 6a65 6374 7320 6e65 6564  the objects need
+00013680: 6564 2066 6f72 2074 6865 206c 6175 6e63  ed for the launc
+00013690: 6820 6f66 2074 6865 2062 7269 636b 0a20  h of the brick. 
+000136a0: 2020 2020 2020 2073 7570 6572 2848 6172         super(Har
+000136b0: 6d6f 6e69 7a65 2c20 7365 6c66 292e 5f5f  monize, self).__
+000136c0: 696e 6974 5f5f 2829 0a0a 2020 2020 2020  init__()..      
+000136d0: 2020 2320 5468 6972 6420 7061 7274 7920    # Third party 
+000136e0: 736f 6674 7761 7265 7320 7265 7175 6972  softwares requir
+000136f0: 6564 2066 6f72 2074 6865 2065 7865 6375  ed for the execu
+00013700: 7469 6f6e 206f 6620 7468 6520 6272 6963  tion of the bric
+00013710: 6b0a 2020 2020 2020 2020 7365 6c66 2e72  k.        self.r
+00013720: 6571 7569 7265 6d65 6e74 203d 205b 5d0a  equirement = [].
+00013730: 0a20 2020 2020 2020 2023 2049 6e70 7574  .        # Input
+00013740: 7320 6465 7363 7269 7074 696f 6e0a 2020  s description.  
+00013750: 2020 2020 2020 696e 5f66 696c 655f 6465        in_file_de
+00013760: 7363 203d 2022 416e 2065 7869 7374 696e  sc = "An existin
+00013770: 6720 7061 7468 2066 696c 652e 220a 2020  g path file.".  
+00013780: 2020 2020 2020 776d 5f6d 6173 6b5f 6465        wm_mask_de
+00013790: 7363 203d 2022 416e 2065 7869 7374 696e  sc = "An existin
+000137a0: 6720 7061 7468 206f 6620 6120 574d 206d  g path of a WM m
+000137b0: 6173 6b20 6669 6c65 2e22 0a20 2020 2020  ask file.".     
+000137c0: 2020 2065 726f 6465 6d61 736b 5f64 6573     erodemask_des
+000137d0: 6320 3d20 2242 6f6f 6c65 616e 2028 6120  c = "Boolean (a 
+000137e0: 7374 7269 6e67 292e 220a 2020 2020 2020  string).".      
+000137f0: 2020 7375 6666 6978 5f64 6573 6320 3d20    suffix_desc = 
+00013800: 2253 7566 6669 7820 6f66 2074 6865 206f  "Suffix of the o
+00013810: 7574 7075 7420 696d 6167 6520 2861 2073  utput image (a s
+00013820: 7472 696e 6729 2e22 0a20 2020 2020 2020  tring).".       
+00013830: 2070 7265 6669 785f 6465 7363 203d 2022   prefix_desc = "
+00013840: 5072 6566 6978 206f 6620 7468 6520 6f75  Prefix of the ou
+00013850: 7470 7574 2069 6d61 6765 2028 6120 7374  tput image (a st
+00013860: 7269 6e67 292e 220a 0a20 2020 2020 2020  ring)."..       
+00013870: 2023 204f 7574 7075 7473 2064 6573 6372   # Outputs descr
+00013880: 6970 7469 6f6e 0a20 2020 2020 2020 206f  iption.        o
+00013890: 7574 5f66 696c 655f 6465 7363 203d 2028  ut_file_desc = (
+000138a0: 0a20 2020 2020 2020 2020 2020 2022 5061  .            "Pa
+000138b0: 7468 206f 6620 7468 6520 6861 726d 6f6e  th of the harmon
+000138c0: 697a 6564 2069 6d61 6765 2022 0a20 2020  ized image ".   
+000138d0: 2020 2020 2020 2020 2022 2861 2070 6174           "(a pat
+000138e0: 686c 696b 6520 6f62 6a65 6374 206f 7220  hlike object or 
+000138f0: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
+00013900: 696e 6720 6120 6669 6c65 292e 220a 2020  ing a file).".  
+00013910: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00013920: 2023 2049 6e70 7574 7320 7472 6169 7473   # Inputs traits
+00013930: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00013940: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00013950: 2020 2020 2022 696e 5f66 696c 6522 2c20       "in_file", 
+00013960: 4669 6c65 286f 7574 7075 743d 4661 6c73  File(output=Fals
+00013970: 652c 206f 7074 696f 6e61 6c3d 4661 6c73  e, optional=Fals
+00013980: 652c 2064 6573 633d 696e 5f66 696c 655f  e, desc=in_file_
+00013990: 6465 7363 290a 2020 2020 2020 2020 290a  desc).        ).
+000139a0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+000139b0: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+000139c0: 2020 2020 2022 776d 5f6d 6173 6b22 2c20       "wm_mask", 
+000139d0: 4669 6c65 286f 7574 7075 743d 4661 6c73  File(output=Fals
+000139e0: 652c 206f 7074 696f 6e61 6c3d 4661 6c73  e, optional=Fals
+000139f0: 652c 2064 6573 633d 776d 5f6d 6173 6b5f  e, desc=wm_mask_
+00013a00: 6465 7363 290a 2020 2020 2020 2020 290a  desc).        ).
+00013a10: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00013a20: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00013a30: 2020 2020 2022 6572 6f64 656d 6173 6b22       "erodemask"
+00013a40: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
+00013a50: 6169 7473 2e42 6f6f 6c28 0a20 2020 2020  aits.Bool(.     
+00013a60: 2020 2020 2020 2020 2020 2054 7275 652c             True,
+00013a70: 206f 7574 7075 743d 4661 6c73 652c 206f   output=False, o
+00013a80: 7074 696f 6e61 6c3d 5472 7565 2c20 6465  ptional=True, de
+00013a90: 7363 3d65 726f 6465 6d61 736b 5f64 6573  sc=erodemask_des
+00013aa0: 630a 2020 2020 2020 2020 2020 2020 292c  c.            ),
+00013ab0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00013ac0: 2020 2073 656c 662e 6164 645f 7472 6169     self.add_trai
+00013ad0: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
+00013ae0: 7072 6566 6978 222c 0a20 2020 2020 2020  prefix",.       
+00013af0: 2020 2020 2074 7261 6974 732e 5374 7269       traits.Stri
+00013b00: 6e67 2822 222c 206f 7574 7075 743d 4661  ng("", output=Fa
+00013b10: 6c73 652c 206f 7074 696f 6e61 6c3d 5472  lse, optional=Tr
+00013b20: 7565 2c20 6465 7363 3d70 7265 6669 785f  ue, desc=prefix_
+00013b30: 6465 7363 292c 0a20 2020 2020 2020 2029  desc),.        )
+00013b40: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00013b50: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00013b60: 2020 2020 2022 7375 6666 6978 222c 0a20       "suffix",. 
+00013b70: 2020 2020 2020 2020 2020 2074 7261 6974             trait
+00013b80: 732e 5374 7269 6e67 280a 2020 2020 2020  s.String(.      
+00013b90: 2020 2020 2020 2020 2020 225f 6861 726d            "_harm
+00013ba0: 6f6e 697a 6564 222c 206f 7574 7075 743d  onized", output=
+00013bb0: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+00013bc0: 5472 7565 2c20 6465 7363 3d73 7566 6669  True, desc=suffi
+00013bd0: 785f 6465 7363 0a20 2020 2020 2020 2020  x_desc.         
+00013be0: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+00013bf0: 0a20 2020 2020 2020 2023 204f 7574 7075  .        # Outpu
+00013c00: 7473 2074 7261 6974 730a 2020 2020 2020  ts traits.      
+00013c10: 2020 7365 6c66 2e61 6464 5f74 7261 6974    self.add_trait
+00013c20: 2822 6f75 745f 6669 6c65 222c 2046 696c  ("out_file", Fil
+00013c30: 6528 6f75 7470 7574 3d54 7275 652c 2064  e(output=True, d
+00013c40: 6573 633d 6f75 745f 6669 6c65 5f64 6573  esc=out_file_des
+00013c50: 6329 290a 0a20 2020 2020 2020 2073 656c  c))..        sel
+00013c60: 662e 696e 6974 5f64 6566 6175 6c74 5f74  f.init_default_t
+00013c70: 7261 6974 7328 290a 0a20 2020 2064 6566  raits()..    def
+00013c80: 206c 6973 745f 6f75 7470 7574 7328 7365   list_outputs(se
+00013c90: 6c66 2c20 6973 5f70 6c75 6767 6564 3d4e  lf, is_plugged=N
+00013ca0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00013cb0: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
+00013cc0: 6520 696e 6974 6961 6c69 7361 7469 6f6e  e initialisation
+00013cd0: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
+00013ce0: 636b 2e0a 0a20 2020 2020 2020 2054 6865  ck...        The
+00013cf0: 206d 6169 6e20 6f62 6a65 6374 6976 6520   main objective 
+00013d00: 6f66 2074 6869 7320 6d65 7468 6f64 2069  of this method i
+00013d10: 7320 746f 2070 726f 6475 6365 2074 6865  s to produce the
+00013d20: 206f 7574 7075 7473 206f 6620 7468 650a   outputs of the.
+00013d30: 2020 2020 2020 2020 6272 6963 6b73 2028          bricks (
+00013d40: 7365 6c66 2e6f 7574 7075 7473 2920 616e  self.outputs) an
+00013d50: 6420 7468 6520 6173 736f 6369 6174 6564  d the associated
+00013d60: 2074 6167 7320 2873 656c 662e 696e 6865   tags (self.inhe
+00013d70: 7269 7461 6e63 655f 6469 6329 2c0a 2020  ritance_dic),.  
+00013d80: 2020 2020 2020 6966 2064 6566 696e 6564        if defined
+00013d90: 2068 6572 652e 2054 6f20 776f 726b 2070   here. To work p
+00013da0: 726f 7065 726c 7920 7468 6973 206d 6574  roperly this met
+00013db0: 686f 6420 6d75 7374 2072 6574 7572 6e0a  hod must return.
+00013dc0: 2020 2020 2020 2020 7365 6c66 2e6d 616b          self.mak
+00013dd0: 655f 696e 6974 5265 7375 6c74 2829 206f  e_initResult() o
+00013de0: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
+00013df0: 3a70 6172 616d 2069 735f 706c 7567 6765  :param is_plugge
+00013e00: 643a 2074 6865 2073 7461 7465 2c20 6c69  d: the state, li
+00013e10: 6e6b 6564 206f 7220 6e6f 742c 206f 6620  nked or not, of 
+00013e20: 7468 6520 706c 7567 732e 0a20 2020 2020  the plugs..     
+00013e30: 2020 203a 7265 7475 726e 733a 2061 2064     :returns: a d
+00013e40: 6963 7469 6f6e 6172 7920 7769 7468 2072  ictionary with r
+00013e50: 6571 7569 7265 6d65 6e74 2c20 6f75 7470  equirement, outp
+00013e60: 7574 7320 616e 6420 696e 6865 7269 7461  uts and inherita
+00013e70: 6e63 655f 6469 6374 2e0a 2020 2020 2020  nce_dict..      
+00013e80: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+00013e90: 5573 696e 6720 7468 6520 696e 6865 7269  Using the inheri
+00013ea0: 7461 6e63 6520 746f 2050 726f 6365 7373  tance to Process
+00013eb0: 4d49 4120 636c 6173 732c 206c 6973 745f  MIA class, list_
+00013ec0: 6f75 7470 7574 7320 6d65 7468 6f64 0a20  outputs method. 
+00013ed0: 2020 2020 2020 2073 7570 6572 2848 6172         super(Har
+00013ee0: 6d6f 6e69 7a65 2c20 7365 6c66 292e 6c69  monize, self).li
+00013ef0: 7374 5f6f 7574 7075 7473 2829 0a0a 2020  st_outputs()..  
+00013f00: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
+00013f10: 6465 6669 6e69 7469 6f6e 0a20 2020 2020  definition.     
+00013f20: 2020 2069 6620 7365 6c66 2e69 6e5f 6669     if self.in_fi
+00013f30: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00013f40: 7661 6c69 645f 6578 742c 2069 6e5f 6578  valid_ext, in_ex
+00013f50: 742c 2066 696c 654e 616d 6520 3d20 6368  t, fileName = ch
+00013f60: 6563 6b46 696c 6545 7874 2873 656c 662e  eckFileExt(self.
+00013f70: 696e 5f66 696c 652c 2045 5854 290a 0a20  in_file, EXT).. 
+00013f80: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00013f90: 7420 7661 6c69 645f 6578 743a 0a20 2020  t valid_ext:.   
+00013fa0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00013fb0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00013fc0: 2020 2020 2020 2020 225c 6e48 6172 6d6f          "\nHarmo
+00013fd0: 6e69 7a65 2062 7269 636b 3a20 5468 6520  nize brick: The 
+00013fe0: 696e 7075 7420 696d 6167 6520 666f 726d  input image form
+00013ff0: 6174 2069 7320 220a 2020 2020 2020 2020  at is ".        
+00014000: 2020 2020 2020 2020 2020 2020 226e 6f74              "not
+00014010: 2072 6563 6f67 6e69 7a65 642e 2e2e 2122   recognized...!"
+00014020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014030: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00014040: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+00014050: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00014060: 2020 2020 2020 2020 2020 2020 286e 6f74              (not
+00014070: 2073 656c 662e 7375 6666 6978 290a 2020   self.suffix).  
+00014080: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00014090: 2028 7365 6c66 2e73 7566 6669 782e 6973   (self.suffix.is
+000140a0: 7370 6163 6528 2929 0a20 2020 2020 2020  space()).       
+000140b0: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+000140c0: 2e73 7566 6669 7820 696e 205b 556e 6465  .suffix in [Unde
+000140d0: 6669 6e65 642c 2022 3c75 6e64 6566 696e  fined, "<undefin
+000140e0: 6564 3e22 5d0a 2020 2020 2020 2020 2020  ed>"].          
+000140f0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00014100: 2020 2020 2073 656c 662e 7375 6666 6978       self.suffix
+00014110: 203d 2022 2022 0a0a 2020 2020 2020 2020   = " "..        
+00014120: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00014130: 2020 2020 2020 2020 2028 6e6f 7420 7365           (not se
+00014140: 6c66 2e70 7265 6669 7829 0a20 2020 2020  lf.prefix).     
+00014150: 2020 2020 2020 2020 2020 206f 7220 2873             or (s
+00014160: 656c 662e 7072 6566 6978 2e69 7373 7061  elf.prefix.isspa
+00014170: 6365 2829 290a 2020 2020 2020 2020 2020  ce()).          
+00014180: 2020 2020 2020 6f72 2028 7365 6c66 2e70        or (self.p
+00014190: 7265 6669 7820 696e 205b 556e 6465 6669  refix in [Undefi
+000141a0: 6e65 642c 2022 3c75 6e64 6566 696e 6564  ned, "<undefined
+000141b0: 3e22 5d29 0a20 2020 2020 2020 2020 2020  >"]).           
+000141c0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+000141d0: 2020 2020 7365 6c66 2e70 7265 6669 7820      self.prefix 
+000141e0: 3d20 2220 220a 0a20 2020 2020 2020 2020  = " "..         
+000141f0: 2020 2070 6174 682c 205f 203d 206f 732e     path, _ = os.
+00014200: 7061 7468 2e73 706c 6974 2873 656c 662e  path.split(self.
+00014210: 696e 5f66 696c 6529 0a0a 2020 2020 2020  in_file)..      
+00014220: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00014230: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014240: 7375 6666 6978 203d 3d20 2220 220a 2020  suffix == " ".  
+00014250: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00014260: 6420 7365 6c66 2e70 7265 6669 7820 3d3d  d self.prefix ==
+00014270: 2022 2022 0a20 2020 2020 2020 2020 2020   " ".           
+00014280: 2020 2020 2061 6e64 2070 6174 6820 3d3d       and path ==
+00014290: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
+000142a0: 6563 746f 7279 0a20 2020 2020 2020 2020  ectory.         
+000142b0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+000142c0: 2020 2020 2020 6d73 6720 3d20 514d 6573        msg = QMes
+000142d0: 7361 6765 426f 7828 290a 2020 2020 2020  sageBox().      
+000142e0: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
+000142f0: 7449 636f 6e28 514d 6573 7361 6765 426f  tIcon(QMessageBo
+00014300: 782e 5761 726e 696e 6729 0a20 2020 2020  x.Warning).     
+00014310: 2020 2020 2020 2020 2020 206d 7367 2e73             msg.s
+00014320: 6574 5769 6e64 6f77 5469 746c 6528 226d  etWindowTitle("m
+00014330: 6961 5f70 726f 6365 7373 6573 202d 2048  ia_processes - H
+00014340: 6172 6d6f 6e69 7a65 2062 7269 636b 2057  armonize brick W
+00014350: 6172 6e69 6e67 2122 290a 2020 2020 2020  arning!").      
+00014360: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
+00014370: 7454 6578 7428 0a20 2020 2020 2020 2020  tText(.         
+00014380: 2020 2020 2020 2020 2020 2022 5375 6666             "Suff
+00014390: 6978 2061 6e64 2070 7265 6669 7820 696e  ix and prefix in
+000143a0: 7075 7420 7061 7261 6d65 7465 7273 2061  put parameters a
+000143b0: 7265 206e 6f74 2022 0a20 2020 2020 2020  re not ".       
+000143c0: 2020 2020 2020 2020 2020 2020 2022 6465               "de
+000143d0: 6669 6e65 6420 6f72 2063 6f6e 7369 7374  fined or consist
+000143e0: 206f 6e6c 7920 6f66 206f 6e65 206f 7220   only of one or 
+000143f0: 6d6f 7265 2077 6869 7465 2022 0a20 2020  more white ".   
+00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014410: 2022 7370 6163 6573 2e5c 6e54 6865 207b   "spaces.\nThe {
+00014420: 307d 2069 6e70 7574 2070 6172 616d 6574  0} input paramet
+00014430: 6572 2077 696c 6c20 6265 2022 0a20 2020  er will be ".   
+00014440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014450: 2022 6f76 6572 7772 6974 7465 6e20 2e2e   "overwritten ..
+00014460: 2e5c 6e20 5965 7320 6f72 2022 0a20 2020  .\n Yes or ".   
+00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014480: 2022 4162 6f72 743f 222e 666f 726d 6174   "Abort?".format
+00014490: 2866 696c 654e 616d 6529 0a20 2020 2020  (fileName).     
+000144a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000144b0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+000144c0: 2e73 6574 5374 616e 6461 7264 4275 7474  .setStandardButt
+000144d0: 6f6e 7328 514d 6573 7361 6765 426f 782e  ons(QMessageBox.
+000144e0: 5965 7320 7c20 514d 6573 7361 6765 426f  Yes | QMessageBo
+000144f0: 782e 4162 6f72 7429 0a20 2020 2020 2020  x.Abort).       
+00014500: 2020 2020 2020 2020 2072 6574 7661 6c20           retval 
+00014510: 3d20 6d73 672e 6578 6563 5f28 290a 0a20  = msg.exec_().. 
+00014520: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014530: 6620 7265 7476 616c 2021 3d20 514d 6573  f retval != QMes
+00014540: 7361 6765 426f 782e 4162 6f72 743a 0a20  sageBox.Abort:. 
+00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014560: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014580: 2020 225c 6e48 6172 6d6f 6e69 7a65 2062    "\nHarmonize b
+00014590: 7269 636b 2077 6172 6e69 6e67 3a20 7468  rick warning: th
+000145a0: 6520 6f75 745f 6669 6c65 206f 7574 7075  e out_file outpu
+000145b0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
+000145c0: 2020 2020 2020 2020 2020 2020 2270 6172              "par
+000145d0: 616d 6574 6572 2069 7320 7468 6520 7361  ameter is the sa
+000145e0: 6d65 2061 7320 7468 6520 696e 5f66 696c  me as the in_fil
+000145f0: 6520 696e 7075 7420 220a 2020 2020 2020  e input ".      
+00014600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014610: 2020 2270 6172 616d 6574 6572 2028 7375    "parameter (su
+00014620: 6666 6978 2061 6e64 2070 7265 6669 7820  ffix and prefix 
+00014630: 6172 6520 6e6f 7420 6465 6669 6e65 6429  are not defined)
+00014640: 3a22 0a20 2020 2020 2020 2020 2020 2020  :".             
+00014650: 2020 2020 2020 2020 2020 2022 5c6e 7b30             "\n{0
+00014660: 7d20 7769 6c6c 2062 6520 6f76 6572 7772  } will be overwr
+00014670: 6974 6564 202e 2e2e 222e 666f 726d 6174  ited ...".format
+00014680: 2866 696c 654e 616d 6529 0a20 2020 2020  (fileName).     
+00014690: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000146a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000146b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000146c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000146d0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+000146e0: 2020 2020 2020 2020 2020 2022 5c6e 4861             "\nHa
+000146f0: 726d 6f6e 697a 6520 6272 6963 6b3a 2041  rmonize brick: A
+00014700: 626f 7274 6564 2e20 506c 6561 7365 2063  borted. Please c
+00014710: 6865 636b 2079 6f75 7220 220a 2020 2020  heck your ".    
+00014720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014730: 2020 2020 2269 6e70 7574 2070 6172 616d      "input param
+00014740: 6574 6572 7320 2e2e 2e22 0a20 2020 2020  eters ...".     
+00014750: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00014760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014770: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00014780: 2020 2020 2020 2020 2066 696c 6520 3d20           file = 
+00014790: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
+000147a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000147b0: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
+000147c0: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
+000147d0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+000147e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000147f0: 7072 6566 6978 2e73 7472 6970 2829 0a20  prefix.strip(). 
+00014800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014810: 2020 202b 2066 696c 654e 616d 650a 2020     + fileName.  
+00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014830: 2020 2b20 7365 6c66 2e73 7566 6669 782e    + self.suffix.
+00014840: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+00014850: 2020 2020 2020 2020 2020 2020 2b20 222e              + ".
+00014860: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00014870: 2020 2020 2020 2b20 696e 5f65 7874 0a20        + in_ext. 
+00014880: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00014890: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+000148a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000148b0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+000148c0: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+000148d0: 7473 5b22 6f75 745f 6669 6c65 225d 203d  ts["out_file"] =
+000148e0: 2066 696c 650a 0a20 2020 2020 2020 2020   file..         
+000148f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00014900: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+00014910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014920: 2020 2020 222d 2048 6172 6d6f 6e69 7a65      "- Harmonize
+00014930: 2062 7269 636b 3a20 5468 6572 6520 7761   brick: There wa
+00014940: 7320 6e6f 206f 7574 7075 7420 6669 6c65  s no output file
+00014950: 2064 6564 7563 7465 6420 220a 2020 2020   deducted ".    
+00014960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014970: 2264 7572 696e 6720 696e 6974 6961 6c69  "during initiali
+00014980: 7a61 7469 6f6e 2e20 506c 6561 7365 2063  zation. Please c
+00014990: 6865 636b 2074 6865 2069 6e70 7574 2022  heck the input "
+000149a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000149b0: 2020 2020 2022 7061 7261 6d65 7465 7273       "parameters
+000149c0: 2e2e 2e21 220a 2020 2020 2020 2020 2020  ...!".          
+000149d0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000149e0: 2020 2020 2023 2074 6167 7320 696e 6865       # tags inhe
+000149f0: 7269 7461 6e63 6520 286f 7074 696f 6e61  ritance (optiona
+00014a00: 6c29 0a20 2020 2020 2020 2020 2020 2069  l).            i
+00014a10: 6620 7365 6c66 2e6f 7574 7075 7473 5b22  f self.outputs["
+00014a20: 6f75 745f 6669 6c65 225d 3a0a 2020 2020  out_file"]:.    
+00014a30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014a40: 2e74 6167 735f 696e 6865 7269 7461 6e63  .tags_inheritanc
+00014a50: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00014a60: 2020 2020 2020 2069 6e5f 6669 6c65 3d73         in_file=s
+00014a70: 656c 662e 696e 5f66 696c 652c 0a20 2020  elf.in_file,.   
+00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a90: 206f 7574 5f66 696c 653d 7365 6c66 2e6f   out_file=self.o
+00014aa0: 7574 7075 7473 5b22 6f75 745f 6669 6c65  utputs["out_file
+00014ab0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+00014ac0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00014ad0: 2052 6574 7572 6e20 7468 6520 7265 7175   Return the requ
+00014ae0: 6972 656d 656e 742c 206f 7574 7075 7473  irement, outputs
+00014af0: 2061 6e64 2069 6e68 6572 6974 616e 6365   and inheritance
+00014b00: 5f64 6963 740a 2020 2020 2020 2020 7265  _dict.        re
+00014b10: 7475 726e 2073 656c 662e 6d61 6b65 5f69  turn self.make_i
+00014b20: 6e69 7452 6573 756c 7428 290a 0a20 2020  nitResult()..   
+00014b30: 2064 6566 2072 756e 5f70 726f 6365 7373   def run_process
+00014b40: 5f6d 6961 2873 656c 6629 3a0a 2020 2020  _mia(self):.    
+00014b50: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
+00014b60: 2074 6f20 7468 6520 7072 6f63 6573 7320   to the process 
+00014b70: 6c61 756e 6368 2073 7465 7020 6f66 2074  launch step of t
+00014b80: 6865 2062 7269 636b 2e22 2222 0a20 2020  he brick.""".   
+00014b90: 2020 2020 2073 7570 6572 2848 6172 6d6f       super(Harmo
+00014ba0: 6e69 7a65 2c20 7365 6c66 292e 7275 6e5f  nize, self).run_
+00014bb0: 7072 6f63 6573 735f 6d69 6128 290a 0a20  process_mia().. 
+00014bc0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00014bd0: 2020 2020 2020 2020 696d 6720 3d20 6e69          img = ni
+00014be0: 622e 6c6f 6164 2873 656c 662e 696e 5f66  b.load(self.in_f
+00014bf0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00014c00: 2077 6d5f 696d 6720 3d20 6e69 622e 6c6f   wm_img = nib.lo
+00014c10: 6164 2873 656c 662e 776d 5f6d 6173 6b29  ad(self.wm_mask)
+00014c20: 2e67 6574 5f66 6461 7461 2829 0a20 2020  .get_fdata().   
+00014c30: 2020 2020 2065 7863 6570 7420 280a 2020       except (.  
+00014c40: 2020 2020 2020 2020 2020 6e69 622e 6669            nib.fi
+00014c50: 6c65 6261 7365 6469 6d61 6765 732e 496d  lebasedimages.Im
+00014c60: 6167 6546 696c 6545 7272 6f72 2c0a 2020  ageFileError,.  
+00014c70: 2020 2020 2020 2020 2020 4669 6c65 4e6f            FileNo
+00014c80: 7446 6f75 6e64 4572 726f 722c 0a20 2020  tFoundError,.   
+00014c90: 2020 2020 2020 2020 2054 7970 6545 7272           TypeErr
+00014ca0: 6f72 2c0a 2020 2020 2020 2020 2920 6173  or,.        ) as
+00014cb0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00014cc0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+00014cd0: 2020 2020 2020 2022 5c6e 4861 726d 6f6e         "\nHarmon
+00014ce0: 697a 6520 6272 6963 6b3a 2045 7272 6f72  ize brick: Error
+00014cf0: 2077 6974 6820 6669 6c65 2074 6f20 656e   with file to en
+00014d00: 6861 6e63 652c 2064 7572 696e 6720 7468  hance, during th
+00014d10: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00014d20: 2020 2020 2272 756e 3a20 222c 0a20 2020      "run: ",.   
+00014d30: 2020 2020 2020 2020 2020 2020 2065 2c0a               e,.
+00014d40: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00014d50: 2020 2020 2020 2020 2020 696d 6720 3d20            img = 
+00014d60: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00014d70: 2077 6d5f 696d 6720 3d20 4e6f 6e65 0a0a   wm_img = None..
+00014d80: 2020 2020 2020 2020 6966 2028 696d 6720          if (img 
+00014d90: 6973 206e 6f74 204e 6f6e 6529 2061 6e64  is not None) and
+00014da0: 2028 776d 5f69 6d67 2069 7320 6e6f 7420   (wm_img is not 
+00014db0: 4e6f 6e65 293a 0a20 2020 2020 2020 2020  None):.         
+00014dc0: 2020 2077 6d5f 696d 675b 776d 5f69 6d67     wm_img[wm_img
+00014dd0: 203c 2030 2e39 5d20 3d20 300a 2020 2020   < 0.9] = 0.    
+00014de0: 2020 2020 2020 2020 776d 5f69 6d67 5b77          wm_img[w
+00014df0: 6d5f 696d 6720 3e20 305d 203d 2031 0a20  m_img > 0] = 1. 
+00014e00: 2020 2020 2020 2020 2020 2077 6d5f 6d61             wm_ma
+00014e10: 736b 203d 2077 6d5f 696d 672e 6173 7479  sk = wm_img.asty
+00014e20: 7065 286e 702e 7569 6e74 3829 0a0a 2020  pe(np.uint8)..  
+00014e30: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00014e40: 662e 6572 6f64 656d 6173 6b3a 0a20 2020  f.erodemask:.   
+00014e50: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00014e60: 7265 6174 6520 6120 7374 7275 6374 7572  reate a structur
+00014e70: 616c 2065 6c65 6d65 6e74 2074 6f20 6265  al element to be
+00014e80: 2075 7365 640a 2020 2020 2020 2020 2020   used.          
+00014e90: 2020 2020 2020 2320 696e 2061 6e20 6f70        # in an op
+00014ea0: 656e 696e 6720 6f70 6572 6174 696f 6e2e  ening operation.
+00014eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ec0: 2073 7472 7563 203d 2073 696d 2e67 656e   struc = sim.gen
+00014ed0: 6572 6174 655f 6269 6e61 7279 5f73 7472  erate_binary_str
+00014ee0: 7563 7475 7265 2833 2c20 3229 0a20 2020  ucture(3, 2).   
+00014ef0: 2020 2020 2020 2020 2020 2020 2023 2050               # P
+00014f00: 6572 666f 726d 2061 6e20 6f70 656e 696e  erform an openin
+00014f10: 6720 6f70 6572 6174 696f 6e20 6f6e 2074  g operation on t
+00014f20: 6865 2062 6163 6b67 726f 756e 6420 6461  he background da
+00014f30: 7461 2e0a 2020 2020 2020 2020 2020 2020  ta..            
+00014f40: 2020 2020 776d 5f6d 6173 6b20 3d20 7369      wm_mask = si
+00014f50: 6d2e 6269 6e61 7279 5f65 726f 7369 6f6e  m.binary_erosion
+00014f60: 2877 6d5f 6d61 736b 2c20 7374 7275 6374  (wm_mask, struct
+00014f70: 7572 653d 7374 7275 6329 2e61 7374 7970  ure=struc).astyp
+00014f80: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00014f90: 2020 2020 2020 206e 702e 7569 6e74 380a         np.uint8.
+00014fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fb0: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00014fc0: 6174 6120 3d20 696d 672e 6765 745f 6664  ata = img.get_fd
+00014fd0: 6174 6128 290a 2020 2020 2020 2020 2020  ata().          
+00014fe0: 2020 6461 7461 203d 2064 6174 6120 2a20    data = data * 
+00014ff0: 2831 3030 302e 3020 2f20 6e70 2e6d 6564  (1000.0 / np.med
+00015000: 6961 6e28 6461 7461 5b77 6d5f 6d61 736b  ian(data[wm_mask
+00015010: 203e 2030 5d29 290a 0a20 2020 2020 2020   > 0]))..       
+00015020: 2020 2020 206f 7574 5f69 6d67 203d 2069       out_img = i
+00015030: 6d67 2e5f 5f63 6c61 7373 5f5f 2864 6174  mg.__class__(dat
+00015040: 612c 2069 6d67 2e61 6666 696e 652c 2069  a, img.affine, i
+00015050: 6d67 2e68 6561 6465 7229 0a0a 2020 2020  mg.header)..    
+00015060: 2020 2020 2020 2020 2320 496d 6167 6520          # Image 
+00015070: 7361 7665 0a20 2020 2020 2020 2020 2020  save.           
+00015080: 205f 2c20 6669 6c65 5f6e 616d 6520 3d20   _, file_name = 
+00015090: 6f73 2e70 6174 682e 7370 6c69 7428 7365  os.path.split(se
+000150a0: 6c66 2e69 6e5f 6669 6c65 290a 2020 2020  lf.in_file).    
+000150b0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+000150c0: 655f 6e6f 5f65 7874 2c20 6669 6c65 5f65  e_no_ext, file_e
+000150d0: 7874 656e 7369 6f6e 203d 206f 732e 7061  xtension = os.pa
+000150e0: 7468 2e73 706c 6974 6578 7428 6669 6c65  th.splitext(file
+000150f0: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00015100: 2020 2069 6620 6669 6c65 5f65 7874 656e     if file_exten
+00015110: 7369 6f6e 203d 3d20 222e 677a 223a 0a20  sion == ".gz":. 
+00015120: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00015130: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
+00015140: 5f32 2c20 6669 6c65 5f65 7874 656e 7369  _2, file_extensi
+00015150: 6f6e 5f32 2920 3d20 6f73 2e70 6174 682e  on_2) = os.path.
+00015160: 7370 6c69 7465 7874 280a 2020 2020 2020  splitext(.      
+00015170: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00015180: 6c65 5f6e 616d 655f 6e6f 5f65 7874 0a20  le_name_no_ext. 
+00015190: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000151a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000151b0: 2069 6620 6669 6c65 5f65 7874 656e 7369   if file_extensi
+000151c0: 6f6e 5f32 203d 3d20 222e 6e69 6922 3a0a  on_2 == ".nii":.
+000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151e0: 2020 2020 6669 6c65 5f6e 616d 655f 6e6f      file_name_no
+000151f0: 5f65 7874 203d 2066 696c 655f 6e61 6d65  _ext = file_name
+00015200: 5f6e 6f5f 6578 745f 320a 2020 2020 2020  _no_ext_2.      
+00015210: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00015220: 6c65 5f65 7874 656e 7369 6f6e 203d 2022  le_extension = "
+00015230: 2e6e 6969 2e67 7a22 0a0a 2020 2020 2020  .nii.gz"..      
+00015240: 2020 2020 2020 6669 6c65 5f6f 7574 203d        file_out =
+00015250: 206f 732e 7061 7468 2e6a 6f69 6e28 0a20   os.path.join(. 
+00015260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00015270: 656c 662e 6f75 7470 7574 5f64 6972 6563  elf.output_direc
+00015280: 746f 7279 2c0a 2020 2020 2020 2020 2020  tory,.          
+00015290: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+000152a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000152b0: 2e70 7265 6669 782e 7374 7269 7028 290a  .prefix.strip().
+000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152d0: 2020 2020 2b20 6669 6c65 5f6e 616d 655f      + file_name_
+000152e0: 6e6f 5f65 7874 0a20 2020 2020 2020 2020  no_ext.         
+000152f0: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
+00015300: 662e 7375 6666 6978 2e73 7472 6970 2829  f.suffix.strip()
+00015310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015320: 2020 2020 202b 2066 696c 655f 6578 7465       + file_exte
+00015330: 6e73 696f 6e0a 2020 2020 2020 2020 2020  nsion.          
+00015340: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00015350: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00015360: 2020 206e 6962 2e73 6176 6528 6f75 745f     nib.save(out_
+00015370: 696d 672c 2066 696c 655f 6f75 7429 0a0a  img, file_out)..
+00015380: 0a63 6c61 7373 2049 6e74 656e 7369 7479  .class Intensity
+00015390: 436c 6970 2850 726f 6365 7373 4d49 4129  Clip(ProcessMIA)
+000153a0: 3a0a 2020 2020 2222 220a 2020 2020 2a43  :.    """.    *C
+000153b0: 6c69 7020 7468 6520 696e 7465 6e73 6974  lip the intensit
+000153c0: 7920 7261 6e67 6520 6173 2070 7265 7363  y range as presc
+000153d0: 7269 6265 6420 6279 2074 6865 2070 6572  ribed by the per
+000153e0: 6365 6e74 696c 6573 2a0a 0a20 2020 2050  centiles*..    P
+000153f0: 6c65 6173 652c 2073 6565 2074 6865 2063  lease, see the c
+00015400: 6f6d 706c 6574 6520 646f 6375 6d65 6e74  omplete document
+00015410: 6174 696f 6e20 666f 7220 7468 6520 6049  ation for the `I
+00015420: 6e74 656e 7369 7479 436c 6970 2062 7269  ntensityClip bri
+00015430: 636b 2069 6e0a 2020 2020 7468 6520 6d69  ck in.    the mi
+00015440: 615f 7072 6f63 6573 7365 7320 7765 6273  a_processes webs
+00015450: 6974 650a 2020 2020 3c68 7474 7073 3a2f  ite.    <https:/
+00015460: 2f70 6f70 756c 7365 2e67 6974 6875 622e  /populse.github.
+00015470: 696f 2f6d 6961 5f70 726f 6365 7373 6573  io/mia_processes
+00015480: 2f68 746d 6c2f 646f 6375 6d65 6e74 6174  /html/documentat
+00015490: 696f 6e2f 6272 6963 6b73 2f70 7265 7072  ion/bricks/prepr
+000154a0: 6f63 6573 732f 6f74 6865 722f 496e 7465  ocess/other/Inte
+000154b0: 6e73 6974 7943 6c69 702e 6874 6d6c 3e60  nsityClip.html>`
+000154c0: 5f0a 0a20 2020 2022 2222 0a0a 2020 2020  _..    """..    
+000154d0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000154e0: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
+000154f0: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
+00015500: 6174 7472 6962 7574 6573 2069 6e69 7469  attributes initi
+00015510: 616c 6973 6174 696f 6e20 2f20 696e 7374  alisation / inst
+00015520: 616e 7469 6174 696f 6e2e 0a0a 2020 2020  antiation...    
+00015530: 2020 2020 5468 6520 696e 7075 7420 616e      The input an
+00015540: 6420 6f75 7470 7574 2070 6c75 6773 2061  d output plugs a
+00015550: 7265 2064 6566 696e 6564 2068 6572 652e  re defined here.
+00015560: 2054 6865 2073 7065 6369 616c 0a20 2020   The special.   
+00015570: 2020 2020 2027 7365 6c66 2e72 6571 7569       'self.requi
+00015580: 7265 6d65 6e74 2720 6174 7472 6962 7574  rement' attribut
+00015590: 6520 286f 7074 696f 6e61 6c29 2069 7320  e (optional) is 
+000155a0: 7573 6564 2074 6f20 6465 6669 6e65 2074  used to define t
+000155b0: 6865 0a20 2020 2020 2020 2074 6869 7264  he.        third
+000155c0: 2d70 6172 7479 2070 726f 6475 6374 7320  -party products 
+000155d0: 6e65 6365 7373 6172 7920 666f 7220 7468  necessary for th
+000155e0: 6520 7275 6e6e 696e 6720 6f66 2074 6865  e running of the
+000155f0: 2062 7269 636b 2e0a 2020 2020 2020 2020   brick..        
+00015600: 2222 220a 2020 2020 2020 2020 2320 496e  """.        # In
+00015610: 6974 6961 6c69 7361 7469 6f6e 206f 6620  itialisation of 
+00015620: 7468 6520 6f62 6a65 6374 7320 6e65 6564  the objects need
+00015630: 6564 2066 6f72 2074 6865 206c 6175 6e63  ed for the launc
+00015640: 6820 6f66 2074 6865 2062 7269 636b 0a20  h of the brick. 
+00015650: 2020 2020 2020 2073 7570 6572 2849 6e74         super(Int
+00015660: 656e 7369 7479 436c 6970 2c20 7365 6c66  ensityClip, self
+00015670: 292e 5f5f 696e 6974 5f5f 2829 0a0a 2020  ).__init__()..  
+00015680: 2020 2020 2020 2320 5468 6972 6420 7061        # Third pa
+00015690: 7274 7920 736f 6674 7761 7265 7320 7265  rty softwares re
+000156a0: 7175 6972 6564 2066 6f72 2074 6865 2065  quired for the e
+000156b0: 7865 6375 7469 6f6e 206f 6620 7468 6520  xecution of the 
+000156c0: 6272 6963 6b0a 2020 2020 2020 2020 7365  brick.        se
+000156d0: 6c66 2e72 6571 7569 7265 6d65 6e74 203d  lf.requirement =
+000156e0: 205b 5d0a 0a20 2020 2020 2020 2023 2049   []..        # I
+000156f0: 6e70 7574 7320 6465 7363 7269 7074 696f  nputs descriptio
+00015700: 6e0a 2020 2020 2020 2020 696e 5f66 696c  n.        in_fil
+00015710: 655f 6465 7363 203d 2022 3344 2066 696c  e_desc = "3D fil
+00015720: 6520 7768 6963 6820 696e 7465 6e73 6974  e which intensit
+00015730: 7920 7769 6c6c 2062 6520 636c 6970 7065  y will be clippe
+00015740: 6422 0a20 2020 2020 2020 2070 5f6d 696e  d".        p_min
+00015750: 5f64 6573 6320 3d20 2250 6572 6365 6e74  _desc = "Percent
+00015760: 696c 6520 666f 7220 7468 6520 6c6f 7765  ile for the lowe
+00015770: 7220 626f 756e 6422 0a20 2020 2020 2020  r bound".       
+00015780: 2070 5f6d 6178 5f64 6573 6320 3d20 2250   p_max_desc = "P
+00015790: 6572 6365 6e74 696c 6520 666f 7220 7468  ercentile for th
+000157a0: 6520 7570 7065 7220 626f 756e 6422 0a20  e upper bound". 
+000157b0: 2020 2020 2020 2064 7479 7065 5f64 6573         dtype_des
+000157c0: 6320 3d20 224f 7574 7075 7420 6461 7461  c = "Output data
+000157d0: 7479 7065 220a 2020 2020 2020 2020 6e6f  type".        no
+000157e0: 6e6e 6567 6174 6976 655f 6465 7363 203d  nnegative_desc =
+000157f0: 2022 5768 6574 6865 7220 696e 7075 7420   "Whether input 
+00015800: 696e 7465 6e73 6974 6965 7320 6d75 7374  intensities must
+00015810: 2062 6520 706f 7369 7469 7665 220a 2020   be positive".  
+00015820: 2020 2020 2020 696e 7665 7274 5f64 6573        invert_des
+00015830: 6320 3d20 2246 696e 616c 697a 6520 6279  c = "Finalize by
+00015840: 2069 6e76 6572 7469 6e67 2063 6f6e 7472   inverting contr
+00015850: 6173 7422 0a0a 2020 2020 2020 2020 2320  ast"..        # 
+00015860: 4f75 7470 7574 7320 6465 7363 7269 7074  Outputs descript
+00015870: 696f 6e0a 2020 2020 2020 2020 6f75 745f  ion.        out_
+00015880: 6669 6c65 5f64 6573 6320 3d20 2246 696c  file_desc = "Fil
+00015890: 6520 6166 7465 7220 636c 6970 7069 6e67  e after clipping
+000158a0: 220a 0a20 2020 2020 2020 2023 204d 616e  "..        # Man
+000158b0: 6461 746f 7279 2069 6e70 7574 7320 7472  datory inputs tr
+000158c0: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
+000158d0: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
+000158e0: 2020 2020 2020 2020 2022 696e 5f66 696c           "in_fil
+000158f0: 6522 2c20 4669 6c65 286f 7574 7075 743d  e", File(output=
+00015900: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+00015910: 4661 6c73 652c 2064 6573 633d 696e 5f66  False, desc=in_f
+00015920: 696c 655f 6465 7363 290a 2020 2020 2020  ile_desc).      
+00015930: 2020 290a 0a20 2020 2020 2020 2023 204f    )..        # O
+00015940: 7074 696f 6e61 6c20 696e 7075 7473 2077  ptional inputs w
+00015950: 6974 6820 6465 6661 756c 7420 7661 6c75  ith default valu
+00015960: 6520 7472 6169 7473 0a20 2020 2020 2020  e traits.       
+00015970: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+00015980: 0a20 2020 2020 2020 2020 2020 2022 6474  .            "dt
+00015990: 7970 6522 2c0a 2020 2020 2020 2020 2020  ype",.          
+000159a0: 2020 7472 6169 7473 2e45 6e75 6d28 0a20    traits.Enum(. 
+000159b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000159c0: 696e 7431 3622 2c0a 2020 2020 2020 2020  int16",.        
+000159d0: 2020 2020 2020 2020 2266 6c6f 6174 3332          "float32
+000159e0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+000159f0: 2020 2022 7569 6e74 3822 2c0a 2020 2020     "uint8",.    
+00015a00: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00015a10: 7574 3d46 616c 7365 2c0a 2020 2020 2020  ut=False,.      
+00015a20: 2020 2020 2020 2020 2020 6f70 7469 6f6e            option
+00015a30: 616c 3d54 7275 652c 0a20 2020 2020 2020  al=True,.       
+00015a40: 2020 2020 2020 2020 2064 6573 633d 6474           desc=dt
+00015a50: 7970 655f 6465 7363 2c0a 2020 2020 2020  ype_desc,.      
+00015a60: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00015a70: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+00015a80: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
+00015a90: 2020 2020 2020 2020 2269 6e76 6572 7422          "invert"
+00015aa0: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
+00015ab0: 6169 7473 2e42 6f6f 6c28 0a20 2020 2020  aits.Bool(.     
+00015ac0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00015ad0: 6c74 5f76 616c 7565 3d46 616c 7365 2c0a  lt_value=False,.
+00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015af0: 6f75 7470 7574 3d46 616c 7365 2c0a 2020  output=False,.  
+00015b00: 2020 2020 2020 2020 2020 2020 2020 6f70                op
+00015b10: 7469 6f6e 616c 3d54 7275 652c 0a20 2020  tional=True,.   
+00015b20: 2020 2020 2020 2020 2020 2020 2064 6573               des
+00015b30: 633d 696e 7665 7274 5f64 6573 632c 0a20  c=invert_desc,. 
+00015b40: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00015b50: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00015b60: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+00015b70: 0a20 2020 2020 2020 2020 2020 2022 6e6f  .            "no
+00015b80: 6e6e 6567 6174 6976 6522 2c0a 2020 2020  nnegative",.    
+00015b90: 2020 2020 2020 2020 7472 6169 7473 2e42          traits.B
+00015ba0: 6f6f 6c28 0a20 2020 2020 2020 2020 2020  ool(.           
+00015bb0: 2020 2020 2064 6566 6175 6c74 5f76 616c       default_val
+00015bc0: 7565 3d54 7275 652c 0a20 2020 2020 2020  ue=True,.       
+00015bd0: 2020 2020 2020 2020 206f 7574 7075 743d           output=
+00015be0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+00015bf0: 2020 2020 2020 206f 7074 696f 6e61 6c3d         optional=
+00015c00: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00015c10: 2020 2020 2020 6465 7363 3d6e 6f6e 6e65        desc=nonne
+00015c20: 6761 7469 7665 5f64 6573 632c 0a20 2020  gative_desc,.   
+00015c30: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+00015c40: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+00015c50: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
+00015c60: 2020 2020 2020 2020 2020 2022 705f 6d61             "p_ma
+00015c70: 7822 2c0a 2020 2020 2020 2020 2020 2020  x",.            
+00015c80: 7472 6169 7473 2e46 6c6f 6174 280a 2020  traits.Float(.  
+00015c90: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00015ca0: 6661 756c 745f 7661 6c75 653d 3939 2e39  fault_value=99.9
+00015cb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015cc0: 2020 6f75 7470 7574 3d46 616c 7365 2c0a    output=False,.
+00015cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ce0: 6f70 7469 6f6e 616c 3d54 7275 652c 0a20  optional=True,. 
+00015cf0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00015d00: 6573 633d 705f 6d61 785f 6465 7363 2c0a  esc=p_max_desc,.
+00015d10: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00015d20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00015d30: 2020 7365 6c66 2e61 6464 5f74 7261 6974    self.add_trait
+00015d40: 280a 2020 2020 2020 2020 2020 2020 2270  (.            "p
+00015d50: 5f6d 696e 222c 0a20 2020 2020 2020 2020  _min",.         
+00015d60: 2020 2074 7261 6974 732e 466c 6f61 7428     traits.Float(
+00015d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015d80: 2064 6566 6175 6c74 5f76 616c 7565 3d31   default_value=1
+00015d90: 302e 302c 0a20 2020 2020 2020 2020 2020  0.0,.           
+00015da0: 2020 2020 206f 7574 7075 743d 4661 6c73       output=Fals
+00015db0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00015dc0: 2020 206f 7074 696f 6e61 6c3d 5472 7565     optional=True
+00015dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015de0: 2020 6465 7363 3d70 5f6d 696e 5f64 6573    desc=p_min_des
+00015df0: 632c 0a20 2020 2020 2020 2020 2020 2029  c,.            )
+00015e00: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00015e10: 2020 2020 2023 204f 7574 7075 7473 2074       # Outputs t
+00015e20: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
+00015e30: 6c66 2e61 6464 5f74 7261 6974 2822 6f75  lf.add_trait("ou
+00015e40: 745f 6669 6c65 222c 2046 696c 6528 6f75  t_file", File(ou
+00015e50: 7470 7574 3d54 7275 652c 2064 6573 633d  tput=True, desc=
+00015e60: 6f75 745f 6669 6c65 5f64 6573 6329 290a  out_file_desc)).
+00015e70: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+00015e80: 6974 5f64 6566 6175 6c74 5f74 7261 6974  it_default_trait
+00015e90: 7328 290a 0a20 2020 2064 6566 206c 6973  s()..    def lis
+00015ea0: 745f 6f75 7470 7574 7328 7365 6c66 2c20  t_outputs(self, 
+00015eb0: 6973 5f70 6c75 6767 6564 3d4e 6f6e 6529  is_plugged=None)
+00015ec0: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
+00015ed0: 6963 6174 6564 2074 6f20 7468 6520 696e  icated to the in
+00015ee0: 6974 6961 6c69 7361 7469 6f6e 2073 7465  itialisation ste
+00015ef0: 7020 6f66 2074 6865 2062 7269 636b 2e0a  p of the brick..
+00015f00: 0a20 2020 2020 2020 2054 6865 206d 6169  .        The mai
+00015f10: 6e20 6f62 6a65 6374 6976 6520 6f66 2074  n objective of t
+00015f20: 6869 7320 6d65 7468 6f64 2069 7320 746f  his method is to
+00015f30: 2070 726f 6475 6365 2074 6865 206f 7574   produce the out
+00015f40: 7075 7473 206f 6620 7468 650a 2020 2020  puts of the.    
+00015f50: 2020 2020 6272 6963 6b73 2028 7365 6c66      bricks (self
+00015f60: 2e6f 7574 7075 7473 2920 616e 6420 7468  .outputs) and th
+00015f70: 6520 6173 736f 6369 6174 6564 2074 6167  e associated tag
+00015f80: 7320 2873 656c 662e 696e 6865 7269 7461  s (self.inherita
+00015f90: 6e63 655f 6469 6329 2c0a 2020 2020 2020  nce_dic),.      
+00015fa0: 2020 6966 2064 6566 696e 6564 2068 6572    if defined her
+00015fb0: 652e 2054 6f20 776f 726b 2070 726f 7065  e. To work prope
+00015fc0: 726c 7920 7468 6973 206d 6574 686f 6420  rly this method 
+00015fd0: 6d75 7374 2072 6574 7572 6e0a 2020 2020  must return.    
+00015fe0: 2020 2020 7365 6c66 2e6d 616b 655f 696e      self.make_in
+00015ff0: 6974 5265 7375 6c74 2829 206f 626a 6563  itResult() objec
+00016000: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
+00016010: 616d 2069 735f 706c 7567 6765 643a 2074  am is_plugged: t
+00016020: 6865 2073 7461 7465 2c20 6c69 6e6b 6564  he state, linked
+00016030: 206f 7220 6e6f 742c 206f 6620 7468 6520   or not, of the 
+00016040: 706c 7567 732e 0a20 2020 2020 2020 203a  plugs..        :
+00016050: 7265 7475 726e 733a 2061 2064 6963 7469  returns: a dicti
+00016060: 6f6e 6172 7920 7769 7468 2072 6571 7569  onary with requi
+00016070: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
+00016080: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
+00016090: 6469 6374 2e0a 2020 2020 2020 2020 2222  dict..        ""
+000160a0: 220a 2020 2020 2020 2020 2320 5573 696e  ".        # Usin
+000160b0: 6720 7468 6520 696e 6865 7269 7461 6e63  g the inheritanc
+000160c0: 6520 746f 2050 726f 6365 7373 4d49 4120  e to ProcessMIA 
+000160d0: 636c 6173 732c 206c 6973 745f 6f75 7470  class, list_outp
+000160e0: 7574 7320 6d65 7468 6f64 0a20 2020 2020  uts method.     
+000160f0: 2020 2073 7570 6572 2849 6e74 656e 7369     super(Intensi
+00016100: 7479 436c 6970 2c20 7365 6c66 292e 6c69  tyClip, self).li
+00016110: 7374 5f6f 7574 7075 7473 2829 0a0a 2020  st_outputs()..  
+00016120: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
+00016130: 5f66 696c 653a 0a20 2020 2020 2020 2020  _file:.         
+00016140: 2020 2069 6620 7365 6c66 2e6f 7574 7075     if self.outpu
+00016150: 745f 6469 7265 6374 6f72 793a 0a20 2020  t_directory:.   
+00016160: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00016170: 662e 6f75 7470 7574 735b 226f 7574 5f66  f.outputs["out_f
+00016180: 696c 6522 5d20 3d20 6f73 2e70 6174 682e  ile"] = os.path.
+00016190: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
+000161a0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+000161b0: 7574 7075 745f 6469 7265 6374 6f72 792c  utput_directory,
+000161c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000161d0: 2020 2020 206f 732e 7061 7468 2e73 706c       os.path.spl
+000161e0: 6974 2873 656c 662e 696e 5f66 696c 6529  it(self.in_file)
+000161f0: 5b31 5d2e 7265 706c 6163 6528 0a20 2020  [1].replace(.   
+00016200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016210: 2020 2020 2022 2e6e 6969 222c 2022 5f63       ".nii", "_c
+00016220: 6c69 7070 6564 2e6e 6969 220a 2020 2020  lipped.nii".    
+00016230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016240: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00016250: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00016260: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00016270: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+00016280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016290: 2020 2249 6e74 656e 7369 7479 436c 6970    "IntensityClip
+000162a0: 2062 7269 636b 3a20 4e6f 206f 7574 7075   brick: No outpu
+000162b0: 745f 6469 7265 6374 6f72 7920 7761 7320  t_directory was 
+000162c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000162d0: 2020 2020 2020 2266 6f75 6e64 2e2e 2e21        "found...!
+000162e0: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+000162f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00016300: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00016310: 2020 2020 2020 6966 2073 656c 662e 6f75        if self.ou
+00016320: 7470 7574 733a 0a20 2020 2020 2020 2020  tputs:.         
+00016330: 2020 2073 656c 662e 7461 6773 5f69 6e68     self.tags_inh
+00016340: 6572 6974 616e 6365 280a 2020 2020 2020  eritance(.      
+00016350: 2020 2020 2020 2020 2020 696e 5f66 696c            in_fil
+00016360: 653d 7365 6c66 2e69 6e5f 6669 6c65 2c0a  e=self.in_file,.
+00016370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016380: 6f75 745f 6669 6c65 3d73 656c 662e 6f75  out_file=self.ou
+00016390: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
+000163a0: 5d2c 0a20 2020 2020 2020 2020 2020 2029  ],.            )
+000163b0: 0a0a 2020 2020 2020 2020 2320 5265 7475  ..        # Retu
+000163c0: 726e 2074 6865 2072 6571 7569 7265 6d65  rn the requireme
+000163d0: 6e74 2c20 6f75 7470 7574 7320 616e 6420  nt, outputs and 
+000163e0: 696e 6865 7269 7461 6e63 655f 6469 6374  inheritance_dict
+000163f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016400: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
+00016410: 7375 6c74 2829 0a0a 2020 2020 6465 6620  sult()..    def 
+00016420: 7275 6e5f 7072 6f63 6573 735f 6d69 6128  run_process_mia(
+00016430: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00016440: 2222 4465 6469 6361 7465 6420 746f 2074  ""Dedicated to t
+00016450: 6865 2070 726f 6365 7373 206c 6175 6e63  he process launc
+00016460: 6820 7374 6570 206f 6620 7468 6520 6272  h step of the br
+00016470: 6963 6b2e 2222 220a 0a20 2020 2020 2020  ick."""..       
+00016480: 2073 7570 6572 2849 6e74 656e 7369 7479   super(Intensity
+00016490: 436c 6970 2c20 7365 6c66 292e 7275 6e5f  Clip, self).run_
+000164a0: 7072 6f63 6573 735f 6d69 6128 290a 0a20  process_mia().. 
+000164b0: 2020 2020 2020 2069 6e5f 6669 6c65 203d         in_file =
+000164c0: 2073 656c 662e 696e 5f66 696c 650a 2020   self.in_file.  
+000164d0: 2020 2020 2020 6f75 745f 6669 6c65 203d        out_file =
+000164e0: 2073 656c 662e 6f75 745f 6669 6c65 0a20   self.out_file. 
+000164f0: 2020 2020 2020 206e 6f6e 6e65 6761 7469         nonnegati
+00016500: 7665 203d 2073 656c 662e 6e6f 6e6e 6567  ve = self.nonneg
+00016510: 6174 6976 650a 2020 2020 2020 2020 705f  ative.        p_
+00016520: 6d69 6e20 3d20 7365 6c66 2e70 5f6d 696e  min = self.p_min
+00016530: 0a20 2020 2020 2020 2070 5f6d 6178 203d  .        p_max =
+00016540: 2073 656c 662e 705f 6d61 780a 2020 2020   self.p_max.    
+00016550: 2020 2020 696e 7665 7274 203d 2073 656c      invert = sel
+00016560: 662e 696e 7665 7274 0a20 2020 2020 2020  f.invert.       
+00016570: 2064 7479 7065 203d 2073 656c 662e 6474   dtype = self.dt
+00016580: 7970 650a 0a20 2020 2020 2020 2023 204c  ype..        # L
+00016590: 6f61 6420 6461 7461 0a20 2020 2020 2020  oad data.       
+000165a0: 2069 6d67 203d 206e 6962 2e73 7175 6565   img = nib.squee
+000165b0: 7a65 5f69 6d61 6765 286e 6962 2e6c 6f61  ze_image(nib.loa
+000165c0: 6428 696e 5f66 696c 6529 290a 2020 2020  d(in_file)).    
+000165d0: 2020 2020 6966 206c 656e 2869 6d67 2e73      if len(img.s
+000165e0: 6861 7065 2920 213d 2033 3a0a 2020 2020  hape) != 3:.    
+000165f0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+00016600: 6e74 696d 6545 7272 6f72 2866 223c 7b69  ntimeError(f"<{i
+00016610: 6e5f 6669 6c65 7d3e 2069 7320 6e6f 7420  n_file}> is not 
+00016620: 6120 3344 2066 696c 652e 2229 0a20 2020  a 3D file.").   
+00016630: 2020 2020 2064 6174 6120 3d20 696d 672e       data = img.
+00016640: 6765 745f 6664 6174 6128 6474 7970 653d  get_fdata(dtype=
+00016650: 2266 6c6f 6174 3332 2229 0a0a 2020 2020  "float32")..    
+00016660: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+00016670: 7374 6174 7320 6f6e 2064 656e 6f69 7365  stats on denoise
+00016680: 6420 7665 7273 696f 6e2c 2074 6f20 7072  d version, to pr
+00016690: 6565 6d70 7420 6f75 746c 6965 7273 2066  eempt outliers f
+000166a0: 726f 6d20 6269 6173 696e 670a 2020 2020  rom biasing.    
+000166b0: 2020 2020 6465 6e6f 6973 6564 203d 2073      denoised = s
+000166c0: 696d 2e6d 6564 6961 6e5f 6669 6c74 6572  im.median_filter
+000166d0: 2864 6174 612c 2066 6f6f 7470 7269 6e74  (data, footprint
+000166e0: 3d62 616c 6c28 3329 290a 0a20 2020 2020  =ball(3))..     
+000166f0: 2020 2061 5f6d 696e 203d 206e 702e 7065     a_min = np.pe
+00016700: 7263 656e 7469 6c65 280a 2020 2020 2020  rcentile(.      
+00016710: 2020 2020 2020 6465 6e6f 6973 6564 5b64        denoised[d
+00016720: 656e 6f69 7365 6420 3e20 305d 2069 6620  enoised > 0] if 
+00016730: 6e6f 6e6e 6567 6174 6976 6520 656c 7365  nonnegative else
+00016740: 2064 656e 6f69 7365 642c 2070 5f6d 696e   denoised, p_min
+00016750: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00016760: 2020 2061 5f6d 6178 203d 206e 702e 7065     a_max = np.pe
+00016770: 7263 656e 7469 6c65 280a 2020 2020 2020  rcentile(.      
+00016780: 2020 2020 2020 6465 6e6f 6973 6564 5b64        denoised[d
+00016790: 656e 6f69 7365 6420 3e20 305d 2069 6620  enoised > 0] if 
+000167a0: 6e6f 6e6e 6567 6174 6976 6520 656c 7365  nonnegative else
+000167b0: 2064 656e 6f69 7365 642c 2070 5f6d 6178   denoised, p_max
+000167c0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000167d0: 2020 2020 2320 436c 6970 2061 6e64 2063      # Clip and c
+000167e0: 6173 740a 2020 2020 2020 2020 6461 7461  ast.        data
+000167f0: 203d 206e 702e 636c 6970 2864 6174 612c   = np.clip(data,
+00016800: 2061 5f6d 696e 3d61 5f6d 696e 2c20 615f   a_min=a_min, a_
+00016810: 6d61 783d 615f 6d61 7829 0a20 2020 2020  max=a_max).     
+00016820: 2020 2064 6174 6120 2d3d 2064 6174 612e     data -= data.
+00016830: 6d69 6e28 290a 2020 2020 2020 2020 6461  min().        da
+00016840: 7461 202f 3d20 6461 7461 2e6d 6178 2829  ta /= data.max()
+00016850: 0a0a 2020 2020 2020 2020 6966 2069 6e76  ..        if inv
+00016860: 6572 743a 0a20 2020 2020 2020 2020 2020  ert:.           
+00016870: 2064 6174 6120 3d20 312e 3020 2d20 6461   data = 1.0 - da
+00016880: 7461 0a0a 2020 2020 2020 2020 6966 2064  ta..        if d
+00016890: 7479 7065 2069 6e20 2822 7569 6e74 3822  type in ("uint8"
+000168a0: 2c20 2269 6e74 3136 2229 3a0a 2020 2020  , "int16"):.    
+000168b0: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
+000168c0: 702e 726f 756e 6428 3235 3520 2a20 6461  p.round(255 * da
+000168d0: 7461 292e 6173 7479 7065 2864 7479 7065  ta).astype(dtype
+000168e0: 290a 0a20 2020 2020 2020 2068 6472 203d  )..        hdr =
+000168f0: 2069 6d67 2e68 6561 6465 722e 636f 7079   img.header.copy
+00016900: 2829 0a20 2020 2020 2020 2068 6472 2e73  ().        hdr.s
+00016910: 6574 5f64 6174 615f 6474 7970 6528 6474  et_data_dtype(dt
+00016920: 7970 6529 0a20 2020 2020 2020 2069 6d67  ype).        img
+00016930: 2e5f 5f63 6c61 7373 5f5f 2864 6174 612c  .__class__(data,
+00016940: 2069 6d67 2e61 6666 696e 652c 2068 6472   img.affine, hdr
+00016950: 292e 746f 5f66 696c 656e 616d 6528 6f75  ).to_filename(ou
+00016960: 745f 6669 6c65 290a 0a0a 636c 6173 7320  t_file)...class 
+00016970: 4d61 736b 2850 726f 6365 7373 4d49 4129  Mask(ProcessMIA)
+00016980: 3a0a 2020 2020 2222 220a 2020 2020 2a41  :.    """.    *A
+00016990: 7070 6c79 2061 2062 696e 6172 7920 6d61  pply a binary ma
+000169a0: 736b 2074 6f20 616e 2069 6d61 6765 2a0a  sk to an image*.
+000169b0: 0a20 2020 2050 6c65 6173 652c 2073 6565  .    Please, see
+000169c0: 2074 6865 2063 6f6d 706c 6574 6520 646f   the complete do
+000169d0: 6375 6d65 6e74 6174 696f 6e20 666f 7220  cumentation for 
+000169e0: 7468 6520 604d 6173 6b20 6272 6963 6b0a  the `Mask brick.
+000169f0: 2020 2020 696e 2074 6865 206d 6961 5f70      in the mia_p
+00016a00: 726f 6365 7373 6573 2077 6562 7369 7465  rocesses website
+00016a10: 0a20 2020 203c 6874 7470 733a 2f2f 706f  .    <https://po
+00016a20: 7075 6c73 652e 6769 7468 7562 2e69 6f2f  pulse.github.io/
+00016a30: 6d69 615f 7072 6f63 6573 7365 732f 6874  mia_processes/ht
+00016a40: 6d6c 2f64 6f63 756d 656e 7461 7469 6f6e  ml/documentation
+00016a50: 2f62 7269 636b 732f 7072 6570 726f 6365  /bricks/preproce
+00016a60: 7373 2f6f 7468 6572 2f4d 6173 6b2e 6874  ss/other/Mask.ht
+00016a70: 6d6c 3e60 5f0a 0a20 2020 2061 6461 7074  ml>`_..    adapt
+00016a80: 6564 2066 726f 6d3a 0a20 2020 2068 7474  ed from:.    htt
+00016a90: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00016aa0: 6e69 7072 6570 732f 6e69 776f 726b 666c  nipreps/niworkfl
+00016ab0: 6f77 732f 626c 6f62 2f34 3561 6231 3365  ows/blob/45ab13e
+00016ac0: 3162 6636 6664 6266 3565 3239 6339 3063  1bf6fdbf5e29c90c
+00016ad0: 6566 3434 3035 3562 3062 3963 6633 3931  ef44055b0b9cf391
+00016ae0: 622f 6e69 776f 726b 666c 6f77 732f 696e  b/niworkflows/in
+00016af0: 7465 7266 6163 6573 2f6e 6f72 6d2e 7079  terfaces/norm.py
+00016b00: 234c 3437 340a 0a20 2020 2022 2222 0a0a  #L474..    """..
+00016b10: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00016b20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00016b30: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
+00016b40: 7468 6520 6174 7472 6962 7574 6573 2069  the attributes i
+00016b50: 6e69 7469 616c 6973 6174 696f 6e20 2f20  nitialisation / 
+00016b60: 696e 7374 616e 7469 6174 696f 6e2e 0a0a  instantiation...
+00016b70: 2020 2020 2020 2020 5468 6520 696e 7075          The inpu
+00016b80: 7420 616e 6420 6f75 7470 7574 2070 6c75  t and output plu
+00016b90: 6773 2061 7265 2064 6566 696e 6564 2068  gs are defined h
+00016ba0: 6572 652e 2054 6865 2073 7065 6369 616c  ere. The special
+00016bb0: 0a20 2020 2020 2020 2027 7365 6c66 2e72  .        'self.r
+00016bc0: 6571 7569 7265 6d65 6e74 2720 6174 7472  equirement' attr
+00016bd0: 6962 7574 6520 286f 7074 696f 6e61 6c29  ibute (optional)
+00016be0: 2069 7320 7573 6564 2074 6f20 6465 6669   is used to defi
+00016bf0: 6e65 2074 6865 0a20 2020 2020 2020 2074  ne the.        t
+00016c00: 6869 7264 2d70 6172 7479 2070 726f 6475  hird-party produ
+00016c10: 6374 7320 6e65 6365 7373 6172 7920 666f  cts necessary fo
+00016c20: 7220 7468 6520 7275 6e6e 696e 6720 6f66  r the running of
+00016c30: 2074 6865 2062 7269 636b 2e0a 2020 2020   the brick..    
+00016c40: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016c50: 2320 496e 6974 6961 6c69 7361 7469 6f6e  # Initialisation
+00016c60: 206f 6620 7468 6520 6f62 6a65 6374 7320   of the objects 
+00016c70: 6e65 6564 6564 2066 6f72 2074 6865 206c  needed for the l
+00016c80: 6175 6e63 6820 6f66 2074 6865 2062 7269  aunch of the bri
+00016c90: 636b 0a20 2020 2020 2020 2073 7570 6572  ck.        super
+00016ca0: 284d 6173 6b2c 2073 656c 6629 2e5f 5f69  (Mask, self).__i
+00016cb0: 6e69 745f 5f28 290a 0a20 2020 2020 2020  nit__()..       
+00016cc0: 2023 2054 6869 7264 2070 6172 7479 2073   # Third party s
+00016cd0: 6f66 7477 6172 6573 2072 6571 7569 7265  oftwares require
+00016ce0: 6420 666f 7220 7468 6520 6578 6563 7574  d for the execut
+00016cf0: 696f 6e20 6f66 2074 6865 2062 7269 636b  ion of the brick
+00016d00: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+00016d10: 7175 6972 656d 656e 7420 3d20 5b5d 0a0a  quirement = []..
+00016d20: 2020 2020 2020 2020 2320 496e 7075 7473          # Inputs
+00016d30: 2064 6573 6372 6970 7469 6f6e 0a20 2020   description.   
+00016d40: 2020 2020 2069 6e5f 6669 6c65 5f64 6573       in_file_des
+00016d50: 6320 3d20 2241 6e20 6578 6973 7469 6e67  c = "An existing
+00016d60: 2070 6174 6820 6669 6c65 2e22 0a20 2020   path file.".   
+00016d70: 2020 2020 206d 6173 6b5f 6669 6c65 5f64       mask_file_d
+00016d80: 6573 6320 3d20 2241 6e20 6578 6973 7469  esc = "An existi
+00016d90: 6e67 2070 6174 6820 6669 6c65 2e22 0a20  ng path file.". 
+00016da0: 2020 2020 2020 2070 7265 6669 785f 6465         prefix_de
+00016db0: 7363 203d 2022 5072 6566 6978 206f 6620  sc = "Prefix of 
+00016dc0: 7468 6520 6f75 7470 7574 2069 6d61 6765  the output image
+00016dd0: 2028 6120 7374 7269 6e67 292e 220a 2020   (a string).".  
+00016de0: 2020 2020 2020 7375 6666 6978 5f64 6573        suffix_des
+00016df0: 6320 3d20 2253 7566 6669 7820 6f66 2074  c = "Suffix of t
+00016e00: 6865 206f 7574 7075 7420 696d 6167 6520  he output image 
+00016e10: 2861 2073 7472 696e 6729 2e22 0a0a 2020  (a string)."..  
+00016e20: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
+00016e30: 6465 7363 7269 7074 696f 6e0a 2020 2020  description.    
+00016e40: 2020 2020 6f75 745f 6669 6c65 5f64 6573      out_file_des
+00016e50: 6320 3d20 280a 2020 2020 2020 2020 2020  c = (.          
+00016e60: 2020 2250 6174 6820 6f66 2074 6865 2073    "Path of the s
+00016e70: 6361 6e20 6166 7465 7220 6d61 736b 696e  can after maskin
+00016e80: 6720 220a 2020 2020 2020 2020 2020 2020  g ".            
+00016e90: 2228 6120 7061 7468 6c69 6b65 206f 626a  "(a pathlike obj
+00016ea0: 6563 7420 6f72 2073 7472 696e 6720 7265  ect or string re
+00016eb0: 7072 6573 656e 7469 6e67 2061 2066 696c  presenting a fil
+00016ec0: 6529 2e22 0a20 2020 2020 2020 2029 0a0a  e).".        )..
+00016ed0: 2020 2020 2020 2020 2320 496e 7075 7473          # Inputs
+00016ee0: 2074 7261 6974 730a 2020 2020 2020 2020   traits.        
+00016ef0: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+00016f00: 2020 2020 2020 2020 2020 2020 2269 6e5f              "in_
+00016f10: 6669 6c65 222c 2046 696c 6528 6f75 7470  file", File(outp
+00016f20: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
+00016f30: 616c 3d46 616c 7365 2c20 6465 7363 3d69  al=False, desc=i
+00016f40: 6e5f 6669 6c65 5f64 6573 6329 0a20 2020  n_file_desc).   
+00016f50: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00016f60: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+00016f70: 2020 2020 2020 2020 2020 2020 226d 6173              "mas
+00016f80: 6b5f 6669 6c65 222c 0a20 2020 2020 2020  k_file",.       
+00016f90: 2020 2020 2046 696c 6528 6f75 7470 7574       File(output
+00016fa0: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
+00016fb0: 3d46 616c 7365 2c20 6465 7363 3d6d 6173  =False, desc=mas
+00016fc0: 6b5f 6669 6c65 5f64 6573 6329 2c0a 2020  k_file_desc),.  
+00016fd0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00016fe0: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+00016ff0: 0a20 2020 2020 2020 2020 2020 2022 7072  .            "pr
+00017000: 6566 6978 222c 0a20 2020 2020 2020 2020  efix",.         
+00017010: 2020 2074 7261 6974 732e 5374 7269 6e67     traits.String
+00017020: 2822 222c 206f 7574 7075 743d 4661 6c73  ("", output=Fals
+00017030: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
+00017040: 2c20 6465 7363 3d70 7265 6669 785f 6465  , desc=prefix_de
+00017050: 7363 292c 0a20 2020 2020 2020 2029 0a0a  sc),.        )..
+00017060: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+00017070: 5f74 7261 6974 280a 2020 2020 2020 2020  _trait(.        
+00017080: 2020 2020 2273 7566 6669 7822 2c0a 2020      "suffix",.  
+00017090: 2020 2020 2020 2020 2020 7472 6169 7473            traits
+000170a0: 2e53 7472 696e 6728 0a20 2020 2020 2020  .String(.       
+000170b0: 2020 2020 2020 2020 2022 5f6d 6173 6b65           "_maske
+000170c0: 6422 2c20 6f75 7470 7574 3d46 616c 7365  d", output=False
+000170d0: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
+000170e0: 2064 6573 633d 7375 6666 6978 5f64 6573   desc=suffix_des
+000170f0: 630a 2020 2020 2020 2020 2020 2020 292c  c.            ),
+00017100: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00017110: 2020 2020 2320 4f75 7470 7574 7320 7472      # Outputs tr
+00017120: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
+00017130: 662e 6164 645f 7472 6169 7428 226f 7574  f.add_trait("out
+00017140: 5f66 696c 6522 2c20 4669 6c65 286f 7574  _file", File(out
+00017150: 7075 743d 5472 7565 2c20 6465 7363 3d6f  put=True, desc=o
+00017160: 7574 5f66 696c 655f 6465 7363 2929 0a0a  ut_file_desc))..
+00017170: 2020 2020 2020 2020 7365 6c66 2e69 6e69          self.ini
+00017180: 745f 6465 6661 756c 745f 7472 6169 7473  t_default_traits
+00017190: 2829 0a0a 2020 2020 6465 6620 6c69 7374  ()..    def list
+000171a0: 5f6f 7574 7075 7473 2873 656c 662c 2069  _outputs(self, i
+000171b0: 735f 706c 7567 6765 643d 4e6f 6e65 293a  s_plugged=None):
+000171c0: 0a20 2020 2020 2020 2022 2222 4465 6469  .        """Dedi
+000171d0: 6361 7465 6420 746f 2074 6865 2069 6e69  cated to the ini
+000171e0: 7469 616c 6973 6174 696f 6e20 7374 6570  tialisation step
+000171f0: 206f 6620 7468 6520 6272 6963 6b2e 0a0a   of the brick...
+00017200: 2020 2020 2020 2020 5468 6520 6d61 696e          The main
+00017210: 206f 626a 6563 7469 7665 206f 6620 7468   objective of th
+00017220: 6973 206d 6574 686f 6420 6973 2074 6f20  is method is to 
+00017230: 7072 6f64 7563 6520 7468 6520 6f75 7470  produce the outp
+00017240: 7574 7320 6f66 2074 6865 0a20 2020 2020  uts of the.     
+00017250: 2020 2062 7269 636b 7320 2873 656c 662e     bricks (self.
+00017260: 6f75 7470 7574 7329 2061 6e64 2074 6865  outputs) and the
+00017270: 2061 7373 6f63 6961 7465 6420 7461 6773   associated tags
+00017280: 2028 7365 6c66 2e69 6e68 6572 6974 616e   (self.inheritan
+00017290: 6365 5f64 6963 292c 0a20 2020 2020 2020  ce_dic),.       
+000172a0: 2069 6620 6465 6669 6e65 6420 6865 7265   if defined here
+000172b0: 2e20 546f 2077 6f72 6b20 7072 6f70 6572  . To work proper
+000172c0: 6c79 2074 6869 7320 6d65 7468 6f64 206d  ly this method m
+000172d0: 7573 7420 7265 7475 726e 0a20 2020 2020  ust return.     
+000172e0: 2020 2073 656c 662e 6d61 6b65 5f69 6e69     self.make_ini
+000172f0: 7452 6573 756c 7428 2920 6f62 6a65 6374  tResult() object
+00017300: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00017310: 6d20 6973 5f70 6c75 6767 6564 3a20 7468  m is_plugged: th
+00017320: 6520 7374 6174 652c 206c 696e 6b65 6420  e state, linked 
+00017330: 6f72 206e 6f74 2c20 6f66 2074 6865 2070  or not, of the p
+00017340: 6c75 6773 2e0a 2020 2020 2020 2020 3a72  lugs..        :r
+00017350: 6574 7572 6e73 3a20 6120 6469 6374 696f  eturns: a dictio
+00017360: 6e61 7279 2077 6974 6820 7265 7175 6972  nary with requir
+00017370: 656d 656e 742c 206f 7574 7075 7473 2061  ement, outputs a
+00017380: 6e64 2069 6e68 6572 6974 616e 6365 5f64  nd inheritance_d
+00017390: 6963 742e 0a20 2020 2020 2020 2022 2222  ict..        """
+000173a0: 0a20 2020 2020 2020 2023 2055 7369 6e67  .        # Using
+000173b0: 2074 6865 2069 6e68 6572 6974 616e 6365   the inheritance
+000173c0: 2074 6f20 5072 6f63 6573 734d 4941 2063   to ProcessMIA c
+000173d0: 6c61 7373 2c20 6c69 7374 5f6f 7574 7075  lass, list_outpu
+000173e0: 7473 206d 6574 686f 640a 2020 2020 2020  ts method.      
+000173f0: 2020 7375 7065 7228 4d61 736b 2c20 7365    super(Mask, se
+00017400: 6c66 292e 6c69 7374 5f6f 7574 7075 7473  lf).list_outputs
+00017410: 2829 0a0a 2020 2020 2020 2020 2320 4f75  ()..        # Ou
+00017420: 7470 7574 7320 6465 6669 6e69 7469 6f6e  tputs definition
+00017430: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00017440: 2e69 6e5f 6669 6c65 3a0a 2020 2020 2020  .in_file:.      
+00017450: 2020 2020 2020 7661 6c69 645f 6578 742c        valid_ext,
+00017460: 2069 6e5f 6578 742c 2066 696c 654e 616d   in_ext, fileNam
+00017470: 6520 3d20 6368 6563 6b46 696c 6545 7874  e = checkFileExt
+00017480: 2873 656c 662e 696e 5f66 696c 652c 2045  (self.in_file, E
+00017490: 5854 290a 0a20 2020 2020 2020 2020 2020  XT)..           
+000174a0: 2069 6620 6e6f 7420 7661 6c69 645f 6578   if not valid_ex
+000174b0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+000174c0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+000174d0: 2020 2020 2020 2020 2020 2020 2020 225c                "\
+000174e0: 6e4d 6173 6b20 6272 6963 6b3a 2054 6865  nMask brick: The
+000174f0: 2069 6e70 7574 2069 6d61 6765 2066 6f72   input image for
+00017500: 6d61 7420 6973 206e 6f74 2022 0a20 2020  mat is not ".   
+00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017520: 2022 7265 636f 676e 697a 6564 2e2e 2e21   "recognized...!
+00017530: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00017540: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00017550: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00017560: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00017570: 2020 2020 2020 2020 2020 2020 2028 6e6f               (no
+00017580: 7420 7365 6c66 2e73 7566 6669 7829 0a20  t self.suffix). 
+00017590: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000175a0: 7220 2873 656c 662e 7375 6666 6978 2e69  r (self.suffix.i
+000175b0: 7373 7061 6365 2829 290a 2020 2020 2020  sspace()).      
+000175c0: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
+000175d0: 662e 7375 6666 6978 2069 6e20 5b55 6e64  f.suffix in [Und
+000175e0: 6566 696e 6564 2c20 223c 756e 6465 6669  efined, "<undefi
+000175f0: 6e65 643e 225d 0a20 2020 2020 2020 2020  ned>"].         
+00017600: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00017610: 2020 2020 2020 7365 6c66 2e73 7566 6669        self.suffi
+00017620: 7820 3d20 2220 220a 0a20 2020 2020 2020  x = " "..       
+00017630: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+00017640: 2020 2020 2020 2020 2020 286e 6f74 2073            (not s
+00017650: 656c 662e 7072 6566 6978 290a 2020 2020  elf.prefix).    
+00017660: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
+00017670: 7365 6c66 2e70 7265 6669 782e 6973 7370  self.prefix.issp
+00017680: 6163 6528 2929 0a20 2020 2020 2020 2020  ace()).         
+00017690: 2020 2020 2020 206f 7220 2873 656c 662e         or (self.
+000176a0: 7072 6566 6978 2069 6e20 5b55 6e64 6566  prefix in [Undef
+000176b0: 696e 6564 2c20 223c 756e 6465 6669 6e65  ined, "<undefine
+000176c0: 643e 225d 290a 2020 2020 2020 2020 2020  d>"]).          
+000176d0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+000176e0: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
+000176f0: 203d 2022 2022 0a0a 2020 2020 2020 2020   = " "..        
+00017700: 2020 2020 7061 7468 2c20 5f20 3d20 6f73      path, _ = os
+00017710: 2e70 6174 682e 7370 6c69 7428 7365 6c66  .path.split(self
+00017720: 2e69 6e5f 6669 6c65 290a 0a20 2020 2020  .in_file)..     
+00017730: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00017740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00017750: 2e73 7566 6669 7820 3d3d 2022 2022 0a20  .suffix == " ". 
+00017760: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00017770: 6e64 2073 656c 662e 7072 6566 6978 203d  nd self.prefix =
+00017780: 3d20 2220 220a 2020 2020 2020 2020 2020  = " ".          
+00017790: 2020 2020 2020 616e 6420 7061 7468 203d        and path =
+000177a0: 3d20 7365 6c66 2e6f 7574 7075 745f 6469  = self.output_di
+000177b0: 7265 6374 6f72 790a 2020 2020 2020 2020  rectory.        
+000177c0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+000177d0: 2020 2020 2020 206d 7367 203d 2051 4d65         msg = QMe
+000177e0: 7373 6167 6542 6f78 2829 0a20 2020 2020  ssageBox().     
+000177f0: 2020 2020 2020 2020 2020 206d 7367 2e73             msg.s
+00017800: 6574 4963 6f6e 2851 4d65 7373 6167 6542  etIcon(QMessageB
+00017810: 6f78 2e57 6172 6e69 6e67 290a 2020 2020  ox.Warning).    
+00017820: 2020 2020 2020 2020 2020 2020 6d73 672e              msg.
+00017830: 7365 7457 696e 646f 7754 6974 6c65 2822  setWindowTitle("
+00017840: 6d69 615f 7072 6f63 6573 7365 7320 2d20  mia_processes - 
+00017850: 4d61 736b 2062 7269 636b 2057 6172 6e69  Mask brick Warni
+00017860: 6e67 2122 290a 2020 2020 2020 2020 2020  ng!").          
+00017870: 2020 2020 2020 6d73 672e 7365 7454 6578        msg.setTex
+00017880: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00017890: 2020 2020 2020 2022 5375 6666 6978 2061         "Suffix a
+000178a0: 6e64 2070 7265 6669 7820 696e 7075 7420  nd prefix input 
+000178b0: 7061 7261 6d65 7465 7273 2061 7265 206e  parameters are n
+000178c0: 6f74 2022 0a20 2020 2020 2020 2020 2020  ot ".           
+000178d0: 2020 2020 2020 2020 2022 6465 6669 6e65           "define
+000178e0: 6420 6f72 2063 6f6e 7369 7374 206f 6e6c  d or consist onl
+000178f0: 7920 6f66 206f 6e65 206f 7220 6d6f 7265  y of one or more
+00017900: 2077 6869 7465 2022 0a20 2020 2020 2020   white ".       
+00017910: 2020 2020 2020 2020 2020 2020 2022 7370               "sp
+00017920: 6163 6573 2e5c 6e54 6865 207b 307d 2069  aces.\nThe {0} i
+00017930: 6e70 7574 2070 6172 616d 6574 6572 2077  nput parameter w
+00017940: 696c 6c20 6265 2022 0a20 2020 2020 2020  ill be ".       
+00017950: 2020 2020 2020 2020 2020 2020 2022 6f76               "ov
+00017960: 6572 7772 6974 7465 6e20 2e2e 2e5c 6e20  erwritten ...\n 
+00017970: 5965 7320 6f72 2022 0a20 2020 2020 2020  Yes or ".       
+00017980: 2020 2020 2020 2020 2020 2020 2022 4162               "Ab
+00017990: 6f72 743f 222e 666f 726d 6174 2866 696c  ort?".format(fil
+000179a0: 654e 616d 6529 0a20 2020 2020 2020 2020  eName).         
+000179b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000179c0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
+000179d0: 5374 616e 6461 7264 4275 7474 6f6e 7328  StandardButtons(
+000179e0: 514d 6573 7361 6765 426f 782e 5965 7320  QMessageBox.Yes 
+000179f0: 7c20 514d 6573 7361 6765 426f 782e 4162  | QMessageBox.Ab
+00017a00: 6f72 7429 0a20 2020 2020 2020 2020 2020  ort).           
+00017a10: 2020 2020 2072 6574 7661 6c20 3d20 6d73       retval = ms
+00017a20: 672e 6578 6563 5f28 290a 0a20 2020 2020  g.exec_()..     
+00017a30: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+00017a40: 7476 616c 2021 3d20 514d 6573 7361 6765  tval != QMessage
+00017a50: 426f 782e 4162 6f72 743a 0a20 2020 2020  Box.Abort:.     
+00017a60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017a70: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+00017a80: 2020 2020 2020 2020 2020 2020 2020 225c                "\
+00017a90: 6e4d 6173 6b20 6272 6963 6b20 7761 726e  nMask brick warn
+00017aa0: 696e 673a 2074 6865 206f 7574 5f66 696c  ing: the out_fil
+00017ab0: 6520 6f75 7470 7574 2022 0a20 2020 2020  e output ".     
+00017ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ad0: 2020 2022 7061 7261 6d65 7465 7220 6973     "parameter is
+00017ae0: 2074 6865 2073 616d 6520 6173 2074 6865   the same as the
+00017af0: 2069 6e5f 6669 6c65 7320 696e 7075 7420   in_files input 
+00017b00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00017b10: 2020 2020 2020 2020 2020 2270 6172 616d            "param
+00017b20: 6574 6572 2028 7375 6666 6978 2061 6e64  eter (suffix and
+00017b30: 2070 7265 6669 7820 6172 6520 6e6f 7420   prefix are not 
+00017b40: 6465 6669 6e65 6429 3a22 0a20 2020 2020  defined):".     
 00017b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b60: 2261 6c6c 6f77 7320 746f 2072 6573 616d  "allows to resam
-00017b70: 706c 6520 3344 2069 6d61 6765 7320 6672  ple 3D images fr
-00017b80: 6f6d 2033 4420 6f72 2022 0a20 2020 2020  om 3D or ".     
-00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ba0: 2020 2020 2020 2022 3444 2072 6566 6572         "4D refer
-00017bb0: 656e 6365 2069 6d61 6765 732e 5c6e 5c6e  ence images.\n\n
-00017bc0: 2048 6f77 6576 6572 2074 6865 2022 0a20   However the ". 
-00017bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017be0: 2020 2020 2020 2020 2020 2022 277b 307d             "'{0}
-00017bf0: 2720 7265 6665 7265 6e63 6520 696d 6167  ' reference imag
-00017c00: 6520 6973 2061 207b 317d 4420 616e 6420  e is a {1}D and 
-00017c10: 7468 6520 220a 2020 2020 2020 2020 2020  the ".          
-00017c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c30: 2020 2227 7b32 7d27 2069 6d61 6765 2069    "'{2}' image i
-00017c40: 7320 6120 7b33 7d44 202e 2e2e 5c6e 5c6e  s a {3}D ...\n\n
-00017c50: 506c 6561 7365 2c20 220a 2020 2020 2020  Please, ".      
-00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c70: 2020 2020 2020 226d 6f64 6966 7920 796f        "modify yo
-00017c80: 7572 2069 6e70 7574 2061 6e64 2069 6e69  ur input and ini
-00017c90: 7469 616c 6973 6520 6167 6169 6e20 220a  tialise again ".
-00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cb0: 2020 2020 2020 2020 2020 2020 2274 6869              "thi
-00017cc0: 7320 6272 6963 6b2e 222e 666f 726d 6174  s brick.".format
-00017cd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cf0: 2020 7365 6c66 2e72 6566 6572 656e 6365    self.reference
-00017d00: 5f69 6d61 6765 2c0a 2020 2020 2020 2020  _image,.        
-00017d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d20: 2020 2020 2020 2020 6c65 6e28 7265 664e          len(refN
-00017d30: 616d 652e 7368 6170 6529 2c0a 2020 2020  ame.shape),.    
-00017d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d50: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00017d60: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00017d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d80: 2020 2020 2020 206c 656e 2866 696c 654e         len(fileN
-00017d90: 616d 652e 7368 6170 6529 2c0a 2020 2020  ame.shape),.    
-00017da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017db0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00017dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017dd0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00017de0: 2020 2020 2020 2020 2020 2020 6d73 672e              msg.
-00017df0: 7365 7453 7461 6e64 6172 6442 7574 746f  setStandardButto
-00017e00: 6e73 2851 4d65 7373 6167 6542 6f78 2e43  ns(QMessageBox.C
-00017e10: 6c6f 7365 290a 2020 2020 2020 2020 2020  lose).          
-00017e20: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-00017e30: 672e 6275 7474 6f6e 436c 6963 6b65 642e  g.buttonClicked.
-00017e40: 636f 6e6e 6563 7428 6d73 672e 636c 6f73  connect(msg.clos
-00017e50: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00017e60: 2020 2020 2020 2020 2020 206d 7367 2e65             msg.e
-00017e70: 7865 6328 290a 2020 2020 2020 2020 2020  xec().          
-00017e80: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00017e90: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017eb0: 2022 5c6e 5265 7361 6d70 6c65 3120 6272   "\nResample1 br
-00017ec0: 6963 6b3a 2049 6e69 7469 616c 6973 6174  ick: Initialisat
-00017ed0: 696f 6e20 6661 696c 6564 202e 2e2e 2022  ion failed ... "
-00017ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017ef0: 2020 2020 2020 2020 2020 2020 2022 506c               "Pl
-00017f00: 6561 7365 2063 6865 636b 2074 6865 2069  ease check the i
-00017f10: 6e70 7574 2070 6172 616d 6574 6572 7321  nput parameters!
-00017f20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00017f30: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f50: 2020 2020 6669 6c65 735f 6e61 6d65 203d      files_name =
-00017f60: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00017f70: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00017f80: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
-00017f90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00017fa0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00017fb0: 7367 203d 2051 4d65 7373 6167 6542 6f78  sg = QMessageBox
-00017fc0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00017fd0: 2020 2020 2020 206d 7367 2e73 6574 4963         msg.setIc
-00017fe0: 6f6e 2851 4d65 7373 6167 6542 6f78 2e57  on(QMessageBox.W
-00017ff0: 6172 6e69 6e67 290a 2020 2020 2020 2020  arning).        
-00018000: 2020 2020 2020 2020 2020 2020 6d73 672e              msg.
-00018010: 7365 7457 696e 646f 7754 6974 6c65 280a  setWindowTitle(.
-00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018030: 2020 2020 2020 2020 226d 6961 5f70 726f          "mia_pro
-00018040: 6365 7373 6573 202d 2052 6573 616d 706c  cesses - Resampl
-00018050: 6531 2062 7269 636b 2057 6172 6e69 6e67  e1 brick Warning
-00018060: 2122 0a20 2020 2020 2020 2020 2020 2020  !".             
-00018070: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00018080: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-00018090: 2e73 6574 5465 7874 280a 2020 2020 2020  .setText(.      
-000180a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180b0: 2020 2266 696c 6573 5f74 6f5f 7265 7361    "files_to_resa
-000180c0: 6d70 6c65 2027 7b30 7d27 206f 722f 616e  mple '{0}' or/an
-000180d0: 6420 220a 2020 2020 2020 2020 2020 2020  d ".            
-000180e0: 2020 2020 2020 2020 2020 2020 2272 6566              "ref
-000180f0: 6572 656e 6365 5f69 6d61 6765 2027 7b31  erence_image '{1
-00018100: 7d27 2069 7320 2861 7265 2920 656d 7074  }' is (are) empt
-00018110: 7920 2e2e 2e20 446f 2022 0a20 2020 2020  y ... Do ".     
-00018120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018130: 2020 2022 796f 7520 7761 6e74 2074 6f20     "you want to 
-00018140: 636f 6e74 696e 7565 3f20 5c6e 5c6e 220a  continue? \n\n".
-00018150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018160: 2020 2020 2020 2020 222d 2054 6f20 636f          "- To co
-00018170: 7272 6563 7420 7468 6520 696e 7075 7420  rrect the input 
-00018180: 7061 7261 6d65 7465 7273 2022 0a20 2020  parameters ".   
-00018190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181a0: 2020 2020 2022 636c 6963 6b20 2741 626f       "click 'Abo
-000181b0: 7274 272e 5c6e 5c6e 220a 2020 2020 2020  rt'.\n\n".      
-000181c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181d0: 2020 222d 2049 6620 7468 6520 5265 7361    "- If the Resa
-000181e0: 6d70 6c65 3120 6272 6963 6b20 6973 206c  mple1 brick is l
-000181f0: 6f63 6174 6564 2069 6e20 6120 220a 2020  ocated in a ".  
-00018200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018210: 2020 2020 2020 2270 6970 656c 696e 652c        "pipeline,
-00018220: 2069 7420 6d61 7920 6265 2075 7375 616c   it may be usual
-00018230: 2074 6861 7420 7468 6973 2874 6865 7365   that this(these
-00018240: 2920 220a 2020 2020 2020 2020 2020 2020  ) ".            
-00018250: 2020 2020 2020 2020 2020 2020 2270 6172              "par
-00018260: 616d 6574 6572 2873 2920 6973 2861 7265  ameter(s) is(are
-00018270: 2920 656d 7074 7920 6174 2074 6865 2022  ) empty at the "
-00018280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018290: 2020 2020 2020 2020 2022 696e 6974 6961           "initia
-000182a0: 6c69 7361 7469 6f6e 2074 696d 652e 2049  lisation time. I
-000182b0: 6e20 7468 6973 2063 6173 652c 2069 6620  n this case, if 
-000182c0: 7468 6520 220a 2020 2020 2020 2020 2020  the ".          
-000182d0: 2020 2020 2020 2020 2020 2020 2020 2266                "f
-000182e0: 696c 6573 5f74 6f5f 7265 7361 6d70 6c65  iles_to_resample
-000182f0: 2061 6e64 2074 6865 2072 6566 6572 656e   and the referen
-00018300: 6365 5f69 6d61 6765 2022 0a20 2020 2020  ce_image ".     
-00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018320: 2020 2022 7061 7261 6d65 7465 7273 2063     "parameters c
-00018330: 6f72 7265 7370 6f6e 6420 746f 2061 2033  orrespond to a 3
-00018340: 4420 696d 6167 6520 616e 6420 6120 3344  D image and a 3D
-00018350: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00018360: 2020 2020 2020 2020 2020 2022 6f72 2061             "or a
-00018370: 2034 442c 2072 6573 7065 6374 6976 656c   4D, respectivel
-00018380: 792c 2063 6c69 636b 2027 5965 7327 2c20  y, click 'Yes', 
-00018390: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000183a0: 2020 2020 2020 2020 2020 226f 7468 6572            "other
-000183b0: 7769 7365 2063 6c69 636b 2027 4162 6f72  wise click 'Abor
-000183c0: 7427 2061 6e64 2063 6861 6e67 6520 7468  t' and change th
-000183d0: 6520 696e 7075 7420 220a 2020 2020 2020  e input ".      
-000183e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183f0: 2020 2270 6172 616d 6574 6572 732e 222e    "parameters.".
-00018400: 666f 726d 6174 2866 696c 655f 6e61 6d65  format(file_name
-00018410: 2c20 7365 6c66 2e72 6566 6572 656e 6365  , self.reference
-00018420: 5f69 6d61 6765 290a 2020 2020 2020 2020  _image).        
-00018430: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018450: 2020 6d73 672e 7365 7453 7461 6e64 6172    msg.setStandar
-00018460: 6442 7574 746f 6e73 2851 4d65 7373 6167  dButtons(QMessag
-00018470: 6542 6f78 2e59 6573 207c 2051 4d65 7373  eBox.Yes | QMess
-00018480: 6167 6542 6f78 2e41 626f 7274 290a 2020  ageBox.Abort).  
-00018490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184a0: 2020 7265 7476 616c 203d 206d 7367 2e65    retval = msg.e
-000184b0: 7865 635f 2829 0a0a 2020 2020 2020 2020  xec_()..        
-000184c0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-000184d0: 6574 7661 6c20 3d3d 2051 4d65 7373 6167  etval == QMessag
-000184e0: 6542 6f78 2e59 6573 3a0a 2020 2020 2020  eBox.Yes:.      
+00017b60: 2020 2022 5c6e 7b30 7d20 7769 6c6c 2062     "\n{0} will b
+00017b70: 6520 6f76 6572 7772 6974 6564 202e 2e2e  e overwrited ...
+00017b80: 222e 666f 726d 6174 2866 696c 654e 616d  ".format(fileNam
+00017b90: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00017ba0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00017bb0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00017bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bd0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00017be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bf0: 2020 2022 5c6e 4d61 736b 2062 7269 636b     "\nMask brick
+00017c00: 3a20 4162 6f72 7465 642e 2050 6c65 6173  : Aborted. Pleas
+00017c10: 6520 6368 6563 6b20 796f 7572 2069 6e70  e check your inp
+00017c20: 7574 2022 0a20 2020 2020 2020 2020 2020  ut ".           
+00017c30: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
+00017c40: 7261 6d65 7465 7273 202e 2e2e 220a 2020  rameters ...".  
+00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c60: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00017c70: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00017c80: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00017c90: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00017ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017cb0: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
+00017cc0: 6563 746f 7279 2c0a 2020 2020 2020 2020  ectory,.        
+00017cd0: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
+00017ce0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00017cf0: 6c66 2e70 7265 6669 782e 7374 7269 7028  lf.prefix.strip(
+00017d00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017d10: 2020 2020 2020 2b20 6669 6c65 4e61 6d65        + fileName
+00017d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017d30: 2020 2020 202b 2073 656c 662e 7375 6666       + self.suff
+00017d40: 6978 2e73 7472 6970 2829 0a20 2020 2020  ix.strip().     
+00017d50: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00017d60: 2022 2e22 0a20 2020 2020 2020 2020 2020   ".".           
+00017d70: 2020 2020 2020 2020 202b 2069 6e5f 6578           + in_ex
+00017d80: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00017d90: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00017da0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00017db0: 6966 2066 696c 653a 0a20 2020 2020 2020  if file:.       
+00017dc0: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
+00017dd0: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
+00017de0: 5d20 3d20 6669 6c65 0a0a 2020 2020 2020  ] = file..      
+00017df0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00017e00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00017e10: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00017e20: 2020 2020 2020 2022 2d20 4d61 736b 2062         "- Mask b
+00017e30: 7269 636b 3a20 5468 6572 6520 7761 7320  rick: There was 
+00017e40: 6e6f 206f 7574 7075 7420 6669 6c65 2064  no output file d
+00017e50: 6564 7563 7465 6420 6475 7269 6e67 2022  educted during "
+00017e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017e70: 2020 2020 2022 696e 6974 6961 6c69 7a61       "initializa
+00017e80: 7469 6f6e 2e20 506c 6561 7365 2063 6865  tion. Please che
+00017e90: 636b 2074 6865 2069 6e70 7574 2070 6172  ck the input par
+00017ea0: 616d 6574 6572 732e 2e2e 2122 0a20 2020  ameters...!".   
+00017eb0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00017ec0: 2020 2020 2020 2020 2320 7461 6773 2069          # tags i
+00017ed0: 6e68 6572 6974 616e 6365 2028 6f70 7469  nheritance (opti
+00017ee0: 6f6e 616c 290a 2020 2020 2020 2020 6966  onal).        if
+00017ef0: 2073 656c 662e 6f75 7470 7574 735b 226f   self.outputs["o
+00017f00: 7574 5f66 696c 6522 5d3a 0a20 2020 2020  ut_file"]:.     
+00017f10: 2020 2020 2020 2073 656c 662e 7461 6773         self.tags
+00017f20: 5f69 6e68 6572 6974 616e 6365 280a 2020  _inheritance(.  
+00017f30: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00017f40: 5f66 696c 653d 7365 6c66 2e69 6e5f 6669  _file=self.in_fi
+00017f50: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00017f60: 2020 2020 6f75 745f 6669 6c65 3d73 656c      out_file=sel
+00017f70: 662e 6f75 7470 7574 735b 226f 7574 5f66  f.outputs["out_f
+00017f80: 696c 6522 5d2c 0a20 2020 2020 2020 2020  ile"],.         
+00017f90: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00017fa0: 5265 7475 726e 2074 6865 2072 6571 7569  Return the requi
+00017fb0: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
+00017fc0: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
+00017fd0: 6469 6374 0a20 2020 2020 2020 2072 6574  dict.        ret
+00017fe0: 7572 6e20 7365 6c66 2e6d 616b 655f 696e  urn self.make_in
+00017ff0: 6974 5265 7375 6c74 2829 0a0a 2020 2020  itResult()..    
+00018000: 6465 6620 7275 6e5f 7072 6f63 6573 735f  def run_process_
+00018010: 6d69 6128 7365 6c66 293a 0a20 2020 2020  mia(self):.     
+00018020: 2020 2022 2222 4465 6469 6361 7465 6420     """Dedicated 
+00018030: 746f 2074 6865 2070 726f 6365 7373 206c  to the process l
+00018040: 6175 6e63 6820 7374 6570 206f 6620 7468  aunch step of th
+00018050: 6520 6272 6963 6b2e 2222 220a 2020 2020  e brick.""".    
+00018060: 2020 2020 7375 7065 7228 4d61 736b 2c20      super(Mask, 
+00018070: 7365 6c66 292e 7275 6e5f 7072 6f63 6573  self).run_proces
+00018080: 735f 6d69 6128 290a 0a20 2020 2020 2020  s_mia()..       
+00018090: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
+000180a0: 662e 696e 5f66 696c 650a 2020 2020 2020  f.in_file.      
+000180b0: 2020 6d61 736b 5f6e 616d 6520 3d20 7365    mask_name = se
+000180c0: 6c66 2e6d 6173 6b5f 6669 6c65 0a0a 2020  lf.mask_file..  
+000180d0: 2020 2020 2020 2320 496d 6167 6520 7072        # Image pr
+000180e0: 6f63 6573 7369 6e67 0a20 2020 2020 2020  ocessing.       
+000180f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00018100: 2020 696d 6720 3d20 6e69 622e 6c6f 6164    img = nib.load
+00018110: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
+00018120: 2020 2020 2020 2020 6d61 736b 5f69 6d67          mask_img
+00018130: 203d 206e 6962 2e6c 6f61 6428 6d61 736b   = nib.load(mask
+00018140: 5f6e 616d 6529 0a0a 2020 2020 2020 2020  _name)..        
+00018150: 6578 6365 7074 2028 0a20 2020 2020 2020  except (.       
+00018160: 2020 2020 206e 6962 2e66 696c 6562 6173       nib.filebas
+00018170: 6564 696d 6167 6573 2e49 6d61 6765 4669  edimages.ImageFi
+00018180: 6c65 4572 726f 722c 0a20 2020 2020 2020  leError,.       
+00018190: 2020 2020 2046 696c 654e 6f74 466f 756e       FileNotFoun
+000181a0: 6445 7272 6f72 2c0a 2020 2020 2020 2020  dError,.        
+000181b0: 2020 2020 5479 7065 4572 726f 722c 0a20      TypeError,. 
+000181c0: 2020 2020 2020 2029 2061 7320 653a 0a20         ) as e:. 
+000181d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000181e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000181f0: 2020 225c 6e4d 6173 6b20 6272 6963 6b3a    "\nMask brick:
+00018200: 2045 7272 6f72 2077 6974 6820 6669 6c65   Error with file
+00018210: 7320 746f 206d 6173 6b2c 2064 7572 696e  s to mask, durin
+00018220: 6720 7468 6520 7275 6e3a 2022 2c0a 2020  g the run: ",.  
+00018230: 2020 2020 2020 2020 2020 2020 2020 652c                e,
+00018240: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00018250: 2020 2020 2020 2020 2020 2069 6d67 203d             img =
+00018260: 204e 6f6e 650a 0a20 2020 2020 2020 2069   None..        i
+00018270: 6620 2869 6d67 2069 7320 6e6f 7420 4e6f  f (img is not No
+00018280: 6e65 2920 616e 6420 286d 6173 6b5f 696d  ne) and (mask_im
+00018290: 6720 6973 206e 6f74 204e 6f6e 6529 3a0a  g is not None):.
+000182a0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+000182b0: 203d 2069 6d67 2e67 6574 5f66 6461 7461   = img.get_fdata
+000182c0: 2829 0a20 2020 2020 2020 2020 2020 2064  ().            d
+000182d0: 6174 615b 6e70 2e61 7361 6e79 6172 7261  ata[np.asanyarra
+000182e0: 7928 6d61 736b 5f69 6d67 2e64 6174 616f  y(mask_img.datao
+000182f0: 626a 2920 3d3d 2030 5d20 3d20 300a 0a20  bj) == 0] = 0.. 
+00018300: 2020 2020 2020 2020 2020 206d 6173 6b69             maski
+00018310: 6d67 203d 2069 6d67 2e5f 5f63 6c61 7373  mg = img.__class
+00018320: 5f5f 2864 6174 612c 2069 6d67 2e61 6666  __(data, img.aff
+00018330: 696e 652c 2069 6d67 2e68 6561 6465 7229  ine, img.header)
+00018340: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00018350: 496d 6167 6520 7361 7665 0a20 2020 2020  Image save.     
+00018360: 2020 2020 2020 205f 2c20 6669 6c65 5f6e         _, file_n
+00018370: 616d 6520 3d20 6f73 2e70 6174 682e 7370  ame = os.path.sp
+00018380: 6c69 7428 6669 6c65 5f6e 616d 6529 0a20  lit(file_name). 
+00018390: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+000183a0: 6e61 6d65 5f6e 6f5f 6578 742c 2066 696c  name_no_ext, fil
+000183b0: 655f 6578 7465 6e73 696f 6e20 3d20 6f73  e_extension = os
+000183c0: 2e70 6174 682e 7370 6c69 7465 7874 2866  .path.splitext(f
+000183d0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+000183e0: 2020 2020 2020 6966 2066 696c 655f 6578        if file_ex
+000183f0: 7465 6e73 696f 6e20 3d3d 2022 2e67 7a22  tension == ".gz"
+00018400: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018410: 2020 2866 696c 655f 6e61 6d65 5f6e 6f5f    (file_name_no_
+00018420: 6578 745f 322c 2066 696c 655f 6578 7465  ext_2, file_exte
+00018430: 6e73 696f 6e5f 3229 203d 206f 732e 7061  nsion_2) = os.pa
+00018440: 7468 2e73 706c 6974 6578 7428 0a20 2020  th.splitext(.   
+00018450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018460: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
+00018470: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00018480: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00018490: 2020 2020 6966 2066 696c 655f 6578 7465      if file_exte
+000184a0: 6e73 696f 6e5f 3220 3d3d 2022 2e6e 6969  nsion_2 == ".nii
+000184b0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000184c0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+000184d0: 5f6e 6f5f 6578 7420 3d20 6669 6c65 5f6e  _no_ext = file_n
+000184e0: 616d 655f 6e6f 5f65 7874 5f32 0a20 2020  ame_no_ext_2.   
 000184f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018500: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-00018510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018520: 2020 2020 2022 5c6e 5265 7361 6d70 6c65       "\nResample
-00018530: 3120 6272 6963 6b20 5761 726e 696e 6721  1 brick Warning!
-00018540: 3a20 456d 7074 7920 696e 7075 7420 220a  : Empty input ".
-00018550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018560: 2020 2020 2020 2020 2020 2020 2266 696c              "fil
-00018570: 6528 7329 2e20 4e6f 2063 6865 636b 206f  e(s). No check o
-00018580: 6620 7468 6520 6469 6d65 6e73 696f 6e73  f the dimensions
-00018590: 206f 6620 7468 6520 220a 2020 2020 2020   of the ".      
-000185a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185b0: 2020 2020 2020 2269 6e70 7574 2069 6d61        "input ima
-000185c0: 6765 7320 6973 2064 6f6e 6520 2e2e 2e20  ges is done ... 
-000185d0: 2866 696c 6573 5f74 6f5f 7265 7361 6d70  (files_to_resamp
-000185e0: 6c65 2022 0a20 2020 2020 2020 2020 2020  le ".           
-000185f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018600: 2022 6d75 7374 2062 6520 6120 3344 2061   "must be a 3D a
-00018610: 6e64 2072 6566 6572 656e 6365 5f69 6d61  nd reference_ima
-00018620: 6765 206d 7573 7420 6265 2061 2033 4420  ge must be a 3D 
-00018630: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00018640: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-00018650: 7220 6120 3444 2920 2e2e 2e22 0a20 2020  r a 4D) ...".   
-00018660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018670: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00018680: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00018690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000186a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000186b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000186c0: 2020 2020 2020 2020 2020 2020 2022 5c6e               "\n
-000186d0: 5265 7361 6d70 6c65 3120 6272 6963 6b3a  Resample1 brick:
-000186e0: 2049 6e69 7469 616c 6973 6174 696f 6e20   Initialisation 
-000186f0: 6661 696c 6564 202e 2e2e 2022 0a20 2020  failed ... ".   
-00018700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018710: 2020 2020 2020 2020 2022 506c 6561 7365           "Please
-00018720: 2063 6865 636b 2074 6865 2069 6e70 7574   check the input
-00018730: 2070 6172 616d 6574 6572 7321 220a 2020   parameters!".  
-00018740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018750: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018770: 6669 6c65 735f 6e61 6d65 203d 204e 6f6e  files_name = Non
-00018780: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00018790: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-000187a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000187b0: 2070 6174 682c 2066 696c 655f 6e61 6d65   path, file_name
-000187c0: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-000187d0: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
-000187e0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-000187f0: 5f6e 616d 655f 6e6f 5f65 7874 2c20 6669  _name_no_ext, fi
-00018800: 6c65 5f65 7874 656e 7369 6f6e 203d 206f  le_extension = o
-00018810: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
-00018820: 6669 6c65 5f6e 616d 6529 0a0a 2020 2020  file_name)..    
-00018830: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
-00018840: 743a 206f 6666 0a20 2020 2020 2020 2020  t: off.         
-00018850: 2020 2020 2020 2069 6620 2873 656c 662e         if (self.
-00018860: 7375 6666 6978 5f74 6f5f 6465 6c65 7465  suffix_to_delete
-00018870: 2021 3d20 2220 2229 2061 6e64 2028 0a20   != " ") and (. 
-00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018890: 2020 2066 696c 655f 6e61 6d65 5f6e 6f5f     file_name_no_
-000188a0: 6578 745b 2d6c 656e 2873 656c 662e 7375  ext[-len(self.su
-000188b0: 6666 6978 5f74 6f5f 6465 6c65 7465 293a  ffix_to_delete):
-000188c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000188d0: 2020 2020 2020 3d3d 2073 656c 662e 7375        == self.su
-000188e0: 6666 6978 5f74 6f5f 6465 6c65 7465 0a20  ffix_to_delete. 
-000188f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00018900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018910: 2020 2020 2020 6669 6c65 5f6e 616d 655f        file_name_
-00018920: 6e6f 5f65 7874 203d 2066 696c 655f 6e61  no_ext = file_na
-00018930: 6d65 5f6e 6f5f 6578 745b 0a20 2020 2020  me_no_ext[.     
-00018940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018950: 2020 203a 2d6c 656e 2873 656c 662e 7375     :-len(self.su
-00018960: 6666 6978 5f74 6f5f 6465 6c65 7465 290a  ffix_to_delete).
-00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018980: 2020 2020 5d0a 0a20 2020 2020 2020 2020      ]..         
-00018990: 2020 2020 2020 2023 2066 6d74 3a20 6f6e         # fmt: on
-000189a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000189b0: 2066 696c 6573 2e61 7070 656e 6428 0a20   files.append(. 
-000189c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189d0: 2020 206f 732e 7061 7468 2e6a 6f69 6e28     os.path.join(
-000189e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000189f0: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
-00018a00: 7470 7574 5f64 6972 6563 746f 7279 2c0a  tput_directory,.
-00018a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a20: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-00018a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a40: 2020 2020 2020 7365 6c66 2e70 7265 6669        self.prefi
-00018a50: 782e 7374 7269 7028 290a 2020 2020 2020  x.strip().      
-00018a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a70: 2020 2020 2020 2b20 6669 6c65 5f6e 616d        + file_nam
-00018a80: 655f 6e6f 5f65 7874 0a20 2020 2020 2020  e_no_ext.       
-00018a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018aa0: 2020 2020 202b 2073 656c 662e 7375 6666       + self.suff
-00018ab0: 6978 2e73 7472 6970 2829 0a20 2020 2020  ix.strip().     
-00018ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ad0: 2020 2020 2020 202b 2066 696c 655f 6578         + file_ex
-00018ae0: 7465 6e73 696f 6e0a 2020 2020 2020 2020  tension.        
-00018af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b00: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00018b10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00018b20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00018b30: 2020 2020 2020 2020 2320 4d61 7920 6f76          # May ov
-00018b40: 6572 7772 6974 6520 616e 2069 6e70 7574  erwrite an input
-00018b50: 2069 6d61 6765 2077 6974 6820 616e 206f   image with an o
-00018b60: 7574 7075 7420 696d 6167 650a 2020 2020  utput image.    
-00018b70: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
-00018b80: 2e73 7566 6669 7820 3d3d 2022 2022 2920  .suffix == " ") 
-00018b90: 616e 6420 2873 656c 662e 7072 6566 6978  and (self.prefix
-00018ba0: 203d 3d20 2220 2229 2061 6e64 2028 6669   == " ") and (fi
-00018bb0: 6c65 735f 6e61 6d65 293a 0a20 2020 2020  les_name):.     
-00018bc0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00018bd0: 2051 4d65 7373 6167 6542 6f78 2829 0a20   QMessageBox(). 
-00018be0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00018bf0: 7367 2e73 6574 4963 6f6e 2851 4d65 7373  sg.setIcon(QMess
-00018c00: 6167 6542 6f78 2e57 6172 6e69 6e67 290a  ageBox.Warning).
-00018c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c20: 6d73 672e 7365 7457 696e 646f 7754 6974  msg.setWindowTit
-00018c30: 6c65 2822 6d69 615f 7072 6f63 6573 7365  le("mia_processe
-00018c40: 7320 2d20 5265 7361 6d70 6c65 3120 6272  s - Resample1 br
-00018c50: 6963 6b20 5761 726e 696e 6721 2229 0a20  ick Warning!"). 
-00018c60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00018c70: 7367 2e73 6574 5465 7874 280a 2020 2020  sg.setText(.    
-00018c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c90: 2253 7566 6669 7820 616e 6420 7072 6566  "Suffix and pref
-00018ca0: 6978 2069 6e70 7574 2070 6172 616d 6574  ix input paramet
-00018cb0: 6572 7320 6172 6520 6e6f 7420 220a 2020  ers are not ".  
-00018cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cd0: 2020 2264 6566 696e 6564 206f 7220 636f    "defined or co
-00018ce0: 6e73 6973 7420 6f6e 6c79 206f 6620 6f6e  nsist only of on
-00018cf0: 6520 6f72 206d 6f72 6520 7768 6974 6520  e or more white 
-00018d00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00018d10: 2020 2020 2020 2273 7061 6365 732e 5c6e        "spaces.\n
-00018d20: 5c6e 5468 6520 6669 6c65 735f 746f 5f72  \nThe files_to_r
-00018d30: 6573 616d 706c 6520 696e 7075 7420 7061  esample input pa
-00018d40: 7261 6d65 7465 7220 220a 2020 2020 2020  rameter ".      
-00018d50: 2020 2020 2020 2020 2020 2020 2020 2228                "(
-00018d60: 6966 2073 7566 6669 785f 746f 5f64 656c  if suffix_to_del
-00018d70: 6574 6520 696e 7075 7420 7061 7261 6d65  ete input parame
-00018d80: 7465 7220 6973 206e 6f74 2073 6574 2920  ter is not set) 
-00018d90: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00018da0: 2020 2020 2020 226f 7220 6f74 6865 7220        "or other 
-00018db0: 6669 6c65 7320 2869 6620 7375 6666 6978  files (if suffix
-00018dc0: 5f74 6f5f 6465 6c65 7465 2069 6e70 7574  _to_delete input
-00018dd0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00018de0: 2020 2020 2020 2022 7061 7261 6d65 7465         "paramete
-00018df0: 7220 6973 2073 6574 2920 636f 756c 6420  r is set) could 
-00018e00: 6265 206f 7665 7277 7269 7474 656e 202e  be overwritten .
-00018e10: 2e2e 2074 6869 7320 220a 2020 2020 2020  .. this ".      
-00018e20: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-00018e30: 6f6e 6365 726e 7320 7468 6520 666f 6c6c  oncerns the foll
-00018e40: 6f77 696e 6720 696d 6167 6573 3a5c 6e7b  owing images:\n{
-00018e50: 7d5c 6e5c 6e44 6f20 796f 7520 220a 2020  }\n\nDo you ".  
-00018e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e70: 2020 2261 6772 6565 2074 6f20 7573 6520    "agree to use 
-00018e80: 7468 6573 6520 696e 7075 7420 220a 2020  these input ".  
-00018e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ea0: 2020 2270 6172 616d 6574 6572 733f 222e    "parameters?".
-00018eb0: 666f 726d 6174 2873 6574 2866 696c 6573  format(set(files
-00018ec0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00018ed0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00018ee0: 2020 2020 206d 7367 2e73 6574 5374 616e       msg.setStan
-00018ef0: 6461 7264 4275 7474 6f6e 7328 514d 6573  dardButtons(QMes
-00018f00: 7361 6765 426f 782e 5965 7320 7c20 514d  sageBox.Yes | QM
-00018f10: 6573 7361 6765 426f 782e 4162 6f72 7429  essageBox.Abort)
-00018f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018f30: 2072 6574 7661 6c20 3d20 6d73 672e 6578   retval = msg.ex
-00018f40: 6563 5f28 290a 0a20 2020 2020 2020 2020  ec_()..         
-00018f50: 2020 2020 2020 2069 6620 7265 7476 616c         if retval
-00018f60: 203d 3d20 514d 6573 7361 6765 426f 782e   == QMessageBox.
-00018f70: 5965 733a 0a20 2020 2020 2020 2020 2020  Yes:.           
-00018f80: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00018f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fa0: 2020 2020 2020 2020 225c 6e52 6573 616d          "\nResam
-00018fb0: 706c 6531 2062 7269 636b 2077 6172 6e69  ple1 brick warni
-00018fc0: 6e67 3a20 7375 6666 6978 2061 6e64 2070  ng: suffix and p
-00018fd0: 7265 6669 7820 696e 7075 7420 220a 2020  refix input ".  
-00018fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ff0: 2020 2020 2020 2270 6172 616d 6574 6572        "parameter
-00019000: 7320 6172 6520 6e6f 7420 6465 6669 6e65  s are not define
-00019010: 642c 2074 6865 2066 6f6c 6c6f 7769 6e67  d, the following
-00019020: 2066 696c 6573 2022 0a20 2020 2020 2020   files ".       
-00019030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019040: 2022 636f 756c 6420 6265 206f 7665 7277   "could be overw
-00019050: 7269 7465 213a 5c6e 7b30 7d20 2e2e 2e5c  rite!:\n{0} ...\
-00019060: 6e22 2e66 6f72 6d61 7428 7365 7428 6669  n".format(set(fi
-00019070: 6c65 7329 290a 2020 2020 2020 2020 2020  les)).          
-00019080: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00019090: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000190a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000190b0: 2020 2020 2020 2066 696c 6573 5f6e 616d         files_nam
-000190c0: 6520 3d20 4e6f 6e65 0a0a 2020 2020 2020  e = None..      
-000190d0: 2020 2020 2020 2320 5477 6f20 2861 7420        # Two (at 
-000190e0: 6c65 6173 7429 2069 6e70 7574 2069 6d61  least) input ima
-000190f0: 6765 7320 6769 7665 2074 6865 2073 616d  ges give the sam
-00019100: 6520 6f75 7470 7574 2069 6d61 6765 0a20  e output image. 
-00019110: 2020 2020 2020 2020 2020 2069 6620 286c             if (l
-00019120: 656e 2866 696c 6573 2920 213d 206c 656e  en(files) != len
-00019130: 2873 6574 2866 696c 6573 2929 2920 616e  (set(files))) an
-00019140: 6420 2866 696c 6573 5f6e 616d 6529 3a0a  d (files_name):.
-00019150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019160: 6475 7065 7320 3d20 7365 7428 290a 2020  dupes = set().  
-00019170: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00019180: 656e 203d 2073 6574 2829 0a0a 2020 2020  en = set()..    
-00019190: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000191a0: 7820 696e 2066 696c 6573 3a0a 2020 2020  x in files:.    
-000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191c0: 6966 2078 2069 6e20 7365 656e 3a0a 2020  if x in seen:.  
-000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191e0: 2020 2020 2020 6475 7065 732e 6164 6428        dupes.add(
-000191f0: 7829 0a0a 2020 2020 2020 2020 2020 2020  x)..            
-00019200: 2020 2020 2020 2020 7365 656e 2e61 6464          seen.add
-00019210: 2878 290a 0a20 2020 2020 2020 2020 2020  (x)..           
-00019220: 2020 2020 206d 7367 203d 2051 4d65 7373       msg = QMess
-00019230: 6167 6542 6f78 2829 0a20 2020 2020 2020  ageBox().       
-00019240: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-00019250: 4963 6f6e 2851 4d65 7373 6167 6542 6f78  Icon(QMessageBox
-00019260: 2e57 6172 6e69 6e67 290a 2020 2020 2020  .Warning).      
-00019270: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
-00019280: 7457 696e 646f 7754 6974 6c65 2822 6d69  tWindowTitle("mi
-00019290: 615f 7072 6f63 6573 7365 7320 2d20 5265  a_processes - Re
-000192a0: 7361 6d70 6c65 3120 6272 6963 6b20 5761  sample1 brick Wa
-000192b0: 726e 696e 6721 2229 0a20 2020 2020 2020  rning!").       
-000192c0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-000192d0: 5465 7874 280a 2020 2020 2020 2020 2020  Text(.          
-000192e0: 2020 2020 2020 2020 2020 2254 6865 2073            "The s
-000192f0: 7566 6669 782c 2070 7265 6669 7820 616e  uffix, prefix an
-00019300: 6420 7375 6666 6978 5f74 6f5f 6465 6c65  d suffix_to_dele
-00019310: 7465 2069 6e70 7574 2022 0a20 2020 2020  te input ".     
-00019320: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00019330: 7061 7261 6d65 7465 7273 2063 6f6d 6269  parameters combi
-00019340: 6e61 7469 6f6e 2073 6565 6d73 2074 6f20  nation seems to 
-00019350: 6372 6561 7465 2066 6f72 2061 7420 220a  create for at ".
-00019360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019370: 2020 2020 226c 6561 7374 2074 776f 2064      "least two d
-00019380: 6966 6665 7265 6e74 2069 6e70 7574 2069  ifferent input i
-00019390: 6d61 6765 7320 7468 6520 7361 6d65 206f  mages the same o
-000193a0: 7574 7075 7420 220a 2020 2020 2020 2020  utput ".        
-000193b0: 2020 2020 2020 2020 2020 2020 2269 6d61              "ima
-000193c0: 6765 3a5c 6e7b 7d5c 6e5c 6e50 6c65 6173  ge:\n{}\n\nPleas
-000193d0: 6520 6368 616e 6765 2074 6865 2073 7566  e change the suf
-000193e0: 6669 782c 2070 7265 6669 7820 220a 2020  fix, prefix ".  
-000193f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019400: 2020 2261 6e64 2073 7566 6669 785f 746f    "and suffix_to
-00019410: 5f64 656c 6574 6520 696e 7075 7420 7061  _delete input pa
-00019420: 7261 6d65 7465 7273 2063 6f6d 6269 6e61  rameters combina
-00019430: 7469 6f6e 2022 0a20 2020 2020 2020 2020  tion ".         
-00019440: 2020 2020 2020 2020 2020 2022 616e 6420             "and 
-00019450: 696e 6974 6961 6c69 7365 2061 6761 696e  initialise again
-00019460: 2074 6869 7320 6272 6963 6b2e 222e 666f   this brick.".fo
-00019470: 726d 6174 2864 7570 6573 290a 2020 2020  rmat(dupes).    
-00019480: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00019490: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-000194a0: 672e 7365 7453 7461 6e64 6172 6442 7574  g.setStandardBut
-000194b0: 746f 6e73 2851 4d65 7373 6167 6542 6f78  tons(QMessageBox
-000194c0: 2e43 6c6f 7365 290a 2020 2020 2020 2020  .Close).        
-000194d0: 2020 2020 2020 2020 6d73 672e 6275 7474          msg.butt
-000194e0: 6f6e 436c 6963 6b65 642e 636f 6e6e 6563  onClicked.connec
-000194f0: 7428 6d73 672e 636c 6f73 6529 0a20 2020  t(msg.close).   
-00019500: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-00019510: 2e65 7865 6328 290a 2020 2020 2020 2020  .exec().        
-00019520: 2020 2020 2020 2020 6669 6c65 735f 6e61          files_na
-00019530: 6d65 203d 204e 6f6e 650a 0a20 2020 2020  me = None..     
-00019540: 2020 2020 2020 2069 6620 6669 6c65 735f         if files_
-00019550: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-00019560: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
-00019570: 7473 5b22 6f75 745f 6669 6c65 7322 5d20  ts["out_files"] 
-00019580: 3d20 6669 6c65 730a 0a20 2020 2020 2020  = files..       
-00019590: 2023 2054 6167 7320 696e 6865 7269 7461   # Tags inherita
-000195a0: 6e63 6520 286f 7074 696f 6e61 6c29 0a20  nce (optional). 
-000195b0: 2020 2020 2020 2069 6620 7365 6c66 2e6f         if self.o
-000195c0: 7574 7075 7473 3a0a 2020 2020 2020 2020  utputs:.        
-000195d0: 2020 2020 666f 7220 6b65 792c 2076 616c      for key, val
-000195e0: 2069 6e20 7365 6c66 2e6f 7574 7075 7473   in self.outputs
-000195f0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00019600: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00019610: 203d 3d20 226f 7574 5f66 696c 6573 223a   == "out_files":
-00019620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019630: 2020 2020 2066 6f72 2069 6e5f 7661 6c2c       for in_val,
-00019640: 206f 7574 5f76 616c 2069 6e20 7a69 7028   out_val in zip(
-00019650: 6669 6c65 735f 6e61 6d65 2c20 7661 6c29  files_name, val)
-00019660: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019670: 2020 2020 2020 2020 2020 5f2c 2066 696c            _, fil
-00019680: 654f 7661 6c20 3d20 6f73 2e70 6174 682e  eOval = os.path.
-00019690: 7370 6c69 7428 6f75 745f 7661 6c29 0a20  split(out_val). 
-000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196b0: 2020 2020 2020 2066 696c 654f 7661 6c5f         fileOval_
-000196c0: 6e6f 5f65 7874 2c20 5f20 3d20 6f73 2e70  no_ext, _ = os.p
-000196d0: 6174 682e 7370 6c69 7465 7874 2866 696c  ath.splitext(fil
-000196e0: 654f 7661 6c29 0a0a 2020 2020 2020 2020  eOval)..        
-000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019700: 2320 666d 743a 206f 6666 0a20 2020 2020  # fmt: off.     
-00019710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019720: 2020 2069 6620 2873 656c 662e 7375 6666     if (self.suff
-00019730: 6978 2021 3d20 2220 2229 2061 6e64 2028  ix != " ") and (
-00019740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019760: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
-00019770: 5b2d 6c65 6e28 0a20 2020 2020 2020 2020  [-len(.         
-00019780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197a0: 2020 2020 2020 2073 656c 662e 7375 6666         self.suff
-000197b0: 6978 293a 5d20 3d3d 2073 656c 662e 7375  ix):] == self.su
-000197c0: 6666 6978 0a20 2020 2020 2020 2020 2020  ffix.           
-000197d0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-000197e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197f0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00019800: 4f76 616c 5f6e 6f5f 6578 7420 3d20 6669  Oval_no_ext = fi
-00019810: 6c65 4f76 616c 5f6e 6f5f 6578 745b 3a2d  leOval_no_ext[:-
-00019820: 6c65 6e28 0a20 2020 2020 2020 2020 2020  len(.           
-00019830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019840: 2020 2020 2073 656c 662e 7375 6666 6978       self.suffix
-00019850: 295d 0a0a 2020 2020 2020 2020 2020 2020  )]..            
-00019860: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00019870: 7365 6c66 2e70 7265 6669 7820 213d 2022  self.prefix != "
-00019880: 2022 2920 616e 6420 280a 2020 2020 2020   ") and (.      
-00019890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198a0: 2020 2020 2020 2020 2020 6669 6c65 4f76            fileOv
-000198b0: 616c 5f6e 6f5f 6578 745b 303a 6c65 6e28  al_no_ext[0:len(
-000198c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198e0: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
-000198f0: 295d 203d 3d20 7365 6c66 2e70 7265 6669  )] == self.prefi
-00019900: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
-00019910: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00019920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019930: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
-00019940: 6c5f 6e6f 5f65 7874 203d 2066 696c 654f  l_no_ext = fileO
-00019950: 7661 6c5f 6e6f 5f65 7874 5b6c 656e 280a  val_no_ext[len(.
-00019960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019980: 7365 6c66 2e70 7265 6669 7829 3a5d 0a20  self.prefix):]. 
-00019990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199a0: 2020 2020 2020 2023 2066 6d74 3a20 6f6e         # fmt: on
-000199b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000199c0: 2020 2020 2020 2020 205f 2c20 6669 6c65           _, file
-000199d0: 4976 616c 203d 206f 732e 7061 7468 2e73  Ival = os.path.s
-000199e0: 706c 6974 2869 6e5f 7661 6c29 0a20 2020  plit(in_val).   
-000199f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a00: 2020 2020 2066 696c 6549 7661 6c5f 6e6f       fileIval_no
-00019a10: 5f65 7874 2c20 5f20 3d20 6f73 2e70 6174  _ext, _ = os.pat
-00019a20: 682e 7370 6c69 7465 7874 2866 696c 6549  h.splitext(fileI
-00019a30: 7661 6c29 0a0a 2020 2020 2020 2020 2020  val)..          
-00019a40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00019a50: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
-00019a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a70: 2069 6620 2873 656c 662e 7375 6666 6978   if (self.suffix
-00019a80: 5f74 6f5f 6465 6c65 7465 2021 3d20 2220  _to_delete != " 
-00019a90: 2229 2061 6e64 2028 0a20 2020 2020 2020  ") and (.       
-00019aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ab0: 2020 2020 2066 696c 6549 7661 6c5f 6e6f       fileIval_no
-00019ac0: 5f65 7874 5b2d 6c65 6e28 7365 6c66 2e73  _ext[-len(self.s
-00019ad0: 7566 6669 785f 746f 5f64 656c 6574 6529  uffix_to_delete)
-00019ae0: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-00019af0: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-00019b00: 3d20 7365 6c66 2e73 7566 6669 785f 746f  = self.suffix_to
-00019b10: 5f64 656c 6574 650a 2020 2020 2020 2020  _delete.        
-00019b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00019b40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00019b50: 2066 6d74 3a20 6f6e 0a20 2020 2020 2020   fmt: on.       
-00019b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b70: 2020 2020 2066 696c 654f 7661 6c5f 6e6f       fileOval_no
-00019b80: 5f65 7874 203d 2028 0a20 2020 2020 2020  _ext = (.       
-00019b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ba0: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
-00019bb0: 6c5f 6e6f 5f65 7874 202b 2073 656c 662e  l_no_ext + self.
-00019bc0: 7375 6666 6978 5f74 6f5f 6465 6c65 7465  suffix_to_delete
-00019bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019be0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00019bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c00: 2020 2020 2020 2020 6966 2066 696c 654f          if fileO
-00019c10: 7661 6c5f 6e6f 5f65 7874 203d 3d20 6669  val_no_ext == fi
-00019c20: 6c65 4976 616c 5f6e 6f5f 6578 743a 0a0a  leIval_no_ext:..
-00019c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c40: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-00019c50: 6574 5f64 6246 6965 6c64 5661 6c75 6528  et_dbFieldValue(
-00019c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c80: 2073 656c 662e 7072 6f6a 6563 742c 2069   self.project, i
-00019c90: 6e5f 7661 6c2c 2022 5061 7469 656e 744e  n_val, "PatientN
-00019ca0: 616d 6522 0a20 2020 2020 2020 2020 2020  ame".           
-00019cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019cc0: 2029 2069 7320 4e6f 6e65 3a0a 2020 2020   ) is None:.    
-00019cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ce0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00019cf0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00019d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d10: 2020 2020 2020 2022 5c6e 5265 7361 6d70         "\nResamp
-00019d20: 6c65 3120 6272 6963 6b3a 5c6e 5468 6520  le1 brick:\nThe 
-00019d30: 2750 6174 6965 6e74 4e61 6d65 2720 220a  'PatientName' ".
-00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d60: 2020 2020 2274 6167 2063 6f75 6c64 206e      "tag could n
-00019d70: 6f74 2062 6520 6164 6465 6420 746f 2074  ot be added to t
-00019d80: 6865 2064 6174 6162 6173 6520 220a 2020  he database ".  
-00019d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019db0: 2020 2266 6f72 2074 6865 2027 7b7d 2720    "for the '{}' 
-00019dc0: 7061 7261 6d65 7465 722e 2054 6869 7320  parameter. This 
-00019dd0: 6361 6e20 6c65 6164 2074 6f20 220a 2020  can lead to ".  
-00019de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e00: 2020 2261 2073 7562 7365 7175 656e 7420    "a subsequent 
-00019e10: 6973 7375 6520 6475 7269 6e67 2022 0a20  issue during ". 
-00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e40: 2020 2022 696e 6974 6961 6c69 7a61 7469     "initializati
-00019e50: 6f6e 2121 5c6e 222e 666f 726d 6174 286f  on!!\n".format(o
-00019e60: 7574 5f76 616c 290a 2020 2020 2020 2020  ut_val).        
-00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e80: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00019e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ea0: 2020 2020 2020 2073 656c 662e 7461 6773         self.tags
-00019eb0: 5f69 6e68 6572 6974 616e 6365 280a 2020  _inheritance(.  
-00019ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ed0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00019ee0: 5f76 616c 2c0a 2020 2020 2020 2020 2020  _val,.          
-00019ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f00: 2020 2020 2020 6f75 745f 7661 6c2c 0a20        out_val,. 
-00019f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f20: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00019f30: 2020 2020 2020 2320 5265 7475 726e 2074        # Return t
-00019f40: 6865 2072 6571 7569 7265 6d65 6e74 2c20  he requirement, 
-00019f50: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
-00019f60: 7269 7461 6e63 655f 6469 6374 0a20 2020  ritance_dict.   
-00019f70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00019f80: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
-00019f90: 2829 0a0a 2020 2020 6465 6620 5f63 6865  ()..    def _che
-00019fa0: 636b 5f69 6e74 6572 7028 7365 6c66 293a  ck_interp(self):
-00019fb0: 0a20 2020 2020 2020 2022 2222 4368 6563  .        """Chec
-00019fc0: 6b73 2074 6865 206f 7264 6572 206f 6620  ks the order of 
-00019fd0: 7468 6520 7370 6c69 6e65 7320 696e 7465  the splines inte
-00019fe0: 7270 6f6c 6174 696f 6e2e 0a0a 2020 2020  rpolation...    
-00019ff0: 2020 2020 3a72 6574 7572 6e73 3a20 6120      :returns: a 
-0001a000: 6d65 7373 6167 6520 6163 636f 7264 696e  message accordin
-0001a010: 6720 746f 2074 6865 2073 656c 6563 7465  g to the selecte
-0001a020: 6420 6f72 6465 720a 2020 2020 2020 2020  d order.        
-0001a030: 2222 220a 0a20 2020 2020 2020 2023 2073  """..        # s
-0001a040: 6b69 6d61 6765 2e74 7261 6e73 666f 726d  kimage.transform
-0001a050: 2e72 6573 697a 6520 2864 6f65 7320 6e6f  .resize (does no
-0001a060: 7420 7365 656d 2074 6f20 6265 2074 6865  t seem to be the
-0001a070: 2062 6573 7420 736f 6c75 7469 6f6e 2066   best solution f
-0001a080: 6f72 0a20 2020 2020 2020 2023 2072 6573  or.        # res
-0001a090: 616d 706c 696e 6729 3a0a 2020 2020 2020  ampling):.      
-0001a0a0: 2020 2320 2d20 422d 7370 6c69 6e65 7320    # - B-splines 
-0001a0b0: 6f66 2074 6865 206f 7264 6572 2030 2061  of the order 0 a
-0001a0c0: 6e64 2031 2063 6f72 7265 7370 6f6e 6420  nd 1 correspond 
-0001a0d0: 746f 206e 6561 7265 7374 206e 6569 6768  to nearest neigh
-0001a0e0: 626f 7572 2061 6e64 0a20 2020 2020 2020  bour and.       
-0001a0f0: 2023 2020 206c 696e 6561 7220 696e 7465   #   linear inte
-0001a100: 7270 6f6c 6174 696f 6e2c 2072 6573 7065  rpolation, respe
-0001a110: 6374 6976 656c 792e 0a20 2020 2020 2020  ctively..       
-0001a120: 2023 202d 2042 2d73 706c 696e 6573 206f   # - B-splines o
-0001a130: 6620 6120 6869 6768 6572 206f 7264 6572  f a higher order
-0001a140: 2063 616e 2062 6520 6465 6669 6e65 6420   can be defined 
-0001a150: 6279 2061 2072 6570 6574 6974 6976 650a  by a repetitive.
-0001a160: 2020 2020 2020 2020 2320 2020 636f 6e76          #   conv
-0001a170: 6f6c 7574 696f 6e20 6f66 2074 6865 207a  olution of the z
-0001a180: 6572 6f74 682d 6f72 6465 7220 7370 6c69  eroth-order spli
-0001a190: 6e65 2028 7468 6520 626f 7820 6675 6e63  ne (the box func
-0001a1a0: 7469 6f6e 2920 7769 7468 0a20 2020 2020  tion) with.     
-0001a1b0: 2020 2023 2020 2069 7473 656c 662e 0a20     #   itself.. 
-0001a1c0: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-0001a1d0: 2023 206e 6962 6162 656c 2e70 726f 6365   # nibabel.proce
-0001a1e0: 7373 696e 672e 7265 7361 6d70 6c65 5f66  ssing.resample_f
-0001a1f0: 726f 6d5f 746f 2028 7365 656d 7320 746f  rom_to (seems to
-0001a200: 2062 6520 6120 676f 6f64 2073 6f6c 7574   be a good solut
-0001a210: 696f 6e2c 2062 7574 0a20 2020 2020 2020  ion, but.       
-0001a220: 2023 2063 616e 2067 6976 6520 6e6f 6e2d   # can give non-
-0001a230: 7a65 726f 2069 6e74 656e 7369 7479 2066  zero intensity f
-0001a240: 6f72 2074 6865 2062 6163 6b67 726f 756e  or the backgroun
-0001a250: 6420 2d3e 206e 6565 6473 0a20 2020 2020  d -> needs.     
-0001a260: 2020 2023 2074 6872 6573 6f6c 6469 6e67     # thresolding
-0001a270: 203f 290a 2020 2020 2020 2020 230a 2020   ?).        #.  
-0001a280: 2020 2020 2020 2320 6e69 6c65 6172 6e2e        # nilearn.
-0001a290: 696d 6167 652e 7265 7361 6d70 6c65 5f74  image.resample_t
-0001a2a0: 6f5f 696d 6720 2873 6565 6d73 2074 6f20  o_img (seems to 
-0001a2b0: 6265 2061 2067 6f6f 6420 736f 6c75 7469  be a good soluti
-0001a2c0: 6f6e 2c20 6e6f 0a20 2020 2020 2020 2023  on, no.        #
-0001a2d0: 206e 6f6e 2d7a 6572 6f20 696e 7465 6e73   non-zero intens
-0001a2e0: 6974 7920 666f 7220 7468 6520 6261 636b  ity for the back
-0001a2f0: 6772 6f75 6e64 206f 6273 6572 7665 6429  ground observed)
-0001a300: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0001a310: 662e 696e 7465 7270 203d 3d20 303a 0a20  f.interp == 0:. 
-0001a320: 2020 2020 2020 2020 2020 2023 2073 6b69             # ski
-0001a330: 6d61 6765 2061 6e64 206e 6962 6162 656c  mage and nibabel
-0001a340: 3a20 4e65 6172 6573 7420 6e65 6967 6862  : Nearest neighb
-0001a350: 6f75 720a 2020 2020 2020 2020 2020 2020  our.            
-0001a360: 7265 7475 726e 2022 7370 6c69 6e65 2069  return "spline i
-0001a370: 6e74 6572 706f 6c61 7469 6f6e 206f 6620  nterpolation of 
-0001a380: 6f72 6465 7220 3020 284e 6561 7265 7374  order 0 (Nearest
-0001a390: 2d6e 6569 6768 626f 7572 2922 0a0a 2020  -neighbour)"..  
-0001a3a0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-0001a3b0: 696e 7465 7270 203d 3d20 313a 0a20 2020  interp == 1:.   
-0001a3c0: 2020 2020 2020 2020 2023 2073 6b69 6d61           # skima
-0001a3d0: 6765 3a20 4974 2073 6565 6d73 2074 6861  ge: It seems tha
-0001a3e0: 7420 7769 7468 2064 696d 656e 7369 6f6e  t with dimension
-0001a3f0: 733d 3320 616e 6420 422d 7370 6c69 6e65  s=3 and B-spline
-0001a400: 206f 7264 6572 3d31 2c0a 2020 2020 2020   order=1,.      
-0001a410: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001a420: 2074 6865 2069 6e74 6572 706f 6c61 7469   the interpolati
-0001a430: 6f6e 2077 6f75 6c64 2062 6520 6571 7569  on would be equi
-0001a440: 7661 6c65 6e74 2074 6f20 2274 7269 6c69  valent to "trili
-0001a450: 6e65 6172 220a 2020 2020 2020 2020 2020  near".          
-0001a460: 2020 2320 7265 7475 726e 2028 2242 692d    # return ("Bi-
-0001a470: 6c69 6e65 6172 2028 7769 7468 2064 696d  linear (with dim
-0001a480: 656e 7369 6f6e 733d 332c 2042 692d 6c69  ensions=3, Bi-li
-0001a490: 6e65 6172 2069 7320 6571 7569 7661 6c65  near is equivale
-0001a4a0: 6e74 2022 0a20 2020 2020 2020 2020 2020  nt ".           
-0001a4b0: 2023 2020 2020 2020 2020 2274 6f20 2774   #        "to 't
-0001a4c0: 7269 6c69 6e65 6172 2729 2229 0a0a 2020  rilinear')")..  
-0001a4d0: 2020 2020 2020 2020 2020 2320 6e69 6261            # niba
-0001a4e0: 6265 6c3a 2073 706c 696e 6520 696e 7465  bel: spline inte
-0001a4f0: 7270 6f6c 6174 696f 6e20 6f66 206f 7264  rpolation of ord
-0001a500: 6572 2031 0a20 2020 2020 2020 2020 2020  er 1.           
-0001a510: 2072 6574 7572 6e20 2273 706c 696e 6520   return "spline 
-0001a520: 696e 7465 7270 6f6c 6174 696f 6e20 6f66  interpolation of
-0001a530: 206f 7264 6572 2031 220a 0a20 2020 2020   order 1"..     
-0001a540: 2020 2065 6c69 6620 7365 6c66 2e69 6e74     elif self.int
-0001a550: 6572 7020 3d3d 2032 3a0a 2020 2020 2020  erp == 2:.      
-0001a560: 2020 2020 2020 2320 736b 696d 6167 653a        # skimage:
-0001a570: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
-0001a580: 6574 7572 6e20 2242 692d 7175 6164 7261  eturn "Bi-quadra
-0001a590: 7469 6322 0a0a 2020 2020 2020 2020 2020  tic"..          
-0001a5a0: 2020 2320 6e69 6261 6265 6c3a 2073 706c    # nibabel: spl
-0001a5b0: 696e 6520 696e 7465 7270 6f6c 6174 696f  ine interpolatio
-0001a5c0: 6e20 6f66 206f 7264 6572 2032 0a20 2020  n of order 2.   
-0001a5d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001a5e0: 2273 706c 696e 6520 696e 7465 7270 6f6c  "spline interpol
-0001a5f0: 6174 696f 6e20 6f66 206f 7264 6572 2032  ation of order 2
-0001a600: 220a 0a20 2020 2020 2020 2065 6c69 6620  "..        elif 
-0001a610: 7365 6c66 2e69 6e74 6572 7020 3d3d 2033  self.interp == 3
-0001a620: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001a630: 736b 696d 6167 650a 2020 2020 2020 2020  skimage.        
-0001a640: 2020 2020 2320 7265 7475 726e 2022 4269      # return "Bi
-0001a650: 2d63 7562 6963 220a 0a20 2020 2020 2020  -cubic"..       
-0001a660: 2020 2020 2023 206e 6962 6162 656c 3a20       # nibabel: 
-0001a670: 7370 6c69 6e65 2069 6e74 6572 706f 6c61  spline interpola
-0001a680: 7469 6f6e 206f 6620 6f72 6465 7220 333a  tion of order 3:
-0001a690: 2074 7269 6c69 6e65 6172 0a20 2020 2020   trilinear.     
-0001a6a0: 2020 2020 2020 2072 6574 7572 6e20 2273         return "s
-0001a6b0: 706c 696e 6520 696e 7465 7270 6f6c 6174  pline interpolat
-0001a6c0: 696f 6e20 6f66 206f 7264 6572 2033 2028  ion of order 3 (
-0001a6d0: 7472 696c 696e 6561 7229 220a 0a20 2020  trilinear)"..   
-0001a6e0: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
-0001a6f0: 6e74 6572 7020 3d3d 2034 3a0a 2020 2020  nterp == 4:.    
-0001a700: 2020 2020 2020 2020 2320 736b 696d 6167          # skimag
-0001a710: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-0001a720: 7265 7475 726e 2022 4269 2d71 7561 7274  return "Bi-quart
-0001a730: 6963 220a 0a20 2020 2020 2020 2020 2020  ic"..           
-0001a740: 2023 206e 6962 6162 656c 3a20 7370 6c69   # nibabel: spli
-0001a750: 6e65 2069 6e74 6572 706f 6c61 7469 6f6e  ne interpolation
-0001a760: 206f 6620 6f72 6465 7220 340a 2020 2020   of order 4.    
-0001a770: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-0001a780: 7370 6c69 6e65 2069 6e74 6572 706f 6c61  spline interpola
-0001a790: 7469 6f6e 206f 6620 6f72 6465 7220 3422  tion of order 4"
-0001a7a0: 0a0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
-0001a7b0: 656c 662e 696e 7465 7270 203d 3d20 353a  elf.interp == 5:
-0001a7c0: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-0001a7d0: 6b69 6d61 6765 0a20 2020 2020 2020 2020  kimage.         
-0001a7e0: 2020 2023 2072 6574 7572 6e20 2242 692d     # return "Bi-
-0001a7f0: 7175 696e 7469 6322 0a0a 2020 2020 2020  quintic"..      
-0001a800: 2020 2020 2020 2320 6e69 6261 6265 6c3a        # nibabel:
-0001a810: 2073 706c 696e 6520 696e 7465 7270 6f6c   spline interpol
-0001a820: 6174 696f 6e20 6f66 206f 7264 6572 2035  ation of order 5
-0001a830: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001a840: 7572 6e20 2273 706c 696e 6520 696e 7465  urn "spline inte
-0001a850: 7270 6f6c 6174 696f 6e20 6f66 206f 7264  rpolation of ord
-0001a860: 6572 2035 220a 0a20 2020 2064 6566 2072  er 5"..    def r
-0001a870: 756e 5f70 726f 6365 7373 5f6d 6961 2873  un_process_mia(s
-0001a880: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0001a890: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
-0001a8a0: 6520 7072 6f63 6573 7320 6c61 756e 6368  e process launch
-0001a8b0: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
-0001a8c0: 636b 2e22 2222 0a20 2020 2020 2020 2073  ck.""".        s
-0001a8d0: 7570 6572 2852 6573 616d 706c 6531 2c20  uper(Resample1, 
-0001a8e0: 7365 6c66 292e 7275 6e5f 7072 6f63 6573  self).run_proces
-0001a8f0: 735f 6d69 6128 290a 2020 2020 2020 2020  s_mia().        
-0001a900: 6669 6c65 735f 6e61 6d65 203d 2073 656c  files_name = sel
-0001a910: 662e 6669 6c65 735f 746f 5f72 6573 616d  f.files_to_resam
-0001a920: 706c 650a 2020 2020 2020 2020 7265 664e  ple.        refN
-0001a930: 616d 6520 3d20 6e69 622e 6c6f 6164 2873  ame = nib.load(s
-0001a940: 656c 662e 7265 6665 7265 6e63 655f 696d  elf.reference_im
-0001a950: 6167 6529 0a20 2020 2020 2020 2070 7269  age).        pri
-0001a960: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0001a970: 225c 6e52 6573 616d 706c 6531 2070 726f  "\nResample1 pro
-0001a980: 6365 7373 2066 726f 6d20 6d69 615f 7072  cess from mia_pr
-0001a990: 6f63 6573 7365 733a 205c 6e22 2c0a 2020  ocesses: \n",.  
-0001a9a0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0001a9b0: 6368 6563 6b5f 696e 7465 7270 2829 2c0a  check_interp(),.
-0001a9c0: 2020 2020 2020 2020 2020 2020 2220 5c6e              " \n
-0001a9d0: 222c 0a20 2020 2020 2020 2029 0a0a 2020  ",.        )..  
-0001a9e0: 2020 2020 2020 666f 7220 6669 6c65 5f6e        for file_n
-0001a9f0: 616d 6520 696e 2066 696c 6573 5f6e 616d  ame in files_nam
-0001aa00: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-0001aa10: 696c 654e 616d 6520 3d20 6e69 622e 6c6f  ileName = nib.lo
-0001aa20: 6164 2866 696c 655f 6e61 6d65 290a 2020  ad(file_name).  
-0001aa30: 2020 2020 2020 2020 2020 2320 6d61 736b            # mask
-0001aa40: 5f64 6174 6120 3d20 6d61 736b 2e67 6574  _data = mask.get
-0001aa50: 5f66 6461 7461 2829 2020 2320 736b 696d  _fdata()  # skim
-0001aa60: 6167 650a 0a20 2020 2020 2020 2020 2020  age..           
-0001aa70: 2023 2043 7572 7265 6e74 6c79 2c20 7265   # Currently, re
-0001aa80: 7361 6d70 6c69 6e67 2069 7320 6f6e 6c79  sampling is only
-0001aa90: 2064 6f6e 6520 666f 7220 3344 2069 6d61   done for 3D ima
-0001aaa0: 6765 7320 7573 696e 6720 3344 0a20 2020  ges using 3D.   
-0001aab0: 2020 2020 2020 2020 2023 206f 7220 3444           # or 4D
-0001aac0: 2069 6d61 6765 7320 666f 7220 7265 6665   images for refe
-0001aad0: 7265 6e63 652e 2049 7420 776f 756c 6420  rence. It would 
-0001aae0: 6265 2069 6e74 6572 6573 7469 6e67 2074  be interesting t
-0001aaf0: 6f20 7769 6465 6e20 7468 650a 2020 2020  o widen the.    
-0001ab00: 2020 2020 2020 2020 2320 706f 7373 6962          # possib
-0001ab10: 696c 6974 6965 7320 746f 206d 6f72 6520  ilities to more 
-0001ab20: 6361 7365 7320 2861 7420 6c65 6173 7420  cases (at least 
-0001ab30: 6120 3444 2075 7369 6e67 2061 2033 442c  a 4D using a 3D,
-0001ab40: 2061 6e64 2077 6879 0a20 2020 2020 2020   and why.       
-0001ab50: 2020 2020 2023 206e 6f74 2c20 746f 206c       # not, to l
-0001ab60: 6172 6765 7220 6469 6d65 6e73 696f 6e73  arger dimensions
-0001ab70: 3f29 2e20 4375 7272 656e 746c 792c 2077  ?). Currently, w
-0001ab80: 6520 7573 650a 2020 2020 2020 2020 2020  e use.          
-0001ab90: 2020 2320 6e69 6261 6265 6c2e 7072 6f63    # nibabel.proc
-0001aba0: 6573 7369 6e67 2e72 6573 616d 706c 655f  essing.resample_
-0001abb0: 6672 6f6d 5f74 6f28 292c 2028 7365 650a  from_to(), (see.
-0001abc0: 2020 2020 2020 2020 2020 2020 2320 6874              # ht
-0001abd0: 7470 733a 2f2f 6d61 696c 2e70 7974 686f  tps://mail.pytho
-0001abe0: 6e2e 6f72 672f 7069 7065 726d 6169 6c2f  n.org/pipermail/
-0001abf0: 6e65 7572 6f69 6d61 6769 6e67 2f32 3031  neuroimaging/201
-0001ac00: 392d 4a61 6e75 6172 792f 3030 3139 3032  9-January/001902
-0001ac10: 2e68 746d 6c29 2e0a 2020 2020 2020 2020  .html)..        
-0001ac20: 2020 2020 2320 4974 2073 6565 6d73 2074      # It seems t
-0001ac30: 6869 7320 6d65 7468 6f64 2070 726f 6475  his method produ
-0001ac40: 6365 7320 6120 6c69 7474 6c65 206e 6f69  ces a little noi
-0001ac50: 7365 2028 6361 6e20 6769 7665 206e 6f6e  se (can give non
-0001ac60: 2d7a 6572 6f0a 2020 2020 2020 2020 2020  -zero.          
-0001ac70: 2020 2320 696e 7465 6e73 6974 7920 666f    # intensity fo
-0001ac80: 7220 7468 6520 6261 636b 6772 6f75 6e64  r the background
-0001ac90: 292e 2049 6e20 6164 6469 7469 6f6e 2074  ). In addition t
-0001aca0: 6f20 7468 6520 7265 736f 6c75 7469 6f6e  o the resolution
-0001acb0: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-0001acc0: 6574 7469 6e67 7320 6974 2073 6565 6d73  ettings it seems
-0001acd0: 2074 6865 2073 697a 6520 6f66 2074 6865   the size of the
-0001ace0: 2072 6566 6572 656e 6365 5f69 6d61 6765   reference_image
-0001acf0: 2061 7265 2061 6c73 6f0a 2020 2020 2020   are also.      
-0001ad00: 2020 2020 2020 2320 7472 616e 7366 6572        # transfer
-0001ad10: 7265 6420 746f 2074 6865 2072 6573 616d  red to the resam
-0001ad20: 706c 6564 2069 6d61 6765 2062 7574 206e  pled image but n
-0001ad30: 6f74 2074 6865 206f 7269 656e 7461 7469  ot the orientati
-0001ad40: 6f6e 7320 616e 640a 2020 2020 2020 2020  ons and.        
-0001ad50: 2020 2020 2320 706f 7369 7469 6f6e 7320      # positions 
-0001ad60: 286f 7574 7075 7420 7370 6163 6520 636f  (output space co
-0001ad70: 6d65 7320 6672 6f6d 2074 6865 2061 6666  mes from the aff
-0001ad80: 696e 6520 6f66 0a20 2020 2020 2020 2020  ine of.         
-0001ad90: 2020 2023 2066 696c 6573 5f74 6f5f 7265     # files_to_re
-0001ada0: 7361 6d70 6c65 292e 0a0a 2020 2020 2020  sample)...      
-0001adb0: 2020 2020 2020 6966 206c 656e 2866 696c        if len(fil
-0001adc0: 654e 616d 652e 7368 6170 6529 203d 3d20  eName.shape) == 
-0001add0: 6c65 6e28 7265 664e 616d 652e 7368 6170  len(refName.shap
-0001ade0: 6529 203d 3d20 333a 0a20 2020 2020 2020  e) == 3:.       
-0001adf0: 2020 2020 2020 2020 2023 206e 6962 6162           # nibab
-0001ae00: 656c 3a0a 2020 2020 2020 2020 2020 2020  el:.            
-0001ae10: 2020 2020 6669 6c65 4669 6e61 6c20 3d20      fileFinal = 
-0001ae20: 6e69 6270 2e72 6573 616d 706c 655f 6672  nibp.resample_fr
-0001ae30: 6f6d 5f74 6f28 0a20 2020 2020 2020 2020  om_to(.         
-0001ae40: 2020 2020 2020 2020 2020 2066 696c 654e             fileN
-0001ae50: 616d 652c 2072 6566 4e61 6d65 2c20 6f72  ame, refName, or
-0001ae60: 6465 723d 7365 6c66 2e69 6e74 6572 700a  der=self.interp.
-0001ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae80: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0001ae90: 6620 6c65 6e28 6669 6c65 4e61 6d65 2e73  f len(fileName.s
-0001aea0: 6861 7065 2920 3d3d 2033 2061 6e64 206c  hape) == 3 and l
-0001aeb0: 656e 2872 6566 4e61 6d65 2e73 6861 7065  en(refName.shape
-0001aec0: 2920 3d3d 2034 3a0a 2020 2020 2020 2020  ) == 4:.        
-0001aed0: 2020 2020 2020 2020 2320 736b 696d 6167          # skimag
-0001aee0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001aef0: 2020 2320 7265 665f 7369 7a65 203d 2072    # ref_size = r
-0001af00: 6566 5f64 6174 612e 7368 6170 655b 3a33  ef_data.shape[:3
-0001af10: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001af20: 2020 2320 7265 7369 7a65 645f 6d61 736b    # resized_mask
-0001af30: 5f64 6174 6120 3d20 7265 7369 7a65 286d  _data = resize(m
-0001af40: 6173 6b5f 6461 7461 2c0a 2020 2020 2020  ask_data,.      
-0001af50: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af70: 2020 2020 2020 7265 665f 7369 7a65 2c0a        ref_size,.
-0001af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af90: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001afa0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0001afb0: 723d 7365 6c66 2e69 6e74 6572 702c 0a20  r=self.interp,. 
-0001afc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afe0: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
-0001aff0: 2772 6566 6c65 6374 2729 0a20 2020 2020  'reflect').     
-0001b000: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
-0001b010: 4f3a 2054 616b 696e 6720 696e 666f 206f  O: Taking info o
-0001b020: 6620 6d61 736b 2773 206f 7220 7265 6627  f mask's or ref'
-0001b030: 7320 6865 6164 6572 3f0a 2020 2020 2020  s header?.      
-0001b040: 2020 2020 2020 2020 2020 2320 6d61 736b            # mask
-0001b050: 5f66 696e 616c 203d 206e 6962 2e4e 6966  _final = nib.Nif
-0001b060: 7469 3149 6d61 6765 2872 6573 697a 6564  ti1Image(resized
-0001b070: 5f6d 6173 6b5f 6461 7461 2c0a 2020 2020  _mask_data,.    
-0001b080: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-0001b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0a0: 2020 2020 2020 2020 2020 7265 662e 6166            ref.af
-0001b0b0: 6669 6e65 2c0a 2020 2020 2020 2020 2020  fine,.          
-0001b0c0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0e0: 2020 2020 7265 662e 6865 6164 6572 290a      ref.header).
-0001b0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b100: 2023 206e 6962 6162 656c 3a0a 2020 2020   # nibabel:.    
-0001b110: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0001b120: 4669 6e61 6c20 3d20 6e69 6270 2e72 6573  Final = nibp.res
-0001b130: 616d 706c 655f 6672 6f6d 5f74 6f28 0a20  ample_from_to(. 
+00018500: 2066 696c 655f 6578 7465 6e73 696f 6e20   file_extension 
+00018510: 3d20 222e 6e69 692e 677a 220a 0a20 2020  = ".nii.gz"..   
+00018520: 2020 2020 2020 2020 2066 696c 655f 6f75           file_ou
+00018530: 7420 3d20 6f73 2e70 6174 682e 6a6f 696e  t = os.path.join
+00018540: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00018550: 2020 7365 6c66 2e6f 7574 7075 745f 6469    self.output_di
+00018560: 7265 6374 6f72 792c 0a20 2020 2020 2020  rectory,.       
+00018570: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
+00018580: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018590: 656c 662e 7072 6566 6978 2e73 7472 6970  elf.prefix.strip
+000185a0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+000185b0: 2020 2020 2020 202b 2066 696c 655f 6e61         + file_na
+000185c0: 6d65 5f6e 6f5f 6578 740a 2020 2020 2020  me_no_ext.      
+000185d0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000185e0: 7365 6c66 2e73 7566 6669 782e 7374 7269  self.suffix.stri
+000185f0: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00018600: 2020 2020 2020 2020 2b20 6669 6c65 5f65          + file_e
+00018610: 7874 656e 7369 6f6e 0a20 2020 2020 2020  xtension.       
+00018620: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+00018630: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00018640: 2020 2020 2020 6e69 622e 7361 7665 286d        nib.save(m
+00018650: 6173 6b69 6d67 2c20 6669 6c65 5f6f 7574  askimg, file_out
+00018660: 290a 0a0a 636c 6173 7320 4e6f 6e53 7465  )...class NonSte
+00018670: 6164 7953 7461 7465 4465 7465 6374 6f72  adyStateDetector
+00018680: 2850 726f 6365 7373 4d49 4129 3a0a 2020  (ProcessMIA):.  
+00018690: 2020 2222 220a 2020 2020 2a44 6574 6563    """.    *Detec
+000186a0: 7420 6e6f 6e2d 7374 6561 6479 2d73 7461  t non-steady-sta
+000186b0: 7465 2061 7420 7468 6520 6265 6769 6e6e  te at the beginn
+000186c0: 696e 6720 6f66 2061 2062 6f6c 6420 3444  ing of a bold 4D
+000186d0: 2069 6d61 6765 2a0a 0a20 2020 2050 6c65   image*..    Ple
+000186e0: 6173 652c 2073 6565 2074 6865 2063 6f6d  ase, see the com
+000186f0: 706c 6574 6520 646f 6375 6d65 6e74 6174  plete documentat
+00018700: 696f 6e20 666f 7220 7468 650a 2020 2020  ion for the.    
+00018710: 604e 6f6e 5374 6561 6479 5374 6174 6544  `NonSteadyStateD
+00018720: 6574 6563 746f 7220 6272 6963 6b20 696e  etector brick in
+00018730: 2074 6865 206d 6961 5f70 726f 6365 7373   the mia_process
+00018740: 6573 2077 6562 7369 7465 0a20 2020 203c  es website.    <
+00018750: 6874 7470 733a 2f2f 706f 7075 6c73 652e  https://populse.
+00018760: 6769 7468 7562 2e69 6f2f 6d69 615f 7072  github.io/mia_pr
+00018770: 6f63 6573 7365 732f 6874 6d6c 2f64 6f63  ocesses/html/doc
+00018780: 756d 656e 7461 7469 6f6e 2f62 7269 636b  umentation/brick
+00018790: 732f 7072 6570 726f 6365 7373 2f6f 7468  s/preprocess/oth
+000187a0: 6572 2f4e 6f6e 5374 6561 6479 5374 6174  er/NonSteadyStat
+000187b0: 6544 6574 6563 746f 722e 6874 6d6c 3e60  eDetector.html>`
+000187c0: 5f0a 0a20 2020 2061 6461 7074 6564 2066  _..    adapted f
+000187d0: 726f 6d3a 0a20 2020 2068 7474 7073 3a2f  rom:.    https:/
+000187e0: 2f67 6974 6875 622e 636f 6d2f 6e69 7079  /github.com/nipy
+000187f0: 2f6e 6970 7970 652f 626c 6f62 2f66 3636  /nipype/blob/f66
+00018800: 3261 6366 6365 3864 6566 3437 3137 6530  2acfce8def4717e0
+00018810: 6333 3431 3436 3138 6633 6135 6465 3539  c3414618f3a5de59
+00018820: 3133 6233 312f 6e69 7079 7065 2f61 6c67  13b31/nipype/alg
+00018830: 6f72 6974 686d 732f 636f 6e66 6f75 6e64  orithms/confound
+00018840: 732e 7079 234c 3937 340a 0a20 2020 2022  s.py#L974..    "
+00018850: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00018860: 6974 5f5f 2873 656c 6629 3a0a 2020 2020  it__(self):.    
+00018870: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
+00018880: 2074 6f20 7468 6520 6174 7472 6962 7574   to the attribut
+00018890: 6573 2069 6e69 7469 616c 6973 6174 696f  es initialisatio
+000188a0: 6e20 2f20 696e 7374 616e 7469 6174 696f  n / instantiatio
+000188b0: 6e2e 0a0a 2020 2020 2020 2020 5468 6520  n...        The 
+000188c0: 696e 7075 7420 616e 6420 6f75 7470 7574  input and output
+000188d0: 2070 6c75 6773 2061 7265 2064 6566 696e   plugs are defin
+000188e0: 6564 2068 6572 652e 2054 6865 2073 7065  ed here. The spe
+000188f0: 6369 616c 0a20 2020 2020 2020 2027 7365  cial.        'se
+00018900: 6c66 2e72 6571 7569 7265 6d65 6e74 2720  lf.requirement' 
+00018910: 6174 7472 6962 7574 6520 286f 7074 696f  attribute (optio
+00018920: 6e61 6c29 2069 7320 7573 6564 2074 6f20  nal) is used to 
+00018930: 6465 6669 6e65 2074 6865 0a20 2020 2020  define the.     
+00018940: 2020 2074 6869 7264 2d70 6172 7479 2070     third-party p
+00018950: 726f 6475 6374 7320 6e65 6365 7373 6172  roducts necessar
+00018960: 7920 666f 7220 7468 6520 7275 6e6e 696e  y for the runnin
+00018970: 6720 6f66 2074 6865 2062 7269 636b 2e0a  g of the brick..
+00018980: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00018990: 2020 2020 2320 496e 6974 6961 6c69 7361      # Initialisa
+000189a0: 7469 6f6e 206f 6620 7468 6520 6f62 6a65  tion of the obje
+000189b0: 6374 7320 6e65 6564 6564 2066 6f72 2074  cts needed for t
+000189c0: 6865 206c 6175 6e63 6820 6f66 2074 6865  he launch of the
+000189d0: 2062 7269 636b 0a20 2020 2020 2020 2073   brick.        s
+000189e0: 7570 6572 284e 6f6e 5374 6561 6479 5374  uper(NonSteadySt
+000189f0: 6174 6544 6574 6563 746f 722c 2073 656c  ateDetector, sel
+00018a00: 6629 2e5f 5f69 6e69 745f 5f28 290a 0a20  f).__init__().. 
+00018a10: 2020 2020 2020 2023 2054 6869 7264 2070         # Third p
+00018a20: 6172 7479 2073 6f66 7477 6172 6573 2072  arty softwares r
+00018a30: 6571 7569 7265 6420 666f 7220 7468 6520  equired for the 
+00018a40: 6578 6563 7574 696f 6e20 6f66 2074 6865  execution of the
+00018a50: 2062 7269 636b 0a20 2020 2020 2020 2073   brick.        s
+00018a60: 656c 662e 7265 7175 6972 656d 656e 7420  elf.requirement 
+00018a70: 3d20 5b5d 0a0a 2020 2020 2020 2020 2320  = []..        # 
+00018a80: 496e 7075 7473 2064 6573 6372 6970 7469  Inputs descripti
+00018a90: 6f6e 0a20 2020 2020 2020 2069 6e5f 6669  on.        in_fi
+00018aa0: 6c65 5f64 6573 6320 3d20 2241 6e20 6578  le_desc = "An ex
+00018ab0: 6973 7469 6e67 2070 6174 6820 6669 6c65  isting path file
+00018ac0: 2e22 0a0a 2020 2020 2020 2020 2320 4f75  ."..        # Ou
+00018ad0: 7470 7574 7320 6465 7363 7269 7074 696f  tputs descriptio
+00018ae0: 6e0a 2020 2020 2020 2020 6e5f 766f 6c75  n.        n_volu
+00018af0: 6d65 735f 746f 5f64 6973 6361 7264 5f64  mes_to_discard_d
+00018b00: 6573 6320 3d20 224e 756d 6265 7220 6f66  esc = "Number of
+00018b10: 206e 6f6e 2073 7465 6164 7920 7374 6174   non steady stat
+00018b20: 6520 766f 6c75 6d65 7322 0a0a 2020 2020  e volumes"..    
+00018b30: 2020 2020 2320 496e 7075 7473 2074 7261      # Inputs tra
+00018b40: 6974 730a 2020 2020 2020 2020 7365 6c66  its.        self
+00018b50: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
+00018b60: 2020 2020 2020 2020 2269 6e5f 6669 6c65          "in_file
+00018b70: 222c 2046 696c 6528 6f75 7470 7574 3d46  ", File(output=F
+00018b80: 616c 7365 2c20 6f70 7469 6f6e 616c 3d46  alse, optional=F
+00018b90: 616c 7365 2c20 6465 7363 3d69 6e5f 6669  alse, desc=in_fi
+00018ba0: 6c65 5f64 6573 6329 0a20 2020 2020 2020  le_desc).       
+00018bb0: 2029 0a0a 2020 2020 2020 2020 2320 4f75   )..        # Ou
+00018bc0: 7470 7574 7320 7472 6169 7473 0a20 2020  tputs traits.   
+00018bd0: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+00018be0: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+00018bf0: 2022 6e5f 766f 6c75 6d65 735f 746f 5f64   "n_volumes_to_d
+00018c00: 6973 6361 7264 222c 0a20 2020 2020 2020  iscard",.       
+00018c10: 2020 2020 2074 7261 6974 732e 496e 7428       traits.Int(
+00018c20: 6f75 7470 7574 3d54 7275 652c 2064 6573  output=True, des
+00018c30: 633d 6e5f 766f 6c75 6d65 735f 746f 5f64  c=n_volumes_to_d
+00018c40: 6973 6361 7264 5f64 6573 6329 2c0a 2020  iscard_desc),.  
+00018c50: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00018c60: 2073 656c 662e 696e 6974 5f64 6566 6175   self.init_defau
+00018c70: 6c74 5f74 7261 6974 7328 290a 0a20 2020  lt_traits()..   
+00018c80: 2064 6566 206c 6973 745f 6f75 7470 7574   def list_output
+00018c90: 7328 7365 6c66 2c20 6973 5f70 6c75 6767  s(self, is_plugg
+00018ca0: 6564 3d4e 6f6e 6529 3a0a 2020 2020 2020  ed=None):.      
+00018cb0: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
+00018cc0: 6f20 7468 6520 696e 6974 6961 6c69 7361  o the initialisa
+00018cd0: 7469 6f6e 2073 7465 7020 6f66 2074 6865  tion step of the
+00018ce0: 2062 7269 636b 2e0a 0a20 2020 2020 2020   brick...       
+00018cf0: 2054 6865 206d 6169 6e20 6f62 6a65 6374   The main object
+00018d00: 6976 6520 6f66 2074 6869 7320 6d65 7468  ive of this meth
+00018d10: 6f64 2069 7320 746f 2070 726f 6475 6365  od is to produce
+00018d20: 2074 6865 206f 7574 7075 7473 206f 6620   the outputs of 
+00018d30: 7468 650a 2020 2020 2020 2020 6272 6963  the.        bric
+00018d40: 6b73 2028 7365 6c66 2e6f 7574 7075 7473  ks (self.outputs
+00018d50: 2920 616e 6420 7468 6520 6173 736f 6369  ) and the associ
+00018d60: 6174 6564 2074 6167 7320 2873 656c 662e  ated tags (self.
+00018d70: 696e 6865 7269 7461 6e63 655f 6469 6329  inheritance_dic)
+00018d80: 2c0a 2020 2020 2020 2020 6966 2064 6566  ,.        if def
+00018d90: 696e 6564 2068 6572 652e 2054 6f20 776f  ined here. To wo
+00018da0: 726b 2070 726f 7065 726c 7920 7468 6973  rk properly this
+00018db0: 206d 6574 686f 6420 6d75 7374 2072 6574   method must ret
+00018dc0: 7572 6e0a 2020 2020 2020 2020 7365 6c66  urn.        self
+00018dd0: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
+00018de0: 2829 206f 626a 6563 742e 0a0a 2020 2020  () object...    
+00018df0: 2020 2020 3a70 6172 616d 2069 735f 706c      :param is_pl
+00018e00: 7567 6765 643a 2074 6865 2073 7461 7465  ugged: the state
+00018e10: 2c20 6c69 6e6b 6564 206f 7220 6e6f 742c  , linked or not,
+00018e20: 206f 6620 7468 6520 706c 7567 732e 0a20   of the plugs.. 
+00018e30: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
+00018e40: 2061 2064 6963 7469 6f6e 6172 7920 7769   a dictionary wi
+00018e50: 7468 2072 6571 7569 7265 6d65 6e74 2c20  th requirement, 
+00018e60: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
+00018e70: 7269 7461 6e63 655f 6469 6374 2e0a 2020  ritance_dict..  
+00018e80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018e90: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
+00018ea0: 6865 7269 7461 6e63 6520 746f 2050 726f  heritance to Pro
+00018eb0: 6365 7373 4d49 4120 636c 6173 732c 206c  cessMIA class, l
+00018ec0: 6973 745f 6f75 7470 7574 7320 6d65 7468  ist_outputs meth
+00018ed0: 6f64 0a20 2020 2020 2020 2073 7570 6572  od.        super
+00018ee0: 284e 6f6e 5374 6561 6479 5374 6174 6544  (NonSteadyStateD
+00018ef0: 6574 6563 746f 722c 2073 656c 6629 2e6c  etector, self).l
+00018f00: 6973 745f 6f75 7470 7574 7328 290a 0a20  ist_outputs().. 
+00018f10: 2020 2020 2020 2023 204f 7574 7075 7473         # Outputs
+00018f20: 2064 6566 696e 6974 696f 6e0a 2020 2020   definition.    
+00018f30: 2020 2020 6966 2073 656c 662e 696e 5f66      if self.in_f
+00018f40: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+00018f50: 2073 656c 662e 6f75 7470 7574 735b 226e   self.outputs["n
+00018f60: 5f76 6f6c 756d 6573 5f74 6f5f 6469 7363  _volumes_to_disc
+00018f70: 6172 6422 5d20 3d20 300a 0a20 2020 2020  ard"] = 0..     
+00018f80: 2020 2023 2052 6574 7572 6e20 7468 6520     # Return the 
+00018f90: 7265 7175 6972 656d 656e 742c 206f 7574  requirement, out
+00018fa0: 7075 7473 2061 6e64 2069 6e68 6572 6974  puts and inherit
+00018fb0: 616e 6365 5f64 6963 740a 2020 2020 2020  ance_dict.      
+00018fc0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+00018fd0: 6b65 5f69 6e69 7452 6573 756c 7428 290a  ke_initResult().
+00018fe0: 0a20 2020 2064 6566 2072 756e 5f70 726f  .    def run_pro
+00018ff0: 6365 7373 5f6d 6961 2873 656c 6629 3a0a  cess_mia(self):.
+00019000: 2020 2020 2020 2020 2222 2244 6564 6963          """Dedic
+00019010: 6174 6564 2074 6f20 7468 6520 7072 6f63  ated to the proc
+00019020: 6573 7320 6c61 756e 6368 2073 7465 7020  ess launch step 
+00019030: 6f66 2074 6865 2062 7269 636b 2e22 2222  of the brick."""
+00019040: 0a20 2020 2020 2020 2073 7570 6572 284e  .        super(N
+00019050: 6f6e 5374 6561 6479 5374 6174 6544 6574  onSteadyStateDet
+00019060: 6563 746f 722c 2073 656c 6629 2e72 756e  ector, self).run
+00019070: 5f70 726f 6365 7373 5f6d 6961 2829 0a0a  _process_mia()..
+00019080: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00019090: 6520 3d20 7365 6c66 2e69 6e5f 6669 6c65  e = self.in_file
+000190a0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+000190b0: 2020 2020 2020 2020 2020 2069 6e5f 6e69             in_ni
+000190c0: 6920 3d20 6e69 622e 6c6f 6164 2866 696c  i = nib.load(fil
+000190d0: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+000190e0: 6578 6365 7074 2028 0a20 2020 2020 2020  except (.       
+000190f0: 2020 2020 206e 6962 2e66 696c 6562 6173       nib.filebas
+00019100: 6564 696d 6167 6573 2e49 6d61 6765 4669  edimages.ImageFi
+00019110: 6c65 4572 726f 722c 0a20 2020 2020 2020  leError,.       
+00019120: 2020 2020 2046 696c 654e 6f74 466f 756e       FileNotFoun
+00019130: 6445 7272 6f72 2c0a 2020 2020 2020 2020  dError,.        
+00019140: 2020 2020 5479 7065 4572 726f 722c 0a20      TypeError,. 
+00019150: 2020 2020 2020 2029 2061 7320 653a 0a20         ) as e:. 
+00019160: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00019170: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019180: 2020 225c 6e4e 6f6e 5374 6561 6479 5374    "\nNonSteadySt
+00019190: 6174 6544 6574 6563 746f 7220 6272 6963  ateDetector bric
+000191a0: 6b3a 2045 7272 6f72 2077 6974 6820 6669  k: Error with fi
+000191b0: 6c65 2074 6f20 656e 6861 6e63 652c 2022  le to enhance, "
+000191c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000191d0: 2022 6475 7269 6e67 2074 6865 2072 756e   "during the run
+000191e0: 3a20 222c 0a20 2020 2020 2020 2020 2020  : ",.           
+000191f0: 2020 2020 2065 2c0a 2020 2020 2020 2020       e,.        
+00019200: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00019210: 2020 696e 5f6e 6969 203d 204e 6f6e 650a    in_nii = None.
+00019220: 0a20 2020 2020 2020 2069 6620 696e 5f6e  .        if in_n
+00019230: 6969 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ii is not None:.
+00019240: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
+00019250: 616c 5f73 6967 6e61 6c20 3d20 280a 2020  al_signal = (.  
+00019260: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00019270: 5f6e 6969 2e64 6174 616f 626a 5b3a 2c20  _nii.dataobj[:, 
+00019280: 3a2c 203a 2c20 3a35 305d 0a20 2020 2020  :, :, :50].     
+00019290: 2020 2020 2020 2020 2020 202e 6d65 616e             .mean
+000192a0: 2861 7869 733d 3029 0a20 2020 2020 2020  (axis=0).       
+000192b0: 2020 2020 2020 2020 202e 6d65 616e 2861           .mean(a
+000192c0: 7869 733d 3029 0a20 2020 2020 2020 2020  xis=0).         
+000192d0: 2020 2020 2020 202e 6d65 616e 2861 7869         .mean(axi
+000192e0: 733d 3029 0a20 2020 2020 2020 2020 2020  s=0).           
+000192f0: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+00019300: 2e6e 5f76 6f6c 756d 6573 5f74 6f5f 6469  .n_volumes_to_di
+00019310: 7363 6172 6420 3d20 6973 5f6f 7574 6c69  scard = is_outli
+00019320: 6572 2867 6c6f 6261 6c5f 7369 676e 616c  er(global_signal
+00019330: 290a 0a0a 636c 6173 7320 5265 7361 6d70  )...class Resamp
+00019340: 6c65 3128 5072 6f63 6573 734d 4941 293a  le1(ProcessMIA):
+00019350: 0a20 2020 2022 2222 0a20 2020 202a 5265  .    """.    *Re
+00019360: 7361 6d70 6c65 7320 616e 2069 6d61 6765  samples an image
+00019370: 2074 6f20 7468 6520 7265 736f 6c75 7469   to the resoluti
+00019380: 6f6e 206f 6620 6120 7265 6665 7265 6e63  on of a referenc
+00019390: 6520 696d 6167 652a 0a0a 2020 2020 2d20  e image*..    - 
+000193a0: 5573 6573 206e 696c 6561 726e 2e69 6d61  Uses nilearn.ima
+000193b0: 6765 2e72 6573 616d 706c 655f 746f 5f69  ge.resample_to_i
+000193c0: 6d67 2829 2e0a 0a20 2020 2050 6c65 6173  mg()...    Pleas
+000193d0: 652c 2073 6565 2074 6865 2063 6f6d 706c  e, see the compl
+000193e0: 6574 6520 646f 6375 6d65 6e74 6174 696f  ete documentatio
+000193f0: 6e20 666f 7220 7468 650a 2020 2020 6052  n for the.    `R
+00019400: 6573 616d 706c 6531 2062 7269 636b 2069  esample1 brick i
+00019410: 6e20 7468 6520 6d69 615f 7072 6f63 6573  n the mia_proces
+00019420: 7365 7320 7765 6273 6974 650a 2020 2020  ses website.    
+00019430: 3c68 7474 7073 3a2f 2f70 6f70 756c 7365  <https://populse
+00019440: 2e67 6974 6875 622e 696f 2f6d 6961 5f70  .github.io/mia_p
+00019450: 726f 6365 7373 6573 2f68 746d 6c2f 646f  rocesses/html/do
+00019460: 6375 6d65 6e74 6174 696f 6e2f 6272 6963  cumentation/bric
+00019470: 6b73 2f70 7265 7072 6f63 6573 732f 6f74  ks/preprocess/ot
+00019480: 6865 722f 5265 7361 6d70 6c65 312e 6874  her/Resample1.ht
+00019490: 6d6c 3e60 5f0a 0a20 2020 2022 2222 0a0a  ml>`_..    """..
+000194a0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000194b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000194c0: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
+000194d0: 7468 6520 6174 7472 6962 7574 6573 2069  the attributes i
+000194e0: 6e69 7469 616c 6973 6174 696f 6e20 2f20  nitialisation / 
+000194f0: 696e 7374 616e 7469 6174 696f 6e2e 0a0a  instantiation...
+00019500: 2020 2020 2020 2020 5468 6520 696e 7075          The inpu
+00019510: 7420 616e 6420 6f75 7470 7574 2070 6c75  t and output plu
+00019520: 6773 2061 7265 2064 6566 696e 6564 2068  gs are defined h
+00019530: 6572 652e 2054 6865 2073 7065 6369 616c  ere. The special
+00019540: 0a20 2020 2020 2020 2027 7365 6c66 2e72  .        'self.r
+00019550: 6571 7569 7265 6d65 6e74 2720 6174 7472  equirement' attr
+00019560: 6962 7574 6520 286f 7074 696f 6e61 6c29  ibute (optional)
+00019570: 2069 7320 7573 6564 2074 6f20 6465 6669   is used to defi
+00019580: 6e65 2074 6865 0a20 2020 2020 2020 2074  ne the.        t
+00019590: 6869 7264 2d70 6172 7479 2070 726f 6475  hird-party produ
+000195a0: 6374 7320 6e65 6365 7373 6172 7920 666f  cts necessary fo
+000195b0: 7220 7468 6520 7275 6e6e 696e 6720 6f66  r the running of
+000195c0: 2074 6865 2062 7269 636b 2e0a 2020 2020   the brick..    
+000195d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000195e0: 2320 496e 6974 6961 6c69 7361 7469 6f6e  # Initialisation
+000195f0: 206f 6620 7468 6520 6f62 6a65 6374 7320   of the objects 
+00019600: 6e65 6564 6564 2066 6f72 2074 6865 206c  needed for the l
+00019610: 6175 6e63 6820 6f66 2074 6865 2062 7269  aunch of the bri
+00019620: 636b 0a20 2020 2020 2020 2073 7570 6572  ck.        super
+00019630: 2852 6573 616d 706c 6531 2c20 7365 6c66  (Resample1, self
+00019640: 292e 5f5f 696e 6974 5f5f 2829 0a0a 2020  ).__init__()..  
+00019650: 2020 2020 2020 2320 5468 6972 6420 7061        # Third pa
+00019660: 7274 7920 736f 6674 7761 7265 7320 7265  rty softwares re
+00019670: 7175 6972 6564 2066 6f72 2074 6865 2065  quired for the e
+00019680: 7865 6375 7469 6f6e 206f 6620 7468 6520  xecution of the 
+00019690: 6272 6963 6b0a 2020 2020 2020 2020 7365  brick.        se
+000196a0: 6c66 2e72 6571 7569 7265 6d65 6e74 203d  lf.requirement =
+000196b0: 205b 5d0a 0a20 2020 2020 2020 2023 2049   []..        # I
+000196c0: 6e70 7574 7320 6465 7363 7269 7074 696f  nputs descriptio
+000196d0: 6e0a 2020 2020 2020 2020 6669 6c65 735f  n.        files_
+000196e0: 746f 5f72 6573 616d 706c 655f 6465 7363  to_resample_desc
+000196f0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00019700: 2022 5468 6520 3344 2069 6d61 6765 7320   "The 3D images 
+00019710: 7468 6174 2077 696c 6c20 6265 2072 6573  that will be res
+00019720: 616d 706c 6564 2028 6120 220a 2020 2020  ampled (a ".    
+00019730: 2020 2020 2020 2020 226c 6973 7420 6f66          "list of
+00019740: 2070 6174 686c 696b 6520 6f62 6a65 6374   pathlike object
+00019750: 206f 7220 7374 7269 6e67 2022 0a20 2020   or string ".   
+00019760: 2020 2020 2020 2020 2022 7265 7072 6573           "repres
+00019770: 656e 7469 6e67 2061 2066 696c 6520 6f72  enting a file or
+00019780: 2061 206c 6973 7420 6f66 2069 7465 6d73   a list of items
+00019790: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+000197a0: 7768 6963 6820 6172 6520 6120 7061 7468  which are a path
+000197b0: 6c69 6b65 206f 626a 6563 7420 6f72 2073  like object or s
+000197c0: 7472 696e 6720 220a 2020 2020 2020 2020  tring ".        
+000197d0: 2020 2020 2272 6570 7265 7365 6e74 696e      "representin
+000197e0: 6720 6120 6669 6c65 2c20 7661 6c69 6420  g a file, valid 
+000197f0: 6578 7465 6e73 696f 6e73 3a20 220a 2020  extensions: ".  
+00019800: 2020 2020 2020 2020 2020 225b 2e69 6d67            "[.img
+00019810: 2c20 2e6e 6969 2c20 2e68 6472 5d29 2e22  , .nii, .hdr])."
+00019820: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00019830: 2020 2072 6566 6572 656e 6365 5f69 6d61     reference_ima
+00019840: 6765 5f64 6573 6320 3d20 280a 2020 2020  ge_desc = (.    
+00019850: 2020 2020 2020 2020 2241 2033 4420 6f72          "A 3D or
+00019860: 2034 4420 696d 6167 6520 7573 6564 2061   4D image used a
+00019870: 7320 7265 6665 7265 6e63 6520 746f 2022  s reference to "
+00019880: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
+00019890: 7361 6d70 6c65 2074 6865 2066 696c 6573  sample the files
+000198a0: 5f74 6f5f 7265 7361 6d70 6c65 2069 6d61  _to_resample ima
+000198b0: 6765 7320 2861 2022 0a20 2020 2020 2020  ges (a ".       
+000198c0: 2020 2020 2022 7061 7468 6c69 6b65 206f       "pathlike o
+000198d0: 626a 6563 7420 6f72 2073 7472 696e 6720  bject or string 
+000198e0: 7265 7072 6573 656e 7469 6e67 2061 2066  representing a f
+000198f0: 696c 6520 220a 2020 2020 2020 2020 2020  ile ".          
+00019900: 2020 2277 6974 6820 6578 7465 6e73 696f    "with extensio
+00019910: 6e20 696e 205b 2e69 6d67 2c20 2e6e 6969  n in [.img, .nii
+00019920: 2c20 2e68 6472 5d29 2e22 0a20 2020 2020  , .hdr]).".     
+00019930: 2020 2029 0a20 2020 2020 2020 2069 6e74     ).        int
+00019940: 6572 705f 6465 7363 203d 2028 0a20 2020  erp_desc = (.   
+00019950: 2020 2020 2020 2020 2022 5468 6520 7265           "The re
+00019960: 7361 6d70 6c65 206d 6574 686f 6420 2861  sample method (a
+00019970: 2073 7472 696e 6720 696e 220a 2020 2020   string in".    
+00019980: 2020 2020 2020 2020 225b e280 9863 6f6e          "[...con
+00019990: 7469 6e75 6f75 73e2 8099 2c20 e280 986c  tinuous..., ...l
+000199a0: 696e 6561 72e2 8099 2c20 e280 986e 6561  inear..., ...nea
+000199b0: 7265 7374 e280 995d 292e 220a 2020 2020  rest...]).".    
+000199c0: 2020 2020 290a 2020 2020 2020 2020 7072      ).        pr
+000199d0: 6566 6978 5f64 6573 6320 3d20 2254 6865  efix_desc = "The
+000199e0: 2070 7265 6669 7820 666f 7220 7468 6520   prefix for the 
+000199f0: 6f75 745f 6669 6c65 7320 696d 6167 6520  out_files image 
+00019a00: 2861 2073 7472 696e 6729 2e22 0a20 2020  (a string).".   
+00019a10: 2020 2020 2073 7566 6669 785f 746f 5f64       suffix_to_d
+00019a20: 656c 6574 655f 6465 7363 203d 2028 0a20  elete_desc = (. 
+00019a30: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
+00019a40: 7375 6666 6978 2074 6f20 6465 6c65 7465  suffix to delete
+00019a50: 2066 726f 6d20 7468 6520 220a 2020 2020   from the ".    
+00019a60: 2020 2020 2020 2020 2266 696c 6573 5f74          "files_t
+00019a70: 6f5f 7265 7361 6d70 6c65 2c20 7768 656e  o_resample, when
+00019a80: 2063 7265 6174 696e 6720 7468 6520 220a   creating the ".
+00019a90: 2020 2020 2020 2020 2020 2020 226f 7574              "out
+00019aa0: 5f66 696c 6573 2028 6120 7374 7269 6e67  _files (a string
+00019ab0: 292e 220a 2020 2020 2020 2020 290a 2020  ).".        ).  
+00019ac0: 2020 2020 2020 7375 6666 6978 5f64 6573        suffix_des
+00019ad0: 6320 3d20 2254 6865 2073 7566 6669 7820  c = "The suffix 
+00019ae0: 666f 7220 7468 6520 6f75 745f 6669 6c65  for the out_file
+00019af0: 7320 696d 6167 6520 2861 2073 7472 696e  s image (a strin
+00019b00: 6729 2e22 0a0a 2020 2020 2020 2020 2320  g)."..        # 
+00019b10: 4f75 7470 7574 7320 6465 7363 7269 7074  Outputs descript
+00019b20: 696f 6e0a 2020 2020 2020 2020 6f75 745f  ion.        out_
+00019b30: 6669 6c65 735f 6465 7363 203d 2028 0a20  files_desc = (. 
+00019b40: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
+00019b50: 7265 7375 6c74 696e 6720 696d 6167 6573  resulting images
+00019b60: 2061 6674 6572 2072 6573 616d 706c 696e   after resamplin
+00019b70: 6720 2861 2070 6174 686c 696b 6520 220a  g (a pathlike ".
+00019b80: 2020 2020 2020 2020 2020 2020 226f 626a              "obj
+00019b90: 6563 7420 6f72 2073 7472 696e 6720 7265  ect or string re
+00019ba0: 7072 6573 656e 7469 6e67 2061 2066 696c  presenting a fil
+00019bb0: 652c 206f 7220 6120 6c69 7374 206f 6620  e, or a list of 
+00019bc0: 220a 2020 2020 2020 2020 2020 2020 2270  ".            "p
+00019bd0: 6174 686c 696b 6520 6f62 6a65 6374 7320  athlike objects 
+00019be0: 6f72 2073 7472 696e 6773 2072 6570 7265  or strings repre
+00019bf0: 7365 6e74 696e 6720 6120 6669 6c65 292e  senting a file).
+00019c00: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+00019c10: 2020 2020 2023 2049 6e70 7574 7320 7472       # Inputs tr
+00019c20: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
+00019c30: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
+00019c40: 2020 2020 2020 2020 2022 6669 6c65 735f           "files_
+00019c50: 746f 5f72 6573 616d 706c 6522 2c0a 2020  to_resample",.  
+00019c60: 2020 2020 2020 2020 2020 496e 7075 744d            InputM
+00019c70: 756c 7469 5061 7468 280a 2020 2020 2020  ultiPath(.      
+00019c80: 2020 2020 2020 2020 2020 496d 6167 6546            ImageF
+00019c90: 696c 6553 504d 2829 2c20 6f75 7470 7574  ileSPM(), output
+00019ca0: 3d46 616c 7365 2c20 6465 7363 3d66 696c  =False, desc=fil
+00019cb0: 6573 5f74 6f5f 7265 7361 6d70 6c65 5f64  es_to_resample_d
+00019cc0: 6573 630a 2020 2020 2020 2020 2020 2020  esc.            
+00019cd0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00019ce0: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00019cf0: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+00019d00: 2020 2272 6566 6572 656e 6365 5f69 6d61    "reference_ima
+00019d10: 6765 222c 0a20 2020 2020 2020 2020 2020  ge",.           
+00019d20: 2049 6d61 6765 4669 6c65 5350 4d28 6f75   ImageFileSPM(ou
+00019d30: 7470 7574 3d46 616c 7365 2c20 6465 7363  tput=False, desc
+00019d40: 3d72 6566 6572 656e 6365 5f69 6d61 6765  =reference_image
+00019d50: 5f64 6573 6329 2c0a 2020 2020 2020 2020  _desc),.        
+00019d60: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00019d70: 6164 645f 7472 6169 7428 0a20 2020 2020  add_trait(.     
+00019d80: 2020 2020 2020 2022 696e 7465 7270 222c         "interp",
+00019d90: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00019da0: 6974 732e 456e 756d 280a 2020 2020 2020  its.Enum(.      
+00019db0: 2020 2020 2020 2020 2020 226c 696e 6561            "linea
+00019dc0: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
+00019dd0: 2020 2020 2263 6f6e 7469 6e75 6f75 7322      "continuous"
+00019de0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019df0: 2020 226e 6561 7265 7374 222c 0a20 2020    "nearest",.   
+00019e00: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00019e10: 7075 743d 4661 6c73 652c 0a20 2020 2020  put=False,.     
+00019e20: 2020 2020 2020 2020 2020 206f 7074 696f             optio
+00019e30: 6e61 6c3d 5472 7565 2c0a 2020 2020 2020  nal=True,.      
+00019e40: 2020 2020 2020 2020 2020 6465 7363 3d69            desc=i
+00019e50: 6e74 6572 705f 6465 7363 2c0a 2020 2020  nterp_desc,.    
+00019e60: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00019e70: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+00019e80: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
+00019e90: 2020 2020 2020 2020 2020 2270 7265 6669            "prefi
+00019ea0: 7822 2c0a 2020 2020 2020 2020 2020 2020  x",.            
+00019eb0: 7472 6169 7473 2e53 7472 696e 6728 2220  traits.String(" 
+00019ec0: 222c 206f 7574 7075 743d 4661 6c73 652c  ", output=False,
+00019ed0: 206f 7074 696f 6e61 6c3d 5472 7565 2c20   optional=True, 
+00019ee0: 6465 7363 3d70 7265 6669 785f 6465 7363  desc=prefix_desc
+00019ef0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00019f00: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00019f10: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+00019f20: 2020 2273 7566 6669 785f 746f 5f64 656c    "suffix_to_del
+00019f30: 6574 6522 2c0a 2020 2020 2020 2020 2020  ete",.          
+00019f40: 2020 7472 6169 7473 2e53 7472 696e 6728    traits.String(
+00019f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019f60: 2022 5f30 3032 222c 206f 7574 7075 743d   "_002", output=
+00019f70: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+00019f80: 5472 7565 2c20 6465 7363 3d73 7566 6669  True, desc=suffi
+00019f90: 785f 746f 5f64 656c 6574 655f 6465 7363  x_to_delete_desc
+00019fa0: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00019fb0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00019fc0: 2020 2073 656c 662e 6164 645f 7472 6169     self.add_trai
+00019fd0: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
+00019fe0: 7375 6666 6978 222c 0a20 2020 2020 2020  suffix",.       
+00019ff0: 2020 2020 2074 7261 6974 732e 5374 7269       traits.Stri
+0001a000: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+0001a010: 2020 2020 225f 3030 3322 2c20 6f75 7470      "_003", outp
+0001a020: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
+0001a030: 616c 3d54 7275 652c 2064 6573 633d 7375  al=True, desc=su
+0001a040: 6666 6978 5f64 6573 630a 2020 2020 2020  ffix_desc.      
+0001a050: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+0001a060: 2029 0a0a 2020 2020 2020 2020 2320 4f75   )..        # Ou
+0001a070: 7470 7574 7320 7472 6169 7473 0a20 2020  tputs traits.   
+0001a080: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+0001a090: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+0001a0a0: 2022 6f75 745f 6669 6c65 7322 2c0a 2020   "out_files",.  
+0001a0b0: 2020 2020 2020 2020 2020 4f75 7470 7574            Output
+0001a0c0: 4d75 6c74 6950 6174 6828 4669 6c65 2829  MultiPath(File()
+0001a0d0: 2c20 6f75 7470 7574 3d54 7275 652c 2064  , output=True, d
+0001a0e0: 6573 633d 6f75 745f 6669 6c65 735f 6465  esc=out_files_de
+0001a0f0: 7363 292c 0a20 2020 2020 2020 2029 0a0a  sc),.        )..
+0001a100: 2020 2020 2020 2020 7365 6c66 2e69 6e69          self.ini
+0001a110: 745f 6465 6661 756c 745f 7472 6169 7473  t_default_traits
+0001a120: 2829 0a0a 2020 2020 6465 6620 6c69 7374  ()..    def list
+0001a130: 5f6f 7574 7075 7473 2873 656c 662c 2069  _outputs(self, i
+0001a140: 735f 706c 7567 6765 643d 4e6f 6e65 293a  s_plugged=None):
+0001a150: 0a20 2020 2020 2020 2022 2222 4465 6469  .        """Dedi
+0001a160: 6361 7465 6420 746f 2074 6865 2069 6e69  cated to the ini
+0001a170: 7469 616c 6973 6174 696f 6e20 7374 6570  tialisation step
+0001a180: 206f 6620 7468 6520 6272 6963 6b2e 0a0a   of the brick...
+0001a190: 2020 2020 2020 2020 5468 6520 6d61 696e          The main
+0001a1a0: 206f 626a 6563 7469 7665 206f 6620 7468   objective of th
+0001a1b0: 6973 206d 6574 686f 6420 6973 2074 6f20  is method is to 
+0001a1c0: 7072 6f64 7563 6520 7468 6520 6f75 7470  produce the outp
+0001a1d0: 7574 7320 6f66 2074 6865 0a20 2020 2020  uts of the.     
+0001a1e0: 2020 2062 7269 636b 7320 2873 656c 662e     bricks (self.
+0001a1f0: 6f75 7470 7574 7329 2061 6e64 2074 6865  outputs) and the
+0001a200: 2061 7373 6f63 6961 7465 6420 7461 6773   associated tags
+0001a210: 2028 7365 6c66 2e69 6e68 6572 6974 616e   (self.inheritan
+0001a220: 6365 5f64 6963 292c 0a20 2020 2020 2020  ce_dic),.       
+0001a230: 2069 6620 6465 6669 6e65 6420 6865 7265   if defined here
+0001a240: 2e20 546f 2077 6f72 6b20 7072 6f70 6572  . To work proper
+0001a250: 6c79 2074 6869 7320 6d65 7468 6f64 206d  ly this method m
+0001a260: 7573 7420 7265 7475 726e 0a20 2020 2020  ust return.     
+0001a270: 2020 2073 656c 662e 6d61 6b65 5f69 6e69     self.make_ini
+0001a280: 7452 6573 756c 7428 2920 6f62 6a65 6374  tResult() object
+0001a290: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0001a2a0: 6d20 6973 5f70 6c75 6767 6564 3a20 7468  m is_plugged: th
+0001a2b0: 6520 7374 6174 652c 206c 696e 6b65 6420  e state, linked 
+0001a2c0: 6f72 206e 6f74 2c20 6f66 2074 6865 2070  or not, of the p
+0001a2d0: 6c75 6773 2e0a 2020 2020 2020 2020 3a72  lugs..        :r
+0001a2e0: 6574 7572 6e73 3a20 6120 6469 6374 696f  eturns: a dictio
+0001a2f0: 6e61 7279 2077 6974 6820 7265 7175 6972  nary with requir
+0001a300: 656d 656e 742c 206f 7574 7075 7473 2061  ement, outputs a
+0001a310: 6e64 2069 6e68 6572 6974 616e 6365 5f64  nd inheritance_d
+0001a320: 6963 742e 0a20 2020 2020 2020 2022 2222  ict..        """
+0001a330: 0a20 2020 2020 2020 2023 2055 7369 6e67  .        # Using
+0001a340: 2074 6865 2069 6e68 6572 6974 616e 6365   the inheritance
+0001a350: 2074 6f20 5072 6f63 6573 734d 4941 2063   to ProcessMIA c
+0001a360: 6c61 7373 2c20 6c69 7374 5f6f 7574 7075  lass, list_outpu
+0001a370: 7473 206d 6574 686f 640a 2020 2020 2020  ts method.      
+0001a380: 2020 7375 7065 7228 5265 7361 6d70 6c65    super(Resample
+0001a390: 312c 2073 656c 6629 2e6c 6973 745f 6f75  1, self).list_ou
+0001a3a0: 7470 7574 7328 290a 0a20 2020 2020 2020  tputs()..       
+0001a3b0: 2023 204f 7574 7075 7473 2064 6566 696e   # Outputs defin
+0001a3c0: 6974 696f 6e0a 2020 2020 2020 2020 6966  ition.        if
+0001a3d0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
+0001a3e0: 656c 662e 7265 6665 7265 6e63 655f 696d  elf.reference_im
+0001a3f0: 6167 6520 213d 2055 6e64 6566 696e 6564  age != Undefined
+0001a400: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+0001a410: 2073 656c 662e 6669 6c65 735f 746f 5f72   self.files_to_r
+0001a420: 6573 616d 706c 6520 213d 2055 6e64 6566  esample != Undef
+0001a430: 696e 6564 0a20 2020 2020 2020 2020 2020  ined.           
+0001a440: 2061 6e64 2073 656c 662e 696e 7465 7270   and self.interp
+0001a450: 2021 3d20 556e 6465 6669 6e65 640a 2020   != Undefined.  
+0001a460: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0001a470: 2020 2020 2066 696c 6573 203d 205b 5d0a       files = [].
+0001a480: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0001a490: 735f 6e61 6d65 203d 2073 656c 662e 6669  s_name = self.fi
+0001a4a0: 6c65 735f 746f 5f72 6573 616d 706c 650a  les_to_resample.
+0001a4b0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0001a4c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a4d0: 2020 7265 664e 616d 6520 3d20 6e69 622e    refName = nib.
+0001a4e0: 6c6f 6164 2873 656c 662e 7265 6665 7265  load(self.refere
+0001a4f0: 6e63 655f 696d 6167 6529 0a0a 2020 2020  nce_image)..    
+0001a500: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+0001a510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a520: 206e 6962 2e66 696c 6562 6173 6564 696d   nib.filebasedim
+0001a530: 6167 6573 2e49 6d61 6765 4669 6c65 4572  ages.ImageFileEr
+0001a540: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
+0001a550: 2020 2020 2046 696c 654e 6f74 466f 756e       FileNotFoun
+0001a560: 6445 7272 6f72 2c0a 2020 2020 2020 2020  dError,.        
+0001a570: 2020 2020 2020 2020 5479 7065 4572 726f          TypeErro
+0001a580: 722c 0a20 2020 2020 2020 2020 2020 2029  r,.            )
+0001a590: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0001a5a0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5c0: 2020 225c 6e52 6573 616d 706c 6531 2062    "\nResample1 b
+0001a5d0: 7269 636b 3a20 4572 726f 7220 7769 7468  rick: Error with
+0001a5e0: 2072 6566 6572 656e 6365 5f69 6d61 6765   reference_image
+0001a5f0: 2c20 6475 7269 6e67 2022 0a20 2020 2020  , during ".     
+0001a600: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001a610: 696e 6974 6961 6c69 7361 7469 6f6e 3a20  initialisation: 
+0001a620: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0001a630: 2020 2020 2020 2065 2c0a 2020 2020 2020         e,.      
+0001a640: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001a650: 2020 2020 2020 2020 2020 2020 7265 664e              refN
+0001a660: 616d 6520 3d20 4e6f 6e65 0a0a 2020 2020  ame = None..    
+0001a670: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+0001a680: 2020 2020 2020 2020 2020 2020 2028 6e6f               (no
+0001a690: 7420 7365 6c66 2e73 7566 6669 785f 746f  t self.suffix_to
+0001a6a0: 5f64 656c 6574 6529 0a20 2020 2020 2020  _delete).       
+0001a6b0: 2020 2020 2020 2020 206f 7220 2873 656c           or (sel
+0001a6c0: 662e 7375 6666 6978 5f74 6f5f 6465 6c65  f.suffix_to_dele
+0001a6d0: 7465 2e69 7373 7061 6365 2829 290a 2020  te.isspace()).  
+0001a6e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0001a6f0: 2028 7365 6c66 2e73 7566 6669 785f 746f   (self.suffix_to
+0001a700: 5f64 656c 6574 6520 696e 205b 556e 6465  _delete in [Unde
+0001a710: 6669 6e65 642c 2022 3c75 6e64 6566 696e  fined, "<undefin
+0001a720: 6564 3e22 5d29 0a20 2020 2020 2020 2020  ed>"]).         
+0001a730: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0001a740: 2020 2020 2020 7365 6c66 2e73 7566 6669        self.suffi
+0001a750: 785f 746f 5f64 656c 6574 6520 3d20 2220  x_to_delete = " 
+0001a760: 220a 0a20 2020 2020 2020 2020 2020 2069  "..            i
+0001a770: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0001a780: 2020 2020 286e 6f74 2073 656c 662e 7375      (not self.su
+0001a790: 6666 6978 290a 2020 2020 2020 2020 2020  ffix).          
+0001a7a0: 2020 2020 2020 6f72 2028 7365 6c66 2e73        or (self.s
+0001a7b0: 7566 6669 782e 6973 7370 6163 6528 2929  uffix.isspace())
+0001a7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a7d0: 206f 7220 2873 656c 662e 7375 6666 6978   or (self.suffix
+0001a7e0: 2069 6e20 5b55 6e64 6566 696e 6564 2c20   in [Undefined, 
+0001a7f0: 223c 756e 6465 6669 6e65 643e 225d 290a  "<undefined>"]).
+0001a800: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+0001a810: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a820: 656c 662e 7375 6666 6978 203d 2022 2022  elf.suffix = " "
+0001a830: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001a840: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001a850: 2020 2028 6e6f 7420 7365 6c66 2e70 7265     (not self.pre
+0001a860: 6669 7829 0a20 2020 2020 2020 2020 2020  fix).           
+0001a870: 2020 2020 206f 7220 2873 656c 662e 7072       or (self.pr
+0001a880: 6566 6978 2e69 7373 7061 6365 2829 290a  efix.isspace()).
+0001a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8a0: 6f72 2028 7365 6c66 2e70 7265 6669 7820  or (self.prefix 
+0001a8b0: 696e 205b 556e 6465 6669 6e65 642c 2022  in [Undefined, "
+0001a8c0: 3c75 6e64 6566 696e 6564 3e22 5d29 0a20  <undefined>"]). 
+0001a8d0: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+0001a8e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001a8f0: 6c66 2e70 7265 6669 7820 3d20 2220 220a  lf.prefix = " ".
+0001a900: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001a910: 2066 696c 655f 6e61 6d65 2069 6e20 6669   file_name in fi
+0001a920: 6c65 735f 6e61 6d65 3a0a 2020 2020 2020  les_name:.      
+0001a930: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0001a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a950: 2020 2066 696c 654e 616d 6520 3d20 6e69     fileName = ni
+0001a960: 622e 6c6f 6164 2866 696c 655f 6e61 6d65  b.load(file_name
+0001a970: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001a980: 2020 2065 7863 6570 7420 280a 2020 2020     except (.    
+0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9a0: 6e69 622e 6669 6c65 6261 7365 6469 6d61  nib.filebasedima
+0001a9b0: 6765 732e 496d 6167 6546 696c 6545 7272  ges.ImageFileErr
+0001a9c0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0001a9d0: 2020 2020 2020 2020 4669 6c65 4e6f 7446          FileNotF
+0001a9e0: 6f75 6e64 4572 726f 722c 0a20 2020 2020  oundError,.     
+0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+0001aa00: 7970 6545 7272 6f72 2c0a 2020 2020 2020  ypeError,.      
+0001aa10: 2020 2020 2020 2020 2020 2920 6173 2065            ) as e
+0001aa20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001aa30: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
+0001aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa50: 2020 2020 2022 5c6e 5265 7361 6d70 6c65       "\nResample
+0001aa60: 3120 6272 6963 6b3a 2045 7272 6f72 2077  1 brick: Error w
+0001aa70: 6974 6820 6669 6c65 735f 746f 5f72 6573  ith files_to_res
+0001aa80: 616d 706c 652c 2022 0a20 2020 2020 2020  ample, ".       
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaa0: 2022 6475 7269 6e67 2069 6e69 7469 616c   "during initial
+0001aab0: 6973 6174 696f 6e3a 2022 2c0a 2020 2020  isation: ",.    
+0001aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aad0: 2020 2020 652c 0a20 2020 2020 2020 2020      e,.         
+0001aae0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab00: 2066 696c 654e 616d 6520 3d20 4e6f 6e65   fileName = None
+0001ab10: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ab20: 2020 6966 2028 7265 664e 616d 6529 2061    if (refName) a
+0001ab30: 6e64 2028 6669 6c65 4e61 6d65 293a 0a20  nd (fileName):. 
+0001ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab50: 2020 2069 6620 286c 656e 2866 696c 654e     if (len(fileN
+0001ab60: 616d 652e 7368 6170 6529 2021 3d20 3329  ame.shape) != 3)
+0001ab70: 206f 7220 280a 2020 2020 2020 2020 2020   or (.          
+0001ab80: 2020 2020 2020 2020 2020 2020 2020 3320                3 
+0001ab90: 3e20 6c65 6e28 7265 664e 616d 652e 7368  > len(refName.sh
+0001aba0: 6170 6529 203e 2034 0a20 2020 2020 2020  ape) > 4.       
+0001abb0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+0001abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abd0: 2020 2020 2020 2020 6d73 6720 3d20 514d          msg = QM
+0001abe0: 6573 7361 6765 426f 7828 290a 2020 2020  essageBox().    
+0001abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac00: 2020 2020 6d73 672e 7365 7449 636f 6e28      msg.setIcon(
+0001ac10: 514d 6573 7361 6765 426f 782e 5761 726e  QMessageBox.Warn
+0001ac20: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
+0001ac30: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+0001ac40: 2e73 6574 5769 6e64 6f77 5469 746c 6528  .setWindowTitle(
+0001ac50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ac60: 2020 2020 2020 2020 2020 2020 2022 6d69               "mi
+0001ac70: 615f 7072 6f63 6573 7365 7320 2d20 5265  a_processes - Re
+0001ac80: 7361 6d70 6c65 3120 6272 6963 6b20 5761  sample1 brick Wa
+0001ac90: 726e 696e 6721 220a 2020 2020 2020 2020  rning!".        
+0001aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001acc0: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
+0001acd0: 7454 6578 7428 0a20 2020 2020 2020 2020  tText(.         
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acf0: 2020 2022 4375 7272 656e 746c 792c 2074     "Currently, t
+0001ad00: 6865 2052 6573 616d 706c 6531 2062 7269  he Resample1 bri
+0001ad10: 636b 206f 6e6c 7920 220a 2020 2020 2020  ck only ".      
+0001ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad30: 2020 2020 2020 2261 6c6c 6f77 7320 746f        "allows to
+0001ad40: 2072 6573 616d 706c 6520 3344 2069 6d61   resample 3D ima
+0001ad50: 6765 7320 6672 6f6d 2033 4420 6f72 2022  ges from 3D or "
+0001ad60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ad70: 2020 2020 2020 2020 2020 2020 2022 3444               "4D
+0001ad80: 2072 6566 6572 656e 6365 2069 6d61 6765   reference image
+0001ad90: 732e 5c6e 5c6e 2048 6f77 6576 6572 2074  s.\n\n However t
+0001ada0: 6865 2022 0a20 2020 2020 2020 2020 2020  he ".           
+0001adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001adc0: 2022 277b 307d 2720 7265 6665 7265 6e63   "'{0}' referenc
+0001add0: 6520 696d 6167 6520 6973 2061 207b 317d  e image is a {1}
+0001ade0: 4420 616e 6420 7468 6520 220a 2020 2020  D and the ".    
+0001adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae00: 2020 2020 2020 2020 2227 7b32 7d27 2069          "'{2}' i
+0001ae10: 6d61 6765 2069 7320 6120 7b33 7d44 202e  mage is a {3}D .
+0001ae20: 2e2e 5c6e 5c6e 506c 6561 7365 2c20 220a  ..\n\nPlease, ".
+0001ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae40: 2020 2020 2020 2020 2020 2020 226d 6f64              "mod
+0001ae50: 6966 7920 796f 7572 2069 6e70 7574 2061  ify your input a
+0001ae60: 6e64 2069 6e69 7469 616c 6973 6520 6167  nd initialise ag
+0001ae70: 6169 6e20 220a 2020 2020 2020 2020 2020  ain ".          
+0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae90: 2020 2274 6869 7320 6272 6963 6b2e 222e    "this brick.".
+0001aea0: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
+0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aec0: 2020 2020 2020 2020 7365 6c66 2e72 6566          self.ref
+0001aed0: 6572 656e 6365 5f69 6d61 6765 2c0a 2020  erence_image,.  
+0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aef0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+0001af00: 6e28 7265 664e 616d 652e 7368 6170 6529  n(refName.shape)
+0001af10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af30: 2020 6669 6c65 5f6e 616d 652c 0a20 2020    file_name,.   
+0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af50: 2020 2020 2020 2020 2020 2020 206c 656e               len
+0001af60: 2866 696c 654e 616d 652e 7368 6170 6529  (fileName.shape)
+0001af70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001af80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afa0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afc0: 2020 6d73 672e 7365 7453 7461 6e64 6172    msg.setStandar
+0001afd0: 6442 7574 746f 6e73 2851 4d65 7373 6167  dButtons(QMessag
+0001afe0: 6542 6f78 2e43 6c6f 7365 290a 2020 2020  eBox.Close).    
+0001aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b000: 2020 2020 6d73 672e 6275 7474 6f6e 436c      msg.buttonCl
+0001b010: 6963 6b65 642e 636f 6e6e 6563 7428 6d73  icked.connect(ms
+0001b020: 672e 636c 6f73 6529 0a20 2020 2020 2020  g.close).       
+0001b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b040: 206d 7367 2e65 7865 6328 290a 2020 2020   msg.exec().    
+0001b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b060: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+0001b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b080: 2020 2020 2020 2022 5c6e 5265 7361 6d70         "\nResamp
+0001b090: 6c65 3120 6272 6963 6b3a 2049 6e69 7469  le1 brick: Initi
+0001b0a0: 616c 6973 6174 696f 6e20 6661 696c 6564  alisation failed
+0001b0b0: 202e 2e2e 2022 0a20 2020 2020 2020 2020   ... ".         
+0001b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0d0: 2020 2022 506c 6561 7365 2063 6865 636b     "Please check
+0001b0e0: 2074 6865 2069 6e70 7574 2070 6172 616d   the input param
+0001b0f0: 6574 6572 7321 220a 2020 2020 2020 2020  eters!".        
+0001b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b110: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001b120: 2020 2020 2020 2020 2020 6669 6c65 735f            files_
+0001b130: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
 0001b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b150: 2020 2066 696c 654e 616d 652c 2072 6566     fileName, ref
-0001b160: 4e61 6d65 2e73 6c69 6365 725b 3a2c 203a  Name.slicer[:, :
-0001b170: 2c20 3a2c 2030 5d2c 206f 7264 6572 3d73  , :, 0], order=s
-0001b180: 656c 662e 696e 7465 7270 0a20 2020 2020  elf.interp.     
-0001b190: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0001b1a0: 2020 2020 2020 2020 2020 2320 496d 6167            # Imag
-0001b1b0: 6520 7361 7665 0a20 2020 2020 2020 2020  e save.         
-0001b1c0: 2020 2070 6174 682c 2066 696c 655f 6e61     path, file_na
-0001b1d0: 6d65 203d 206f 732e 7061 7468 2e73 706c  me = os.path.spl
-0001b1e0: 6974 2866 696c 655f 6e61 6d65 290a 2020  it(file_name).  
-0001b1f0: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
-0001b200: 616d 655f 6e6f 5f65 7874 2c20 6669 6c65  ame_no_ext, file
-0001b210: 5f65 7874 656e 7369 6f6e 203d 206f 732e  _extension = os.
-0001b220: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
-0001b230: 6c65 5f6e 616d 6529 0a0a 2020 2020 2020  le_name)..      
-0001b240: 2020 2020 2020 2320 666d 743a 206f 6666        # fmt: off
-0001b250: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001b260: 2873 656c 662e 7375 6666 6978 5f74 6f5f  (self.suffix_to_
-0001b270: 6465 6c65 7465 2021 3d20 2220 2229 2061  delete != " ") a
-0001b280: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
-0001b290: 2020 2020 2066 696c 655f 6e61 6d65 5f6e       file_name_n
-0001b2a0: 6f5f 6578 745b 2d6c 656e 2873 656c 662e  o_ext[-len(self.
-0001b2b0: 7375 6666 6978 5f74 6f5f 6465 6c65 7465  suffix_to_delete
-0001b2c0: 293a 5d0a 2020 2020 2020 2020 2020 2020  ):].            
-0001b2d0: 2020 2020 3d3d 2073 656c 662e 7375 6666      == self.suff
-0001b2e0: 6978 5f74 6f5f 6465 6c65 7465 0a20 2020  ix_to_delete.   
-0001b2f0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-0001b300: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
-0001b310: 743a 206f 6e0a 2020 2020 2020 2020 2020  t: on.          
-0001b320: 2020 2020 2020 6669 6c65 5f6e 616d 655f        file_name_
-0001b330: 6e6f 5f65 7874 203d 2066 696c 655f 6e61  no_ext = file_na
-0001b340: 6d65 5f6e 6f5f 6578 745b 0a20 2020 2020  me_no_ext[.     
-0001b350: 2020 2020 2020 2020 2020 2020 2020 203a                 :
-0001b360: 202d 6c65 6e28 7365 6c66 2e73 7566 6669   -len(self.suffi
-0001b370: 785f 746f 5f64 656c 6574 6529 0a20 2020  x_to_delete).   
-0001b380: 2020 2020 2020 2020 2020 2020 205d 0a0a               ]..
-0001b390: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0001b3a0: 5f6f 7574 203d 206f 732e 7061 7468 2e6a  _out = os.path.j
-0001b3b0: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
-0001b3c0: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
-0001b3d0: 5f64 6972 6563 746f 7279 2c0a 2020 2020  _directory,.    
-0001b3e0: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b400: 2020 7365 6c66 2e70 7265 6669 782e 7374    self.prefix.st
-0001b410: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-0001b420: 2020 2020 2020 2020 2020 2b20 6669 6c65            + file
-0001b430: 5f6e 616d 655f 6e6f 5f65 7874 0a20 2020  _name_no_ext.   
-0001b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b450: 202b 2073 656c 662e 7375 6666 6978 2e73   + self.suffix.s
-0001b460: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-0001b470: 2020 2020 2020 2020 2020 202b 2066 696c             + fil
-0001b480: 655f 6578 7465 6e73 696f 6e0a 2020 2020  e_extension.    
-0001b490: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-0001b4a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001b4b0: 2020 2020 2020 2020 206e 6962 2e73 6176           nib.sav
-0001b4c0: 6528 6669 6c65 4669 6e61 6c2c 2066 696c  e(fileFinal, fil
-0001b4d0: 655f 6f75 7429 0a0a 0a63 6c61 7373 2052  e_out)...class R
-0001b4e0: 6573 616d 706c 6532 2850 726f 6365 7373  esample2(Process
-0001b4f0: 4d49 4129 3a0a 2020 2020 2222 220a 2020  MIA):.    """.  
-0001b500: 2020 2a52 6573 616d 706c 6573 2069 6d61    *Resamples ima
-0001b510: 6765 7320 746f 2074 6865 2072 6573 6f6c  ges to the resol
-0001b520: 7574 696f 6e20 6f66 2061 2072 6566 6572  ution of a refer
-0001b530: 656e 6365 2069 6d61 6765 2a0a 0a20 2020  ence image*..   
-0001b540: 202d 2055 7365 7320 736b 696d 6167 652e   - Uses skimage.
-0001b550: 7472 616e 7366 6f72 6d2e 7265 7369 7a65  transform.resize
-0001b560: 2829 0a20 2020 202d 2054 6865 206f 7574  ().    - The out
-0001b570: 7075 745f 6469 7265 6374 6f72 792f 5061  put_directory/Pa
-0001b580: 7469 656e 744e 616d 655f 6461 7461 2f52  tientName_data/R
-0001b590: 4f49 5f64 6174 612f 636f 6e76 524f 495f  OI_data/convROI_
-0001b5a0: 424f 4c44 3220 6469 7265 6374 6f72 7920  BOLD2 directory 
-0001b5b0: 6973 0a20 2020 2020 2063 7265 6174 6564  is.      created
-0001b5c0: 2074 6f20 7265 6365 6976 6520 7468 6520   to receive the 
-0001b5d0: 7265 7361 6d70 6c65 6420 696d 6167 6573  resampled images
-0001b5e0: 2e20 4966 2074 6869 7320 6469 7265 6374  . If this direct
-0001b5f0: 6f72 7920 6578 6973 7473 2061 740a 2020  ory exists at.  
-0001b600: 2020 2020 7275 6e74 696d 6520 6974 2069      runtime it i
-0001b610: 7320 6465 6c65 7465 642e 0a20 2020 202d  s deleted..    -
-0001b620: 2054 6f20 776f 726b 2063 6f72 7265 6374   To work correct
-0001b630: 6c79 2c20 7468 6520 6461 7461 6261 7365  ly, the database
-0001b640: 2065 6e74 7279 2066 6f72 2074 6865 2072   entry for the r
-0001b650: 6566 6572 656e 6365 5f69 6d61 6765 2070  eference_image p
-0001b660: 6172 616d 6574 6572 0a20 2020 2020 206d  arameter.      m
-0001b670: 7573 7420 6861 7665 2074 6865 2022 5061  ust have the "Pa
-0001b680: 7469 656e 744e 616d 6522 2074 6167 2066  tientName" tag f
-0001b690: 696c 6c65 6420 696e 2e0a 0a20 2020 2050  illed in...    P
-0001b6a0: 6c65 6173 652c 2073 6565 2074 6865 2063  lease, see the c
-0001b6b0: 6f6d 706c 6574 6520 646f 6375 6d65 6e74  omplete document
-0001b6c0: 6174 696f 6e20 666f 7220 7468 650a 2020  ation for the.  
-0001b6d0: 2020 6052 6573 616d 706c 6532 2062 7269    `Resample2 bri
-0001b6e0: 636b 2069 6e20 7468 6520 6d69 615f 7072  ck in the mia_pr
-0001b6f0: 6f63 6573 7365 7320 7765 6273 6974 650a  ocesses website.
-0001b700: 2020 2020 3c68 7474 7073 3a2f 2f70 6f70      <https://pop
-0001b710: 756c 7365 2e67 6974 6875 622e 696f 2f6d  ulse.github.io/m
-0001b720: 6961 5f70 726f 6365 7373 6573 2f68 746d  ia_processes/htm
-0001b730: 6c2f 646f 6375 6d65 6e74 6174 696f 6e2f  l/documentation/
-0001b740: 6272 6963 6b73 2f70 7265 7072 6f63 6573  bricks/preproces
-0001b750: 732f 6f74 6865 722f 5265 7361 6d70 6c65  s/other/Resample
-0001b760: 322e 6874 6d6c 3e60 5f0a 2020 2020 2222  2.html>`_.    ""
-0001b770: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-0001b780: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
-0001b790: 2020 2022 2222 4465 6469 6361 7465 6420     """Dedicated 
-0001b7a0: 746f 2074 6865 2061 7474 7269 6275 7465  to the attribute
-0001b7b0: 7320 696e 6974 6961 6c69 7361 7469 6f6e  s initialisation
-0001b7c0: 2f69 6e73 7461 6e74 6961 7469 6f6e 2e0a  /instantiation..
-0001b7d0: 0a20 2020 2020 2020 2054 6865 2069 6e70  .        The inp
-0001b7e0: 7574 2061 6e64 206f 7574 7075 7420 706c  ut and output pl
-0001b7f0: 7567 7320 6172 6520 6465 6669 6e65 6420  ugs are defined 
-0001b800: 6865 7265 2e20 5468 6520 7370 6563 6961  here. The specia
-0001b810: 6c0a 2020 2020 2020 2020 2773 656c 662e  l.        'self.
-0001b820: 7265 7175 6972 656d 656e 7427 2061 7474  requirement' att
-0001b830: 7269 6275 7465 2028 6f70 7469 6f6e 616c  ribute (optional
-0001b840: 2920 6973 2075 7365 6420 746f 2064 6566  ) is used to def
-0001b850: 696e 6520 7468 650a 2020 2020 2020 2020  ine the.        
-0001b860: 7468 6972 642d 7061 7274 7920 7072 6f64  third-party prod
-0001b870: 7563 7473 206e 6563 6573 7361 7279 2066  ucts necessary f
-0001b880: 6f72 2074 6865 2072 756e 6e69 6e67 206f  or the running o
-0001b890: 6620 7468 6520 6272 6963 6b2e 0a20 2020  f the brick..   
-0001b8a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001b8b0: 2073 7570 6572 2852 6573 616d 706c 6532   super(Resample2
-0001b8c0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-0001b8d0: 2829 0a0a 2020 2020 2020 2020 2320 496e  ()..        # In
-0001b8e0: 7075 7473 2064 6573 6372 6970 7469 6f6e  puts description
-0001b8f0: 0a20 2020 2020 2020 2066 696c 6573 5f74  .        files_t
-0001b900: 6f5f 7265 7361 6d70 6c65 5f64 6573 6320  o_resample_desc 
-0001b910: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0001b920: 2254 6865 2069 6d61 6765 7320 7468 6174  "The images that
-0001b930: 2077 696c 6c20 6265 2072 6573 616d 706c   will be resampl
-0001b940: 6564 2028 6120 220a 2020 2020 2020 2020  ed (a ".        
-0001b950: 2020 2020 226c 6973 7420 6f66 2070 6174      "list of pat
-0001b960: 686c 696b 6520 6f62 6a65 6374 206f 7220  hlike object or 
-0001b970: 7374 7269 6e67 2022 0a20 2020 2020 2020  string ".       
-0001b980: 2020 2020 2022 7265 7072 6573 656e 7469       "representi
-0001b990: 6e67 2061 2066 696c 6520 6f72 2061 206c  ng a file or a l
-0001b9a0: 6973 7420 6f66 2069 7465 6d73 2022 0a20  ist of items ". 
-0001b9b0: 2020 2020 2020 2020 2020 2022 7768 6963             "whic
-0001b9c0: 6820 6172 6520 6120 7061 7468 6c69 6b65  h are a pathlike
-0001b9d0: 206f 626a 6563 7420 6f72 2073 7472 696e   object or strin
-0001b9e0: 6720 220a 2020 2020 2020 2020 2020 2020  g ".            
-0001b9f0: 2272 6570 7265 7365 6e74 696e 6720 6120  "representing a 
-0001ba00: 6669 6c65 2c20 7661 6c69 6420 6578 7465  file, valid exte
-0001ba10: 6e73 696f 6e73 3a20 220a 2020 2020 2020  nsions: ".      
-0001ba20: 2020 2020 2020 225b 2e69 6d67 2c20 2e6e        "[.img, .n
-0001ba30: 6969 2c20 2e68 6472 5d29 2e22 0a20 2020  ii, .hdr]).".   
-0001ba40: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001ba50: 7265 6665 7265 6e63 655f 696d 6167 655f  reference_image_
-0001ba60: 6465 7363 203d 2028 0a20 2020 2020 2020  desc = (.       
-0001ba70: 2020 2020 2022 5468 6520 7265 6665 7265       "The refere
-0001ba80: 6e63 6520 696d 6167 6520 666f 7220 7265  nce image for re
-0001ba90: 7361 6d70 6c69 6e67 2028 616e 2022 0a20  sampling (an ". 
-0001baa0: 2020 2020 2020 2020 2020 2022 6578 6973             "exis
-0001bab0: 7469 6e67 2c20 756e 636f 6d70 7265 7373  ting, uncompress
-0001bac0: 6564 2066 696c 6529 220a 2020 2020 2020  ed file)".      
-0001bad0: 2020 290a 0a20 2020 2020 2020 2073 7566    )..        suf
-0001bae0: 6669 785f 6465 7363 203d 2022 5468 6520  fix_desc = "The 
-0001baf0: 7375 6666 6978 2066 6f72 2074 6865 206f  suffix for the o
-0001bb00: 7574 5f69 6d61 6765 7320 2861 2073 7472  ut_images (a str
-0001bb10: 696e 6729 220a 0a20 2020 2020 2020 2023  ing)"..        #
-0001bb20: 204f 7574 7075 7473 2064 6573 6372 6970   Outputs descrip
-0001bb30: 7469 6f6e 0a20 2020 2020 2020 206f 7574  tion.        out
-0001bb40: 5f69 6d61 6765 735f 6465 7363 203d 2022  _images_desc = "
-0001bb50: 5468 6520 7265 7361 6d70 6c65 6420 696d  The resampled im
-0001bb60: 6167 6573 220a 0a20 2020 2020 2020 2023  ages"..        #
-0001bb70: 2049 6e70 7574 7320 7472 6169 7473 0a20   Inputs traits. 
-0001bb80: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0001bb90: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-0001bba0: 2020 2022 6669 6c65 735f 746f 5f72 6573     "files_to_res
-0001bbb0: 616d 706c 6522 2c0a 2020 2020 2020 2020  ample",.        
-0001bbc0: 2020 2020 496e 7075 744d 756c 7469 5061      InputMultiPa
-0001bbd0: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
-0001bbe0: 2020 2020 496d 6167 6546 696c 6553 504d      ImageFileSPM
-0001bbf0: 2829 2c20 6f75 7470 7574 3d46 616c 7365  (), output=False
-0001bc00: 2c20 6465 7363 3d66 696c 6573 5f74 6f5f  , desc=files_to_
-0001bc10: 7265 7361 6d70 6c65 5f64 6573 630a 2020  resample_desc.  
-0001bc20: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-0001bc30: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001bc40: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
-0001bc50: 2020 2020 2020 2020 2020 2020 2272 6566              "ref
-0001bc60: 6572 656e 6365 5f69 6d61 6765 222c 0a20  erence_image",. 
-0001bc70: 2020 2020 2020 2020 2020 2049 6d61 6765             Image
-0001bc80: 4669 6c65 5350 4d28 6f75 7470 7574 3d46  FileSPM(output=F
-0001bc90: 616c 7365 2c20 6465 7363 3d72 6566 6572  alse, desc=refer
-0001bca0: 656e 6365 5f69 6d61 6765 5f64 6573 6329  ence_image_desc)
-0001bcb0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0001bcc0: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-0001bcd0: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-0001bce0: 2022 7375 6666 6978 222c 0a20 2020 2020   "suffix",.     
-0001bcf0: 2020 2020 2020 2074 7261 6974 732e 5374         traits.St
-0001bd00: 7269 6e67 2822 5f32 222c 206f 7574 7075  ring("_2", outpu
-0001bd10: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
-0001bd20: 6c3d 5472 7565 2c20 6465 7363 3d73 7566  l=True, desc=suf
-0001bd30: 6669 785f 6465 7363 292c 0a20 2020 2020  fix_desc),.     
-0001bd40: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-0001bd50: 4f75 7470 7574 7320 7472 6169 7473 0a20  Outputs traits. 
-0001bd60: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0001bd70: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
-0001bd80: 2020 2022 6f75 745f 696d 6167 6573 222c     "out_images",
-0001bd90: 0a20 2020 2020 2020 2020 2020 204f 7574  .            Out
-0001bda0: 7075 744d 756c 7469 5061 7468 2846 696c  putMultiPath(Fil
-0001bdb0: 6528 292c 206f 7574 7075 743d 5472 7565  e(), output=True
-0001bdc0: 2c20 6465 7363 3d6f 7574 5f69 6d61 6765  , desc=out_image
-0001bdd0: 735f 6465 7363 292c 0a20 2020 2020 2020  s_desc),.       
-0001bde0: 2029 0a0a 2020 2020 2020 2020 2320 5370   )..        # Sp
-0001bdf0: 6563 6961 6c20 7061 7261 6d65 7465 7220  ecial parameter 
-0001be00: 7573 6564 2061 7320 6120 6d65 7373 656e  used as a messen
-0001be10: 6765 7220 666f 7220 7468 6520 7275 6e5f  ger for the run_
-0001be20: 7072 6f63 6573 735f 6d69 6120 6d65 7468  process_mia meth
-0001be30: 6f64 0a20 2020 2020 2020 2073 656c 662e  od.        self.
-0001be40: 6164 645f 7472 6169 7428 0a20 2020 2020  add_trait(.     
-0001be50: 2020 2020 2020 2022 6469 6374 3472 756e         "dict4run
-0001be60: 7469 6d65 222c 0a20 2020 2020 2020 2020  time",.         
-0001be70: 2020 2074 7261 6974 732e 4469 6374 286f     traits.Dict(o
-0001be80: 7574 7075 743d 4661 6c73 652c 206f 7074  utput=False, opt
-0001be90: 696f 6e61 6c3d 5472 7565 2c20 7573 6572  ional=True, user
-0001bea0: 6c65 7665 6c3d 3129 2c0a 2020 2020 2020  level=1),.      
-0001beb0: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-0001bec0: 662e 696e 6974 5f64 6566 6175 6c74 5f74  f.init_default_t
-0001bed0: 7261 6974 7328 290a 0a20 2020 2064 6566  raits()..    def
-0001bee0: 206c 6973 745f 6f75 7470 7574 7328 7365   list_outputs(se
-0001bef0: 6c66 2c20 6973 5f70 6c75 6767 6564 3d4e  lf, is_plugged=N
-0001bf00: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0001bf10: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
-0001bf20: 6520 696e 6974 6961 6c69 7361 7469 6f6e  e initialisation
-0001bf30: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
-0001bf40: 636b 2e0a 0a20 2020 2020 2020 2054 6865  ck...        The
-0001bf50: 206d 6169 6e20 6f62 6a65 6374 6976 6520   main objective 
-0001bf60: 6f66 2074 6869 7320 6d65 7468 6f64 2069  of this method i
-0001bf70: 7320 746f 2070 726f 6475 6365 2074 6865  s to produce the
-0001bf80: 206f 7574 7075 7473 206f 6620 7468 650a   outputs of the.
-0001bf90: 2020 2020 2020 2020 6272 6963 6b73 2028          bricks (
-0001bfa0: 7365 6c66 2e6f 7574 7075 7473 2920 616e  self.outputs) an
-0001bfb0: 6420 7468 6520 6173 736f 6369 6174 6564  d the associated
-0001bfc0: 2074 6167 7320 2873 656c 662e 696e 6865   tags (self.inhe
-0001bfd0: 7269 7461 6e63 655f 6469 6329 2c0a 2020  ritance_dic),.  
-0001bfe0: 2020 2020 2020 6966 2064 6566 696e 6564        if defined
-0001bff0: 2068 6572 652e 2049 6e20 6f72 6465 7220   here. In order 
-0001c000: 6e6f 7420 746f 2069 6e63 6c75 6465 2061  not to include a
-0001c010: 6e20 6f75 7470 7574 2069 6e20 7468 6520  n output in the 
-0001c020: 6461 7461 6261 7365 2c0a 2020 2020 2020  database,.      
-0001c030: 2020 7468 6973 206f 7574 7075 7420 6d75    this output mu
-0001c040: 7374 2062 6520 6120 7661 6c75 6520 6f66  st be a value of
-0001c050: 2074 6865 206f 7074 696f 6e61 6c20 6b65   the optional ke
-0001c060: 7920 276e 6f74 496e 4462 2720 6f66 2074  y 'notInDb' of t
-0001c070: 6865 0a20 2020 2020 2020 2073 656c 662e  he.        self.
-0001c080: 6f75 7470 7574 7320 6469 6374 696f 6e61  outputs dictiona
-0001c090: 7279 2e20 546f 2077 6f72 6b20 7072 6f70  ry. To work prop
-0001c0a0: 6572 6c79 2074 6869 7320 6d65 7468 6f64  erly this method
-0001c0b0: 206d 7573 7420 7265 7475 726e 0a20 2020   must return.   
-0001c0c0: 2020 2020 2073 656c 662e 6d61 6b65 5f69       self.make_i
-0001c0d0: 6e69 7452 6573 756c 7428 2920 6f62 6a65  nitResult() obje
-0001c0e0: 6374 2e0a 0a20 2020 2020 2020 203a 7061  ct...        :pa
-0001c0f0: 7261 6d20 6973 5f70 6c75 6767 6564 3a20  ram is_plugged: 
-0001c100: 7468 6520 7374 6174 652c 206c 696e 6b65  the state, linke
-0001c110: 6420 6f72 206e 6f74 2c20 6f66 2074 6865  d or not, of the
-0001c120: 2070 6c75 6773 2e0a 2020 2020 2020 2020   plugs..        
-0001c130: 3a72 6574 7572 6e73 3a20 6120 6469 6374  :returns: a dict
-0001c140: 696f 6e61 7279 2077 6974 6820 7265 7175  ionary with requ
-0001c150: 6972 656d 656e 742c 206f 7574 7075 7473  irement, outputs
-0001c160: 2061 6e64 2069 6e68 6572 6974 616e 6365   and inheritance
-0001c170: 5f64 6963 742e 0a20 2020 2020 2020 2022  _dict..        "
-0001c180: 2222 0a20 2020 2020 2020 2023 2055 7369  "".        # Usi
-0001c190: 6e67 2074 6865 2069 6e68 6572 6974 616e  ng the inheritan
-0001c1a0: 6365 2074 6f20 5072 6f63 6573 734d 4941  ce to ProcessMIA
-0001c1b0: 2063 6c61 7373 2c20 6c69 7374 5f6f 7574   class, list_out
-0001c1c0: 7075 7473 206d 6574 686f 640a 2020 2020  puts method.    
-0001c1d0: 2020 2020 7375 7065 7228 5265 7361 6d70      super(Resamp
-0001c1e0: 6c65 322c 2073 656c 6629 2e6c 6973 745f  le2, self).list_
-0001c1f0: 6f75 7470 7574 7328 290a 0a20 2020 2020  outputs()..     
-0001c200: 2020 2023 204f 7574 7075 7473 2064 6566     # Outputs def
-0001c210: 696e 6974 696f 6e20 616e 6420 7461 6773  inition and tags
-0001c220: 2069 6e68 6572 6974 616e 6365 2028 6f70   inheritance (op
-0001c230: 7469 6f6e 616c 290a 2020 2020 2020 2020  tional).        
-0001c240: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-0001c250: 2073 656c 662e 6669 6c65 735f 746f 5f72   self.files_to_r
-0001c260: 6573 616d 706c 6520 213d 2055 6e64 6566  esample != Undef
-0001c270: 696e 6564 0a20 2020 2020 2020 2020 2020  ined.           
-0001c280: 2061 6e64 2073 656c 662e 7265 6665 7265   and self.refere
-0001c290: 6e63 655f 696d 6167 6520 213d 2055 6e64  nce_image != Und
-0001c2a0: 6566 696e 6564 0a20 2020 2020 2020 2029  efined.        )
-0001c2b0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-0001c2c0: 7469 656e 745f 6e61 6d65 203d 2067 6574  tient_name = get
-0001c2d0: 5f64 6246 6965 6c64 5661 6c75 6528 0a20  _dbFieldValue(. 
-0001c2e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001c2f0: 656c 662e 7072 6f6a 6563 742c 2073 656c  elf.project, sel
-0001c300: 662e 7265 6665 7265 6e63 655f 696d 6167  f.reference_imag
-0001c310: 652c 2022 5061 7469 656e 744e 616d 6522  e, "PatientName"
-0001c320: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0001c330: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0001c340: 6174 6965 6e74 5f6e 616d 6520 6973 204e  atient_name is N
-0001c350: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001c360: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
-0001c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c380: 225c 6e52 6573 616d 706c 6532 2062 7269  "\nResample2 bri
-0001c390: 636b 3a5c 6e20 5468 6520 5061 7469 656e  ck:\n The Patien
-0001c3a0: 744e 616d 6520 7461 6720 6973 206e 6f74  tName tag is not
-0001c3b0: 2066 696c 6c65 6420 220a 2020 2020 2020   filled ".      
-0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-0001c3d0: 6e20 7468 6520 6461 7461 6261 7365 2066  n the database f
-0001c3e0: 6f72 2074 6865 207b 7d20 6669 6c65 202e  or the {} file .
-0001c3f0: 2e2e 5c6e 2054 6865 2063 616c 6375 6c61  ..\n The calcula
-0001c400: 7469 6f6e 220a 2020 2020 2020 2020 2020  tion".          
-0001c410: 2020 2020 2020 2020 2020 2269 7320 6162            "is ab
-0001c420: 6f72 7465 642e 2e2e 222e 666f 726d 6174  orted...".format
-0001c430: 2873 656c 662e 7265 6665 7265 6e63 655f  (self.reference_
-0001c440: 696d 6167 6529 0a20 2020 2020 2020 2020  image).         
-0001c450: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001c460: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001c470: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
-0001c480: 7375 6c74 2829 0a0a 2020 2020 2020 2020  sult()..        
-0001c490: 2020 2020 7365 6c66 2e64 6963 7434 7275      self.dict4ru
-0001c4a0: 6e74 696d 655b 2270 6174 6965 6e74 5f6e  ntime["patient_n
-0001c4b0: 616d 6522 5d20 3d20 7061 7469 656e 745f  ame"] = patient_
-0001c4c0: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-0001c4d0: 2063 6f6e 765f 6469 7232 203d 206f 732e   conv_dir2 = os.
-0001c4e0: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
-0001c4f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001c500: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
-0001c510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001c520: 2020 7061 7469 656e 745f 6e61 6d65 202b    patient_name +
-0001c530: 2022 5f64 6174 6122 2c0a 2020 2020 2020   "_data",.      
-0001c540: 2020 2020 2020 2020 2020 2252 4f49 5f64            "ROI_d
-0001c550: 6174 6122 2c0a 2020 2020 2020 2020 2020  ata",.          
-0001c560: 2020 2020 2020 2263 6f6e 7652 4f49 5f42        "convROI_B
-0001c570: 4f4c 4432 222c 0a20 2020 2020 2020 2020  OLD2",.         
-0001c580: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0001c590: 206c 6973 745f 6f75 7420 3d20 5b5d 0a0a   list_out = []..
-0001c5a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001c5b0: 726f 695f 6669 6c65 2069 6e20 7365 6c66  roi_file in self
-0001c5c0: 2e66 696c 6573 5f74 6f5f 7265 7361 6d70  .files_to_resamp
-0001c5d0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001c5e0: 2020 2020 6f75 745f 6669 6c65 203d 206f      out_file = o
-0001c5f0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0001c600: 726f 695f 6669 6c65 290a 2020 2020 2020  roi_file).      
-0001c610: 2020 2020 2020 2020 2020 6f75 745f 6669            out_fi
-0001c620: 6c65 5f6e 6f5f 6578 742c 2066 696c 655f  le_no_ext, file_
-0001c630: 6578 7465 6e73 696f 6e20 3d20 6f73 2e70  extension = os.p
-0001c640: 6174 682e 7370 6c69 7465 7874 286f 7574  ath.splitext(out
-0001c650: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
-0001c660: 2020 2020 2020 206f 7574 5f66 696c 6520         out_file 
-0001c670: 3d20 6f75 745f 6669 6c65 5f6e 6f5f 6578  = out_file_no_ex
-0001c680: 7420 2b20 7365 6c66 2e73 7566 6669 7820  t + self.suffix 
-0001c690: 2b20 6669 6c65 5f65 7874 656e 7369 6f6e  + file_extension
-0001c6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c6b0: 206f 7574 5f66 696c 6520 3d20 6f73 2e70   out_file = os.p
-0001c6c0: 6174 682e 6a6f 696e 2863 6f6e 765f 6469  ath.join(conv_di
-0001c6d0: 7232 2c20 6f75 745f 6669 6c65 290a 2020  r2, out_file).  
-0001c6e0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0001c6f0: 7374 5f6f 7574 2e61 7070 656e 6428 6f75  st_out.append(ou
-0001c700: 745f 6669 6c65 290a 0a20 2020 2020 2020  t_file)..       
-0001c710: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
-0001c720: 735b 226f 7574 5f69 6d61 6765 7322 5d20  s["out_images"] 
-0001c730: 3d20 6c69 7374 5f6f 7574 0a20 2020 2020  = list_out.     
-0001c740: 2020 2020 2020 2023 2046 4958 4d45 3a20         # FIXME: 
-0001c750: 5768 6174 2061 7265 2077 6520 646f 696e  What are we doin
-0001c760: 6720 6162 6f75 7420 7468 6520 7461 6773  g about the tags
-0001c770: 2069 6e68 6572 6974 616e 6365 3f0a 0a20   inheritance?.. 
-0001c780: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
-0001c790: 7468 6520 7265 7175 6972 656d 656e 742c  the requirement,
-0001c7a0: 206f 7574 7075 7473 2061 6e64 2069 6e68   outputs and inh
-0001c7b0: 6572 6974 616e 6365 5f64 6963 740a 2020  eritance_dict.  
-0001c7c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001c7d0: 662e 6d61 6b65 5f69 6e69 7452 6573 756c  f.make_initResul
-0001c7e0: 7428 290a 0a20 2020 2064 6566 2072 756e  t()..    def run
-0001c7f0: 5f70 726f 6365 7373 5f6d 6961 2873 656c  _process_mia(sel
-0001c800: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
-0001c810: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
-0001c820: 7072 6f63 6573 7320 6c61 756e 6368 2073  process launch s
-0001c830: 7465 7020 6f66 2074 6865 2062 7269 636b  tep of the brick
-0001c840: 2e22 2222 0a0a 2020 2020 2020 2020 2320  ."""..        # 
-0001c850: 4e6f 206e 6565 6420 7468 6520 6e65 7874  No need the next
-0001c860: 206c 696e 6520 2877 6520 646f 6e27 7420   line (we don't 
-0001c870: 7573 6520 7365 6c66 2e70 726f 6365 7373  use self.process
-0001c880: 2065 7420 5350 4d29 0a20 2020 2020 2020   et SPM).       
-0001c890: 2023 2073 7570 6572 2852 6573 616d 706c   # super(Resampl
-0001c8a0: 6532 2c20 7365 6c66 292e 7275 6e5f 7072  e2, self).run_pr
-0001c8b0: 6f63 6573 735f 6d69 6128 290a 0a20 2020  ocess_mia()..   
-0001c8c0: 2020 2020 2070 6174 5f6e 616d 655f 6469       pat_name_di
-0001c8d0: 7220 3d20 6f73 2e70 6174 682e 6a6f 696e  r = os.path.join
-0001c8e0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0001c8f0: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
-0001c900: 6f72 792c 2073 656c 662e 6469 6374 3472  ory, self.dict4r
-0001c910: 756e 7469 6d65 5b22 7061 7469 656e 745f  untime["patient_
-0001c920: 6e61 6d65 225d 202b 2022 5f64 6174 6122  name"] + "_data"
-0001c930: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001c940: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0001c950: 7468 2e65 7869 7374 7328 7061 745f 6e61  th.exists(pat_na
-0001c960: 6d65 5f64 6972 293a 0a20 2020 2020 2020  me_dir):.       
-0001c970: 2020 2020 206f 732e 6d6b 6469 7228 7061       os.mkdir(pa
-0001c980: 745f 6e61 6d65 5f64 6972 290a 0a20 2020  t_name_dir)..   
-0001c990: 2020 2020 2072 6f69 5f64 6174 615f 6469       roi_data_di
-0001c9a0: 7220 3d20 6f73 2e70 6174 682e 6a6f 696e  r = os.path.join
-0001c9b0: 2870 6174 5f6e 616d 655f 6469 722c 2022  (pat_name_dir, "
-0001c9c0: 524f 495f 6461 7461 2229 0a0a 2020 2020  ROI_data")..    
-0001c9d0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0001c9e0: 7468 2e65 7869 7374 7328 726f 695f 6461  th.exists(roi_da
-0001c9f0: 7461 5f64 6972 293a 0a20 2020 2020 2020  ta_dir):.       
-0001ca00: 2020 2020 206f 732e 6d6b 6469 7228 726f       os.mkdir(ro
-0001ca10: 695f 6461 7461 5f64 6972 290a 0a20 2020  i_data_dir)..   
-0001ca20: 2020 2020 2063 6f6e 765f 6469 7232 203d       conv_dir2 =
-0001ca30: 206f 732e 7061 7468 2e6a 6f69 6e28 726f   os.path.join(ro
-0001ca40: 695f 6461 7461 5f64 6972 2c20 2263 6f6e  i_data_dir, "con
-0001ca50: 7652 4f49 5f42 4f4c 4432 2229 0a20 2020  vROI_BOLD2").   
-0001ca60: 2020 2020 2074 6d70 203d 2022 4e6f 6e65       tmp = "None
-0001ca70: 220a 0a20 2020 2020 2020 2069 6620 6f73  "..        if os
-0001ca80: 2e70 6174 682e 6973 6469 7228 636f 6e76  .path.isdir(conv
-0001ca90: 5f64 6972 3229 3a0a 2020 2020 2020 2020  _dir2):.        
-0001caa0: 2020 2020 746d 7020 3d20 7465 6d70 6669      tmp = tempfi
-0001cab0: 6c65 2e6d 6b74 656d 7028 6469 723d 6f73  le.mktemp(dir=os
-0001cac0: 2e70 6174 682e 6469 726e 616d 6528 726f  .path.dirname(ro
-0001cad0: 695f 6461 7461 5f64 6972 2929 0a20 2020  i_data_dir)).   
-0001cae0: 2020 2020 2020 2020 206f 732e 6d6b 6469           os.mkdi
-0001caf0: 7228 746d 7029 0a20 2020 2020 2020 2020  r(tmp).         
-0001cb00: 2020 2073 6875 7469 6c2e 6d6f 7665 2863     shutil.move(c
-0001cb10: 6f6e 765f 6469 7232 2c20 6f73 2e70 6174  onv_dir2, os.pat
-0001cb20: 682e 6a6f 696e 2874 6d70 2c20 2263 6f6e  h.join(tmp, "con
-0001cb30: 7652 4f49 5f42 4f4c 4432 2229 290a 2020  vROI_BOLD2")).  
-0001cb40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001cb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cb60: 2027 5c6e 5265 7361 6d70 6c65 3220 6272   '\nResample2 br
-0001cb70: 6963 6b3a 5c6e 4120 227b 7d22 2066 6f6c  ick:\nA "{}" fol
-0001cb80: 6465 7220 616c 7265 6164 7920 6578 6973  der already exis
-0001cb90: 7473 2c20 270a 2020 2020 2020 2020 2020  ts, '.          
-0001cba0: 2020 2020 2020 2269 7420 7769 6c6c 2062        "it will b
-0001cbb0: 6520 6f76 6572 7772 6974 7465 6e20 6279  e overwritten by
-0001cbc0: 2074 6869 7320 6e65 7720 220a 2020 2020   this new ".    
-0001cbd0: 2020 2020 2020 2020 2020 2020 2263 616c              "cal
-0001cbe0: 6375 6c61 7469 6f6e 2e2e 2e22 2e66 6f72  culation...".for
-0001cbf0: 6d61 7428 636f 6e76 5f64 6972 3229 0a20  mat(conv_dir2). 
-0001cc00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001cc10: 2020 2020 206f 732e 6d6b 6469 7228 636f       os.mkdir(co
-0001cc20: 6e76 5f64 6972 3229 0a0a 2020 2020 2020  nv_dir2)..      
-0001cc30: 2020 6966 206f 732e 7061 7468 2e69 7364    if os.path.isd
-0001cc40: 6972 2874 6d70 293a 0a20 2020 2020 2020  ir(tmp):.       
-0001cc50: 2020 2020 2073 6875 7469 6c2e 726d 7472       shutil.rmtr
-0001cc60: 6565 2874 6d70 290a 0a20 2020 2020 2020  ee(tmp)..       
-0001cc70: 2023 2053 6574 7469 6e67 2066 696c 6573   # Setting files
-0001cc80: 5f74 6f5f 7265 7361 6d70 6c65 2074 6f20  _to_resample to 
-0001cc90: 7468 6520 7265 736f 6c75 7469 6f6e 206f  the resolution o
-0001cca0: 6620 7468 6520 7265 6665 7265 6e63 655f  f the reference_
-0001ccb0: 696d 6167 650a 2020 2020 2020 2020 6d61  image.        ma
-0001ccc0: 736b 203d 206e 6962 2e6c 6f61 6428 7365  sk = nib.load(se
-0001ccd0: 6c66 2e72 6566 6572 656e 6365 5f69 6d61  lf.reference_ima
-0001cce0: 6765 292e 6765 745f 6664 6174 6128 290a  ge).get_fdata().
-0001ccf0: 2020 2020 2020 2020 6d61 736b 5f73 697a          mask_siz
-0001cd00: 6520 3d20 6d61 736b 2e73 6861 7065 5b3a  e = mask.shape[:
-0001cd10: 335d 0a0a 2020 2020 2020 2020 666f 7220  3]..        for 
-0001cd20: 726f 695f 6669 6c65 2069 6e20 7365 6c66  roi_file in self
-0001cd30: 2e66 696c 6573 5f74 6f5f 7265 7361 6d70  .files_to_resamp
-0001cd40: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001cd50: 726f 695f 696d 6720 3d20 6e69 622e 6c6f  roi_img = nib.lo
-0001cd60: 6164 2872 6f69 5f66 696c 6529 0a20 2020  ad(roi_file).   
-0001cd70: 2020 2020 2020 2020 2072 6f69 5f64 6174           roi_dat
-0001cd80: 6120 3d20 726f 695f 696d 672e 6765 745f  a = roi_img.get_
-0001cd90: 6664 6174 6128 290a 2020 2020 2020 2020  fdata().        
-0001cda0: 2020 2020 7265 7369 7a65 645f 726f 6920      resized_roi 
-0001cdb0: 3d20 7265 7369 7a65 2872 6f69 5f64 6174  = resize(roi_dat
-0001cdc0: 612c 206d 6173 6b5f 7369 7a65 290a 2020  a, mask_size).  
-0001cdd0: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
-0001cde0: 3a20 5368 6f75 6c64 2077 6520 7461 6b65  : Should we take
-0001cdf0: 2069 6e66 6f20 6672 6f6d 2052 4f49 206f   info from ROI o
-0001ce00: 7220 6672 6f6d 2074 6865 206d 6173 6b20  r from the mask 
-0001ce10: 3f0a 2020 2020 2020 2020 2020 2020 2320  ?.            # 
-0001ce20: 2020 2020 2020 4375 7272 656e 746c 7920        Currently 
-0001ce30: 7765 2074 616b 6520 6672 6f6d 2052 4f49  we take from ROI
-0001ce40: 2069 6d61 6765 730a 2020 2020 2020 2020   images.        
-0001ce50: 2020 2020 7265 7369 7a65 645f 696d 6720      resized_img 
-0001ce60: 3d20 6e69 622e 4e69 6674 6931 496d 6167  = nib.Nifti1Imag
-0001ce70: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0001ce80: 2020 2072 6573 697a 6564 5f72 6f69 2c20     resized_roi, 
-0001ce90: 726f 695f 696d 672e 6166 6669 6e65 2c20  roi_img.affine, 
-0001cea0: 726f 695f 696d 672e 6865 6164 6572 0a20  roi_img.header. 
-0001ceb0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0001cec0: 2020 2020 2020 2020 2020 2320 496d 6167            # Imag
-0001ced0: 6520 7361 7665 0a20 2020 2020 2020 2020  e save.         
-0001cee0: 2020 206f 7574 5f66 696c 6520 3d20 6f73     out_file = os
-0001cef0: 2e70 6174 682e 6261 7365 6e61 6d65 2872  .path.basename(r
-0001cf00: 6f69 5f66 696c 6529 0a20 2020 2020 2020  oi_file).       
-0001cf10: 2020 2020 206f 7574 5f66 696c 655f 6e6f       out_file_no
-0001cf20: 5f65 7874 2c20 6669 6c65 5f65 7874 656e  _ext, file_exten
-0001cf30: 7369 6f6e 203d 206f 732e 7061 7468 2e73  sion = os.path.s
-0001cf40: 706c 6974 6578 7428 6f75 745f 6669 6c65  plitext(out_file
-0001cf50: 290a 2020 2020 2020 2020 2020 2020 6f75  ).            ou
-0001cf60: 745f 6669 6c65 203d 206f 7574 5f66 696c  t_file = out_fil
-0001cf70: 655f 6e6f 5f65 7874 202b 2073 656c 662e  e_no_ext + self.
-0001cf80: 7375 6666 6978 202b 2066 696c 655f 6578  suffix + file_ex
-0001cf90: 7465 6e73 696f 6e0a 2020 2020 2020 2020  tension.        
-0001cfa0: 2020 2020 6f75 745f 6669 6c65 203d 206f      out_file = o
-0001cfb0: 732e 7061 7468 2e6a 6f69 6e28 636f 6e76  s.path.join(conv
-0001cfc0: 5f64 6972 322c 206f 7574 5f66 696c 6529  _dir2, out_file)
-0001cfd0: 0a20 2020 2020 2020 2020 2020 206e 6962  .            nib
-0001cfe0: 2e73 6176 6528 7265 7369 7a65 645f 696d  .save(resized_im
-0001cff0: 672c 206f 7574 5f66 696c 6529 0a20 2020  g, out_file).   
-0001d000: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d020: 225c 6e52 6573 616d 706c 6532 2062 7269  "\nResample2 bri
-0001d030: 636b 3a7b 307d 2073 6176 6564 222e 666f  ck:{0} saved".fo
-0001d040: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
-0001d050: 2020 2020 2020 2020 2020 6f73 2e70 6174            os.pat
-0001d060: 682e 6261 7365 6e61 6d65 286f 7574 5f66  h.basename(out_f
-0001d070: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-0001d080: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001d090: 2020 2029 0a0a 0a63 6c61 7373 2052 6f74     )...class Rot
-0001d0a0: 6174 696f 6e4d 6173 6b28 5072 6f63 6573  ationMask(Proces
-0001d0b0: 734d 4941 293a 0a20 2020 2022 2222 0a20  sMIA):.    """. 
-0001d0c0: 2020 202a 436f 6d70 7574 6520 7468 6520     *Compute the 
-0001d0d0: 726f 7461 7469 6f6e 206d 6173 6b20 696d  rotation mask im
-0001d0e0: 6167 652a 0a0a 2020 2020 506c 6561 7365  age*..    Please
-0001d0f0: 2c20 7365 6520 7468 6520 636f 6d70 6c65  , see the comple
-0001d100: 7465 2064 6f63 756d 656e 7461 7469 6f6e  te documentation
-0001d110: 2066 6f72 2074 6865 0a20 2020 2060 526f   for the.    `Ro
-0001d120: 7461 7469 6f6e 4d61 736b 2062 7269 636b  tationMask brick
-0001d130: 2069 6e20 7468 6520 6d69 615f 7072 6f63   in the mia_proc
-0001d140: 6573 7365 7320 7765 6273 6974 650a 2020  esses website.  
-0001d150: 2020 3c68 7474 7073 3a2f 2f70 6f70 756c    <https://popul
-0001d160: 7365 2e67 6974 6875 622e 696f 2f6d 6961  se.github.io/mia
-0001d170: 5f70 726f 6365 7373 6573 2f68 746d 6c2f  _processes/html/
-0001d180: 646f 6375 6d65 6e74 6174 696f 6e2f 6272  documentation/br
-0001d190: 6963 6b73 2f70 7265 7072 6f63 6573 732f  icks/preprocess/
-0001d1a0: 6f74 6865 722f 526f 7461 7469 6f6e 4d61  other/RotationMa
-0001d1b0: 736b 2e68 746d 6c3e 605f 0a0a 2020 2020  sk.html>`_..    
-0001d1c0: 6164 6170 7465 6420 6672 6f6d 3a0a 2020  adapted from:.  
-0001d1d0: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
-0001d1e0: 2e63 6f6d 2f6e 6970 7265 7073 2f6d 7269  .com/nipreps/mri
-0001d1f0: 7163 2f62 6c6f 622f 6530 3231 3030 3864  qc/blob/e021008d
-0001d200: 6130 6132 6566 3163 3438 6538 3832 6261  a0a2ef1c48e882ba
-0001d210: 6639 3332 3133 3961 3637 3333 3439 6639  f932139a673349f9
-0001d220: 2f6d 7269 7163 2f69 6e74 6572 6661 6365  /mriqc/interface
-0001d230: 732f 616e 6174 6f6d 6963 616c 2e70 7923  s/anatomical.py#
-0001d240: 4c34 3438 0a0a 2020 2020 2222 220a 0a20  L448..    """.. 
-0001d250: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0001d260: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0001d270: 2222 4465 6469 6361 7465 6420 746f 2074  ""Dedicated to t
-0001d280: 6865 2061 7474 7269 6275 7465 7320 696e  he attributes in
-0001d290: 6974 6961 6c69 7361 7469 6f6e 202f 2069  itialisation / i
-0001d2a0: 6e73 7461 6e74 6961 7469 6f6e 2e0a 0a20  nstantiation... 
-0001d2b0: 2020 2020 2020 2054 6865 2069 6e70 7574         The input
-0001d2c0: 2061 6e64 206f 7574 7075 7420 706c 7567   and output plug
-0001d2d0: 7320 6172 6520 6465 6669 6e65 6420 6865  s are defined he
-0001d2e0: 7265 2e20 5468 6520 7370 6563 6961 6c0a  re. The special.
-0001d2f0: 2020 2020 2020 2020 2773 656c 662e 7265          'self.re
-0001d300: 7175 6972 656d 656e 7427 2061 7474 7269  quirement' attri
-0001d310: 6275 7465 2028 6f70 7469 6f6e 616c 2920  bute (optional) 
-0001d320: 6973 2075 7365 6420 746f 2064 6566 696e  is used to defin
-0001d330: 6520 7468 650a 2020 2020 2020 2020 7468  e the.        th
-0001d340: 6972 642d 7061 7274 7920 7072 6f64 7563  ird-party produc
-0001d350: 7473 206e 6563 6573 7361 7279 2066 6f72  ts necessary for
-0001d360: 2074 6865 2072 756e 6e69 6e67 206f 6620   the running of 
-0001d370: 7468 6520 6272 6963 6b2e 0a20 2020 2020  the brick..     
-0001d380: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-0001d390: 2049 6e69 7469 616c 6973 6174 696f 6e20   Initialisation 
-0001d3a0: 6f66 2074 6865 206f 626a 6563 7473 206e  of the objects n
-0001d3b0: 6565 6465 6420 666f 7220 7468 6520 6c61  eeded for the la
-0001d3c0: 756e 6368 206f 6620 7468 6520 6272 6963  unch of the bric
-0001d3d0: 6b0a 2020 2020 2020 2020 7375 7065 7228  k.        super(
-0001d3e0: 526f 7461 7469 6f6e 4d61 736b 2c20 7365  RotationMask, se
-0001d3f0: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a0a  lf).__init__()..
-0001d400: 2020 2020 2020 2020 2320 5468 6972 6420          # Third 
-0001d410: 7061 7274 7920 736f 6674 7761 7265 7320  party softwares 
-0001d420: 7265 7175 6972 6564 2066 6f72 2074 6865  required for the
-0001d430: 2065 7865 6375 7469 6f6e 206f 6620 7468   execution of th
-0001d440: 6520 6272 6963 6b0a 2020 2020 2020 2020  e brick.        
-0001d450: 7365 6c66 2e72 6571 7569 7265 6d65 6e74  self.requirement
-0001d460: 203d 205b 5d0a 0a20 2020 2020 2020 2023   = []..        #
-0001d470: 2049 6e70 7574 7320 6465 7363 7269 7074   Inputs descript
-0001d480: 696f 6e0a 2020 2020 2020 2020 696e 5f66  ion.        in_f
-0001d490: 696c 655f 6465 7363 203d 2022 416e 2065  ile_desc = "An e
-0001d4a0: 7869 7374 696e 6720 7061 7468 2066 696c  xisting path fil
-0001d4b0: 652e 220a 2020 2020 2020 2020 7072 6566  e.".        pref
-0001d4c0: 6978 5f64 6573 6320 3d20 2250 7265 6669  ix_desc = "Prefi
-0001d4d0: 7820 6f66 2074 6865 206f 7574 7075 7420  x of the output 
-0001d4e0: 696d 6167 6520 2861 2073 7472 696e 6729  image (a string)
-0001d4f0: 2e22 0a20 2020 2020 2020 2073 7566 6669  .".        suffi
-0001d500: 785f 6465 7363 203d 2022 5375 6666 6978  x_desc = "Suffix
-0001d510: 206f 6620 7468 6520 6f75 7470 7574 2069   of the output i
-0001d520: 6d61 6765 2028 6120 7374 7269 6e67 292e  mage (a string).
-0001d530: 220a 0a20 2020 2020 2020 2023 204f 7574  "..        # Out
-0001d540: 7075 7473 2064 6573 6372 6970 7469 6f6e  puts description
-0001d550: 0a20 2020 2020 2020 206f 7574 5f66 696c  .        out_fil
-0001d560: 655f 6465 7363 203d 2028 0a20 2020 2020  e_desc = (.     
-0001d570: 2020 2020 2020 2022 5061 7468 206f 6620         "Path of 
-0001d580: 7468 6520 7363 616e 2061 6674 6572 206d  the scan after m
-0001d590: 6173 6b69 6e67 2022 0a20 2020 2020 2020  asking ".       
-0001d5a0: 2020 2020 2022 2861 2070 6174 686c 696b       "(a pathlik
-0001d5b0: 6520 6f62 6a65 6374 206f 7220 7374 7269  e object or stri
-0001d5c0: 6e67 2072 6570 7265 7365 6e74 696e 6720  ng representing 
-0001d5d0: 6120 6669 6c65 292e 220a 2020 2020 2020  a file).".      
-0001d5e0: 2020 290a 0a20 2020 2020 2020 2023 2049    )..        # I
-0001d5f0: 6e70 7574 7320 7472 6169 7473 0a20 2020  nputs traits.   
-0001d600: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-0001d610: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-0001d620: 2022 696e 5f66 696c 6522 2c20 4669 6c65   "in_file", File
-0001d630: 286f 7574 7075 743d 4661 6c73 652c 206f  (output=False, o
-0001d640: 7074 696f 6e61 6c3d 4661 6c73 652c 2064  ptional=False, d
-0001d650: 6573 633d 696e 5f66 696c 655f 6465 7363  esc=in_file_desc
-0001d660: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-0001d670: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-0001d680: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-0001d690: 2022 7375 6666 6978 222c 0a20 2020 2020   "suffix",.     
-0001d6a0: 2020 2020 2020 2074 7261 6974 732e 5374         traits.St
-0001d6b0: 7269 6e67 280a 2020 2020 2020 2020 2020  ring(.          
-0001d6c0: 2020 2020 2020 225f 726f 746d 6173 6b65        "_rotmaske
-0001d6d0: 6422 2c20 6f75 7470 7574 3d46 616c 7365  d", output=False
-0001d6e0: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
-0001d6f0: 2064 6573 633d 7375 6666 6978 5f64 6573   desc=suffix_des
-0001d700: 630a 2020 2020 2020 2020 2020 2020 292c  c.            ),
-0001d710: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001d720: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
-0001d730: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
-0001d740: 2270 7265 6669 7822 2c0a 2020 2020 2020  "prefix",.      
-0001d750: 2020 2020 2020 7472 6169 7473 2e53 7472        traits.Str
-0001d760: 696e 6728 2222 2c20 6f75 7470 7574 3d46  ing("", output=F
-0001d770: 616c 7365 2c20 6f70 7469 6f6e 616c 3d54  alse, optional=T
-0001d780: 7275 652c 2064 6573 633d 7072 6566 6978  rue, desc=prefix
-0001d790: 5f64 6573 6329 2c0a 2020 2020 2020 2020  _desc),.        
-0001d7a0: 290a 0a20 2020 2020 2020 2023 204f 7574  )..        # Out
-0001d7b0: 7075 7473 2074 7261 6974 730a 2020 2020  puts traits.    
-0001d7c0: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
-0001d7d0: 6974 2822 6f75 745f 6669 6c65 222c 2046  it("out_file", F
-0001d7e0: 696c 6528 6f75 7470 7574 3d54 7275 652c  ile(output=True,
-0001d7f0: 2064 6573 633d 6f75 745f 6669 6c65 5f64   desc=out_file_d
-0001d800: 6573 6329 290a 0a20 2020 2020 2020 2073  esc))..        s
-0001d810: 656c 662e 696e 6974 5f64 6566 6175 6c74  elf.init_default
-0001d820: 5f74 7261 6974 7328 290a 0a20 2020 2064  _traits()..    d
-0001d830: 6566 206c 6973 745f 6f75 7470 7574 7328  ef list_outputs(
-0001d840: 7365 6c66 2c20 6973 5f70 6c75 6767 6564  self, is_plugged
-0001d850: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001d860: 2222 2244 6564 6963 6174 6564 2074 6f20  """Dedicated to 
-0001d870: 7468 6520 696e 6974 6961 6c69 7361 7469  the initialisati
-0001d880: 6f6e 2073 7465 7020 6f66 2074 6865 2062  on step of the b
-0001d890: 7269 636b 2e0a 0a20 2020 2020 2020 2054  rick...        T
-0001d8a0: 6865 206d 6169 6e20 6f62 6a65 6374 6976  he main objectiv
-0001d8b0: 6520 6f66 2074 6869 7320 6d65 7468 6f64  e of this method
-0001d8c0: 2069 7320 746f 2070 726f 6475 6365 2074   is to produce t
-0001d8d0: 6865 206f 7574 7075 7473 206f 6620 7468  he outputs of th
-0001d8e0: 650a 2020 2020 2020 2020 6272 6963 6b73  e.        bricks
-0001d8f0: 2028 7365 6c66 2e6f 7574 7075 7473 2920   (self.outputs) 
-0001d900: 616e 6420 7468 6520 6173 736f 6369 6174  and the associat
-0001d910: 6564 2074 6167 7320 2873 656c 662e 696e  ed tags (self.in
-0001d920: 6865 7269 7461 6e63 655f 6469 6329 2c0a  heritance_dic),.
-0001d930: 2020 2020 2020 2020 6966 2064 6566 696e          if defin
-0001d940: 6564 2068 6572 652e 2054 6f20 776f 726b  ed here. To work
-0001d950: 2070 726f 7065 726c 7920 7468 6973 206d   properly this m
-0001d960: 6574 686f 6420 6d75 7374 2072 6574 7572  ethod must retur
-0001d970: 6e0a 2020 2020 2020 2020 7365 6c66 2e6d  n.        self.m
-0001d980: 616b 655f 696e 6974 5265 7375 6c74 2829  ake_initResult()
-0001d990: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
-0001d9a0: 2020 3a70 6172 616d 2069 735f 706c 7567    :param is_plug
-0001d9b0: 6765 643a 2074 6865 2073 7461 7465 2c20  ged: the state, 
-0001d9c0: 6c69 6e6b 6564 206f 7220 6e6f 742c 206f  linked or not, o
-0001d9d0: 6620 7468 6520 706c 7567 732e 0a20 2020  f the plugs..   
-0001d9e0: 2020 2020 203a 7265 7475 726e 733a 2061       :returns: a
-0001d9f0: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
-0001da00: 2072 6571 7569 7265 6d65 6e74 2c20 6f75   requirement, ou
-0001da10: 7470 7574 7320 616e 6420 696e 6865 7269  tputs and inheri
-0001da20: 7461 6e63 655f 6469 6374 2e0a 2020 2020  tance_dict..    
-0001da30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001da40: 2320 5573 696e 6720 7468 6520 696e 6865  # Using the inhe
-0001da50: 7269 7461 6e63 6520 746f 2050 726f 6365  ritance to Proce
-0001da60: 7373 4d49 4120 636c 6173 732c 206c 6973  ssMIA class, lis
-0001da70: 745f 6f75 7470 7574 7320 6d65 7468 6f64  t_outputs method
-0001da80: 0a20 2020 2020 2020 2073 7570 6572 2852  .        super(R
-0001da90: 6f74 6174 696f 6e4d 6173 6b2c 2073 656c  otationMask, sel
-0001daa0: 6629 2e6c 6973 745f 6f75 7470 7574 7328  f).list_outputs(
-0001dab0: 290a 0a20 2020 2020 2020 2023 204f 7574  )..        # Out
-0001dac0: 7075 7473 2064 6566 696e 6974 696f 6e0a  puts definition.
-0001dad0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001dae0: 696e 5f66 696c 653a 0a20 2020 2020 2020  in_file:.       
-0001daf0: 2020 2020 2076 616c 6964 5f65 7874 2c20       valid_ext, 
-0001db00: 696e 5f65 7874 2c20 6669 6c65 4e61 6d65  in_ext, fileName
-0001db10: 203d 2063 6865 636b 4669 6c65 4578 7428   = checkFileExt(
-0001db20: 7365 6c66 2e69 6e5f 6669 6c65 2c20 4558  self.in_file, EX
-0001db30: 5429 0a0a 2020 2020 2020 2020 2020 2020  T)..            
-0001db40: 6966 206e 6f74 2076 616c 6964 5f65 7874  if not valid_ext
-0001db50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001db60: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-0001db70: 2020 2020 2020 2020 2020 2020 2022 5c6e               "\n
-0001db80: 526f 7461 7469 6f6e 4d61 736b 2062 7269  RotationMask bri
-0001db90: 636b 3a20 5468 6520 696e 7075 7420 696d  ck: The input im
-0001dba0: 6167 6520 666f 726d 6174 2069 7320 6e6f  age format is no
-0001dbb0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-0001dbc0: 2020 2020 2020 2020 2272 6563 6f67 6e69          "recogni
-0001dbd0: 7a65 642e 2e2e 2122 0a20 2020 2020 2020  zed...!".       
-0001dbe0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001dbf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001dc00: 6e0a 0a20 2020 2020 2020 2020 2020 2069  n..            i
-0001dc10: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-0001dc20: 2020 2020 286e 6f74 2073 656c 662e 7375      (not self.su
-0001dc30: 6666 6978 290a 2020 2020 2020 2020 2020  ffix).          
-0001dc40: 2020 2020 2020 6f72 2028 7365 6c66 2e73        or (self.s
-0001dc50: 7566 6669 782e 6973 7370 6163 6528 2929  uffix.isspace())
-0001dc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dc70: 206f 7220 7365 6c66 2e73 7566 6669 7820   or self.suffix 
-0001dc80: 696e 205b 556e 6465 6669 6e65 642c 2022  in [Undefined, "
-0001dc90: 3c75 6e64 6566 696e 6564 3e22 5d0a 2020  <undefined>"].  
-0001dca0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-0001dcb0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001dcc0: 662e 7375 6666 6978 203d 2022 2022 0a0a  f.suffix = " "..
-0001dcd0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0001dce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dcf0: 2028 6e6f 7420 7365 6c66 2e70 7265 6669   (not self.prefi
-0001dd00: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
-0001dd10: 2020 206f 7220 2873 656c 662e 7072 6566     or (self.pref
-0001dd20: 6978 2e69 7373 7061 6365 2829 290a 2020  ix.isspace()).  
-0001dd30: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0001dd40: 2028 7365 6c66 2e70 7265 6669 7820 696e   (self.prefix in
-0001dd50: 205b 556e 6465 6669 6e65 642c 2022 3c75   [Undefined, "<u
-0001dd60: 6e64 6566 696e 6564 3e22 5d29 0a20 2020  ndefined>"]).   
-0001dd70: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-0001dd80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001dd90: 2e70 7265 6669 7820 3d20 2220 220a 0a20  .prefix = " ".. 
-0001dda0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-0001ddb0: 205f 203d 206f 732e 7061 7468 2e73 706c   _ = os.path.spl
-0001ddc0: 6974 2873 656c 662e 696e 5f66 696c 6529  it(self.in_file)
-0001ddd0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0001dde0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0001ddf0: 2020 2073 656c 662e 7375 6666 6978 203d     self.suffix =
-0001de00: 3d20 2220 220a 2020 2020 2020 2020 2020  = " ".          
-0001de10: 2020 2020 2020 616e 6420 7365 6c66 2e70        and self.p
-0001de20: 7265 6669 7820 3d3d 2022 2022 0a20 2020  refix == " ".   
-0001de30: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0001de40: 2070 6174 6820 3d3d 2073 656c 662e 6f75   path == self.ou
-0001de50: 7470 7574 5f64 6972 6563 746f 7279 0a20  tput_directory. 
-0001de60: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-0001de70: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-0001de80: 6720 3d20 514d 6573 7361 6765 426f 7828  g = QMessageBox(
-0001de90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001dea0: 2020 6d73 672e 7365 7449 636f 6e28 514d    msg.setIcon(QM
-0001deb0: 6573 7361 6765 426f 782e 5761 726e 696e  essageBox.Warnin
-0001dec0: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
-0001ded0: 2020 206d 7367 2e73 6574 5769 6e64 6f77     msg.setWindow
-0001dee0: 5469 746c 6528 0a20 2020 2020 2020 2020  Title(.         
-0001def0: 2020 2020 2020 2020 2020 2022 6d69 615f             "mia_
-0001df00: 7072 6f63 6573 7365 7320 2d20 526f 7461  processes - Rota
-0001df10: 7469 6f6e 4d61 736b 2062 7269 636b 2057  tionMask brick W
-0001df20: 6172 6e69 6e67 2122 0a20 2020 2020 2020  arning!".       
-0001df30: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001df40: 2020 2020 2020 2020 2020 206d 7367 2e73             msg.s
-0001df50: 6574 5465 7874 280a 2020 2020 2020 2020  etText(.        
-0001df60: 2020 2020 2020 2020 2020 2020 2253 7566              "Suf
-0001df70: 6669 7820 616e 6420 7072 6566 6978 2069  fix and prefix i
-0001df80: 6e70 7574 2070 6172 616d 6574 6572 7320  nput parameters 
-0001df90: 6172 6520 6e6f 7420 220a 2020 2020 2020  are not ".      
-0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2264                "d
-0001dfb0: 6566 696e 6564 206f 7220 636f 6e73 6973  efined or consis
-0001dfc0: 7420 6f6e 6c79 206f 6620 6f6e 6520 6f72  t only of one or
-0001dfd0: 206d 6f72 6520 7768 6974 6520 220a 2020   more white ".  
-0001dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dff0: 2020 2273 7061 6365 732e 5c6e 5468 6520    "spaces.\nThe 
-0001e000: 7b30 7d20 696e 7075 7420 7061 7261 6d65  {0} input parame
-0001e010: 7465 7220 7769 6c6c 2062 6520 220a 2020  ter will be ".  
-0001e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e030: 2020 226f 7665 7277 7269 7474 656e 202e    "overwritten .
-0001e040: 2e2e 5c6e 2059 6573 206f 7220 220a 2020  ..\n Yes or ".  
-0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e060: 2020 2241 626f 7274 3f22 2e66 6f72 6d61    "Abort?".forma
-0001e070: 7428 6669 6c65 4e61 6d65 290a 2020 2020  t(fileName).    
-0001e080: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001e090: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-0001e0a0: 672e 7365 7453 7461 6e64 6172 6442 7574  g.setStandardBut
-0001e0b0: 746f 6e73 2851 4d65 7373 6167 6542 6f78  tons(QMessageBox
-0001e0c0: 2e59 6573 207c 2051 4d65 7373 6167 6542  .Yes | QMessageB
-0001e0d0: 6f78 2e41 626f 7274 290a 2020 2020 2020  ox.Abort).      
-0001e0e0: 2020 2020 2020 2020 2020 7265 7476 616c            retval
-0001e0f0: 203d 206d 7367 2e65 7865 635f 2829 0a0a   = msg.exec_()..
-0001e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e110: 6966 2072 6574 7661 6c20 213d 2051 4d65  if retval != QMe
-0001e120: 7373 6167 6542 6f78 2e41 626f 7274 3a0a  ssageBox.Abort:.
-0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e140: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e160: 2020 2022 5c6e 526f 7461 7469 6f6e 4d61     "\nRotationMa
-0001e170: 736b 2062 7269 636b 2077 6172 6e69 6e67  sk brick warning
-0001e180: 3a20 7468 6520 6f75 745f 6669 6c65 206f  : the out_file o
-0001e190: 7574 7075 7420 220a 2020 2020 2020 2020  utput ".        
-0001e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1b0: 2270 6172 616d 6574 6572 2069 7320 7468  "parameter is th
-0001e1c0: 6520 7361 6d65 2061 7320 7468 6520 696e  e same as the in
-0001e1d0: 5f66 696c 6573 2069 6e70 7574 2022 0a20  _files input ". 
-0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1f0: 2020 2020 2020 2022 7061 7261 6d65 7465         "paramete
-0001e200: 7220 2873 7566 6669 7820 616e 6420 7072  r (suffix and pr
-0001e210: 6566 6978 2061 7265 206e 6f74 2064 6566  efix are not def
-0001e220: 696e 6564 293a 220a 2020 2020 2020 2020  ined):".        
-0001e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e240: 225c 6e7b 307d 2077 696c 6c20 6265 206f  "\n{0} will be o
-0001e250: 7665 7277 7269 7465 6420 2e2e 2e22 2e66  verwrited ...".f
-0001e260: 6f72 6d61 7428 6669 6c65 4e61 6d65 290a  ormat(fileName).
-0001e270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e280: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-0001e290: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2b0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-0001e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2d0: 225c 6e52 6f74 6174 696f 6e4d 6173 6b20  "\nRotationMask 
-0001e2e0: 6272 6963 6b20 4162 6f72 7465 642e 2050  brick Aborted. P
-0001e2f0: 6c65 6173 6520 6368 6563 6b20 796f 7572  lease check your
-0001e300: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0001e310: 2020 2020 2020 2020 2020 2022 696e 7075             "inpu
-0001e320: 7420 7061 7261 6d65 7465 7273 202e 2e2e  t parameters ...
-0001e330: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001e340: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001e350: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001e360: 726e 0a0a 2020 2020 2020 2020 2020 2020  rn..            
-0001e370: 6669 6c65 203d 206f 732e 7061 7468 2e6a  file = os.path.j
-0001e380: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
-0001e390: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
-0001e3a0: 5f64 6972 6563 746f 7279 2c0a 2020 2020  _directory,.    
-0001e3b0: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-0001e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3d0: 2020 7365 6c66 2e70 7265 6669 782e 7374    self.prefix.st
-0001e3e0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-0001e3f0: 2020 2020 2020 2020 2020 2b20 6669 6c65            + file
-0001e400: 4e61 6d65 0a20 2020 2020 2020 2020 2020  Name.           
-0001e410: 2020 2020 2020 2020 202b 2073 656c 662e           + self.
-0001e420: 7375 6666 6978 2e73 7472 6970 2829 0a20  suffix.strip(). 
-0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e440: 2020 202b 2022 2e22 0a20 2020 2020 2020     + ".".       
-0001e450: 2020 2020 2020 2020 2020 2020 202b 2069               + i
-0001e460: 6e5f 6578 740a 2020 2020 2020 2020 2020  n_ext.          
-0001e470: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-0001e480: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001e490: 2020 2020 6966 2066 696c 653a 0a20 2020      if file:.   
-0001e4a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001e4b0: 662e 6f75 7470 7574 735b 226f 7574 5f66  f.outputs["out_f
-0001e4c0: 696c 6522 5d20 3d20 6669 6c65 0a0a 2020  ile"] = file..  
-0001e4d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4f0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0001e500: 2020 2020 2020 2020 2020 2022 2d20 526f             "- Ro
-0001e510: 7461 7469 6f6e 4d61 736b 2062 7269 636b  tationMask brick
-0001e520: 3a20 5468 6572 6520 7761 7320 6e6f 206f  : There was no o
-0001e530: 7574 7075 7420 6669 6c65 2064 6564 7563  utput file deduc
-0001e540: 7465 6420 220a 2020 2020 2020 2020 2020  ted ".          
-0001e550: 2020 2020 2020 2020 2020 2264 7572 696e            "durin
-0001e560: 6720 696e 6974 6961 6c69 7a61 7469 6f6e  g initialization
-0001e570: 2e20 506c 6561 7365 2063 6865 636b 2074  . Please check t
-0001e580: 6865 2069 6e70 7574 2022 0a20 2020 2020  he input ".     
-0001e590: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001e5a0: 7061 7261 6d65 7465 7273 2e2e 2e21 220a  parameters...!".
-0001e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5c0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0001e5d0: 2074 6167 7320 696e 6865 7269 7461 6e63   tags inheritanc
-0001e5e0: 6520 286f 7074 696f 6e61 6c29 0a20 2020  e (optional).   
-0001e5f0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0001e600: 2e6f 7574 7075 7473 5b22 6f75 745f 6669  .outputs["out_fi
-0001e610: 6c65 225d 3a0a 2020 2020 2020 2020 2020  le"]:.          
-0001e620: 2020 2020 2020 7365 6c66 2e74 6167 735f        self.tags_
-0001e630: 696e 6865 7269 7461 6e63 6528 0a20 2020  inheritance(.   
-0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e650: 2069 6e5f 6669 6c65 3d73 656c 662e 696e   in_file=self.in
-0001e660: 5f66 696c 652c 0a20 2020 2020 2020 2020  _file,.         
-0001e670: 2020 2020 2020 2020 2020 206f 7574 5f66             out_f
-0001e680: 696c 653d 7365 6c66 2e6f 7574 7075 7473  ile=self.outputs
-0001e690: 5b22 6f75 745f 6669 6c65 225d 2c0a 2020  ["out_file"],.  
-0001e6a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001e6b0: 0a20 2020 2020 2020 2023 2052 6574 7572  .        # Retur
-0001e6c0: 6e20 7468 6520 7265 7175 6972 656d 656e  n the requiremen
-0001e6d0: 742c 206f 7574 7075 7473 2061 6e64 2069  t, outputs and i
-0001e6e0: 6e68 6572 6974 616e 6365 5f64 6963 740a  nheritance_dict.
-0001e6f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001e700: 656c 662e 6d61 6b65 5f69 6e69 7452 6573  elf.make_initRes
-0001e710: 756c 7428 290a 0a20 2020 2064 6566 2072  ult()..    def r
-0001e720: 756e 5f70 726f 6365 7373 5f6d 6961 2873  un_process_mia(s
-0001e730: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0001e740: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
-0001e750: 6520 7072 6f63 6573 7320 6c61 756e 6368  e process launch
-0001e760: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
-0001e770: 636b 2e22 2222 0a20 2020 2020 2020 2073  ck.""".        s
-0001e780: 7570 6572 2852 6f74 6174 696f 6e4d 6173  uper(RotationMas
-0001e790: 6b2c 2073 656c 6629 2e72 756e 5f70 726f  k, self).run_pro
-0001e7a0: 6365 7373 5f6d 6961 2829 0a0a 2020 2020  cess_mia()..    
-0001e7b0: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
-0001e7c0: 7365 6c66 2e69 6e5f 6669 6c65 0a0a 2020  self.in_file..  
-0001e7d0: 2020 2020 2020 2320 496d 6167 6520 7072        # Image pr
-0001e7e0: 6f63 6573 7369 6e67 0a20 2020 2020 2020  ocessing.       
-0001e7f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001e800: 2020 696d 6720 3d20 6e69 622e 6c6f 6164    img = nib.load
-0001e810: 2866 696c 655f 6e61 6d65 290a 0a20 2020  (file_name)..   
-0001e820: 2020 2020 2065 7863 6570 7420 280a 2020       except (.  
-0001e830: 2020 2020 2020 2020 2020 6e69 622e 6669            nib.fi
-0001e840: 6c65 6261 7365 6469 6d61 6765 732e 496d  lebasedimages.Im
-0001e850: 6167 6546 696c 6545 7272 6f72 2c0a 2020  ageFileError,.  
-0001e860: 2020 2020 2020 2020 2020 4669 6c65 4e6f            FileNo
-0001e870: 7446 6f75 6e64 4572 726f 722c 0a20 2020  tFoundError,.   
-0001e880: 2020 2020 2020 2020 2054 7970 6545 7272           TypeErr
-0001e890: 6f72 2c0a 2020 2020 2020 2020 2920 6173  or,.        ) as
-0001e8a0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001e8b0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0001e8c0: 2020 2020 2020 2022 5c6e 526f 7461 7469         "\nRotati
-0001e8d0: 6f6e 4d61 736b 2062 7269 636b 3a20 4572  onMask brick: Er
-0001e8e0: 726f 7220 7769 7468 2066 696c 6573 2074  ror with files t
-0001e8f0: 6f20 6d61 736b 2c20 6475 7269 6e67 2074  o mask, during t
-0001e900: 6865 2022 0a20 2020 2020 2020 2020 2020  he ".           
-0001e910: 2020 2020 2022 7275 6e3a 2022 2c0a 2020       "run: ",.  
-0001e920: 2020 2020 2020 2020 2020 2020 2020 652c                e,
-0001e930: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001e940: 2020 2020 2020 2020 2020 2069 6d67 203d             img =
-0001e950: 204e 6f6e 650a 0a20 2020 2020 2020 2069   None..        i
-0001e960: 6620 696d 6720 6973 206e 6f74 204e 6f6e  f img is not Non
-0001e970: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
-0001e980: 6174 6120 3d20 696d 672e 6765 745f 6664  ata = img.get_fd
-0001e990: 6174 6128 290a 2020 2020 2020 2020 2020  ata().          
-0001e9a0: 2020 6d61 736b 203d 2064 6174 6120 3c3d    mask = data <=
-0001e9b0: 2030 0a0a 2020 2020 2020 2020 2020 2020   0..            
-0001e9c0: 2320 5061 6420 6f6e 6520 7069 7865 6c20  # Pad one pixel 
-0001e9d0: 746f 2063 6f6e 7472 6f6c 2062 6568 6176  to control behav
-0001e9e0: 696f 7220 6f6e 2062 6f72 6465 7273 206f  ior on borders o
-0001e9f0: 6620 6269 6e61 7279 5f6f 7065 6e69 6e67  f binary_opening
-0001ea00: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-0001ea10: 6b20 3d20 6e70 2e70 6164 280a 2020 2020  k = np.pad(.    
-0001ea20: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-0001ea30: 2c20 7061 645f 7769 6474 683d 2831 2c29  , pad_width=(1,)
-0001ea40: 2c20 6d6f 6465 3d22 636f 6e73 7461 6e74  , mode="constant
-0001ea50: 222c 2063 6f6e 7374 616e 745f 7661 6c75  ", constant_valu
-0001ea60: 6573 3d31 0a20 2020 2020 2020 2020 2020  es=1.           
-0001ea70: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-0001ea80: 2320 5265 6d6f 7665 206e 6f69 7365 0a20  # Remove noise. 
-0001ea90: 2020 2020 2020 2020 2020 2073 7472 7563             struc
-0001eaa0: 203d 2073 696d 2e67 656e 6572 6174 655f   = sim.generate_
-0001eab0: 6269 6e61 7279 5f73 7472 7563 7475 7265  binary_structure
-0001eac0: 2833 2c20 3229 0a20 2020 2020 2020 2020  (3, 2).         
-0001ead0: 2020 206d 6173 6b20 3d20 7369 6d2e 6269     mask = sim.bi
-0001eae0: 6e61 7279 5f6f 7065 6e69 6e67 286d 6173  nary_opening(mas
-0001eaf0: 6b2c 2073 7472 7563 7475 7265 3d73 7472  k, structure=str
-0001eb00: 7563 292e 6173 7479 7065 286e 702e 7569  uc).astype(np.ui
-0001eb10: 6e74 3829 0a0a 2020 2020 2020 2020 2020  nt8)..          
-0001eb20: 2020 2320 5265 6d6f 7665 2073 6d61 6c6c    # Remove small
-0001eb30: 206f 626a 6563 7473 0a20 2020 2020 2020   objects.       
-0001eb40: 2020 2020 206c 6162 656c 5f69 6d2c 206e       label_im, n
-0001eb50: 625f 6c61 6265 6c73 203d 2073 696d 2e6c  b_labels = sim.l
-0001eb60: 6162 656c 286d 6173 6b29 0a20 2020 2020  abel(mask).     
-0001eb70: 2020 2020 2020 2069 6620 6e62 5f6c 6162         if nb_lab
-0001eb80: 656c 7320 3e20 323a 0a20 2020 2020 2020  els > 2:.       
-0001eb90: 2020 2020 2020 2020 2073 697a 6573 203d           sizes =
-0001eba0: 2073 696d 2e73 756d 286d 6173 6b2c 206c   sim.sum(mask, l
-0001ebb0: 6162 656c 5f69 6d2c 206c 6973 7428 7261  abel_im, list(ra
-0001ebc0: 6e67 6528 6e62 5f6c 6162 656c 7320 2b20  nge(nb_labels + 
-0001ebd0: 3129 2929 0a20 2020 2020 2020 2020 2020  1))).           
-0001ebe0: 2020 2020 206f 7264 6572 6564 203d 206c       ordered = l
-0001ebf0: 6973 7428 0a20 2020 2020 2020 2020 2020  ist(.           
-0001ec00: 2020 2020 2020 2020 2072 6576 6572 7365           reverse
-0001ec10: 6428 736f 7274 6564 287a 6970 2873 697a  d(sorted(zip(siz
-0001ec20: 6573 2c20 6c69 7374 2872 616e 6765 286e  es, list(range(n
-0001ec30: 625f 6c61 6265 6c73 202b 2031 2929 2929  b_labels + 1))))
-0001ec40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ec50: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001ec60: 2020 2020 666f 7220 5f2c 206c 6162 656c      for _, label
-0001ec70: 2069 6e20 6f72 6465 7265 645b 323a 5d3a   in ordered[2:]:
-0001ec80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ec90: 2020 2020 206d 6173 6b5b 6c61 6265 6c5f       mask[label_
-0001eca0: 696d 203d 3d20 6c61 6265 6c5d 203d 2030  im == label] = 0
-0001ecb0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0001ecc0: 556e 2d70 6164 0a20 2020 2020 2020 2020  Un-pad.         
-0001ecd0: 2020 206d 6173 6b20 3d20 6d61 736b 5b31     mask = mask[1
-0001ece0: 3a2d 312c 2031 3a2d 312c 2031 3a2d 315d  :-1, 1:-1, 1:-1]
-0001ecf0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0001ed00: 4966 206d 6173 6b20 6973 2073 6d61 6c6c  If mask is small
-0001ed10: 2c20 636c 6561 6e2d 7570 0a20 2020 2020  , clean-up.     
-0001ed20: 2020 2020 2020 2069 6620 6d61 736b 2e73         if mask.s
-0001ed30: 756d 2829 203c 2035 3030 3a0a 2020 2020  um() < 500:.    
-0001ed40: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-0001ed50: 203d 206e 702e 7a65 726f 735f 6c69 6b65   = np.zeros_like
-0001ed60: 286d 6173 6b2c 2064 7479 7065 3d6e 702e  (mask, dtype=np.
-0001ed70: 7569 6e74 3829 0a0a 2020 2020 2020 2020  uint8)..        
-0001ed80: 2020 2020 6f75 745f 696d 6720 3d20 696d      out_img = im
-0001ed90: 672e 5f5f 636c 6173 735f 5f28 6d61 736b  g.__class__(mask
-0001eda0: 2c20 696d 672e 6166 6669 6e65 2c20 696d  , img.affine, im
-0001edb0: 672e 6865 6164 6572 290a 2020 2020 2020  g.header).      
-0001edc0: 2020 2020 2020 6f75 745f 696d 672e 6865        out_img.he
-0001edd0: 6164 6572 2e73 6574 5f64 6174 615f 6474  ader.set_data_dt
-0001ede0: 7970 6528 6e70 2e75 696e 7438 290a 0a20  ype(np.uint8).. 
-0001edf0: 2020 2020 2020 2020 2020 2023 2049 6d61             # Ima
-0001ee00: 6765 2073 6176 650a 2020 2020 2020 2020  ge save.        
-0001ee10: 2020 2020 5f2c 2066 696c 655f 6e61 6d65      _, file_name
-0001ee20: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-0001ee30: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
-0001ee40: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-0001ee50: 655f 6e6f 5f65 7874 2c20 6669 6c65 5f65  e_no_ext, file_e
-0001ee60: 7874 656e 7369 6f6e 203d 206f 732e 7061  xtension = os.pa
-0001ee70: 7468 2e73 706c 6974 6578 7428 6669 6c65  th.splitext(file
-0001ee80: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
-0001ee90: 2020 2069 6620 6669 6c65 5f65 7874 656e     if file_exten
-0001eea0: 7369 6f6e 203d 3d20 222e 677a 223a 0a20  sion == ".gz":. 
-0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001eec0: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
-0001eed0: 5f32 2c20 6669 6c65 5f65 7874 656e 7369  _2, file_extensi
-0001eee0: 6f6e 5f32 2920 3d20 6f73 2e70 6174 682e  on_2) = os.path.
-0001eef0: 7370 6c69 7465 7874 280a 2020 2020 2020  splitext(.      
-0001ef00: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0001ef10: 6c65 5f6e 616d 655f 6e6f 5f65 7874 0a20  le_name_no_ext. 
-0001ef20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001ef30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef40: 2069 6620 6669 6c65 5f65 7874 656e 7369   if file_extensi
-0001ef50: 6f6e 5f32 203d 3d20 222e 6e69 6922 3a0a  on_2 == ".nii":.
-0001ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef70: 2020 2020 6669 6c65 5f6e 616d 655f 6e6f      file_name_no
-0001ef80: 5f65 7874 203d 2066 696c 655f 6e61 6d65  _ext = file_name
-0001ef90: 5f6e 6f5f 6578 745f 320a 2020 2020 2020  _no_ext_2.      
-0001efa0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0001efb0: 6c65 5f65 7874 656e 7369 6f6e 203d 2022  le_extension = "
-0001efc0: 2e6e 6969 2e67 7a22 0a0a 2020 2020 2020  .nii.gz"..      
-0001efd0: 2020 2020 2020 6669 6c65 5f6f 7574 203d        file_out =
-0001efe0: 206f 732e 7061 7468 2e6a 6f69 6e28 0a20   os.path.join(. 
-0001eff0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f000: 656c 662e 6f75 7470 7574 5f64 6972 6563  elf.output_direc
-0001f010: 746f 7279 2c0a 2020 2020 2020 2020 2020  tory,.          
-0001f020: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-0001f030: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001f040: 2e70 7265 6669 782e 7374 7269 7028 290a  .prefix.strip().
-0001f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f060: 2020 2020 2b20 6669 6c65 5f6e 616d 655f      + file_name_
-0001f070: 6e6f 5f65 7874 0a20 2020 2020 2020 2020  no_ext.         
-0001f080: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
-0001f090: 662e 7375 6666 6978 2e73 7472 6970 2829  f.suffix.strip()
-0001f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f0b0: 2020 2020 202b 2066 696c 655f 6578 7465       + file_exte
-0001f0c0: 6e73 696f 6e0a 2020 2020 2020 2020 2020  nsion.          
-0001f0d0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-0001f0e0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001f0f0: 2020 206e 6962 2e73 6176 6528 6f75 745f     nib.save(out_
-0001f100: 696d 672c 2066 696c 655f 6f75 7429 0a0a  img, file_out)..
-0001f110: 0a63 6c61 7373 2053 616e 6974 697a 6528  .class Sanitize(
-0001f120: 5072 6f63 6573 734d 4941 293a 0a20 2020  ProcessMIA):.   
-0001f130: 2022 2222 0a20 2020 202a 5361 6e69 7469   """.    *Saniti
-0001f140: 7a65 2069 6e70 7574 2062 6f6c 6420 696d  ze input bold im
-0001f150: 6167 652a 0a0a 2020 2020 506c 6561 7365  age*..    Please
-0001f160: 2c20 7365 6520 7468 6520 636f 6d70 6c65  , see the comple
-0001f170: 7465 2064 6f63 756d 656e 7461 7469 6f6e  te documentation
-0001f180: 2066 6f72 2074 6865 0a20 2020 2060 5361   for the.    `Sa
-0001f190: 6e69 7469 7a65 2062 7269 636b 2069 6e20  nitize brick in 
-0001f1a0: 7468 6520 6d69 615f 7072 6f63 6573 7365  the mia_processe
-0001f1b0: 7320 7765 6273 6974 650a 2020 2020 3c68  s website.    <h
-0001f1c0: 7474 7073 3a2f 2f70 6f70 756c 7365 2e67  ttps://populse.g
-0001f1d0: 6974 6875 622e 696f 2f6d 6961 5f70 726f  ithub.io/mia_pro
-0001f1e0: 6365 7373 6573 2f68 746d 6c2f 646f 6375  cesses/html/docu
-0001f1f0: 6d65 6e74 6174 696f 6e2f 6272 6963 6b73  mentation/bricks
-0001f200: 2f70 7265 7072 6f63 6573 732f 6f74 6865  /preprocess/othe
-0001f210: 722f 5361 6e69 7469 7a65 2e68 746d 6c3e  r/Sanitize.html>
-0001f220: 605f 0a0a 2020 2020 6164 6170 7465 6420  `_..    adapted 
-0001f230: 6672 6f6d 3a0a 2020 2020 6874 7470 733a  from:.    https:
-0001f240: 2f2f 6769 7468 7562 2e63 6f6d 2f6e 6970  //github.com/nip
-0001f250: 7265 7073 2f6e 6977 6f72 6b66 6c6f 7773  reps/niworkflows
-0001f260: 2f62 6c6f 622f 3435 6162 3133 6531 6266  /blob/45ab13e1bf
-0001f270: 3666 6462 6635 6532 3963 3930 6365 6634  6fdbf5e29c90cef4
-0001f280: 3430 3535 6230 6239 6366 3339 3162 2f6e  4055b0b9cf391b/n
-0001f290: 6977 6f72 6b66 6c6f 7773 2f69 6e74 6572  iworkflows/inter
-0001f2a0: 6661 6365 732f 6865 6164 6572 2e70 7923  faces/header.py#
-0001f2b0: 4c33 3934 0a0a 2020 2020 2222 220a 0a20  L394..    """.. 
-0001f2c0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0001f2d0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0001f2e0: 2222 4465 6469 6361 7465 6420 746f 2074  ""Dedicated to t
-0001f2f0: 6865 2061 7474 7269 6275 7465 7320 696e  he attributes in
-0001f300: 6974 6961 6c69 7361 7469 6f6e 202f 2069  itialisation / i
-0001f310: 6e73 7461 6e74 6961 7469 6f6e 2e0a 0a20  nstantiation... 
-0001f320: 2020 2020 2020 2054 6865 2069 6e70 7574         The input
-0001f330: 2061 6e64 206f 7574 7075 7420 706c 7567   and output plug
-0001f340: 7320 6172 6520 6465 6669 6e65 6420 6865  s are defined he
-0001f350: 7265 2e20 5468 6520 7370 6563 6961 6c0a  re. The special.
-0001f360: 2020 2020 2020 2020 2773 656c 662e 7265          'self.re
-0001f370: 7175 6972 656d 656e 7427 2061 7474 7269  quirement' attri
-0001f380: 6275 7465 2028 6f70 7469 6f6e 616c 2920  bute (optional) 
-0001f390: 6973 2075 7365 6420 746f 2064 6566 696e  is used to defin
-0001f3a0: 6520 7468 650a 2020 2020 2020 2020 7468  e the.        th
-0001f3b0: 6972 642d 7061 7274 7920 7072 6f64 7563  ird-party produc
-0001f3c0: 7473 206e 6563 6573 7361 7279 2066 6f72  ts necessary for
-0001f3d0: 2074 6865 2072 756e 6e69 6e67 206f 6620   the running of 
-0001f3e0: 7468 6520 6272 6963 6b2e 0a20 2020 2020  the brick..     
-0001f3f0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-0001f400: 2049 6e69 7469 616c 6973 6174 696f 6e20   Initialisation 
-0001f410: 6f66 2074 6865 206f 626a 6563 7473 206e  of the objects n
-0001f420: 6565 6465 6420 666f 7220 7468 6520 6c61  eeded for the la
-0001f430: 756e 6368 206f 6620 7468 6520 6272 6963  unch of the bric
-0001f440: 6b0a 2020 2020 2020 2020 7375 7065 7228  k.        super(
-0001f450: 5361 6e69 7469 7a65 2c20 7365 6c66 292e  Sanitize, self).
-0001f460: 5f5f 696e 6974 5f5f 2829 0a0a 2020 2020  __init__()..    
-0001f470: 2020 2020 2320 5468 6972 6420 7061 7274      # Third part
-0001f480: 7920 736f 6674 7761 7265 7320 7265 7175  y softwares requ
-0001f490: 6972 6564 2066 6f72 2074 6865 2065 7865  ired for the exe
-0001f4a0: 6375 7469 6f6e 206f 6620 7468 6520 6272  cution of the br
-0001f4b0: 6963 6b0a 2020 2020 2020 2020 7365 6c66  ick.        self
-0001f4c0: 2e72 6571 7569 7265 6d65 6e74 203d 205b  .requirement = [
-0001f4d0: 5d0a 0a20 2020 2020 2020 2023 2049 6e70  ]..        # Inp
-0001f4e0: 7574 7320 6465 7363 7269 7074 696f 6e0a  uts description.
-0001f4f0: 2020 2020 2020 2020 696e 5f66 696c 655f          in_file_
-0001f500: 6465 7363 203d 2022 416e 2065 7869 7374  desc = "An exist
-0001f510: 696e 6720 7061 7468 2066 696c 652e 220a  ing path file.".
-0001f520: 2020 2020 2020 2020 7072 6566 6978 5f64          prefix_d
-0001f530: 6573 6320 3d20 2250 7265 6669 7820 6f66  esc = "Prefix of
-0001f540: 2074 6865 206f 7574 7075 7420 696d 6167   the output imag
-0001f550: 6520 2861 2073 7472 696e 6729 2e22 0a20  e (a string).". 
-0001f560: 2020 2020 2020 2073 7566 6669 785f 6465         suffix_de
-0001f570: 7363 203d 2022 5375 6666 6978 206f 6620  sc = "Suffix of 
-0001f580: 7468 6520 6f75 7470 7574 2069 6d61 6765  the output image
-0001f590: 2028 6120 7374 7269 6e67 292e 220a 2020   (a string).".  
-0001f5a0: 2020 2020 2020 6e5f 766f 6c75 6d65 735f        n_volumes_
-0001f5b0: 746f 5f64 6973 6361 7264 5f64 6573 6320  to_discard_desc 
-0001f5c0: 3d20 226e 756d 6265 7220 6f66 206e 6f6e  = "number of non
-0001f5d0: 2073 7465 6164 792d 7374 6174 6520 766f   steady-state vo
-0001f5e0: 6c75 6d65 7322 0a20 2020 2020 2020 206d  lumes".        m
-0001f5f0: 6178 5f33 3262 6974 5f64 6573 6320 3d20  ax_32bit_desc = 
-0001f600: 280a 2020 2020 2020 2020 2020 2020 2263  (.            "c
-0001f610: 6173 7420 6461 7461 2074 6f20 666c 6f61  ast data to floa
-0001f620: 7433 3220 6966 2068 6967 6865 7220 7072  t32 if higher pr
-0001f630: 6563 6973 696f 6e20 6973 2065 6e63 6f75  ecision is encou
-0001f640: 6e74 6572 6564 220a 2020 2020 2020 2020  ntered".        
-0001f650: 290a 2020 2020 2020 2020 2320 4f75 7470  ).        # Outp
-0001f660: 7574 7320 6465 7363 7269 7074 696f 6e0a  uts description.
-0001f670: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
-0001f680: 5f64 6573 6320 3d20 280a 2020 2020 2020  _desc = (.      
-0001f690: 2020 2020 2020 2250 6174 6820 6f66 2074        "Path of t
-0001f6a0: 6865 2073 6e61 6974 697a 6564 2073 6361  he snaitized sca
-0001f6b0: 6e22 0a20 2020 2020 2020 2020 2020 2022  n".            "
-0001f6c0: 2861 2070 6174 686c 696b 6520 6f62 6a65  (a pathlike obje
-0001f6d0: 6374 206f 7220 7374 7269 6e67 2072 6570  ct or string rep
-0001f6e0: 7265 7365 6e74 696e 6720 6120 6669 6c65  resenting a file
-0001f6f0: 292e 220a 2020 2020 2020 2020 290a 0a20  ).".        ).. 
-0001f700: 2020 2020 2020 2023 2049 6e70 7574 7320         # Inputs 
-0001f710: 7472 6169 7473 0a20 2020 2020 2020 2073  traits.        s
-0001f720: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-0001f730: 2020 2020 2020 2020 2020 2022 696e 5f66             "in_f
-0001f740: 696c 6522 2c20 4669 6c65 286f 7574 7075  ile", File(outpu
-0001f750: 743d 4661 6c73 652c 206f 7074 696f 6e61  t=False, optiona
-0001f760: 6c3d 4661 6c73 652c 2064 6573 633d 696e  l=False, desc=in
-0001f770: 5f66 696c 655f 6465 7363 290a 2020 2020  _file_desc).    
-0001f780: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-0001f790: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-0001f7a0: 2020 2020 2020 2020 2020 2022 6d61 785f             "max_
-0001f7b0: 3332 6269 7422 2c0a 2020 2020 2020 2020  32bit",.        
-0001f7c0: 2020 2020 7472 6169 7473 2e42 6f6f 6c28      traits.Bool(
-0001f7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f7e0: 2046 616c 7365 2c20 6f75 7470 7574 3d46   False, output=F
-0001f7f0: 616c 7365 2c20 6f70 7469 6f6e 616c 3d54  alse, optional=T
-0001f800: 7275 652c 2064 6573 633d 6d61 785f 3332  rue, desc=max_32
-0001f810: 6269 745f 6465 7363 0a20 2020 2020 2020  bit_desc.       
-0001f820: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-0001f830: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001f840: 6164 645f 7472 6169 7428 0a20 2020 2020  add_trait(.     
-0001f850: 2020 2020 2020 2022 6e5f 766f 6c75 6d65         "n_volume
-0001f860: 735f 746f 5f64 6973 6361 7264 222c 0a20  s_to_discard",. 
-0001f870: 2020 2020 2020 2020 2020 2074 7261 6974             trait
-0001f880: 732e 496e 7428 0a20 2020 2020 2020 2020  s.Int(.         
-0001f890: 2020 2020 2020 2030 2c20 6f75 7470 7574         0, output
-0001f8a0: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
-0001f8b0: 3d54 7275 652c 2064 6573 633d 6e5f 766f  =True, desc=n_vo
-0001f8c0: 6c75 6d65 735f 746f 5f64 6973 6361 7264  lumes_to_discard
-0001f8d0: 5f64 6573 630a 2020 2020 2020 2020 2020  _desc.          
-0001f8e0: 2020 292c 0a20 2020 2020 2020 2029 0a0a    ),.        )..
-0001f8f0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-0001f900: 5f74 7261 6974 280a 2020 2020 2020 2020  _trait(.        
-0001f910: 2020 2020 2270 7265 6669 7822 2c0a 2020      "prefix",.  
-0001f920: 2020 2020 2020 2020 2020 7472 6169 7473            traits
-0001f930: 2e53 7472 696e 6728 2222 2c20 6f75 7470  .String("", outp
-0001f940: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
-0001f950: 616c 3d54 7275 652c 2064 6573 633d 7072  al=True, desc=pr
-0001f960: 6566 6978 5f64 6573 6329 2c0a 2020 2020  efix_desc),.    
-0001f970: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-0001f980: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-0001f990: 2020 2020 2020 2020 2020 2022 7375 6666             "suff
-0001f9a0: 6978 222c 0a20 2020 2020 2020 2020 2020  ix",.           
-0001f9b0: 2074 7261 6974 732e 5374 7269 6e67 280a   traits.String(.
-0001f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9d0: 225f 7661 6c69 6422 2c20 6f75 7470 7574  "_valid", output
-0001f9e0: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
-0001f9f0: 3d54 7275 652c 2064 6573 633d 7375 6666  =True, desc=suff
-0001fa00: 6978 5f64 6573 630a 2020 2020 2020 2020  ix_desc.        
-0001fa10: 2020 2020 292c 0a20 2020 2020 2020 2029      ),.        )
-0001fa20: 0a0a 2020 2020 2020 2020 2320 4f75 7470  ..        # Outp
-0001fa30: 7574 7320 7472 6169 7473 0a20 2020 2020  uts traits.     
-0001fa40: 2020 2073 656c 662e 6164 645f 7472 6169     self.add_trai
-0001fa50: 7428 226f 7574 5f66 696c 6522 2c20 4669  t("out_file", Fi
-0001fa60: 6c65 286f 7574 7075 743d 5472 7565 2c20  le(output=True, 
-0001fa70: 6465 7363 3d6f 7574 5f66 696c 655f 6465  desc=out_file_de
-0001fa80: 7363 2929 0a0a 2020 2020 2020 2020 7365  sc))..        se
-0001fa90: 6c66 2e69 6e69 745f 6465 6661 756c 745f  lf.init_default_
-0001faa0: 7472 6169 7473 2829 0a0a 2020 2020 6465  traits()..    de
-0001fab0: 6620 6c69 7374 5f6f 7574 7075 7473 2873  f list_outputs(s
-0001fac0: 656c 662c 2069 735f 706c 7567 6765 643d  elf, is_plugged=
-0001fad0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-0001fae0: 2222 4465 6469 6361 7465 6420 746f 2074  ""Dedicated to t
-0001faf0: 6865 2069 6e69 7469 616c 6973 6174 696f  he initialisatio
-0001fb00: 6e20 7374 6570 206f 6620 7468 6520 6272  n step of the br
-0001fb10: 6963 6b2e 0a0a 2020 2020 2020 2020 5468  ick...        Th
-0001fb20: 6520 6d61 696e 206f 626a 6563 7469 7665  e main objective
-0001fb30: 206f 6620 7468 6973 206d 6574 686f 6420   of this method 
-0001fb40: 6973 2074 6f20 7072 6f64 7563 6520 7468  is to produce th
-0001fb50: 6520 6f75 7470 7574 7320 6f66 2074 6865  e outputs of the
-0001fb60: 0a20 2020 2020 2020 2062 7269 636b 7320  .        bricks 
-0001fb70: 2873 656c 662e 6f75 7470 7574 7329 2061  (self.outputs) a
-0001fb80: 6e64 2074 6865 2061 7373 6f63 6961 7465  nd the associate
-0001fb90: 6420 7461 6773 2028 7365 6c66 2e69 6e68  d tags (self.inh
-0001fba0: 6572 6974 616e 6365 5f64 6963 292c 0a20  eritance_dic),. 
-0001fbb0: 2020 2020 2020 2069 6620 6465 6669 6e65         if define
-0001fbc0: 6420 6865 7265 2e20 546f 2077 6f72 6b20  d here. To work 
-0001fbd0: 7072 6f70 6572 6c79 2074 6869 7320 6d65  properly this me
-0001fbe0: 7468 6f64 206d 7573 7420 7265 7475 726e  thod must return
-0001fbf0: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-0001fc00: 6b65 5f69 6e69 7452 6573 756c 7428 2920  ke_initResult() 
-0001fc10: 6f62 6a65 6374 2e0a 0a20 2020 2020 2020  object...       
-0001fc20: 203a 7061 7261 6d20 6973 5f70 6c75 6767   :param is_plugg
-0001fc30: 6564 3a20 7468 6520 7374 6174 652c 206c  ed: the state, l
-0001fc40: 696e 6b65 6420 6f72 206e 6f74 2c20 6f66  inked or not, of
-0001fc50: 2074 6865 2070 6c75 6773 2e0a 2020 2020   the plugs..    
-0001fc60: 2020 2020 3a72 6574 7572 6e73 3a20 6120      :returns: a 
-0001fc70: 6469 6374 696f 6e61 7279 2077 6974 6820  dictionary with 
-0001fc80: 7265 7175 6972 656d 656e 742c 206f 7574  requirement, out
-0001fc90: 7075 7473 2061 6e64 2069 6e68 6572 6974  puts and inherit
-0001fca0: 616e 6365 5f64 6963 742e 0a20 2020 2020  ance_dict..     
-0001fcb0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-0001fcc0: 2055 7369 6e67 2074 6865 2069 6e68 6572   Using the inher
-0001fcd0: 6974 616e 6365 2074 6f20 5072 6f63 6573  itance to Proces
-0001fce0: 734d 4941 2063 6c61 7373 2c20 6c69 7374  sMIA class, list
-0001fcf0: 5f6f 7574 7075 7473 206d 6574 686f 640a  _outputs method.
-0001fd00: 2020 2020 2020 2020 7375 7065 7228 5361          super(Sa
-0001fd10: 6e69 7469 7a65 2c20 7365 6c66 292e 6c69  nitize, self).li
-0001fd20: 7374 5f6f 7574 7075 7473 2829 0a0a 2020  st_outputs()..  
-0001fd30: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
-0001fd40: 6465 6669 6e69 7469 6f6e 0a20 2020 2020  definition.     
-0001fd50: 2020 2069 6620 7365 6c66 2e69 6e5f 6669     if self.in_fi
-0001fd60: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001fd70: 7661 6c69 645f 6578 742c 2069 6e5f 6578  valid_ext, in_ex
-0001fd80: 742c 2066 696c 654e 616d 6520 3d20 6368  t, fileName = ch
-0001fd90: 6563 6b46 696c 6545 7874 2873 656c 662e  eckFileExt(self.
-0001fda0: 696e 5f66 696c 652c 2045 5854 290a 0a20  in_file, EXT).. 
-0001fdb0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001fdc0: 7420 7661 6c69 645f 6578 743a 0a20 2020  t valid_ext:.   
-0001fdd0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0001fde0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0001fdf0: 2020 2020 2020 2020 225c 6e53 616e 6974          "\nSanit
-0001fe00: 697a 6520 6272 6963 6b3a 2054 6865 2069  ize brick: The i
-0001fe10: 6e70 7574 2069 6d61 6765 2066 6f72 6d61  nput image forma
-0001fe20: 7420 6973 206e 6f74 2022 0a20 2020 2020  t is not ".     
-0001fe30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001fe40: 7265 636f 676e 697a 6564 2e2e 2e21 220a  recognized...!".
-0001fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001fe70: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0001fe80: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-0001fe90: 2020 2020 2020 2020 2020 2028 6e6f 7420             (not 
-0001fea0: 7365 6c66 2e73 7566 6669 7829 0a20 2020  self.suffix).   
-0001feb0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-0001fec0: 2873 656c 662e 7375 6666 6978 2e69 7373  (self.suffix.iss
-0001fed0: 7061 6365 2829 290a 2020 2020 2020 2020  pace()).        
-0001fee0: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
-0001fef0: 7375 6666 6978 2069 6e20 5b55 6e64 6566  suffix in [Undef
-0001ff00: 696e 6564 2c20 223c 756e 6465 6669 6e65  ined, "<undefine
-0001ff10: 643e 225d 0a20 2020 2020 2020 2020 2020  d>"].           
-0001ff20: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0001ff30: 2020 2020 7365 6c66 2e73 7566 6669 7820      self.suffix 
-0001ff40: 3d20 2220 220a 0a20 2020 2020 2020 2020  = " "..         
-0001ff50: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-0001ff60: 2020 2020 2020 2020 286e 6f74 2073 656c          (not sel
-0001ff70: 662e 7072 6566 6978 290a 2020 2020 2020  f.prefix).      
-0001ff80: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
-0001ff90: 6c66 2e70 7265 6669 782e 6973 7370 6163  lf.prefix.isspac
-0001ffa0: 6528 2929 0a20 2020 2020 2020 2020 2020  e()).           
-0001ffb0: 2020 2020 206f 7220 2873 656c 662e 7072       or (self.pr
-0001ffc0: 6566 6978 2069 6e20 5b55 6e64 6566 696e  efix in [Undefin
-0001ffd0: 6564 2c20 223c 756e 6465 6669 6e65 643e  ed, "<undefined>
-0001ffe0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-0001fff0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00020000: 2020 2073 656c 662e 7072 6566 6978 203d     self.prefix =
-00020010: 2022 2022 0a0a 2020 2020 2020 2020 2020   " "..          
-00020020: 2020 7061 7468 2c20 5f20 3d20 6f73 2e70    path, _ = os.p
-00020030: 6174 682e 7370 6c69 7428 7365 6c66 2e69  ath.split(self.i
-00020040: 6e5f 6669 6c65 290a 0a20 2020 2020 2020  n_file)..       
-00020050: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00020060: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00020070: 7566 6669 7820 3d3d 2022 2022 0a20 2020  uffix == " ".   
-00020080: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00020090: 2073 656c 662e 7072 6566 6978 203d 3d20   self.prefix == 
-000200a0: 2220 220a 2020 2020 2020 2020 2020 2020  " ".            
-000200b0: 2020 2020 616e 6420 7061 7468 203d 3d20      and path == 
-000200c0: 7365 6c66 2e6f 7574 7075 745f 6469 7265  self.output_dire
-000200d0: 6374 6f72 790a 2020 2020 2020 2020 2020  ctory.          
-000200e0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-000200f0: 2020 2020 206d 7367 203d 2051 4d65 7373       msg = QMess
-00020100: 6167 6542 6f78 2829 0a20 2020 2020 2020  ageBox().       
-00020110: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
-00020120: 4963 6f6e 2851 4d65 7373 6167 6542 6f78  Icon(QMessageBox
-00020130: 2e57 6172 6e69 6e67 290a 2020 2020 2020  .Warning).      
-00020140: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
-00020150: 7457 696e 646f 7754 6974 6c65 2822 6d69  tWindowTitle("mi
-00020160: 615f 7072 6f63 6573 7365 7320 2d20 5361  a_processes - Sa
-00020170: 6e69 7469 7a65 2062 7269 636b 2057 6172  nitize brick War
-00020180: 6e69 6e67 2122 290a 2020 2020 2020 2020  ning!").        
-00020190: 2020 2020 2020 2020 6d73 672e 7365 7454          msg.setT
-000201a0: 6578 7428 0a20 2020 2020 2020 2020 2020  ext(.           
-000201b0: 2020 2020 2020 2020 2022 5375 6666 6978           "Suffix
-000201c0: 2061 6e64 2070 7265 6669 7820 696e 7075   and prefix inpu
-000201d0: 7420 7061 7261 6d65 7465 7273 2061 7265  t parameters are
-000201e0: 206e 6f74 2022 0a20 2020 2020 2020 2020   not ".         
-000201f0: 2020 2020 2020 2020 2020 2022 6465 6669             "defi
-00020200: 6e65 6420 6f72 2063 6f6e 7369 7374 206f  ned or consist o
-00020210: 6e6c 7920 6f66 206f 6e65 206f 7220 6d6f  nly of one or mo
-00020220: 7265 2077 6869 7465 2022 0a20 2020 2020  re white ".     
-00020230: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00020240: 7370 6163 6573 2e5c 6e54 6865 207b 307d  spaces.\nThe {0}
-00020250: 2069 6e70 7574 2070 6172 616d 6574 6572   input parameter
-00020260: 2077 696c 6c20 6265 2022 0a20 2020 2020   will be ".     
-00020270: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00020280: 6f76 6572 7772 6974 7465 6e20 2e2e 2e5c  overwritten ...\
-00020290: 6e20 5965 7320 6f72 2022 0a20 2020 2020  n Yes or ".     
-000202a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000202b0: 4162 6f72 743f 222e 666f 726d 6174 2866  Abort?".format(f
-000202c0: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
-000202d0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000202e0: 2020 2020 2020 2020 2020 206d 7367 2e73             msg.s
-000202f0: 6574 5374 616e 6461 7264 4275 7474 6f6e  etStandardButton
-00020300: 7328 514d 6573 7361 6765 426f 782e 5965  s(QMessageBox.Ye
-00020310: 7320 7c20 514d 6573 7361 6765 426f 782e  s | QMessageBox.
-00020320: 4162 6f72 7429 0a20 2020 2020 2020 2020  Abort).         
-00020330: 2020 2020 2020 2072 6574 7661 6c20 3d20         retval = 
-00020340: 6d73 672e 6578 6563 5f28 290a 0a20 2020  msg.exec_()..   
-00020350: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00020360: 7265 7476 616c 2021 3d20 514d 6573 7361  retval != QMessa
-00020370: 6765 426f 782e 4162 6f72 743a 0a20 2020  geBox.Abort:.   
-00020380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020390: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-000203a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203b0: 225c 6e53 616e 6974 697a 6520 6272 6963  "\nSanitize bric
-000203c0: 6b20 7761 726e 696e 673a 2074 6865 206f  k warning: the o
-000203d0: 7574 5f66 696c 6520 6f75 7470 7574 2022  ut_file output "
-000203e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000203f0: 2020 2020 2020 2020 2022 7061 7261 6d65           "parame
-00020400: 7465 7220 6973 2074 6865 2073 616d 6520  ter is the same 
-00020410: 6173 2074 6865 2069 6e5f 6669 6c65 7320  as the in_files 
-00020420: 696e 7075 7420 220a 2020 2020 2020 2020  input ".        
-00020430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020440: 2270 6172 616d 6574 6572 2028 7375 6666  "parameter (suff
-00020450: 6978 2061 6e64 2070 7265 6669 7820 6172  ix and prefix ar
-00020460: 6520 6e6f 7420 6465 6669 6e65 6429 3a22  e not defined):"
-00020470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020480: 2020 2020 2020 2020 2022 5c6e 7b30 7d20           "\n{0} 
-00020490: 7769 6c6c 2062 6520 6f76 6572 7772 6974  will be overwrit
-000204a0: 6564 202e 2e2e 222e 666f 726d 6174 2866  ed ...".format(f
-000204b0: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
-000204c0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-000204d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000204f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00020500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020510: 2020 2020 2020 2020 2022 5c6e 5361 6e69           "\nSani
-00020520: 7469 7a65 2062 7269 636b 3a20 4162 6f72  tize brick: Abor
-00020530: 7465 642e 2050 6c65 6173 6520 6368 6563  ted. Please chec
-00020540: 6b20 796f 7572 2069 6e70 7574 2022 0a20  k your input ". 
-00020550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020560: 2020 2020 2020 2022 7061 7261 6d65 7465         "paramete
-00020570: 7273 202e 2e2e 220a 2020 2020 2020 2020  rs ...".        
-00020580: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00020590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205a0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-000205b0: 2020 2020 2020 6669 6c65 203d 206f 732e        file = os.
-000205c0: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
-000205d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000205e0: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
-000205f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00020600: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00020610: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-00020620: 6669 782e 7374 7269 7028 290a 2020 2020  fix.strip().    
+0001b150: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
+0001b160: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001b170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b180: 2020 2020 206d 7367 203d 2051 4d65 7373       msg = QMess
+0001b190: 6167 6542 6f78 2829 0a20 2020 2020 2020  ageBox().       
+0001b1a0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+0001b1b0: 2e73 6574 4963 6f6e 2851 4d65 7373 6167  .setIcon(QMessag
+0001b1c0: 6542 6f78 2e57 6172 6e69 6e67 290a 2020  eBox.Warning).  
+0001b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1e0: 2020 6d73 672e 7365 7457 696e 646f 7754    msg.setWindowT
+0001b1f0: 6974 6c65 280a 2020 2020 2020 2020 2020  itle(.          
+0001b200: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+0001b210: 6961 5f70 726f 6365 7373 6573 202d 2052  ia_processes - R
+0001b220: 6573 616d 706c 6531 2062 7269 636b 2057  esample1 brick W
+0001b230: 6172 6e69 6e67 2122 0a20 2020 2020 2020  arning!".       
+0001b240: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b260: 2020 206d 7367 2e73 6574 5465 7874 280a     msg.setText(.
+0001b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b280: 2020 2020 2020 2020 2266 696c 6573 5f74          "files_t
+0001b290: 6f5f 7265 7361 6d70 6c65 2027 7b30 7d27  o_resample '{0}'
+0001b2a0: 206f 722f 616e 6420 220a 2020 2020 2020   or/and ".      
+0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2c0: 2020 2272 6566 6572 656e 6365 5f69 6d61    "reference_ima
+0001b2d0: 6765 2027 7b31 7d27 2069 7320 2861 7265  ge '{1}' is (are
+0001b2e0: 2920 656d 7074 7920 2e2e 2e20 446f 2022  ) empty ... Do "
+0001b2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b300: 2020 2020 2020 2020 2022 796f 7520 7761           "you wa
+0001b310: 6e74 2074 6f20 636f 6e74 696e 7565 3f20  nt to continue? 
+0001b320: 5c6e 5c6e 220a 2020 2020 2020 2020 2020  \n\n".          
+0001b330: 2020 2020 2020 2020 2020 2020 2020 222d                "-
+0001b340: 2054 6f20 636f 7272 6563 7420 7468 6520   To correct the 
+0001b350: 696e 7075 7420 7061 7261 6d65 7465 7273  input parameters
+0001b360: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0001b370: 2020 2020 2020 2020 2020 2022 636c 6963             "clic
+0001b380: 6b20 2741 626f 7274 272e 5c6e 5c6e 220a  k 'Abort'.\n\n".
+0001b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3a0: 2020 2020 2020 2020 222d 2049 6620 7468          "- If th
+0001b3b0: 6520 5265 7361 6d70 6c65 3120 6272 6963  e Resample1 bric
+0001b3c0: 6b20 6973 206c 6f63 6174 6564 2069 6e20  k is located in 
+0001b3d0: 6120 220a 2020 2020 2020 2020 2020 2020  a ".            
+0001b3e0: 2020 2020 2020 2020 2020 2020 2270 6970              "pip
+0001b3f0: 656c 696e 652c 2069 7420 6d61 7920 6265  eline, it may be
+0001b400: 2075 7375 616c 2074 6861 7420 7468 6973   usual that this
+0001b410: 2874 6865 7365 2920 220a 2020 2020 2020  (these) ".      
+0001b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b430: 2020 2270 6172 616d 6574 6572 2873 2920    "parameter(s) 
+0001b440: 6973 2861 7265 2920 656d 7074 7920 6174  is(are) empty at
+0001b450: 2074 6865 2022 0a20 2020 2020 2020 2020   the ".         
+0001b460: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001b470: 696e 6974 6961 6c69 7361 7469 6f6e 2074  initialisation t
+0001b480: 696d 652e 2049 6e20 7468 6973 2063 6173  ime. In this cas
+0001b490: 652c 2069 6620 7468 6520 220a 2020 2020  e, if the ".    
+0001b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4b0: 2020 2020 2266 696c 6573 5f74 6f5f 7265      "files_to_re
+0001b4c0: 7361 6d70 6c65 2061 6e64 2074 6865 2072  sample and the r
+0001b4d0: 6566 6572 656e 6365 5f69 6d61 6765 2022  eference_image "
+0001b4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b4f0: 2020 2020 2020 2020 2022 7061 7261 6d65           "parame
+0001b500: 7465 7273 2063 6f72 7265 7370 6f6e 6420  ters correspond 
+0001b510: 746f 2061 2033 4420 696d 6167 6520 616e  to a 3D image an
+0001b520: 6420 6120 3344 2022 0a20 2020 2020 2020  d a 3D ".       
+0001b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b540: 2022 6f72 2061 2034 442c 2072 6573 7065   "or a 4D, respe
+0001b550: 6374 6976 656c 792c 2063 6c69 636b 2027  ctively, click '
+0001b560: 5965 7327 2c20 220a 2020 2020 2020 2020  Yes', ".        
+0001b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b580: 226f 7468 6572 7769 7365 2063 6c69 636b  "otherwise click
+0001b590: 2027 4162 6f72 7427 2061 6e64 2063 6861   'Abort' and cha
+0001b5a0: 6e67 6520 7468 6520 696e 7075 7420 220a  nge the input ".
+0001b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5c0: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
+0001b5d0: 6572 732e 222e 666f 726d 6174 2866 696c  ers.".format(fil
+0001b5e0: 655f 6e61 6d65 2c20 7365 6c66 2e72 6566  e_name, self.ref
+0001b5f0: 6572 656e 6365 5f69 6d61 6765 290a 2020  erence_image).  
+0001b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b610: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001b620: 2020 2020 2020 2020 6d73 672e 7365 7453          msg.setS
+0001b630: 7461 6e64 6172 6442 7574 746f 6e73 2851  tandardButtons(Q
+0001b640: 4d65 7373 6167 6542 6f78 2e59 6573 207c  MessageBox.Yes |
+0001b650: 2051 4d65 7373 6167 6542 6f78 2e41 626f   QMessageBox.Abo
+0001b660: 7274 290a 2020 2020 2020 2020 2020 2020  rt).            
+0001b670: 2020 2020 2020 2020 7265 7476 616c 203d          retval =
+0001b680: 206d 7367 2e65 7865 635f 2829 0a0a 2020   msg.exec_()..  
+0001b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6a0: 2020 6966 2072 6574 7661 6c20 3d3d 2051    if retval == Q
+0001b6b0: 4d65 7373 6167 6542 6f78 2e59 6573 3a0a  MessageBox.Yes:.
+0001b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6d0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+0001b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6f0: 2020 2020 2020 2020 2020 2022 5c6e 5265             "\nRe
+0001b700: 7361 6d70 6c65 3120 6272 6963 6b20 5761  sample1 brick Wa
+0001b710: 726e 696e 6721 3a20 456d 7074 7920 696e  rning!: Empty in
+0001b720: 7075 7420 220a 2020 2020 2020 2020 2020  put ".          
+0001b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b740: 2020 2266 696c 6528 7329 2e20 4e6f 2063    "file(s). No c
+0001b750: 6865 636b 206f 6620 7468 6520 6469 6d65  heck of the dime
+0001b760: 6e73 696f 6e73 206f 6620 7468 6520 220a  nsions of the ".
+0001b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b780: 2020 2020 2020 2020 2020 2020 2269 6e70              "inp
+0001b790: 7574 2069 6d61 6765 7320 6973 2064 6f6e  ut images is don
+0001b7a0: 6520 2e2e 2e20 2866 696c 6573 5f74 6f5f  e ... (files_to_
+0001b7b0: 7265 7361 6d70 6c65 2022 0a20 2020 2020  resample ".     
+0001b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7d0: 2020 2020 2020 2022 6d75 7374 2062 6520         "must be 
+0001b7e0: 6120 3344 2061 6e64 2072 6566 6572 656e  a 3D and referen
+0001b7f0: 6365 5f69 6d61 6765 206d 7573 7420 6265  ce_image must be
+0001b800: 2061 2033 4420 220a 2020 2020 2020 2020   a 3D ".        
+0001b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b820: 2020 2020 226f 7220 6120 3444 2920 2e2e      "or a 4D) ..
+0001b830: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+0001b840: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0001b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b860: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b880: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8a0: 2020 2022 5c6e 5265 7361 6d70 6c65 3120     "\nResample1 
+0001b8b0: 6272 6963 6b3a 2049 6e69 7469 616c 6973  brick: Initialis
+0001b8c0: 6174 696f 6e20 6661 696c 6564 202e 2e2e  ation failed ...
+0001b8d0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0001b8e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001b8f0: 506c 6561 7365 2063 6865 636b 2074 6865  Please check the
+0001b900: 2069 6e70 7574 2070 6172 616d 6574 6572   input parameter
+0001b910: 7321 220a 2020 2020 2020 2020 2020 2020  s!".            
+0001b920: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b940: 2020 2020 2020 6669 6c65 735f 6e61 6d65        files_name
+0001b950: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0001b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b970: 6272 6561 6b0a 0a20 2020 2020 2020 2020  break..         
+0001b980: 2020 2020 2020 2070 6174 682c 2066 696c         path, fil
+0001b990: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+0001b9a0: 2e73 706c 6974 2866 696c 655f 6e61 6d65  .split(file_name
+0001b9b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001b9c0: 2020 6669 6c65 5f6e 616d 655f 6e6f 5f65    file_name_no_e
+0001b9d0: 7874 2c20 6669 6c65 5f65 7874 656e 7369  xt, file_extensi
+0001b9e0: 6f6e 203d 206f 732e 7061 7468 2e73 706c  on = os.path.spl
+0001b9f0: 6974 6578 7428 6669 6c65 5f6e 616d 6529  itext(file_name)
+0001ba00: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ba10: 2020 2320 666d 743a 206f 6666 0a20 2020    # fmt: off.   
+0001ba20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001ba30: 2873 656c 662e 7375 6666 6978 5f74 6f5f  (self.suffix_to_
+0001ba40: 6465 6c65 7465 2021 3d20 2220 2229 2061  delete != " ") a
+0001ba50: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+0001ba60: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
+0001ba70: 6d65 5f6e 6f5f 6578 745b 2d6c 656e 2873  me_no_ext[-len(s
+0001ba80: 656c 662e 7375 6666 6978 5f74 6f5f 6465  elf.suffix_to_de
+0001ba90: 6c65 7465 293a 5d0a 2020 2020 2020 2020  lete):].        
+0001baa0: 2020 2020 2020 2020 2020 2020 3d3d 2073              == s
+0001bab0: 656c 662e 7375 6666 6978 5f74 6f5f 6465  elf.suffix_to_de
+0001bac0: 6c65 7465 0a20 2020 2020 2020 2020 2020  lete.           
+0001bad0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0001bae0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0001baf0: 5f6e 616d 655f 6e6f 5f65 7874 203d 2066  _name_no_ext = f
+0001bb00: 696c 655f 6e61 6d65 5f6e 6f5f 6578 745b  ile_name_no_ext[
+0001bb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bb20: 2020 2020 2020 2020 203a 2d6c 656e 2873           :-len(s
+0001bb30: 656c 662e 7375 6666 6978 5f74 6f5f 6465  elf.suffix_to_de
+0001bb40: 6c65 7465 290a 2020 2020 2020 2020 2020  lete).          
+0001bb50: 2020 2020 2020 2020 2020 5d0a 0a20 2020            ]..   
+0001bb60: 2020 2020 2020 2020 2020 2020 2023 2066               # f
+0001bb70: 6d74 3a20 6f6e 0a20 2020 2020 2020 2020  mt: on.         
+0001bb80: 2020 2020 2020 2066 696c 6573 2e61 7070         files.app
+0001bb90: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0001bba0: 2020 2020 2020 2020 206f 732e 7061 7468           os.path
+0001bbb0: 2e6a 6f69 6e28 0a20 2020 2020 2020 2020  .join(.         
+0001bbc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001bbd0: 656c 662e 6f75 7470 7574 5f64 6972 6563  elf.output_direc
+0001bbe0: 746f 7279 2c0a 2020 2020 2020 2020 2020  tory,.          
+0001bbf0: 2020 2020 2020 2020 2020 2020 2020 280a                (.
+0001bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001bc20: 2e70 7265 6669 782e 7374 7269 7028 290a  .prefix.strip().
+0001bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc40: 2020 2020 2020 2020 2020 2020 2b20 6669              + fi
+0001bc50: 6c65 5f6e 616d 655f 6e6f 5f65 7874 0a20  le_name_no_ext. 
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc70: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
+0001bc80: 662e 7375 6666 6978 2e73 7472 6970 2829  f.suffix.strip()
+0001bc90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bca0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+0001bcb0: 696c 655f 6578 7465 6e73 696f 6e0a 2020  ile_extension.  
+0001bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bcd0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+0001bce0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001bd00: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0001bd10: 4d61 7920 6f76 6572 7772 6974 6520 616e  May overwrite an
+0001bd20: 2069 6e70 7574 2069 6d61 6765 2077 6974   input image wit
+0001bd30: 6820 616e 206f 7574 7075 7420 696d 6167  h an output imag
+0001bd40: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0001bd50: 2028 7365 6c66 2e73 7566 6669 7820 3d3d   (self.suffix ==
+0001bd60: 2022 2022 2920 616e 6420 2873 656c 662e   " ") and (self.
+0001bd70: 7072 6566 6978 203d 3d20 2220 2229 2061  prefix == " ") a
+0001bd80: 6e64 2028 6669 6c65 735f 6e61 6d65 293a  nd (files_name):
+0001bd90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bda0: 206d 7367 203d 2051 4d65 7373 6167 6542   msg = QMessageB
+0001bdb0: 6f78 2829 0a20 2020 2020 2020 2020 2020  ox().           
+0001bdc0: 2020 2020 206d 7367 2e73 6574 4963 6f6e       msg.setIcon
+0001bdd0: 2851 4d65 7373 6167 6542 6f78 2e57 6172  (QMessageBox.War
+0001bde0: 6e69 6e67 290a 2020 2020 2020 2020 2020  ning).          
+0001bdf0: 2020 2020 2020 6d73 672e 7365 7457 696e        msg.setWin
+0001be00: 646f 7754 6974 6c65 2822 6d69 615f 7072  dowTitle("mia_pr
+0001be10: 6f63 6573 7365 7320 2d20 5265 7361 6d70  ocesses - Resamp
+0001be20: 6c65 3120 6272 6963 6b20 5761 726e 696e  le1 brick Warnin
+0001be30: 6721 2229 0a20 2020 2020 2020 2020 2020  g!").           
+0001be40: 2020 2020 206d 7367 2e73 6574 5465 7874       msg.setText
+0001be50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001be60: 2020 2020 2020 2253 7566 6669 7820 616e        "Suffix an
+0001be70: 6420 7072 6566 6978 2069 6e70 7574 2070  d prefix input p
+0001be80: 6172 616d 6574 6572 7320 6172 6520 6e6f  arameters are no
+0001be90: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
+0001bea0: 2020 2020 2020 2020 2264 6566 696e 6564          "defined
+0001beb0: 206f 7220 636f 6e73 6973 7420 6f6e 6c79   or consist only
+0001bec0: 206f 6620 6f6e 6520 6f72 206d 6f72 6520   of one or more 
+0001bed0: 7768 6974 6520 220a 2020 2020 2020 2020  white ".        
+0001bee0: 2020 2020 2020 2020 2020 2020 2273 7061              "spa
+0001bef0: 6365 732e 5c6e 5c6e 5468 6520 6669 6c65  ces.\n\nThe file
+0001bf00: 735f 746f 5f72 6573 616d 706c 6520 696e  s_to_resample in
+0001bf10: 7075 7420 7061 7261 6d65 7465 7220 220a  put parameter ".
+0001bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf30: 2020 2020 2228 6966 2073 7566 6669 785f      "(if suffix_
+0001bf40: 746f 5f64 656c 6574 6520 696e 7075 7420  to_delete input 
+0001bf50: 7061 7261 6d65 7465 7220 6973 206e 6f74  parameter is not
+0001bf60: 2073 6574 2920 220a 2020 2020 2020 2020   set) ".        
+0001bf70: 2020 2020 2020 2020 2020 2020 226f 7220              "or 
+0001bf80: 6f74 6865 7220 6669 6c65 7320 2869 6620  other files (if 
+0001bf90: 7375 6666 6978 5f74 6f5f 6465 6c65 7465  suffix_to_delete
+0001bfa0: 2069 6e70 7574 2022 0a20 2020 2020 2020   input ".       
+0001bfb0: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
+0001bfc0: 7261 6d65 7465 7220 6973 2073 6574 2920  rameter is set) 
+0001bfd0: 636f 756c 6420 6265 206f 7665 7277 7269  could be overwri
+0001bfe0: 7474 656e 202e 2e2e 2074 6869 7320 220a  tten ... this ".
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c000: 2020 2020 2263 6f6e 6365 726e 7320 7468      "concerns th
+0001c010: 6520 666f 6c6c 6f77 696e 6720 696d 6167  e following imag
+0001c020: 6573 3a5c 6e7b 7d5c 6e5c 6e44 6f20 796f  es:\n{}\n\nDo yo
+0001c030: 7520 220a 2020 2020 2020 2020 2020 2020  u ".            
+0001c040: 2020 2020 2020 2020 2261 6772 6565 2074          "agree t
+0001c050: 6f20 7573 6520 7468 6573 6520 696e 7075  o use these inpu
+0001c060: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
+0001c070: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
+0001c080: 6572 733f 222e 666f 726d 6174 2873 6574  ers?".format(set
+0001c090: 2866 696c 6573 2929 0a20 2020 2020 2020  (files)).       
+0001c0a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001c0b0: 2020 2020 2020 2020 2020 206d 7367 2e73             msg.s
+0001c0c0: 6574 5374 616e 6461 7264 4275 7474 6f6e  etStandardButton
+0001c0d0: 7328 514d 6573 7361 6765 426f 782e 5965  s(QMessageBox.Ye
+0001c0e0: 7320 7c20 514d 6573 7361 6765 426f 782e  s | QMessageBox.
+0001c0f0: 4162 6f72 7429 0a20 2020 2020 2020 2020  Abort).         
+0001c100: 2020 2020 2020 2072 6574 7661 6c20 3d20         retval = 
+0001c110: 6d73 672e 6578 6563 5f28 290a 0a20 2020  msg.exec_()..   
+0001c120: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001c130: 7265 7476 616c 203d 3d20 514d 6573 7361  retval == QMessa
+0001c140: 6765 426f 782e 5965 733a 0a20 2020 2020  geBox.Yes:.     
+0001c150: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001c160: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+0001c170: 2020 2020 2020 2020 2020 2020 2020 225c                "\
+0001c180: 6e52 6573 616d 706c 6531 2062 7269 636b  nResample1 brick
+0001c190: 2077 6172 6e69 6e67 3a20 7375 6666 6978   warning: suffix
+0001c1a0: 2061 6e64 2070 7265 6669 7820 696e 7075   and prefix inpu
+0001c1b0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
+0001c1c0: 2020 2020 2020 2020 2020 2020 2270 6172              "par
+0001c1d0: 616d 6574 6572 7320 6172 6520 6e6f 7420  ameters are not 
+0001c1e0: 6465 6669 6e65 642c 2074 6865 2066 6f6c  defined, the fol
+0001c1f0: 6c6f 7769 6e67 2066 696c 6573 2022 0a20  lowing files ". 
+0001c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c210: 2020 2020 2020 2022 636f 756c 6420 6265         "could be
+0001c220: 206f 7665 7277 7269 7465 213a 5c6e 7b30   overwrite!:\n{0
+0001c230: 7d20 2e2e 2e5c 6e22 2e66 6f72 6d61 7428  } ...\n".format(
+0001c240: 7365 7428 6669 6c65 7329 290a 2020 2020  set(files)).    
+0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c260: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001c270: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001c280: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0001c290: 6573 5f6e 616d 6520 3d20 4e6f 6e65 0a0a  es_name = None..
+0001c2a0: 2020 2020 2020 2020 2020 2020 2320 5477              # Tw
+0001c2b0: 6f20 2861 7420 6c65 6173 7429 2069 6e70  o (at least) inp
+0001c2c0: 7574 2069 6d61 6765 7320 6769 7665 2074  ut images give t
+0001c2d0: 6865 2073 616d 6520 6f75 7470 7574 2069  he same output i
+0001c2e0: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
+0001c2f0: 2069 6620 286c 656e 2866 696c 6573 2920   if (len(files) 
+0001c300: 213d 206c 656e 2873 6574 2866 696c 6573  != len(set(files
+0001c310: 2929 2920 616e 6420 2866 696c 6573 5f6e  ))) and (files_n
+0001c320: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
+0001c330: 2020 2020 2020 6475 7065 7320 3d20 7365        dupes = se
+0001c340: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0001c350: 2020 2020 7365 656e 203d 2073 6574 2829      seen = set()
+0001c360: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c370: 2020 666f 7220 7820 696e 2066 696c 6573    for x in files
+0001c380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c390: 2020 2020 2020 6966 2078 2069 6e20 7365        if x in se
+0001c3a0: 656e 3a0a 2020 2020 2020 2020 2020 2020  en:.            
+0001c3b0: 2020 2020 2020 2020 2020 2020 6475 7065              dupe
+0001c3c0: 732e 6164 6428 7829 0a0a 2020 2020 2020  s.add(x)..      
+0001c3d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001c3e0: 656e 2e61 6464 2878 290a 0a20 2020 2020  en.add(x)..     
+0001c3f0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+0001c400: 2051 4d65 7373 6167 6542 6f78 2829 0a20   QMessageBox(). 
+0001c410: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001c420: 7367 2e73 6574 4963 6f6e 2851 4d65 7373  sg.setIcon(QMess
+0001c430: 6167 6542 6f78 2e57 6172 6e69 6e67 290a  ageBox.Warning).
+0001c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c450: 6d73 672e 7365 7457 696e 646f 7754 6974  msg.setWindowTit
+0001c460: 6c65 2822 6d69 615f 7072 6f63 6573 7365  le("mia_processe
+0001c470: 7320 2d20 5265 7361 6d70 6c65 3120 6272  s - Resample1 br
+0001c480: 6963 6b20 5761 726e 696e 6721 2229 0a20  ick Warning!"). 
+0001c490: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001c4a0: 7367 2e73 6574 5465 7874 280a 2020 2020  sg.setText(.    
+0001c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4c0: 2254 6865 2073 7566 6669 782c 2070 7265  "The suffix, pre
+0001c4d0: 6669 7820 616e 6420 7375 6666 6978 5f74  fix and suffix_t
+0001c4e0: 6f5f 6465 6c65 7465 2069 6e70 7574 2022  o_delete input "
+0001c4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c500: 2020 2020 2022 7061 7261 6d65 7465 7273       "parameters
+0001c510: 2063 6f6d 6269 6e61 7469 6f6e 2073 6565   combination see
+0001c520: 6d73 2074 6f20 6372 6561 7465 2066 6f72  ms to create for
+0001c530: 2061 7420 220a 2020 2020 2020 2020 2020   at ".          
+0001c540: 2020 2020 2020 2020 2020 226c 6561 7374            "least
+0001c550: 2074 776f 2064 6966 6665 7265 6e74 2069   two different i
+0001c560: 6e70 7574 2069 6d61 6765 7320 7468 6520  nput images the 
+0001c570: 7361 6d65 206f 7574 7075 7420 220a 2020  same output ".  
+0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c590: 2020 2269 6d61 6765 3a5c 6e7b 7d5c 6e5c    "image:\n{}\n\
+0001c5a0: 6e50 6c65 6173 6520 6368 616e 6765 2074  nPlease change t
+0001c5b0: 6865 2073 7566 6669 782c 2070 7265 6669  he suffix, prefi
+0001c5c0: 7820 220a 2020 2020 2020 2020 2020 2020  x ".            
+0001c5d0: 2020 2020 2020 2020 2261 6e64 2073 7566          "and suf
+0001c5e0: 6669 785f 746f 5f64 656c 6574 6520 696e  fix_to_delete in
+0001c5f0: 7075 7420 7061 7261 6d65 7465 7273 2063  put parameters c
+0001c600: 6f6d 6269 6e61 7469 6f6e 2022 0a20 2020  ombination ".   
+0001c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c620: 2022 616e 6420 696e 6974 6961 6c69 7365   "and initialise
+0001c630: 2061 6761 696e 2074 6869 7320 6272 6963   again this bric
+0001c640: 6b2e 222e 666f 726d 6174 2864 7570 6573  k.".format(dupes
+0001c650: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c660: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001c670: 2020 2020 6d73 672e 7365 7453 7461 6e64      msg.setStand
+0001c680: 6172 6442 7574 746f 6e73 2851 4d65 7373  ardButtons(QMess
+0001c690: 6167 6542 6f78 2e43 6c6f 7365 290a 2020  ageBox.Close).  
+0001c6a0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+0001c6b0: 672e 6275 7474 6f6e 436c 6963 6b65 642e  g.buttonClicked.
+0001c6c0: 636f 6e6e 6563 7428 6d73 672e 636c 6f73  connect(msg.clos
+0001c6d0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001c6e0: 2020 206d 7367 2e65 7865 6328 290a 2020     msg.exec().  
+0001c6f0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0001c700: 6c65 735f 6e61 6d65 203d 204e 6f6e 650a  les_name = None.
+0001c710: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001c720: 6669 6c65 735f 6e61 6d65 3a0a 2020 2020  files_name:.    
+0001c730: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001c740: 2e6f 7574 7075 7473 5b22 6f75 745f 6669  .outputs["out_fi
+0001c750: 6c65 7322 5d20 3d20 6669 6c65 730a 0a20  les"] = files.. 
+0001c760: 2020 2020 2020 2023 2054 6167 7320 696e         # Tags in
+0001c770: 6865 7269 7461 6e63 6520 286f 7074 696f  heritance (optio
+0001c780: 6e61 6c29 0a20 2020 2020 2020 2069 6620  nal).        if 
+0001c790: 7365 6c66 2e6f 7574 7075 7473 3a0a 2020  self.outputs:.  
+0001c7a0: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+0001c7b0: 792c 2076 616c 2069 6e20 7365 6c66 2e6f  y, val in self.o
+0001c7c0: 7574 7075 7473 2e69 7465 6d73 2829 3a0a  utputs.items():.
+0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7e0: 6966 206b 6579 203d 3d20 226f 7574 5f66  if key == "out_f
+0001c7f0: 696c 6573 223a 0a20 2020 2020 2020 2020  iles":.         
+0001c800: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0001c810: 6e5f 7661 6c2c 206f 7574 5f76 616c 2069  n_val, out_val i
+0001c820: 6e20 7a69 7028 6669 6c65 735f 6e61 6d65  n zip(files_name
+0001c830: 2c20 7661 6c29 3a0a 2020 2020 2020 2020  , val):.        
+0001c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c850: 5f2c 2066 696c 654f 7661 6c20 3d20 6f73  _, fileOval = os
+0001c860: 2e70 6174 682e 7370 6c69 7428 6f75 745f  .path.split(out_
+0001c870: 7661 6c29 0a20 2020 2020 2020 2020 2020  val).           
+0001c880: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0001c890: 654f 7661 6c5f 6e6f 5f65 7874 2c20 5f20  eOval_no_ext, _ 
+0001c8a0: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
+0001c8b0: 7874 2866 696c 654f 7661 6c29 0a0a 2020  xt(fileOval)..  
+0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8d0: 2020 2020 2020 2320 666d 743a 206f 6666        # fmt: off
+0001c8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c8f0: 2020 2020 2020 2020 2069 6620 2873 656c           if (sel
+0001c900: 662e 7375 6666 6978 2021 3d20 2220 2229  f.suffix != " ")
+0001c910: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
+0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c930: 2020 2020 2020 2066 696c 654f 7661 6c5f         fileOval_
+0001c940: 6e6f 5f65 7874 5b2d 6c65 6e28 0a20 2020  no_ext[-len(.   
+0001c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c970: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001c980: 662e 7375 6666 6978 293a 5d20 3d3d 2073  f.suffix):] == s
+0001c990: 656c 662e 7375 6666 6978 0a20 2020 2020  elf.suffix.     
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9b0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9d0: 2020 6669 6c65 4f76 616c 5f6e 6f5f 6578    fileOval_no_ex
+0001c9e0: 7420 3d20 6669 6c65 4f76 616c 5f6e 6f5f  t = fileOval_no_
+0001c9f0: 6578 745b 3a2d 6c65 6e28 0a20 2020 2020  ext[:-len(.     
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001ca20: 7375 6666 6978 295d 0a0a 2020 2020 2020  suffix)]..      
+0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca40: 2020 6966 2028 7365 6c66 2e70 7265 6669    if (self.prefi
+0001ca50: 7820 213d 2022 2022 2920 616e 6420 280a  x != " ") and (.
+0001ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca80: 6669 6c65 4f76 616c 5f6e 6f5f 6578 745b  fileOval_no_ext[
+0001ca90: 303a 6c65 6e28 0a20 2020 2020 2020 2020  0:len(.         
+0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cab0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001cac0: 7072 6566 6978 295d 203d 3d20 7365 6c66  prefix)] == self
+0001cad0: 2e70 7265 6669 780a 2020 2020 2020 2020  .prefix.        
+0001cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001caf0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001cb00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001cb10: 696c 654f 7661 6c5f 6e6f 5f65 7874 203d  ileOval_no_ext =
+0001cb20: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
+0001cb30: 5b6c 656e 280a 2020 2020 2020 2020 2020  [len(.          
+0001cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb50: 2020 2020 2020 7365 6c66 2e70 7265 6669        self.prefi
+0001cb60: 7829 3a5d 0a20 2020 2020 2020 2020 2020  x):].           
+0001cb70: 2020 2020 2020 2020 2020 2020 2023 2066               # f
+0001cb80: 6d74 3a20 6f6e 0a20 2020 2020 2020 2020  mt: on.         
+0001cb90: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0001cba0: 2c20 6669 6c65 4976 616c 203d 206f 732e  , fileIval = os.
+0001cbb0: 7061 7468 2e73 706c 6974 2869 6e5f 7661  path.split(in_va
+0001cbc0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+0001cbd0: 2020 2020 2020 2020 2020 2066 696c 6549             fileI
+0001cbe0: 7661 6c5f 6e6f 5f65 7874 2c20 5f20 3d20  val_no_ext, _ = 
+0001cbf0: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
+0001cc00: 2866 696c 6549 7661 6c29 0a0a 2020 2020  (fileIval)..    
+0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc20: 2020 2020 2320 666d 743a 206f 6666 0a20      # fmt: off. 
+0001cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc40: 2020 2020 2020 2069 6620 2873 656c 662e         if (self.
+0001cc50: 7375 6666 6978 5f74 6f5f 6465 6c65 7465  suffix_to_delete
+0001cc60: 2021 3d20 2220 2229 2061 6e64 2028 0a20   != " ") and (. 
+0001cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc80: 2020 2020 2020 2020 2020 2066 696c 6549             fileI
+0001cc90: 7661 6c5f 6e6f 5f65 7874 5b2d 6c65 6e28  val_no_ext[-len(
+0001cca0: 7365 6c66 2e73 7566 6669 785f 746f 5f64  self.suffix_to_d
+0001ccb0: 656c 6574 6529 3a5d 0a20 2020 2020 2020  elete):].       
+0001ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccd0: 2020 2020 203d 3d20 7365 6c66 2e73 7566       == self.suf
+0001cce0: 6669 785f 746f 5f64 656c 6574 650a 2020  fix_to_delete.  
+0001ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd00: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0001cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd20: 2020 2020 2023 2066 6d74 3a20 6f6e 0a20       # fmt: on. 
+0001cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd40: 2020 2020 2020 2020 2020 2066 696c 654f             fileO
+0001cd50: 7661 6c5f 6e6f 5f65 7874 203d 2028 0a20  val_no_ext = (. 
+0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001cd80: 696c 654f 7661 6c5f 6e6f 5f65 7874 202b  ileOval_no_ext +
+0001cd90: 2073 656c 662e 7375 6666 6978 5f74 6f5f   self.suffix_to_
+0001cda0: 6465 6c65 7465 0a20 2020 2020 2020 2020  delete.         
+0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdc0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0001cdd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001cde0: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
+0001cdf0: 203d 3d20 6669 6c65 4976 616c 5f6e 6f5f   == fileIval_no_
+0001ce00: 6578 743a 0a0a 2020 2020 2020 2020 2020  ext:..          
+0001ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce20: 2020 6966 2067 6574 5f64 6246 6965 6c64    if get_dbField
+0001ce30: 5661 6c75 6528 0a20 2020 2020 2020 2020  Value(.         
+0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce50: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
+0001ce60: 6563 742c 2069 6e5f 7661 6c2c 2022 5061  ect, in_val, "Pa
+0001ce70: 7469 656e 744e 616d 6522 0a20 2020 2020  tientName".     
+0001ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce90: 2020 2020 2020 2029 2069 7320 4e6f 6e65         ) is None
+0001cea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cec0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cee0: 2020 2020 2020 2020 2020 2020 2022 5c6e               "\n
+0001cef0: 5265 7361 6d70 6c65 3120 6272 6963 6b3a  Resample1 brick:
+0001cf00: 5c6e 5468 6520 2750 6174 6965 6e74 4e61  \nThe 'PatientNa
+0001cf10: 6d65 2720 220a 2020 2020 2020 2020 2020  me' ".          
+0001cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf30: 2020 2020 2020 2020 2020 2274 6167 2063            "tag c
+0001cf40: 6f75 6c64 206e 6f74 2062 6520 6164 6465  ould not be adde
+0001cf50: 6420 746f 2074 6865 2064 6174 6162 6173  d to the databas
+0001cf60: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+0001cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf80: 2020 2020 2020 2020 2266 6f72 2074 6865          "for the
+0001cf90: 2027 7b7d 2720 7061 7261 6d65 7465 722e   '{}' parameter.
+0001cfa0: 2054 6869 7320 6361 6e20 6c65 6164 2074   This can lead t
+0001cfb0: 6f20 220a 2020 2020 2020 2020 2020 2020  o ".            
+0001cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfd0: 2020 2020 2020 2020 2261 2073 7562 7365          "a subse
+0001cfe0: 7175 656e 7420 6973 7375 6520 6475 7269  quent issue duri
+0001cff0: 6e67 2022 0a20 2020 2020 2020 2020 2020  ng ".           
+0001d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d010: 2020 2020 2020 2020 2022 696e 6974 6961           "initia
+0001d020: 6c69 7a61 7469 6f6e 2121 5c6e 222e 666f  lization!!\n".fo
+0001d030: 726d 6174 286f 7574 5f76 616c 290a 2020  rmat(out_val).  
+0001d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d050: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001d060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d070: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001d080: 662e 7461 6773 5f69 6e68 6572 6974 616e  f.tags_inheritan
+0001d090: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0b0: 2020 2020 696e 5f76 616c 2c0a 2020 2020      in_val,.    
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0001d0e0: 7661 6c2c 0a20 2020 2020 2020 2020 2020  val,.           
+0001d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d100: 2029 0a0a 2020 2020 2020 2020 2320 5265   )..        # Re
+0001d110: 7475 726e 2074 6865 2072 6571 7569 7265  turn the require
+0001d120: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
+0001d130: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
+0001d140: 6374 0a20 2020 2020 2020 2072 6574 7572  ct.        retur
+0001d150: 6e20 7365 6c66 2e6d 616b 655f 696e 6974  n self.make_init
+0001d160: 5265 7375 6c74 2829 0a0a 2020 2020 6465  Result()..    de
+0001d170: 6620 7275 6e5f 7072 6f63 6573 735f 6d69  f run_process_mi
+0001d180: 6128 7365 6c66 293a 0a20 2020 2020 2020  a(self):.       
+0001d190: 2022 2222 4465 6469 6361 7465 6420 746f   """Dedicated to
+0001d1a0: 2074 6865 2070 726f 6365 7373 206c 6175   the process lau
+0001d1b0: 6e63 6820 7374 6570 206f 6620 7468 6520  nch step of the 
+0001d1c0: 6272 6963 6b2e 2222 220a 2020 2020 2020  brick.""".      
+0001d1d0: 2020 7375 7065 7228 5265 7361 6d70 6c65    super(Resample
+0001d1e0: 312c 2073 656c 6629 2e72 756e 5f70 726f  1, self).run_pro
+0001d1f0: 6365 7373 5f6d 6961 2829 0a20 2020 2020  cess_mia().     
+0001d200: 2020 2066 696c 6573 5f6e 616d 6520 3d20     files_name = 
+0001d210: 7365 6c66 2e66 696c 6573 5f74 6f5f 7265  self.files_to_re
+0001d220: 7361 6d70 6c65 0a20 2020 2020 2020 2072  sample.        r
+0001d230: 6566 4e61 6d65 203d 206e 6962 2e6c 6f61  efName = nib.loa
+0001d240: 6428 7365 6c66 2e72 6566 6572 656e 6365  d(self.reference
+0001d250: 5f69 6d61 6765 290a 2020 2020 2020 2020  _image).        
+0001d260: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0001d270: 2020 2022 5c6e 5265 7361 6d70 6c65 3120     "\nResample1 
+0001d280: 7072 6f63 6573 7320 6672 6f6d 206d 6961  process from mia
+0001d290: 5f70 726f 6365 7373 6573 3a20 5c6e 222c  _processes: \n",
+0001d2a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001d2b0: 662e 696e 7465 7270 2c0a 2020 2020 2020  f.interp,.      
+0001d2c0: 2020 2020 2020 2220 5c6e 222c 0a20 2020        " \n",.   
+0001d2d0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0001d2e0: 666f 7220 6669 6c65 5f6e 616d 6520 696e  for file_name in
+0001d2f0: 2066 696c 6573 5f6e 616d 653a 0a20 2020   files_name:.   
+0001d300: 2020 2020 2020 2020 2066 696c 654e 616d           fileNam
+0001d310: 6520 3d20 6e69 622e 6c6f 6164 2866 696c  e = nib.load(fil
+0001d320: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+0001d330: 2020 2020 2320 4e6f 7465 206f 6e20 7265      # Note on re
+0001d340: 7361 6d70 6c69 6e67 3a0a 2020 2020 2020  sampling:.      
+0001d350: 2020 2020 2020 2320 2d2d 2d2d 2d2d 2d2d        # --------
+0001d360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+0001d370: 2020 2020 2020 2020 2320 736b 696d 6167          # skimag
+0001d380: 652e 7472 616e 7366 6f72 6d2e 7265 7369  e.transform.resi
+0001d390: 7a65 2028 646f 6573 206e 6f74 2073 6565  ze (does not see
+0001d3a0: 6d20 746f 2062 6520 7468 6520 6265 7374  m to be the best
+0001d3b0: 2073 6f6c 7574 696f 6e0a 2020 2020 2020   solution.      
+0001d3c0: 2020 2020 2020 2320 666f 7220 7265 7361        # for resa
+0001d3d0: 6d70 6c69 6e67 293a 0a20 2020 2020 2020  mpling):.       
+0001d3e0: 2020 2020 2023 202d 2042 2d73 706c 696e       # - B-splin
+0001d3f0: 6573 206f 6620 7468 6520 6f72 6465 7220  es of the order 
+0001d400: 3020 616e 6420 3120 636f 7272 6573 706f  0 and 1 correspo
+0001d410: 6e64 2074 6f20 6e65 6172 6573 7420 6e65  nd to nearest ne
+0001d420: 6967 6862 6f75 720a 2020 2020 2020 2020  ighbour.        
+0001d430: 2020 2020 2320 2020 616e 6420 6c69 6e65      #   and line
+0001d440: 6172 2069 6e74 6572 706f 6c61 7469 6f6e  ar interpolation
+0001d450: 2c20 7265 7370 6563 7469 7665 6c79 2e0a  , respectively..
+0001d460: 2020 2020 2020 2020 2020 2020 2320 2d20              # - 
+0001d470: 422d 7370 6c69 6e65 7320 6f66 2061 2068  B-splines of a h
+0001d480: 6967 6865 7220 6f72 6465 7220 6361 6e20  igher order can 
+0001d490: 6265 2064 6566 696e 6564 2062 7920 6120  be defined by a 
+0001d4a0: 7265 7065 7469 7469 7665 0a20 2020 2020  repetitive.     
+0001d4b0: 2020 2020 2020 2023 2020 2063 6f6e 766f         #   convo
+0001d4c0: 6c75 7469 6f6e 206f 6620 7468 6520 7a65  lution of the ze
+0001d4d0: 726f 7468 2d6f 7264 6572 2073 706c 696e  roth-order splin
+0001d4e0: 6520 2874 6865 2062 6f78 2066 756e 6374  e (the box funct
+0001d4f0: 696f 6e29 2077 6974 680a 2020 2020 2020  ion) with.      
+0001d500: 2020 2020 2020 2320 2020 6974 7365 6c66        #   itself
+0001d510: 2e0a 2020 2020 2020 2020 2020 2020 230a  ..            #.
+0001d520: 2020 2020 2020 2020 2020 2020 2320 6e69              # ni
+0001d530: 6261 6265 6c2e 7072 6f63 6573 7369 6e67  babel.processing
+0001d540: 2e72 6573 616d 706c 655f 6672 6f6d 5f74  .resample_from_t
+0001d550: 6f20 2873 6565 6d73 2074 6f20 6265 2061  o (seems to be a
+0001d560: 2067 6f6f 640a 2020 2020 2020 2020 2020   good.          
+0001d570: 2020 2320 736f 6c75 7469 6f6e 2c20 6275    # solution, bu
+0001d580: 7420 6361 6e20 6769 7665 206e 6f6e 2d7a  t can give non-z
+0001d590: 6572 6f20 696e 7465 6e73 6974 7920 666f  ero intensity fo
+0001d5a0: 7220 7468 6520 6261 636b 6772 6f75 6e64  r the background
+0001d5b0: 0a20 2020 2020 2020 2020 2020 2023 202d  .            # -
+0001d5c0: 3e20 6e65 6564 7320 7468 7265 736f 6c64  > needs thresold
+0001d5d0: 696e 6720 3f29 0a20 2020 2020 2020 2020  ing ?).         
+0001d5e0: 2020 2023 0a20 2020 2020 2020 2020 2020     #.           
+0001d5f0: 2023 206e 696c 6561 726e 2e69 6d61 6765   # nilearn.image
+0001d600: 2e72 6573 616d 706c 655f 746f 5f69 6d67  .resample_to_img
+0001d610: 2028 7365 656d 7320 746f 2062 6520 6120   (seems to be a 
+0001d620: 676f 6f64 2073 6f6c 7574 696f 6e2c 206e  good solution, n
+0001d630: 6f0a 2020 2020 2020 2020 2020 2020 2320  o.            # 
+0001d640: 6e6f 6e2d 7a65 726f 2069 6e74 656e 7369  non-zero intensi
+0001d650: 7479 2066 6f72 2074 6865 2062 6163 6b67  ty for the backg
+0001d660: 726f 756e 6420 6f62 7365 7276 6564 290a  round observed).
+0001d670: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+0001d680: 7572 7265 6e74 6c79 2c20 7265 7361 6d70  urrently, resamp
+0001d690: 6c69 6e67 2069 7320 6f6e 6c79 2064 6f6e  ling is only don
+0001d6a0: 6520 666f 7220 3344 2069 6d61 6765 7320  e for 3D images 
+0001d6b0: 7573 696e 6720 3344 0a20 2020 2020 2020  using 3D.       
+0001d6c0: 2020 2020 2023 206f 7220 3444 2069 6d61       # or 4D ima
+0001d6d0: 6765 7320 666f 7220 7265 6665 7265 6e63  ges for referenc
+0001d6e0: 652e 2049 7420 776f 756c 6420 6265 2069  e. It would be i
+0001d6f0: 6e74 6572 6573 7469 6e67 2074 6f20 7769  nteresting to wi
+0001d700: 6465 6e20 7468 650a 2020 2020 2020 2020  den the.        
+0001d710: 2020 2020 2320 706f 7373 6962 696c 6974      # possibilit
+0001d720: 6965 7320 746f 206d 6f72 6520 6361 7365  ies to more case
+0001d730: 7320 2861 7420 6c65 6173 7420 6120 3444  s (at least a 4D
+0001d740: 2075 7369 6e67 2061 2033 442c 2061 6e64   using a 3D, and
+0001d750: 2077 6879 0a20 2020 2020 2020 2020 2020   why.           
+0001d760: 2023 206e 6f74 2c20 746f 206c 6172 6765   # not, to large
+0001d770: 7220 6469 6d65 6e73 696f 6e73 3f29 2e20  r dimensions?). 
+0001d780: 4375 7272 656e 746c 792c 2077 6520 7573  Currently, we us
+0001d790: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+0001d7a0: 6e69 6c65 6172 6e2e 696d 6167 652e 7265  nilearn.image.re
+0001d7b0: 7361 6d70 6c65 5f74 6f5f 696d 6728 292c  sample_to_img(),
+0001d7c0: 2028 7365 650a 2020 2020 2020 2020 2020   (see.          
+0001d7d0: 2020 2320 6874 7470 733a 2f2f 6d61 696c    # https://mail
+0001d7e0: 2e70 7974 686f 6e2e 6f72 672f 7069 7065  .python.org/pipe
+0001d7f0: 726d 6169 6c2f 6e65 7572 6f69 6d61 6769  rmail/neuroimagi
+0001d800: 6e67 2f32 3031 392d 4a61 6e75 6172 792f  ng/2019-January/
+0001d810: 3030 3139 3032 2e68 746d 6c29 2e0a 0a20  001902.html)... 
+0001d820: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0001d830: 6e28 6669 6c65 4e61 6d65 2e73 6861 7065  n(fileName.shape
+0001d840: 2920 3d3d 206c 656e 2872 6566 4e61 6d65  ) == len(refName
+0001d850: 2e73 6861 7065 2920 3d3d 2033 3a0a 2020  .shape) == 3:.  
+0001d860: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0001d870: 6c65 4669 6e61 6c20 3d20 7265 7361 6d70  leFinal = resamp
+0001d880: 6c65 5f74 6f5f 696d 6728 0a20 2020 2020  le_to_img(.     
+0001d890: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001d8a0: 696c 654e 616d 652c 2072 6566 4e61 6d65  ileName, refName
+0001d8b0: 2c20 696e 7465 7270 6f6c 6174 696f 6e3d  , interpolation=
+0001d8c0: 7365 6c66 2e69 6e74 6572 700a 2020 2020  self.interp.    
+0001d8d0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0001d8e0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0001d8f0: 6e28 6669 6c65 4e61 6d65 2e73 6861 7065  n(fileName.shape
+0001d900: 2920 3d3d 2033 2061 6e64 206c 656e 2872  ) == 3 and len(r
+0001d910: 6566 4e61 6d65 2e73 6861 7065 2920 3d3d  efName.shape) ==
+0001d920: 2034 3a0a 2020 2020 2020 2020 2020 2020   4:.            
+0001d930: 2020 2020 6669 6c65 4669 6e61 6c20 3d20      fileFinal = 
+0001d940: 7265 7361 6d70 6c65 5f74 6f5f 696d 6728  resample_to_img(
+0001d950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d960: 2020 2020 2066 696c 654e 616d 652c 0a20       fileName,. 
+0001d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d980: 2020 2072 6566 4e61 6d65 2e73 6c69 6365     refName.slice
+0001d990: 725b 3a2c 203a 2c20 3a2c 2030 5d2c 0a20  r[:, :, :, 0],. 
+0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9b0: 2020 2069 6e74 6572 706f 6c61 7469 6f6e     interpolation
+0001d9c0: 3d73 656c 662e 696e 7465 7270 2c0a 2020  =self.interp,.  
+0001d9d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001d9e0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+0001d9f0: 6d61 6765 2073 6176 650a 2020 2020 2020  mage save.      
+0001da00: 2020 2020 2020 7061 7468 2c20 6669 6c65        path, file
+0001da10: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
+0001da20: 7370 6c69 7428 6669 6c65 5f6e 616d 6529  split(file_name)
+0001da30: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+0001da40: 655f 6e61 6d65 5f6e 6f5f 6578 742c 2066  e_name_no_ext, f
+0001da50: 696c 655f 6578 7465 6e73 696f 6e20 3d20  ile_extension = 
+0001da60: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
+0001da70: 2866 696c 655f 6e61 6d65 290a 0a20 2020  (file_name)..   
+0001da80: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
+0001da90: 6f66 660a 2020 2020 2020 2020 2020 2020  off.            
+0001daa0: 6966 2028 7365 6c66 2e73 7566 6669 785f  if (self.suffix_
+0001dab0: 746f 5f64 656c 6574 6520 213d 2022 2022  to_delete != " "
+0001dac0: 2920 616e 6420 280a 2020 2020 2020 2020  ) and (.        
+0001dad0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+0001dae0: 655f 6e6f 5f65 7874 5b2d 6c65 6e28 7365  e_no_ext[-len(se
+0001daf0: 6c66 2e73 7566 6669 785f 746f 5f64 656c  lf.suffix_to_del
+0001db00: 6574 6529 3a5d 0a20 2020 2020 2020 2020  ete):].         
+0001db10: 2020 2020 2020 203d 3d20 7365 6c66 2e73         == self.s
+0001db20: 7566 6669 785f 746f 5f64 656c 6574 650a  uffix_to_delete.
+0001db30: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+0001db40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001db50: 2066 6d74 3a20 6f6e 0a20 2020 2020 2020   fmt: on.       
+0001db60: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
+0001db70: 6d65 5f6e 6f5f 6578 7420 3d20 6669 6c65  me_no_ext = file
+0001db80: 5f6e 616d 655f 6e6f 5f65 7874 5b0a 2020  _name_no_ext[.  
+0001db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dba0: 2020 3a20 2d6c 656e 2873 656c 662e 7375    : -len(self.su
+0001dbb0: 6666 6978 5f74 6f5f 6465 6c65 7465 290a  ffix_to_delete).
+0001dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbd0: 5d0a 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+0001dbe0: 696c 655f 6f75 7420 3d20 6f73 2e70 6174  ile_out = os.pat
+0001dbf0: 682e 6a6f 696e 280a 2020 2020 2020 2020  h.join(.        
+0001dc00: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
+0001dc10: 7075 745f 6469 7265 6374 6f72 792c 0a20  put_directory,. 
+0001dc20: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001dc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dc40: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
+0001dc50: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+0001dc60: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+0001dc70: 696c 655f 6e61 6d65 5f6e 6f5f 6578 740a  ile_name_no_ext.
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc90: 2020 2020 2b20 7365 6c66 2e73 7566 6669      + self.suffi
+0001dca0: 782e 7374 7269 7028 290a 2020 2020 2020  x.strip().      
+0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001dcc0: 6669 6c65 5f65 7874 656e 7369 6f6e 0a20  file_extension. 
+0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001dce0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0001dcf0: 2020 2020 2020 2020 2020 2020 6e69 622e              nib.
+0001dd00: 7361 7665 2866 696c 6546 696e 616c 2c20  save(fileFinal, 
+0001dd10: 6669 6c65 5f6f 7574 290a 0a0a 636c 6173  file_out)...clas
+0001dd20: 7320 5265 7361 6d70 6c65 3228 5072 6f63  s Resample2(Proc
+0001dd30: 6573 734d 4941 293a 0a20 2020 2022 2222  essMIA):.    """
+0001dd40: 0a20 2020 202a 5265 7361 6d70 6c65 7320  .    *Resamples 
+0001dd50: 696d 6167 6573 2074 6f20 7468 6520 7265  images to the re
+0001dd60: 736f 6c75 7469 6f6e 206f 6620 6120 7265  solution of a re
+0001dd70: 6665 7265 6e63 6520 696d 6167 652a 0a0a  ference image*..
+0001dd80: 2020 2020 2d20 5573 6573 206e 696c 6561      - Uses nilea
+0001dd90: 726e 2e69 6d61 6765 2e72 6573 616d 706c  rn.image.resampl
+0001dda0: 655f 746f 5f69 6d67 2829 2e0a 2020 2020  e_to_img()..    
+0001ddb0: 2d20 5468 6520 6f75 7470 7574 5f64 6972  - The output_dir
+0001ddc0: 6563 746f 7279 2f50 6174 6965 6e74 4e61  ectory/PatientNa
+0001ddd0: 6d65 5f64 6174 612f 524f 495f 6461 7461  me_data/ROI_data
+0001dde0: 2f63 6f6e 7652 4f49 5f42 4f4c 4432 2064  /convROI_BOLD2 d
+0001ddf0: 6972 6563 746f 7279 2069 730a 2020 2020  irectory is.    
+0001de00: 2020 6372 6561 7465 6420 746f 2072 6563    created to rec
+0001de10: 6569 7665 2074 6865 2072 6573 616d 706c  eive the resampl
+0001de20: 6564 2069 6d61 6765 732e 2049 6620 7468  ed images. If th
+0001de30: 6973 2064 6972 6563 746f 7279 2065 7869  is directory exi
+0001de40: 7374 7320 6174 0a20 2020 2020 2072 756e  sts at.      run
+0001de50: 7469 6d65 2069 7420 6973 2064 656c 6574  time it is delet
+0001de60: 6564 2e0a 2020 2020 2d20 546f 2077 6f72  ed..    - To wor
+0001de70: 6b20 636f 7272 6563 746c 792c 2074 6865  k correctly, the
+0001de80: 2064 6174 6162 6173 6520 656e 7472 7920   database entry 
+0001de90: 666f 7220 7468 6520 7265 6665 7265 6e63  for the referenc
+0001dea0: 655f 696d 6167 6520 7061 7261 6d65 7465  e_image paramete
+0001deb0: 720a 2020 2020 2020 6d75 7374 2068 6176  r.      must hav
+0001dec0: 6520 7468 6520 2250 6174 6965 6e74 4e61  e the "PatientNa
+0001ded0: 6d65 2220 7461 6720 6669 6c6c 6564 2069  me" tag filled i
+0001dee0: 6e2e 0a0a 2020 2020 506c 6561 7365 2c20  n...    Please, 
+0001def0: 7365 6520 7468 6520 636f 6d70 6c65 7465  see the complete
+0001df00: 2064 6f63 756d 656e 7461 7469 6f6e 2066   documentation f
+0001df10: 6f72 2074 6865 0a20 2020 2060 5265 7361  or the.    `Resa
+0001df20: 6d70 6c65 3220 6272 6963 6b20 696e 2074  mple2 brick in t
+0001df30: 6865 206d 6961 5f70 726f 6365 7373 6573  he mia_processes
+0001df40: 2077 6562 7369 7465 0a20 2020 203c 6874   website.    <ht
+0001df50: 7470 733a 2f2f 706f 7075 6c73 652e 6769  tps://populse.gi
+0001df60: 7468 7562 2e69 6f2f 6d69 615f 7072 6f63  thub.io/mia_proc
+0001df70: 6573 7365 732f 6874 6d6c 2f64 6f63 756d  esses/html/docum
+0001df80: 656e 7461 7469 6f6e 2f62 7269 636b 732f  entation/bricks/
+0001df90: 7072 6570 726f 6365 7373 2f6f 7468 6572  preprocess/other
+0001dfa0: 2f52 6573 616d 706c 6532 2e68 746d 6c3e  /Resample2.html>
+0001dfb0: 605f 0a20 2020 2022 2222 0a0a 2020 2020  `_.    """..    
+0001dfc0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001dfd0: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
+0001dfe0: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
+0001dff0: 6174 7472 6962 7574 6573 2069 6e69 7469  attributes initi
+0001e000: 616c 6973 6174 696f 6e2f 696e 7374 616e  alisation/instan
+0001e010: 7469 6174 696f 6e2e 0a0a 2020 2020 2020  tiation...      
+0001e020: 2020 5468 6520 696e 7075 7420 616e 6420    The input and 
+0001e030: 6f75 7470 7574 2070 6c75 6773 2061 7265  output plugs are
+0001e040: 2064 6566 696e 6564 2068 6572 652e 2054   defined here. T
+0001e050: 6865 2073 7065 6369 616c 0a20 2020 2020  he special.     
+0001e060: 2020 2027 7365 6c66 2e72 6571 7569 7265     'self.require
+0001e070: 6d65 6e74 2720 6174 7472 6962 7574 6520  ment' attribute 
+0001e080: 286f 7074 696f 6e61 6c29 2069 7320 7573  (optional) is us
+0001e090: 6564 2074 6f20 6465 6669 6e65 2074 6865  ed to define the
+0001e0a0: 0a20 2020 2020 2020 2074 6869 7264 2d70  .        third-p
+0001e0b0: 6172 7479 2070 726f 6475 6374 7320 6e65  arty products ne
+0001e0c0: 6365 7373 6172 7920 666f 7220 7468 6520  cessary for the 
+0001e0d0: 7275 6e6e 696e 6720 6f66 2074 6865 2062  running of the b
+0001e0e0: 7269 636b 2e0a 2020 2020 2020 2020 2222  rick..        ""
+0001e0f0: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
+0001e100: 5265 7361 6d70 6c65 322c 2073 656c 6629  Resample2, self)
+0001e110: 2e5f 5f69 6e69 745f 5f28 290a 0a20 2020  .__init__()..   
+0001e120: 2020 2020 2023 2049 6e70 7574 7320 6465       # Inputs de
+0001e130: 7363 7269 7074 696f 6e0a 2020 2020 2020  scription.      
+0001e140: 2020 6669 6c65 735f 746f 5f72 6573 616d    files_to_resam
+0001e150: 706c 655f 6465 7363 203d 2028 0a20 2020  ple_desc = (.   
+0001e160: 2020 2020 2020 2020 2022 5468 6520 696d           "The im
+0001e170: 6167 6573 2074 6861 7420 7769 6c6c 2062  ages that will b
+0001e180: 6520 7265 7361 6d70 6c65 6420 2861 2022  e resampled (a "
+0001e190: 0a20 2020 2020 2020 2020 2020 2022 6c69  .            "li
+0001e1a0: 7374 206f 6620 7061 7468 6c69 6b65 206f  st of pathlike o
+0001e1b0: 626a 6563 7420 6f72 2073 7472 696e 6720  bject or string 
+0001e1c0: 220a 2020 2020 2020 2020 2020 2020 2272  ".            "r
+0001e1d0: 6570 7265 7365 6e74 696e 6720 6120 6669  epresenting a fi
+0001e1e0: 6c65 206f 7220 6120 6c69 7374 206f 6620  le or a list of 
+0001e1f0: 6974 656d 7320 220a 2020 2020 2020 2020  items ".        
+0001e200: 2020 2020 2277 6869 6368 2061 7265 2061      "which are a
+0001e210: 2070 6174 686c 696b 6520 6f62 6a65 6374   pathlike object
+0001e220: 206f 7220 7374 7269 6e67 2022 0a20 2020   or string ".   
+0001e230: 2020 2020 2020 2020 2022 7265 7072 6573           "repres
+0001e240: 656e 7469 6e67 2061 2066 696c 652c 2076  enting a file, v
+0001e250: 616c 6964 2065 7874 656e 7369 6f6e 733a  alid extensions:
+0001e260: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+0001e270: 5b2e 696d 672c 202e 6e69 692c 202e 6864  [.img, .nii, .hd
+0001e280: 725d 292e 220a 2020 2020 2020 2020 290a  r]).".        ).
+0001e290: 0a20 2020 2020 2020 2072 6566 6572 656e  .        referen
+0001e2a0: 6365 5f69 6d61 6765 5f64 6573 6320 3d20  ce_image_desc = 
+0001e2b0: 280a 2020 2020 2020 2020 2020 2020 2254  (.            "T
+0001e2c0: 6865 2072 6566 6572 656e 6365 2069 6d61  he reference ima
+0001e2d0: 6765 2066 6f72 2072 6573 616d 706c 696e  ge for resamplin
+0001e2e0: 6720 2861 6e20 220a 2020 2020 2020 2020  g (an ".        
+0001e2f0: 2020 2020 2265 7869 7374 696e 672c 2075      "existing, u
+0001e300: 6e63 6f6d 7072 6573 7365 6420 6669 6c65  ncompressed file
+0001e310: 2922 0a20 2020 2020 2020 2029 0a0a 2020  )".        )..  
+0001e320: 2020 2020 2020 7375 6666 6978 5f64 6573        suffix_des
+0001e330: 6320 3d20 2254 6865 2073 7566 6669 7820  c = "The suffix 
+0001e340: 666f 7220 7468 6520 6f75 745f 696d 6167  for the out_imag
+0001e350: 6573 2028 6120 7374 7269 6e67 2922 0a0a  es (a string)"..
+0001e360: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
+0001e370: 7320 6465 7363 7269 7074 696f 6e0a 2020  s description.  
+0001e380: 2020 2020 2020 6f75 745f 696d 6167 6573        out_images
+0001e390: 5f64 6573 6320 3d20 2254 6865 2072 6573  _desc = "The res
+0001e3a0: 616d 706c 6564 2069 6d61 6765 7322 0a0a  ampled images"..
+0001e3b0: 2020 2020 2020 2020 2320 496e 7075 7473          # Inputs
+0001e3c0: 2074 7261 6974 730a 2020 2020 2020 2020   traits.        
+0001e3d0: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+0001e3e0: 2020 2020 2020 2020 2020 2020 2266 696c              "fil
+0001e3f0: 6573 5f74 6f5f 7265 7361 6d70 6c65 222c  es_to_resample",
+0001e400: 0a20 2020 2020 2020 2020 2020 2049 6e70  .            Inp
+0001e410: 7574 4d75 6c74 6950 6174 6828 0a20 2020  utMultiPath(.   
+0001e420: 2020 2020 2020 2020 2020 2020 2049 6d61               Ima
+0001e430: 6765 4669 6c65 5350 4d28 292c 206f 7574  geFileSPM(), out
+0001e440: 7075 743d 4661 6c73 652c 2064 6573 633d  put=False, desc=
+0001e450: 6669 6c65 735f 746f 5f72 6573 616d 706c  files_to_resampl
+0001e460: 655f 6465 7363 0a20 2020 2020 2020 2020  e_desc.         
+0001e470: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+0001e480: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+0001e490: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+0001e4a0: 2020 2020 2022 7265 6665 7265 6e63 655f       "reference_
+0001e4b0: 696d 6167 6522 2c0a 2020 2020 2020 2020  image",.        
+0001e4c0: 2020 2020 496d 6167 6546 696c 6553 504d      ImageFileSPM
+0001e4d0: 286f 7574 7075 743d 4661 6c73 652c 2064  (output=False, d
+0001e4e0: 6573 633d 7265 6665 7265 6e63 655f 696d  esc=reference_im
+0001e4f0: 6167 655f 6465 7363 292c 0a20 2020 2020  age_desc),.     
+0001e500: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+0001e510: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
+0001e520: 2020 2020 2020 2020 2020 2273 7566 6669            "suffi
+0001e530: 7822 2c0a 2020 2020 2020 2020 2020 2020  x",.            
+0001e540: 7472 6169 7473 2e53 7472 696e 6728 225f  traits.String("_
+0001e550: 3222 2c20 6f75 7470 7574 3d46 616c 7365  2", output=False
+0001e560: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
+0001e570: 2064 6573 633d 7375 6666 6978 5f64 6573   desc=suffix_des
+0001e580: 6329 2c0a 2020 2020 2020 2020 290a 0a20  c),.        ).. 
+0001e590: 2020 2020 2020 2023 204f 7574 7075 7473         # Outputs
+0001e5a0: 2074 7261 6974 730a 2020 2020 2020 2020   traits.        
+0001e5b0: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+0001e5c0: 2020 2020 2020 2020 2020 2020 226f 7574              "out
+0001e5d0: 5f69 6d61 6765 7322 2c0a 2020 2020 2020  _images",.      
+0001e5e0: 2020 2020 2020 4f75 7470 7574 4d75 6c74        OutputMult
+0001e5f0: 6950 6174 6828 4669 6c65 2829 2c20 6f75  iPath(File(), ou
+0001e600: 7470 7574 3d54 7275 652c 2064 6573 633d  tput=True, desc=
+0001e610: 6f75 745f 696d 6167 6573 5f64 6573 6329  out_images_desc)
+0001e620: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0001e630: 2020 2020 2023 2053 7065 6369 616c 2070       # Special p
+0001e640: 6172 616d 6574 6572 2075 7365 6420 6173  arameter used as
+0001e650: 2061 206d 6573 7365 6e67 6572 2066 6f72   a messenger for
+0001e660: 2074 6865 2072 756e 5f70 726f 6365 7373   the run_process
+0001e670: 5f6d 6961 206d 6574 686f 640a 2020 2020  _mia method.    
+0001e680: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
+0001e690: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+0001e6a0: 2264 6963 7434 7275 6e74 696d 6522 2c0a  "dict4runtime",.
+0001e6b0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+0001e6c0: 7473 2e44 6963 7428 6f75 7470 7574 3d46  ts.Dict(output=F
+0001e6d0: 616c 7365 2c20 6f70 7469 6f6e 616c 3d54  alse, optional=T
+0001e6e0: 7275 652c 2075 7365 726c 6576 656c 3d31  rue, userlevel=1
+0001e6f0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+0001e700: 2020 2020 2020 7365 6c66 2e69 6e69 745f        self.init_
+0001e710: 6465 6661 756c 745f 7472 6169 7473 2829  default_traits()
+0001e720: 0a0a 2020 2020 6465 6620 6c69 7374 5f6f  ..    def list_o
+0001e730: 7574 7075 7473 2873 656c 662c 2069 735f  utputs(self, is_
+0001e740: 706c 7567 6765 643d 4e6f 6e65 293a 0a20  plugged=None):. 
+0001e750: 2020 2020 2020 2022 2222 4465 6469 6361         """Dedica
+0001e760: 7465 6420 746f 2074 6865 2069 6e69 7469  ted to the initi
+0001e770: 616c 6973 6174 696f 6e20 7374 6570 206f  alisation step o
+0001e780: 6620 7468 6520 6272 6963 6b2e 0a0a 2020  f the brick...  
+0001e790: 2020 2020 2020 5468 6520 6d61 696e 206f        The main o
+0001e7a0: 626a 6563 7469 7665 206f 6620 7468 6973  bjective of this
+0001e7b0: 206d 6574 686f 6420 6973 2074 6f20 7072   method is to pr
+0001e7c0: 6f64 7563 6520 7468 6520 6f75 7470 7574  oduce the output
+0001e7d0: 7320 6f66 2074 6865 0a20 2020 2020 2020  s of the.       
+0001e7e0: 2062 7269 636b 7320 2873 656c 662e 6f75   bricks (self.ou
+0001e7f0: 7470 7574 7329 2061 6e64 2074 6865 2061  tputs) and the a
+0001e800: 7373 6f63 6961 7465 6420 7461 6773 2028  ssociated tags (
+0001e810: 7365 6c66 2e69 6e68 6572 6974 616e 6365  self.inheritance
+0001e820: 5f64 6963 292c 0a20 2020 2020 2020 2069  _dic),.        i
+0001e830: 6620 6465 6669 6e65 6420 6865 7265 2e20  f defined here. 
+0001e840: 496e 206f 7264 6572 206e 6f74 2074 6f20  In order not to 
+0001e850: 696e 636c 7564 6520 616e 206f 7574 7075  include an outpu
+0001e860: 7420 696e 2074 6865 2064 6174 6162 6173  t in the databas
+0001e870: 652c 0a20 2020 2020 2020 2074 6869 7320  e,.        this 
+0001e880: 6f75 7470 7574 206d 7573 7420 6265 2061  output must be a
+0001e890: 2076 616c 7565 206f 6620 7468 6520 6f70   value of the op
+0001e8a0: 7469 6f6e 616c 206b 6579 2027 6e6f 7449  tional key 'notI
+0001e8b0: 6e44 6227 206f 6620 7468 650a 2020 2020  nDb' of the.    
+0001e8c0: 2020 2020 7365 6c66 2e6f 7574 7075 7473      self.outputs
+0001e8d0: 2064 6963 7469 6f6e 6172 792e 2054 6f20   dictionary. To 
+0001e8e0: 776f 726b 2070 726f 7065 726c 7920 7468  work properly th
+0001e8f0: 6973 206d 6574 686f 6420 6d75 7374 2072  is method must r
+0001e900: 6574 7572 6e0a 2020 2020 2020 2020 7365  eturn.        se
+0001e910: 6c66 2e6d 616b 655f 696e 6974 5265 7375  lf.make_initResu
+0001e920: 6c74 2829 206f 626a 6563 742e 0a0a 2020  lt() object...  
+0001e930: 2020 2020 2020 3a70 6172 616d 2069 735f        :param is_
+0001e940: 706c 7567 6765 643a 2074 6865 2073 7461  plugged: the sta
+0001e950: 7465 2c20 6c69 6e6b 6564 206f 7220 6e6f  te, linked or no
+0001e960: 742c 206f 6620 7468 6520 706c 7567 732e  t, of the plugs.
+0001e970: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0001e980: 733a 2061 2064 6963 7469 6f6e 6172 7920  s: a dictionary 
+0001e990: 7769 7468 2072 6571 7569 7265 6d65 6e74  with requirement
+0001e9a0: 2c20 6f75 7470 7574 7320 616e 6420 696e  , outputs and in
+0001e9b0: 6865 7269 7461 6e63 655f 6469 6374 2e0a  heritance_dict..
+0001e9c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001e9d0: 2020 2020 2320 5573 696e 6720 7468 6520      # Using the 
+0001e9e0: 696e 6865 7269 7461 6e63 6520 746f 2050  inheritance to P
+0001e9f0: 726f 6365 7373 4d49 4120 636c 6173 732c  rocessMIA class,
+0001ea00: 206c 6973 745f 6f75 7470 7574 7320 6d65   list_outputs me
+0001ea10: 7468 6f64 0a20 2020 2020 2020 2073 7570  thod.        sup
+0001ea20: 6572 2852 6573 616d 706c 6532 2c20 7365  er(Resample2, se
+0001ea30: 6c66 292e 6c69 7374 5f6f 7574 7075 7473  lf).list_outputs
+0001ea40: 2829 0a0a 2020 2020 2020 2020 2320 4f75  ()..        # Ou
+0001ea50: 7470 7574 7320 6465 6669 6e69 7469 6f6e  tputs definition
+0001ea60: 2061 6e64 2074 6167 7320 696e 6865 7269   and tags inheri
+0001ea70: 7461 6e63 6520 286f 7074 696f 6e61 6c29  tance (optional)
+0001ea80: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
+0001ea90: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+0001eaa0: 696c 6573 5f74 6f5f 7265 7361 6d70 6c65  iles_to_resample
+0001eab0: 2021 3d20 556e 6465 6669 6e65 640a 2020   != Undefined.  
+0001eac0: 2020 2020 2020 2020 2020 616e 6420 7365            and se
+0001ead0: 6c66 2e72 6566 6572 656e 6365 5f69 6d61  lf.reference_ima
+0001eae0: 6765 2021 3d20 556e 6465 6669 6e65 640a  ge != Undefined.
+0001eaf0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+0001eb00: 2020 2020 2020 2070 6174 6965 6e74 5f6e         patient_n
+0001eb10: 616d 6520 3d20 6765 745f 6462 4669 656c  ame = get_dbFiel
+0001eb20: 6456 616c 7565 280a 2020 2020 2020 2020  dValue(.        
+0001eb30: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+0001eb40: 6a65 6374 2c20 7365 6c66 2e72 6566 6572  ject, self.refer
+0001eb50: 656e 6365 5f69 6d61 6765 2c20 2250 6174  ence_image, "Pat
+0001eb60: 6965 6e74 4e61 6d65 220a 2020 2020 2020  ientName".      
+0001eb70: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0001eb80: 2020 2020 2069 6620 7061 7469 656e 745f       if patient_
+0001eb90: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
+0001eba0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001ebb0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0001ebc0: 2020 2020 2020 2020 2022 5c6e 5265 7361           "\nResa
+0001ebd0: 6d70 6c65 3220 6272 6963 6b3a 5c6e 2054  mple2 brick:\n T
+0001ebe0: 6865 2050 6174 6965 6e74 4e61 6d65 2074  he PatientName t
+0001ebf0: 6167 2069 7320 6e6f 7420 6669 6c6c 6564  ag is not filled
+0001ec00: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0001ec10: 2020 2020 2020 2022 696e 2074 6865 2064         "in the d
+0001ec20: 6174 6162 6173 6520 666f 7220 7468 6520  atabase for the 
+0001ec30: 7b7d 2066 696c 6520 2e2e 2e5c 6e20 5468  {} file ...\n Th
+0001ec40: 6520 6361 6c63 756c 6174 696f 6e22 0a20  e calculation". 
+0001ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec60: 2020 2022 6973 2061 626f 7274 6564 2e2e     "is aborted..
+0001ec70: 2e22 2e66 6f72 6d61 7428 7365 6c66 2e72  .".format(self.r
+0001ec80: 6566 6572 656e 6365 5f69 6d61 6765 290a  eference_image).
+0001ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ecb0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+0001ecc0: 6b65 5f69 6e69 7452 6573 756c 7428 290a  ke_initResult().
+0001ecd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001ece0: 662e 6469 6374 3472 756e 7469 6d65 5b22  f.dict4runtime["
+0001ecf0: 7061 7469 656e 745f 6e61 6d65 225d 203d  patient_name"] =
+0001ed00: 2070 6174 6965 6e74 5f6e 616d 650a 2020   patient_name.  
+0001ed10: 2020 2020 2020 2020 2020 636f 6e76 5f64            conv_d
+0001ed20: 6972 3220 3d20 6f73 2e70 6174 682e 6a6f  ir2 = os.path.jo
+0001ed30: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
+0001ed40: 2020 2020 7365 6c66 2e6f 7574 7075 745f      self.output_
+0001ed50: 6469 7265 6374 6f72 792c 0a20 2020 2020  directory,.     
+0001ed60: 2020 2020 2020 2020 2020 2070 6174 6965             patie
+0001ed70: 6e74 5f6e 616d 6520 2b20 225f 6461 7461  nt_name + "_data
+0001ed80: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0001ed90: 2020 2022 524f 495f 6461 7461 222c 0a20     "ROI_data",. 
+0001eda0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001edb0: 636f 6e76 524f 495f 424f 4c44 3222 2c0a  convROI_BOLD2",.
+0001edc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001edd0: 2020 2020 2020 2020 2020 6c69 7374 5f6f            list_o
+0001ede0: 7574 203d 205b 5d0a 0a20 2020 2020 2020  ut = []..       
+0001edf0: 2020 2020 2066 6f72 2072 6f69 5f66 696c       for roi_fil
+0001ee00: 6520 696e 2073 656c 662e 6669 6c65 735f  e in self.files_
+0001ee10: 746f 5f72 6573 616d 706c 653a 0a20 2020  to_resample:.   
+0001ee20: 2020 2020 2020 2020 2020 2020 206f 7574               out
+0001ee30: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
+0001ee40: 6261 7365 6e61 6d65 2872 6f69 5f66 696c  basename(roi_fil
+0001ee50: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001ee60: 2020 206f 7574 5f66 696c 655f 6e6f 5f65     out_file_no_e
+0001ee70: 7874 2c20 6669 6c65 5f65 7874 656e 7369  xt, file_extensi
+0001ee80: 6f6e 203d 206f 732e 7061 7468 2e73 706c  on = os.path.spl
+0001ee90: 6974 6578 7428 6f75 745f 6669 6c65 290a  itext(out_file).
+0001eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eeb0: 6f75 745f 6669 6c65 203d 206f 7574 5f66  out_file = out_f
+0001eec0: 696c 655f 6e6f 5f65 7874 202b 2073 656c  ile_no_ext + sel
+0001eed0: 662e 7375 6666 6978 202b 2066 696c 655f  f.suffix + file_
+0001eee0: 6578 7465 6e73 696f 6e0a 2020 2020 2020  extension.      
+0001eef0: 2020 2020 2020 2020 2020 6f75 745f 6669            out_fi
+0001ef00: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
+0001ef10: 6e28 636f 6e76 5f64 6972 322c 206f 7574  n(conv_dir2, out
+0001ef20: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
+0001ef30: 2020 2020 2020 206c 6973 745f 6f75 742e         list_out.
+0001ef40: 6170 7065 6e64 286f 7574 5f66 696c 6529  append(out_file)
+0001ef50: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0001ef60: 6c66 2e6f 7574 7075 7473 5b22 6f75 745f  lf.outputs["out_
+0001ef70: 696d 6167 6573 225d 203d 206c 6973 745f  images"] = list_
+0001ef80: 6f75 740a 2020 2020 2020 2020 2020 2020  out.            
+0001ef90: 2320 4649 584d 453a 2057 6861 7420 6172  # FIXME: What ar
+0001efa0: 6520 7765 2064 6f69 6e67 2061 626f 7574  e we doing about
+0001efb0: 2074 6865 2074 6167 7320 696e 6865 7269   the tags inheri
+0001efc0: 7461 6e63 653f 0a0a 2020 2020 2020 2020  tance?..        
+0001efd0: 2320 5265 7475 726e 2074 6865 2072 6571  # Return the req
+0001efe0: 7569 7265 6d65 6e74 2c20 6f75 7470 7574  uirement, output
+0001eff0: 7320 616e 6420 696e 6865 7269 7461 6e63  s and inheritanc
+0001f000: 655f 6469 6374 0a20 2020 2020 2020 2072  e_dict.        r
+0001f010: 6574 7572 6e20 7365 6c66 2e6d 616b 655f  eturn self.make_
+0001f020: 696e 6974 5265 7375 6c74 2829 0a0a 2020  initResult()..  
+0001f030: 2020 6465 6620 7275 6e5f 7072 6f63 6573    def run_proces
+0001f040: 735f 6d69 6128 7365 6c66 293a 0a20 2020  s_mia(self):.   
+0001f050: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
+0001f060: 6420 746f 2074 6865 2070 726f 6365 7373  d to the process
+0001f070: 206c 6175 6e63 6820 7374 6570 206f 6620   launch step of 
+0001f080: 7468 6520 6272 6963 6b2e 2222 220a 0a20  the brick.""".. 
+0001f090: 2020 2020 2020 2023 204e 6f20 6e65 6564         # No need
+0001f0a0: 2074 6865 206e 6578 7420 6c69 6e65 2028   the next line (
+0001f0b0: 7765 2064 6f6e 2774 2075 7365 2073 656c  we don't use sel
+0001f0c0: 662e 7072 6f63 6573 7320 6574 2053 504d  f.process et SPM
+0001f0d0: 290a 2020 2020 2020 2020 2320 7375 7065  ).        # supe
+0001f0e0: 7228 5265 7361 6d70 6c65 322c 2073 656c  r(Resample2, sel
+0001f0f0: 6629 2e72 756e 5f70 726f 6365 7373 5f6d  f).run_process_m
+0001f100: 6961 2829 0a0a 2020 2020 2020 2020 7061  ia()..        pa
+0001f110: 745f 6e61 6d65 5f64 6972 203d 206f 732e  t_name_dir = os.
+0001f120: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
+0001f130: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
+0001f140: 7574 5f64 6972 6563 746f 7279 2c20 7365  ut_directory, se
+0001f150: 6c66 2e64 6963 7434 7275 6e74 696d 655b  lf.dict4runtime[
+0001f160: 2270 6174 6965 6e74 5f6e 616d 6522 5d20  "patient_name"] 
+0001f170: 2b20 225f 6461 7461 220a 2020 2020 2020  + "_data".      
+0001f180: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+0001f190: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+0001f1a0: 7473 2870 6174 5f6e 616d 655f 6469 7229  ts(pat_name_dir)
+0001f1b0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+0001f1c0: 2e6d 6b64 6972 2870 6174 5f6e 616d 655f  .mkdir(pat_name_
+0001f1d0: 6469 7229 0a0a 2020 2020 2020 2020 726f  dir)..        ro
+0001f1e0: 695f 6461 7461 5f64 6972 203d 206f 732e  i_data_dir = os.
+0001f1f0: 7061 7468 2e6a 6f69 6e28 7061 745f 6e61  path.join(pat_na
+0001f200: 6d65 5f64 6972 2c20 2252 4f49 5f64 6174  me_dir, "ROI_dat
+0001f210: 6122 290a 0a20 2020 2020 2020 2069 6620  a")..        if 
+0001f220: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+0001f230: 7473 2872 6f69 5f64 6174 615f 6469 7229  ts(roi_data_dir)
+0001f240: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+0001f250: 2e6d 6b64 6972 2872 6f69 5f64 6174 615f  .mkdir(roi_data_
+0001f260: 6469 7229 0a0a 2020 2020 2020 2020 636f  dir)..        co
+0001f270: 6e76 5f64 6972 3220 3d20 6f73 2e70 6174  nv_dir2 = os.pat
+0001f280: 682e 6a6f 696e 2872 6f69 5f64 6174 615f  h.join(roi_data_
+0001f290: 6469 722c 2022 636f 6e76 524f 495f 424f  dir, "convROI_BO
+0001f2a0: 4c44 3222 290a 2020 2020 2020 2020 746d  LD2").        tm
+0001f2b0: 7020 3d20 224e 6f6e 6522 0a0a 2020 2020  p = "None"..    
+0001f2c0: 2020 2020 6966 206f 732e 7061 7468 2e69      if os.path.i
+0001f2d0: 7364 6972 2863 6f6e 765f 6469 7232 293a  sdir(conv_dir2):
+0001f2e0: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
+0001f2f0: 203d 2074 656d 7066 696c 652e 6d6b 7465   = tempfile.mkte
+0001f300: 6d70 2864 6972 3d6f 732e 7061 7468 2e64  mp(dir=os.path.d
+0001f310: 6972 6e61 6d65 2872 6f69 5f64 6174 615f  irname(roi_data_
+0001f320: 6469 7229 290a 2020 2020 2020 2020 2020  dir)).          
+0001f330: 2020 6f73 2e6d 6b64 6972 2874 6d70 290a    os.mkdir(tmp).
+0001f340: 2020 2020 2020 2020 2020 2020 7368 7574              shut
+0001f350: 696c 2e6d 6f76 6528 636f 6e76 5f64 6972  il.move(conv_dir
+0001f360: 322c 206f 732e 7061 7468 2e6a 6f69 6e28  2, os.path.join(
+0001f370: 746d 702c 2022 636f 6e76 524f 495f 424f  tmp, "convROI_BO
+0001f380: 4c44 3222 2929 0a20 2020 2020 2020 2020  LD2")).         
+0001f390: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+0001f3a0: 2020 2020 2020 2020 2020 275c 6e52 6573            '\nRes
+0001f3b0: 616d 706c 6532 2062 7269 636b 3a5c 6e41  ample2 brick:\nA
+0001f3c0: 2022 7b7d 2220 666f 6c64 6572 2061 6c72   "{}" folder alr
+0001f3d0: 6561 6479 2065 7869 7374 732c 2027 0a20  eady exists, '. 
+0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001f3f0: 6974 2077 696c 6c20 6265 206f 7665 7277  it will be overw
+0001f400: 7269 7474 656e 2062 7920 7468 6973 206e  ritten by this n
+0001f410: 6577 2022 0a20 2020 2020 2020 2020 2020  ew ".           
+0001f420: 2020 2020 2022 6361 6c63 756c 6174 696f       "calculatio
+0001f430: 6e2e 2e2e 222e 666f 726d 6174 2863 6f6e  n...".format(con
+0001f440: 765f 6469 7232 290a 2020 2020 2020 2020  v_dir2).        
+0001f450: 2020 2020 290a 2020 2020 2020 2020 6f73      ).        os
+0001f460: 2e6d 6b64 6972 2863 6f6e 765f 6469 7232  .mkdir(conv_dir2
+0001f470: 290a 0a20 2020 2020 2020 2069 6620 6f73  )..        if os
+0001f480: 2e70 6174 682e 6973 6469 7228 746d 7029  .path.isdir(tmp)
+0001f490: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
+0001f4a0: 7574 696c 2e72 6d74 7265 6528 746d 7029  util.rmtree(tmp)
+0001f4b0: 0a0a 2020 2020 2020 2020 2320 5365 7474  ..        # Sett
+0001f4c0: 696e 6720 6669 6c65 735f 746f 5f72 6573  ing files_to_res
+0001f4d0: 616d 706c 6520 746f 2074 6865 2072 6573  ample to the res
+0001f4e0: 6f6c 7574 696f 6e20 6f66 2074 6865 2072  olution of the r
+0001f4f0: 6566 6572 656e 6365 5f69 6d61 6765 0a20  eference_image. 
+0001f500: 2020 2020 2020 206d 6173 6b5f 696d 6720         mask_img 
+0001f510: 3d20 6e69 622e 6c6f 6164 2873 656c 662e  = nib.load(self.
+0001f520: 7265 6665 7265 6e63 655f 696d 6167 6529  reference_image)
+0001f530: 0a0a 2020 2020 2020 2020 666f 7220 726f  ..        for ro
+0001f540: 695f 6669 6c65 2069 6e20 7365 6c66 2e66  i_file in self.f
+0001f550: 696c 6573 5f74 6f5f 7265 7361 6d70 6c65  iles_to_resample
+0001f560: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+0001f570: 695f 696d 6720 3d20 6e69 622e 6c6f 6164  i_img = nib.load
+0001f580: 2872 6f69 5f66 696c 6529 0a20 2020 2020  (roi_file).     
+0001f590: 2020 2020 2020 2072 6573 697a 6564 5f72         resized_r
+0001f5a0: 6f69 5f69 6d67 203d 2072 6573 616d 706c  oi_img = resampl
+0001f5b0: 655f 746f 5f69 6d67 280a 2020 2020 2020  e_to_img(.      
+0001f5c0: 2020 2020 2020 2020 2020 726f 695f 696d            roi_im
+0001f5d0: 672c 206d 6173 6b5f 696d 672c 2069 6e74  g, mask_img, int
+0001f5e0: 6572 706f 6c61 7469 6f6e 3d22 6c69 6e65  erpolation="line
+0001f5f0: 6172 220a 2020 2020 2020 2020 2020 2020  ar".            
+0001f600: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0001f610: 496d 6167 6520 7361 7665 0a20 2020 2020  Image save.     
+0001f620: 2020 2020 2020 206f 7574 5f66 696c 6520         out_file 
+0001f630: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+0001f640: 6d65 2872 6f69 5f66 696c 6529 0a20 2020  me(roi_file).   
+0001f650: 2020 2020 2020 2020 206f 7574 5f66 696c           out_fil
+0001f660: 655f 6e6f 5f65 7874 2c20 6669 6c65 5f65  e_no_ext, file_e
+0001f670: 7874 656e 7369 6f6e 203d 206f 732e 7061  xtension = os.pa
+0001f680: 7468 2e73 706c 6974 6578 7428 6f75 745f  th.splitext(out_
+0001f690: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+0001f6a0: 2020 6f75 745f 6669 6c65 203d 206f 7574    out_file = out
+0001f6b0: 5f66 696c 655f 6e6f 5f65 7874 202b 2073  _file_no_ext + s
+0001f6c0: 656c 662e 7375 6666 6978 202b 2066 696c  elf.suffix + fil
+0001f6d0: 655f 6578 7465 6e73 696f 6e0a 2020 2020  e_extension.    
+0001f6e0: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
+0001f6f0: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+0001f700: 636f 6e76 5f64 6972 322c 206f 7574 5f66  conv_dir2, out_f
+0001f710: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0001f720: 206e 6962 2e73 6176 6528 7265 7369 7a65   nib.save(resize
+0001f730: 645f 726f 695f 696d 672c 206f 7574 5f66  d_roi_img, out_f
+0001f740: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0001f750: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+0001f760: 2020 2020 2020 2020 225c 6e52 6573 616d          "\nResam
+0001f770: 706c 6532 2062 7269 636b 3a7b 307d 2073  ple2 brick:{0} s
+0001f780: 6176 6564 222e 666f 726d 6174 280a 2020  aved".format(.  
+0001f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7a0: 2020 6f73 2e70 6174 682e 6261 7365 6e61    os.path.basena
+0001f7b0: 6d65 286f 7574 5f66 696c 6529 0a20 2020  me(out_file).   
+0001f7c0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001f7d0: 2020 2020 2020 2020 2020 2029 0a0a 0a63             )...c
+0001f7e0: 6c61 7373 2052 6f74 6174 696f 6e4d 6173  lass RotationMas
+0001f7f0: 6b28 5072 6f63 6573 734d 4941 293a 0a20  k(ProcessMIA):. 
+0001f800: 2020 2022 2222 0a20 2020 202a 436f 6d70     """.    *Comp
+0001f810: 7574 6520 7468 6520 726f 7461 7469 6f6e  ute the rotation
+0001f820: 206d 6173 6b20 696d 6167 652a 0a0a 2020   mask image*..  
+0001f830: 2020 506c 6561 7365 2c20 7365 6520 7468    Please, see th
+0001f840: 6520 636f 6d70 6c65 7465 2064 6f63 756d  e complete docum
+0001f850: 656e 7461 7469 6f6e 2066 6f72 2074 6865  entation for the
+0001f860: 0a20 2020 2060 526f 7461 7469 6f6e 4d61  .    `RotationMa
+0001f870: 736b 2062 7269 636b 2069 6e20 7468 6520  sk brick in the 
+0001f880: 6d69 615f 7072 6f63 6573 7365 7320 7765  mia_processes we
+0001f890: 6273 6974 650a 2020 2020 3c68 7474 7073  bsite.    <https
+0001f8a0: 3a2f 2f70 6f70 756c 7365 2e67 6974 6875  ://populse.githu
+0001f8b0: 622e 696f 2f6d 6961 5f70 726f 6365 7373  b.io/mia_process
+0001f8c0: 6573 2f68 746d 6c2f 646f 6375 6d65 6e74  es/html/document
+0001f8d0: 6174 696f 6e2f 6272 6963 6b73 2f70 7265  ation/bricks/pre
+0001f8e0: 7072 6f63 6573 732f 6f74 6865 722f 526f  process/other/Ro
+0001f8f0: 7461 7469 6f6e 4d61 736b 2e68 746d 6c3e  tationMask.html>
+0001f900: 605f 0a0a 2020 2020 6164 6170 7465 6420  `_..    adapted 
+0001f910: 6672 6f6d 3a0a 2020 2020 6874 7470 733a  from:.    https:
+0001f920: 2f2f 6769 7468 7562 2e63 6f6d 2f6e 6970  //github.com/nip
+0001f930: 7265 7073 2f6d 7269 7163 2f62 6c6f 622f  reps/mriqc/blob/
+0001f940: 6530 3231 3030 3864 6130 6132 6566 3163  e021008da0a2ef1c
+0001f950: 3438 6538 3832 6261 6639 3332 3133 3961  48e882baf932139a
+0001f960: 3637 3333 3439 6639 2f6d 7269 7163 2f69  673349f9/mriqc/i
+0001f970: 6e74 6572 6661 6365 732f 616e 6174 6f6d  nterfaces/anatom
+0001f980: 6963 616c 2e70 7923 4c34 3438 0a0a 2020  ical.py#L448..  
+0001f990: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+0001f9a0: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
+0001f9b0: 2020 2020 2020 2022 2222 4465 6469 6361         """Dedica
+0001f9c0: 7465 6420 746f 2074 6865 2061 7474 7269  ted to the attri
+0001f9d0: 6275 7465 7320 696e 6974 6961 6c69 7361  butes initialisa
+0001f9e0: 7469 6f6e 202f 2069 6e73 7461 6e74 6961  tion / instantia
+0001f9f0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2054  tion...        T
+0001fa00: 6865 2069 6e70 7574 2061 6e64 206f 7574  he input and out
+0001fa10: 7075 7420 706c 7567 7320 6172 6520 6465  put plugs are de
+0001fa20: 6669 6e65 6420 6865 7265 2e20 5468 6520  fined here. The 
+0001fa30: 7370 6563 6961 6c0a 2020 2020 2020 2020  special.        
+0001fa40: 2773 656c 662e 7265 7175 6972 656d 656e  'self.requiremen
+0001fa50: 7427 2061 7474 7269 6275 7465 2028 6f70  t' attribute (op
+0001fa60: 7469 6f6e 616c 2920 6973 2075 7365 6420  tional) is used 
+0001fa70: 746f 2064 6566 696e 6520 7468 650a 2020  to define the.  
+0001fa80: 2020 2020 2020 7468 6972 642d 7061 7274        third-part
+0001fa90: 7920 7072 6f64 7563 7473 206e 6563 6573  y products neces
+0001faa0: 7361 7279 2066 6f72 2074 6865 2072 756e  sary for the run
+0001fab0: 6e69 6e67 206f 6620 7468 6520 6272 6963  ning of the bric
+0001fac0: 6b2e 0a20 2020 2020 2020 2022 2222 0a20  k..        """. 
+0001fad0: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
+0001fae0: 6973 6174 696f 6e20 6f66 2074 6865 206f  isation of the o
+0001faf0: 626a 6563 7473 206e 6565 6465 6420 666f  bjects needed fo
+0001fb00: 7220 7468 6520 6c61 756e 6368 206f 6620  r the launch of 
+0001fb10: 7468 6520 6272 6963 6b0a 2020 2020 2020  the brick.      
+0001fb20: 2020 7375 7065 7228 526f 7461 7469 6f6e    super(Rotation
+0001fb30: 4d61 736b 2c20 7365 6c66 292e 5f5f 696e  Mask, self).__in
+0001fb40: 6974 5f5f 2829 0a0a 2020 2020 2020 2020  it__()..        
+0001fb50: 2320 5468 6972 6420 7061 7274 7920 736f  # Third party so
+0001fb60: 6674 7761 7265 7320 7265 7175 6972 6564  ftwares required
+0001fb70: 2066 6f72 2074 6865 2065 7865 6375 7469   for the executi
+0001fb80: 6f6e 206f 6620 7468 6520 6272 6963 6b0a  on of the brick.
+0001fb90: 2020 2020 2020 2020 7365 6c66 2e72 6571          self.req
+0001fba0: 7569 7265 6d65 6e74 203d 205b 5d0a 0a20  uirement = [].. 
+0001fbb0: 2020 2020 2020 2023 2049 6e70 7574 7320         # Inputs 
+0001fbc0: 6465 7363 7269 7074 696f 6e0a 2020 2020  description.    
+0001fbd0: 2020 2020 696e 5f66 696c 655f 6465 7363      in_file_desc
+0001fbe0: 203d 2022 416e 2065 7869 7374 696e 6720   = "An existing 
+0001fbf0: 7061 7468 2066 696c 652e 220a 2020 2020  path file.".    
+0001fc00: 2020 2020 7072 6566 6978 5f64 6573 6320      prefix_desc 
+0001fc10: 3d20 2250 7265 6669 7820 6f66 2074 6865  = "Prefix of the
+0001fc20: 206f 7574 7075 7420 696d 6167 6520 2861   output image (a
+0001fc30: 2073 7472 696e 6729 2e22 0a20 2020 2020   string).".     
+0001fc40: 2020 2073 7566 6669 785f 6465 7363 203d     suffix_desc =
+0001fc50: 2022 5375 6666 6978 206f 6620 7468 6520   "Suffix of the 
+0001fc60: 6f75 7470 7574 2069 6d61 6765 2028 6120  output image (a 
+0001fc70: 7374 7269 6e67 292e 220a 0a20 2020 2020  string)."..     
+0001fc80: 2020 2023 204f 7574 7075 7473 2064 6573     # Outputs des
+0001fc90: 6372 6970 7469 6f6e 0a20 2020 2020 2020  cription.       
+0001fca0: 206f 7574 5f66 696c 655f 6465 7363 203d   out_file_desc =
+0001fcb0: 2028 0a20 2020 2020 2020 2020 2020 2022   (.            "
+0001fcc0: 5061 7468 206f 6620 7468 6520 7363 616e  Path of the scan
+0001fcd0: 2061 6674 6572 206d 6173 6b69 6e67 2022   after masking "
+0001fce0: 0a20 2020 2020 2020 2020 2020 2022 2861  .            "(a
+0001fcf0: 2070 6174 686c 696b 6520 6f62 6a65 6374   pathlike object
+0001fd00: 206f 7220 7374 7269 6e67 2072 6570 7265   or string repre
+0001fd10: 7365 6e74 696e 6720 6120 6669 6c65 292e  senting a file).
+0001fd20: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+0001fd30: 2020 2020 2023 2049 6e70 7574 7320 7472       # Inputs tr
+0001fd40: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
+0001fd50: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
+0001fd60: 2020 2020 2020 2020 2022 696e 5f66 696c           "in_fil
+0001fd70: 6522 2c20 4669 6c65 286f 7574 7075 743d  e", File(output=
+0001fd80: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+0001fd90: 4661 6c73 652c 2064 6573 633d 696e 5f66  False, desc=in_f
+0001fda0: 696c 655f 6465 7363 290a 2020 2020 2020  ile_desc).      
+0001fdb0: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
+0001fdc0: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
+0001fdd0: 2020 2020 2020 2020 2022 7375 6666 6978           "suffix
+0001fde0: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
+0001fdf0: 7261 6974 732e 5374 7269 6e67 280a 2020  raits.String(.  
+0001fe00: 2020 2020 2020 2020 2020 2020 2020 225f                "_
+0001fe10: 726f 746d 6173 6b65 6422 2c20 6f75 7470  rotmasked", outp
+0001fe20: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
+0001fe30: 616c 3d54 7275 652c 2064 6573 633d 7375  al=True, desc=su
+0001fe40: 6666 6978 5f64 6573 630a 2020 2020 2020  ffix_desc.      
+0001fe50: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+0001fe60: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+0001fe70: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
+0001fe80: 2020 2020 2020 2020 2270 7265 6669 7822          "prefix"
+0001fe90: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
+0001fea0: 6169 7473 2e53 7472 696e 6728 2222 2c20  aits.String("", 
+0001feb0: 6f75 7470 7574 3d46 616c 7365 2c20 6f70  output=False, op
+0001fec0: 7469 6f6e 616c 3d54 7275 652c 2064 6573  tional=True, des
+0001fed0: 633d 7072 6566 6978 5f64 6573 6329 2c0a  c=prefix_desc),.
+0001fee0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001fef0: 2020 2023 204f 7574 7075 7473 2074 7261     # Outputs tra
+0001ff00: 6974 730a 2020 2020 2020 2020 7365 6c66  its.        self
+0001ff10: 2e61 6464 5f74 7261 6974 2822 6f75 745f  .add_trait("out_
+0001ff20: 6669 6c65 222c 2046 696c 6528 6f75 7470  file", File(outp
+0001ff30: 7574 3d54 7275 652c 2064 6573 633d 6f75  ut=True, desc=ou
+0001ff40: 745f 6669 6c65 5f64 6573 6329 290a 0a20  t_file_desc)).. 
+0001ff50: 2020 2020 2020 2073 656c 662e 696e 6974         self.init
+0001ff60: 5f64 6566 6175 6c74 5f74 7261 6974 7328  _default_traits(
+0001ff70: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
+0001ff80: 6f75 7470 7574 7328 7365 6c66 2c20 6973  outputs(self, is
+0001ff90: 5f70 6c75 6767 6564 3d4e 6f6e 6529 3a0a  _plugged=None):.
+0001ffa0: 2020 2020 2020 2020 2222 2244 6564 6963          """Dedic
+0001ffb0: 6174 6564 2074 6f20 7468 6520 696e 6974  ated to the init
+0001ffc0: 6961 6c69 7361 7469 6f6e 2073 7465 7020  ialisation step 
+0001ffd0: 6f66 2074 6865 2062 7269 636b 2e0a 0a20  of the brick... 
+0001ffe0: 2020 2020 2020 2054 6865 206d 6169 6e20         The main 
+0001fff0: 6f62 6a65 6374 6976 6520 6f66 2074 6869  objective of thi
+00020000: 7320 6d65 7468 6f64 2069 7320 746f 2070  s method is to p
+00020010: 726f 6475 6365 2074 6865 206f 7574 7075  roduce the outpu
+00020020: 7473 206f 6620 7468 650a 2020 2020 2020  ts of the.      
+00020030: 2020 6272 6963 6b73 2028 7365 6c66 2e6f    bricks (self.o
+00020040: 7574 7075 7473 2920 616e 6420 7468 6520  utputs) and the 
+00020050: 6173 736f 6369 6174 6564 2074 6167 7320  associated tags 
+00020060: 2873 656c 662e 696e 6865 7269 7461 6e63  (self.inheritanc
+00020070: 655f 6469 6329 2c0a 2020 2020 2020 2020  e_dic),.        
+00020080: 6966 2064 6566 696e 6564 2068 6572 652e  if defined here.
+00020090: 2054 6f20 776f 726b 2070 726f 7065 726c   To work properl
+000200a0: 7920 7468 6973 206d 6574 686f 6420 6d75  y this method mu
+000200b0: 7374 2072 6574 7572 6e0a 2020 2020 2020  st return.      
+000200c0: 2020 7365 6c66 2e6d 616b 655f 696e 6974    self.make_init
+000200d0: 5265 7375 6c74 2829 206f 626a 6563 742e  Result() object.
+000200e0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000200f0: 2069 735f 706c 7567 6765 643a 2074 6865   is_plugged: the
+00020100: 2073 7461 7465 2c20 6c69 6e6b 6564 206f   state, linked o
+00020110: 7220 6e6f 742c 206f 6620 7468 6520 706c  r not, of the pl
+00020120: 7567 732e 0a20 2020 2020 2020 203a 7265  ugs..        :re
+00020130: 7475 726e 733a 2061 2064 6963 7469 6f6e  turns: a diction
+00020140: 6172 7920 7769 7468 2072 6571 7569 7265  ary with require
+00020150: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
+00020160: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
+00020170: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+00020180: 2020 2020 2020 2020 2320 5573 696e 6720          # Using 
+00020190: 7468 6520 696e 6865 7269 7461 6e63 6520  the inheritance 
+000201a0: 746f 2050 726f 6365 7373 4d49 4120 636c  to ProcessMIA cl
+000201b0: 6173 732c 206c 6973 745f 6f75 7470 7574  ass, list_output
+000201c0: 7320 6d65 7468 6f64 0a20 2020 2020 2020  s method.       
+000201d0: 2073 7570 6572 2852 6f74 6174 696f 6e4d   super(RotationM
+000201e0: 6173 6b2c 2073 656c 6629 2e6c 6973 745f  ask, self).list_
+000201f0: 6f75 7470 7574 7328 290a 0a20 2020 2020  outputs()..     
+00020200: 2020 2023 204f 7574 7075 7473 2064 6566     # Outputs def
+00020210: 696e 6974 696f 6e0a 2020 2020 2020 2020  inition.        
+00020220: 6966 2073 656c 662e 696e 5f66 696c 653a  if self.in_file:
+00020230: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00020240: 6964 5f65 7874 2c20 696e 5f65 7874 2c20  id_ext, in_ext, 
+00020250: 6669 6c65 4e61 6d65 203d 2063 6865 636b  fileName = check
+00020260: 4669 6c65 4578 7428 7365 6c66 2e69 6e5f  FileExt(self.in_
+00020270: 6669 6c65 2c20 4558 5429 0a0a 2020 2020  file, EXT)..    
+00020280: 2020 2020 2020 2020 6966 206e 6f74 2076          if not v
+00020290: 616c 6964 5f65 7874 3a0a 2020 2020 2020  alid_ext:.      
+000202a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000202b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000202c0: 2020 2020 2022 5c6e 526f 7461 7469 6f6e       "\nRotation
+000202d0: 4d61 736b 2062 7269 636b 3a20 5468 6520  Mask brick: The 
+000202e0: 696e 7075 7420 696d 6167 6520 666f 726d  input image form
+000202f0: 6174 2069 7320 6e6f 7420 220a 2020 2020  at is not ".    
+00020300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020310: 2272 6563 6f67 6e69 7a65 642e 2e2e 2122  "recognized...!"
+00020320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020330: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00020340: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+00020350: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00020360: 2020 2020 2020 2020 2020 2020 286e 6f74              (not
+00020370: 2073 656c 662e 7375 6666 6978 290a 2020   self.suffix).  
+00020380: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00020390: 2028 7365 6c66 2e73 7566 6669 782e 6973   (self.suffix.is
+000203a0: 7370 6163 6528 2929 0a20 2020 2020 2020  space()).       
+000203b0: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+000203c0: 2e73 7566 6669 7820 696e 205b 556e 6465  .suffix in [Unde
+000203d0: 6669 6e65 642c 2022 3c75 6e64 6566 696e  fined, "<undefin
+000203e0: 6564 3e22 5d0a 2020 2020 2020 2020 2020  ed>"].          
+000203f0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00020400: 2020 2020 2073 656c 662e 7375 6666 6978       self.suffix
+00020410: 203d 2022 2022 0a0a 2020 2020 2020 2020   = " "..        
+00020420: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00020430: 2020 2020 2020 2020 2028 6e6f 7420 7365           (not se
+00020440: 6c66 2e70 7265 6669 7829 0a20 2020 2020  lf.prefix).     
+00020450: 2020 2020 2020 2020 2020 206f 7220 2873             or (s
+00020460: 656c 662e 7072 6566 6978 2e69 7373 7061  elf.prefix.isspa
+00020470: 6365 2829 290a 2020 2020 2020 2020 2020  ce()).          
+00020480: 2020 2020 2020 6f72 2028 7365 6c66 2e70        or (self.p
+00020490: 7265 6669 7820 696e 205b 556e 6465 6669  refix in [Undefi
+000204a0: 6e65 642c 2022 3c75 6e64 6566 696e 6564  ned, "<undefined
+000204b0: 3e22 5d29 0a20 2020 2020 2020 2020 2020  >"]).           
+000204c0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+000204d0: 2020 2020 7365 6c66 2e70 7265 6669 7820      self.prefix 
+000204e0: 3d20 2220 220a 0a20 2020 2020 2020 2020  = " "..         
+000204f0: 2020 2070 6174 682c 205f 203d 206f 732e     path, _ = os.
+00020500: 7061 7468 2e73 706c 6974 2873 656c 662e  path.split(self.
+00020510: 696e 5f66 696c 6529 0a0a 2020 2020 2020  in_file)..      
+00020520: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00020530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00020540: 7375 6666 6978 203d 3d20 2220 220a 2020  suffix == " ".  
+00020550: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00020560: 6420 7365 6c66 2e70 7265 6669 7820 3d3d  d self.prefix ==
+00020570: 2022 2022 0a20 2020 2020 2020 2020 2020   " ".           
+00020580: 2020 2020 2061 6e64 2070 6174 6820 3d3d       and path ==
+00020590: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
+000205a0: 6563 746f 7279 0a20 2020 2020 2020 2020  ectory.         
+000205b0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+000205c0: 2020 2020 2020 6d73 6720 3d20 514d 6573        msg = QMes
+000205d0: 7361 6765 426f 7828 290a 2020 2020 2020  sageBox().      
+000205e0: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
+000205f0: 7449 636f 6e28 514d 6573 7361 6765 426f  tIcon(QMessageBo
+00020600: 782e 5761 726e 696e 6729 0a20 2020 2020  x.Warning).     
+00020610: 2020 2020 2020 2020 2020 206d 7367 2e73             msg.s
+00020620: 6574 5769 6e64 6f77 5469 746c 6528 0a20  etWindowTitle(. 
 00020630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020640: 2b20 6669 6c65 4e61 6d65 0a20 2020 2020  + fileName.     
-00020650: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00020660: 2073 656c 662e 7375 6666 6978 2e73 7472   self.suffix.str
-00020670: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
-00020680: 2020 2020 2020 2020 202b 2022 2e22 0a20           + ".". 
-00020690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000206a0: 2020 202b 2069 6e5f 6578 740a 2020 2020     + in_ext.    
-000206b0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-000206c0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000206d0: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-000206e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000206f0: 2020 2073 656c 662e 6f75 7470 7574 735b     self.outputs[
-00020700: 226f 7574 5f66 696c 6522 5d20 3d20 6669  "out_file"] = fi
-00020710: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-00020720: 2020 2023 2046 4958 4d45 3a20 496e 2074     # FIXME: In t
-00020730: 6865 206c 6174 6573 7420 7665 7273 696f  he latest versio
-00020740: 6e20 6f66 206d 6961 2c20 696e 6465 7869  n of mia, indexi
-00020750: 6e67 206f 6620 7468 650a 2020 2020 2020  ng of the.      
-00020760: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00020770: 2020 2064 6174 6162 6173 6520 7769 7468     database with
-00020780: 2070 6172 7469 6375 6c61 7220 7461 6773   particular tags
-00020790: 2064 6566 696e 6564 2069 6e20 7468 650a   defined in the.
-000207a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000207b0: 2320 2020 2020 2020 2070 726f 6365 7373  #        process
-000207c0: 6573 2069 7320 646f 6e65 206f 6e6c 7920  es is done only 
-000207d0: 6174 2074 6865 2065 6e64 206f 6620 7468  at the end of th
-000207e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000207f0: 2020 2320 2020 2020 2020 2069 6e69 7469    #        initi
-00020800: 616c 6973 6174 696f 6e20 6f66 2074 6865  alisation of the
-00020810: 2077 686f 6c65 2070 6970 656c 696e 652e   whole pipeline.
-00020820: 2053 6f20 7765 0a20 2020 2020 2020 2020   So we.         
-00020830: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00020840: 6361 6e6e 6f74 2075 7365 2074 6865 2076  cannot use the v
-00020850: 616c 7565 206f 6620 7468 6573 6520 7461  alue of these ta
-00020860: 6773 2069 6e20 6f74 6865 720a 2020 2020  gs in other.    
-00020870: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00020880: 2020 2020 2070 726f 6365 7373 6573 206f       processes o
-00020890: 6620 7468 6520 7069 7065 6c69 6e65 2061  f the pipeline a
-000208a0: 7420 7468 6520 7469 6d65 206f 660a 2020  t the time of.  
-000208b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000208c0: 2020 2020 2020 2069 6e69 7469 616c 6973         initialis
-000208d0: 6174 696f 6e20 2873 6565 2070 6f70 756c  ation (see popul
-000208e0: 7365 5f6d 6961 2023 3239 3029 2e20 556e  se_mia #290). Un
-000208f0: 7469 6c0a 2020 2020 2020 2020 2020 2020  til.            
-00020900: 2020 2020 2320 2020 2020 2020 2062 6574      #        bet
-00020910: 7465 7220 7765 2075 7365 2061 2071 7569  ter we use a qui
-00020920: 636b 2061 6e64 2064 6972 7479 2068 6163  ck and dirty hac
-00020930: 6b20 7769 7468 2074 6865 0a20 2020 2020  k with the.     
-00020940: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00020950: 2020 2020 7365 745f 6462 4669 656c 6456      set_dbFieldV
-00020960: 616c 7565 2829 2066 756e 6374 696f 6e20  alue() function 
-00020970: 210a 0a20 2020 2020 2020 2020 2020 2020  !..             
-00020980: 2020 2074 6167 5f74 6f5f 6164 6420 3d20     tag_to_add = 
-00020990: 6469 6374 2829 0a20 2020 2020 2020 2020  dict().         
-000209a0: 2020 2020 2020 2074 6167 5f74 6f5f 6164         tag_to_ad
-000209b0: 645b 226e 616d 6522 5d20 3d20 2252 6570  d["name"] = "Rep
-000209c0: 6574 6974 696f 6e54 696d 6522 0a20 2020  etitionTime".   
-000209d0: 2020 2020 2020 2020 2020 2020 2074 6167               tag
-000209e0: 5f74 6f5f 6164 645b 2266 6965 6c64 5f74  _to_add["field_t
-000209f0: 7970 6522 5d20 3d20 2266 6c6f 6174 220a  ype"] = "float".
+00020640: 2020 2022 6d69 615f 7072 6f63 6573 7365     "mia_processe
+00020650: 7320 2d20 526f 7461 7469 6f6e 4d61 736b  s - RotationMask
+00020660: 2062 7269 636b 2057 6172 6e69 6e67 2122   brick Warning!"
+00020670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020680: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00020690: 2020 206d 7367 2e73 6574 5465 7874 280a     msg.setText(.
+000206a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206b0: 2020 2020 2253 7566 6669 7820 616e 6420      "Suffix and 
+000206c0: 7072 6566 6978 2069 6e70 7574 2070 6172  prefix input par
+000206d0: 616d 6574 6572 7320 6172 6520 6e6f 7420  ameters are not 
+000206e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000206f0: 2020 2020 2020 2264 6566 696e 6564 206f        "defined o
+00020700: 7220 636f 6e73 6973 7420 6f6e 6c79 206f  r consist only o
+00020710: 6620 6f6e 6520 6f72 206d 6f72 6520 7768  f one or more wh
+00020720: 6974 6520 220a 2020 2020 2020 2020 2020  ite ".          
+00020730: 2020 2020 2020 2020 2020 2273 7061 6365            "space
+00020740: 732e 5c6e 5468 6520 7b30 7d20 696e 7075  s.\nThe {0} inpu
+00020750: 7420 7061 7261 6d65 7465 7220 7769 6c6c  t parameter will
+00020760: 2062 6520 220a 2020 2020 2020 2020 2020   be ".          
+00020770: 2020 2020 2020 2020 2020 226f 7665 7277            "overw
+00020780: 7269 7474 656e 202e 2e2e 5c6e 2059 6573  ritten ...\n Yes
+00020790: 206f 7220 220a 2020 2020 2020 2020 2020   or ".          
+000207a0: 2020 2020 2020 2020 2020 2241 626f 7274            "Abort
+000207b0: 3f22 2e66 6f72 6d61 7428 6669 6c65 4e61  ?".format(fileNa
+000207c0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+000207d0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000207e0: 2020 2020 2020 6d73 672e 7365 7453 7461        msg.setSta
+000207f0: 6e64 6172 6442 7574 746f 6e73 2851 4d65  ndardButtons(QMe
+00020800: 7373 6167 6542 6f78 2e59 6573 207c 2051  ssageBox.Yes | Q
+00020810: 4d65 7373 6167 6542 6f78 2e41 626f 7274  MessageBox.Abort
+00020820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020830: 2020 7265 7476 616c 203d 206d 7367 2e65    retval = msg.e
+00020840: 7865 635f 2829 0a0a 2020 2020 2020 2020  xec_()..        
+00020850: 2020 2020 2020 2020 6966 2072 6574 7661          if retva
+00020860: 6c20 213d 2051 4d65 7373 6167 6542 6f78  l != QMessageBox
+00020870: 2e41 626f 7274 3a0a 2020 2020 2020 2020  .Abort:.        
+00020880: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00020890: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+000208a0: 2020 2020 2020 2020 2020 2022 5c6e 526f             "\nRo
+000208b0: 7461 7469 6f6e 4d61 736b 2062 7269 636b  tationMask brick
+000208c0: 2077 6172 6e69 6e67 3a20 7468 6520 6f75   warning: the ou
+000208d0: 745f 6669 6c65 206f 7574 7075 7420 220a  t_file output ".
+000208e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000208f0: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
+00020900: 6572 2069 7320 7468 6520 7361 6d65 2061  er is the same a
+00020910: 7320 7468 6520 696e 5f66 696c 6573 2069  s the in_files i
+00020920: 6e70 7574 2022 0a20 2020 2020 2020 2020  nput ".         
+00020930: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00020940: 7061 7261 6d65 7465 7220 2873 7566 6669  parameter (suffi
+00020950: 7820 616e 6420 7072 6566 6978 2061 7265  x and prefix are
+00020960: 206e 6f74 2064 6566 696e 6564 293a 220a   not defined):".
+00020970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020980: 2020 2020 2020 2020 225c 6e7b 307d 2077          "\n{0} w
+00020990: 696c 6c20 6265 206f 7665 7277 7269 7465  ill be overwrite
+000209a0: 6420 2e2e 2e22 2e66 6f72 6d61 7428 6669  d ...".format(fi
+000209b0: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
+000209c0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000209d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000209e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000209f0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
 00020a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a10: 7461 675f 746f 5f61 6464 5b22 6465 7363  tag_to_add["desc
-00020a20: 7269 7074 696f 6e22 5d20 3d20 280a 2020  ription"] = (.  
-00020a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a40: 2020 2254 6865 2070 6572 696f 6420 6f66    "The period of
-00020a50: 2074 696d 6520 220a 2020 2020 2020 2020   time ".        
-00020a60: 2020 2020 2020 2020 2020 2020 2269 6e20              "in 
-00020a70: 6d73 6563 2062 6574 7765 656e 2074 6865  msec between the
-00020a80: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00020a90: 2020 2020 2020 2022 6265 6769 6e6e 696e         "beginnin
-00020aa0: 6720 6f66 2061 2070 756c 7365 2022 0a20  g of a pulse ". 
-00020ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ac0: 2020 2022 7365 7175 656e 6365 2061 6e64     "sequence and
-00020ad0: 2074 6865 2022 0a20 2020 2020 2020 2020   the ".         
-00020ae0: 2020 2020 2020 2020 2020 2022 6265 6769             "begi
-00020af0: 6e6e 696e 6720 6f66 2074 6865 2022 0a20  nning of the ". 
-00020b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b10: 2020 2022 7375 6363 6565 6469 6e67 2070     "succeeding p
-00020b20: 756c 7365 2022 0a20 2020 2020 2020 2020  ulse ".         
-00020b30: 2020 2020 2020 2020 2020 2022 7365 7175             "sequ
-00020b40: 656e 6365 220a 2020 2020 2020 2020 2020  ence".          
-00020b50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00020b60: 2020 2020 2020 2020 7461 675f 746f 5f61          tag_to_a
-00020b70: 6464 5b22 7669 7369 6269 6c69 7479 225d  dd["visibility"]
-00020b80: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00020b90: 2020 2020 2020 2020 7461 675f 746f 5f61          tag_to_a
-00020ba0: 6464 5b22 6f72 6967 696e 225d 203d 2022  dd["origin"] = "
-00020bb0: 7573 6572 220a 2020 2020 2020 2020 2020  user".          
-00020bc0: 2020 2020 2020 7461 675f 746f 5f61 6464        tag_to_add
-00020bd0: 5b22 756e 6974 225d 203d 2022 6d73 220a  ["unit"] = "ms".
-00020be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020bf0: 7461 675f 746f 5f61 6464 5b22 6465 6661  tag_to_add["defa
-00020c00: 756c 745f 7661 6c75 6522 5d20 3d20 4e6f  ult_value"] = No
-00020c10: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00020c20: 2020 2074 6167 5f74 6f5f 6164 645b 2276     tag_to_add["v
-00020c30: 616c 7565 225d 203d 2067 6574 5f64 6246  alue"] = get_dbF
-00020c40: 6965 6c64 5661 6c75 6528 0a20 2020 2020  ieldValue(.     
-00020c50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00020c60: 656c 662e 7072 6f6a 6563 742c 2073 656c  elf.project, sel
-00020c70: 662e 696e 5f66 696c 652c 2022 5265 7065  f.in_file, "Repe
-00020c80: 7469 7469 6f6e 5469 6d65 220a 2020 2020  titionTime".    
-00020c90: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00020ca0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00020cb0: 6620 7461 675f 746f 5f61 6464 5b22 7661  f tag_to_add["va
-00020cc0: 6c75 6522 5d20 6973 206e 6f74 204e 6f6e  lue"] is not Non
-00020cd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020ce0: 2020 2020 2020 2073 6574 5f64 6246 6965         set_dbFie
-00020cf0: 6c64 5661 6c75 6528 7365 6c66 2e70 726f  ldValue(self.pro
-00020d00: 6a65 6374 2c20 6669 6c65 2c20 7461 675f  ject, file, tag_
-00020d10: 746f 5f61 6464 290a 0a20 2020 2020 2020  to_add)..       
-00020d20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00020d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d40: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-00020d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d60: 2020 2253 616e 6974 697a 653a 5c6e 2074    "Sanitize:\n t
-00020d70: 6865 2027 5265 7065 7469 7469 6f6e 5469  he 'RepetitionTi
-00020d80: 6d65 2720 7461 6720 636f 756c 6420 220a  me' tag could ".
-00020d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020da0: 2020 2020 2020 2020 226e 6f74 2062 6520          "not be 
-00020db0: 6164 6465 6420 746f 2074 6865 2064 6174  added to the dat
-00020dc0: 6162 6173 6520 666f 7220 7468 6520 277b  abase for the '{
-00020dd0: 7d27 2022 0a20 2020 2020 2020 2020 2020  }' ".           
-00020de0: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
-00020df0: 7261 6d65 7465 722e 2054 6869 7320 6361  rameter. This ca
-00020e00: 6e20 6c65 6164 2074 6f20 6120 7375 6273  n lead to a subs
-00020e10: 6571 7565 6e74 2069 7373 7565 2022 0a20  equent issue ". 
-00020e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e30: 2020 2020 2020 2022 6475 7269 6e67 2069         "during i
-00020e40: 6e69 7469 616c 697a 6174 696f 6e21 215c  nitialization!!\
-00020e50: 6e22 2e66 6f72 6d61 7428 6669 6c65 290a  n".format(file).
-00020e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e70: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00020e80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00020e90: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020eb0: 2020 2020 222d 2053 616e 6974 697a 6520      "- Sanitize 
-00020ec0: 6272 6963 6b3a 2054 6865 7265 2077 6173  brick: There was
-00020ed0: 206e 6f20 6f75 7470 7574 2066 696c 6520   no output file 
-00020ee0: 6465 6475 6374 6564 2022 0a20 2020 2020  deducted ".     
-00020ef0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00020f00: 6475 7269 6e67 2069 6e69 7469 616c 6973  during initialis
-00020f10: 6174 696f 6e2e 2022 0a20 2020 2020 2020  ation. ".       
-00020f20: 2020 2020 2020 2020 2020 2020 2022 506c               "Pl
-00020f30: 6561 7365 2063 6865 636b 2074 6865 2069  ease check the i
-00020f40: 6e70 7574 2070 6172 616d 6574 6572 732e  nput parameters.
-00020f50: 2e2e 2122 0a20 2020 2020 2020 2020 2020  ..!".           
-00020f60: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00020f70: 2020 2020 2320 7461 6773 2069 6e68 6572      # tags inher
-00020f80: 6974 616e 6365 2028 6f70 7469 6f6e 616c  itance (optional
-00020f90: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00020fa0: 2073 656c 662e 6f75 7470 7574 735b 226f   self.outputs["o
-00020fb0: 7574 5f66 696c 6522 5d3a 0a20 2020 2020  ut_file"]:.     
-00020fc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00020fd0: 7461 6773 5f69 6e68 6572 6974 616e 6365  tags_inheritance
-00020fe0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00020ff0: 2020 2020 2020 696e 5f66 696c 653d 7365        in_file=se
-00021000: 6c66 2e69 6e5f 6669 6c65 2c0a 2020 2020  lf.in_file,.    
-00021010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021020: 6f75 745f 6669 6c65 3d73 656c 662e 6f75  out_file=self.ou
-00021030: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
-00021040: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00021050: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00021060: 5265 7475 726e 2074 6865 2072 6571 7569  Return the requi
-00021070: 7265 6d65 6e74 2c20 6f75 7470 7574 7320  rement, outputs 
-00021080: 616e 6420 696e 6865 7269 7461 6e63 655f  and inheritance_
-00021090: 6469 6374 0a20 2020 2020 2020 2072 6574  dict.        ret
-000210a0: 7572 6e20 7365 6c66 2e6d 616b 655f 696e  urn self.make_in
-000210b0: 6974 5265 7375 6c74 2829 0a0a 2020 2020  itResult()..    
-000210c0: 6465 6620 7275 6e5f 7072 6f63 6573 735f  def run_process_
-000210d0: 6d69 6128 7365 6c66 293a 0a20 2020 2020  mia(self):.     
-000210e0: 2020 2022 2222 4465 6469 6361 7465 6420     """Dedicated 
-000210f0: 746f 2074 6865 2070 726f 6365 7373 206c  to the process l
-00021100: 6175 6e63 6820 7374 6570 206f 6620 7468  aunch step of th
-00021110: 6520 6272 6963 6b2e 2222 220a 2020 2020  e brick.""".    
-00021120: 2020 2020 7375 7065 7228 5361 6e69 7469      super(Saniti
-00021130: 7a65 2c20 7365 6c66 292e 7275 6e5f 7072  ze, self).run_pr
-00021140: 6f63 6573 735f 6d69 6128 290a 0a20 2020  ocess_mia()..   
-00021150: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-00021160: 2073 656c 662e 696e 5f66 696c 650a 0a20   self.in_file.. 
-00021170: 2020 2020 2020 2023 2049 6d61 6765 2070         # Image p
-00021180: 726f 6365 7373 696e 670a 2020 2020 2020  rocessing.      
-00021190: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000211a0: 2020 2069 6d67 203d 206e 6962 2e6c 6f61     img = nib.loa
-000211b0: 6428 6669 6c65 5f6e 616d 6529 0a0a 2020  d(file_name)..  
-000211c0: 2020 2020 2020 6578 6365 7074 2028 0a20        except (. 
-000211d0: 2020 2020 2020 2020 2020 206e 6962 2e66             nib.f
-000211e0: 696c 6562 6173 6564 696d 6167 6573 2e49  ilebasedimages.I
-000211f0: 6d61 6765 4669 6c65 4572 726f 722c 0a20  mageFileError,. 
-00021200: 2020 2020 2020 2020 2020 2046 696c 654e             FileN
-00021210: 6f74 466f 756e 6445 7272 6f72 2c0a 2020  otFoundError,.  
-00021220: 2020 2020 2020 2020 2020 5479 7065 4572            TypeEr
-00021230: 726f 722c 0a20 2020 2020 2020 2029 2061  ror,.        ) a
-00021240: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00021250: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-00021260: 2020 2020 2020 2020 225c 6e53 616e 6974          "\nSanit
-00021270: 697a 6520 6272 6963 6b3a 2045 7272 6f72  ize brick: Error
-00021280: 2077 6974 6820 6669 6c65 7320 746f 206d   with files to m
-00021290: 6173 6b2c 2064 7572 696e 6720 7468 6520  ask, during the 
-000212a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000212b0: 2020 2272 756e 3a20 222c 0a20 2020 2020    "run: ",.     
-000212c0: 2020 2020 2020 2020 2020 2065 2c0a 2020             e,.  
-000212d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000212e0: 2020 2020 2020 2020 696d 6720 3d20 4e6f          img = No
-000212f0: 6e65 0a0a 2020 2020 2020 2020 6966 2069  ne..        if i
-00021300: 6d67 2069 7320 6e6f 7420 4e6f 6e65 3a0a  mg is not None:.
-00021310: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
-00021320: 7472 6965 7665 2078 666f 726d 2063 6f64  trieve xform cod
-00021330: 6573 0a20 2020 2020 2020 2020 2020 2073  es.            s
-00021340: 666f 726d 5f63 6f64 6520 3d20 696e 7428  form_code = int(
-00021350: 696d 672e 6865 6164 6572 2e5f 7374 7275  img.header._stru
-00021360: 6374 6172 725b 2273 666f 726d 5f63 6f64  ctarr["sform_cod
-00021370: 6522 5d29 0a20 2020 2020 2020 2020 2020  e"]).           
-00021380: 2071 666f 726d 5f63 6f64 6520 3d20 696e   qform_code = in
-00021390: 7428 696d 672e 6865 6164 6572 2e5f 7374  t(img.header._st
-000213a0: 7275 6374 6172 725b 2271 666f 726d 5f63  ructarr["qform_c
-000213b0: 6f64 6522 5d29 0a0a 2020 2020 2020 2020  ode"])..        
-000213c0: 2020 2020 2320 4368 6563 6b20 7166 6f72      # Check qfor
-000213d0: 6d20 6973 2076 616c 6964 0a20 2020 2020  m is valid.     
-000213e0: 2020 2020 2020 2076 616c 6964 5f71 666f         valid_qfo
-000213f0: 726d 203d 2046 616c 7365 0a20 2020 2020  rm = False.     
-00021400: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00021410: 2020 2020 2020 2020 2020 2020 696d 672e              img.
-00021420: 6765 745f 7166 6f72 6d28 290a 2020 2020  get_qform().    
-00021430: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
-00021440: 645f 7166 6f72 6d20 3d20 5472 7565 0a20  d_qform = True. 
-00021450: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00021460: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
-00021470: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00021480: 7373 0a0a 2020 2020 2020 2020 2020 2020  ss..            
-00021490: 2320 4d61 7463 6869 6e67 2061 6666 696e  # Matching affin
-000214a0: 6573 0a20 2020 2020 2020 2020 2020 206d  es.            m
-000214b0: 6174 6368 696e 675f 6166 6669 6e65 7320  atching_affines 
-000214c0: 3d20 7661 6c69 645f 7166 6f72 6d20 616e  = valid_qform an
-000214d0: 6420 6e70 2e61 6c6c 636c 6f73 6528 0a20  d np.allclose(. 
-000214e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000214f0: 6d67 2e67 6574 5f71 666f 726d 2829 2c20  mg.get_qform(), 
-00021500: 696d 672e 6765 745f 7366 6f72 6d28 290a  img.get_sform().
-00021510: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00021520: 2020 2020 2020 2020 2020 2073 6176 655f             save_
-00021530: 6669 6c65 203d 2046 616c 7365 0a0a 2020  file = False..  
-00021540: 2020 2020 2020 2020 2020 2320 426f 7468            # Both
-00021550: 206d 6174 6368 2c20 7166 6f72 6d20 7661   match, qform va
-00021560: 6c69 6420 2869 6d70 6c69 6369 7420 7769  lid (implicit wi
-00021570: 7468 206d 6174 6368 292c 2063 6f64 6573  th match), codes
-00021580: 204f 4b0a 2020 2020 2020 2020 2020 2020   OK.            
-00021590: 2320 2d3e 2064 6f20 6e6f 7468 696e 672c  # -> do nothing,
-000215a0: 2065 6d70 7479 2072 6570 6f72 740a 2020   empty report.  
-000215b0: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
-000215c0: 6368 696e 675f 6166 6669 6e65 7320 616e  ching_affines an
-000215d0: 6420 7166 6f72 6d5f 636f 6465 203e 2030  d qform_code > 0
-000215e0: 2061 6e64 2073 666f 726d 5f63 6f64 6520   and sform_code 
-000215f0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00021600: 2020 2020 2073 6176 655f 6669 6c65 203d       save_file =
-00021610: 2054 7275 650a 0a20 2020 2020 2020 2020   True..         
-00021620: 2020 2023 2052 6f77 2032 3a0a 2020 2020     # Row 2:.    
-00021630: 2020 2020 2020 2020 656c 6966 2076 616c          elif val
-00021640: 6964 5f71 666f 726d 2061 6e64 2071 666f  id_qform and qfo
-00021650: 726d 5f63 6f64 6520 3e20 303a 0a20 2020  rm_code > 0:.   
-00021660: 2020 2020 2020 2020 2020 2020 2069 6d67               img
-00021670: 2e73 6574 5f73 666f 726d 2869 6d67 2e67  .set_sform(img.g
-00021680: 6574 5f71 666f 726d 2829 2c20 7166 6f72  et_qform(), qfor
-00021690: 6d5f 636f 6465 290a 2020 2020 2020 2020  m_code).        
-000216a0: 2020 2020 2020 2020 7361 7665 5f66 696c          save_fil
-000216b0: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-000216c0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-000216d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216e0: 2020 2020 225c 6e53 616e 6974 697a 6520      "\nSanitize 
-000216f0: 6272 6963 6b3a 204e 6f74 6520 6f6e 206f  brick: Note on o
-00021700: 7269 656e 7461 7469 6f6e 3a22 0a20 2020  rientation:".   
-00021710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021720: 2022 5c6e 5468 6520 7366 6f72 6d20 6861   "\nThe sform ha
-00021730: 7320 6265 656e 2063 6f70 6965 6420 6672  s been copied fr
-00021740: 6f6d 2071 666f 726d 2e22 0a20 2020 2020  om qform.".     
-00021750: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00021760: 2020 2020 2020 2020 2020 2320 526f 7773            # Rows
-00021770: 2033 2d34 3a0a 2020 2020 2020 2020 2020   3-4:.          
-00021780: 2020 2320 4e6f 7465 3a20 6966 2071 666f    # Note: if qfo
-00021790: 726d 2069 7320 6e6f 7420 7661 6c69 642c  rm is not valid,
-000217a0: 206d 6174 6368 696e 675f 6166 6669 6e65   matching_affine
-000217b0: 7320 6973 2046 616c 7365 0a20 2020 2020  s is False.     
-000217c0: 2020 2020 2020 2065 6c69 6620 7366 6f72         elif sfor
-000217d0: 6d5f 636f 6465 203e 2030 2061 6e64 2028  m_code > 0 and (
-000217e0: 6e6f 7420 6d61 7463 6869 6e67 5f61 6666  not matching_aff
-000217f0: 696e 6573 206f 7220 7166 6f72 6d5f 636f  ines or qform_co
-00021800: 6465 203d 3d20 3029 3a0a 2020 2020 2020  de == 0):.      
-00021810: 2020 2020 2020 2020 2020 696d 672e 7365            img.se
-00021820: 745f 7166 6f72 6d28 696d 672e 6765 745f  t_qform(img.get_
-00021830: 7366 6f72 6d28 292c 2073 666f 726d 5f63  sform(), sform_c
-00021840: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
-00021850: 2020 2020 2073 6176 655f 6669 6c65 203d       save_file =
-00021860: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00021870: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00021880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021890: 2022 5c6e 5361 6e69 7469 7a65 2062 7269   "\nSanitize bri
-000218a0: 636b 3a20 4e6f 7465 206f 6e20 6f72 6965  ck: Note on orie
-000218b0: 6e74 6174 696f 6e3a 220a 2020 2020 2020  ntation:".      
-000218c0: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-000218d0: 6e54 6865 2071 666f 726d 2068 6173 2062  nThe qform has b
-000218e0: 6565 6e20 636f 7069 6564 2066 726f 6d20  een copied from 
-000218f0: 7366 6f72 6d2e 220a 2020 2020 2020 2020  sform.".        
-00021900: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00021910: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00021920: 7420 7661 6c69 645f 7166 6f72 6d20 616e  t valid_qform an
-00021930: 6420 7166 6f72 6d5f 636f 6465 203e 2030  d qform_code > 0
-00021940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021950: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00021960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021970: 2020 2020 2022 5c6e 5361 6e69 7469 7a65       "\nSanitize
-00021980: 2062 7269 636b 2057 4152 4e49 4e47 3a20   brick WARNING: 
-00021990: 496e 7661 6c69 6420 7166 6f72 6d20 220a  Invalid qform ".
-000219a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219b0: 2020 2020 2020 2020 2269 6e66 6f72 6d61          "informa
-000219c0: 7469 6f6e 2e5c 6e54 6865 2071 666f 726d  tion.\nThe qform
-000219d0: 206d 6174 7269 7820 666f 756e 6420 696e   matrix found in
-000219e0: 2074 6865 2066 696c 6520 220a 2020 2020   the file ".    
-000219f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a00: 2020 2020 2268 6561 6465 7220 6973 2069      "header is i
-00021a10: 6e76 616c 6964 2e20 5468 6520 7166 6f72  nvalid. The qfor
-00021a20: 6d20 6861 7320 6265 656e 2063 6f70 6965  m has been copie
-00021a30: 6420 6672 6f6d 2022 0a20 2020 2020 2020  d from ".       
-00021a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a50: 2022 7366 6f72 6d2e 2043 6865 636b 696e   "sform. Checkin
-00021a60: 6720 7468 6520 6f72 6967 696e 616c 2071  g the original q
-00021a70: 666f 726d 2069 6e66 6f72 6d61 7469 6f6e  form information
-00021a80: 2066 726f 6d20 220a 2020 2020 2020 2020   from ".        
-00021a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021aa0: 2274 6865 2064 6174 6120 7072 6f64 7563  "the data produc
-00021ab0: 6564 2062 7920 7468 6520 7363 616e 6e65  ed by the scanne
-00021ac0: 7220 6973 2061 6476 6973 6564 2e22 0a20  r is advised.". 
-00021ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ae0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00021af0: 2020 2320 526f 7773 2035 2d36 3a0a 2020    # Rows 5-6:.  
-00021b00: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00021b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b20: 6166 6669 6e65 203d 2069 6d67 2e61 6666  affine = img.aff
-00021b30: 696e 650a 2020 2020 2020 2020 2020 2020  ine.            
-00021b40: 2020 2020 696d 672e 7365 745f 7366 6f72      img.set_sfor
-00021b50: 6d28 6166 6669 6e65 2c20 6e69 622e 6e69  m(affine, nib.ni
-00021b60: 6674 6931 2e78 666f 726d 5f63 6f64 6573  fti1.xform_codes
-00021b70: 5b22 7363 616e 6e65 7222 5d29 0a20 2020  ["scanner"]).   
-00021b80: 2020 2020 2020 2020 2020 2020 2069 6d67               img
-00021b90: 2e73 6574 5f71 666f 726d 2861 6666 696e  .set_qform(affin
-00021ba0: 652c 206e 6962 2e6e 6966 7469 312e 7866  e, nib.nifti1.xf
-00021bb0: 6f72 6d5f 636f 6465 735b 2273 6361 6e6e  orm_codes["scann
-00021bc0: 6572 225d 290a 2020 2020 2020 2020 2020  er"]).          
-00021bd0: 2020 2020 2020 7361 7665 5f66 696c 6520        save_file 
-00021be0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00021bf0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-00021c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c10: 2020 225c 6e53 616e 6974 697a 6520 6272    "\nSanitize br
-00021c20: 6963 6b20 5741 524e 494e 473a 204d 6973  ick WARNING: Mis
-00021c30: 7369 6e67 206f 7269 656e 7461 7469 6f6e  sing orientation
-00021c40: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00021c50: 2020 2020 2020 2022 696e 666f 726d 6174         "informat
-00021c60: 696f 6e2e 5c6e 4f72 6965 6e74 6174 696f  ion.\nOrientatio
-00021c70: 6e20 696e 666f 726d 6174 696f 6e20 636f  n information co
-00021c80: 756c 6420 6e6f 7420 6265 2022 0a20 2020  uld not be ".   
-00021c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ca0: 2022 7265 7472 6965 7665 6420 6672 6f6d   "retrieved from
-00021cb0: 2074 6865 2069 6d61 6765 2068 6561 6465   the image heade
-00021cc0: 722e 2054 6865 2071 666f 726d 2061 6e64  r. The qform and
-00021cd0: 2073 666f 726d 2022 0a20 2020 2020 2020   sform ".       
-00021ce0: 2020 2020 2020 2020 2020 2020 2022 6d61               "ma
-00021cf0: 7472 6963 6573 2068 6176 6520 6265 656e  trices have been
-00021d00: 2073 6574 2074 6f20 6120 6465 6661 756c   set to a defaul
-00021d10: 7420 4c41 532d 6f72 6965 6e74 6564 2022  t LAS-oriented "
-00021d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021d30: 2020 2020 2022 6166 6669 6e65 2e20 416e       "affine. An
-00021d40: 616c 7973 6573 206f 6620 7468 6973 2064  alyses of this d
-00021d50: 6174 6173 6574 204d 4159 2042 4520 494e  ataset MAY BE IN
-00021d60: 5641 4c49 4421 220a 2020 2020 2020 2020  VALID!".        
-00021d70: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00021d80: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00021d90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00021da0: 2e6d 6178 5f33 3262 6974 2061 6e64 206e  .max_32bit and n
-00021db0: 702e 6474 7970 6528 696d 672e 6765 745f  p.dtype(img.get_
-00021dc0: 6461 7461 5f64 7479 7065 2829 292e 6974  data_dtype()).it
-00021dd0: 656d 7369 7a65 203e 2034 0a20 2020 2020  emsize > 4.     
-00021de0: 2020 2020 2020 2029 206f 7220 7365 6c66         ) or self
-00021df0: 2e6e 5f76 6f6c 756d 6573 5f74 6f5f 6469  .n_volumes_to_di
-00021e00: 7363 6172 643a 0a20 2020 2020 2020 2020  scard:.         
-00021e10: 2020 2020 2020 2023 2066 6f72 6365 2066         # force f
-00021e20: 6c6f 6174 3332 206f 6e6c 7920 6966 2036  loat32 only if 6
-00021e30: 3420 6269 7420 6474 7970 6520 6973 2064  4 bit dtype is d
-00021e40: 6574 6563 7465 640a 2020 2020 2020 2020  etected.        
-00021e50: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00021e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e70: 2073 656c 662e 6d61 785f 3332 6269 740a   self.max_32bit.
-00021e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e90: 2020 2020 616e 6420 6e70 2e64 7479 7065      and np.dtype
-00021ea0: 2869 6d67 2e67 6574 5f64 6174 615f 6474  (img.get_data_dt
-00021eb0: 7970 6528 2929 2e69 7465 6d73 697a 6520  ype()).itemsize 
-00021ec0: 3e20 340a 2020 2020 2020 2020 2020 2020  > 4.            
-00021ed0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00021ee0: 2020 2020 2020 2020 2020 2069 6e5f 6461             in_da
-00021ef0: 7461 203d 2069 6d67 2e67 6574 5f66 6461  ta = img.get_fda
-00021f00: 7461 2864 7479 7065 3d6e 702e 666c 6f61  ta(dtype=np.floa
-00021f10: 7433 3229 0a20 2020 2020 2020 2020 2020  t32).           
-00021f20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00021f30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021f40: 6e5f 6461 7461 203d 2069 6d67 2e64 6174  n_data = img.dat
-00021f50: 616f 626a 0a0a 2020 2020 2020 2020 2020  aobj..          
-00021f60: 2020 2020 2020 2320 666d 743a 206f 6666        # fmt: off
-00021f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021f80: 2069 6d67 203d 206e 6962 2e4e 6966 7469   img = nib.Nifti
-00021f90: 3149 6d61 6765 280a 2020 2020 2020 2020  1Image(.        
-00021fa0: 2020 2020 2020 2020 2020 2020 696e 5f64              in_d
-00021fb0: 6174 615b 3a2c 203a 2c20 3a2c 2073 656c  ata[:, :, :, sel
-00021fc0: 662e 6e5f 766f 6c75 6d65 735f 746f 5f64  f.n_volumes_to_d
-00021fd0: 6973 6361 7264 3a5d 2c0a 2020 2020 2020  iscard:],.      
-00021fe0: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00021ff0: 672e 6166 6669 6e65 2c0a 2020 2020 2020  g.affine,.      
-00022000: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00022010: 672e 6865 6164 6572 2c0a 2020 2020 2020  g.header,.      
-00022020: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00022030: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
-00022040: 743a 206f 6e0a 2020 2020 2020 2020 2020  t: on.          
-00022050: 2020 2020 2020 7361 7665 5f66 696c 6520        save_file 
-00022060: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
-00022070: 2020 2020 6966 206c 656e 2869 6d67 2e68      if len(img.h
-00022080: 6561 6465 722e 6578 7465 6e73 696f 6e73  eader.extensions
-00022090: 2920 213d 2030 3a0a 2020 2020 2020 2020  ) != 0:.        
-000220a0: 2020 2020 2020 2020 696d 672e 6865 6164          img.head
-000220b0: 6572 2e65 7874 656e 7369 6f6e 732e 636c  er.extensions.cl
-000220c0: 6561 7228 290a 2020 2020 2020 2020 2020  ear().          
-000220d0: 2020 2020 2020 7361 7665 5f66 696c 6520        save_file 
-000220e0: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
-000220f0: 2020 2020 2320 5374 6f72 6520 6e65 7720      # Store new 
-00022100: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00022110: 2069 6620 7361 7665 5f66 696c 653a 0a20   if save_file:. 
-00022120: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00022130: 2049 6d61 6765 2073 6176 650a 2020 2020   Image save.    
-00022140: 2020 2020 2020 2020 2020 2020 5f2c 2066              _, f
-00022150: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
-00022160: 7468 2e73 706c 6974 2866 696c 655f 6e61  th.split(file_na
-00022170: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00022180: 2020 2020 6669 6c65 5f6e 616d 655f 6e6f      file_name_no
-00022190: 5f65 7874 2c20 6669 6c65 5f65 7874 656e  _ext, file_exten
-000221a0: 7369 6f6e 203d 206f 732e 7061 7468 2e73  sion = os.path.s
-000221b0: 706c 6974 6578 7428 6669 6c65 5f6e 616d  plitext(file_nam
-000221c0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000221d0: 2020 2069 6620 6669 6c65 5f65 7874 656e     if file_exten
-000221e0: 7369 6f6e 203d 3d20 222e 677a 223a 0a20  sion == ".gz":. 
-000221f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022200: 2020 2028 6669 6c65 5f6e 616d 655f 6e6f     (file_name_no
-00022210: 5f65 7874 5f32 2c20 6669 6c65 5f65 7874  _ext_2, file_ext
-00022220: 656e 7369 6f6e 5f32 2920 3d20 6f73 2e70  ension_2) = os.p
-00022230: 6174 682e 7370 6c69 7465 7874 280a 2020  ath.splitext(.  
-00022240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022250: 2020 2020 2020 6669 6c65 5f6e 616d 655f        file_name_
-00022260: 6e6f 5f65 7874 0a20 2020 2020 2020 2020  no_ext.         
-00022270: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00022280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022290: 2069 6620 6669 6c65 5f65 7874 656e 7369   if file_extensi
-000222a0: 6f6e 5f32 203d 3d20 222e 6e69 6922 3a0a  on_2 == ".nii":.
-000222b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222c0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-000222d0: 655f 6e6f 5f65 7874 203d 2066 696c 655f  e_no_ext = file_
-000222e0: 6e61 6d65 5f6e 6f5f 6578 745f 320a 2020  name_no_ext_2.  
-000222f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022300: 2020 2020 2020 6669 6c65 5f65 7874 656e        file_exten
-00022310: 7369 6f6e 203d 2022 2e6e 6969 2e67 7a22  sion = ".nii.gz"
-00022320: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00022330: 2020 6669 6c65 5f6f 7574 203d 206f 732e    file_out = os.
-00022340: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
-00022350: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00022360: 656c 662e 6f75 7470 7574 5f64 6972 6563  elf.output_direc
-00022370: 746f 7279 2c0a 2020 2020 2020 2020 2020  tory,.          
-00022380: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-00022390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000223a0: 2020 2020 7365 6c66 2e70 7265 6669 782e      self.prefix.
-000223b0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-000223c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000223d0: 2b20 6669 6c65 5f6e 616d 655f 6e6f 5f65  + file_name_no_e
-000223e0: 7874 0a20 2020 2020 2020 2020 2020 2020  xt.             
-000223f0: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
-00022400: 662e 7375 6666 6978 2e73 7472 6970 2829  f.suffix.strip()
-00022410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022420: 2020 2020 2020 2020 202b 2066 696c 655f           + file_
-00022430: 6578 7465 6e73 696f 6e0a 2020 2020 2020  extension.      
-00022440: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-00022450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022460: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00022470: 2020 206e 6962 2e73 6176 6528 696d 672c     nib.save(img,
-00022480: 2066 696c 655f 6f75 7429 0a0a 0a63 6c61   file_out)...cla
-00022490: 7373 2054 534e 5228 5072 6f63 6573 734d  ss TSNR(ProcessM
-000224a0: 4941 293a 0a20 2020 2022 2222 0a20 2020  IA):.    """.   
-000224b0: 202a 436f 6d70 7574 6573 2074 6865 2074   *Computes the t
-000224c0: 696d 652d 636f 7572 7365 2053 4e52 2066  ime-course SNR f
-000224d0: 6f72 2061 2074 696d 6520 7365 7269 6573  or a time series
-000224e0: 2a0a 0a20 2020 2050 6c65 6173 652c 2073  *..    Please, s
-000224f0: 6565 2074 6865 2063 6f6d 706c 6574 6520  ee the complete 
-00022500: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
-00022510: 7220 7468 650a 2020 2020 6054 534e 5220  r the.    `TSNR 
-00022520: 6272 6963 6b20 696e 2074 6865 206d 6961  brick in the mia
-00022530: 5f70 726f 6365 7373 6573 2077 6562 7369  _processes websi
-00022540: 7465 0a20 2020 203c 6874 7470 733a 2f2f  te.    <https://
-00022550: 706f 7075 6c73 652e 6769 7468 7562 2e69  populse.github.i
-00022560: 6f2f 6d69 615f 7072 6f63 6573 7365 732f  o/mia_processes/
-00022570: 6874 6d6c 2f64 6f63 756d 656e 7461 7469  html/documentati
-00022580: 6f6e 2f62 7269 636b 732f 7072 6570 726f  on/bricks/prepro
-00022590: 6365 7373 2f6f 7468 6572 2f54 534e 522e  cess/other/TSNR.
-000225a0: 6874 6d6c 3e60 5f0a 0a20 2020 2061 6461  html>`_..    ada
-000225b0: 7074 6564 2066 726f 6d3a 0a20 2020 2068  pted from:.    h
-000225c0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-000225d0: 6d2f 6e69 7079 2f6e 6970 7970 652f 626c  m/nipy/nipype/bl
-000225e0: 6f62 2f66 3636 3261 6366 6365 3864 6566  ob/f662acfce8def
-000225f0: 3437 3137 6530 6333 3431 3436 3138 6633  4717e0c3414618f3
-00022600: 6135 6465 3539 3133 6233 312f 6e69 7079  a5de5913b31/nipy
-00022610: 7065 2f61 6c67 6f72 6974 686d 732f 636f  pe/algorithms/co
-00022620: 6e66 6f75 6e64 732e 7079 234c 3839 390a  nfounds.py#L899.
-00022630: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00022640: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
-00022650: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
-00022660: 6963 6174 6564 2074 6f20 7468 6520 6174  icated to the at
-00022670: 7472 6962 7574 6573 2069 6e69 7469 616c  tributes initial
-00022680: 6973 6174 696f 6e20 2f20 696e 7374 616e  isation / instan
-00022690: 7469 6174 696f 6e2e 0a0a 2020 2020 2020  tiation...      
-000226a0: 2020 5468 6520 696e 7075 7420 616e 6420    The input and 
-000226b0: 6f75 7470 7574 2070 6c75 6773 2061 7265  output plugs are
-000226c0: 2064 6566 696e 6564 2068 6572 652e 2054   defined here. T
-000226d0: 6865 2073 7065 6369 616c 0a20 2020 2020  he special.     
-000226e0: 2020 2027 7365 6c66 2e72 6571 7569 7265     'self.require
-000226f0: 6d65 6e74 2720 6174 7472 6962 7574 6520  ment' attribute 
-00022700: 286f 7074 696f 6e61 6c29 2069 7320 7573  (optional) is us
-00022710: 6564 2074 6f20 6465 6669 6e65 2074 6865  ed to define the
-00022720: 0a20 2020 2020 2020 2074 6869 7264 2d70  .        third-p
-00022730: 6172 7479 2070 726f 6475 6374 7320 6e65  arty products ne
-00022740: 6365 7373 6172 7920 666f 7220 7468 6520  cessary for the 
-00022750: 7275 6e6e 696e 6720 6f66 2074 6865 2062  running of the b
-00022760: 7269 636b 2e0a 2020 2020 2020 2020 2222  rick..        ""
-00022770: 220a 2020 2020 2020 2020 2320 496e 6974  ".        # Init
-00022780: 6961 6c69 7361 7469 6f6e 206f 6620 7468  ialisation of th
-00022790: 6520 6f62 6a65 6374 7320 6e65 6564 6564  e objects needed
-000227a0: 2066 6f72 2074 6865 206c 6175 6e63 6820   for the launch 
-000227b0: 6f66 2074 6865 2062 7269 636b 0a20 2020  of the brick.   
-000227c0: 2020 2020 2073 7570 6572 2854 534e 522c       super(TSNR,
-000227d0: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-000227e0: 290a 0a20 2020 2020 2020 2023 2054 6869  )..        # Thi
-000227f0: 7264 2070 6172 7479 2073 6f66 7477 6172  rd party softwar
-00022800: 6573 2072 6571 7569 7265 6420 666f 7220  es required for 
-00022810: 7468 6520 6578 6563 7574 696f 6e20 6f66  the execution of
-00022820: 2074 6865 2062 7269 636b 0a20 2020 2020   the brick.     
-00022830: 2020 2073 656c 662e 7265 7175 6972 656d     self.requirem
-00022840: 656e 7420 3d20 5b5d 0a0a 2020 2020 2020  ent = []..      
-00022850: 2020 2320 496e 7075 7473 2064 6573 6372    # Inputs descr
-00022860: 6970 7469 6f6e 0a20 2020 2020 2020 2069  iption.        i
-00022870: 6e5f 6669 6c65 5f64 6573 6320 3d20 2241  n_file_desc = "A
-00022880: 6e20 6578 6973 7469 6e67 2070 6174 6820  n existing path 
-00022890: 6669 6c65 2e22 0a20 2020 2020 2020 2070  file.".        p
-000228a0: 7265 6669 785f 7473 6e72 5f64 6573 6320  refix_tsnr_desc 
-000228b0: 3d20 2250 7265 6669 7820 6f66 2074 6865  = "Prefix of the
-000228c0: 2074 736e 7220 696d 6167 6520 2861 2073   tsnr image (a s
-000228d0: 7472 696e 6729 2e22 0a20 2020 2020 2020  tring).".       
-000228e0: 2073 7566 6669 785f 7473 6e72 5f64 6573   suffix_tsnr_des
-000228f0: 6320 3d20 2253 7566 6669 7820 6f66 2074  c = "Suffix of t
-00022900: 6865 2074 736e 7220 696d 6167 6520 2861  he tsnr image (a
-00022910: 2073 7472 696e 6729 2e22 0a20 2020 2020   string).".     
-00022920: 2020 2070 7265 6669 785f 7374 6464 6576     prefix_stddev
-00022930: 5f64 6573 6320 3d20 2250 7265 6669 7820  _desc = "Prefix 
-00022940: 6f66 2074 6865 2074 736e 7220 696d 6167  of the tsnr imag
-00022950: 6520 2861 2073 7472 696e 6729 2e22 0a20  e (a string).". 
-00022960: 2020 2020 2020 2073 7566 6669 785f 7374         suffix_st
-00022970: 6464 6576 5f64 6573 6320 3d20 2253 7566  ddev_desc = "Suf
-00022980: 6669 7820 6f66 2074 6865 2074 736e 7220  fix of the tsnr 
-00022990: 696d 6167 6520 2861 2073 7472 696e 6729  image (a string)
-000229a0: 2e22 0a0a 2020 2020 2020 2020 2320 4f75  ."..        # Ou
-000229b0: 7470 7574 7320 6465 7363 7269 7074 696f  tputs descriptio
-000229c0: 6e0a 2020 2020 2020 2020 6f75 745f 7473  n.        out_ts
-000229d0: 6e72 5f66 696c 655f 6465 7363 203d 2028  nr_file_desc = (
-000229e0: 0a20 2020 2020 2020 2020 2020 2022 5061  .            "Pa
-000229f0: 7468 206f 6620 7468 6520 7363 616e 2061  th of the scan a
-00022a00: 6674 6572 206d 6173 6b69 6e67 2022 0a20  fter masking ". 
-00022a10: 2020 2020 2020 2020 2020 2022 2861 2070             "(a p
-00022a20: 6174 686c 696b 6520 6f62 6a65 6374 206f  athlike object o
-00022a30: 7220 7374 7269 6e67 2072 6570 7265 7365  r string represe
-00022a40: 6e74 696e 6720 6120 6669 6c65 292e 220a  nting a file).".
-00022a50: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00022a60: 2020 206f 7574 5f73 7464 6465 765f 6669     out_stddev_fi
-00022a70: 6c65 5f64 6573 6320 3d20 280a 2020 2020  le_desc = (.    
-00022a80: 2020 2020 2020 2020 2250 6174 6820 6f66          "Path of
-00022a90: 2074 6865 2073 6361 6e20 6166 7465 7220   the scan after 
-00022aa0: 6d61 736b 696e 6720 220a 2020 2020 2020  masking ".      
-00022ab0: 2020 2020 2020 2228 6120 7061 7468 6c69        "(a pathli
-00022ac0: 6b65 206f 626a 6563 7420 6f72 2073 7472  ke object or str
-00022ad0: 696e 6720 7265 7072 6573 656e 7469 6e67  ing representing
-00022ae0: 2061 2066 696c 6529 2e22 0a20 2020 2020   a file).".     
-00022af0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00022b00: 496e 7075 7473 2074 7261 6974 730a 2020  Inputs traits.  
-00022b10: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
-00022b20: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
-00022b30: 2020 2269 6e5f 6669 6c65 222c 2046 696c    "in_file", Fil
-00022b40: 6528 6f75 7470 7574 3d46 616c 7365 2c20  e(output=False, 
-00022b50: 6f70 7469 6f6e 616c 3d46 616c 7365 2c20  optional=False, 
-00022b60: 6465 7363 3d69 6e5f 6669 6c65 5f64 6573  desc=in_file_des
-00022b70: 6329 0a20 2020 2020 2020 2029 0a0a 2020  c).        )..  
-00022b80: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
-00022b90: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
-00022ba0: 2020 2270 7265 6669 785f 7473 6e72 222c    "prefix_tsnr",
-00022bb0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-00022bc0: 6974 732e 5374 7269 6e67 280a 2020 2020  its.String(.    
-00022bd0: 2020 2020 2020 2020 2020 2020 2222 2c20              "", 
-00022be0: 6f75 7470 7574 3d46 616c 7365 2c20 6f70  output=False, op
-00022bf0: 7469 6f6e 616c 3d54 7275 652c 2064 6573  tional=True, des
-00022c00: 633d 7072 6566 6978 5f74 736e 725f 6465  c=prefix_tsnr_de
-00022c10: 7363 0a20 2020 2020 2020 2020 2020 2029  sc.            )
-00022c20: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00022c30: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
-00022c40: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
-00022c50: 2022 7375 6666 6978 5f74 736e 7222 2c0a   "suffix_tsnr",.
-00022c60: 2020 2020 2020 2020 2020 2020 7472 6169              trai
-00022c70: 7473 2e53 7472 696e 6728 0a20 2020 2020  ts.String(.     
-00022c80: 2020 2020 2020 2020 2020 2022 5f74 736e             "_tsn
-00022c90: 7222 2c20 6f75 7470 7574 3d46 616c 7365  r", output=False
-00022ca0: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
-00022cb0: 2064 6573 633d 7375 6666 6978 5f74 736e   desc=suffix_tsn
-00022cc0: 725f 6465 7363 0a20 2020 2020 2020 2020  r_desc.         
-00022cd0: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
-00022ce0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00022cf0: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
-00022d00: 2020 2020 2022 7072 6566 6978 5f73 7464       "prefix_std
-00022d10: 6465 7622 2c0a 2020 2020 2020 2020 2020  dev",.          
-00022d20: 2020 7472 6169 7473 2e53 7472 696e 6728    traits.String(
-00022d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022d40: 2022 222c 206f 7574 7075 743d 4661 6c73   "", output=Fals
-00022d50: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
-00022d60: 2c20 6465 7363 3d70 7265 6669 785f 7374  , desc=prefix_st
-00022d70: 6464 6576 5f64 6573 630a 2020 2020 2020  ddev_desc.      
-00022d80: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-00022d90: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-00022da0: 2e61 6464 5f74 7261 6974 280a 2020 2020  .add_trait(.    
-00022db0: 2020 2020 2020 2020 2273 7566 6669 785f          "suffix_
-00022dc0: 7374 6464 6576 222c 0a20 2020 2020 2020  stddev",.       
-00022dd0: 2020 2020 2074 7261 6974 732e 5374 7269       traits.Stri
-00022de0: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
-00022df0: 2020 2020 225f 7374 6464 6576 222c 206f      "_stddev", o
-00022e00: 7574 7075 743d 4661 6c73 652c 206f 7074  utput=False, opt
-00022e10: 696f 6e61 6c3d 5472 7565 2c20 6465 7363  ional=True, desc
-00022e20: 3d73 7566 6669 785f 7374 6464 6576 5f64  =suffix_stddev_d
-00022e30: 6573 630a 2020 2020 2020 2020 2020 2020  esc.            
-00022e40: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-00022e50: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
-00022e60: 7472 6169 7473 0a20 2020 2020 2020 2073  traits.        s
-00022e70: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-00022e80: 2020 2020 2020 2020 2020 2022 6f75 745f             "out_
-00022e90: 7473 6e72 5f66 696c 6522 2c20 4669 6c65  tsnr_file", File
-00022ea0: 286f 7574 7075 743d 5472 7565 2c20 6465  (output=True, de
-00022eb0: 7363 3d6f 7574 5f74 736e 725f 6669 6c65  sc=out_tsnr_file
-00022ec0: 5f64 6573 6329 0a20 2020 2020 2020 2029  _desc).        )
-00022ed0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00022ee0: 6464 5f74 7261 6974 280a 2020 2020 2020  dd_trait(.      
-00022ef0: 2020 2020 2020 226f 7574 5f73 7464 6465        "out_stdde
-00022f00: 765f 6669 6c65 222c 0a20 2020 2020 2020  v_file",.       
-00022f10: 2020 2020 2046 696c 6528 6f75 7470 7574       File(output
-00022f20: 3d54 7275 652c 206f 7074 696f 6e61 6c3d  =True, optional=
-00022f30: 5472 7565 2c20 6465 7363 3d6f 7574 5f73  True, desc=out_s
-00022f40: 7464 6465 765f 6669 6c65 5f64 6573 6329  tddev_file_desc)
-00022f50: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00022f60: 2020 2020 2073 656c 662e 696e 6974 5f64       self.init_d
-00022f70: 6566 6175 6c74 5f74 7261 6974 7328 290a  efault_traits().
-00022f80: 0a20 2020 2064 6566 206c 6973 745f 6f75  .    def list_ou
-00022f90: 7470 7574 7328 7365 6c66 2c20 6973 5f70  tputs(self, is_p
-00022fa0: 6c75 6767 6564 3d4e 6f6e 6529 3a0a 2020  lugged=None):.  
-00022fb0: 2020 2020 2020 2222 2244 6564 6963 6174        """Dedicat
-00022fc0: 6564 2074 6f20 7468 6520 696e 6974 6961  ed to the initia
-00022fd0: 6c69 7361 7469 6f6e 2073 7465 7020 6f66  lisation step of
-00022fe0: 2074 6865 2062 7269 636b 2e0a 0a20 2020   the brick...   
-00022ff0: 2020 2020 2054 6865 206d 6169 6e20 6f62       The main ob
-00023000: 6a65 6374 6976 6520 6f66 2074 6869 7320  jective of this 
-00023010: 6d65 7468 6f64 2069 7320 746f 2070 726f  method is to pro
-00023020: 6475 6365 2074 6865 206f 7574 7075 7473  duce the outputs
-00023030: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00023040: 6272 6963 6b73 2028 7365 6c66 2e6f 7574  bricks (self.out
-00023050: 7075 7473 2920 616e 6420 7468 6520 6173  puts) and the as
-00023060: 736f 6369 6174 6564 2074 6167 7320 2873  sociated tags (s
-00023070: 656c 662e 696e 6865 7269 7461 6e63 655f  elf.inheritance_
-00023080: 6469 6329 2c0a 2020 2020 2020 2020 6966  dic),.        if
-00023090: 2064 6566 696e 6564 2068 6572 652e 2054   defined here. T
-000230a0: 6f20 776f 726b 2070 726f 7065 726c 7920  o work properly 
-000230b0: 7468 6973 206d 6574 686f 6420 6d75 7374  this method must
-000230c0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-000230d0: 7365 6c66 2e6d 616b 655f 696e 6974 5265  self.make_initRe
-000230e0: 7375 6c74 2829 206f 626a 6563 742e 0a0a  sult() object...
-000230f0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-00023100: 735f 706c 7567 6765 643a 2074 6865 2073  s_plugged: the s
-00023110: 7461 7465 2c20 6c69 6e6b 6564 206f 7220  tate, linked or 
-00023120: 6e6f 742c 206f 6620 7468 6520 706c 7567  not, of the plug
-00023130: 732e 0a20 2020 2020 2020 203a 7265 7475  s..        :retu
-00023140: 726e 733a 2061 2064 6963 7469 6f6e 6172  rns: a dictionar
-00023150: 7920 7769 7468 2072 6571 7569 7265 6d65  y with requireme
-00023160: 6e74 2c20 6f75 7470 7574 7320 616e 6420  nt, outputs and 
-00023170: 696e 6865 7269 7461 6e63 655f 6469 6374  inheritance_dict
-00023180: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00023190: 2020 2020 2020 2320 5573 696e 6720 7468        # Using th
-000231a0: 6520 696e 6865 7269 7461 6e63 6520 746f  e inheritance to
-000231b0: 2050 726f 6365 7373 4d49 4120 636c 6173   ProcessMIA clas
-000231c0: 732c 206c 6973 745f 6f75 7470 7574 7320  s, list_outputs 
-000231d0: 6d65 7468 6f64 0a20 2020 2020 2020 2073  method.        s
-000231e0: 7570 6572 2854 534e 522c 2073 656c 6629  uper(TSNR, self)
-000231f0: 2e6c 6973 745f 6f75 7470 7574 7328 290a  .list_outputs().
-00023200: 0a20 2020 2020 2020 2023 204f 7574 7075  .        # Outpu
-00023210: 7473 2064 6566 696e 6974 696f 6e0a 2020  ts definition.  
-00023220: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
-00023230: 5f66 696c 653a 0a20 2020 2020 2020 2020  _file:.         
-00023240: 2020 2076 616c 6964 5f65 7874 2c20 696e     valid_ext, in
-00023250: 5f65 7874 2c20 6669 6c65 4e61 6d65 203d  _ext, fileName =
-00023260: 2063 6865 636b 4669 6c65 4578 7428 7365   checkFileExt(se
-00023270: 6c66 2e69 6e5f 6669 6c65 2c20 4558 5429  lf.in_file, EXT)
-00023280: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00023290: 206e 6f74 2076 616c 6964 5f65 7874 3a0a   not valid_ext:.
+00020a10: 2020 2020 2020 2020 225c 6e52 6f74 6174          "\nRotat
+00020a20: 696f 6e4d 6173 6b20 6272 6963 6b20 4162  ionMask brick Ab
+00020a30: 6f72 7465 642e 2050 6c65 6173 6520 6368  orted. Please ch
+00020a40: 6563 6b20 796f 7572 2022 0a20 2020 2020  eck your ".     
+00020a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a60: 2020 2022 696e 7075 7420 7061 7261 6d65     "input parame
+00020a70: 7465 7273 202e 2e2e 220a 2020 2020 2020  ters ...".      
+00020a80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00020a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020aa0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00020ab0: 2020 2020 2020 2020 6669 6c65 203d 206f          file = o
+00020ac0: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+00020ad0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00020ae0: 662e 6f75 7470 7574 5f64 6972 6563 746f  f.output_directo
+00020af0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+00020b00: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+00020b10: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00020b20: 7265 6669 782e 7374 7269 7028 290a 2020  refix.strip().  
+00020b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b40: 2020 2b20 6669 6c65 4e61 6d65 0a20 2020    + fileName.   
+00020b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b60: 202b 2073 656c 662e 7375 6666 6978 2e73   + self.suffix.s
+00020b70: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+00020b80: 2020 2020 2020 2020 2020 202b 2022 2e22             + "."
+00020b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020ba0: 2020 2020 202b 2069 6e5f 6578 740a 2020       + in_ext.  
+00020bb0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00020bc0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00020bd0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00020be0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+00020bf0: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
+00020c00: 735b 226f 7574 5f66 696c 6522 5d20 3d20  s["out_file"] = 
+00020c10: 6669 6c65 0a0a 2020 2020 2020 2020 2020  file..          
+00020c20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00020c30: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00020c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c50: 2020 2022 2d20 526f 7461 7469 6f6e 4d61     "- RotationMa
+00020c60: 736b 2062 7269 636b 3a20 5468 6572 6520  sk brick: There 
+00020c70: 7761 7320 6e6f 206f 7574 7075 7420 6669  was no output fi
+00020c80: 6c65 2064 6564 7563 7465 6420 220a 2020  le deducted ".  
+00020c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ca0: 2020 2264 7572 696e 6720 696e 6974 6961    "during initia
+00020cb0: 6c69 7a61 7469 6f6e 2e20 506c 6561 7365  lization. Please
+00020cc0: 2063 6865 636b 2074 6865 2069 6e70 7574   check the input
+00020cd0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00020ce0: 2020 2020 2020 2022 7061 7261 6d65 7465         "paramete
+00020cf0: 7273 2e2e 2e21 220a 2020 2020 2020 2020  rs...!".        
+00020d00: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00020d10: 2020 2020 2020 2023 2074 6167 7320 696e         # tags in
+00020d20: 6865 7269 7461 6e63 6520 286f 7074 696f  heritance (optio
+00020d30: 6e61 6c29 0a20 2020 2020 2020 2020 2020  nal).           
+00020d40: 2069 6620 7365 6c66 2e6f 7574 7075 7473   if self.outputs
+00020d50: 5b22 6f75 745f 6669 6c65 225d 3a0a 2020  ["out_file"]:.  
+00020d60: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00020d70: 6c66 2e74 6167 735f 696e 6865 7269 7461  lf.tags_inherita
+00020d80: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+00020d90: 2020 2020 2020 2020 2069 6e5f 6669 6c65           in_file
+00020da0: 3d73 656c 662e 696e 5f66 696c 652c 0a20  =self.in_file,. 
+00020db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020dc0: 2020 206f 7574 5f66 696c 653d 7365 6c66     out_file=self
+00020dd0: 2e6f 7574 7075 7473 5b22 6f75 745f 6669  .outputs["out_fi
+00020de0: 6c65 225d 2c0a 2020 2020 2020 2020 2020  le"],.          
+00020df0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00020e00: 2023 2052 6574 7572 6e20 7468 6520 7265   # Return the re
+00020e10: 7175 6972 656d 656e 742c 206f 7574 7075  quirement, outpu
+00020e20: 7473 2061 6e64 2069 6e68 6572 6974 616e  ts and inheritan
+00020e30: 6365 5f64 6963 740a 2020 2020 2020 2020  ce_dict.        
+00020e40: 7265 7475 726e 2073 656c 662e 6d61 6b65  return self.make
+00020e50: 5f69 6e69 7452 6573 756c 7428 290a 0a20  _initResult().. 
+00020e60: 2020 2064 6566 2072 756e 5f70 726f 6365     def run_proce
+00020e70: 7373 5f6d 6961 2873 656c 6629 3a0a 2020  ss_mia(self):.  
+00020e80: 2020 2020 2020 2222 2244 6564 6963 6174        """Dedicat
+00020e90: 6564 2074 6f20 7468 6520 7072 6f63 6573  ed to the proces
+00020ea0: 7320 6c61 756e 6368 2073 7465 7020 6f66  s launch step of
+00020eb0: 2074 6865 2062 7269 636b 2e22 2222 0a20   the brick.""". 
+00020ec0: 2020 2020 2020 2073 7570 6572 2852 6f74         super(Rot
+00020ed0: 6174 696f 6e4d 6173 6b2c 2073 656c 6629  ationMask, self)
+00020ee0: 2e72 756e 5f70 726f 6365 7373 5f6d 6961  .run_process_mia
+00020ef0: 2829 0a0a 2020 2020 2020 2020 6669 6c65  ()..        file
+00020f00: 5f6e 616d 6520 3d20 7365 6c66 2e69 6e5f  _name = self.in_
+00020f10: 6669 6c65 0a0a 2020 2020 2020 2020 2320  file..        # 
+00020f20: 496d 6167 6520 7072 6f63 6573 7369 6e67  Image processing
+00020f30: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00020f40: 2020 2020 2020 2020 2020 696d 6720 3d20            img = 
+00020f50: 6e69 622e 6c6f 6164 2866 696c 655f 6e61  nib.load(file_na
+00020f60: 6d65 290a 0a20 2020 2020 2020 2065 7863  me)..        exc
+00020f70: 6570 7420 280a 2020 2020 2020 2020 2020  ept (.          
+00020f80: 2020 6e69 622e 6669 6c65 6261 7365 6469    nib.filebasedi
+00020f90: 6d61 6765 732e 496d 6167 6546 696c 6545  mages.ImageFileE
+00020fa0: 7272 6f72 2c0a 2020 2020 2020 2020 2020  rror,.          
+00020fb0: 2020 4669 6c65 4e6f 7446 6f75 6e64 4572    FileNotFoundEr
+00020fc0: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
+00020fd0: 2054 7970 6545 7272 6f72 2c0a 2020 2020   TypeError,.    
+00020fe0: 2020 2020 2920 6173 2065 3a0a 2020 2020      ) as e:.    
+00020ff0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00021000: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00021010: 5c6e 526f 7461 7469 6f6e 4d61 736b 2062  \nRotationMask b
+00021020: 7269 636b 3a20 4572 726f 7220 7769 7468  rick: Error with
+00021030: 2066 696c 6573 2074 6f20 6d61 736b 2c20   files to mask, 
+00021040: 6475 7269 6e67 2074 6865 2022 0a20 2020  during the ".   
+00021050: 2020 2020 2020 2020 2020 2020 2022 7275               "ru
+00021060: 6e3a 2022 2c0a 2020 2020 2020 2020 2020  n: ",.          
+00021070: 2020 2020 2020 652c 0a20 2020 2020 2020        e,.       
+00021080: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00021090: 2020 2069 6d67 203d 204e 6f6e 650a 0a20     img = None.. 
+000210a0: 2020 2020 2020 2069 6620 696d 6720 6973         if img is
+000210b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000210c0: 2020 2020 2020 2064 6174 6120 3d20 696d         data = im
+000210d0: 672e 6765 745f 6664 6174 6128 290a 2020  g.get_fdata().  
+000210e0: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
+000210f0: 2064 6174 6120 3c3d 2030 0a0a 2020 2020   data <= 0..    
+00021100: 2020 2020 2020 2020 2320 5061 6420 6f6e          # Pad on
+00021110: 6520 7069 7865 6c20 746f 2063 6f6e 7472  e pixel to contr
+00021120: 6f6c 2062 6568 6176 696f 7220 6f6e 2062  ol behavior on b
+00021130: 6f72 6465 7273 206f 6620 6269 6e61 7279  orders of binary
+00021140: 5f6f 7065 6e69 6e67 0a20 2020 2020 2020  _opening.       
+00021150: 2020 2020 206d 6173 6b20 3d20 6e70 2e70       mask = np.p
+00021160: 6164 280a 2020 2020 2020 2020 2020 2020  ad(.            
+00021170: 2020 2020 6d61 736b 2c20 7061 645f 7769      mask, pad_wi
+00021180: 6474 683d 2831 2c29 2c20 6d6f 6465 3d22  dth=(1,), mode="
+00021190: 636f 6e73 7461 6e74 222c 2063 6f6e 7374  constant", const
+000211a0: 616e 745f 7661 6c75 6573 3d31 0a20 2020  ant_values=1.   
+000211b0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000211c0: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
+000211d0: 206e 6f69 7365 0a20 2020 2020 2020 2020   noise.         
+000211e0: 2020 2073 7472 7563 203d 2073 696d 2e67     struc = sim.g
+000211f0: 656e 6572 6174 655f 6269 6e61 7279 5f73  enerate_binary_s
+00021200: 7472 7563 7475 7265 2833 2c20 3229 0a20  tructure(3, 2). 
+00021210: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
+00021220: 3d20 7369 6d2e 6269 6e61 7279 5f6f 7065  = sim.binary_ope
+00021230: 6e69 6e67 286d 6173 6b2c 2073 7472 7563  ning(mask, struc
+00021240: 7475 7265 3d73 7472 7563 292e 6173 7479  ture=struc).asty
+00021250: 7065 286e 702e 7569 6e74 3829 0a0a 2020  pe(np.uint8)..  
+00021260: 2020 2020 2020 2020 2020 2320 5265 6d6f            # Remo
+00021270: 7665 2073 6d61 6c6c 206f 626a 6563 7473  ve small objects
+00021280: 0a20 2020 2020 2020 2020 2020 206c 6162  .            lab
+00021290: 656c 5f69 6d2c 206e 625f 6c61 6265 6c73  el_im, nb_labels
+000212a0: 203d 2073 696d 2e6c 6162 656c 286d 6173   = sim.label(mas
+000212b0: 6b29 0a20 2020 2020 2020 2020 2020 2069  k).            i
+000212c0: 6620 6e62 5f6c 6162 656c 7320 3e20 323a  f nb_labels > 2:
+000212d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000212e0: 2073 697a 6573 203d 2073 696d 2e73 756d   sizes = sim.sum
+000212f0: 286d 6173 6b2c 206c 6162 656c 5f69 6d2c  (mask, label_im,
+00021300: 206c 6973 7428 7261 6e67 6528 6e62 5f6c   list(range(nb_l
+00021310: 6162 656c 7320 2b20 3129 2929 0a20 2020  abels + 1))).   
+00021320: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+00021330: 6572 6564 203d 206c 6973 7428 0a20 2020  ered = list(.   
+00021340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021350: 2072 6576 6572 7365 6428 736f 7274 6564   reversed(sorted
+00021360: 287a 6970 2873 697a 6573 2c20 6c69 7374  (zip(sizes, list
+00021370: 2872 616e 6765 286e 625f 6c61 6265 6c73  (range(nb_labels
+00021380: 202b 2031 2929 2929 290a 2020 2020 2020   + 1))))).      
+00021390: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000213a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000213b0: 5f2c 206c 6162 656c 2069 6e20 6f72 6465  _, label in orde
+000213c0: 7265 645b 323a 5d3a 0a20 2020 2020 2020  red[2:]:.       
+000213d0: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+000213e0: 6b5b 6c61 6265 6c5f 696d 203d 3d20 6c61  k[label_im == la
+000213f0: 6265 6c5d 203d 2030 0a0a 2020 2020 2020  bel] = 0..      
+00021400: 2020 2020 2020 2320 556e 2d70 6164 0a20        # Un-pad. 
+00021410: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
+00021420: 3d20 6d61 736b 5b31 3a2d 312c 2031 3a2d  = mask[1:-1, 1:-
+00021430: 312c 2031 3a2d 315d 0a0a 2020 2020 2020  1, 1:-1]..      
+00021440: 2020 2020 2020 2320 4966 206d 6173 6b20        # If mask 
+00021450: 6973 2073 6d61 6c6c 2c20 636c 6561 6e2d  is small, clean-
+00021460: 7570 0a20 2020 2020 2020 2020 2020 2069  up.            i
+00021470: 6620 6d61 736b 2e73 756d 2829 203c 2035  f mask.sum() < 5
+00021480: 3030 3a0a 2020 2020 2020 2020 2020 2020  00:.            
+00021490: 2020 2020 6d61 736b 203d 206e 702e 7a65      mask = np.ze
+000214a0: 726f 735f 6c69 6b65 286d 6173 6b2c 2064  ros_like(mask, d
+000214b0: 7479 7065 3d6e 702e 7569 6e74 3829 0a0a  type=np.uint8)..
+000214c0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+000214d0: 696d 6720 3d20 696d 672e 5f5f 636c 6173  img = img.__clas
+000214e0: 735f 5f28 6d61 736b 2c20 696d 672e 6166  s__(mask, img.af
+000214f0: 6669 6e65 2c20 696d 672e 6865 6164 6572  fine, img.header
+00021500: 290a 2020 2020 2020 2020 2020 2020 6f75  ).            ou
+00021510: 745f 696d 672e 6865 6164 6572 2e73 6574  t_img.header.set
+00021520: 5f64 6174 615f 6474 7970 6528 6e70 2e75  _data_dtype(np.u
+00021530: 696e 7438 290a 0a20 2020 2020 2020 2020  int8)..         
+00021540: 2020 2023 2049 6d61 6765 2073 6176 650a     # Image save.
+00021550: 2020 2020 2020 2020 2020 2020 5f2c 2066              _, f
+00021560: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
+00021570: 7468 2e73 706c 6974 2866 696c 655f 6e61  th.split(file_na
+00021580: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00021590: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
+000215a0: 2c20 6669 6c65 5f65 7874 656e 7369 6f6e  , file_extension
+000215b0: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
+000215c0: 6578 7428 6669 6c65 5f6e 616d 6529 0a20  ext(file_name). 
+000215d0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+000215e0: 6c65 5f65 7874 656e 7369 6f6e 203d 3d20  le_extension == 
+000215f0: 222e 677a 223a 0a20 2020 2020 2020 2020  ".gz":.         
+00021600: 2020 2020 2020 2028 6669 6c65 5f6e 616d         (file_nam
+00021610: 655f 6e6f 5f65 7874 5f32 2c20 6669 6c65  e_no_ext_2, file
+00021620: 5f65 7874 656e 7369 6f6e 5f32 2920 3d20  _extension_2) = 
+00021630: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
+00021640: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00021650: 2020 2020 2020 6669 6c65 5f6e 616d 655f        file_name_
+00021660: 6e6f 5f65 7874 0a20 2020 2020 2020 2020  no_ext.         
+00021670: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00021680: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00021690: 5f65 7874 656e 7369 6f6e 5f32 203d 3d20  _extension_2 == 
+000216a0: 222e 6e69 6922 3a0a 2020 2020 2020 2020  ".nii":.        
+000216b0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000216c0: 5f6e 616d 655f 6e6f 5f65 7874 203d 2066  _name_no_ext = f
+000216d0: 696c 655f 6e61 6d65 5f6e 6f5f 6578 745f  ile_name_no_ext_
+000216e0: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+000216f0: 2020 2020 2020 6669 6c65 5f65 7874 656e        file_exten
+00021700: 7369 6f6e 203d 2022 2e6e 6969 2e67 7a22  sion = ".nii.gz"
+00021710: 0a0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00021720: 6c65 5f6f 7574 203d 206f 732e 7061 7468  le_out = os.path
+00021730: 2e6a 6f69 6e28 0a20 2020 2020 2020 2020  .join(.         
+00021740: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
+00021750: 7574 5f64 6972 6563 746f 7279 2c0a 2020  ut_directory,.  
+00021760: 2020 2020 2020 2020 2020 2020 2020 280a                (.
+00021770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021780: 2020 2020 7365 6c66 2e70 7265 6669 782e      self.prefix.
+00021790: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+000217a0: 2020 2020 2020 2020 2020 2020 2b20 6669              + fi
+000217b0: 6c65 5f6e 616d 655f 6e6f 5f65 7874 0a20  le_name_no_ext. 
+000217c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000217d0: 2020 202b 2073 656c 662e 7375 6666 6978     + self.suffix
+000217e0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+000217f0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+00021800: 696c 655f 6578 7465 6e73 696f 6e0a 2020  ile_extension.  
+00021810: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00021820: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00021830: 2020 2020 2020 2020 2020 206e 6962 2e73             nib.s
+00021840: 6176 6528 6f75 745f 696d 672c 2066 696c  ave(out_img, fil
+00021850: 655f 6f75 7429 0a0a 0a63 6c61 7373 2053  e_out)...class S
+00021860: 616e 6974 697a 6528 5072 6f63 6573 734d  anitize(ProcessM
+00021870: 4941 293a 0a20 2020 2022 2222 0a20 2020  IA):.    """.   
+00021880: 202a 5361 6e69 7469 7a65 2069 6e70 7574   *Sanitize input
+00021890: 2062 6f6c 6420 696d 6167 652a 0a0a 2020   bold image*..  
+000218a0: 2020 506c 6561 7365 2c20 7365 6520 7468    Please, see th
+000218b0: 6520 636f 6d70 6c65 7465 2064 6f63 756d  e complete docum
+000218c0: 656e 7461 7469 6f6e 2066 6f72 2074 6865  entation for the
+000218d0: 0a20 2020 2060 5361 6e69 7469 7a65 2062  .    `Sanitize b
+000218e0: 7269 636b 2069 6e20 7468 6520 6d69 615f  rick in the mia_
+000218f0: 7072 6f63 6573 7365 7320 7765 6273 6974  processes websit
+00021900: 650a 2020 2020 3c68 7474 7073 3a2f 2f70  e.    <https://p
+00021910: 6f70 756c 7365 2e67 6974 6875 622e 696f  opulse.github.io
+00021920: 2f6d 6961 5f70 726f 6365 7373 6573 2f68  /mia_processes/h
+00021930: 746d 6c2f 646f 6375 6d65 6e74 6174 696f  tml/documentatio
+00021940: 6e2f 6272 6963 6b73 2f70 7265 7072 6f63  n/bricks/preproc
+00021950: 6573 732f 6f74 6865 722f 5361 6e69 7469  ess/other/Saniti
+00021960: 7a65 2e68 746d 6c3e 605f 0a0a 2020 2020  ze.html>`_..    
+00021970: 6164 6170 7465 6420 6672 6f6d 3a0a 2020  adapted from:.  
+00021980: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
+00021990: 2e63 6f6d 2f6e 6970 7265 7073 2f6e 6977  .com/nipreps/niw
+000219a0: 6f72 6b66 6c6f 7773 2f62 6c6f 622f 3435  orkflows/blob/45
+000219b0: 6162 3133 6531 6266 3666 6462 6635 6532  ab13e1bf6fdbf5e2
+000219c0: 3963 3930 6365 6634 3430 3535 6230 6239  9c90cef44055b0b9
+000219d0: 6366 3339 3162 2f6e 6977 6f72 6b66 6c6f  cf391b/niworkflo
+000219e0: 7773 2f69 6e74 6572 6661 6365 732f 6865  ws/interfaces/he
+000219f0: 6164 6572 2e70 7923 4c33 3934 0a0a 2020  ader.py#L394..  
+00021a00: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00021a10: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
+00021a20: 2020 2020 2020 2022 2222 4465 6469 6361         """Dedica
+00021a30: 7465 6420 746f 2074 6865 2061 7474 7269  ted to the attri
+00021a40: 6275 7465 7320 696e 6974 6961 6c69 7361  butes initialisa
+00021a50: 7469 6f6e 202f 2069 6e73 7461 6e74 6961  tion / instantia
+00021a60: 7469 6f6e 2e0a 0a20 2020 2020 2020 2054  tion...        T
+00021a70: 6865 2069 6e70 7574 2061 6e64 206f 7574  he input and out
+00021a80: 7075 7420 706c 7567 7320 6172 6520 6465  put plugs are de
+00021a90: 6669 6e65 6420 6865 7265 2e20 5468 6520  fined here. The 
+00021aa0: 7370 6563 6961 6c0a 2020 2020 2020 2020  special.        
+00021ab0: 2773 656c 662e 7265 7175 6972 656d 656e  'self.requiremen
+00021ac0: 7427 2061 7474 7269 6275 7465 2028 6f70  t' attribute (op
+00021ad0: 7469 6f6e 616c 2920 6973 2075 7365 6420  tional) is used 
+00021ae0: 746f 2064 6566 696e 6520 7468 650a 2020  to define the.  
+00021af0: 2020 2020 2020 7468 6972 642d 7061 7274        third-part
+00021b00: 7920 7072 6f64 7563 7473 206e 6563 6573  y products neces
+00021b10: 7361 7279 2066 6f72 2074 6865 2072 756e  sary for the run
+00021b20: 6e69 6e67 206f 6620 7468 6520 6272 6963  ning of the bric
+00021b30: 6b2e 0a20 2020 2020 2020 2022 2222 0a20  k..        """. 
+00021b40: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
+00021b50: 6973 6174 696f 6e20 6f66 2074 6865 206f  isation of the o
+00021b60: 626a 6563 7473 206e 6565 6465 6420 666f  bjects needed fo
+00021b70: 7220 7468 6520 6c61 756e 6368 206f 6620  r the launch of 
+00021b80: 7468 6520 6272 6963 6b0a 2020 2020 2020  the brick.      
+00021b90: 2020 7375 7065 7228 5361 6e69 7469 7a65    super(Sanitize
+00021ba0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
+00021bb0: 2829 0a0a 2020 2020 2020 2020 2320 5468  ()..        # Th
+00021bc0: 6972 6420 7061 7274 7920 736f 6674 7761  ird party softwa
+00021bd0: 7265 7320 7265 7175 6972 6564 2066 6f72  res required for
+00021be0: 2074 6865 2065 7865 6375 7469 6f6e 206f   the execution o
+00021bf0: 6620 7468 6520 6272 6963 6b0a 2020 2020  f the brick.    
+00021c00: 2020 2020 7365 6c66 2e72 6571 7569 7265      self.require
+00021c10: 6d65 6e74 203d 205b 5d0a 0a20 2020 2020  ment = []..     
+00021c20: 2020 2023 2049 6e70 7574 7320 6465 7363     # Inputs desc
+00021c30: 7269 7074 696f 6e0a 2020 2020 2020 2020  ription.        
+00021c40: 696e 5f66 696c 655f 6465 7363 203d 2022  in_file_desc = "
+00021c50: 416e 2065 7869 7374 696e 6720 7061 7468  An existing path
+00021c60: 2066 696c 652e 220a 2020 2020 2020 2020   file.".        
+00021c70: 7072 6566 6978 5f64 6573 6320 3d20 2250  prefix_desc = "P
+00021c80: 7265 6669 7820 6f66 2074 6865 206f 7574  refix of the out
+00021c90: 7075 7420 696d 6167 6520 2861 2073 7472  put image (a str
+00021ca0: 696e 6729 2e22 0a20 2020 2020 2020 2073  ing).".        s
+00021cb0: 7566 6669 785f 6465 7363 203d 2022 5375  uffix_desc = "Su
+00021cc0: 6666 6978 206f 6620 7468 6520 6f75 7470  ffix of the outp
+00021cd0: 7574 2069 6d61 6765 2028 6120 7374 7269  ut image (a stri
+00021ce0: 6e67 292e 220a 2020 2020 2020 2020 6e5f  ng).".        n_
+00021cf0: 766f 6c75 6d65 735f 746f 5f64 6973 6361  volumes_to_disca
+00021d00: 7264 5f64 6573 6320 3d20 226e 756d 6265  rd_desc = "numbe
+00021d10: 7220 6f66 206e 6f6e 2073 7465 6164 792d  r of non steady-
+00021d20: 7374 6174 6520 766f 6c75 6d65 7322 0a20  state volumes". 
+00021d30: 2020 2020 2020 206d 6178 5f33 3262 6974         max_32bit
+00021d40: 5f64 6573 6320 3d20 280a 2020 2020 2020  _desc = (.      
+00021d50: 2020 2020 2020 2263 6173 7420 6461 7461        "cast data
+00021d60: 2074 6f20 666c 6f61 7433 3220 6966 2068   to float32 if h
+00021d70: 6967 6865 7220 7072 6563 6973 696f 6e20  igher precision 
+00021d80: 6973 2065 6e63 6f75 6e74 6572 6564 220a  is encountered".
+00021d90: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00021da0: 2020 2320 4f75 7470 7574 7320 6465 7363    # Outputs desc
+00021db0: 7269 7074 696f 6e0a 2020 2020 2020 2020  ription.        
+00021dc0: 6f75 745f 6669 6c65 5f64 6573 6320 3d20  out_file_desc = 
+00021dd0: 280a 2020 2020 2020 2020 2020 2020 2250  (.            "P
+00021de0: 6174 6820 6f66 2074 6865 2073 6e61 6974  ath of the snait
+00021df0: 697a 6564 2073 6361 6e22 0a20 2020 2020  ized scan".     
+00021e00: 2020 2020 2020 2022 2861 2070 6174 686c         "(a pathl
+00021e10: 696b 6520 6f62 6a65 6374 206f 7220 7374  ike object or st
+00021e20: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
+00021e30: 6720 6120 6669 6c65 292e 220a 2020 2020  g a file).".    
+00021e40: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00021e50: 2049 6e70 7574 7320 7472 6169 7473 0a20   Inputs traits. 
+00021e60: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+00021e70: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
+00021e80: 2020 2022 696e 5f66 696c 6522 2c20 4669     "in_file", Fi
+00021e90: 6c65 286f 7574 7075 743d 4661 6c73 652c  le(output=False,
+00021ea0: 206f 7074 696f 6e61 6c3d 4661 6c73 652c   optional=False,
+00021eb0: 2064 6573 633d 696e 5f66 696c 655f 6465   desc=in_file_de
+00021ec0: 7363 290a 2020 2020 2020 2020 290a 0a20  sc).        ).. 
+00021ed0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+00021ee0: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
+00021ef0: 2020 2022 6d61 785f 3332 6269 7422 2c0a     "max_32bit",.
+00021f00: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+00021f10: 7473 2e42 6f6f 6c28 0a20 2020 2020 2020  ts.Bool(.       
+00021f20: 2020 2020 2020 2020 2046 616c 7365 2c20           False, 
+00021f30: 6f75 7470 7574 3d46 616c 7365 2c20 6f70  output=False, op
+00021f40: 7469 6f6e 616c 3d54 7275 652c 2064 6573  tional=True, des
+00021f50: 633d 6d61 785f 3332 6269 745f 6465 7363  c=max_32bit_desc
+00021f60: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00021f70: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00021f80: 2020 2073 656c 662e 6164 645f 7472 6169     self.add_trai
+00021f90: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
+00021fa0: 6e5f 766f 6c75 6d65 735f 746f 5f64 6973  n_volumes_to_dis
+00021fb0: 6361 7264 222c 0a20 2020 2020 2020 2020  card",.         
+00021fc0: 2020 2074 7261 6974 732e 496e 7428 0a20     traits.Int(. 
+00021fd0: 2020 2020 2020 2020 2020 2020 2020 2030                 0
+00021fe0: 2c20 6f75 7470 7574 3d46 616c 7365 2c20  , output=False, 
+00021ff0: 6f70 7469 6f6e 616c 3d54 7275 652c 2064  optional=True, d
+00022000: 6573 633d 6e5f 766f 6c75 6d65 735f 746f  esc=n_volumes_to
+00022010: 5f64 6973 6361 7264 5f64 6573 630a 2020  _discard_desc.  
+00022020: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00022030: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00022040: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+00022050: 2020 2020 2020 2020 2020 2020 2270 7265              "pre
+00022060: 6669 7822 2c0a 2020 2020 2020 2020 2020  fix",.          
+00022070: 2020 7472 6169 7473 2e53 7472 696e 6728    traits.String(
+00022080: 2222 2c20 6f75 7470 7574 3d46 616c 7365  "", output=False
+00022090: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
+000220a0: 2064 6573 633d 7072 6566 6978 5f64 6573   desc=prefix_des
+000220b0: 6329 2c0a 2020 2020 2020 2020 290a 0a20  c),.        ).. 
+000220c0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+000220d0: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
+000220e0: 2020 2022 7375 6666 6978 222c 0a20 2020     "suffix",.   
+000220f0: 2020 2020 2020 2020 2074 7261 6974 732e           traits.
+00022100: 5374 7269 6e67 280a 2020 2020 2020 2020  String(.        
+00022110: 2020 2020 2020 2020 225f 7661 6c69 6422          "_valid"
+00022120: 2c20 6f75 7470 7574 3d46 616c 7365 2c20  , output=False, 
+00022130: 6f70 7469 6f6e 616c 3d54 7275 652c 2064  optional=True, d
+00022140: 6573 633d 7375 6666 6978 5f64 6573 630a  esc=suffix_desc.
+00022150: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00022160: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00022170: 2020 2320 4f75 7470 7574 7320 7472 6169    # Outputs trai
+00022180: 7473 0a20 2020 2020 2020 2073 656c 662e  ts.        self.
+00022190: 6164 645f 7472 6169 7428 226f 7574 5f66  add_trait("out_f
+000221a0: 696c 6522 2c20 4669 6c65 286f 7574 7075  ile", File(outpu
+000221b0: 743d 5472 7565 2c20 6465 7363 3d6f 7574  t=True, desc=out
+000221c0: 5f66 696c 655f 6465 7363 2929 0a0a 2020  _file_desc))..  
+000221d0: 2020 2020 2020 7365 6c66 2e69 6e69 745f        self.init_
+000221e0: 6465 6661 756c 745f 7472 6169 7473 2829  default_traits()
+000221f0: 0a0a 2020 2020 6465 6620 6c69 7374 5f6f  ..    def list_o
+00022200: 7574 7075 7473 2873 656c 662c 2069 735f  utputs(self, is_
+00022210: 706c 7567 6765 643d 4e6f 6e65 293a 0a20  plugged=None):. 
+00022220: 2020 2020 2020 2022 2222 4465 6469 6361         """Dedica
+00022230: 7465 6420 746f 2074 6865 2069 6e69 7469  ted to the initi
+00022240: 616c 6973 6174 696f 6e20 7374 6570 206f  alisation step o
+00022250: 6620 7468 6520 6272 6963 6b2e 0a0a 2020  f the brick...  
+00022260: 2020 2020 2020 5468 6520 6d61 696e 206f        The main o
+00022270: 626a 6563 7469 7665 206f 6620 7468 6973  bjective of this
+00022280: 206d 6574 686f 6420 6973 2074 6f20 7072   method is to pr
+00022290: 6f64 7563 6520 7468 6520 6f75 7470 7574  oduce the output
+000222a0: 7320 6f66 2074 6865 0a20 2020 2020 2020  s of the.       
+000222b0: 2062 7269 636b 7320 2873 656c 662e 6f75   bricks (self.ou
+000222c0: 7470 7574 7329 2061 6e64 2074 6865 2061  tputs) and the a
+000222d0: 7373 6f63 6961 7465 6420 7461 6773 2028  ssociated tags (
+000222e0: 7365 6c66 2e69 6e68 6572 6974 616e 6365  self.inheritance
+000222f0: 5f64 6963 292c 0a20 2020 2020 2020 2069  _dic),.        i
+00022300: 6620 6465 6669 6e65 6420 6865 7265 2e20  f defined here. 
+00022310: 546f 2077 6f72 6b20 7072 6f70 6572 6c79  To work properly
+00022320: 2074 6869 7320 6d65 7468 6f64 206d 7573   this method mus
+00022330: 7420 7265 7475 726e 0a20 2020 2020 2020  t return.       
+00022340: 2073 656c 662e 6d61 6b65 5f69 6e69 7452   self.make_initR
+00022350: 6573 756c 7428 2920 6f62 6a65 6374 2e0a  esult() object..
+00022360: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00022370: 6973 5f70 6c75 6767 6564 3a20 7468 6520  is_plugged: the 
+00022380: 7374 6174 652c 206c 696e 6b65 6420 6f72  state, linked or
+00022390: 206e 6f74 2c20 6f66 2074 6865 2070 6c75   not, of the plu
+000223a0: 6773 2e0a 2020 2020 2020 2020 3a72 6574  gs..        :ret
+000223b0: 7572 6e73 3a20 6120 6469 6374 696f 6e61  urns: a dictiona
+000223c0: 7279 2077 6974 6820 7265 7175 6972 656d  ry with requirem
+000223d0: 656e 742c 206f 7574 7075 7473 2061 6e64  ent, outputs and
+000223e0: 2069 6e68 6572 6974 616e 6365 5f64 6963   inheritance_dic
+000223f0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+00022400: 2020 2020 2020 2023 2055 7369 6e67 2074         # Using t
+00022410: 6865 2069 6e68 6572 6974 616e 6365 2074  he inheritance t
+00022420: 6f20 5072 6f63 6573 734d 4941 2063 6c61  o ProcessMIA cla
+00022430: 7373 2c20 6c69 7374 5f6f 7574 7075 7473  ss, list_outputs
+00022440: 206d 6574 686f 640a 2020 2020 2020 2020   method.        
+00022450: 7375 7065 7228 5361 6e69 7469 7a65 2c20  super(Sanitize, 
+00022460: 7365 6c66 292e 6c69 7374 5f6f 7574 7075  self).list_outpu
+00022470: 7473 2829 0a0a 2020 2020 2020 2020 2320  ts()..        # 
+00022480: 4f75 7470 7574 7320 6465 6669 6e69 7469  Outputs definiti
+00022490: 6f6e 0a20 2020 2020 2020 2069 6620 7365  on.        if se
+000224a0: 6c66 2e69 6e5f 6669 6c65 3a0a 2020 2020  lf.in_file:.    
+000224b0: 2020 2020 2020 2020 7661 6c69 645f 6578          valid_ex
+000224c0: 742c 2069 6e5f 6578 742c 2066 696c 654e  t, in_ext, fileN
+000224d0: 616d 6520 3d20 6368 6563 6b46 696c 6545  ame = checkFileE
+000224e0: 7874 2873 656c 662e 696e 5f66 696c 652c  xt(self.in_file,
+000224f0: 2045 5854 290a 0a20 2020 2020 2020 2020   EXT)..         
+00022500: 2020 2069 6620 6e6f 7420 7661 6c69 645f     if not valid_
+00022510: 6578 743a 0a20 2020 2020 2020 2020 2020  ext:.           
+00022520: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+00022530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022540: 225c 6e53 616e 6974 697a 6520 6272 6963  "\nSanitize bric
+00022550: 6b3a 2054 6865 2069 6e70 7574 2069 6d61  k: The input ima
+00022560: 6765 2066 6f72 6d61 7420 6973 206e 6f74  ge format is not
+00022570: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00022580: 2020 2020 2020 2022 7265 636f 676e 697a         "recogniz
+00022590: 6564 2e2e 2e21 220a 2020 2020 2020 2020  ed...!".        
+000225a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000225b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000225c0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000225d0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+000225e0: 2020 2028 6e6f 7420 7365 6c66 2e73 7566     (not self.suf
+000225f0: 6669 7829 0a20 2020 2020 2020 2020 2020  fix).           
+00022600: 2020 2020 206f 7220 2873 656c 662e 7375       or (self.su
+00022610: 6666 6978 2e69 7373 7061 6365 2829 290a  ffix.isspace()).
+00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022630: 6f72 2073 656c 662e 7375 6666 6978 2069  or self.suffix i
+00022640: 6e20 5b55 6e64 6566 696e 6564 2c20 223c  n [Undefined, "<
+00022650: 756e 6465 6669 6e65 643e 225d 0a20 2020  undefined>"].   
+00022660: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00022670: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00022680: 2e73 7566 6669 7820 3d20 2220 220a 0a20  .suffix = " ".. 
+00022690: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
+000226a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226b0: 286e 6f74 2073 656c 662e 7072 6566 6978  (not self.prefix
+000226c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000226d0: 2020 6f72 2028 7365 6c66 2e70 7265 6669    or (self.prefi
+000226e0: 782e 6973 7370 6163 6528 2929 0a20 2020  x.isspace()).   
+000226f0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+00022700: 2873 656c 662e 7072 6566 6978 2069 6e20  (self.prefix in 
+00022710: 5b55 6e64 6566 696e 6564 2c20 223c 756e  [Undefined, "<un
+00022720: 6465 6669 6e65 643e 225d 290a 2020 2020  defined>"]).    
+00022730: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00022740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00022750: 7072 6566 6978 203d 2022 2022 0a0a 2020  prefix = " "..  
+00022760: 2020 2020 2020 2020 2020 7061 7468 2c20            path, 
+00022770: 5f20 3d20 6f73 2e70 6174 682e 7370 6c69  _ = os.path.spli
+00022780: 7428 7365 6c66 2e69 6e5f 6669 6c65 290a  t(self.in_file).
+00022790: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000227a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000227b0: 2020 7365 6c66 2e73 7566 6669 7820 3d3d    self.suffix ==
+000227c0: 2022 2022 0a20 2020 2020 2020 2020 2020   " ".           
+000227d0: 2020 2020 2061 6e64 2073 656c 662e 7072       and self.pr
+000227e0: 6566 6978 203d 3d20 2220 220a 2020 2020  efix == " ".    
+000227f0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00022800: 7061 7468 203d 3d20 7365 6c66 2e6f 7574  path == self.out
+00022810: 7075 745f 6469 7265 6374 6f72 790a 2020  put_directory.  
+00022820: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00022830: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+00022840: 203d 2051 4d65 7373 6167 6542 6f78 2829   = QMessageBox()
+00022850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022860: 206d 7367 2e73 6574 4963 6f6e 2851 4d65   msg.setIcon(QMe
+00022870: 7373 6167 6542 6f78 2e57 6172 6e69 6e67  ssageBox.Warning
+00022880: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00022890: 2020 6d73 672e 7365 7457 696e 646f 7754    msg.setWindowT
+000228a0: 6974 6c65 2822 6d69 615f 7072 6f63 6573  itle("mia_proces
+000228b0: 7365 7320 2d20 5361 6e69 7469 7a65 2062  ses - Sanitize b
+000228c0: 7269 636b 2057 6172 6e69 6e67 2122 290a  rick Warning!").
+000228d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000228e0: 6d73 672e 7365 7454 6578 7428 0a20 2020  msg.setText(.   
+000228f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022900: 2022 5375 6666 6978 2061 6e64 2070 7265   "Suffix and pre
+00022910: 6669 7820 696e 7075 7420 7061 7261 6d65  fix input parame
+00022920: 7465 7273 2061 7265 206e 6f74 2022 0a20  ters are not ". 
+00022930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022940: 2020 2022 6465 6669 6e65 6420 6f72 2063     "defined or c
+00022950: 6f6e 7369 7374 206f 6e6c 7920 6f66 206f  onsist only of o
+00022960: 6e65 206f 7220 6d6f 7265 2077 6869 7465  ne or more white
+00022970: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00022980: 2020 2020 2020 2022 7370 6163 6573 2e5c         "spaces.\
+00022990: 6e54 6865 207b 307d 2069 6e70 7574 2070  nThe {0} input p
+000229a0: 6172 616d 6574 6572 2077 696c 6c20 6265  arameter will be
+000229b0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000229c0: 2020 2020 2020 2022 6f76 6572 7772 6974         "overwrit
+000229d0: 7465 6e20 2e2e 2e5c 6e20 5965 7320 6f72  ten ...\n Yes or
+000229e0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000229f0: 2020 2020 2020 2022 4162 6f72 743f 222e         "Abort?".
+00022a00: 666f 726d 6174 2866 696c 654e 616d 6529  format(fileName)
+00022a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022a20: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00022a30: 2020 206d 7367 2e73 6574 5374 616e 6461     msg.setStanda
+00022a40: 7264 4275 7474 6f6e 7328 514d 6573 7361  rdButtons(QMessa
+00022a50: 6765 426f 782e 5965 7320 7c20 514d 6573  geBox.Yes | QMes
+00022a60: 7361 6765 426f 782e 4162 6f72 7429 0a20  sageBox.Abort). 
+00022a70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00022a80: 6574 7661 6c20 3d20 6d73 672e 6578 6563  etval = msg.exec
+00022a90: 5f28 290a 0a20 2020 2020 2020 2020 2020  _()..           
+00022aa0: 2020 2020 2069 6620 7265 7476 616c 2021       if retval !
+00022ab0: 3d20 514d 6573 7361 6765 426f 782e 4162  = QMessageBox.Ab
+00022ac0: 6f72 743a 0a20 2020 2020 2020 2020 2020  ort:.           
+00022ad0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+00022ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022af0: 2020 2020 2020 2020 225c 6e53 616e 6974          "\nSanit
+00022b00: 697a 6520 6272 6963 6b20 7761 726e 696e  ize brick warnin
+00022b10: 673a 2074 6865 206f 7574 5f66 696c 6520  g: the out_file 
+00022b20: 6f75 7470 7574 2022 0a20 2020 2020 2020  output ".       
+00022b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b40: 2022 7061 7261 6d65 7465 7220 6973 2074   "parameter is t
+00022b50: 6865 2073 616d 6520 6173 2074 6865 2069  he same as the i
+00022b60: 6e5f 6669 6c65 7320 696e 7075 7420 220a  n_files input ".
+00022b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b80: 2020 2020 2020 2020 2270 6172 616d 6574          "paramet
+00022b90: 6572 2028 7375 6666 6978 2061 6e64 2070  er (suffix and p
+00022ba0: 7265 6669 7820 6172 6520 6e6f 7420 6465  refix are not de
+00022bb0: 6669 6e65 6429 3a22 0a20 2020 2020 2020  fined):".       
+00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bd0: 2022 5c6e 7b30 7d20 7769 6c6c 2062 6520   "\n{0} will be 
+00022be0: 6f76 6572 7772 6974 6564 202e 2e2e 222e  overwrited ...".
+00022bf0: 666f 726d 6174 2866 696c 654e 616d 6529  format(fileName)
+00022c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022c10: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00022c20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00022c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c40: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+00022c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c60: 2022 5c6e 5361 6e69 7469 7a65 2062 7269   "\nSanitize bri
+00022c70: 636b 3a20 4162 6f72 7465 642e 2050 6c65  ck: Aborted. Ple
+00022c80: 6173 6520 6368 6563 6b20 796f 7572 2069  ase check your i
+00022c90: 6e70 7574 2022 0a20 2020 2020 2020 2020  nput ".         
+00022ca0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00022cb0: 7061 7261 6d65 7465 7273 202e 2e2e 220a  parameters ...".
+00022cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022cd0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00022ce0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00022cf0: 0a0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00022d00: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
+00022d10: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00022d20: 2020 2073 656c 662e 6f75 7470 7574 5f64     self.output_d
+00022d30: 6972 6563 746f 7279 2c0a 2020 2020 2020  irectory,.      
+00022d40: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+00022d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d60: 7365 6c66 2e70 7265 6669 782e 7374 7269  self.prefix.stri
+00022d70: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00022d80: 2020 2020 2020 2020 2b20 6669 6c65 4e61          + fileNa
+00022d90: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+00022da0: 2020 2020 2020 202b 2073 656c 662e 7375         + self.su
+00022db0: 6666 6978 2e73 7472 6970 2829 0a20 2020  ffix.strip().   
+00022dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022dd0: 202b 2022 2e22 0a20 2020 2020 2020 2020   + ".".         
+00022de0: 2020 2020 2020 2020 2020 202b 2069 6e5f             + in_
+00022df0: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
+00022e00: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+00022e10: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+00022e20: 2020 6966 2066 696c 653a 0a20 2020 2020    if file:.     
+00022e30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00022e40: 6f75 7470 7574 735b 226f 7574 5f66 696c  outputs["out_fil
+00022e50: 6522 5d20 3d20 6669 6c65 0a20 2020 2020  e"] = file.     
+00022e60: 2020 2020 2020 2020 2020 2023 2046 4958             # FIX
+00022e70: 4d45 3a20 496e 2074 6865 206c 6174 6573  ME: In the lates
+00022e80: 7420 7665 7273 696f 6e20 6f66 206d 6961  t version of mia
+00022e90: 2c20 696e 6465 7869 6e67 206f 6620 7468  , indexing of th
+00022ea0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00022eb0: 2020 2320 2020 2020 2020 2064 6174 6162    #        datab
+00022ec0: 6173 6520 7769 7468 2070 6172 7469 6375  ase with particu
+00022ed0: 6c61 7220 7461 6773 2064 6566 696e 6564  lar tags defined
+00022ee0: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
+00022ef0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+00022f00: 2070 726f 6365 7373 6573 2069 7320 646f   processes is do
+00022f10: 6e65 206f 6e6c 7920 6174 2074 6865 2065  ne only at the e
+00022f20: 6e64 206f 6620 7468 650a 2020 2020 2020  nd of the.      
+00022f30: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00022f40: 2020 2069 6e69 7469 616c 6973 6174 696f     initialisatio
+00022f50: 6e20 6f66 2074 6865 2077 686f 6c65 2070  n of the whole p
+00022f60: 6970 656c 696e 652e 2053 6f20 7765 0a20  ipeline. So we. 
+00022f70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00022f80: 2020 2020 2020 2020 6361 6e6e 6f74 2075          cannot u
+00022f90: 7365 2074 6865 2076 616c 7565 206f 6620  se the value of 
+00022fa0: 7468 6573 6520 7461 6773 2069 6e20 6f74  these tags in ot
+00022fb0: 6865 720a 2020 2020 2020 2020 2020 2020  her.            
+00022fc0: 2020 2020 2320 2020 2020 2020 2070 726f      #        pro
+00022fd0: 6365 7373 6573 206f 6620 7468 6520 7069  cesses of the pi
+00022fe0: 7065 6c69 6e65 2061 7420 7468 6520 7469  peline at the ti
+00022ff0: 6d65 206f 660a 2020 2020 2020 2020 2020  me of.          
+00023000: 2020 2020 2020 2320 2020 2020 2020 2069        #        i
+00023010: 6e69 7469 616c 6973 6174 696f 6e20 2873  nitialisation (s
+00023020: 6565 2070 6f70 756c 7365 5f6d 6961 2023  ee populse_mia #
+00023030: 3239 3029 2e20 556e 7469 6c0a 2020 2020  290). Until.    
+00023040: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00023050: 2020 2020 2062 6574 7465 7220 7765 2075       better we u
+00023060: 7365 2061 2071 7569 636b 2061 6e64 2064  se a quick and d
+00023070: 6972 7479 2068 6163 6b20 7769 7468 2074  irty hack with t
+00023080: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00023090: 2020 2023 2020 2020 2020 2020 7365 745f     #        set_
+000230a0: 6462 4669 656c 6456 616c 7565 2829 2066  dbFieldValue() f
+000230b0: 756e 6374 696f 6e20 210a 0a20 2020 2020  unction !..     
+000230c0: 2020 2020 2020 2020 2020 2074 6167 5f74             tag_t
+000230d0: 6f5f 6164 6420 3d20 6469 6374 2829 0a20  o_add = dict(). 
+000230e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000230f0: 6167 5f74 6f5f 6164 645b 226e 616d 6522  ag_to_add["name"
+00023100: 5d20 3d20 2252 6570 6574 6974 696f 6e54  ] = "RepetitionT
+00023110: 696d 6522 0a20 2020 2020 2020 2020 2020  ime".           
+00023120: 2020 2020 2074 6167 5f74 6f5f 6164 645b       tag_to_add[
+00023130: 2266 6965 6c64 5f74 7970 6522 5d20 3d20  "field_type"] = 
+00023140: 2266 6c6f 6174 220a 2020 2020 2020 2020  "float".        
+00023150: 2020 2020 2020 2020 7461 675f 746f 5f61          tag_to_a
+00023160: 6464 5b22 6465 7363 7269 7074 696f 6e22  dd["description"
+00023170: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+00023180: 2020 2020 2020 2020 2020 2254 6865 2070            "The p
+00023190: 6572 696f 6420 6f66 2074 696d 6520 220a  eriod of time ".
+000231a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231b0: 2020 2020 2269 6e20 6d73 6563 2062 6574      "in msec bet
+000231c0: 7765 656e 2074 6865 2022 0a20 2020 2020  ween the ".     
+000231d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000231e0: 6265 6769 6e6e 696e 6720 6f66 2061 2070  beginning of a p
+000231f0: 756c 7365 2022 0a20 2020 2020 2020 2020  ulse ".         
+00023200: 2020 2020 2020 2020 2020 2022 7365 7175             "sequ
+00023210: 656e 6365 2061 6e64 2074 6865 2022 0a20  ence and the ". 
+00023220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023230: 2020 2022 6265 6769 6e6e 696e 6720 6f66     "beginning of
+00023240: 2074 6865 2022 0a20 2020 2020 2020 2020   the ".         
+00023250: 2020 2020 2020 2020 2020 2022 7375 6363             "succ
+00023260: 6565 6469 6e67 2070 756c 7365 2022 0a20  eeding pulse ". 
+00023270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023280: 2020 2022 7365 7175 656e 6365 220a 2020     "sequence".  
+00023290: 2020 2020 2020 2020 2020 2020 2020 290a                ).
 000232a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000232b0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-000232c0: 2020 2020 2020 2020 2020 2022 5c6e 5453             "\nTS
-000232d0: 4e52 2062 7269 636b 3a20 5468 6520 696e  NR brick: The in
-000232e0: 7075 7420 696d 6167 6520 666f 726d 6174  put image format
-000232f0: 2069 7320 6e6f 7420 220a 2020 2020 2020   is not ".      
-00023300: 2020 2020 2020 2020 2020 2020 2020 2272                "r
-00023310: 6563 6f67 6e69 7a65 642e 2e2e 2122 0a20  ecognized...!". 
-00023320: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00023330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023340: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-00023350: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00023360: 2020 2020 2020 2020 2020 286e 6f74 2073            (not s
-00023370: 656c 662e 7375 6666 6978 5f74 736e 7229  elf.suffix_tsnr)
-00023380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023390: 206f 7220 2873 656c 662e 7375 6666 6978   or (self.suffix
-000233a0: 5f74 736e 722e 6973 7370 6163 6528 2929  _tsnr.isspace())
-000233b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000233c0: 206f 7220 7365 6c66 2e73 7566 6669 785f   or self.suffix_
-000233d0: 7473 6e72 2069 6e20 5b55 6e64 6566 696e  tsnr in [Undefin
-000233e0: 6564 2c20 223c 756e 6465 6669 6e65 643e  ed, "<undefined>
-000233f0: 225d 0a20 2020 2020 2020 2020 2020 2029  "].            )
-00023400: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023410: 2020 7365 6c66 2e73 7566 6669 785f 7473    self.suffix_ts
-00023420: 6e72 203d 2022 2022 0a0a 2020 2020 2020  nr = " "..      
-00023430: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-00023440: 2020 2020 2020 2020 2020 2028 6e6f 7420             (not 
-00023450: 7365 6c66 2e70 7265 6669 785f 7473 6e72  self.prefix_tsnr
-00023460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00023470: 2020 6f72 2028 7365 6c66 2e70 7265 6669    or (self.prefi
-00023480: 785f 7473 6e72 2e69 7373 7061 6365 2829  x_tsnr.isspace()
-00023490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000234a0: 2020 6f72 2028 7365 6c66 2e70 7265 6669    or (self.prefi
-000234b0: 785f 7473 6e72 2069 6e20 5b55 6e64 6566  x_tsnr in [Undef
-000234c0: 696e 6564 2c20 223c 756e 6465 6669 6e65  ined, "<undefine
-000234d0: 643e 225d 290a 2020 2020 2020 2020 2020  d>"]).          
-000234e0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-000234f0: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
-00023500: 5f74 736e 7220 3d20 2220 220a 0a20 2020  _tsnr = " "..   
-00023510: 2020 2020 2020 2020 2066 696c 655f 7473           file_ts
-00023520: 6e72 203d 2022 220a 0a20 2020 2020 2020  nr = ""..       
-00023530: 2020 2020 2070 6174 682c 205f 203d 206f       path, _ = o
-00023540: 732e 7061 7468 2e73 706c 6974 2873 656c  s.path.split(sel
-00023550: 662e 696e 5f66 696c 6529 0a0a 2020 2020  f.in_file)..    
-00023560: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00023570: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00023580: 662e 7375 6666 6978 5f74 736e 7220 3d3d  f.suffix_tsnr ==
-00023590: 2022 2022 0a20 2020 2020 2020 2020 2020   " ".           
-000235a0: 2020 2020 2061 6e64 2073 656c 662e 7072       and self.pr
-000235b0: 6566 6978 5f74 736e 7220 3d3d 2022 2022  efix_tsnr == " "
-000235c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000235d0: 2061 6e64 2070 6174 6820 3d3d 2073 656c   and path == sel
-000235e0: 662e 6f75 7470 7574 5f64 6972 6563 746f  f.output_directo
-000235f0: 7279 0a20 2020 2020 2020 2020 2020 2029  ry.            )
-00023600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023610: 2020 6d73 6720 3d20 514d 6573 7361 6765    msg = QMessage
-00023620: 426f 7828 290a 2020 2020 2020 2020 2020  Box().          
-00023630: 2020 2020 2020 6d73 672e 7365 7449 636f        msg.setIco
-00023640: 6e28 514d 6573 7361 6765 426f 782e 5761  n(QMessageBox.Wa
-00023650: 726e 696e 6729 0a20 2020 2020 2020 2020  rning).         
-00023660: 2020 2020 2020 206d 7367 2e73 6574 5769         msg.setWi
-00023670: 6e64 6f77 5469 746c 6528 226d 6961 5f70  ndowTitle("mia_p
-00023680: 726f 6365 7373 6573 202d 2054 534e 5220  rocesses - TSNR 
-00023690: 6272 6963 6b20 5761 726e 696e 6721 2229  brick Warning!")
-000236a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000236b0: 206d 7367 2e73 6574 5465 7874 280a 2020   msg.setText(.  
-000236c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000236d0: 2020 2273 7566 6669 785f 7473 6e72 2061    "suffix_tsnr a
-000236e0: 6e64 2070 7265 6669 785f 7473 6e72 2069  nd prefix_tsnr i
-000236f0: 6e70 7574 2070 6172 616d 6574 6572 7320  nput parameters 
-00023700: 6172 6520 6e6f 7420 220a 2020 2020 2020  are not ".      
-00023710: 2020 2020 2020 2020 2020 2020 2020 2264                "d
-00023720: 6566 696e 6564 206f 7220 636f 6e73 6973  efined or consis
-00023730: 7420 6f6e 6c79 206f 6620 6f6e 6520 6f72  t only of one or
-00023740: 206d 6f72 6520 7768 6974 6520 220a 2020   more white ".  
-00023750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023760: 2020 2273 7061 6365 732e 5c6e 5468 6520    "spaces.\nThe 
-00023770: 7b30 7d20 696e 7075 7420 7061 7261 6d65  {0} input parame
-00023780: 7465 7220 7769 6c6c 2062 6520 220a 2020  ter will be ".  
-00023790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000237a0: 2020 226f 7665 7277 7269 7474 656e 202e    "overwritten .
-000237b0: 2e2e 5c6e 2059 6573 206f 7220 220a 2020  ..\n Yes or ".  
-000237c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000237d0: 2020 2241 626f 7274 3f22 2e66 6f72 6d61    "Abort?".forma
-000237e0: 7428 6669 6c65 4e61 6d65 290a 2020 2020  t(fileName).    
-000237f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00023800: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-00023810: 672e 7365 7453 7461 6e64 6172 6442 7574  g.setStandardBut
-00023820: 746f 6e73 2851 4d65 7373 6167 6542 6f78  tons(QMessageBox
-00023830: 2e59 6573 207c 2051 4d65 7373 6167 6542  .Yes | QMessageB
-00023840: 6f78 2e41 626f 7274 290a 2020 2020 2020  ox.Abort).      
-00023850: 2020 2020 2020 2020 2020 7265 7476 616c            retval
-00023860: 203d 206d 7367 2e65 7865 635f 2829 0a0a   = msg.exec_()..
-00023870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023880: 6966 2072 6574 7661 6c20 213d 2051 4d65  if retval != QMe
-00023890: 7373 6167 6542 6f78 2e41 626f 7274 3a0a  ssageBox.Abort:.
-000238a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238b0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-000238c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238d0: 2020 2022 5c6e 5453 4e52 2062 7269 636b     "\nTSNR brick
-000238e0: 2077 6172 6e69 6e67 3a20 7468 6520 6f75   warning: the ou
-000238f0: 745f 7473 6e72 5f66 696c 6520 6f75 7470  t_tsnr_file outp
-00023900: 7574 2022 0a20 2020 2020 2020 2020 2020  ut ".           
-00023910: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
-00023920: 7261 6d65 7465 7220 6973 2074 6865 2073  rameter is the s
-00023930: 616d 6520 6173 2074 6865 2069 6e5f 6669  ame as the in_fi
-00023940: 6c65 2069 6e70 7574 2022 0a20 2020 2020  le input ".     
-00023950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023960: 2020 2022 7061 7261 6d65 7465 7220 2873     "parameter (s
-00023970: 7566 6669 7820 616e 6420 7072 6566 6978  uffix and prefix
-00023980: 2061 7265 206e 6f74 2064 6566 696e 6564   are not defined
-00023990: 293a 220a 2020 2020 2020 2020 2020 2020  ):".            
-000239a0: 2020 2020 2020 2020 2020 2020 225c 6e7b              "\n{
-000239b0: 307d 2077 696c 6c20 6265 206f 7665 7277  0} will be overw
-000239c0: 7269 7465 6420 2e2e 2e22 2e66 6f72 6d61  rited ...".forma
-000239d0: 7428 6669 6c65 4e61 6d65 290a 2020 2020  t(fileName).    
-000239e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00023a00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00023a10: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00023a20: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00023a30: 2020 2020 2020 2020 2020 2020 225c 6e54              "\nT
-00023a40: 534e 5220 6272 6963 6b3a 2041 626f 7274  SNR brick: Abort
-00023a50: 6564 2e20 506c 6561 7365 2063 6865 636b  ed. Please check
-00023a60: 2079 6f75 7220 696e 7075 7420 220a 2020   your input ".  
-00023a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a80: 2020 2020 2020 2270 6172 616d 6574 6572        "parameter
-00023a90: 7320 2e2e 2e22 0a20 2020 2020 2020 2020  s ...".         
-00023aa0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00023ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ac0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-00023ad0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00023ae0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00023af0: 7473 6e72 203d 206f 732e 7061 7468 2e6a  tsnr = os.path.j
-00023b00: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
-00023b10: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
-00023b20: 7470 7574 5f64 6972 6563 746f 7279 2c0a  tput_directory,.
-00023b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b40: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-00023b50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00023b60: 6c66 2e70 7265 6669 785f 7473 6e72 2e73  lf.prefix_tsnr.s
-00023b70: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-00023b80: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00023b90: 2066 696c 654e 616d 650a 2020 2020 2020   fileName.      
-00023ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023bb0: 2020 2b20 7365 6c66 2e73 7566 6669 785f    + self.suffix_
-00023bc0: 7473 6e72 2e73 7472 6970 2829 0a20 2020  tsnr.strip().   
-00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023be0: 2020 2020 202b 2022 2e22 0a20 2020 2020       + ".".     
-00023bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c00: 2020 202b 2069 6e5f 6578 740a 2020 2020     + in_ext.    
-00023c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c20: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00023c30: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00023c40: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00023c50: 2020 2020 2020 2028 6e6f 7420 7365 6c66         (not self
-00023c60: 2e73 7566 6669 785f 7374 6464 6576 290a  .suffix_stddev).
-00023c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c80: 6f72 2028 7365 6c66 2e73 7566 6669 785f  or (self.suffix_
-00023c90: 7374 6464 6576 2e69 7373 7061 6365 2829  stddev.isspace()
-00023ca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00023cb0: 2020 6f72 2073 656c 662e 7375 6666 6978    or self.suffix
-00023cc0: 5f73 7464 6465 7620 696e 205b 556e 6465  _stddev in [Unde
-00023cd0: 6669 6e65 642c 2022 3c75 6e64 6566 696e  fined, "<undefin
-00023ce0: 6564 3e22 5d0a 2020 2020 2020 2020 2020  ed>"].          
-00023cf0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00023d00: 2020 2020 2073 656c 662e 7375 6666 6978       self.suffix
-00023d10: 5f73 7464 6465 7620 3d20 2220 220a 0a20  _stddev = " ".. 
-00023d20: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
-00023d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d40: 286e 6f74 2073 656c 662e 7072 6566 6978  (not self.prefix
-00023d50: 5f73 7464 6465 7629 0a20 2020 2020 2020  _stddev).       
-00023d60: 2020 2020 2020 2020 206f 7220 2873 656c           or (sel
-00023d70: 662e 7072 6566 6978 5f73 7464 6465 762e  f.prefix_stddev.
-00023d80: 6973 7370 6163 6528 2929 0a20 2020 2020  isspace()).     
-00023d90: 2020 2020 2020 2020 2020 206f 7220 2873             or (s
-00023da0: 656c 662e 7072 6566 6978 5f73 7464 6465  elf.prefix_stdde
-00023db0: 7620 696e 205b 556e 6465 6669 6e65 642c  v in [Undefined,
-00023dc0: 2022 3c75 6e64 6566 696e 6564 3e22 5d29   "<undefined>"])
-00023dd0: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
+000232b0: 7461 675f 746f 5f61 6464 5b22 7669 7369  tag_to_add["visi
+000232c0: 6269 6c69 7479 225d 203d 2054 7275 650a  bility"] = True.
+000232d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000232e0: 7461 675f 746f 5f61 6464 5b22 6f72 6967  tag_to_add["orig
+000232f0: 696e 225d 203d 2022 7573 6572 220a 2020  in"] = "user".  
+00023300: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+00023310: 675f 746f 5f61 6464 5b22 756e 6974 225d  g_to_add["unit"]
+00023320: 203d 2022 6d73 220a 2020 2020 2020 2020   = "ms".        
+00023330: 2020 2020 2020 2020 7461 675f 746f 5f61          tag_to_a
+00023340: 6464 5b22 6465 6661 756c 745f 7661 6c75  dd["default_valu
+00023350: 6522 5d20 3d20 4e6f 6e65 0a20 2020 2020  e"] = None.     
+00023360: 2020 2020 2020 2020 2020 2074 6167 5f74             tag_t
+00023370: 6f5f 6164 645b 2276 616c 7565 225d 203d  o_add["value"] =
+00023380: 2067 6574 5f64 6246 6965 6c64 5661 6c75   get_dbFieldValu
+00023390: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+000233a0: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
+000233b0: 6563 742c 2073 656c 662e 696e 5f66 696c  ect, self.in_fil
+000233c0: 652c 2022 5265 7065 7469 7469 6f6e 5469  e, "RepetitionTi
+000233d0: 6d65 220a 2020 2020 2020 2020 2020 2020  me".            
+000233e0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+000233f0: 2020 2020 2020 2069 6620 7461 675f 746f         if tag_to
+00023400: 5f61 6464 5b22 7661 6c75 6522 5d20 6973  _add["value"] is
+00023410: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00023420: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00023430: 6574 5f64 6246 6965 6c64 5661 6c75 6528  et_dbFieldValue(
+00023440: 7365 6c66 2e70 726f 6a65 6374 2c20 6669  self.project, fi
+00023450: 6c65 2c20 7461 675f 746f 5f61 6464 290a  le, tag_to_add).
+00023460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023470: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00023480: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00023490: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000234a0: 2020 2020 2020 2020 2020 2253 616e 6974            "Sanit
+000234b0: 697a 653a 5c6e 2074 6865 2027 5265 7065  ize:\n the 'Repe
+000234c0: 7469 7469 6f6e 5469 6d65 2720 7461 6720  titionTime' tag 
+000234d0: 636f 756c 6420 220a 2020 2020 2020 2020  could ".        
+000234e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000234f0: 226e 6f74 2062 6520 6164 6465 6420 746f  "not be added to
+00023500: 2074 6865 2064 6174 6162 6173 6520 666f   the database fo
+00023510: 7220 7468 6520 277b 7d27 2022 0a20 2020  r the '{}' ".   
+00023520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023530: 2020 2020 2022 7061 7261 6d65 7465 722e       "parameter.
+00023540: 2054 6869 7320 6361 6e20 6c65 6164 2074   This can lead t
+00023550: 6f20 6120 7375 6273 6571 7565 6e74 2069  o a subsequent i
+00023560: 7373 7565 2022 0a20 2020 2020 2020 2020  ssue ".         
+00023570: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00023580: 6475 7269 6e67 2069 6e69 7469 616c 697a  during initializ
+00023590: 6174 696f 6e21 215c 6e22 2e66 6f72 6d61  ation!!\n".forma
+000235a0: 7428 6669 6c65 290a 2020 2020 2020 2020  t(file).        
+000235b0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000235c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000235d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000235e0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+000235f0: 2020 2020 2020 2020 2020 2020 222d 2053              "- S
+00023600: 616e 6974 697a 6520 6272 6963 6b3a 2054  anitize brick: T
+00023610: 6865 7265 2077 6173 206e 6f20 6f75 7470  here was no outp
+00023620: 7574 2066 696c 6520 6465 6475 6374 6564  ut file deducted
+00023630: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00023640: 2020 2020 2020 2022 6475 7269 6e67 2069         "during i
+00023650: 6e69 7469 616c 6973 6174 696f 6e2e 2022  nitialisation. "
+00023660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023670: 2020 2020 2022 506c 6561 7365 2063 6865       "Please che
+00023680: 636b 2074 6865 2069 6e70 7574 2070 6172  ck the input par
+00023690: 616d 6574 6572 732e 2e2e 2122 0a20 2020  ameters...!".   
+000236a0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+000236b0: 2020 2020 2020 2020 2020 2020 2320 7461              # ta
+000236c0: 6773 2069 6e68 6572 6974 616e 6365 2028  gs inheritance (
+000236d0: 6f70 7469 6f6e 616c 290a 2020 2020 2020  optional).      
+000236e0: 2020 2020 2020 6966 2073 656c 662e 6f75        if self.ou
+000236f0: 7470 7574 735b 226f 7574 5f66 696c 6522  tputs["out_file"
+00023700: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00023710: 2020 2073 656c 662e 7461 6773 5f69 6e68     self.tags_inh
+00023720: 6572 6974 616e 6365 280a 2020 2020 2020  eritance(.      
+00023730: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00023740: 5f66 696c 653d 7365 6c66 2e69 6e5f 6669  _file=self.in_fi
+00023750: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00023760: 2020 2020 2020 2020 6f75 745f 6669 6c65          out_file
+00023770: 3d73 656c 662e 6f75 7470 7574 735b 226f  =self.outputs["o
+00023780: 7574 5f66 696c 6522 5d2c 0a20 2020 2020  ut_file"],.     
+00023790: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000237a0: 2020 2020 2020 2320 5265 7475 726e 2074        # Return t
+000237b0: 6865 2072 6571 7569 7265 6d65 6e74 2c20  he requirement, 
+000237c0: 6f75 7470 7574 7320 616e 6420 696e 6865  outputs and inhe
+000237d0: 7269 7461 6e63 655f 6469 6374 0a20 2020  ritance_dict.   
+000237e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000237f0: 2e6d 616b 655f 696e 6974 5265 7375 6c74  .make_initResult
+00023800: 2829 0a0a 2020 2020 6465 6620 7275 6e5f  ()..    def run_
+00023810: 7072 6f63 6573 735f 6d69 6128 7365 6c66  process_mia(self
+00023820: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
+00023830: 6469 6361 7465 6420 746f 2074 6865 2070  dicated to the p
+00023840: 726f 6365 7373 206c 6175 6e63 6820 7374  rocess launch st
+00023850: 6570 206f 6620 7468 6520 6272 6963 6b2e  ep of the brick.
+00023860: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
+00023870: 7228 5361 6e69 7469 7a65 2c20 7365 6c66  r(Sanitize, self
+00023880: 292e 7275 6e5f 7072 6f63 6573 735f 6d69  ).run_process_mi
+00023890: 6128 290a 0a20 2020 2020 2020 2066 696c  a()..        fil
+000238a0: 655f 6e61 6d65 203d 2073 656c 662e 696e  e_name = self.in
+000238b0: 5f66 696c 650a 0a20 2020 2020 2020 2023  _file..        #
+000238c0: 2049 6d61 6765 2070 726f 6365 7373 696e   Image processin
+000238d0: 670a 2020 2020 2020 2020 7472 793a 0a20  g.        try:. 
+000238e0: 2020 2020 2020 2020 2020 2069 6d67 203d             img =
+000238f0: 206e 6962 2e6c 6f61 6428 6669 6c65 5f6e   nib.load(file_n
+00023900: 616d 6529 0a0a 2020 2020 2020 2020 6578  ame)..        ex
+00023910: 6365 7074 2028 0a20 2020 2020 2020 2020  cept (.         
+00023920: 2020 206e 6962 2e66 696c 6562 6173 6564     nib.filebased
+00023930: 696d 6167 6573 2e49 6d61 6765 4669 6c65  images.ImageFile
+00023940: 4572 726f 722c 0a20 2020 2020 2020 2020  Error,.         
+00023950: 2020 2046 696c 654e 6f74 466f 756e 6445     FileNotFoundE
+00023960: 7272 6f72 2c0a 2020 2020 2020 2020 2020  rror,.          
+00023970: 2020 5479 7065 4572 726f 722c 0a20 2020    TypeError,.   
+00023980: 2020 2020 2029 2061 7320 653a 0a20 2020       ) as e:.   
+00023990: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+000239a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239b0: 225c 6e53 616e 6974 697a 6520 6272 6963  "\nSanitize bric
+000239c0: 6b3a 2045 7272 6f72 2077 6974 6820 6669  k: Error with fi
+000239d0: 6c65 7320 746f 206d 6173 6b2c 2064 7572  les to mask, dur
+000239e0: 696e 6720 7468 6520 220a 2020 2020 2020  ing the ".      
+000239f0: 2020 2020 2020 2020 2020 2272 756e 3a20            "run: 
+00023a00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00023a10: 2020 2065 2c0a 2020 2020 2020 2020 2020     e,.          
+00023a20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00023a30: 696d 6720 3d20 4e6f 6e65 0a0a 2020 2020  img = None..    
+00023a40: 2020 2020 6966 2069 6d67 2069 7320 6e6f      if img is no
+00023a50: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00023a60: 2020 2020 2320 5265 7472 6965 7665 2078      # Retrieve x
+00023a70: 666f 726d 2063 6f64 6573 0a20 2020 2020  form codes.     
+00023a80: 2020 2020 2020 2073 666f 726d 5f63 6f64         sform_cod
+00023a90: 6520 3d20 696e 7428 696d 672e 6865 6164  e = int(img.head
+00023aa0: 6572 2e5f 7374 7275 6374 6172 725b 2273  er._structarr["s
+00023ab0: 666f 726d 5f63 6f64 6522 5d29 0a20 2020  form_code"]).   
+00023ac0: 2020 2020 2020 2020 2071 666f 726d 5f63           qform_c
+00023ad0: 6f64 6520 3d20 696e 7428 696d 672e 6865  ode = int(img.he
+00023ae0: 6164 6572 2e5f 7374 7275 6374 6172 725b  ader._structarr[
+00023af0: 2271 666f 726d 5f63 6f64 6522 5d29 0a0a  "qform_code"])..
+00023b00: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+00023b10: 6563 6b20 7166 6f72 6d20 6973 2076 616c  eck qform is val
+00023b20: 6964 0a20 2020 2020 2020 2020 2020 2076  id.            v
+00023b30: 616c 6964 5f71 666f 726d 203d 2046 616c  alid_qform = Fal
+00023b40: 7365 0a20 2020 2020 2020 2020 2020 2074  se.            t
+00023b50: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00023b60: 2020 2020 696d 672e 6765 745f 7166 6f72      img.get_qfor
+00023b70: 6d28 290a 2020 2020 2020 2020 2020 2020  m().            
+00023b80: 2020 2020 7661 6c69 645f 7166 6f72 6d20      valid_qform 
+00023b90: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00023ba0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
+00023bb0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00023bc0: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
+00023bd0: 2020 2020 2020 2020 2320 4d61 7463 6869          # Matchi
+00023be0: 6e67 2061 6666 696e 6573 0a20 2020 2020  ng affines.     
+00023bf0: 2020 2020 2020 206d 6174 6368 696e 675f         matching_
+00023c00: 6166 6669 6e65 7320 3d20 7661 6c69 645f  affines = valid_
+00023c10: 7166 6f72 6d20 616e 6420 6e70 2e61 6c6c  qform and np.all
+00023c20: 636c 6f73 6528 0a20 2020 2020 2020 2020  close(.         
+00023c30: 2020 2020 2020 2069 6d67 2e67 6574 5f71         img.get_q
+00023c40: 666f 726d 2829 2c20 696d 672e 6765 745f  form(), img.get_
+00023c50: 7366 6f72 6d28 290a 2020 2020 2020 2020  sform().        
+00023c60: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00023c70: 2020 2073 6176 655f 6669 6c65 203d 2046     save_file = F
+00023c80: 616c 7365 0a0a 2020 2020 2020 2020 2020  alse..          
+00023c90: 2020 2320 426f 7468 206d 6174 6368 2c20    # Both match, 
+00023ca0: 7166 6f72 6d20 7661 6c69 6420 2869 6d70  qform valid (imp
+00023cb0: 6c69 6369 7420 7769 7468 206d 6174 6368  licit with match
+00023cc0: 292c 2063 6f64 6573 204f 4b0a 2020 2020  ), codes OK.    
+00023cd0: 2020 2020 2020 2020 2320 2d3e 2064 6f20          # -> do 
+00023ce0: 6e6f 7468 696e 672c 2065 6d70 7479 2072  nothing, empty r
+00023cf0: 6570 6f72 740a 2020 2020 2020 2020 2020  eport.          
+00023d00: 2020 6966 206d 6174 6368 696e 675f 6166    if matching_af
+00023d10: 6669 6e65 7320 616e 6420 7166 6f72 6d5f  fines and qform_
+00023d20: 636f 6465 203e 2030 2061 6e64 2073 666f  code > 0 and sfo
+00023d30: 726d 5f63 6f64 6520 3e20 303a 0a20 2020  rm_code > 0:.   
+00023d40: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00023d50: 655f 6669 6c65 203d 2054 7275 650a 0a20  e_file = True.. 
+00023d60: 2020 2020 2020 2020 2020 2023 2052 6f77             # Row
+00023d70: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00023d80: 656c 6966 2076 616c 6964 5f71 666f 726d  elif valid_qform
+00023d90: 2061 6e64 2071 666f 726d 5f63 6f64 6520   and qform_code 
+00023da0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00023db0: 2020 2020 2069 6d67 2e73 6574 5f73 666f       img.set_sfo
+00023dc0: 726d 2869 6d67 2e67 6574 5f71 666f 726d  rm(img.get_qform
+00023dd0: 2829 2c20 7166 6f72 6d5f 636f 6465 290a  (), qform_code).
 00023de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023df0: 7365 6c66 2e70 7265 6669 785f 7374 6464  self.prefix_stdd
-00023e00: 6576 203d 2022 2022 0a0a 2020 2020 2020  ev = " "..      
-00023e10: 2020 2020 2020 6669 6c65 5f73 7464 6465        file_stdde
-00023e20: 7620 3d20 2222 0a0a 2020 2020 2020 2020  v = ""..        
-00023e30: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-00023e40: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
-00023e50: 6666 6978 5f73 7464 6465 7620 3d3d 2022  ffix_stddev == "
-00023e60: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00023e70: 2020 2061 6e64 2073 656c 662e 7072 6566     and self.pref
-00023e80: 6978 5f73 7464 6465 7620 3d3d 2022 2022  ix_stddev == " "
-00023e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023ea0: 2061 6e64 2070 6174 6820 3d3d 2073 656c   and path == sel
-00023eb0: 662e 6f75 7470 7574 5f64 6972 6563 746f  f.output_directo
-00023ec0: 7279 0a20 2020 2020 2020 2020 2020 2029  ry.            )
-00023ed0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023ee0: 2020 6d73 6720 3d20 514d 6573 7361 6765    msg = QMessage
-00023ef0: 426f 7828 290a 2020 2020 2020 2020 2020  Box().          
-00023f00: 2020 2020 2020 6d73 672e 7365 7449 636f        msg.setIco
-00023f10: 6e28 514d 6573 7361 6765 426f 782e 5761  n(QMessageBox.Wa
-00023f20: 726e 696e 6729 0a20 2020 2020 2020 2020  rning).         
-00023f30: 2020 2020 2020 206d 7367 2e73 6574 5769         msg.setWi
-00023f40: 6e64 6f77 5469 746c 6528 226d 6961 5f70  ndowTitle("mia_p
-00023f50: 726f 6365 7373 6573 202d 2054 534e 5220  rocesses - TSNR 
-00023f60: 6272 6963 6b20 5761 726e 696e 6721 2229  brick Warning!")
-00023f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023f80: 206d 7367 2e73 6574 5465 7874 280a 2020   msg.setText(.  
-00023f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023fa0: 2020 2273 7566 6669 785f 7374 6464 6576    "suffix_stddev
-00023fb0: 2061 6e64 2070 7265 6669 785f 7374 6464   and prefix_stdd
-00023fc0: 6576 2069 6e70 7574 2070 6172 616d 6574  ev input paramet
-00023fd0: 6572 7320 6172 6520 6e6f 7420 220a 2020  ers are not ".  
-00023fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ff0: 2020 2264 6566 696e 6564 206f 7220 636f    "defined or co
-00024000: 6e73 6973 7420 6f6e 6c79 206f 6620 6f6e  nsist only of on
-00024010: 6520 6f72 206d 6f72 6520 7768 6974 6520  e or more white 
-00024020: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00024030: 2020 2020 2020 2273 7061 6365 732e 5c6e        "spaces.\n
-00024040: 5468 6520 7b30 7d20 696e 7075 7420 7061  The {0} input pa
-00024050: 7261 6d65 7465 7220 7769 6c6c 2062 6520  rameter will be 
-00024060: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00024070: 2020 2020 2020 226f 7665 7277 7269 7474        "overwritt
-00024080: 656e 202e 2e2e 5c6e 2059 6573 206f 7220  en ...\n Yes or 
-00024090: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000240a0: 2020 2020 2020 2241 626f 7274 3f22 2e66        "Abort?".f
-000240b0: 6f72 6d61 7428 6669 6c65 4e61 6d65 290a  ormat(fileName).
-000240c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000240e0: 2020 6d73 672e 7365 7453 7461 6e64 6172    msg.setStandar
-000240f0: 6442 7574 746f 6e73 2851 4d65 7373 6167  dButtons(QMessag
-00024100: 6542 6f78 2e59 6573 207c 2051 4d65 7373  eBox.Yes | QMess
-00024110: 6167 6542 6f78 2e41 626f 7274 290a 2020  ageBox.Abort).  
-00024120: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00024130: 7476 616c 203d 206d 7367 2e65 7865 635f  tval = msg.exec_
-00024140: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00024150: 2020 2020 6966 2072 6574 7661 6c20 213d      if retval !=
-00024160: 2051 4d65 7373 6167 6542 6f78 2e41 626f   QMessageBox.Abo
-00024170: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
-00024180: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-00024190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000241a0: 2020 2020 2020 2022 5c6e 5453 4e52 2062         "\nTSNR b
-000241b0: 7269 636b 2077 6172 6e69 6e67 3a20 7468  rick warning: th
-000241c0: 6520 6f75 745f 7374 6464 6576 5f66 696c  e out_stddev_fil
-000241d0: 6520 6f75 7470 7574 2022 0a20 2020 2020  e output ".     
-000241e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000241f0: 2020 2022 7061 7261 6d65 7465 7220 6973     "parameter is
-00024200: 2074 6865 2073 616d 6520 6173 2074 6865   the same as the
-00024210: 2069 6e5f 6669 6c65 7320 696e 7075 7420   in_files input 
-00024220: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00024230: 2020 2020 2020 2020 2020 2270 6172 616d            "param
-00024240: 6574 6572 2028 7375 6666 6978 2061 6e64  eter (suffix and
-00024250: 2070 7265 6669 7820 6172 6520 6e6f 7420   prefix are not 
-00024260: 6465 6669 6e65 6429 3a22 0a20 2020 2020  defined):".     
-00024270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024280: 2020 2022 5c6e 7b30 7d20 7769 6c6c 2062     "\n{0} will b
-00024290: 6520 6f76 6572 7772 6974 6564 202e 2e2e  e overwrited ...
-000242a0: 222e 666f 726d 6174 2866 696c 654e 616d  ".format(fileNam
-000242b0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000242c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000242d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000242e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000242f0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-00024300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024310: 2020 225c 6e54 534e 5220 6272 6963 6b20    "\nTSNR brick 
-00024320: 4162 6f72 7465 642e 2050 6c65 6173 6520  Aborted. Please 
-00024330: 6368 6563 6b20 796f 7572 2069 6e70 7574  check your input
-00024340: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00024350: 2020 2020 2020 2020 2020 2022 7061 7261             "para
-00024360: 6d65 7465 7273 202e 2e2e 220a 2020 2020  meters ...".    
-00024370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024380: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00024390: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-000243a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000243b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243c0: 6669 6c65 5f73 7464 6465 7620 3d20 6f73  file_stddev = os
-000243d0: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
-000243e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243f0: 7365 6c66 2e6f 7574 7075 745f 6469 7265  self.output_dire
-00024400: 6374 6f72 792c 0a20 2020 2020 2020 2020  ctory,.         
-00024410: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
-00024420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024430: 2020 2020 2073 656c 662e 7072 6566 6978       self.prefix
-00024440: 5f73 7464 6465 762e 7374 7269 7028 290a  _stddev.strip().
-00024450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024460: 2020 2020 2020 2020 2b20 6669 6c65 4e61          + fileNa
-00024470: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-00024480: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
-00024490: 662e 7375 6666 6978 5f73 7464 6465 762e  f.suffix_stddev.
-000244a0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+00023df0: 7361 7665 5f66 696c 6520 3d20 5472 7565  save_file = True
+00023e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023e10: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+00023e20: 2020 2020 2020 2020 2020 2020 225c 6e53              "\nS
+00023e30: 616e 6974 697a 6520 6272 6963 6b3a 204e  anitize brick: N
+00023e40: 6f74 6520 6f6e 206f 7269 656e 7461 7469  ote on orientati
+00023e50: 6f6e 3a22 0a20 2020 2020 2020 2020 2020  on:".           
+00023e60: 2020 2020 2020 2020 2022 5c6e 5468 6520           "\nThe 
+00023e70: 7366 6f72 6d20 6861 7320 6265 656e 2063  sform has been c
+00023e80: 6f70 6965 6420 6672 6f6d 2071 666f 726d  opied from qform
+00023e90: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+00023ea0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+00023eb0: 2020 2320 526f 7773 2033 2d34 3a0a 2020    # Rows 3-4:.  
+00023ec0: 2020 2020 2020 2020 2020 2320 4e6f 7465            # Note
+00023ed0: 3a20 6966 2071 666f 726d 2069 7320 6e6f  : if qform is no
+00023ee0: 7420 7661 6c69 642c 206d 6174 6368 696e  t valid, matchin
+00023ef0: 675f 6166 6669 6e65 7320 6973 2046 616c  g_affines is Fal
+00023f00: 7365 0a20 2020 2020 2020 2020 2020 2065  se.            e
+00023f10: 6c69 6620 7366 6f72 6d5f 636f 6465 203e  lif sform_code >
+00023f20: 2030 2061 6e64 2028 6e6f 7420 6d61 7463   0 and (not matc
+00023f30: 6869 6e67 5f61 6666 696e 6573 206f 7220  hing_affines or 
+00023f40: 7166 6f72 6d5f 636f 6465 203d 3d20 3029  qform_code == 0)
+00023f50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023f60: 2020 696d 672e 7365 745f 7166 6f72 6d28    img.set_qform(
+00023f70: 696d 672e 6765 745f 7366 6f72 6d28 292c  img.get_sform(),
+00023f80: 2073 666f 726d 5f63 6f64 6529 0a20 2020   sform_code).   
+00023f90: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00023fa0: 655f 6669 6c65 203d 2054 7275 650a 2020  e_file = True.  
+00023fb0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00023fc0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+00023fd0: 2020 2020 2020 2020 2022 5c6e 5361 6e69           "\nSani
+00023fe0: 7469 7a65 2062 7269 636b 3a20 4e6f 7465  tize brick: Note
+00023ff0: 206f 6e20 6f72 6965 6e74 6174 696f 6e3a   on orientation:
+00024000: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00024010: 2020 2020 2020 225c 6e54 6865 2071 666f        "\nThe qfo
+00024020: 726d 2068 6173 2062 6565 6e20 636f 7069  rm has been copi
+00024030: 6564 2066 726f 6d20 7366 6f72 6d2e 220a  ed from sform.".
+00024040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024050: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00024060: 2020 2069 6620 6e6f 7420 7661 6c69 645f     if not valid_
+00024070: 7166 6f72 6d20 616e 6420 7166 6f72 6d5f  qform and qform_
+00024080: 636f 6465 203e 2030 3a0a 2020 2020 2020  code > 0:.      
+00024090: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000240a0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+000240b0: 2020 2020 2020 2020 2020 2020 2022 5c6e               "\n
+000240c0: 5361 6e69 7469 7a65 2062 7269 636b 2057  Sanitize brick W
+000240d0: 4152 4e49 4e47 3a20 496e 7661 6c69 6420  ARNING: Invalid 
+000240e0: 7166 6f72 6d20 220a 2020 2020 2020 2020  qform ".        
+000240f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024100: 2269 6e66 6f72 6d61 7469 6f6e 2e5c 6e54  "information.\nT
+00024110: 6865 2071 666f 726d 206d 6174 7269 7820  he qform matrix 
+00024120: 666f 756e 6420 696e 2074 6865 2066 696c  found in the fil
+00024130: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00024140: 2020 2020 2020 2020 2020 2020 2268 6561              "hea
+00024150: 6465 7220 6973 2069 6e76 616c 6964 2e20  der is invalid. 
+00024160: 5468 6520 7166 6f72 6d20 6861 7320 6265  The qform has be
+00024170: 656e 2063 6f70 6965 6420 6672 6f6d 2022  en copied from "
+00024180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024190: 2020 2020 2020 2020 2022 7366 6f72 6d2e           "sform.
+000241a0: 2043 6865 636b 696e 6720 7468 6520 6f72   Checking the or
+000241b0: 6967 696e 616c 2071 666f 726d 2069 6e66  iginal qform inf
+000241c0: 6f72 6d61 7469 6f6e 2066 726f 6d20 220a  ormation from ".
+000241d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000241e0: 2020 2020 2020 2020 2274 6865 2064 6174          "the dat
+000241f0: 6120 7072 6f64 7563 6564 2062 7920 7468  a produced by th
+00024200: 6520 7363 616e 6e65 7220 6973 2061 6476  e scanner is adv
+00024210: 6973 6564 2e22 0a20 2020 2020 2020 2020  ised.".         
+00024220: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00024230: 2020 2020 2020 2020 2020 2320 526f 7773            # Rows
+00024240: 2035 2d36 3a0a 2020 2020 2020 2020 2020   5-6:.          
+00024250: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00024260: 2020 2020 2020 2020 6166 6669 6e65 203d          affine =
+00024270: 2069 6d67 2e61 6666 696e 650a 2020 2020   img.affine.    
+00024280: 2020 2020 2020 2020 2020 2020 696d 672e              img.
+00024290: 7365 745f 7366 6f72 6d28 6166 6669 6e65  set_sform(affine
+000242a0: 2c20 6e69 622e 6e69 6674 6931 2e78 666f  , nib.nifti1.xfo
+000242b0: 726d 5f63 6f64 6573 5b22 7363 616e 6e65  rm_codes["scanne
+000242c0: 7222 5d29 0a20 2020 2020 2020 2020 2020  r"]).           
+000242d0: 2020 2020 2069 6d67 2e73 6574 5f71 666f       img.set_qfo
+000242e0: 726d 2861 6666 696e 652c 206e 6962 2e6e  rm(affine, nib.n
+000242f0: 6966 7469 312e 7866 6f72 6d5f 636f 6465  ifti1.xform_code
+00024300: 735b 2273 6361 6e6e 6572 225d 290a 2020  s["scanner"]).  
+00024310: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00024320: 7665 5f66 696c 6520 3d20 5472 7565 0a20  ve_file = True. 
+00024330: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00024340: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+00024350: 2020 2020 2020 2020 2020 225c 6e53 616e            "\nSan
+00024360: 6974 697a 6520 6272 6963 6b20 5741 524e  itize brick WARN
+00024370: 494e 473a 204d 6973 7369 6e67 206f 7269  ING: Missing ori
+00024380: 656e 7461 7469 6f6e 2022 0a20 2020 2020  entation ".     
+00024390: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000243a0: 696e 666f 726d 6174 696f 6e2e 5c6e 4f72  information.\nOr
+000243b0: 6965 6e74 6174 696f 6e20 696e 666f 726d  ientation inform
+000243c0: 6174 696f 6e20 636f 756c 6420 6e6f 7420  ation could not 
+000243d0: 6265 2022 0a20 2020 2020 2020 2020 2020  be ".           
+000243e0: 2020 2020 2020 2020 2022 7265 7472 6965           "retrie
+000243f0: 7665 6420 6672 6f6d 2074 6865 2069 6d61  ved from the ima
+00024400: 6765 2068 6561 6465 722e 2054 6865 2071  ge header. The q
+00024410: 666f 726d 2061 6e64 2073 666f 726d 2022  form and sform "
+00024420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024430: 2020 2020 2022 6d61 7472 6963 6573 2068       "matrices h
+00024440: 6176 6520 6265 656e 2073 6574 2074 6f20  ave been set to 
+00024450: 6120 6465 6661 756c 7420 4c41 532d 6f72  a default LAS-or
+00024460: 6965 6e74 6564 2022 0a20 2020 2020 2020  iented ".       
+00024470: 2020 2020 2020 2020 2020 2020 2022 6166               "af
+00024480: 6669 6e65 2e20 416e 616c 7973 6573 206f  fine. Analyses o
+00024490: 6620 7468 6973 2064 6174 6173 6574 204d  f this dataset M
+000244a0: 4159 2042 4520 494e 5641 4c49 4421 220a  AY BE INVALID!".
 000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244c0: 2b20 222e 220a 2020 2020 2020 2020 2020  + ".".          
-000244d0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-000244e0: 696e 5f65 7874 0a20 2020 2020 2020 2020  in_ext.         
-000244f0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00024500: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00024510: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00024520: 662e 6f75 7470 7574 735b 226f 7574 5f74  f.outputs["out_t
-00024530: 736e 725f 6669 6c65 225d 203d 2066 696c  snr_file"] = fil
-00024540: 655f 7473 6e72 0a20 2020 2020 2020 2020  e_tsnr.         
-00024550: 2020 2073 656c 662e 6f75 7470 7574 735b     self.outputs[
-00024560: 226f 7574 5f73 7464 6465 765f 6669 6c65  "out_stddev_file
-00024570: 225d 203d 2066 696c 655f 7374 6464 6576  "] = file_stddev
-00024580: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00024590: 7461 6773 2069 6e68 6572 6974 616e 6365  tags inheritance
-000245a0: 2028 6f70 7469 6f6e 616c 290a 2020 2020   (optional).    
-000245b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000245c0: 6f75 7470 7574 735b 226f 7574 5f74 736e  outputs["out_tsn
-000245d0: 725f 6669 6c65 225d 3a0a 2020 2020 2020  r_file"]:.      
-000245e0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-000245f0: 6167 735f 696e 6865 7269 7461 6e63 6528  ags_inheritance(
-00024600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024610: 2020 2020 2069 6e5f 6669 6c65 3d73 656c       in_file=sel
-00024620: 662e 696e 5f66 696c 652c 0a20 2020 2020  f.in_file,.     
-00024630: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00024640: 7574 5f66 696c 653d 7365 6c66 2e6f 7574  ut_file=self.out
-00024650: 7075 7473 5b22 6f75 745f 7473 6e72 5f66  puts["out_tsnr_f
-00024660: 696c 6522 5d2c 0a20 2020 2020 2020 2020  ile"],.         
-00024670: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00024680: 2020 2020 2020 6966 2073 656c 662e 6f75        if self.ou
-00024690: 7470 7574 735b 226f 7574 5f73 7464 6465  tputs["out_stdde
-000246a0: 765f 6669 6c65 225d 3a0a 2020 2020 2020  v_file"]:.      
-000246b0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-000246c0: 6167 735f 696e 6865 7269 7461 6e63 6528  ags_inheritance(
-000246d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000246e0: 2020 2020 2069 6e5f 6669 6c65 3d73 656c       in_file=sel
-000246f0: 662e 696e 5f66 696c 652c 0a20 2020 2020  f.in_file,.     
-00024700: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00024710: 7574 5f66 696c 653d 7365 6c66 2e6f 7574  ut_file=self.out
-00024720: 7075 7473 5b22 6f75 745f 7374 6464 6576  puts["out_stddev
-00024730: 5f66 696c 6522 5d2c 0a20 2020 2020 2020  _file"],.       
-00024740: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00024750: 2020 2020 2320 5265 7475 726e 2074 6865      # Return the
-00024760: 2072 6571 7569 7265 6d65 6e74 2c20 6f75   requirement, ou
-00024770: 7470 7574 7320 616e 6420 696e 6865 7269  tputs and inheri
-00024780: 7461 6e63 655f 6469 6374 0a20 2020 2020  tance_dict.     
-00024790: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-000247a0: 616b 655f 696e 6974 5265 7375 6c74 2829  ake_initResult()
-000247b0: 0a0a 2020 2020 6465 6620 7275 6e5f 7072  ..    def run_pr
-000247c0: 6f63 6573 735f 6d69 6128 7365 6c66 293a  ocess_mia(self):
-000247d0: 0a20 2020 2020 2020 2022 2222 4465 6469  .        """Dedi
-000247e0: 6361 7465 6420 746f 2074 6865 2070 726f  cated to the pro
-000247f0: 6365 7373 206c 6175 6e63 6820 7374 6570  cess launch step
-00024800: 206f 6620 7468 6520 6272 6963 6b2e 2222   of the brick.""
-00024810: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
-00024820: 5453 4e52 2c20 7365 6c66 292e 7275 6e5f  TSNR, self).run_
-00024830: 7072 6f63 6573 735f 6d69 6128 290a 0a20  process_mia().. 
-00024840: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00024850: 203d 2073 656c 662e 696e 5f66 696c 650a   = self.in_file.
-00024860: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00024870: 2020 2020 2020 2020 2020 696d 6720 3d20            img = 
-00024880: 6e69 622e 6c6f 6164 2866 696c 655f 6e61  nib.load(file_na
-00024890: 6d65 290a 2020 2020 2020 2020 6578 6365  me).        exce
-000248a0: 7074 2028 0a20 2020 2020 2020 2020 2020  pt (.           
-000248b0: 206e 6962 2e66 696c 6562 6173 6564 696d   nib.filebasedim
-000248c0: 6167 6573 2e49 6d61 6765 4669 6c65 4572  ages.ImageFileEr
-000248d0: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
-000248e0: 2046 696c 654e 6f74 466f 756e 6445 7272   FileNotFoundErr
-000248f0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00024900: 5479 7065 4572 726f 722c 0a20 2020 2020  TypeError,.     
-00024910: 2020 2029 2061 7320 653a 0a20 2020 2020     ) as e:.     
-00024920: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-00024930: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-00024940: 6e54 534e 5220 6272 6963 6b3a 2045 7272  nTSNR brick: Err
-00024950: 6f72 2077 6974 6820 6669 6c65 7320 746f  or with files to
-00024960: 206d 6173 6b2c 2064 7572 696e 6720 7468   mask, during th
-00024970: 6520 7275 6e3a 2022 2c0a 2020 2020 2020  e run: ",.      
-00024980: 2020 2020 2020 2020 2020 652c 0a20 2020            e,.   
-00024990: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000249a0: 2020 2020 2020 2069 6d67 203d 204e 6f6e         img = Non
-000249b0: 650a 0a20 2020 2020 2020 2069 6620 696d  e..        if im
-000249c0: 6720 6973 206e 6f74 204e 6f6e 653a 0a20  g is not None:. 
-000249d0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-000249e0: 7220 3d20 696d 672e 6865 6164 6572 2e63  r = img.header.c
-000249f0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00024a00: 2020 6461 7461 203d 2069 6d67 2e67 6574    data = img.get
-00024a10: 5f66 6461 7461 2864 7479 7065 3d6e 702e  _fdata(dtype=np.
-00024a20: 666c 6f61 7433 3229 2e72 6573 6861 7065  float32).reshape
-00024a30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00024a40: 2020 696d 672e 7368 6170 655b 3a33 5d20    img.shape[:3] 
-00024a50: 2b20 282d 312c 290a 2020 2020 2020 2020  + (-1,).        
-00024a60: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00024a70: 2020 6461 7461 203d 206e 702e 6e61 6e5f    data = np.nan_
-00024a80: 746f 5f6e 756d 2864 6174 6129 0a0a 2020  to_num(data)..  
-00024a90: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
-00024aa0: 612e 6474 7970 652e 6b69 6e64 203d 3d20  a.dtype.kind == 
-00024ab0: 2269 223a 0a20 2020 2020 2020 2020 2020  "i":.           
-00024ac0: 2020 2020 2068 6561 6465 722e 7365 745f       header.set_
-00024ad0: 6461 7461 5f64 7479 7065 286e 702e 666c  data_dtype(np.fl
-00024ae0: 6f61 7433 3229 0a20 2020 2020 2020 2020  oat32).         
-00024af0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
-00024b00: 7461 2e61 7374 7970 6528 6e70 2e66 6c6f  ta.astype(np.flo
-00024b10: 6174 3332 290a 0a20 2020 2020 2020 2020  at32)..         
-00024b20: 2020 206d 6561 6e69 6d67 203d 206e 702e     meanimg = np.
-00024b30: 6d65 616e 2864 6174 612c 2061 7869 733d  mean(data, axis=
-00024b40: 3329 0a20 2020 2020 2020 2020 2020 2073  3).            s
-00024b50: 7464 6465 7669 6d67 203d 206e 702e 7374  tddevimg = np.st
-00024b60: 6428 6461 7461 2c20 6178 6973 3d33 290a  d(data, axis=3).
-00024b70: 2020 2020 2020 2020 2020 2020 7473 6e72              tsnr
-00024b80: 203d 206e 702e 7a65 726f 735f 6c69 6b65   = np.zeros_like
-00024b90: 286d 6561 6e69 6d67 290a 2020 2020 2020  (meanimg).      
-00024ba0: 2020 2020 2020 7374 6464 6576 696d 675f        stddevimg_
-00024bb0: 6e6f 6e7a 6572 6f20 3d20 7374 6464 6576  nonzero = stddev
-00024bc0: 696d 6720 3e20 312e 3065 2d33 0a20 2020  img > 1.0e-3.   
-00024bd0: 2020 2020 2020 2020 2074 736e 725b 7374           tsnr[st
-00024be0: 6464 6576 696d 675f 6e6f 6e7a 6572 6f5d  ddevimg_nonzero]
-00024bf0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00024c00: 2020 2020 206d 6561 6e69 6d67 5b73 7464       meanimg[std
-00024c10: 6465 7669 6d67 5f6e 6f6e 7a65 726f 5d20  devimg_nonzero] 
-00024c20: 2f20 7374 6464 6576 696d 675b 7374 6464  / stddevimg[stdd
-00024c30: 6576 696d 675f 6e6f 6e7a 6572 6f5d 0a20  evimg_nonzero]. 
-00024c40: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00024c50: 2020 2020 2020 2020 2020 2320 496d 6167            # Imag
-00024c60: 6520 7361 7665 0a20 2020 2020 2020 2020  e save.         
-00024c70: 2020 205f 2c20 6669 6c65 5f6e 616d 6520     _, file_name 
-00024c80: 3d20 6f73 2e70 6174 682e 7370 6c69 7428  = os.path.split(
-00024c90: 6669 6c65 5f6e 616d 6529 0a20 2020 2020  file_name).     
-00024ca0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00024cb0: 5f6e 6f5f 6578 742c 2066 696c 655f 6578  _no_ext, file_ex
-00024cc0: 7465 6e73 696f 6e20 3d20 6f73 2e70 6174  tension = os.pat
-00024cd0: 682e 7370 6c69 7465 7874 2866 696c 655f  h.splitext(file_
-00024ce0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00024cf0: 2020 6966 2066 696c 655f 6578 7465 6e73    if file_extens
-00024d00: 696f 6e20 3d3d 2022 2e67 7a22 3a0a 2020  ion == ".gz":.  
-00024d10: 2020 2020 2020 2020 2020 2020 2020 2866                (f
-00024d20: 696c 655f 6e61 6d65 5f6e 6f5f 6578 745f  ile_name_no_ext_
-00024d30: 322c 2066 696c 655f 6578 7465 6e73 696f  2, file_extensio
-00024d40: 6e5f 3229 203d 206f 732e 7061 7468 2e73  n_2) = os.path.s
-00024d50: 706c 6974 6578 7428 0a20 2020 2020 2020  plitext(.       
-00024d60: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00024d70: 655f 6e61 6d65 5f6e 6f5f 6578 740a 2020  e_name_no_ext.  
-00024d80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00024d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024da0: 6966 2066 696c 655f 6578 7465 6e73 696f  if file_extensio
-00024db0: 6e5f 3220 3d3d 2022 2e6e 6969 223a 0a20  n_2 == ".nii":. 
-00024dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024dd0: 2020 2066 696c 655f 6e61 6d65 5f6e 6f5f     file_name_no_
-00024de0: 6578 7420 3d20 6669 6c65 5f6e 616d 655f  ext = file_name_
-00024df0: 6e6f 5f65 7874 5f32 0a20 2020 2020 2020  no_ext_2.       
-00024e00: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00024e10: 655f 6578 7465 6e73 696f 6e20 3d20 222e  e_extension = ".
-00024e20: 6e69 692e 677a 220a 0a20 2020 2020 2020  nii.gz"..       
-00024e30: 2020 2020 2074 736e 725f 6669 6c65 5f6f       tsnr_file_o
-00024e40: 7574 203d 206f 732e 7061 7468 2e6a 6f69  ut = os.path.joi
-00024e50: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00024e60: 2020 2073 656c 662e 6f75 7470 7574 5f64     self.output_d
-00024e70: 6972 6563 746f 7279 2c0a 2020 2020 2020  irectory,.      
-00024e80: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-00024e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ea0: 7365 6c66 2e70 7265 6669 785f 7473 6e72  self.prefix_tsnr
-00024eb0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-00024ec0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-00024ed0: 696c 655f 6e61 6d65 5f6e 6f5f 6578 740a  ile_name_no_ext.
-00024ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ef0: 2020 2020 2b20 7365 6c66 2e73 7566 6669      + self.suffi
-00024f00: 785f 7473 6e72 2e73 7472 6970 2829 0a20  x_tsnr.strip(). 
-00024f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f20: 2020 202b 2066 696c 655f 6578 7465 6e73     + file_extens
-00024f30: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00024f40: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00024f50: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00024f60: 2074 736e 725f 696d 6720 3d20 6e69 622e   tsnr_img = nib.
-00024f70: 4e69 6674 6931 496d 6167 6528 7473 6e72  Nifti1Image(tsnr
-00024f80: 2c20 696d 672e 6166 6669 6e65 2c20 6865  , img.affine, he
-00024f90: 6164 6572 290a 2020 2020 2020 2020 2020  ader).          
-00024fa0: 2020 6e69 622e 7361 7665 2874 736e 725f    nib.save(tsnr_
-00024fb0: 696d 672c 2074 736e 725f 6669 6c65 5f6f  img, tsnr_file_o
-00024fc0: 7574 290a 0a20 2020 2020 2020 2020 2020  ut)..           
-00024fd0: 2073 7464 6465 765f 6669 6c65 5f6f 7574   stddev_file_out
-00024fe0: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
-00024ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025000: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
-00025010: 6563 746f 7279 2c0a 2020 2020 2020 2020  ectory,.        
-00025020: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-00025030: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00025040: 6c66 2e70 7265 6669 785f 7374 6464 6576  lf.prefix_stddev
-00025050: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-00025060: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-00025070: 696c 655f 6e61 6d65 5f6e 6f5f 6578 740a  ile_name_no_ext.
-00025080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025090: 2020 2020 2b20 7365 6c66 2e73 7566 6669      + self.suffi
-000250a0: 785f 7374 6464 6576 2e73 7472 6970 2829  x_stddev.strip()
-000250b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000250c0: 2020 2020 202b 2066 696c 655f 6578 7465       + file_exte
-000250d0: 6e73 696f 6e0a 2020 2020 2020 2020 2020  nsion.          
-000250e0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-000250f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00025100: 2020 2073 7464 6465 765f 696d 6720 3d20     stddev_img = 
-00025110: 6e69 622e 4e69 6674 6931 496d 6167 6528  nib.Nifti1Image(
-00025120: 7374 6464 6576 696d 672c 2069 6d67 2e61  stddevimg, img.a
-00025130: 6666 696e 652c 2068 6561 6465 7229 0a20  ffine, header). 
-00025140: 2020 2020 2020 2020 2020 206e 6962 2e73             nib.s
-00025150: 6176 6528 7374 6464 6576 5f69 6d67 2c20  ave(stddev_img, 
-00025160: 7374 6464 6576 5f66 696c 655f 6f75 7429  stddev_file_out)
-00025170: 0a0a 0a63 6c61 7373 2054 656d 706c 6174  ...class Templat
-00025180: 6546 726f 6d54 656d 706c 6174 6546 6c6f  eFromTemplateFlo
-00025190: 7728 5072 6f63 6573 734d 4941 293a 0a20  w(ProcessMIA):. 
-000251a0: 2020 2022 2222 0a20 2020 202a 4765 7420     """.    *Get 
-000251b0: 7465 6d70 6c61 7465 2069 6d61 6765 2066  template image f
-000251c0: 726f 6d20 7465 6d70 6c61 7465 666c 6f77  rom templateflow
-000251d0: 2a0a 0a20 2020 2050 6c65 6173 652c 2073  *..    Please, s
-000251e0: 6565 2074 6865 2063 6f6d 706c 6574 6520  ee the complete 
-000251f0: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
-00025200: 7220 7468 650a 2020 2020 6054 656d 706c  r the.    `Templ
-00025210: 6174 6546 726f 6d54 656d 706c 6174 6546  ateFromTemplateF
-00025220: 6c6f 7720 6272 6963 6b20 696e 2074 6865  low brick in the
-00025230: 206d 6961 5f70 726f 6365 7373 6573 2077   mia_processes w
-00025240: 6562 7369 7465 0a20 2020 203c 6874 7470  ebsite.    <http
-00025250: 733a 2f2f 706f 7075 6c73 652e 6769 7468  s://populse.gith
-00025260: 7562 2e69 6f2f 6d69 615f 7072 6f63 6573  ub.io/mia_proces
-00025270: 7365 732f 6874 6d6c 2f64 6f63 756d 656e  ses/html/documen
-00025280: 7461 7469 6f6e 2f62 7269 636b 732f 7072  tation/bricks/pr
-00025290: 6570 726f 6365 7373 2f6f 7468 6572 2f54  eprocess/other/T
-000252a0: 656d 706c 6174 6546 726f 6d54 656d 706c  emplateFromTempl
-000252b0: 6174 6546 6c6f 772e 6874 6d6c 3e60 5f0a  ateFlow.html>`_.
-000252c0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-000252d0: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
-000252e0: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
-000252f0: 6963 6174 6564 2074 6f20 7468 6520 6174  icated to the at
-00025300: 7472 6962 7574 6573 2069 6e69 7469 616c  tributes initial
-00025310: 6973 6174 696f 6e20 2f20 696e 7374 616e  isation / instan
-00025320: 7469 6174 696f 6e2e 0a0a 2020 2020 2020  tiation...      
-00025330: 2020 5468 6520 696e 7075 7420 616e 6420    The input and 
-00025340: 6f75 7470 7574 2070 6c75 6773 2061 7265  output plugs are
-00025350: 2064 6566 696e 6564 2068 6572 652e 2054   defined here. T
-00025360: 6865 2073 7065 6369 616c 0a20 2020 2020  he special.     
-00025370: 2020 2027 7365 6c66 2e72 6571 7569 7265     'self.require
-00025380: 6d65 6e74 2720 6174 7472 6962 7574 6520  ment' attribute 
-00025390: 286f 7074 696f 6e61 6c29 2069 7320 7573  (optional) is us
-000253a0: 6564 2074 6f20 6465 6669 6e65 2074 6865  ed to define the
-000253b0: 0a20 2020 2020 2020 2074 6869 7264 2d70  .        third-p
-000253c0: 6172 7479 2070 726f 6475 6374 7320 6e65  arty products ne
-000253d0: 6365 7373 6172 7920 666f 7220 7468 6520  cessary for the 
-000253e0: 7275 6e6e 696e 6720 6f66 2074 6865 2062  running of the b
-000253f0: 7269 636b 2e0a 2020 2020 2020 2020 2222  rick..        ""
-00025400: 220a 2020 2020 2020 2020 2320 496e 6974  ".        # Init
-00025410: 6961 6c69 7361 7469 6f6e 206f 6620 7468  ialisation of th
-00025420: 6520 6f62 6a65 6374 7320 6e65 6564 6564  e objects needed
-00025430: 2066 6f72 2074 6865 206c 6175 6e63 6820   for the launch 
-00025440: 6f66 2074 6865 2062 7269 636b 0a20 2020  of the brick.   
-00025450: 2020 2020 2073 7570 6572 2854 656d 706c       super(Templ
-00025460: 6174 6546 726f 6d54 656d 706c 6174 6546  ateFromTemplateF
-00025470: 6c6f 772c 2073 656c 6629 2e5f 5f69 6e69  low, self).__ini
-00025480: 745f 5f28 290a 0a20 2020 2020 2020 2023  t__()..        #
-00025490: 2054 6869 7264 2070 6172 7479 2073 6f66   Third party sof
-000254a0: 7477 6172 6573 2072 6571 7569 7265 6420  twares required 
-000254b0: 666f 7220 7468 6520 6578 6563 7574 696f  for the executio
-000254c0: 6e20 6f66 2074 6865 2062 7269 636b 0a20  n of the brick. 
-000254d0: 2020 2020 2020 2073 656c 662e 7265 7175         self.requ
-000254e0: 6972 656d 656e 7420 3d20 5b5d 0a0a 2020  irement = []..  
-000254f0: 2020 2020 2020 2320 496e 7075 7473 2064        # Inputs d
-00025500: 6573 6372 6970 7469 6f6e 0a20 2020 2020  escription.     
-00025510: 2020 2069 6e5f 7465 6d70 6c61 7465 5f64     in_template_d
-00025520: 6573 6320 3d20 2254 656d 706c 6174 6520  esc = "Template 
-00025530: 4e61 6d65 2028 6120 5374 7269 6e67 292e  Name (a String).
-00025540: 220a 2020 2020 2020 2020 7265 736f 6c75  ".        resolu
-00025550: 7469 6f6e 5f64 6573 6320 3d20 2252 6573  tion_desc = "Res
-00025560: 6f6c 7574 696f 6e20 6f66 2074 6865 2074  olution of the t
-00025570: 656d 706c 6174 6520 2028 496e 7420 6f72  emplate  (Int or
-00025580: 204e 6f6e 6529 220a 2020 2020 2020 2020   None)".        
-00025590: 7375 6666 6978 5f64 6573 6320 3d20 2242  suffix_desc = "B
-000255a0: 4944 5320 7375 6666 6978 2028 5374 7269  IDS suffix (Stri
-000255b0: 6e67 206f 7220 4e6f 6e65 2922 0a20 2020  ng or None)".   
-000255c0: 2020 2020 2061 746c 6173 5f64 6573 6320       atlas_desc 
-000255d0: 3d20 224e 616d 6520 6f66 2061 2070 6172  = "Name of a par
-000255e0: 7469 6375 6c61 7220 6174 6c61 7320 2853  ticular atlas (S
-000255f0: 7472 696e 6720 6f72 204e 6f6e 6529 220a  tring or None)".
-00025600: 2020 2020 2020 2020 6465 7363 5f64 6573          desc_des
-00025610: 6320 3d20 2244 6573 6372 6970 7469 6f6e  c = "Description
-00025620: 2066 6965 6c64 2028 5374 7269 6e67 206f   field (String o
-00025630: 7220 4e6f 6e65 2922 0a20 2020 2020 2020  r None)".       
-00025640: 206c 6162 656c 5f64 6573 6320 3d20 224c   label_desc = "L
-00025650: 6162 656c 2066 6965 6c64 2028 5374 7269  abel field (Stri
-00025660: 6e67 206f 7220 4e6f 6e65 2922 0a0a 2020  ng or None)"..  
-00025670: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
-00025680: 6465 7363 7269 7074 696f 6e0a 2020 2020  description.    
-00025690: 2020 2020 7465 6d70 6c61 7465 5f64 6573      template_des
-000256a0: 6320 3d20 280a 2020 2020 2020 2020 2020  c = (.          
-000256b0: 2020 2250 6174 6820 6f66 2074 6865 2074    "Path of the t
-000256c0: 656d 706c 6174 6520 2861 2070 6174 686c  emplate (a pathl
-000256d0: 696b 6520 6f62 6a65 6374 2022 0a20 2020  ike object ".   
-000256e0: 2020 2020 2020 2020 2022 6f72 2073 7472           "or str
-000256f0: 696e 6720 7265 7072 6573 656e 7469 6e67  ing representing
-00025700: 2061 2066 696c 6529 2e22 0a20 2020 2020   a file).".     
-00025710: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00025720: 496e 7075 7473 2074 7261 6974 730a 2020  Inputs traits.  
-00025730: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
-00025740: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
-00025750: 2020 2261 746c 6173 222c 0a20 2020 2020    "atlas",.     
-00025760: 2020 2020 2020 2074 7261 6974 732e 5374         traits.St
-00025770: 7269 6e67 2822 222c 206f 7574 7075 743d  ring("", output=
-00025780: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
-00025790: 5472 7565 2c20 6465 7363 3d61 746c 6173  True, desc=atlas
-000257a0: 5f64 6573 6329 2c0a 2020 2020 2020 2020  _desc),.        
-000257b0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000257c0: 6164 645f 7472 6169 7428 0a20 2020 2020  add_trait(.     
-000257d0: 2020 2020 2020 2022 6465 7363 222c 0a20         "desc",. 
-000257e0: 2020 2020 2020 2020 2020 2074 7261 6974             trait
-000257f0: 732e 5374 7269 6e67 2822 222c 206f 7574  s.String("", out
-00025800: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
-00025810: 6e61 6c3d 5472 7565 2c20 6465 7363 3d64  nal=True, desc=d
-00025820: 6573 635f 6465 7363 292c 0a20 2020 2020  esc_desc),.     
-00025830: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-00025840: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
-00025850: 2020 2020 2020 2020 2020 2269 6e5f 7465            "in_te
-00025860: 6d70 6c61 7465 222c 0a20 2020 2020 2020  mplate",.       
-00025870: 2020 2020 2074 7261 6974 732e 5374 7269       traits.Stri
-00025880: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
-00025890: 2020 2020 6465 6661 756c 743d 224d 4e49      default="MNI
-000258a0: 3135 324e 4c69 6e32 3030 3963 4173 796d  152NLin2009cAsym
-000258b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000258c0: 2020 206f 7574 7075 743d 4661 6c73 652c     output=False,
-000258d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000258e0: 206f 7074 696f 6e61 6c3d 5472 7565 2c0a   optional=True,.
-000258f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025900: 6465 7363 3d69 6e5f 7465 6d70 6c61 7465  desc=in_template
-00025910: 5f64 6573 632c 0a20 2020 2020 2020 2020  _desc,.         
-00025920: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
-00025930: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00025940: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
-00025950: 2020 2020 2022 6c61 6265 6c22 2c0a 2020       "label",.  
-00025960: 2020 2020 2020 2020 2020 7472 6169 7473            traits
-00025970: 2e53 7472 696e 6728 2222 2c20 6f75 7470  .String("", outp
-00025980: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
-00025990: 616c 3d54 7275 652c 2064 6573 633d 6c61  al=True, desc=la
-000259a0: 6265 6c5f 6465 7363 292c 0a20 2020 2020  bel_desc),.     
-000259b0: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-000259c0: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
-000259d0: 2020 2020 2020 2020 2020 2272 6573 6f6c            "resol
-000259e0: 7574 696f 6e22 2c0a 2020 2020 2020 2020  ution",.        
-000259f0: 2020 2020 7472 6169 7473 2e49 6e74 2832      traits.Int(2
-00025a00: 2c20 6f75 7470 7574 3d46 616c 7365 2c20  , output=False, 
-00025a10: 6f70 7469 6f6e 616c 3d54 7275 652c 2064  optional=True, d
-00025a20: 6573 633d 7265 736f 6c75 7469 6f6e 5f64  esc=resolution_d
-00025a30: 6573 6329 2c0a 2020 2020 2020 2020 290a  esc),.        ).
-00025a40: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00025a50: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
-00025a60: 2020 2020 2022 7375 6666 6978 222c 0a20       "suffix",. 
-00025a70: 2020 2020 2020 2020 2020 2074 7261 6974             trait
-00025a80: 732e 5374 7269 6e67 2822 222c 206f 7574  s.String("", out
-00025a90: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
-00025aa0: 6e61 6c3d 5472 7565 2c20 6465 7363 3d73  nal=True, desc=s
-00025ab0: 7566 6669 785f 6465 7363 292c 0a20 2020  uffix_desc),.   
-00025ac0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00025ad0: 2320 4f75 7470 7574 7320 7472 6169 7473  # Outputs traits
-00025ae0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00025af0: 645f 7472 6169 7428 2274 656d 706c 6174  d_trait("templat
-00025b00: 6522 2c20 4669 6c65 286f 7574 7075 743d  e", File(output=
-00025b10: 5472 7565 2c20 6465 7363 3d74 656d 706c  True, desc=templ
-00025b20: 6174 655f 6465 7363 2929 0a0a 2020 2020  ate_desc))..    
-00025b30: 2020 2020 7365 6c66 2e69 6e69 745f 6465      self.init_de
-00025b40: 6661 756c 745f 7472 6169 7473 2829 0a0a  fault_traits()..
-00025b50: 2020 2020 6465 6620 6c69 7374 5f6f 7574      def list_out
-00025b60: 7075 7473 2873 656c 662c 2069 735f 706c  puts(self, is_pl
-00025b70: 7567 6765 643d 4e6f 6e65 293a 0a20 2020  ugged=None):.   
-00025b80: 2020 2020 2022 2222 4465 6469 6361 7465       """Dedicate
-00025b90: 6420 746f 2074 6865 2069 6e69 7469 616c  d to the initial
-00025ba0: 6973 6174 696f 6e20 7374 6570 206f 6620  isation step of 
-00025bb0: 7468 6520 6272 6963 6b2e 0a0a 2020 2020  the brick...    
-00025bc0: 2020 2020 5468 6520 6d61 696e 206f 626a      The main obj
-00025bd0: 6563 7469 7665 206f 6620 7468 6973 206d  ective of this m
-00025be0: 6574 686f 6420 6973 2074 6f20 7072 6f64  ethod is to prod
-00025bf0: 7563 6520 7468 6520 6f75 7470 7574 7320  uce the outputs 
-00025c00: 6f66 2074 6865 0a20 2020 2020 2020 2062  of the.        b
-00025c10: 7269 636b 7320 2873 656c 662e 6f75 7470  ricks (self.outp
-00025c20: 7574 7329 2061 6e64 2074 6865 2061 7373  uts) and the ass
-00025c30: 6f63 6961 7465 6420 7461 6773 2028 7365  ociated tags (se
-00025c40: 6c66 2e69 6e68 6572 6974 616e 6365 5f64  lf.inheritance_d
-00025c50: 6963 292c 0a20 2020 2020 2020 2069 6620  ic),.        if 
-00025c60: 6465 6669 6e65 6420 6865 7265 2e20 546f  defined here. To
-00025c70: 2077 6f72 6b20 7072 6f70 6572 6c79 2074   work properly t
-00025c80: 6869 7320 6d65 7468 6f64 206d 7573 7420  his method must 
-00025c90: 7265 7475 726e 0a20 2020 2020 2020 2073  return.        s
-00025ca0: 656c 662e 6d61 6b65 5f69 6e69 7452 6573  elf.make_initRes
-00025cb0: 756c 7428 2920 6f62 6a65 6374 2e0a 0a20  ult() object... 
-00025cc0: 2020 2020 2020 203a 7061 7261 6d20 6973         :param is
-00025cd0: 5f70 6c75 6767 6564 3a20 7468 6520 7374  _plugged: the st
-00025ce0: 6174 652c 206c 696e 6b65 6420 6f72 206e  ate, linked or n
-00025cf0: 6f74 2c20 6f66 2074 6865 2070 6c75 6773  ot, of the plugs
-00025d00: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-00025d10: 6e73 3a20 6120 6469 6374 696f 6e61 7279  ns: a dictionary
-00025d20: 2077 6974 6820 7265 7175 6972 656d 656e   with requiremen
-00025d30: 742c 206f 7574 7075 7473 2061 6e64 2069  t, outputs and i
-00025d40: 6e68 6572 6974 616e 6365 5f64 6963 742e  nheritance_dict.
-00025d50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00025d60: 2020 2020 2023 2055 7369 6e67 2074 6865       # Using the
-00025d70: 2069 6e68 6572 6974 616e 6365 2074 6f20   inheritance to 
-00025d80: 5072 6f63 6573 734d 4941 2063 6c61 7373  ProcessMIA class
-00025d90: 2c20 6c69 7374 5f6f 7574 7075 7473 206d  , list_outputs m
-00025da0: 6574 686f 640a 2020 2020 2020 2020 7375  ethod.        su
-00025db0: 7065 7228 5465 6d70 6c61 7465 4672 6f6d  per(TemplateFrom
-00025dc0: 5465 6d70 6c61 7465 466c 6f77 2c20 7365  TemplateFlow, se
-00025dd0: 6c66 292e 6c69 7374 5f6f 7574 7075 7473  lf).list_outputs
-00025de0: 2829 0a0a 2020 2020 2020 2020 6966 206e  ()..        if n
-00025df0: 6f74 2073 656c 662e 7375 6666 6978 3a0a  ot self.suffix:.
-00025e00: 2020 2020 2020 2020 2020 2020 7375 6666              suff
-00025e10: 6978 203d 204e 6f6e 650a 2020 2020 2020  ix = None.      
-00025e20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00025e30: 2020 2020 7375 6666 6978 203d 2073 656c      suffix = sel
-00025e40: 662e 7375 6666 6978 0a0a 2020 2020 2020  f.suffix..      
-00025e50: 2020 6966 206e 6f74 2073 656c 662e 6174    if not self.at
-00025e60: 6c61 733a 0a20 2020 2020 2020 2020 2020  las:.           
-00025e70: 2061 746c 6173 203d 204e 6f6e 650a 2020   atlas = None.  
-00025e80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00025e90: 2020 2020 2020 2020 6174 6c61 7320 3d20          atlas = 
-00025ea0: 7365 6c66 2e61 746c 6173 0a0a 2020 2020  self.atlas..    
-00025eb0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00025ec0: 6465 7363 3a0a 2020 2020 2020 2020 2020  desc:.          
-00025ed0: 2020 6465 7363 203d 204e 6f6e 650a 2020    desc = None.  
-00025ee0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00025ef0: 2020 2020 2020 2020 6465 7363 203d 2073          desc = s
-00025f00: 656c 662e 6465 7363 0a0a 2020 2020 2020  elf.desc..      
-00025f10: 2020 6966 206e 6f74 2073 656c 662e 6c61    if not self.la
-00025f20: 6265 6c3a 0a20 2020 2020 2020 2020 2020  bel:.           
-00025f30: 206c 6162 656c 203d 204e 6f6e 650a 2020   label = None.  
-00025f40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00025f50: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
-00025f60: 7365 6c66 2e6c 6162 656c 0a0a 2020 2020  self.label..    
-00025f70: 2020 2020 7465 6d70 6c61 7465 5f73 7065      template_spe
-00025f80: 6320 3d20 7b0a 2020 2020 2020 2020 2020  c = {.          
-00025f90: 2020 2272 6573 6f6c 7574 696f 6e22 3a20    "resolution": 
-00025fa0: 7365 6c66 2e72 6573 6f6c 7574 696f 6e2c  self.resolution,
-00025fb0: 0a20 2020 2020 2020 2020 2020 2022 7375  .            "su
-00025fc0: 6666 6978 223a 2073 7566 6669 782c 0a20  ffix": suffix,. 
-00025fd0: 2020 2020 2020 2020 2020 2022 6174 6c61             "atla
-00025fe0: 7322 3a20 6174 6c61 732c 0a20 2020 2020  s": atlas,.     
-00025ff0: 2020 2020 2020 2022 6465 7363 223a 2064         "desc": d
-00026000: 6573 632c 0a20 2020 2020 2020 2020 2020  esc,.           
-00026010: 2022 6c61 6265 6c22 3a20 6c61 6265 6c2c   "label": label,
-00026020: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00026030: 2020 2020 7470 6c5f 7461 7267 6574 5f70      tpl_target_p
-00026040: 6174 6820 3d20 6765 745f 7465 6d70 6c61  ath = get_templa
-00026050: 7465 2873 656c 662e 696e 5f74 656d 706c  te(self.in_templ
-00026060: 6174 652c 202a 2a74 656d 706c 6174 655f  ate, **template_
-00026070: 7370 6563 290a 2020 2020 2020 2020 6966  spec).        if
-00026080: 206e 6f74 2074 706c 5f74 6172 6765 745f   not tpl_target_
-00026090: 7061 7468 3a0a 2020 2020 2020 2020 2020  path:.          
-000260a0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-000260b0: 2020 2020 2020 2020 2022 5c6e 5465 6d70           "\nTemp
-000260c0: 6c61 7465 4672 6f6d 5465 6d70 6c61 7465  lateFromTemplate
-000260d0: 466c 6f77 2062 7269 636b 3a20 436f 756c  Flow brick: Coul
-000260e0: 6420 6e6f 7420 6669 6e64 2074 656d 706c  d not find templ
-000260f0: 6174 6520 220a 2020 2020 2020 2020 2020  ate ".          
-00026100: 2020 2020 2020 2227 7b30 7d27 2077 6974        "'{0}' wit
-00026110: 6820 7370 6563 733d 7b31 7d2e 2050 6c65  h specs={1}. Ple
-00026120: 6173 6520 7265 7669 7365 2079 6f75 7220  ase revise your 
-00026130: 7465 6d70 6c61 7465 2022 0a20 2020 2020  template ".     
-00026140: 2020 2020 2020 2020 2020 2022 6172 6775             "argu
-00026150: 6d65 6e74 2e22 2e66 6f72 6d61 7428 7365  ment.".format(se
-00026160: 6c66 2e69 6e5f 7465 6d70 6c61 7465 2c20  lf.in_template, 
-00026170: 7465 6d70 6c61 7465 5f73 7065 6329 0a20  template_spec). 
-00026180: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00026190: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-000261a0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-000261b0: 7374 616e 6365 2874 706c 5f74 6172 6765  stance(tpl_targe
-000261c0: 745f 7061 7468 2c20 6c69 7374 293a 0a20  t_path, list):. 
-000261d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000261e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000261f0: 2020 225c 6e54 656d 706c 6174 6546 726f    "\nTemplateFro
-00026200: 6d54 656d 706c 6174 6546 6c6f 7720 6272  mTemplateFlow br
-00026210: 6963 6b3a 2054 6865 2061 7661 696c 6162  ick: The availab
-00026220: 6c65 2074 656d 706c 6174 6520 220a 2020  le template ".  
-00026230: 2020 2020 2020 2020 2020 2020 2020 226d                "m
-00026240: 6f64 6966 6965 7273 2028 7b30 7d29 2064  odifiers ({0}) d
-00026250: 6964 206e 6f74 2073 656c 6563 7420 6120  id not select a 
-00026260: 756e 6971 7565 2074 656d 706c 6174 6520  unique template 
-00026270: 2867 6f74 2022 0a20 2020 2020 2020 2020  (got ".         
-00026280: 2020 2020 2020 2022 277b 317d 2729 2e20         "'{1}'). 
-00026290: 506c 6561 7365 2072 6576 6973 6520 796f  Please revise yo
-000262a0: 7572 2074 656d 706c 6174 6520 220a 2020  ur template ".  
-000262b0: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-000262c0: 7267 756d 656e 742e 222e 666f 726d 6174  rgument.".format
-000262d0: 2873 656c 662e 696e 5f74 656d 706c 6174  (self.in_templat
-000262e0: 652c 2074 656d 706c 6174 655f 7370 6563  e, template_spec
-000262f0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00026300: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00026310: 726e 0a0a 2020 2020 2020 2020 7365 6c66  rn..        self
-00026320: 2e6f 7574 7075 7473 5b22 7465 6d70 6c61  .outputs["templa
-00026330: 7465 225d 203d 2073 7472 2874 706c 5f74  te"] = str(tpl_t
-00026340: 6172 6765 745f 7061 7468 290a 0a20 2020  arget_path)..   
-00026350: 2020 2020 2023 2052 6574 7572 6e20 7468       # Return th
-00026360: 6520 7265 7175 6972 656d 656e 742c 206f  e requirement, o
-00026370: 7574 7075 7473 2061 6e64 2069 6e68 6572  utputs and inher
-00026380: 6974 616e 6365 5f64 6963 740a 2020 2020  itance_dict.    
-00026390: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000263a0: 6d61 6b65 5f69 6e69 7452 6573 756c 7428  make_initResult(
-000263b0: 290a 0a20 2020 2064 6566 2072 756e 5f70  )..    def run_p
-000263c0: 726f 6365 7373 5f6d 6961 2873 656c 6629  rocess_mia(self)
-000263d0: 3a0a 2020 2020 2020 2020 2222 2244 6564  :.        """Ded
-000263e0: 6963 6174 6564 2074 6f20 7468 6520 7072  icated to the pr
-000263f0: 6f63 6573 7320 6c61 756e 6368 2073 7465  ocess launch ste
-00026400: 7020 6f66 2074 6865 2062 7269 636b 2e22  p of the brick."
-00026410: 2222 0a20 2020 2020 2020 2073 7570 6572  "".        super
-00026420: 2854 656d 706c 6174 6546 726f 6d54 656d  (TemplateFromTem
-00026430: 706c 6174 6546 6c6f 772c 2073 656c 6629  plateFlow, self)
-00026440: 2e72 756e 5f70 726f 6365 7373 5f6d 6961  .run_process_mia
-00026450: 2829 0a0a 0a63 6c61 7373 2054 6872 6573  ()...class Thres
-00026460: 686f 6c64 2850 726f 6365 7373 4d49 4129  hold(ProcessMIA)
-00026470: 3a0a 2020 2020 2222 220a 2020 2020 2a4d  :.    """.    *M
-00026480: 616b 6573 2061 2062 696e 6172 7920 6d61  akes a binary ma
-00026490: 736b 2069 6d61 6765 2061 7420 6120 6769  sk image at a gi
-000264a0: 7665 6e20 7468 7265 7368 6f6c 642a 0a0a  ven threshold*..
-000264b0: 2020 2020 506c 6561 7365 2c20 7365 6520      Please, see 
-000264c0: 7468 6520 636f 6d70 6c65 7465 2064 6f63  the complete doc
-000264d0: 756d 656e 7461 7469 6f6e 2066 6f72 2074  umentation for t
-000264e0: 6865 0a20 2020 2060 5468 7265 7368 6f6c  he.    `Threshol
-000264f0: 6420 6272 6963 6b20 696e 2074 6865 206d  d brick in the m
-00026500: 6961 5f70 726f 6365 7373 6573 2077 6562  ia_processes web
-00026510: 7369 7465 0a20 2020 203c 6874 7470 733a  site.    <https:
-00026520: 2f2f 706f 7075 6c73 652e 6769 7468 7562  //populse.github
-00026530: 2e69 6f2f 6d69 615f 7072 6f63 6573 7365  .io/mia_processe
-00026540: 732f 6874 6d6c 2f64 6f63 756d 656e 7461  s/html/documenta
-00026550: 7469 6f6e 2f62 7269 636b 732f 7072 6570  tion/bricks/prep
-00026560: 726f 6365 7373 2f6f 7468 6572 2f54 6872  rocess/other/Thr
-00026570: 6573 686f 6c64 2e68 746d 6c3e 605f 0a0a  eshold.html>`_..
-00026580: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00026590: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
-000265a0: 0a20 2020 2020 2020 2022 2222 4465 6469  .        """Dedi
-000265b0: 6361 7465 6420 746f 2074 6865 2061 7474  cated to the att
-000265c0: 7269 6275 7465 7320 696e 6974 6961 6c69  ributes initiali
-000265d0: 7361 7469 6f6e 202f 2069 6e73 7461 6e74  sation / instant
-000265e0: 6961 7469 6f6e 2e0a 0a20 2020 2020 2020  iation...       
-000265f0: 2054 6865 2069 6e70 7574 2061 6e64 206f   The input and o
-00026600: 7574 7075 7420 706c 7567 7320 6172 6520  utput plugs are 
-00026610: 6465 6669 6e65 6420 6865 7265 2e20 5468  defined here. Th
-00026620: 6520 7370 6563 6961 6c0a 2020 2020 2020  e special.      
-00026630: 2020 2773 656c 662e 7265 7175 6972 656d    'self.requirem
-00026640: 656e 7427 2061 7474 7269 6275 7465 2028  ent' attribute (
-00026650: 6f70 7469 6f6e 616c 2920 6973 2075 7365  optional) is use
-00026660: 6420 746f 2064 6566 696e 6520 7468 650a  d to define the.
-00026670: 2020 2020 2020 2020 7468 6972 642d 7061          third-pa
-00026680: 7274 7920 7072 6f64 7563 7473 206e 6563  rty products nec
-00026690: 6573 7361 7279 2066 6f72 2074 6865 2072  essary for the r
-000266a0: 756e 6e69 6e67 206f 6620 7468 6520 6272  unning of the br
-000266b0: 6963 6b2e 0a20 2020 2020 2020 2022 2222  ick..        """
-000266c0: 0a20 2020 2020 2020 2023 2049 6e69 7469  .        # Initi
-000266d0: 616c 6973 6174 696f 6e20 6f66 2074 6865  alisation of the
-000266e0: 206f 626a 6563 7473 206e 6565 6465 6420   objects needed 
-000266f0: 666f 7220 7468 6520 6c61 756e 6368 206f  for the launch o
-00026700: 6620 7468 6520 6272 6963 6b0a 2020 2020  f the brick.    
-00026710: 2020 2020 7375 7065 7228 5468 7265 7368      super(Thresh
-00026720: 6f6c 642c 2073 656c 6629 2e5f 5f69 6e69  old, self).__ini
-00026730: 745f 5f28 290a 0a20 2020 2020 2020 2023  t__()..        #
-00026740: 2054 6869 7264 2070 6172 7479 2073 6f66   Third party sof
-00026750: 7477 6172 6573 2072 6571 7569 7265 6420  twares required 
-00026760: 666f 7220 7468 6520 6578 6563 7574 696f  for the executio
-00026770: 6e20 6f66 2074 6865 2062 7269 636b 0a20  n of the brick. 
-00026780: 2020 2020 2020 2073 656c 662e 7265 7175         self.requ
-00026790: 6972 656d 656e 7420 3d20 5b5d 0a0a 2020  irement = []..  
-000267a0: 2020 2020 2020 2320 496e 7075 7473 2064        # Inputs d
-000267b0: 6573 6372 6970 7469 6f6e 0a20 2020 2020  escription.     
-000267c0: 2020 2069 6e5f 6669 6c65 735f 6465 7363     in_files_desc
-000267d0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-000267e0: 2022 4120 6c69 7374 206f 6620 6974 656d   "A list of item
-000267f0: 7320 7769 7468 2073 7472 696e 6720 656c  s with string el
-00026800: 656d 656e 7473 2063 6f72 7265 7370 6f6e  ements correspon
-00026810: 6469 6e67 2022 0a20 2020 2020 2020 2020  ding ".         
-00026820: 2020 2022 746f 2065 7869 7374 696e 6720     "to existing 
-00026830: 7061 7468 2066 696c 6573 2e22 0a20 2020  path files.".   
-00026840: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-00026850: 6872 6573 686f 6c64 5f64 6573 6320 3d20  hreshold_desc = 
-00026860: 280a 2020 2020 2020 2020 2020 2020 2256  (.            "V
-00026870: 616c 7565 2066 6f72 2074 6865 2061 7070  alue for the app
-00026880: 6c69 6564 2074 6872 6573 686f 6c64 2028  lied threshold (
-00026890: 6120 666c 6f61 7420 6265 7477 6565 6e20  a float between 
-000268a0: 3020 616e 6420 3129 2e22 0a20 2020 2020  0 and 1).".     
-000268b0: 2020 2029 0a20 2020 2020 2020 2047 4d5f     ).        GM_
-000268c0: 6669 6c74 6572 696e 675f 6465 7363 203d  filtering_desc =
-000268d0: 2028 0a20 2020 2020 2020 2020 2020 2022   (.            "
-000268e0: 4669 6c74 6572 696e 6720 2862 6173 6564  Filtering (based
-000268f0: 206f 6e20 7468 6520 6b65 7977 6f72 6420   on the keyword 
-00026900: 6331 2920 746f 206b 6565 7020 6f6e 6c79  c1) to keep only
-00026910: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-00026920: 6772 6579 206d 6174 7465 7220 696d 6167  grey matter imag
-00026930: 6573 2028 6120 626f 6f6c 6561 6e29 220a  es (a boolean)".
-00026940: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00026950: 2020 7375 6666 6978 5f64 6573 6320 3d20    suffix_desc = 
-00026960: 2253 7566 6669 7820 6f66 2074 6865 206f  "Suffix of the o
-00026970: 7574 7075 7420 696d 6167 6520 2861 2073  utput image (a s
-00026980: 7472 696e 6729 2e22 0a20 2020 2020 2020  tring).".       
-00026990: 2070 7265 6669 785f 6465 7363 203d 2022   prefix_desc = "
-000269a0: 5072 6566 6978 206f 6620 7468 6520 6f75  Prefix of the ou
-000269b0: 7470 7574 2069 6d61 6765 2028 6120 7374  tput image (a st
-000269c0: 7269 6e67 292e 220a 0a20 2020 2020 2020  ring)."..       
-000269d0: 2023 204f 7574 7075 7473 2064 6573 6372   # Outputs descr
-000269e0: 6970 7469 6f6e 0a20 2020 2020 2020 206f  iption.        o
-000269f0: 7574 5f66 696c 6573 5f64 6573 6320 3d20  ut_files_desc = 
-00026a00: 280a 2020 2020 2020 2020 2020 2020 2250  (.            "P
-00026a10: 6174 6820 6f66 2074 6865 2073 6361 6e20  ath of the scan 
-00026a20: 6166 7465 7220 6170 706c 6963 6174 696f  after applicatio
-00026a30: 6e20 6f66 2074 6865 2074 6872 6573 686f  n of the thresho
-00026a40: 6c64 2022 0a20 2020 2020 2020 2020 2020  ld ".           
-00026a50: 2022 2861 2070 6174 686c 696b 6520 6f62   "(a pathlike ob
-00026a60: 6a65 6374 206f 7220 7374 7269 6e67 2072  ject or string r
-00026a70: 6570 7265 7365 6e74 696e 6720 6120 6669  epresenting a fi
-00026a80: 6c65 2c20 6f72 2022 0a20 2020 2020 2020  le, or ".       
-00026a90: 2020 2020 2022 6120 6c69 7374 206f 6620       "a list of 
-00026aa0: 7061 7468 6c69 6b65 206f 626a 6563 7473  pathlike objects
-00026ab0: 206f 7220 7374 7269 6e67 7320 7265 7072   or strings repr
-00026ac0: 6573 656e 7469 6e67 2061 2022 0a20 2020  esenting a ".   
-00026ad0: 2020 2020 2020 2020 2022 6669 6c65 292e           "file).
-00026ae0: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
-00026af0: 2020 2020 2023 2049 6e70 7574 7320 7472       # Inputs tr
-00026b00: 6169 7473 0a20 2020 2020 2020 2073 656c  aits.        sel
-00026b10: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
-00026b20: 2020 2020 2020 2020 2022 696e 5f66 696c           "in_fil
-00026b30: 6573 222c 0a20 2020 2020 2020 2020 2020  es",.           
-00026b40: 2049 6e70 7574 4d75 6c74 6950 6174 6828   InputMultiPath(
-00026b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026b60: 2074 7261 6974 732e 4569 7468 6572 2846   traits.Either(F
-00026b70: 696c 6528 292c 2074 7261 6974 732e 4c69  ile(), traits.Li
-00026b80: 7374 2846 696c 6528 2929 292c 0a20 2020  st(File())),.   
-00026b90: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00026ba0: 7075 743d 4661 6c73 652c 0a20 2020 2020  put=False,.     
-00026bb0: 2020 2020 2020 2020 2020 2064 6573 633d             desc=
-00026bc0: 696e 5f66 696c 6573 5f64 6573 632c 0a20  in_files_desc,. 
-00026bd0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00026be0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00026bf0: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
-00026c00: 0a20 2020 2020 2020 2020 2020 2022 474d  .            "GM
-00026c10: 5f66 696c 7465 7269 6e67 222c 0a20 2020  _filtering",.   
-00026c20: 2020 2020 2020 2020 2074 7261 6974 732e           traits.
-00026c30: 426f 6f6c 280a 2020 2020 2020 2020 2020  Bool(.          
-00026c40: 2020 2020 2020 6465 6661 756c 745f 7661        default_va
-00026c50: 6c75 653d 5472 7565 2c0a 2020 2020 2020  lue=True,.      
-00026c60: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00026c70: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00026c80: 2020 2020 2020 2020 6f70 7469 6f6e 616c          optional
-00026c90: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00026ca0: 2020 2020 2020 2064 6573 633d 474d 5f66         desc=GM_f
-00026cb0: 696c 7465 7269 6e67 5f64 6573 632c 0a20  iltering_desc,. 
-00026cc0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00026cd0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00026ce0: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
-00026cf0: 0a20 2020 2020 2020 2020 2020 2022 7072  .            "pr
-00026d00: 6566 6978 222c 0a20 2020 2020 2020 2020  efix",.         
-00026d10: 2020 2074 7261 6974 732e 5374 7269 6e67     traits.String
-00026d20: 2822 222c 206f 7574 7075 743d 4661 6c73  ("", output=Fals
-00026d30: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
-00026d40: 2c20 6465 7363 3d70 7265 6669 785f 6465  , desc=prefix_de
-00026d50: 7363 292c 0a20 2020 2020 2020 2029 0a0a  sc),.        )..
-00026d60: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00026d70: 5f74 7261 6974 280a 2020 2020 2020 2020  _trait(.        
-00026d80: 2020 2020 2273 7566 6669 7822 2c0a 2020      "suffix",.  
-00026d90: 2020 2020 2020 2020 2020 7472 6169 7473            traits
-00026da0: 2e53 7472 696e 6728 0a20 2020 2020 2020  .String(.       
-00026db0: 2020 2020 2020 2020 2022 5f30 3032 222c           "_002",
-00026dc0: 206f 7574 7075 743d 4661 6c73 652c 206f   output=False, o
-00026dd0: 7074 696f 6e61 6c3d 5472 7565 2c20 6465  ptional=True, de
-00026de0: 7363 3d73 7566 6669 785f 6465 7363 0a20  sc=suffix_desc. 
-00026df0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00026e00: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00026e10: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
-00026e20: 0a20 2020 2020 2020 2020 2020 2022 7468  .            "th
-00026e30: 7265 7368 6f6c 6422 2c0a 2020 2020 2020  reshold",.      
-00026e40: 2020 2020 2020 7472 6169 7473 2e52 616e        traits.Ran
-00026e50: 6765 280a 2020 2020 2020 2020 2020 2020  ge(.            
-00026e60: 2020 2020 7661 6c75 653d 302e 332c 0a20      value=0.3,. 
-00026e70: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00026e80: 6f77 3d30 2e30 2c0a 2020 2020 2020 2020  ow=0.0,.        
-00026e90: 2020 2020 2020 2020 6869 6768 3d31 2e30          high=1.0
-00026ea0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00026eb0: 2020 6f75 7470 7574 3d46 616c 7365 2c0a    output=False,.
-00026ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ed0: 6f70 7469 6f6e 616c 3d54 7275 652c 0a20  optional=True,. 
-00026ee0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00026ef0: 6573 633d 7468 7265 7368 6f6c 645f 6465  esc=threshold_de
-00026f00: 7363 2c0a 2020 2020 2020 2020 2020 2020  sc,.            
-00026f10: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-00026f20: 2020 2020 2020 2320 4f75 7470 7574 7320        # Outputs 
-00026f30: 7472 6169 7473 0a20 2020 2020 2020 2073  traits.        s
-00026f40: 656c 662e 6164 645f 7472 6169 7428 0a20  elf.add_trait(. 
-00026f50: 2020 2020 2020 2020 2020 2022 6f75 745f             "out_
-00026f60: 6669 6c65 7322 2c0a 2020 2020 2020 2020  files",.        
-00026f70: 2020 2020 4f75 7470 7574 4d75 6c74 6950      OutputMultiP
-00026f80: 6174 6828 4669 6c65 2829 2c20 6f75 7470  ath(File(), outp
-00026f90: 7574 3d54 7275 652c 2064 6573 633d 6f75  ut=True, desc=ou
-00026fa0: 745f 6669 6c65 735f 6465 7363 292c 0a20  t_files_desc),. 
-00026fb0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00026fc0: 2020 7365 6c66 2e69 6e69 745f 6465 6661    self.init_defa
-00026fd0: 756c 745f 7472 6169 7473 2829 0a0a 2020  ult_traits()..  
-00026fe0: 2020 6465 6620 5f6e 616d 6573 4669 6c74    def _namesFilt
-00026ff0: 6572 2873 656c 6629 3a0a 2020 2020 2020  er(self):.      
-00027000: 2020 2222 2246 696c 7465 7269 6e67 206f    """Filtering o
-00027010: 6620 696e 5f66 696c 6573 2069 6e70 7574  f in_files input
-00027020: 2070 6172 616d 6574 6572 2069 6e20 6f72   parameter in or
-00027030: 6465 7220 746f 206b 6565 7020 6f6e 6c79  der to keep only
-00027040: 2047 4d2e 0a0a 2020 2020 2020 2020 3a72   GM...        :r
-00027050: 6574 7572 6e73 3a20 474d 2069 6d61 6765  eturns: GM image
-00027060: 7320 2863 6f6e 7461 696e 696e 6720 2263  s (containing "c
-00027070: 3122 2069 6e20 7468 6520 6669 7273 7420  1" in the first 
-00027080: 3520 6368 6172 6163 7465 7273 290a 2020  5 characters).  
-00027090: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000270a0: 2020 6669 6c65 7320 3d20 5b5d 0a0a 2020    files = []..  
-000270b0: 2020 2020 2020 666f 7220 6669 6c65 5f6e        for file_n
-000270c0: 616d 6520 696e 2073 656c 662e 696e 5f66  ame in self.in_f
-000270d0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-000270e0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000270f0: 6669 6c65 5f6e 616d 652c 2028 6c69 7374  file_name, (list
-00027100: 2c20 5472 6169 744c 6973 744f 626a 6563  , TraitListObjec
-00027110: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
-00027120: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-00027130: 2066 696c 655f 6e61 6d65 5b30 5d0a 0a20   file_name[0].. 
-00027140: 2020 2020 2020 2020 2020 2023 2054 616b             # Tak
-00027150: 6520 7468 6520 6669 7273 7420 3520 6368  e the first 5 ch
-00027160: 6172 6163 7465 7273 2069 6e20 7468 6520  aracters in the 
-00027170: 6361 7365 2069 6620 7468 6520 474d 2077  case if the GM w
-00027180: 6173 2070 726f 6365 7373 6564 0a20 2020  as processed.   
-00027190: 2020 2020 2020 2020 2023 2065 782e 206e           # ex. n
-000271a0: 6f72 6d61 6c69 7361 7469 6f6e 203d 2077  ormalisation = w
-000271b0: 6331 2c20 6e6f 726d 616c 6973 6174 696f  c1, normalisatio
-000271c0: 6e20 7468 656e 2073 6d6f 6f74 6820 3d20  n then smooth = 
-000271d0: 7377 6331 202e 2e2e 0a20 2020 2020 2020  swc1 ....       
-000271e0: 2020 2020 2023 2054 6869 7320 6973 206e       # This is n
-000271f0: 6f74 2074 6865 2063 6c65 616e 6572 2077  ot the cleaner w
-00027200: 6179 202e 2e2e 2066 6f72 2065 7861 6d70  ay ... for examp
-00027210: 6c65 2069 6e20 7468 6520 6361 7365 206f  le in the case o
-00027220: 6620 610a 2020 2020 2020 2020 2020 2020  f a.            
-00027230: 2320 6669 6c65 206e 616d 6520 696e 636c  # file name incl
-00027240: 7564 696e 6720 6063 3160 2069 6e20 7468  uding `c1` in th
-00027250: 6520 6669 7273 7420 3520 6368 6172 6163  e first 5 charac
-00027260: 7465 7273 2066 6f72 2061 6e6f 7468 6572  ters for another
-00027270: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
-00027280: 6561 736f 6e20 2860 6331 6020 696e 2050  eason (`c1` in P
-00027290: 6174 6965 6e74 4e61 6d65 2c20 6574 632e  atientName, etc.
-000272a0: 292e 0a20 2020 2020 2020 2020 2020 2023  )..            #
-000272b0: 2046 6958 4d45 3a20 7768 6174 2063 616e   FiXME: what can
-000272c0: 2077 6520 646f 2074 6f20 6265 2063 6c65   we do to be cle
-000272d0: 616e 6572 3f0a 2020 2020 2020 2020 2020  aner?.          
-000272e0: 2020 6966 2022 6331 2220 696e 206f 732e    if "c1" in os.
-000272f0: 7061 7468 2e62 6173 656e 616d 6528 6f73  path.basename(os
-00027300: 2e70 6174 682e 6e6f 726d 7061 7468 2866  .path.normpath(f
-00027310: 696c 655f 6e61 6d65 2929 5b3a 355d 3a0a  ile_name))[:5]:.
-00027320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027330: 6669 6c65 732e 6170 7065 6e64 2866 696c  files.append(fil
-00027340: 655f 6e61 6d65 290a 0a20 2020 2020 2020  e_name)..       
-00027350: 2072 6574 7572 6e20 6669 6c65 730a 0a20   return files.. 
-00027360: 2020 2064 6566 206c 6973 745f 6f75 7470     def list_outp
-00027370: 7574 7328 7365 6c66 2c20 6973 5f70 6c75  uts(self, is_plu
-00027380: 6767 6564 3d4e 6f6e 6529 3a0a 2020 2020  gged=None):.    
-00027390: 2020 2020 2222 2244 6564 6963 6174 6564      """Dedicated
-000273a0: 2074 6f20 7468 6520 696e 6974 6961 6c69   to the initiali
-000273b0: 7361 7469 6f6e 2073 7465 7020 6f66 2074  sation step of t
-000273c0: 6865 2062 7269 636b 2e0a 0a20 2020 2020  he brick...     
-000273d0: 2020 2054 6865 206d 6169 6e20 6f62 6a65     The main obje
-000273e0: 6374 6976 6520 6f66 2074 6869 7320 6d65  ctive of this me
-000273f0: 7468 6f64 2069 7320 746f 2070 726f 6475  thod is to produ
-00027400: 6365 2074 6865 206f 7574 7075 7473 206f  ce the outputs o
-00027410: 6620 7468 650a 2020 2020 2020 2020 6272  f the.        br
-00027420: 6963 6b73 2028 7365 6c66 2e6f 7574 7075  icks (self.outpu
-00027430: 7473 2920 616e 6420 7468 6520 6173 736f  ts) and the asso
-00027440: 6369 6174 6564 2074 6167 7320 2873 656c  ciated tags (sel
-00027450: 662e 696e 6865 7269 7461 6e63 655f 6469  f.inheritance_di
-00027460: 6329 2c0a 2020 2020 2020 2020 6966 2064  c),.        if d
-00027470: 6566 696e 6564 2068 6572 652e 2054 6f20  efined here. To 
-00027480: 776f 726b 2070 726f 7065 726c 7920 7468  work properly th
-00027490: 6973 206d 6574 686f 6420 6d75 7374 2072  is method must r
-000274a0: 6574 7572 6e0a 2020 2020 2020 2020 7365  eturn.        se
-000274b0: 6c66 2e6d 616b 655f 696e 6974 5265 7375  lf.make_initResu
-000274c0: 6c74 2829 206f 626a 6563 742e 0a0a 2020  lt() object...  
-000274d0: 2020 2020 2020 3a70 6172 616d 2069 735f        :param is_
-000274e0: 706c 7567 6765 643a 2074 6865 2073 7461  plugged: the sta
-000274f0: 7465 2c20 6c69 6e6b 6564 206f 7220 6e6f  te, linked or no
-00027500: 742c 206f 6620 7468 6520 706c 7567 732e  t, of the plugs.
-00027510: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00027520: 733a 2061 2064 6963 7469 6f6e 6172 7920  s: a dictionary 
-00027530: 7769 7468 2072 6571 7569 7265 6d65 6e74  with requirement
-00027540: 2c20 6f75 7470 7574 7320 616e 6420 696e  , outputs and in
-00027550: 6865 7269 7461 6e63 655f 6469 6374 2e0a  heritance_dict..
-00027560: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00027570: 2020 2020 2320 5573 696e 6720 7468 6520      # Using the 
-00027580: 696e 6865 7269 7461 6e63 6520 746f 2050  inheritance to P
-00027590: 726f 6365 7373 4d49 4120 636c 6173 732c  rocessMIA class,
-000275a0: 206c 6973 745f 6f75 7470 7574 7320 6d65   list_outputs me
-000275b0: 7468 6f64 0a20 2020 2020 2020 2073 7570  thod.        sup
-000275c0: 6572 2854 6872 6573 686f 6c64 2c20 7365  er(Threshold, se
-000275d0: 6c66 292e 6c69 7374 5f6f 7574 7075 7473  lf).list_outputs
-000275e0: 2829 0a0a 2020 2020 2020 2020 2320 4f75  ()..        # Ou
-000275f0: 7470 7574 7320 6465 6669 6e69 7469 6f6e  tputs definition
-00027600: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00027610: 2e69 6e5f 6669 6c65 7320 213d 2055 6e64  .in_files != Und
-00027620: 6566 696e 6564 2061 6e64 2028 0a20 2020  efined and (.   
-00027630: 2020 2020 2020 2020 2073 656c 662e 7468           self.th
-00027640: 7265 7368 6f6c 6420 616e 6420 7365 6c66  reshold and self
-00027650: 2e74 6872 6573 686f 6c64 2021 3d20 556e  .threshold != Un
-00027660: 6465 6669 6e65 640a 2020 2020 2020 2020  defined.        
-00027670: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00027680: 6620 7365 6c66 2e47 4d5f 6669 6c74 6572  f self.GM_filter
-00027690: 696e 6720 6973 2054 7275 653a 0a20 2020  ing is True:.   
-000276a0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-000276b0: 6573 5f6e 616d 6520 3d20 7365 6c66 2e5f  es_name = self._
-000276c0: 6e61 6d65 7346 696c 7465 7228 290a 0a20  namesFilter().. 
-000276d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000276e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000276f0: 2066 696c 6573 5f6e 616d 6520 3d20 7365   files_name = se
-00027700: 6c66 2e69 6e5f 6669 6c65 730a 0a20 2020  lf.in_files..   
-00027710: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
-00027720: 2020 2020 2020 2020 2020 2020 2020 286e                (n
-00027730: 6f74 2073 656c 662e 7375 6666 6978 290a  ot self.suffix).
-00027740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027750: 6f72 2028 7365 6c66 2e73 7566 6669 782e  or (self.suffix.
-00027760: 6973 7370 6163 6528 2929 0a20 2020 2020  isspace()).     
-00027770: 2020 2020 2020 2020 2020 206f 7220 7365             or se
-00027780: 6c66 2e73 7566 6669 7820 696e 205b 556e  lf.suffix in [Un
-00027790: 6465 6669 6e65 642c 2022 3c75 6e64 6566  defined, "<undef
-000277a0: 696e 6564 3e22 5d0a 2020 2020 2020 2020  ined>"].        
-000277b0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-000277c0: 2020 2020 2020 2073 656c 662e 7375 6666         self.suff
-000277d0: 6978 203d 2022 2022 0a0a 2020 2020 2020  ix = " "..      
-000277e0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-000277f0: 2020 2020 2020 2020 2020 2028 6e6f 7420             (not 
-00027800: 7365 6c66 2e70 7265 6669 7829 0a20 2020  self.prefix).   
-00027810: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-00027820: 2873 656c 662e 7072 6566 6978 2e69 7373  (self.prefix.iss
-00027830: 7061 6365 2829 290a 2020 2020 2020 2020  pace()).        
-00027840: 2020 2020 2020 2020 6f72 2028 7365 6c66          or (self
-00027850: 2e70 7265 6669 7820 696e 205b 556e 6465  .prefix in [Unde
-00027860: 6669 6e65 642c 2022 3c75 6e64 6566 696e  fined, "<undefin
-00027870: 6564 3e22 5d29 0a20 2020 2020 2020 2020  ed>"]).         
-00027880: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00027890: 2020 2020 2020 7365 6c66 2e70 7265 6669        self.prefi
-000278a0: 7820 3d20 2220 220a 0a20 2020 2020 2020  x = " "..       
-000278b0: 2020 2020 2066 696c 6573 203d 205b 5d0a       files = [].
-000278c0: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-000278d0: 203d 2054 7275 6520 2023 2049 6620 4661   = True  # If Fa
-000278e0: 6c73 652c 2073 7566 2f70 7265 6620 6368  lse, suf/pref ch
-000278f0: 6563 6b20 7769 6c6c 206e 6f74 2062 6520  eck will not be 
-00027900: 7065 7266 6f72 6d65 6420 6c61 7465 720a  performed later.
-00027910: 2020 2020 2020 2020 2020 2020 7265 7476              retv
-00027920: 616c 203d 204e 6f6e 650a 0a20 2020 2020  al = None..     
-00027930: 2020 2020 2020 2066 6f72 2066 696c 655f         for file_
-00027940: 6e61 6d65 3120 696e 2066 696c 6573 5f6e  name1 in files_n
-00027950: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
-00027960: 2020 2020 2076 616c 6964 5f65 7874 2c20       valid_ext, 
-00027970: 696e 5f65 7874 2c20 6669 6c65 4e61 6d65  in_ext, fileName
-00027980: 203d 2063 6865 636b 4669 6c65 4578 7428   = checkFileExt(
-00027990: 6669 6c65 5f6e 616d 6531 2c20 4558 5429  file_name1, EXT)
-000279a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000279b0: 2020 6966 206e 6f74 2076 616c 6964 5f65    if not valid_e
-000279c0: 7874 3a0a 2020 2020 2020 2020 2020 2020  xt:.            
-000279d0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-000279e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279f0: 2020 2020 2020 2022 5c6e 5468 7265 7368         "\nThresh
-00027a00: 6f6c 6420 6272 6963 6b3a 2054 6865 2069  old brick: The i
-00027a10: 6e70 7574 2069 6d61 6765 2066 6f72 6d61  nput image forma
-00027a20: 7420 6973 206e 6f74 2022 0a20 2020 2020  t is not ".     
-00027a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a40: 2020 2022 7265 636f 676e 697a 6564 2e2e     "recognized..
-00027a50: 2e21 220a 2020 2020 2020 2020 2020 2020  .!".            
-00027a60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00027a70: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00027a80: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
-00027a90: 2020 2020 2070 6174 682c 205f 203d 206f       path, _ = o
-00027aa0: 732e 7061 7468 2e73 706c 6974 2866 696c  s.path.split(fil
-00027ab0: 655f 6e61 6d65 3129 0a0a 2020 2020 2020  e_name1)..      
-00027ac0: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
-00027ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ae0: 2020 2073 656c 662e 7375 6666 6978 203d     self.suffix =
-00027af0: 3d20 2220 220a 2020 2020 2020 2020 2020  = " ".          
-00027b00: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-00027b10: 6c66 2e70 7265 6669 7820 3d3d 2022 2022  lf.prefix == " "
-00027b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027b30: 2020 2020 2061 6e64 2070 6174 6820 3d3d       and path ==
-00027b40: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
-00027b50: 6563 746f 7279 0a20 2020 2020 2020 2020  ectory.         
-00027b60: 2020 2020 2020 2020 2020 2061 6e64 2066             and f
-00027b70: 6c61 6720 6973 2054 7275 650a 2020 2020  lag is True.    
-00027b80: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00027b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ba0: 2020 206d 7367 203d 2051 4d65 7373 6167     msg = QMessag
-00027bb0: 6542 6f78 2829 0a20 2020 2020 2020 2020  eBox().         
-00027bc0: 2020 2020 2020 2020 2020 206d 7367 2e73             msg.s
-00027bd0: 6574 4963 6f6e 2851 4d65 7373 6167 6542  etIcon(QMessageB
-00027be0: 6f78 2e57 6172 6e69 6e67 290a 2020 2020  ox.Warning).    
-00027bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c00: 6d73 672e 7365 7457 696e 646f 7754 6974  msg.setWindowTit
-00027c10: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00027c20: 2020 2020 2020 2020 2020 2020 226d 6961              "mia
-00027c30: 5f70 726f 6365 7373 6573 202d 2054 6872  _processes - Thr
-00027c40: 6573 686f 6c64 2062 7269 636b 2057 6172  eshold brick War
-00027c50: 6e69 6e67 2122 0a20 2020 2020 2020 2020  ning!".         
-00027c60: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00027c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c80: 206d 7367 2e73 6574 5465 7874 280a 2020   msg.setText(.  
-00027c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ca0: 2020 2020 2020 2253 7566 6669 7820 616e        "Suffix an
-00027cb0: 6420 7072 6566 6978 2069 6e70 7574 2070  d prefix input p
-00027cc0: 6172 616d 6574 6572 7320 6172 6520 6e6f  arameters are no
-00027cd0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-00027ce0: 2020 2020 2020 2020 2020 2020 2264 6566              "def
-00027cf0: 696e 6564 206f 7220 636f 6e73 6973 7420  ined or consist 
-00027d00: 6f6e 6c79 206f 6620 6f6e 6520 6f72 206d  only of one or m
-00027d10: 6f72 6520 7768 6974 6520 220a 2020 2020  ore white ".    
-00027d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d30: 2020 2020 2273 7061 6365 732e 5c6e 5468      "spaces.\nTh
-00027d40: 6520 7b30 7d20 696e 7075 7420 7061 7261  e {0} input para
-00027d50: 6d65 7465 7220 7769 6c6c 2062 6520 220a  meter will be ".
-00027d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d70: 2020 2020 2020 2020 226f 7665 7277 7269          "overwri
-00027d80: 7474 656e 202e 2e2e 5c6e 2059 6573 206f  tten ...\n Yes o
-00027d90: 7220 220a 2020 2020 2020 2020 2020 2020  r ".            
-00027da0: 2020 2020 2020 2020 2020 2020 2241 626f              "Abo
-00027db0: 7274 3f22 2e66 6f72 6d61 7428 6669 6c65  rt?".format(file
-00027dc0: 5f6e 616d 6531 290a 2020 2020 2020 2020  _name1).        
-00027dd0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00027de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027df0: 2020 6d73 672e 7365 7453 7461 6e64 6172    msg.setStandar
-00027e00: 6442 7574 746f 6e73 280a 2020 2020 2020  dButtons(.      
-00027e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e20: 2020 514d 6573 7361 6765 426f 782e 5965    QMessageBox.Ye
-00027e30: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00027e40: 2020 2020 2020 2020 2020 7c20 514d 6573            | QMes
-00027e50: 7361 6765 426f 782e 5965 7354 6f41 6c6c  sageBox.YesToAll
-00027e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027e70: 2020 2020 2020 2020 207c 2051 4d65 7373           | QMess
-00027e80: 6167 6542 6f78 2e41 626f 7274 0a20 2020  ageBox.Abort.   
-00027e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ea0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00027eb0: 2020 2020 2020 2072 6574 7661 6c20 3d20         retval = 
-00027ec0: 6d73 672e 6578 6563 5f28 290a 0a20 2020  msg.exec_()..   
-00027ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ee0: 2069 6620 7265 7476 616c 2021 3d20 514d   if retval != QM
-00027ef0: 6573 7361 6765 426f 782e 4162 6f72 743a  essageBox.Abort:
-00027f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027f10: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00027f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f30: 2020 2020 2020 2020 2020 2020 225c 6e54              "\nT
-00027f40: 6872 6573 686f 6c64 2062 7269 636b 2077  hreshold brick w
-00027f50: 6172 6e69 6e67 3a20 7468 6520 6f75 745f  arning: the out_
-00027f60: 6669 6c65 7320 6f75 7470 7574 2022 0a20  files output ". 
-00027f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f80: 2020 2020 2020 2020 2020 2022 7061 7261             "para
-00027f90: 6d65 7465 7220 6973 2074 6865 2073 616d  meter is the sam
-00027fa0: 6520 6173 2074 6865 2069 6e5f 6669 6c65  e as the in_file
-00027fb0: 7320 696e 7075 7420 220a 2020 2020 2020  s input ".      
-00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fd0: 2020 2020 2020 2270 6172 616d 6574 6572        "parameter
-00027fe0: 2028 7375 6666 6978 2061 6e64 2070 7265   (suffix and pre
-00027ff0: 6669 7820 6172 6520 6e6f 7420 6465 6669  fix are not defi
-00028000: 6e65 6429 3a22 0a20 2020 2020 2020 2020  ned):".         
-00028010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028020: 2020 2022 5c6e 7b30 7d20 7769 6c6c 2062     "\n{0} will b
-00028030: 6520 6f76 6572 7772 6974 6564 202e 2e2e  e overwrited ...
-00028040: 222e 666f 726d 6174 2866 696c 655f 6e61  ".format(file_na
-00028050: 6d65 3129 0a20 2020 2020 2020 2020 2020  me1).           
-00028060: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00028070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028080: 2020 2020 2020 2020 6966 2072 6574 7661          if retva
-00028090: 6c20 3d3d 2051 4d65 7373 6167 6542 6f78  l == QMessageBox
-000280a0: 2e59 6573 546f 416c 6c3a 0a20 2020 2020  .YesToAll:.     
-000280b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000280c0: 2020 2020 2020 2066 6c61 6720 3d20 4661         flag = Fa
-000280d0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-000280e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000280f0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00028100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028110: 2020 2020 2020 2022 5c6e 5468 7265 7368         "\nThresh
-00028120: 6f6c 6420 6272 6963 6b3a 2059 6573 546f  old brick: YesTo
-00028130: 416c 6c20 7365 6c65 6374 6564 3a20 656e  All selected: en
-00028140: 6420 6f66 2022 0a20 2020 2020 2020 2020  d of ".         
-00028150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028160: 2020 2020 2020 2022 6f76 6572 7772 6974         "overwrit
-00028170: 6520 6368 6563 6b73 206f 6e20 696e 7075  e checks on inpu
-00028180: 7420 696d 6167 6573 202e 2e2e 220a 2020  t images ...".  
-00028190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000281b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000281d0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000281e0: 6c65 735f 6e61 6d65 203d 205b 5d0a 2020  les_name = [].  
-000281f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028200: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00028210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028220: 2020 2020 2020 2020 2022 5c6e 5468 7265           "\nThre
-00028230: 7368 6f6c 6420 6272 6963 6b20 4162 6f72  shold brick Abor
-00028240: 7465 642e 2050 6c65 6173 6520 6368 6563  ted. Please chec
-00028250: 6b20 796f 7572 2022 0a20 2020 2020 2020  k your ".       
-00028260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028270: 2020 2020 2022 696e 7075 7420 7061 7261       "input para
-00028280: 6d65 7465 7273 202e 2e2e 220a 2020 2020  meters ...".    
-00028290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000282a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000282b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000282c0: 7475 726e 0a0a 2020 2020 2020 2020 2020  turn..          
-000282d0: 2020 2020 2020 6669 6c65 732e 6170 7065        files.appe
-000282e0: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-000282f0: 2020 2020 2020 2020 6f73 2e70 6174 682e          os.path.
-00028300: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
-00028310: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00028320: 6c66 2e6f 7574 7075 745f 6469 7265 6374  lf.output_direct
-00028330: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-00028340: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
-00028350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028360: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00028370: 7072 6566 6978 2e73 7472 6970 2829 0a20  prefix.strip(). 
-00028380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028390: 2020 2020 2020 2020 2020 202b 2066 696c             + fil
-000283a0: 654e 616d 650a 2020 2020 2020 2020 2020  eName.          
-000283b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283c0: 2020 2b20 7365 6c66 2e73 7566 6669 782e    + self.suffix.
-000283d0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-000283e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283f0: 2020 2020 2b20 222e 220a 2020 2020 2020      + ".".      
-00028400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028410: 2020 2020 2020 2b20 696e 5f65 7874 0a20        + in_ext. 
-00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028430: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00028440: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00028450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028460: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00028470: 6620 6669 6c65 733a 0a20 2020 2020 2020  f files:.       
-00028480: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
-00028490: 7470 7574 735b 226f 7574 5f66 696c 6573  tputs["out_files
-000284a0: 225d 203d 2066 696c 6573 0a20 2020 2020  "] = files.     
-000284b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000284c0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000284d0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-000284e0: 2020 2020 2020 2020 222d 2054 6872 6573          "- Thres
-000284f0: 686f 6c64 2062 7269 636b 3a20 5468 6572  hold brick: Ther
-00028500: 6520 7761 7320 6e6f 206f 7574 7075 7420  e was no output 
-00028510: 6669 6c65 2064 6564 7563 7465 6420 220a  file deducted ".
-00028520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028530: 2020 2020 2264 7572 696e 6720 696e 6974      "during init
-00028540: 6961 6c69 7361 7469 6f6e 2e20 506c 6561  ialisation. Plea
-00028550: 7365 2063 6865 636b 2074 6865 2069 6e70  se check the inp
-00028560: 7574 2022 0a20 2020 2020 2020 2020 2020  ut ".           
-00028570: 2020 2020 2020 2020 2022 7061 7261 6d65           "parame
-00028580: 7465 7273 2e2e 2e21 220a 2020 2020 2020  ters...!".      
-00028590: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000285a0: 2020 2020 2023 2074 6167 7320 696e 6865       # tags inhe
-000285b0: 7269 7461 6e63 6520 286f 7074 696f 6e61  ritance (optiona
-000285c0: 6c29 0a20 2020 2020 2020 2069 6620 7365  l).        if se
-000285d0: 6c66 2e6f 7574 7075 7473 3a0a 2020 2020  lf.outputs:.    
-000285e0: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
-000285f0: 2076 616c 2069 6e20 7365 6c66 2e6f 7574   val in self.out
-00028600: 7075 7473 2e69 7465 6d73 2829 3a0a 2020  puts.items():.  
-00028610: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00028620: 206b 6579 203d 3d20 226f 7574 5f66 696c   key == "out_fil
-00028630: 6573 223a 0a20 2020 2020 2020 2020 2020  es":.           
-00028640: 2020 2020 2020 2020 2066 6f72 2069 6e5f           for in_
-00028650: 7661 6c2c 206f 7574 5f76 616c 2069 6e20  val, out_val in 
-00028660: 7a69 7028 6669 6c65 735f 6e61 6d65 2c20  zip(files_name, 
-00028670: 7661 6c29 3a0a 2020 2020 2020 2020 2020  val):.          
-00028680: 2020 2020 2020 2020 2020 2020 2020 5f2c                _,
-00028690: 2066 696c 654f 7661 6c20 3d20 6f73 2e70   fileOval = os.p
-000286a0: 6174 682e 7370 6c69 7428 6f75 745f 7661  ath.split(out_va
-000286b0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-000286c0: 2020 2020 2020 2020 2020 2066 696c 654f             fileO
-000286d0: 7661 6c5f 6e6f 5f65 7874 2c20 5f20 3d20  val_no_ext, _ = 
-000286e0: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
-000286f0: 2866 696c 654f 7661 6c29 0a20 2020 2020  (fileOval).     
-00028700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028710: 2020 205f 2c20 6669 6c65 4976 616c 203d     _, fileIval =
-00028720: 206f 732e 7061 7468 2e73 706c 6974 2869   os.path.split(i
-00028730: 6e5f 7661 6c29 0a20 2020 2020 2020 2020  n_val).         
-00028740: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00028750: 696c 6549 7661 6c5f 6e6f 5f65 7874 2c20  ileIval_no_ext, 
-00028760: 5f20 3d20 6f73 2e70 6174 682e 7370 6c69  _ = os.path.spli
-00028770: 7465 7874 2866 696c 6549 7661 6c29 0a0a  text(fileIval)..
-00028780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028790: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
-000287a0: 2e70 7265 6669 7829 2061 6e64 2028 0a20  .prefix) and (. 
-000287b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000287c0: 2020 2020 2020 2020 2020 2066 696c 654f             fileO
-000287d0: 7661 6c5f 6e6f 5f65 7874 2e73 7461 7274  val_no_ext.start
-000287e0: 7377 6974 6828 7365 6c66 2e70 7265 6669  swith(self.prefi
-000287f0: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
-00028800: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-00028810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028820: 2020 2020 2020 2020 2020 2320 666d 743a            # fmt:
-00028830: 206f 6666 0a20 2020 2020 2020 2020 2020   off.           
-00028840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028850: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
-00028860: 203d 2066 696c 654f 7661 6c5f 6e6f 5f65   = fileOval_no_e
-00028870: 7874 5b0a 2020 2020 2020 2020 2020 2020  xt[.            
-00028880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028890: 2020 2020 6c65 6e28 7365 6c66 2e70 7265      len(self.pre
-000288a0: 6669 7829 3a5d 0a20 2020 2020 2020 2020  fix):].         
-000288b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288c0: 2020 2023 2066 6d74 3a20 6f6e 0a0a 2020     # fmt: on..  
-000288d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288e0: 2020 2020 2020 6966 2028 7365 6c66 2e73        if (self.s
-000288f0: 7566 6669 7829 2061 6e64 2028 0a20 2020  uffix) and (.   
-00028900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028910: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
-00028920: 6c5f 6e6f 5f65 7874 2e65 6e64 7377 6974  l_no_ext.endswit
-00028930: 6828 7365 6c66 2e73 7566 6669 7829 0a20  h(self.suffix). 
-00028940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028950: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-00028960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028970: 2020 2020 2020 6669 6c65 4f76 616c 5f6e        fileOval_n
-00028980: 6f5f 6578 7420 3d20 6669 6c65 4f76 616c  o_ext = fileOval
-00028990: 5f6e 6f5f 6578 745b 0a20 2020 2020 2020  _no_ext[.       
-000289a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289b0: 2020 2020 2020 2020 203a 202d 6c65 6e28           : -len(
-000289c0: 7365 6c66 2e73 7566 6669 7829 0a20 2020  self.suffix).   
-000289d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289e0: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
-000289f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a00: 2020 2020 6966 2066 696c 654f 7661 6c5f      if fileOval_
-00028a10: 6e6f 5f65 7874 203d 3d20 6669 6c65 4976  no_ext == fileIv
-00028a20: 616c 5f6e 6f5f 6578 743a 0a20 2020 2020  al_no_ext:.     
-00028a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a40: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00028a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a60: 2020 2020 2020 2020 2020 2020 6765 745f              get_
-00028a70: 6462 4669 656c 6456 616c 7565 280a 2020  dbFieldValue(.  
-00028a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028aa0: 2020 7365 6c66 2e70 726f 6a65 6374 2c20    self.project, 
-00028ab0: 696e 5f76 616c 2c20 2250 6174 6965 6e74  in_val, "Patient
-00028ac0: 4e61 6d65 220a 2020 2020 2020 2020 2020  Name".          
-00028ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ae0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00028af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b00: 2020 2020 2020 2020 6973 204e 6f6e 650a          is None.
-00028b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b20: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00028b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00028b50: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-00028b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b70: 2020 2020 2020 2020 2020 225c 6e54 6872            "\nThr
-00028b80: 6573 686f 6c64 2062 7269 636b 3a5c 6e54  eshold brick:\nT
-00028b90: 6865 2027 5061 7469 656e 744e 616d 6527  he 'PatientName'
-00028ba0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00028bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028bc0: 2020 2020 2020 2220 7461 6720 636f 756c        " tag coul
-00028bd0: 6420 6e6f 7420 6265 2061 6464 6564 2074  d not be added t
-00028be0: 6f20 7468 6520 220a 2020 2020 2020 2020  o the ".        
-00028bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c00: 2020 2020 2020 2020 2020 2020 2264 6174              "dat
-00028c10: 6162 6173 6520 666f 7220 7468 6520 277b  abase for the '{
-00028c20: 7d27 2070 6172 616d 6574 6572 2e20 5468  }' parameter. Th
-00028c30: 6973 2022 0a20 2020 2020 2020 2020 2020  is ".           
-00028c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c50: 2020 2020 2020 2020 2022 6361 6e20 6c65           "can le
-00028c60: 6164 2074 6f20 6120 7375 6273 6571 7565  ad to a subseque
-00028c70: 6e74 2069 7373 7565 2064 7572 696e 6720  nt issue during 
-00028c80: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00028c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ca0: 2020 2020 2020 2269 6e69 7469 616c 697a        "initializ
-00028cb0: 6174 696f 6e21 215c 6e22 2e66 6f72 6d61  ation!!\n".forma
-00028cc0: 7428 6f75 745f 7661 6c29 0a20 2020 2020  t(out_val).     
-00028cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ce0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00028cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d00: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00028d10: 6167 735f 696e 6865 7269 7461 6e63 6528  ags_inheritance(
-00028d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d40: 2069 6e5f 7661 6c2c 0a20 2020 2020 2020   in_val,.       
-00028d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d60: 2020 2020 2020 2020 206f 7574 5f76 616c           out_val
-00028d70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00028d80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00028d90: 0a20 2020 2020 2020 2023 2052 6574 7572  .        # Retur
-00028da0: 6e20 7468 6520 7265 7175 6972 656d 656e  n the requiremen
-00028db0: 742c 206f 7574 7075 7473 2061 6e64 2069  t, outputs and i
-00028dc0: 6e68 6572 6974 616e 6365 5f64 6963 740a  nheritance_dict.
-00028dd0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00028de0: 656c 662e 6d61 6b65 5f69 6e69 7452 6573  elf.make_initRes
-00028df0: 756c 7428 290a 0a20 2020 2064 6566 2072  ult()..    def r
-00028e00: 756e 5f70 726f 6365 7373 5f6d 6961 2873  un_process_mia(s
-00028e10: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00028e20: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
-00028e30: 6520 7072 6f63 6573 7320 6c61 756e 6368  e process launch
-00028e40: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
-00028e50: 636b 2e22 2222 0a20 2020 2020 2020 2073  ck.""".        s
-00028e60: 7570 6572 2854 6872 6573 686f 6c64 2c20  uper(Threshold, 
-00028e70: 7365 6c66 292e 7275 6e5f 7072 6f63 6573  self).run_proces
-00028e80: 735f 6d69 6128 290a 0a20 2020 2020 2020  s_mia()..       
-00028e90: 2069 6620 7365 6c66 2e47 4d5f 6669 6c74   if self.GM_filt
-00028ea0: 6572 696e 6720 6973 2054 7275 653a 0a20  ering is True:. 
-00028eb0: 2020 2020 2020 2020 2020 2066 696c 6573             files
-00028ec0: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6e61  _name = self._na
-00028ed0: 6d65 7346 696c 7465 7228 290a 0a20 2020  mesFilter()..   
-00028ee0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00028ef0: 2020 2020 2020 2066 696c 6573 5f6e 616d         files_nam
-00028f00: 6520 3d20 7365 6c66 2e69 6e5f 6669 6c65  e = self.in_file
-00028f10: 730a 0a20 2020 2020 2020 2066 6f72 2066  s..        for f
-00028f20: 696c 655f 6e61 6d65 2069 6e20 6669 6c65  ile_name in file
-00028f30: 735f 6e61 6d65 3a0a 2020 2020 2020 2020  s_name:.        
-00028f40: 2020 2020 2320 496d 6167 6520 7072 6f63      # Image proc
-00028f50: 6573 7369 6e67 0a20 2020 2020 2020 2020  essing.         
-00028f60: 2020 2069 6d67 5f66 696e 616c 203d 2074     img_final = t
-00028f70: 6872 6573 686f 6c64 2866 696c 655f 6e61  hreshold(file_na
-00028f80: 6d65 2c20 7365 6c66 2e74 6872 6573 686f  me, self.thresho
-00028f90: 6c64 290a 0a20 2020 2020 2020 2020 2020  ld)..           
-00028fa0: 2023 2049 6d61 6765 2073 6176 650a 2020   # Image save.  
-00028fb0: 2020 2020 2020 2020 2020 5f2c 2066 696c            _, fil
-00028fc0: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00028fd0: 2e73 706c 6974 2866 696c 655f 6e61 6d65  .split(file_name
-00028fe0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-00028ff0: 6c65 5f6e 616d 655f 6e6f 5f65 7874 2c20  le_name_no_ext, 
-00029000: 6669 6c65 5f65 7874 656e 7369 6f6e 203d  file_extension =
-00029010: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-00029020: 7428 6669 6c65 5f6e 616d 6529 0a20 2020  t(file_name).   
-00029030: 2020 2020 2020 2020 206f 7574 5f66 696c           out_fil
-00029040: 6520 3d20 6f73 2e70 6174 682e 6a6f 696e  e = os.path.join
-00029050: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00029060: 2020 7365 6c66 2e6f 7574 7075 745f 6469    self.output_di
-00029070: 7265 6374 6f72 792c 0a20 2020 2020 2020  rectory,.       
-00029080: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
-00029090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000290a0: 656c 662e 7072 6566 6978 2e73 7472 6970  elf.prefix.strip
-000290b0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000290c0: 2020 2020 2020 202b 2066 696c 655f 6e61         + file_na
-000290d0: 6d65 5f6e 6f5f 6578 740a 2020 2020 2020  me_no_ext.      
-000290e0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-000290f0: 7365 6c66 2e73 7566 6669 782e 7374 7269  self.suffix.stri
-00029100: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00029110: 2020 2020 2020 2020 2b20 6669 6c65 5f65          + file_e
-00029120: 7874 656e 7369 6f6e 0a20 2020 2020 2020  xtension.       
-00029130: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-00029140: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00029150: 2020 2020 2020 6e69 622e 7361 7665 2869        nib.save(i
-00029160: 6d67 5f66 696e 616c 2c20 6f75 745f 6669  mg_final, out_fi
-00029170: 6c65 290a 0a0a 6465 6620 6172 7469 6661  le)...def artifa
-00029180: 6374 5f6d 6173 6b28 696d 6461 7461 2c20  ct_mask(imdata, 
-00029190: 6169 7264 6174 612c 2064 6973 7461 6e63  airdata, distanc
-000291a0: 652c 207a 7363 6f72 653d 3130 2e30 293a  e, zscore=10.0):
-000291b0: 0a20 2020 2022 2222 436f 6d70 7574 6573  .    """Computes
-000291c0: 2061 206d 6173 6b20 6f66 2061 7274 6966   a mask of artif
-000291d0: 6163 7473 2066 6f75 6e64 2069 6e20 7468  acts found in th
-000291e0: 6520 6169 7220 7265 6769 6f6e 2222 220a  e air region""".
-000291f0: 0a20 2020 2069 6620 6e6f 7420 6e70 2e69  .    if not np.i
-00029200: 7373 7562 6474 7970 6528 6169 7264 6174  ssubdtype(airdat
-00029210: 612e 6474 7970 652c 206e 702e 696e 7465  a.dtype, np.inte
-00029220: 6765 7229 3a0a 2020 2020 2020 2020 6169  ger):.        ai
-00029230: 7264 6174 615b 6169 7264 6174 6120 3c20  rdata[airdata < 
-00029240: 302e 3935 5d20 3d20 300a 2020 2020 2020  0.95] = 0.      
-00029250: 2020 6169 7264 6174 615b 6169 7264 6174    airdata[airdat
-00029260: 6120 3e20 302e 305d 203d 2031 0a0a 2020  a > 0.0] = 1..  
-00029270: 2020 6267 5f69 6d67 203d 2069 6d64 6174    bg_img = imdat
-00029280: 6120 2a20 6169 7264 6174 610a 2020 2020  a * airdata.    
-00029290: 6966 206e 702e 7375 6d28 2862 675f 696d  if np.sum((bg_im
-000292a0: 6720 3e20 3029 2e61 7374 7970 6528 6e70  g > 0).astype(np
-000292b0: 2e75 696e 7438 2929 203c 2031 3030 3a0a  .uint8)) < 100:.
-000292c0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-000292d0: 702e 7a65 726f 735f 6c69 6b65 2861 6972  p.zeros_like(air
-000292e0: 6461 7461 290a 0a20 2020 2023 2046 696e  data)..    # Fin
-000292f0: 6420 7468 6520 6261 636b 6772 6f75 6e64  d the background
-00029300: 2074 6872 6573 686f 6c64 2028 7468 6520   threshold (the 
-00029310: 6d6f 7374 2066 7265 7175 656e 746c 7920  most frequently 
-00029320: 6f63 6375 7272 696e 6720 7661 6c75 650a  occurring value.
-00029330: 2020 2020 2320 6578 636c 7564 696e 6720      # excluding 
-00029340: 3029 0a20 2020 2062 675f 6c6f 6361 7469  0).    bg_locati
-00029350: 6f6e 203d 206e 702e 6d65 6469 616e 2862  on = np.median(b
-00029360: 675f 696d 675b 6267 5f69 6d67 203e 2030  g_img[bg_img > 0
-00029370: 5d29 0a20 2020 2062 675f 7370 7265 6164  ]).    bg_spread
-00029380: 203d 206d 6164 2862 675f 696d 675b 6267   = mad(bg_img[bg
-00029390: 5f69 6d67 203e 2030 5d29 0a20 2020 2062  _img > 0]).    b
-000293a0: 675f 696d 675b 6267 5f69 6d67 203e 2030  g_img[bg_img > 0
-000293b0: 5d20 2d3d 2062 675f 6c6f 6361 7469 6f6e  ] -= bg_location
-000293c0: 0a20 2020 2023 2054 4f44 4f3a 2054 6869  .    # TODO: Thi
-000293d0: 7320 6973 2067 656e 6572 6174 696e 6720  s is generating 
-000293e0: 6120 5275 6e74 696d 6557 6172 6e69 6e67  a RuntimeWarning
-000293f0: 3a20 6469 7669 6465 2062 7920 7a65 726f  : divide by zero
-00029400: 2077 6974 6820 4d52 4951 4320 616e 6174   with MRIQC anat
-00029410: 0a20 2020 2062 675f 696d 675b 6267 5f69  .    bg_img[bg_i
-00029420: 6d67 203e 2030 5d20 2f3d 2062 675f 7370  mg > 0] /= bg_sp
-00029430: 7265 6164 0a0a 2020 2020 2320 4170 706c  read..    # Appl
-00029440: 7920 7468 6973 2074 6872 6573 686f 6c64  y this threshold
-00029450: 2074 6f20 7468 6520 6261 636b 6772 6f75   to the backgrou
-00029460: 6e64 2076 6f78 656c 7320 746f 2069 6465  nd voxels to ide
-00029470: 6e74 6966 7920 766f 7865 6c73 0a20 2020  ntify voxels.   
-00029480: 2023 2063 6f6e 7472 6962 7574 696e 6720   # contributing 
-00029490: 6172 7469 6661 6374 732e 0a20 2020 2071  artifacts..    q
-000294a0: 6931 5f69 6d67 203d 206e 702e 7a65 726f  i1_img = np.zero
-000294b0: 735f 6c69 6b65 2862 675f 696d 6729 0a20  s_like(bg_img). 
-000294c0: 2020 2071 6931 5f69 6d67 5b62 675f 696d     qi1_img[bg_im
-000294d0: 6720 3e20 7a73 636f 7265 5d20 3d20 310a  g > zscore] = 1.
-000294e0: 2020 2020 7169 315f 696d 675b 6469 7374      qi1_img[dist
-000294f0: 616e 6365 203c 2030 2e31 305d 203d 2030  ance < 0.10] = 0
-00029500: 0a0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
-00029510: 2073 7472 7563 7475 7261 6c20 656c 656d   structural elem
-00029520: 656e 7420 746f 2062 6520 7573 6564 2069  ent to be used i
-00029530: 6e20 616e 206f 7065 6e69 6e67 206f 7065  n an opening ope
-00029540: 7261 7469 6f6e 2e0a 2020 2020 7374 7275  ration..    stru
-00029550: 6320 3d20 7369 6d2e 6765 6e65 7261 7465  c = sim.generate
-00029560: 5f62 696e 6172 795f 7374 7275 6374 7572  _binary_structur
-00029570: 6528 332c 2031 290a 2020 2020 7169 315f  e(3, 1).    qi1_
-00029580: 696d 6720 3d20 7369 6d2e 6269 6e61 7279  img = sim.binary
-00029590: 5f6f 7065 6e69 6e67 2871 6931 5f69 6d67  _opening(qi1_img
-000295a0: 2c20 7374 7275 6329 2e61 7374 7970 6528  , struc).astype(
-000295b0: 6e70 2e75 696e 7438 290a 2020 2020 7169  np.uint8).    qi
-000295c0: 315f 696d 675b 6169 7264 6174 6120 3c3d  1_img[airdata <=
-000295d0: 2030 5d20 3d20 300a 0a20 2020 2072 6574   0] = 0..    ret
-000295e0: 7572 6e20 7169 315f 696d 670a 0a0a 6465  urn qi1_img...de
-000295f0: 6620 6973 5f6f 7574 6c69 6572 2870 6f69  f is_outlier(poi
-00029600: 6e74 732c 2074 6872 6573 683d 332e 3529  nts, thresh=3.5)
-00029610: 3a0a 2020 2020 2222 220a 2020 2020 2a52  :.    """.    *R
-00029620: 6574 7572 6e73 2061 2062 6f6f 6c65 616e  eturns a boolean
-00029630: 2061 7272 6179 2077 6974 6820 5472 7565   array with True
-00029640: 2069 6620 706f 696e 7473 2061 7265 206f   if points are o
-00029650: 7574 6c69 6572 7320 616e 6420 4661 6c73  utliers and Fals
-00029660: 650a 2020 2020 6f74 6865 7277 6973 652a  e.    otherwise*
-00029670: 0a0a 2020 2020 3a70 6172 616d 206e 7061  ..    :param npa
-00029680: 7272 6179 2070 6f69 6e74 733a 2061 6e20  rray points: an 
-00029690: 6e75 6d6f 6273 6572 7661 7469 6f6e 7320  numobservations 
-000296a0: 6279 206e 756d 6469 6d65 6e73 696f 6e73  by numdimensions
-000296b0: 206e 756d 7079 2061 7272 6179 0a20 2020   numpy array.   
-000296c0: 2020 2020 206f 6620 6f62 7365 7276 6174       of observat
-000296d0: 696f 6e73 0a20 2020 203a 7061 7261 6d20  ions.    :param 
-000296e0: 666c 6f61 7420 7468 7265 7368 3a20 7468  float thresh: th
-000296f0: 6520 6d6f 6469 6669 6564 207a 2d73 636f  e modified z-sco
-00029700: 7265 2074 6f20 7573 6520 6173 2061 2074  re to use as a t
-00029710: 6872 6573 686f 6c64 2e0a 2020 2020 2020  hreshold..      
-00029720: 2020 4f62 7365 7276 6174 696f 6e73 2077    Observations w
-00029730: 6974 6820 6120 6d6f 6469 6669 6564 207a  ith a modified z
-00029740: 2d73 636f 7265 2028 6261 7365 6420 6f6e  -score (based on
-00029750: 2074 6865 206d 6564 6961 6e20 6162 736f   the median abso
-00029760: 6c75 7465 0a20 2020 2020 2020 2064 6576  lute.        dev
-00029770: 6961 7469 6f6e 2920 6772 6561 7465 7220  iation) greater 
-00029780: 7468 616e 2074 6869 7320 7661 6c75 6520  than this value 
-00029790: 7769 6c6c 2062 6520 636c 6173 7369 6669  will be classifi
-000297a0: 6564 2061 7320 6f75 746c 6965 7273 2e0a  ed as outliers..
-000297b0: 2020 2020 3a72 6574 7572 6e3a 2041 2062      :return: A b
-000297c0: 6f6c 6561 6e20 6d61 736b 2c20 6f66 2073  olean mask, of s
-000297d0: 697a 6520 6e75 6d6f 6273 6572 7661 7469  ize numobservati
-000297e0: 6f6e 732d 6c65 6e67 7468 2061 7272 6179  ons-length array
-000297f0: 2e0a 0a20 2020 202e 2e20 6e6f 7465 3a3a  ...    .. note::
-00029800: 0a20 2020 2020 2020 2042 6f72 6973 2049  .        Boris I
-00029810: 676c 6577 6963 7a20 616e 6420 4461 7669  glewicz and Davi
-00029820: 6420 486f 6167 6c69 6e20 2831 3939 3329  d Hoaglin (1993)
-00029830: 2c20 2256 6f6c 756d 6520 3136 3a20 486f  , "Volume 16: Ho
-00029840: 7720 746f 2044 6574 6563 7420 616e 640a  w to Detect and.
-00029850: 2020 2020 2020 2020 4861 6e64 6c65 204f          Handle O
-00029860: 7574 6c69 6572 7322 2c20 5468 6520 4153  utliers", The AS
-00029870: 5143 2042 6173 6963 2052 6566 6572 656e  QC Basic Referen
-00029880: 6365 7320 696e 2051 7561 6c69 7479 2043  ces in Quality C
-00029890: 6f6e 7472 6f6c 3a0a 2020 2020 2020 2020  ontrol:.        
-000298a0: 5374 6174 6973 7469 6361 6c20 5465 6368  Statistical Tech
-000298b0: 6e69 7175 6573 2c20 4564 7761 7264 2046  niques, Edward F
-000298c0: 2e20 4d79 6b79 746b 612c 2050 682e 442e  . Mykytka, Ph.D.
-000298d0: 2c20 4564 6974 6f72 2e0a 2020 2020 2222  , Editor..    ""
-000298e0: 220a 2020 2020 6966 206c 656e 2870 6f69  ".    if len(poi
-000298f0: 6e74 732e 7368 6170 6529 203d 3d20 313a  nts.shape) == 1:
-00029900: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
-00029910: 3d20 706f 696e 7473 5b3a 2c20 4e6f 6e65  = points[:, None
-00029920: 5d0a 2020 2020 6d65 6469 616e 203d 206e  ].    median = n
-00029930: 702e 6d65 6469 616e 2870 6f69 6e74 732c  p.median(points,
-00029940: 2061 7869 733d 3029 0a20 2020 2064 6966   axis=0).    dif
-00029950: 6620 3d20 6e70 2e73 756d 2828 706f 696e  f = np.sum((poin
-00029960: 7473 202d 206d 6564 6961 6e29 202a 2a20  ts - median) ** 
-00029970: 322c 2061 7869 733d 2d31 290a 2020 2020  2, axis=-1).    
-00029980: 6469 6666 203d 206e 702e 7371 7274 2864  diff = np.sqrt(d
-00029990: 6966 6629 0a20 2020 206d 6564 5f61 6273  iff).    med_abs
-000299a0: 5f64 6576 6961 7469 6f6e 203d 206e 702e  _deviation = np.
-000299b0: 6d65 6469 616e 2864 6966 6629 0a0a 2020  median(diff)..  
-000299c0: 2020 6d6f 6469 6669 6564 5f7a 5f73 636f    modified_z_sco
-000299d0: 7265 203d 2030 2e36 3734 3520 2a20 6469  re = 0.6745 * di
-000299e0: 6666 202f 206d 6564 5f61 6273 5f64 6576  ff / med_abs_dev
-000299f0: 6961 7469 6f6e 0a0a 2020 2020 7469 6d65  iation..    time
-00029a00: 706f 696e 7473 5f74 6f5f 6469 7363 6172  points_to_discar
-00029a10: 6420 3d20 300a 2020 2020 666f 7220 6920  d = 0.    for i 
-00029a20: 696e 2072 616e 6765 286c 656e 286d 6f64  in range(len(mod
-00029a30: 6966 6965 645f 7a5f 7363 6f72 6529 293a  ified_z_score)):
-00029a40: 0a20 2020 2020 2020 2069 6620 6d6f 6469  .        if modi
-00029a50: 6669 6564 5f7a 5f73 636f 7265 5b69 5d20  fied_z_score[i] 
-00029a60: 3c3d 2074 6872 6573 683a 0a20 2020 2020  <= thresh:.     
-00029a70: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00029a80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00029a90: 2020 2020 2020 2074 696d 6570 6f69 6e74         timepoint
-00029aa0: 735f 746f 5f64 6973 6361 7264 202b 3d20  s_to_discard += 
-00029ab0: 310a 0a20 2020 2072 6574 7572 6e20 7469  1..    return ti
-00029ac0: 6d65 706f 696e 7473 5f74 6f5f 6469 7363  mepoints_to_disc
-00029ad0: 6172 640a 0a0a 6465 6620 7468 7265 7368  ard...def thresh
-00029ae0: 6f6c 6428 6669 6c65 5f6e 616d 652c 2074  old(file_name, t
-00029af0: 6872 6573 6829 3a0a 2020 2020 2222 220a  hresh):.    """.
-00029b00: 2020 2020 4261 7369 6320 6d65 7468 6f64      Basic method
-00029b10: 2066 6f72 2069 6d61 6765 2074 6872 6573   for image thres
-00029b20: 686f 6c64 696e 670a 0a20 2020 203a 7061  holding..    :pa
-00029b30: 7261 6d20 6669 6c65 5f6e 616d 653a 2049  ram file_name: I
-00029b40: 6d61 6765 2074 6f20 6265 2074 6872 6573  mage to be thres
-00029b50: 686f 6c64 6564 0a20 2020 203a 7061 7261  holded.    :para
-00029b60: 6d20 7468 7265 7368 3a20 5468 7265 7368  m thresh: Thresh
-00029b70: 6f6c 6420 7661 6c75 6520 2861 2066 6c6f  old value (a flo
-00029b80: 6174 2062 6574 7765 656e 2030 2061 6e64  at between 0 and
-00029b90: 2031 290a 2020 2020 3a72 6574 7572 6e73   1).    :returns
-00029ba0: 3a20 496d 6167 6520 6166 7465 7220 7468  : Image after th
-00029bb0: 7265 7368 6f6c 6469 6e67 0a20 2020 2022  resholding.    "
-00029bc0: 2222 0a20 2020 2069 6d67 203d 206e 6962  "".    img = nib
-00029bd0: 2e6c 6f61 6428 6669 6c65 5f6e 616d 6529  .load(file_name)
-00029be0: 0a20 2020 2069 6d67 5f64 6174 6120 3d20  .    img_data = 
-00029bf0: 696d 672e 6765 745f 6664 6174 6128 290a  img.get_fdata().
-00029c00: 2020 2020 5f6d 6178 203d 2069 6d67 5f64      _max = img_d
-00029c10: 6174 612e 6d61 7828 290a 2020 2020 696d  ata.max().    im
-00029c20: 675f 7468 7265 7368 203d 2028 696d 675f  g_thresh = (img_
-00029c30: 6461 7461 203e 2028 5f6d 6178 202a 2074  data > (_max * t
-00029c40: 6872 6573 6829 292e 6173 7479 7065 2866  hresh)).astype(f
-00029c50: 6c6f 6174 290a 2020 2020 696d 675f 6669  loat).    img_fi
-00029c60: 6e61 6c20 3d20 6e69 622e 4e69 6674 6931  nal = nib.Nifti1
-00029c70: 496d 6167 6528 696d 675f 7468 7265 7368  Image(img_thresh
-00029c80: 2c20 696d 672e 6166 6669 6e65 2c20 696d  , img.affine, im
-00029c90: 672e 6865 6164 6572 290a 2020 2020 7265  g.header).    re
-00029ca0: 7475 726e 2069 6d67 5f66 696e 616c 0a    turn img_final.
+000244c0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000244d0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+000244e0: 2020 2020 7365 6c66 2e6d 6178 5f33 3262      self.max_32b
+000244f0: 6974 2061 6e64 206e 702e 6474 7970 6528  it and np.dtype(
+00024500: 696d 672e 6765 745f 6461 7461 5f64 7479  img.get_data_dty
+00024510: 7065 2829 292e 6974 656d 7369 7a65 203e  pe()).itemsize >
+00024520: 2034 0a20 2020 2020 2020 2020 2020 2029   4.            )
+00024530: 206f 7220 7365 6c66 2e6e 5f76 6f6c 756d   or self.n_volum
+00024540: 6573 5f74 6f5f 6469 7363 6172 643a 0a20  es_to_discard:. 
+00024550: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00024560: 2066 6f72 6365 2066 6c6f 6174 3332 206f   force float32 o
+00024570: 6e6c 7920 6966 2036 3420 6269 7420 6474  nly if 64 bit dt
+00024580: 7970 6520 6973 2064 6574 6563 7465 640a  ype is detected.
+00024590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000245a0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+000245b0: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
+000245c0: 785f 3332 6269 740a 2020 2020 2020 2020  x_32bit.        
+000245d0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+000245e0: 6e70 2e64 7479 7065 2869 6d67 2e67 6574  np.dtype(img.get
+000245f0: 5f64 6174 615f 6474 7970 6528 2929 2e69  _data_dtype()).i
+00024600: 7465 6d73 697a 6520 3e20 340a 2020 2020  temsize > 4.    
+00024610: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+00024620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024630: 2020 2069 6e5f 6461 7461 203d 2069 6d67     in_data = img
+00024640: 2e67 6574 5f66 6461 7461 2864 7479 7065  .get_fdata(dtype
+00024650: 3d6e 702e 666c 6f61 7433 3229 0a20 2020  =np.float32).   
+00024660: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00024670: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00024680: 2020 2020 2020 2069 6e5f 6461 7461 203d         in_data =
+00024690: 2069 6d67 2e64 6174 616f 626a 0a0a 2020   img.dataobj..  
+000246a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000246b0: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
+000246c0: 2020 2020 2020 2020 2069 6d67 203d 206e           img = n
+000246d0: 6962 2e4e 6966 7469 3149 6d61 6765 280a  ib.Nifti1Image(.
+000246e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000246f0: 2020 2020 696e 5f64 6174 615b 3a2c 203a      in_data[:, :
+00024700: 2c20 3a2c 2073 656c 662e 6e5f 766f 6c75  , :, self.n_volu
+00024710: 6d65 735f 746f 5f64 6973 6361 7264 3a5d  mes_to_discard:]
+00024720: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024730: 2020 2020 2020 696d 672e 6166 6669 6e65        img.affine
+00024740: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024750: 2020 2020 2020 696d 672e 6865 6164 6572        img.header
+00024760: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024770: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00024780: 2020 2020 2320 666d 743a 206f 6e0a 2020      # fmt: on.  
+00024790: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+000247a0: 7665 5f66 696c 6520 3d20 5472 7565 0a0a  ve_file = True..
+000247b0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000247c0: 656e 2869 6d67 2e68 6561 6465 722e 6578  en(img.header.ex
+000247d0: 7465 6e73 696f 6e73 2920 213d 2030 3a0a  tensions) != 0:.
+000247e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000247f0: 696d 672e 6865 6164 6572 2e65 7874 656e  img.header.exten
+00024800: 7369 6f6e 732e 636c 6561 7228 290a 2020  sions.clear().  
+00024810: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00024820: 7665 5f66 696c 6520 3d20 5472 7565 0a0a  ve_file = True..
+00024830: 2020 2020 2020 2020 2020 2020 2320 5374              # St
+00024840: 6f72 6520 6e65 7720 6669 6c65 0a20 2020  ore new file.   
+00024850: 2020 2020 2020 2020 2069 6620 7361 7665           if save
+00024860: 5f66 696c 653a 0a20 2020 2020 2020 2020  _file:.         
+00024870: 2020 2020 2020 2023 2049 6d61 6765 2073         # Image s
+00024880: 6176 650a 2020 2020 2020 2020 2020 2020  ave.            
+00024890: 2020 2020 5f2c 2066 696c 655f 6e61 6d65      _, file_name
+000248a0: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
+000248b0: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
+000248c0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000248d0: 5f6e 616d 655f 6e6f 5f65 7874 2c20 6669  _name_no_ext, fi
+000248e0: 6c65 5f65 7874 656e 7369 6f6e 203d 206f  le_extension = o
+000248f0: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
+00024900: 6669 6c65 5f6e 616d 6529 0a20 2020 2020  file_name).     
+00024910: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00024920: 6c65 5f65 7874 656e 7369 6f6e 203d 3d20  le_extension == 
+00024930: 222e 677a 223a 0a20 2020 2020 2020 2020  ".gz":.         
+00024940: 2020 2020 2020 2020 2020 2028 6669 6c65             (file
+00024950: 5f6e 616d 655f 6e6f 5f65 7874 5f32 2c20  _name_no_ext_2, 
+00024960: 6669 6c65 5f65 7874 656e 7369 6f6e 5f32  file_extension_2
+00024970: 2920 3d20 6f73 2e70 6174 682e 7370 6c69  ) = os.path.spli
+00024980: 7465 7874 280a 2020 2020 2020 2020 2020  text(.          
+00024990: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000249a0: 6c65 5f6e 616d 655f 6e6f 5f65 7874 0a20  le_name_no_ext. 
+000249b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000249c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000249d0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+000249e0: 5f65 7874 656e 7369 6f6e 5f32 203d 3d20  _extension_2 == 
+000249f0: 222e 6e69 6922 3a0a 2020 2020 2020 2020  ".nii":.        
+00024a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a10: 6669 6c65 5f6e 616d 655f 6e6f 5f65 7874  file_name_no_ext
+00024a20: 203d 2066 696c 655f 6e61 6d65 5f6e 6f5f   = file_name_no_
+00024a30: 6578 745f 320a 2020 2020 2020 2020 2020  ext_2.          
+00024a40: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00024a50: 6c65 5f65 7874 656e 7369 6f6e 203d 2022  le_extension = "
+00024a60: 2e6e 6969 2e67 7a22 0a0a 2020 2020 2020  .nii.gz"..      
+00024a70: 2020 2020 2020 2020 2020 6669 6c65 5f6f            file_o
+00024a80: 7574 203d 206f 732e 7061 7468 2e6a 6f69  ut = os.path.joi
+00024a90: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00024aa0: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
+00024ab0: 7574 5f64 6972 6563 746f 7279 2c0a 2020  ut_directory,.  
+00024ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ad0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00024ae0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00024af0: 2e70 7265 6669 782e 7374 7269 7028 290a  .prefix.strip().
+00024b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b10: 2020 2020 2020 2020 2b20 6669 6c65 5f6e          + file_n
+00024b20: 616d 655f 6e6f 5f65 7874 0a20 2020 2020  ame_no_ext.     
+00024b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b40: 2020 202b 2073 656c 662e 7375 6666 6978     + self.suffix
+00024b50: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00024b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b70: 202b 2066 696c 655f 6578 7465 6e73 696f   + file_extensio
+00024b80: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00024b90: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00024ba0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00024bb0: 2020 2020 2020 2020 2020 206e 6962 2e73             nib.s
+00024bc0: 6176 6528 696d 672c 2066 696c 655f 6f75  ave(img, file_ou
+00024bd0: 7429 0a0a 0a63 6c61 7373 2054 534e 5228  t)...class TSNR(
+00024be0: 5072 6f63 6573 734d 4941 293a 0a20 2020  ProcessMIA):.   
+00024bf0: 2022 2222 0a20 2020 202a 436f 6d70 7574   """.    *Comput
+00024c00: 6573 2074 6865 2074 696d 652d 636f 7572  es the time-cour
+00024c10: 7365 2053 4e52 2066 6f72 2061 2074 696d  se SNR for a tim
+00024c20: 6520 7365 7269 6573 2a0a 0a20 2020 2050  e series*..    P
+00024c30: 6c65 6173 652c 2073 6565 2074 6865 2063  lease, see the c
+00024c40: 6f6d 706c 6574 6520 646f 6375 6d65 6e74  omplete document
+00024c50: 6174 696f 6e20 666f 7220 7468 650a 2020  ation for the.  
+00024c60: 2020 6054 534e 5220 6272 6963 6b20 696e    `TSNR brick in
+00024c70: 2074 6865 206d 6961 5f70 726f 6365 7373   the mia_process
+00024c80: 6573 2077 6562 7369 7465 0a20 2020 203c  es website.    <
+00024c90: 6874 7470 733a 2f2f 706f 7075 6c73 652e  https://populse.
+00024ca0: 6769 7468 7562 2e69 6f2f 6d69 615f 7072  github.io/mia_pr
+00024cb0: 6f63 6573 7365 732f 6874 6d6c 2f64 6f63  ocesses/html/doc
+00024cc0: 756d 656e 7461 7469 6f6e 2f62 7269 636b  umentation/brick
+00024cd0: 732f 7072 6570 726f 6365 7373 2f6f 7468  s/preprocess/oth
+00024ce0: 6572 2f54 534e 522e 6874 6d6c 3e60 5f0a  er/TSNR.html>`_.
+00024cf0: 0a20 2020 2061 6461 7074 6564 2066 726f  .    adapted fro
+00024d00: 6d3a 0a20 2020 2068 7474 7073 3a2f 2f67  m:.    https://g
+00024d10: 6974 6875 622e 636f 6d2f 6e69 7079 2f6e  ithub.com/nipy/n
+00024d20: 6970 7970 652f 626c 6f62 2f66 3636 3261  ipype/blob/f662a
+00024d30: 6366 6365 3864 6566 3437 3137 6530 6333  cfce8def4717e0c3
+00024d40: 3431 3436 3138 6633 6135 6465 3539 3133  414618f3a5de5913
+00024d50: 6233 312f 6e69 7079 7065 2f61 6c67 6f72  b31/nipype/algor
+00024d60: 6974 686d 732f 636f 6e66 6f75 6e64 732e  ithms/confounds.
+00024d70: 7079 234c 3839 390a 0a20 2020 2022 2222  py#L899..    """
+00024d80: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00024d90: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00024da0: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
+00024db0: 6f20 7468 6520 6174 7472 6962 7574 6573  o the attributes
+00024dc0: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
+00024dd0: 2f20 696e 7374 616e 7469 6174 696f 6e2e  / instantiation.
+00024de0: 0a0a 2020 2020 2020 2020 5468 6520 696e  ..        The in
+00024df0: 7075 7420 616e 6420 6f75 7470 7574 2070  put and output p
+00024e00: 6c75 6773 2061 7265 2064 6566 696e 6564  lugs are defined
+00024e10: 2068 6572 652e 2054 6865 2073 7065 6369   here. The speci
+00024e20: 616c 0a20 2020 2020 2020 2027 7365 6c66  al.        'self
+00024e30: 2e72 6571 7569 7265 6d65 6e74 2720 6174  .requirement' at
+00024e40: 7472 6962 7574 6520 286f 7074 696f 6e61  tribute (optiona
+00024e50: 6c29 2069 7320 7573 6564 2074 6f20 6465  l) is used to de
+00024e60: 6669 6e65 2074 6865 0a20 2020 2020 2020  fine the.       
+00024e70: 2074 6869 7264 2d70 6172 7479 2070 726f   third-party pro
+00024e80: 6475 6374 7320 6e65 6365 7373 6172 7920  ducts necessary 
+00024e90: 666f 7220 7468 6520 7275 6e6e 696e 6720  for the running 
+00024ea0: 6f66 2074 6865 2062 7269 636b 2e0a 2020  of the brick..  
+00024eb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00024ec0: 2020 2320 496e 6974 6961 6c69 7361 7469    # Initialisati
+00024ed0: 6f6e 206f 6620 7468 6520 6f62 6a65 6374  on of the object
+00024ee0: 7320 6e65 6564 6564 2066 6f72 2074 6865  s needed for the
+00024ef0: 206c 6175 6e63 6820 6f66 2074 6865 2062   launch of the b
+00024f00: 7269 636b 0a20 2020 2020 2020 2073 7570  rick.        sup
+00024f10: 6572 2854 534e 522c 2073 656c 6629 2e5f  er(TSNR, self)._
+00024f20: 5f69 6e69 745f 5f28 290a 0a20 2020 2020  _init__()..     
+00024f30: 2020 2023 2054 6869 7264 2070 6172 7479     # Third party
+00024f40: 2073 6f66 7477 6172 6573 2072 6571 7569   softwares requi
+00024f50: 7265 6420 666f 7220 7468 6520 6578 6563  red for the exec
+00024f60: 7574 696f 6e20 6f66 2074 6865 2062 7269  ution of the bri
+00024f70: 636b 0a20 2020 2020 2020 2073 656c 662e  ck.        self.
+00024f80: 7265 7175 6972 656d 656e 7420 3d20 5b5d  requirement = []
+00024f90: 0a0a 2020 2020 2020 2020 2320 496e 7075  ..        # Inpu
+00024fa0: 7473 2064 6573 6372 6970 7469 6f6e 0a20  ts description. 
+00024fb0: 2020 2020 2020 2069 6e5f 6669 6c65 5f64         in_file_d
+00024fc0: 6573 6320 3d20 2241 6e20 6578 6973 7469  esc = "An existi
+00024fd0: 6e67 2070 6174 6820 6669 6c65 2e22 0a20  ng path file.". 
+00024fe0: 2020 2020 2020 2070 7265 6669 785f 7473         prefix_ts
+00024ff0: 6e72 5f64 6573 6320 3d20 2250 7265 6669  nr_desc = "Prefi
+00025000: 7820 6f66 2074 6865 2074 736e 7220 696d  x of the tsnr im
+00025010: 6167 6520 2861 2073 7472 696e 6729 2e22  age (a string)."
+00025020: 0a20 2020 2020 2020 2073 7566 6669 785f  .        suffix_
+00025030: 7473 6e72 5f64 6573 6320 3d20 2253 7566  tsnr_desc = "Suf
+00025040: 6669 7820 6f66 2074 6865 2074 736e 7220  fix of the tsnr 
+00025050: 696d 6167 6520 2861 2073 7472 696e 6729  image (a string)
+00025060: 2e22 0a20 2020 2020 2020 2070 7265 6669  .".        prefi
+00025070: 785f 7374 6464 6576 5f64 6573 6320 3d20  x_stddev_desc = 
+00025080: 2250 7265 6669 7820 6f66 2074 6865 2074  "Prefix of the t
+00025090: 736e 7220 696d 6167 6520 2861 2073 7472  snr image (a str
+000250a0: 696e 6729 2e22 0a20 2020 2020 2020 2073  ing).".        s
+000250b0: 7566 6669 785f 7374 6464 6576 5f64 6573  uffix_stddev_des
+000250c0: 6320 3d20 2253 7566 6669 7820 6f66 2074  c = "Suffix of t
+000250d0: 6865 2074 736e 7220 696d 6167 6520 2861  he tsnr image (a
+000250e0: 2073 7472 696e 6729 2e22 0a0a 2020 2020   string)."..    
+000250f0: 2020 2020 2320 4f75 7470 7574 7320 6465      # Outputs de
+00025100: 7363 7269 7074 696f 6e0a 2020 2020 2020  scription.      
+00025110: 2020 6f75 745f 7473 6e72 5f66 696c 655f    out_tsnr_file_
+00025120: 6465 7363 203d 2028 0a20 2020 2020 2020  desc = (.       
+00025130: 2020 2020 2022 5061 7468 206f 6620 7468       "Path of th
+00025140: 6520 7363 616e 2061 6674 6572 206d 6173  e scan after mas
+00025150: 6b69 6e67 2022 0a20 2020 2020 2020 2020  king ".         
+00025160: 2020 2022 2861 2070 6174 686c 696b 6520     "(a pathlike 
+00025170: 6f62 6a65 6374 206f 7220 7374 7269 6e67  object or string
+00025180: 2072 6570 7265 7365 6e74 696e 6720 6120   representing a 
+00025190: 6669 6c65 292e 220a 2020 2020 2020 2020  file).".        
+000251a0: 290a 0a20 2020 2020 2020 206f 7574 5f73  )..        out_s
+000251b0: 7464 6465 765f 6669 6c65 5f64 6573 6320  tddev_file_desc 
+000251c0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+000251d0: 2250 6174 6820 6f66 2074 6865 2073 6361  "Path of the sca
+000251e0: 6e20 6166 7465 7220 6d61 736b 696e 6720  n after masking 
+000251f0: 220a 2020 2020 2020 2020 2020 2020 2228  ".            "(
+00025200: 6120 7061 7468 6c69 6b65 206f 626a 6563  a pathlike objec
+00025210: 7420 6f72 2073 7472 696e 6720 7265 7072  t or string repr
+00025220: 6573 656e 7469 6e67 2061 2066 696c 6529  esenting a file)
+00025230: 2e22 0a20 2020 2020 2020 2029 0a0a 2020  .".        )..  
+00025240: 2020 2020 2020 2320 496e 7075 7473 2074        # Inputs t
+00025250: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
+00025260: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
+00025270: 2020 2020 2020 2020 2020 2269 6e5f 6669            "in_fi
+00025280: 6c65 222c 2046 696c 6528 6f75 7470 7574  le", File(output
+00025290: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
+000252a0: 3d46 616c 7365 2c20 6465 7363 3d69 6e5f  =False, desc=in_
+000252b0: 6669 6c65 5f64 6573 6329 0a20 2020 2020  file_desc).     
+000252c0: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+000252d0: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
+000252e0: 2020 2020 2020 2020 2020 2270 7265 6669            "prefi
+000252f0: 785f 7473 6e72 222c 0a20 2020 2020 2020  x_tsnr",.       
+00025300: 2020 2020 2074 7261 6974 732e 5374 7269       traits.Stri
+00025310: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+00025320: 2020 2020 2222 2c20 6f75 7470 7574 3d46      "", output=F
+00025330: 616c 7365 2c20 6f70 7469 6f6e 616c 3d54  alse, optional=T
+00025340: 7275 652c 2064 6573 633d 7072 6566 6978  rue, desc=prefix
+00025350: 5f74 736e 725f 6465 7363 0a20 2020 2020  _tsnr_desc.     
+00025360: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+00025370: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
+00025380: 662e 6164 645f 7472 6169 7428 0a20 2020  f.add_trait(.   
+00025390: 2020 2020 2020 2020 2022 7375 6666 6978           "suffix
+000253a0: 5f74 736e 7222 2c0a 2020 2020 2020 2020  _tsnr",.        
+000253b0: 2020 2020 7472 6169 7473 2e53 7472 696e      traits.Strin
+000253c0: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+000253d0: 2020 2022 5f74 736e 7222 2c20 6f75 7470     "_tsnr", outp
+000253e0: 7574 3d46 616c 7365 2c20 6f70 7469 6f6e  ut=False, option
+000253f0: 616c 3d54 7275 652c 2064 6573 633d 7375  al=True, desc=su
+00025400: 6666 6978 5f74 736e 725f 6465 7363 0a20  ffix_tsnr_desc. 
+00025410: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00025420: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00025430: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+00025440: 0a20 2020 2020 2020 2020 2020 2022 7072  .            "pr
+00025450: 6566 6978 5f73 7464 6465 7622 2c0a 2020  efix_stddev",.  
+00025460: 2020 2020 2020 2020 2020 7472 6169 7473            traits
+00025470: 2e53 7472 696e 6728 0a20 2020 2020 2020  .String(.       
+00025480: 2020 2020 2020 2020 2022 222c 206f 7574           "", out
+00025490: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
+000254a0: 6e61 6c3d 5472 7565 2c20 6465 7363 3d70  nal=True, desc=p
+000254b0: 7265 6669 785f 7374 6464 6576 5f64 6573  refix_stddev_des
+000254c0: 630a 2020 2020 2020 2020 2020 2020 292c  c.            ),
+000254d0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000254e0: 2020 2020 7365 6c66 2e61 6464 5f74 7261      self.add_tra
+000254f0: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+00025500: 2273 7566 6669 785f 7374 6464 6576 222c  "suffix_stddev",
+00025510: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00025520: 6974 732e 5374 7269 6e67 280a 2020 2020  its.String(.    
+00025530: 2020 2020 2020 2020 2020 2020 225f 7374              "_st
+00025540: 6464 6576 222c 206f 7574 7075 743d 4661  ddev", output=Fa
+00025550: 6c73 652c 206f 7074 696f 6e61 6c3d 5472  lse, optional=Tr
+00025560: 7565 2c20 6465 7363 3d73 7566 6669 785f  ue, desc=suffix_
+00025570: 7374 6464 6576 5f64 6573 630a 2020 2020  stddev_desc.    
+00025580: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00025590: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+000255a0: 4f75 7470 7574 7320 7472 6169 7473 0a20  Outputs traits. 
+000255b0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+000255c0: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
+000255d0: 2020 2022 6f75 745f 7473 6e72 5f66 696c     "out_tsnr_fil
+000255e0: 6522 2c20 4669 6c65 286f 7574 7075 743d  e", File(output=
+000255f0: 5472 7565 2c20 6465 7363 3d6f 7574 5f74  True, desc=out_t
+00025600: 736e 725f 6669 6c65 5f64 6573 6329 0a20  snr_file_desc). 
+00025610: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00025620: 2020 7365 6c66 2e61 6464 5f74 7261 6974    self.add_trait
+00025630: 280a 2020 2020 2020 2020 2020 2020 226f  (.            "o
+00025640: 7574 5f73 7464 6465 765f 6669 6c65 222c  ut_stddev_file",
+00025650: 0a20 2020 2020 2020 2020 2020 2046 696c  .            Fil
+00025660: 6528 6f75 7470 7574 3d54 7275 652c 206f  e(output=True, o
+00025670: 7074 696f 6e61 6c3d 5472 7565 2c20 6465  ptional=True, de
+00025680: 7363 3d6f 7574 5f73 7464 6465 765f 6669  sc=out_stddev_fi
+00025690: 6c65 5f64 6573 6329 2c0a 2020 2020 2020  le_desc),.      
+000256a0: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
+000256b0: 662e 696e 6974 5f64 6566 6175 6c74 5f74  f.init_default_t
+000256c0: 7261 6974 7328 290a 0a20 2020 2064 6566  raits()..    def
+000256d0: 206c 6973 745f 6f75 7470 7574 7328 7365   list_outputs(se
+000256e0: 6c66 2c20 6973 5f70 6c75 6767 6564 3d4e  lf, is_plugged=N
+000256f0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00025700: 2244 6564 6963 6174 6564 2074 6f20 7468  "Dedicated to th
+00025710: 6520 696e 6974 6961 6c69 7361 7469 6f6e  e initialisation
+00025720: 2073 7465 7020 6f66 2074 6865 2062 7269   step of the bri
+00025730: 636b 2e0a 0a20 2020 2020 2020 2054 6865  ck...        The
+00025740: 206d 6169 6e20 6f62 6a65 6374 6976 6520   main objective 
+00025750: 6f66 2074 6869 7320 6d65 7468 6f64 2069  of this method i
+00025760: 7320 746f 2070 726f 6475 6365 2074 6865  s to produce the
+00025770: 206f 7574 7075 7473 206f 6620 7468 650a   outputs of the.
+00025780: 2020 2020 2020 2020 6272 6963 6b73 2028          bricks (
+00025790: 7365 6c66 2e6f 7574 7075 7473 2920 616e  self.outputs) an
+000257a0: 6420 7468 6520 6173 736f 6369 6174 6564  d the associated
+000257b0: 2074 6167 7320 2873 656c 662e 696e 6865   tags (self.inhe
+000257c0: 7269 7461 6e63 655f 6469 6329 2c0a 2020  ritance_dic),.  
+000257d0: 2020 2020 2020 6966 2064 6566 696e 6564        if defined
+000257e0: 2068 6572 652e 2054 6f20 776f 726b 2070   here. To work p
+000257f0: 726f 7065 726c 7920 7468 6973 206d 6574  roperly this met
+00025800: 686f 6420 6d75 7374 2072 6574 7572 6e0a  hod must return.
+00025810: 2020 2020 2020 2020 7365 6c66 2e6d 616b          self.mak
+00025820: 655f 696e 6974 5265 7375 6c74 2829 206f  e_initResult() o
+00025830: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
+00025840: 3a70 6172 616d 2069 735f 706c 7567 6765  :param is_plugge
+00025850: 643a 2074 6865 2073 7461 7465 2c20 6c69  d: the state, li
+00025860: 6e6b 6564 206f 7220 6e6f 742c 206f 6620  nked or not, of 
+00025870: 7468 6520 706c 7567 732e 0a20 2020 2020  the plugs..     
+00025880: 2020 203a 7265 7475 726e 733a 2061 2064     :returns: a d
+00025890: 6963 7469 6f6e 6172 7920 7769 7468 2072  ictionary with r
+000258a0: 6571 7569 7265 6d65 6e74 2c20 6f75 7470  equirement, outp
+000258b0: 7574 7320 616e 6420 696e 6865 7269 7461  uts and inherita
+000258c0: 6e63 655f 6469 6374 2e0a 2020 2020 2020  nce_dict..      
+000258d0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+000258e0: 5573 696e 6720 7468 6520 696e 6865 7269  Using the inheri
+000258f0: 7461 6e63 6520 746f 2050 726f 6365 7373  tance to Process
+00025900: 4d49 4120 636c 6173 732c 206c 6973 745f  MIA class, list_
+00025910: 6f75 7470 7574 7320 6d65 7468 6f64 0a20  outputs method. 
+00025920: 2020 2020 2020 2073 7570 6572 2854 534e         super(TSN
+00025930: 522c 2073 656c 6629 2e6c 6973 745f 6f75  R, self).list_ou
+00025940: 7470 7574 7328 290a 0a20 2020 2020 2020  tputs()..       
+00025950: 2023 204f 7574 7075 7473 2064 6566 696e   # Outputs defin
+00025960: 6974 696f 6e0a 2020 2020 2020 2020 6966  ition.        if
+00025970: 2073 656c 662e 696e 5f66 696c 653a 0a20   self.in_file:. 
+00025980: 2020 2020 2020 2020 2020 2076 616c 6964             valid
+00025990: 5f65 7874 2c20 696e 5f65 7874 2c20 6669  _ext, in_ext, fi
+000259a0: 6c65 4e61 6d65 203d 2063 6865 636b 4669  leName = checkFi
+000259b0: 6c65 4578 7428 7365 6c66 2e69 6e5f 6669  leExt(self.in_fi
+000259c0: 6c65 2c20 4558 5429 0a0a 2020 2020 2020  le, EXT)..      
+000259d0: 2020 2020 2020 6966 206e 6f74 2076 616c        if not val
+000259e0: 6964 5f65 7874 3a0a 2020 2020 2020 2020  id_ext:.        
+000259f0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00025a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a10: 2020 2022 5c6e 5453 4e52 2062 7269 636b     "\nTSNR brick
+00025a20: 3a20 5468 6520 696e 7075 7420 696d 6167  : The input imag
+00025a30: 6520 666f 726d 6174 2069 7320 6e6f 7420  e format is not 
+00025a40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00025a50: 2020 2020 2020 2272 6563 6f67 6e69 7a65        "recognize
+00025a60: 642e 2e2e 2122 0a20 2020 2020 2020 2020  d...!".         
+00025a70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00025a80: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00025a90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00025aa0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00025ab0: 2020 286e 6f74 2073 656c 662e 7375 6666    (not self.suff
+00025ac0: 6978 5f74 736e 7229 0a20 2020 2020 2020  ix_tsnr).       
+00025ad0: 2020 2020 2020 2020 206f 7220 2873 656c           or (sel
+00025ae0: 662e 7375 6666 6978 5f74 736e 722e 6973  f.suffix_tsnr.is
+00025af0: 7370 6163 6528 2929 0a20 2020 2020 2020  space()).       
+00025b00: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+00025b10: 2e73 7566 6669 785f 7473 6e72 2069 6e20  .suffix_tsnr in 
+00025b20: 5b55 6e64 6566 696e 6564 2c20 223c 756e  [Undefined, "<un
+00025b30: 6465 6669 6e65 643e 225d 0a20 2020 2020  defined>"].     
+00025b40: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00025b50: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00025b60: 7566 6669 785f 7473 6e72 203d 2022 2022  uffix_tsnr = " "
+00025b70: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00025b80: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00025b90: 2020 2028 6e6f 7420 7365 6c66 2e70 7265     (not self.pre
+00025ba0: 6669 785f 7473 6e72 290a 2020 2020 2020  fix_tsnr).      
+00025bb0: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
+00025bc0: 6c66 2e70 7265 6669 785f 7473 6e72 2e69  lf.prefix_tsnr.i
+00025bd0: 7373 7061 6365 2829 290a 2020 2020 2020  sspace()).      
+00025be0: 2020 2020 2020 2020 2020 6f72 2028 7365            or (se
+00025bf0: 6c66 2e70 7265 6669 785f 7473 6e72 2069  lf.prefix_tsnr i
+00025c00: 6e20 5b55 6e64 6566 696e 6564 2c20 223c  n [Undefined, "<
+00025c10: 756e 6465 6669 6e65 643e 225d 290a 2020  undefined>"]).  
+00025c20: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00025c30: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00025c40: 662e 7072 6566 6978 5f74 736e 7220 3d20  f.prefix_tsnr = 
+00025c50: 2220 220a 0a20 2020 2020 2020 2020 2020  " "..           
+00025c60: 2066 696c 655f 7473 6e72 203d 2022 220a   file_tsnr = "".
+00025c70: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+00025c80: 682c 205f 203d 206f 732e 7061 7468 2e73  h, _ = os.path.s
+00025c90: 706c 6974 2873 656c 662e 696e 5f66 696c  plit(self.in_fil
+00025ca0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00025cb0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00025cc0: 2020 2020 2073 656c 662e 7375 6666 6978       self.suffix
+00025cd0: 5f74 736e 7220 3d3d 2022 2022 0a20 2020  _tsnr == " ".   
+00025ce0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00025cf0: 2073 656c 662e 7072 6566 6978 5f74 736e   self.prefix_tsn
+00025d00: 7220 3d3d 2022 2022 0a20 2020 2020 2020  r == " ".       
+00025d10: 2020 2020 2020 2020 2061 6e64 2070 6174           and pat
+00025d20: 6820 3d3d 2073 656c 662e 6f75 7470 7574  h == self.output
+00025d30: 5f64 6972 6563 746f 7279 0a20 2020 2020  _directory.     
+00025d40: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00025d50: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+00025d60: 514d 6573 7361 6765 426f 7828 290a 2020  QMessageBox().  
+00025d70: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+00025d80: 672e 7365 7449 636f 6e28 514d 6573 7361  g.setIcon(QMessa
+00025d90: 6765 426f 782e 5761 726e 696e 6729 0a20  geBox.Warning). 
+00025da0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00025db0: 7367 2e73 6574 5769 6e64 6f77 5469 746c  sg.setWindowTitl
+00025dc0: 6528 226d 6961 5f70 726f 6365 7373 6573  e("mia_processes
+00025dd0: 202d 2054 534e 5220 6272 6963 6b20 5761   - TSNR brick Wa
+00025de0: 726e 696e 6721 2229 0a20 2020 2020 2020  rning!").       
+00025df0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
+00025e00: 5465 7874 280a 2020 2020 2020 2020 2020  Text(.          
+00025e10: 2020 2020 2020 2020 2020 2273 7566 6669            "suffi
+00025e20: 785f 7473 6e72 2061 6e64 2070 7265 6669  x_tsnr and prefi
+00025e30: 785f 7473 6e72 2069 6e70 7574 2070 6172  x_tsnr input par
+00025e40: 616d 6574 6572 7320 6172 6520 6e6f 7420  ameters are not 
+00025e50: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00025e60: 2020 2020 2020 2264 6566 696e 6564 206f        "defined o
+00025e70: 7220 636f 6e73 6973 7420 6f6e 6c79 206f  r consist only o
+00025e80: 6620 6f6e 6520 6f72 206d 6f72 6520 7768  f one or more wh
+00025e90: 6974 6520 220a 2020 2020 2020 2020 2020  ite ".          
+00025ea0: 2020 2020 2020 2020 2020 2273 7061 6365            "space
+00025eb0: 732e 5c6e 5468 6520 7b30 7d20 696e 7075  s.\nThe {0} inpu
+00025ec0: 7420 7061 7261 6d65 7465 7220 7769 6c6c  t parameter will
+00025ed0: 2062 6520 220a 2020 2020 2020 2020 2020   be ".          
+00025ee0: 2020 2020 2020 2020 2020 226f 7665 7277            "overw
+00025ef0: 7269 7474 656e 202e 2e2e 5c6e 2059 6573  ritten ...\n Yes
+00025f00: 206f 7220 220a 2020 2020 2020 2020 2020   or ".          
+00025f10: 2020 2020 2020 2020 2020 2241 626f 7274            "Abort
+00025f20: 3f22 2e66 6f72 6d61 7428 6669 6c65 4e61  ?".format(fileNa
+00025f30: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00025f40: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00025f50: 2020 2020 2020 6d73 672e 7365 7453 7461        msg.setSta
+00025f60: 6e64 6172 6442 7574 746f 6e73 2851 4d65  ndardButtons(QMe
+00025f70: 7373 6167 6542 6f78 2e59 6573 207c 2051  ssageBox.Yes | Q
+00025f80: 4d65 7373 6167 6542 6f78 2e41 626f 7274  MessageBox.Abort
+00025f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00025fa0: 2020 7265 7476 616c 203d 206d 7367 2e65    retval = msg.e
+00025fb0: 7865 635f 2829 0a0a 2020 2020 2020 2020  xec_()..        
+00025fc0: 2020 2020 2020 2020 6966 2072 6574 7661          if retva
+00025fd0: 6c20 213d 2051 4d65 7373 6167 6542 6f78  l != QMessageBox
+00025fe0: 2e41 626f 7274 3a0a 2020 2020 2020 2020  .Abort:.        
+00025ff0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00026000: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00026010: 2020 2020 2020 2020 2020 2022 5c6e 5453             "\nTS
+00026020: 4e52 2062 7269 636b 2077 6172 6e69 6e67  NR brick warning
+00026030: 3a20 7468 6520 6f75 745f 7473 6e72 5f66  : the out_tsnr_f
+00026040: 696c 6520 6f75 7470 7574 2022 0a20 2020  ile output ".   
+00026050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026060: 2020 2020 2022 7061 7261 6d65 7465 7220       "parameter 
+00026070: 6973 2074 6865 2073 616d 6520 6173 2074  is the same as t
+00026080: 6865 2069 6e5f 6669 6c65 2069 6e70 7574  he in_file input
+00026090: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000260a0: 2020 2020 2020 2020 2020 2022 7061 7261             "para
+000260b0: 6d65 7465 7220 2873 7566 6669 7820 616e  meter (suffix an
+000260c0: 6420 7072 6566 6978 2061 7265 206e 6f74  d prefix are not
+000260d0: 2064 6566 696e 6564 293a 220a 2020 2020   defined):".    
+000260e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260f0: 2020 2020 225c 6e7b 307d 2077 696c 6c20      "\n{0} will 
+00026100: 6265 206f 7665 7277 7269 7465 6420 2e2e  be overwrited ..
+00026110: 2e22 2e66 6f72 6d61 7428 6669 6c65 4e61  .".format(fileNa
+00026120: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00026130: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00026140: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00026150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026160: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+00026170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026180: 2020 2020 225c 6e54 534e 5220 6272 6963      "\nTSNR bric
+00026190: 6b3a 2041 626f 7274 6564 2e20 506c 6561  k: Aborted. Plea
+000261a0: 7365 2063 6865 636b 2079 6f75 7220 696e  se check your in
+000261b0: 7075 7420 220a 2020 2020 2020 2020 2020  put ".          
+000261c0: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+000261d0: 6172 616d 6574 6572 7320 2e2e 2e22 0a20  arameters ...". 
+000261e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000261f0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00026200: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00026210: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00026220: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00026230: 2020 2066 696c 655f 7473 6e72 203d 206f     file_tsnr = o
+00026240: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+00026250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026260: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
+00026270: 6563 746f 7279 2c0a 2020 2020 2020 2020  ectory,.        
+00026280: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+00026290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262a0: 2020 2020 2020 7365 6c66 2e70 7265 6669        self.prefi
+000262b0: 785f 7473 6e72 2e73 7472 6970 2829 0a20  x_tsnr.strip(). 
+000262c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262d0: 2020 2020 2020 202b 2066 696c 654e 616d         + fileNam
+000262e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000262f0: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
+00026300: 2e73 7566 6669 785f 7473 6e72 2e73 7472  .suffix_tsnr.str
+00026310: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
+00026320: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00026330: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+00026340: 2020 2020 2020 2020 2020 202b 2069 6e5f             + in_
+00026350: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
+00026360: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00026370: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00026380: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+00026390: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000263a0: 6e6f 7420 7365 6c66 2e73 7566 6669 785f  not self.suffix_
+000263b0: 7374 6464 6576 290a 2020 2020 2020 2020  stddev).        
+000263c0: 2020 2020 2020 2020 6f72 2028 7365 6c66          or (self
+000263d0: 2e73 7566 6669 785f 7374 6464 6576 2e69  .suffix_stddev.i
+000263e0: 7373 7061 6365 2829 290a 2020 2020 2020  sspace()).      
+000263f0: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
+00026400: 662e 7375 6666 6978 5f73 7464 6465 7620  f.suffix_stddev 
+00026410: 696e 205b 556e 6465 6669 6e65 642c 2022  in [Undefined, "
+00026420: 3c75 6e64 6566 696e 6564 3e22 5d0a 2020  <undefined>"].  
+00026430: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00026440: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00026450: 662e 7375 6666 6978 5f73 7464 6465 7620  f.suffix_stddev 
+00026460: 3d20 2220 220a 0a20 2020 2020 2020 2020  = " "..         
+00026470: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+00026480: 2020 2020 2020 2020 286e 6f74 2073 656c          (not sel
+00026490: 662e 7072 6566 6978 5f73 7464 6465 7629  f.prefix_stddev)
+000264a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000264b0: 206f 7220 2873 656c 662e 7072 6566 6978   or (self.prefix
+000264c0: 5f73 7464 6465 762e 6973 7370 6163 6528  _stddev.isspace(
+000264d0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000264e0: 2020 206f 7220 2873 656c 662e 7072 6566     or (self.pref
+000264f0: 6978 5f73 7464 6465 7620 696e 205b 556e  ix_stddev in [Un
+00026500: 6465 6669 6e65 642c 2022 3c75 6e64 6566  defined, "<undef
+00026510: 696e 6564 3e22 5d29 0a20 2020 2020 2020  ined>"]).       
+00026520: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00026530: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+00026540: 6669 785f 7374 6464 6576 203d 2022 2022  fix_stddev = " "
+00026550: 0a0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00026560: 6c65 5f73 7464 6465 7620 3d20 2222 0a0a  le_stddev = ""..
+00026570: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00026580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026590: 2073 656c 662e 7375 6666 6978 5f73 7464   self.suffix_std
+000265a0: 6465 7620 3d3d 2022 2022 0a20 2020 2020  dev == " ".     
+000265b0: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
+000265c0: 656c 662e 7072 6566 6978 5f73 7464 6465  elf.prefix_stdde
+000265d0: 7620 3d3d 2022 2022 0a20 2020 2020 2020  v == " ".       
+000265e0: 2020 2020 2020 2020 2061 6e64 2070 6174           and pat
+000265f0: 6820 3d3d 2073 656c 662e 6f75 7470 7574  h == self.output
+00026600: 5f64 6972 6563 746f 7279 0a20 2020 2020  _directory.     
+00026610: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00026620: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+00026630: 514d 6573 7361 6765 426f 7828 290a 2020  QMessageBox().  
+00026640: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+00026650: 672e 7365 7449 636f 6e28 514d 6573 7361  g.setIcon(QMessa
+00026660: 6765 426f 782e 5761 726e 696e 6729 0a20  geBox.Warning). 
+00026670: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00026680: 7367 2e73 6574 5769 6e64 6f77 5469 746c  sg.setWindowTitl
+00026690: 6528 226d 6961 5f70 726f 6365 7373 6573  e("mia_processes
+000266a0: 202d 2054 534e 5220 6272 6963 6b20 5761   - TSNR brick Wa
+000266b0: 726e 696e 6721 2229 0a20 2020 2020 2020  rning!").       
+000266c0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
+000266d0: 5465 7874 280a 2020 2020 2020 2020 2020  Text(.          
+000266e0: 2020 2020 2020 2020 2020 2273 7566 6669            "suffi
+000266f0: 785f 7374 6464 6576 2061 6e64 2070 7265  x_stddev and pre
+00026700: 6669 785f 7374 6464 6576 2069 6e70 7574  fix_stddev input
+00026710: 2070 6172 616d 6574 6572 7320 6172 6520   parameters are 
+00026720: 6e6f 7420 220a 2020 2020 2020 2020 2020  not ".          
+00026730: 2020 2020 2020 2020 2020 2264 6566 696e            "defin
+00026740: 6564 206f 7220 636f 6e73 6973 7420 6f6e  ed or consist on
+00026750: 6c79 206f 6620 6f6e 6520 6f72 206d 6f72  ly of one or mor
+00026760: 6520 7768 6974 6520 220a 2020 2020 2020  e white ".      
+00026770: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+00026780: 7061 6365 732e 5c6e 5468 6520 7b30 7d20  paces.\nThe {0} 
+00026790: 696e 7075 7420 7061 7261 6d65 7465 7220  input parameter 
+000267a0: 7769 6c6c 2062 6520 220a 2020 2020 2020  will be ".      
+000267b0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
+000267c0: 7665 7277 7269 7474 656e 202e 2e2e 5c6e  verwritten ...\n
+000267d0: 2059 6573 206f 7220 220a 2020 2020 2020   Yes or ".      
+000267e0: 2020 2020 2020 2020 2020 2020 2020 2241                "A
+000267f0: 626f 7274 3f22 2e66 6f72 6d61 7428 6669  bort?".format(fi
+00026800: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
+00026810: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00026820: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
+00026830: 7453 7461 6e64 6172 6442 7574 746f 6e73  tStandardButtons
+00026840: 2851 4d65 7373 6167 6542 6f78 2e59 6573  (QMessageBox.Yes
+00026850: 207c 2051 4d65 7373 6167 6542 6f78 2e41   | QMessageBox.A
+00026860: 626f 7274 290a 2020 2020 2020 2020 2020  bort).          
+00026870: 2020 2020 2020 7265 7476 616c 203d 206d        retval = m
+00026880: 7367 2e65 7865 635f 2829 0a0a 2020 2020  sg.exec_()..    
+00026890: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000268a0: 6574 7661 6c20 213d 2051 4d65 7373 6167  etval != QMessag
+000268b0: 6542 6f78 2e41 626f 7274 3a0a 2020 2020  eBox.Abort:.    
+000268c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000268d0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+000268e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000268f0: 5c6e 5453 4e52 2062 7269 636b 2077 6172  \nTSNR brick war
+00026900: 6e69 6e67 3a20 7468 6520 6f75 745f 7374  ning: the out_st
+00026910: 6464 6576 5f66 696c 6520 6f75 7470 7574  ddev_file output
+00026920: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00026930: 2020 2020 2020 2020 2020 2022 7061 7261             "para
+00026940: 6d65 7465 7220 6973 2074 6865 2073 616d  meter is the sam
+00026950: 6520 6173 2074 6865 2069 6e5f 6669 6c65  e as the in_file
+00026960: 7320 696e 7075 7420 220a 2020 2020 2020  s input ".      
+00026970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026980: 2020 2270 6172 616d 6574 6572 2028 7375    "parameter (su
+00026990: 6666 6978 2061 6e64 2070 7265 6669 7820  ffix and prefix 
+000269a0: 6172 6520 6e6f 7420 6465 6669 6e65 6429  are not defined)
+000269b0: 3a22 0a20 2020 2020 2020 2020 2020 2020  :".             
+000269c0: 2020 2020 2020 2020 2020 2022 5c6e 7b30             "\n{0
+000269d0: 7d20 7769 6c6c 2062 6520 6f76 6572 7772  } will be overwr
+000269e0: 6974 6564 202e 2e2e 222e 666f 726d 6174  ited ...".format
+000269f0: 2866 696c 654e 616d 6529 0a20 2020 2020  (fileName).     
+00026a00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00026a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026a20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00026a30: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00026a40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00026a50: 2020 2020 2020 2020 2020 225c 6e54 534e            "\nTSN
+00026a60: 5220 6272 6963 6b20 4162 6f72 7465 642e  R brick Aborted.
+00026a70: 2050 6c65 6173 6520 6368 6563 6b20 796f   Please check yo
+00026a80: 7572 2069 6e70 7574 2022 0a20 2020 2020  ur input ".     
+00026a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026aa0: 2020 2022 7061 7261 6d65 7465 7273 202e     "parameters .
+00026ab0: 2e2e 220a 2020 2020 2020 2020 2020 2020  ..".            
+00026ac0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00026ad0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00026ae0: 7475 726e 0a0a 2020 2020 2020 2020 2020  turn..          
+00026af0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00026b00: 2020 2020 2020 2020 6669 6c65 5f73 7464          file_std
+00026b10: 6465 7620 3d20 6f73 2e70 6174 682e 6a6f  dev = os.path.jo
+00026b20: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
+00026b30: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
+00026b40: 7075 745f 6469 7265 6374 6f72 792c 0a20  put_directory,. 
+00026b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b60: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+00026b70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00026b80: 662e 7072 6566 6978 5f73 7464 6465 762e  f.prefix_stddev.
+00026b90: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+00026ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026bb0: 2b20 6669 6c65 4e61 6d65 0a20 2020 2020  + fileName.     
+00026bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026bd0: 2020 202b 2073 656c 662e 7375 6666 6978     + self.suffix
+00026be0: 5f73 7464 6465 762e 7374 7269 7028 290a  _stddev.strip().
+00026bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c00: 2020 2020 2020 2020 2b20 222e 220a 2020          + ".".  
+00026c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c20: 2020 2020 2020 2b20 696e 5f65 7874 0a20        + in_ext. 
+00026c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c40: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00026c50: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00026c60: 2020 2020 2073 656c 662e 6f75 7470 7574       self.output
+00026c70: 735b 226f 7574 5f74 736e 725f 6669 6c65  s["out_tsnr_file
+00026c80: 225d 203d 2066 696c 655f 7473 6e72 0a20  "] = file_tsnr. 
+00026c90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00026ca0: 6f75 7470 7574 735b 226f 7574 5f73 7464  outputs["out_std
+00026cb0: 6465 765f 6669 6c65 225d 203d 2066 696c  dev_file"] = fil
+00026cc0: 655f 7374 6464 6576 0a0a 2020 2020 2020  e_stddev..      
+00026cd0: 2020 2020 2020 2320 7461 6773 2069 6e68        # tags inh
+00026ce0: 6572 6974 616e 6365 2028 6f70 7469 6f6e  eritance (option
+00026cf0: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+00026d00: 6966 2073 656c 662e 6f75 7470 7574 735b  if self.outputs[
+00026d10: 226f 7574 5f74 736e 725f 6669 6c65 225d  "out_tsnr_file"]
+00026d20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026d30: 2020 7365 6c66 2e74 6167 735f 696e 6865    self.tags_inhe
+00026d40: 7269 7461 6e63 6528 0a20 2020 2020 2020  ritance(.       
+00026d50: 2020 2020 2020 2020 2020 2020 2069 6e5f               in_
+00026d60: 6669 6c65 3d73 656c 662e 696e 5f66 696c  file=self.in_fil
+00026d70: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00026d80: 2020 2020 2020 206f 7574 5f66 696c 653d         out_file=
+00026d90: 7365 6c66 2e6f 7574 7075 7473 5b22 6f75  self.outputs["ou
+00026da0: 745f 7473 6e72 5f66 696c 6522 5d2c 0a20  t_tsnr_file"],. 
+00026db0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00026dc0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00026dd0: 2073 656c 662e 6f75 7470 7574 735b 226f   self.outputs["o
+00026de0: 7574 5f73 7464 6465 765f 6669 6c65 225d  ut_stddev_file"]
+00026df0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026e00: 2020 7365 6c66 2e74 6167 735f 696e 6865    self.tags_inhe
+00026e10: 7269 7461 6e63 6528 0a20 2020 2020 2020  ritance(.       
+00026e20: 2020 2020 2020 2020 2020 2020 2069 6e5f               in_
+00026e30: 6669 6c65 3d73 656c 662e 696e 5f66 696c  file=self.in_fil
+00026e40: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00026e50: 2020 2020 2020 206f 7574 5f66 696c 653d         out_file=
+00026e60: 7365 6c66 2e6f 7574 7075 7473 5b22 6f75  self.outputs["ou
+00026e70: 745f 7374 6464 6576 5f66 696c 6522 5d2c  t_stddev_file"],
+00026e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026e90: 2029 0a0a 2020 2020 2020 2020 2320 5265   )..        # Re
+00026ea0: 7475 726e 2074 6865 2072 6571 7569 7265  turn the require
+00026eb0: 6d65 6e74 2c20 6f75 7470 7574 7320 616e  ment, outputs an
+00026ec0: 6420 696e 6865 7269 7461 6e63 655f 6469  d inheritance_di
+00026ed0: 6374 0a20 2020 2020 2020 2072 6574 7572  ct.        retur
+00026ee0: 6e20 7365 6c66 2e6d 616b 655f 696e 6974  n self.make_init
+00026ef0: 5265 7375 6c74 2829 0a0a 2020 2020 6465  Result()..    de
+00026f00: 6620 7275 6e5f 7072 6f63 6573 735f 6d69  f run_process_mi
+00026f10: 6128 7365 6c66 293a 0a20 2020 2020 2020  a(self):.       
+00026f20: 2022 2222 4465 6469 6361 7465 6420 746f   """Dedicated to
+00026f30: 2074 6865 2070 726f 6365 7373 206c 6175   the process lau
+00026f40: 6e63 6820 7374 6570 206f 6620 7468 6520  nch step of the 
+00026f50: 6272 6963 6b2e 2222 220a 2020 2020 2020  brick.""".      
+00026f60: 2020 7375 7065 7228 5453 4e52 2c20 7365    super(TSNR, se
+00026f70: 6c66 292e 7275 6e5f 7072 6f63 6573 735f  lf).run_process_
+00026f80: 6d69 6128 290a 0a20 2020 2020 2020 2066  mia()..        f
+00026f90: 696c 655f 6e61 6d65 203d 2073 656c 662e  ile_name = self.
+00026fa0: 696e 5f66 696c 650a 0a20 2020 2020 2020  in_file..       
+00026fb0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00026fc0: 2020 696d 6720 3d20 6e69 622e 6c6f 6164    img = nib.load
+00026fd0: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
+00026fe0: 2020 2020 6578 6365 7074 2028 0a20 2020      except (.   
+00026ff0: 2020 2020 2020 2020 206e 6962 2e66 696c           nib.fil
+00027000: 6562 6173 6564 696d 6167 6573 2e49 6d61  ebasedimages.Ima
+00027010: 6765 4669 6c65 4572 726f 722c 0a20 2020  geFileError,.   
+00027020: 2020 2020 2020 2020 2046 696c 654e 6f74           FileNot
+00027030: 466f 756e 6445 7272 6f72 2c0a 2020 2020  FoundError,.    
+00027040: 2020 2020 2020 2020 5479 7065 4572 726f          TypeErro
+00027050: 722c 0a20 2020 2020 2020 2029 2061 7320  r,.        ) as 
+00027060: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00027070: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+00027080: 2020 2020 2020 225c 6e54 534e 5220 6272        "\nTSNR br
+00027090: 6963 6b3a 2045 7272 6f72 2077 6974 6820  ick: Error with 
+000270a0: 6669 6c65 7320 746f 206d 6173 6b2c 2064  files to mask, d
+000270b0: 7572 696e 6720 7468 6520 7275 6e3a 2022  uring the run: "
+000270c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000270d0: 2020 652c 0a20 2020 2020 2020 2020 2020    e,.           
+000270e0: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+000270f0: 6d67 203d 204e 6f6e 650a 0a20 2020 2020  mg = None..     
+00027100: 2020 2069 6620 696d 6720 6973 206e 6f74     if img is not
+00027110: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00027120: 2020 2068 6561 6465 7220 3d20 696d 672e     header = img.
+00027130: 6865 6164 6572 2e63 6f70 7928 290a 2020  header.copy().  
+00027140: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00027150: 2069 6d67 2e67 6574 5f66 6461 7461 2864   img.get_fdata(d
+00027160: 7479 7065 3d6e 702e 666c 6f61 7433 3229  type=np.float32)
+00027170: 2e72 6573 6861 7065 280a 2020 2020 2020  .reshape(.      
+00027180: 2020 2020 2020 2020 2020 696d 672e 7368            img.sh
+00027190: 6170 655b 3a33 5d20 2b20 282d 312c 290a  ape[:3] + (-1,).
+000271a0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000271b0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+000271c0: 206e 702e 6e61 6e5f 746f 5f6e 756d 2864   np.nan_to_num(d
+000271d0: 6174 6129 0a0a 2020 2020 2020 2020 2020  ata)..          
+000271e0: 2020 6966 2064 6174 612e 6474 7970 652e    if data.dtype.
+000271f0: 6b69 6e64 203d 3d20 2269 223a 0a20 2020  kind == "i":.   
+00027200: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+00027210: 6465 722e 7365 745f 6461 7461 5f64 7479  der.set_data_dty
+00027220: 7065 286e 702e 666c 6f61 7433 3229 0a20  pe(np.float32). 
+00027230: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00027240: 6174 6120 3d20 6461 7461 2e61 7374 7970  ata = data.astyp
+00027250: 6528 6e70 2e66 6c6f 6174 3332 290a 0a20  e(np.float32).. 
+00027260: 2020 2020 2020 2020 2020 206d 6561 6e69             meani
+00027270: 6d67 203d 206e 702e 6d65 616e 2864 6174  mg = np.mean(dat
+00027280: 612c 2061 7869 733d 3329 0a20 2020 2020  a, axis=3).     
+00027290: 2020 2020 2020 2073 7464 6465 7669 6d67         stddevimg
+000272a0: 203d 206e 702e 7374 6428 6461 7461 2c20   = np.std(data, 
+000272b0: 6178 6973 3d33 290a 2020 2020 2020 2020  axis=3).        
+000272c0: 2020 2020 7473 6e72 203d 206e 702e 7a65      tsnr = np.ze
+000272d0: 726f 735f 6c69 6b65 286d 6561 6e69 6d67  ros_like(meanimg
+000272e0: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
+000272f0: 6464 6576 696d 675f 6e6f 6e7a 6572 6f20  ddevimg_nonzero 
+00027300: 3d20 7374 6464 6576 696d 6720 3e20 312e  = stddevimg > 1.
+00027310: 3065 2d33 0a20 2020 2020 2020 2020 2020  0e-3.           
+00027320: 2074 736e 725b 7374 6464 6576 696d 675f   tsnr[stddevimg_
+00027330: 6e6f 6e7a 6572 6f5d 203d 2028 0a20 2020  nonzero] = (.   
+00027340: 2020 2020 2020 2020 2020 2020 206d 6561               mea
+00027350: 6e69 6d67 5b73 7464 6465 7669 6d67 5f6e  nimg[stddevimg_n
+00027360: 6f6e 7a65 726f 5d20 2f20 7374 6464 6576  onzero] / stddev
+00027370: 696d 675b 7374 6464 6576 696d 675f 6e6f  img[stddevimg_no
+00027380: 6e7a 6572 6f5d 0a20 2020 2020 2020 2020  nzero].         
+00027390: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+000273a0: 2020 2320 496d 6167 6520 7361 7665 0a20    # Image save. 
+000273b0: 2020 2020 2020 2020 2020 205f 2c20 6669             _, fi
+000273c0: 6c65 5f6e 616d 6520 3d20 6f73 2e70 6174  le_name = os.pat
+000273d0: 682e 7370 6c69 7428 6669 6c65 5f6e 616d  h.split(file_nam
+000273e0: 6529 0a20 2020 2020 2020 2020 2020 2066  e).            f
+000273f0: 696c 655f 6e61 6d65 5f6e 6f5f 6578 742c  ile_name_no_ext,
+00027400: 2066 696c 655f 6578 7465 6e73 696f 6e20   file_extension 
+00027410: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
+00027420: 7874 2866 696c 655f 6e61 6d65 290a 2020  xt(file_name).  
+00027430: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
+00027440: 655f 6578 7465 6e73 696f 6e20 3d3d 2022  e_extension == "
+00027450: 2e67 7a22 3a0a 2020 2020 2020 2020 2020  .gz":.          
+00027460: 2020 2020 2020 2866 696c 655f 6e61 6d65        (file_name
+00027470: 5f6e 6f5f 6578 745f 322c 2066 696c 655f  _no_ext_2, file_
+00027480: 6578 7465 6e73 696f 6e5f 3229 203d 206f  extension_2) = o
+00027490: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
+000274a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000274b0: 2020 2020 2066 696c 655f 6e61 6d65 5f6e       file_name_n
+000274c0: 6f5f 6578 740a 2020 2020 2020 2020 2020  o_ext.          
+000274d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000274e0: 2020 2020 2020 2020 6966 2066 696c 655f          if file_
+000274f0: 6578 7465 6e73 696f 6e5f 3220 3d3d 2022  extension_2 == "
+00027500: 2e6e 6969 223a 0a20 2020 2020 2020 2020  .nii":.         
+00027510: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00027520: 6e61 6d65 5f6e 6f5f 6578 7420 3d20 6669  name_no_ext = fi
+00027530: 6c65 5f6e 616d 655f 6e6f 5f65 7874 5f32  le_name_no_ext_2
+00027540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027550: 2020 2020 2066 696c 655f 6578 7465 6e73       file_extens
+00027560: 696f 6e20 3d20 222e 6e69 692e 677a 220a  ion = ".nii.gz".
+00027570: 0a20 2020 2020 2020 2020 2020 2074 736e  .            tsn
+00027580: 725f 6669 6c65 5f6f 7574 203d 206f 732e  r_file_out = os.
+00027590: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
+000275a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000275b0: 6f75 7470 7574 5f64 6972 6563 746f 7279  output_directory
+000275c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000275d0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+000275e0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+000275f0: 6669 785f 7473 6e72 2e73 7472 6970 2829  fix_tsnr.strip()
+00027600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027610: 2020 2020 202b 2066 696c 655f 6e61 6d65       + file_name
+00027620: 5f6e 6f5f 6578 740a 2020 2020 2020 2020  _no_ext.        
+00027630: 2020 2020 2020 2020 2020 2020 2b20 7365              + se
+00027640: 6c66 2e73 7566 6669 785f 7473 6e72 2e73  lf.suffix_tsnr.s
+00027650: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+00027660: 2020 2020 2020 2020 2020 202b 2066 696c             + fil
+00027670: 655f 6578 7465 6e73 696f 6e0a 2020 2020  e_extension.    
+00027680: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00027690: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000276a0: 2020 2020 2020 2020 2074 736e 725f 696d           tsnr_im
+000276b0: 6720 3d20 6e69 622e 4e69 6674 6931 496d  g = nib.Nifti1Im
+000276c0: 6167 6528 7473 6e72 2c20 696d 672e 6166  age(tsnr, img.af
+000276d0: 6669 6e65 2c20 6865 6164 6572 290a 2020  fine, header).  
+000276e0: 2020 2020 2020 2020 2020 6e69 622e 7361            nib.sa
+000276f0: 7665 2874 736e 725f 696d 672c 2074 736e  ve(tsnr_img, tsn
+00027700: 725f 6669 6c65 5f6f 7574 290a 0a20 2020  r_file_out)..   
+00027710: 2020 2020 2020 2020 2073 7464 6465 765f           stddev_
+00027720: 6669 6c65 5f6f 7574 203d 206f 732e 7061  file_out = os.pa
+00027730: 7468 2e6a 6f69 6e28 0a20 2020 2020 2020  th.join(.       
+00027740: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
+00027750: 7470 7574 5f64 6972 6563 746f 7279 2c0a  tput_directory,.
+00027760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027770: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00027780: 2020 2020 2020 7365 6c66 2e70 7265 6669        self.prefi
+00027790: 785f 7374 6464 6576 2e73 7472 6970 2829  x_stddev.strip()
+000277a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000277b0: 2020 2020 202b 2066 696c 655f 6e61 6d65       + file_name
+000277c0: 5f6e 6f5f 6578 740a 2020 2020 2020 2020  _no_ext.        
+000277d0: 2020 2020 2020 2020 2020 2020 2b20 7365              + se
+000277e0: 6c66 2e73 7566 6669 785f 7374 6464 6576  lf.suffix_stddev
+000277f0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00027800: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+00027810: 696c 655f 6578 7465 6e73 696f 6e0a 2020  ile_extension.  
+00027820: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00027830: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00027840: 2020 2020 2020 2020 2020 2073 7464 6465             stdde
+00027850: 765f 696d 6720 3d20 6e69 622e 4e69 6674  v_img = nib.Nift
+00027860: 6931 496d 6167 6528 7374 6464 6576 696d  i1Image(stddevim
+00027870: 672c 2069 6d67 2e61 6666 696e 652c 2068  g, img.affine, h
+00027880: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
+00027890: 2020 206e 6962 2e73 6176 6528 7374 6464     nib.save(stdd
+000278a0: 6576 5f69 6d67 2c20 7374 6464 6576 5f66  ev_img, stddev_f
+000278b0: 696c 655f 6f75 7429 0a0a 0a63 6c61 7373  ile_out)...class
+000278c0: 2054 656d 706c 6174 6546 726f 6d54 656d   TemplateFromTem
+000278d0: 706c 6174 6546 6c6f 7728 5072 6f63 6573  plateFlow(Proces
+000278e0: 734d 4941 293a 0a20 2020 2022 2222 0a20  sMIA):.    """. 
+000278f0: 2020 202a 4765 7420 7465 6d70 6c61 7465     *Get template
+00027900: 2069 6d61 6765 2066 726f 6d20 7465 6d70   image from temp
+00027910: 6c61 7465 666c 6f77 2a0a 0a20 2020 2050  lateflow*..    P
+00027920: 6c65 6173 652c 2073 6565 2074 6865 2063  lease, see the c
+00027930: 6f6d 706c 6574 6520 646f 6375 6d65 6e74  omplete document
+00027940: 6174 696f 6e20 666f 7220 7468 650a 2020  ation for the.  
+00027950: 2020 6054 656d 706c 6174 6546 726f 6d54    `TemplateFromT
+00027960: 656d 706c 6174 6546 6c6f 7720 6272 6963  emplateFlow bric
+00027970: 6b20 696e 2074 6865 206d 6961 5f70 726f  k in the mia_pro
+00027980: 6365 7373 6573 2077 6562 7369 7465 0a20  cesses website. 
+00027990: 2020 203c 6874 7470 733a 2f2f 706f 7075     <https://popu
+000279a0: 6c73 652e 6769 7468 7562 2e69 6f2f 6d69  lse.github.io/mi
+000279b0: 615f 7072 6f63 6573 7365 732f 6874 6d6c  a_processes/html
+000279c0: 2f64 6f63 756d 656e 7461 7469 6f6e 2f62  /documentation/b
+000279d0: 7269 636b 732f 7072 6570 726f 6365 7373  ricks/preprocess
+000279e0: 2f6f 7468 6572 2f54 656d 706c 6174 6546  /other/TemplateF
+000279f0: 726f 6d54 656d 706c 6174 6546 6c6f 772e  romTemplateFlow.
+00027a00: 6874 6d6c 3e60 5f0a 0a20 2020 2022 2222  html>`_..    """
+00027a10: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00027a20: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00027a30: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
+00027a40: 6f20 7468 6520 6174 7472 6962 7574 6573  o the attributes
+00027a50: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
+00027a60: 2f20 696e 7374 616e 7469 6174 696f 6e2e  / instantiation.
+00027a70: 0a0a 2020 2020 2020 2020 5468 6520 696e  ..        The in
+00027a80: 7075 7420 616e 6420 6f75 7470 7574 2070  put and output p
+00027a90: 6c75 6773 2061 7265 2064 6566 696e 6564  lugs are defined
+00027aa0: 2068 6572 652e 2054 6865 2073 7065 6369   here. The speci
+00027ab0: 616c 0a20 2020 2020 2020 2027 7365 6c66  al.        'self
+00027ac0: 2e72 6571 7569 7265 6d65 6e74 2720 6174  .requirement' at
+00027ad0: 7472 6962 7574 6520 286f 7074 696f 6e61  tribute (optiona
+00027ae0: 6c29 2069 7320 7573 6564 2074 6f20 6465  l) is used to de
+00027af0: 6669 6e65 2074 6865 0a20 2020 2020 2020  fine the.       
+00027b00: 2074 6869 7264 2d70 6172 7479 2070 726f   third-party pro
+00027b10: 6475 6374 7320 6e65 6365 7373 6172 7920  ducts necessary 
+00027b20: 666f 7220 7468 6520 7275 6e6e 696e 6720  for the running 
+00027b30: 6f66 2074 6865 2062 7269 636b 2e0a 2020  of the brick..  
+00027b40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00027b50: 2020 2320 496e 6974 6961 6c69 7361 7469    # Initialisati
+00027b60: 6f6e 206f 6620 7468 6520 6f62 6a65 6374  on of the object
+00027b70: 7320 6e65 6564 6564 2066 6f72 2074 6865  s needed for the
+00027b80: 206c 6175 6e63 6820 6f66 2074 6865 2062   launch of the b
+00027b90: 7269 636b 0a20 2020 2020 2020 2073 7570  rick.        sup
+00027ba0: 6572 2854 656d 706c 6174 6546 726f 6d54  er(TemplateFromT
+00027bb0: 656d 706c 6174 6546 6c6f 772c 2073 656c  emplateFlow, sel
+00027bc0: 6629 2e5f 5f69 6e69 745f 5f28 290a 0a20  f).__init__().. 
+00027bd0: 2020 2020 2020 2023 2054 6869 7264 2070         # Third p
+00027be0: 6172 7479 2073 6f66 7477 6172 6573 2072  arty softwares r
+00027bf0: 6571 7569 7265 6420 666f 7220 7468 6520  equired for the 
+00027c00: 6578 6563 7574 696f 6e20 6f66 2074 6865  execution of the
+00027c10: 2062 7269 636b 0a20 2020 2020 2020 2073   brick.        s
+00027c20: 656c 662e 7265 7175 6972 656d 656e 7420  elf.requirement 
+00027c30: 3d20 5b5d 0a0a 2020 2020 2020 2020 2320  = []..        # 
+00027c40: 496e 7075 7473 2064 6573 6372 6970 7469  Inputs descripti
+00027c50: 6f6e 0a20 2020 2020 2020 2069 6e5f 7465  on.        in_te
+00027c60: 6d70 6c61 7465 5f64 6573 6320 3d20 2254  mplate_desc = "T
+00027c70: 656d 706c 6174 6520 4e61 6d65 2028 6120  emplate Name (a 
+00027c80: 5374 7269 6e67 292e 220a 2020 2020 2020  String).".      
+00027c90: 2020 7265 736f 6c75 7469 6f6e 5f64 6573    resolution_des
+00027ca0: 6320 3d20 2252 6573 6f6c 7574 696f 6e20  c = "Resolution 
+00027cb0: 6f66 2074 6865 2074 656d 706c 6174 6520  of the template 
+00027cc0: 2028 496e 7420 6f72 204e 6f6e 6529 220a   (Int or None)".
+00027cd0: 2020 2020 2020 2020 7375 6666 6978 5f64          suffix_d
+00027ce0: 6573 6320 3d20 2242 4944 5320 7375 6666  esc = "BIDS suff
+00027cf0: 6978 2028 5374 7269 6e67 206f 7220 4e6f  ix (String or No
+00027d00: 6e65 2922 0a20 2020 2020 2020 2061 746c  ne)".        atl
+00027d10: 6173 5f64 6573 6320 3d20 224e 616d 6520  as_desc = "Name 
+00027d20: 6f66 2061 2070 6172 7469 6375 6c61 7220  of a particular 
+00027d30: 6174 6c61 7320 2853 7472 696e 6720 6f72  atlas (String or
+00027d40: 204e 6f6e 6529 220a 2020 2020 2020 2020   None)".        
+00027d50: 6465 7363 5f64 6573 6320 3d20 2244 6573  desc_desc = "Des
+00027d60: 6372 6970 7469 6f6e 2066 6965 6c64 2028  cription field (
+00027d70: 5374 7269 6e67 206f 7220 4e6f 6e65 2922  String or None)"
+00027d80: 0a20 2020 2020 2020 206c 6162 656c 5f64  .        label_d
+00027d90: 6573 6320 3d20 224c 6162 656c 2066 6965  esc = "Label fie
+00027da0: 6c64 2028 5374 7269 6e67 206f 7220 4e6f  ld (String or No
+00027db0: 6e65 2922 0a0a 2020 2020 2020 2020 2320  ne)"..        # 
+00027dc0: 4f75 7470 7574 7320 6465 7363 7269 7074  Outputs descript
+00027dd0: 696f 6e0a 2020 2020 2020 2020 7465 6d70  ion.        temp
+00027de0: 6c61 7465 5f64 6573 6320 3d20 280a 2020  late_desc = (.  
+00027df0: 2020 2020 2020 2020 2020 2250 6174 6820            "Path 
+00027e00: 6f66 2074 6865 2074 656d 706c 6174 6520  of the template 
+00027e10: 2861 2070 6174 686c 696b 6520 6f62 6a65  (a pathlike obje
+00027e20: 6374 2022 0a20 2020 2020 2020 2020 2020  ct ".           
+00027e30: 2022 6f72 2073 7472 696e 6720 7265 7072   "or string repr
+00027e40: 6573 656e 7469 6e67 2061 2066 696c 6529  esenting a file)
+00027e50: 2e22 0a20 2020 2020 2020 2029 0a0a 2020  .".        )..  
+00027e60: 2020 2020 2020 2320 496e 7075 7473 2074        # Inputs t
+00027e70: 7261 6974 730a 2020 2020 2020 2020 7365  raits.        se
+00027e80: 6c66 2e61 6464 5f74 7261 6974 280a 2020  lf.add_trait(.  
+00027e90: 2020 2020 2020 2020 2020 2261 746c 6173            "atlas
+00027ea0: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
+00027eb0: 7261 6974 732e 5374 7269 6e67 2822 222c  raits.String("",
+00027ec0: 206f 7574 7075 743d 4661 6c73 652c 206f   output=False, o
+00027ed0: 7074 696f 6e61 6c3d 5472 7565 2c20 6465  ptional=True, de
+00027ee0: 7363 3d61 746c 6173 5f64 6573 6329 2c0a  sc=atlas_desc),.
+00027ef0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00027f00: 2020 2073 656c 662e 6164 645f 7472 6169     self.add_trai
+00027f10: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
+00027f20: 6465 7363 222c 0a20 2020 2020 2020 2020  desc",.         
+00027f30: 2020 2074 7261 6974 732e 5374 7269 6e67     traits.String
+00027f40: 2822 222c 206f 7574 7075 743d 4661 6c73  ("", output=Fals
+00027f50: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
+00027f60: 2c20 6465 7363 3d64 6573 635f 6465 7363  , desc=desc_desc
+00027f70: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00027f80: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00027f90: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+00027fa0: 2020 2269 6e5f 7465 6d70 6c61 7465 222c    "in_template",
+00027fb0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00027fc0: 6974 732e 5374 7269 6e67 280a 2020 2020  its.String(.    
+00027fd0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00027fe0: 756c 743d 224d 4e49 3135 324e 4c69 6e32  ult="MNI152NLin2
+00027ff0: 3030 3963 4173 796d 222c 0a20 2020 2020  009cAsym",.     
+00028000: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00028010: 743d 4661 6c73 652c 0a20 2020 2020 2020  t=False,.       
+00028020: 2020 2020 2020 2020 206f 7074 696f 6e61           optiona
+00028030: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
+00028040: 2020 2020 2020 2020 6465 7363 3d69 6e5f          desc=in_
+00028050: 7465 6d70 6c61 7465 5f64 6573 632c 0a20  template_desc,. 
+00028060: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00028070: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00028080: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+00028090: 0a20 2020 2020 2020 2020 2020 2022 6c61  .            "la
+000280a0: 6265 6c22 2c0a 2020 2020 2020 2020 2020  bel",.          
+000280b0: 2020 7472 6169 7473 2e53 7472 696e 6728    traits.String(
+000280c0: 2222 2c20 6f75 7470 7574 3d46 616c 7365  "", output=False
+000280d0: 2c20 6f70 7469 6f6e 616c 3d54 7275 652c  , optional=True,
+000280e0: 2064 6573 633d 6c61 6265 6c5f 6465 7363   desc=label_desc
+000280f0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00028100: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00028110: 7261 6974 280a 2020 2020 2020 2020 2020  rait(.          
+00028120: 2020 2272 6573 6f6c 7574 696f 6e22 2c0a    "resolution",.
+00028130: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+00028140: 7473 2e49 6e74 2832 2c20 6f75 7470 7574  ts.Int(2, output
+00028150: 3d46 616c 7365 2c20 6f70 7469 6f6e 616c  =False, optional
+00028160: 3d54 7275 652c 2064 6573 633d 7265 736f  =True, desc=reso
+00028170: 6c75 7469 6f6e 5f64 6573 6329 2c0a 2020  lution_desc),.  
+00028180: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00028190: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+000281a0: 0a20 2020 2020 2020 2020 2020 2022 7375  .            "su
+000281b0: 6666 6978 222c 0a20 2020 2020 2020 2020  ffix",.         
+000281c0: 2020 2074 7261 6974 732e 5374 7269 6e67     traits.String
+000281d0: 2822 222c 206f 7574 7075 743d 4661 6c73  ("", output=Fals
+000281e0: 652c 206f 7074 696f 6e61 6c3d 5472 7565  e, optional=True
+000281f0: 2c20 6465 7363 3d73 7566 6669 785f 6465  , desc=suffix_de
+00028200: 7363 292c 0a20 2020 2020 2020 2029 0a0a  sc),.        )..
+00028210: 2020 2020 2020 2020 2320 4f75 7470 7574          # Output
+00028220: 7320 7472 6169 7473 0a20 2020 2020 2020  s traits.       
+00028230: 2073 656c 662e 6164 645f 7472 6169 7428   self.add_trait(
+00028240: 2274 656d 706c 6174 6522 2c20 4669 6c65  "template", File
+00028250: 286f 7574 7075 743d 5472 7565 2c20 6465  (output=True, de
+00028260: 7363 3d74 656d 706c 6174 655f 6465 7363  sc=template_desc
+00028270: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
+00028280: 2e69 6e69 745f 6465 6661 756c 745f 7472  .init_default_tr
+00028290: 6169 7473 2829 0a0a 2020 2020 6465 6620  aits()..    def 
+000282a0: 6c69 7374 5f6f 7574 7075 7473 2873 656c  list_outputs(sel
+000282b0: 662c 2069 735f 706c 7567 6765 643d 4e6f  f, is_plugged=No
+000282c0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+000282d0: 4465 6469 6361 7465 6420 746f 2074 6865  Dedicated to the
+000282e0: 2069 6e69 7469 616c 6973 6174 696f 6e20   initialisation 
+000282f0: 7374 6570 206f 6620 7468 6520 6272 6963  step of the bric
+00028300: 6b2e 0a0a 2020 2020 2020 2020 5468 6520  k...        The 
+00028310: 6d61 696e 206f 626a 6563 7469 7665 206f  main objective o
+00028320: 6620 7468 6973 206d 6574 686f 6420 6973  f this method is
+00028330: 2074 6f20 7072 6f64 7563 6520 7468 6520   to produce the 
+00028340: 6f75 7470 7574 7320 6f66 2074 6865 0a20  outputs of the. 
+00028350: 2020 2020 2020 2062 7269 636b 7320 2873         bricks (s
+00028360: 656c 662e 6f75 7470 7574 7329 2061 6e64  elf.outputs) and
+00028370: 2074 6865 2061 7373 6f63 6961 7465 6420   the associated 
+00028380: 7461 6773 2028 7365 6c66 2e69 6e68 6572  tags (self.inher
+00028390: 6974 616e 6365 5f64 6963 292c 0a20 2020  itance_dic),.   
+000283a0: 2020 2020 2069 6620 6465 6669 6e65 6420       if defined 
+000283b0: 6865 7265 2e20 546f 2077 6f72 6b20 7072  here. To work pr
+000283c0: 6f70 6572 6c79 2074 6869 7320 6d65 7468  operly this meth
+000283d0: 6f64 206d 7573 7420 7265 7475 726e 0a20  od must return. 
+000283e0: 2020 2020 2020 2073 656c 662e 6d61 6b65         self.make
+000283f0: 5f69 6e69 7452 6573 756c 7428 2920 6f62  _initResult() ob
+00028400: 6a65 6374 2e0a 0a20 2020 2020 2020 203a  ject...        :
+00028410: 7061 7261 6d20 6973 5f70 6c75 6767 6564  param is_plugged
+00028420: 3a20 7468 6520 7374 6174 652c 206c 696e  : the state, lin
+00028430: 6b65 6420 6f72 206e 6f74 2c20 6f66 2074  ked or not, of t
+00028440: 6865 2070 6c75 6773 2e0a 2020 2020 2020  he plugs..      
+00028450: 2020 3a72 6574 7572 6e73 3a20 6120 6469    :returns: a di
+00028460: 6374 696f 6e61 7279 2077 6974 6820 7265  ctionary with re
+00028470: 7175 6972 656d 656e 742c 206f 7574 7075  quirement, outpu
+00028480: 7473 2061 6e64 2069 6e68 6572 6974 616e  ts and inheritan
+00028490: 6365 5f64 6963 742e 0a20 2020 2020 2020  ce_dict..       
+000284a0: 2022 2222 0a20 2020 2020 2020 2023 2055   """.        # U
+000284b0: 7369 6e67 2074 6865 2069 6e68 6572 6974  sing the inherit
+000284c0: 616e 6365 2074 6f20 5072 6f63 6573 734d  ance to ProcessM
+000284d0: 4941 2063 6c61 7373 2c20 6c69 7374 5f6f  IA class, list_o
+000284e0: 7574 7075 7473 206d 6574 686f 640a 2020  utputs method.  
+000284f0: 2020 2020 2020 7375 7065 7228 5465 6d70        super(Temp
+00028500: 6c61 7465 4672 6f6d 5465 6d70 6c61 7465  lateFromTemplate
+00028510: 466c 6f77 2c20 7365 6c66 292e 6c69 7374  Flow, self).list
+00028520: 5f6f 7574 7075 7473 2829 0a0a 2020 2020  _outputs()..    
+00028530: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00028540: 7375 6666 6978 3a0a 2020 2020 2020 2020  suffix:.        
+00028550: 2020 2020 7375 6666 6978 203d 204e 6f6e      suffix = Non
+00028560: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+00028570: 2020 2020 2020 2020 2020 2020 7375 6666              suff
+00028580: 6978 203d 2073 656c 662e 7375 6666 6978  ix = self.suffix
+00028590: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+000285a0: 2073 656c 662e 6174 6c61 733a 0a20 2020   self.atlas:.   
+000285b0: 2020 2020 2020 2020 2061 746c 6173 203d           atlas =
+000285c0: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+000285d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000285e0: 6174 6c61 7320 3d20 7365 6c66 2e61 746c  atlas = self.atl
+000285f0: 6173 0a0a 2020 2020 2020 2020 6966 206e  as..        if n
+00028600: 6f74 2073 656c 662e 6465 7363 3a0a 2020  ot self.desc:.  
+00028610: 2020 2020 2020 2020 2020 6465 7363 203d            desc =
+00028620: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+00028630: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00028640: 6465 7363 203d 2073 656c 662e 6465 7363  desc = self.desc
+00028650: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00028660: 2073 656c 662e 6c61 6265 6c3a 0a20 2020   self.label:.   
+00028670: 2020 2020 2020 2020 206c 6162 656c 203d           label =
+00028680: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+00028690: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000286a0: 6c61 6265 6c20 3d20 7365 6c66 2e6c 6162  label = self.lab
+000286b0: 656c 0a0a 2020 2020 2020 2020 7465 6d70  el..        temp
+000286c0: 6c61 7465 5f73 7065 6320 3d20 7b0a 2020  late_spec = {.  
+000286d0: 2020 2020 2020 2020 2020 2272 6573 6f6c            "resol
+000286e0: 7574 696f 6e22 3a20 7365 6c66 2e72 6573  ution": self.res
+000286f0: 6f6c 7574 696f 6e2c 0a20 2020 2020 2020  olution,.       
+00028700: 2020 2020 2022 7375 6666 6978 223a 2073       "suffix": s
+00028710: 7566 6669 782c 0a20 2020 2020 2020 2020  uffix,.         
+00028720: 2020 2022 6174 6c61 7322 3a20 6174 6c61     "atlas": atla
+00028730: 732c 0a20 2020 2020 2020 2020 2020 2022  s,.            "
+00028740: 6465 7363 223a 2064 6573 632c 0a20 2020  desc": desc,.   
+00028750: 2020 2020 2020 2020 2022 6c61 6265 6c22           "label"
+00028760: 3a20 6c61 6265 6c2c 0a20 2020 2020 2020  : label,.       
+00028770: 207d 0a0a 2020 2020 2020 2020 7470 6c5f   }..        tpl_
+00028780: 7461 7267 6574 5f70 6174 6820 3d20 6765  target_path = ge
+00028790: 745f 7465 6d70 6c61 7465 2873 656c 662e  t_template(self.
+000287a0: 696e 5f74 656d 706c 6174 652c 202a 2a74  in_template, **t
+000287b0: 656d 706c 6174 655f 7370 6563 290a 2020  emplate_spec).  
+000287c0: 2020 2020 2020 6966 206e 6f74 2074 706c        if not tpl
+000287d0: 5f74 6172 6765 745f 7061 7468 3a0a 2020  _target_path:.  
+000287e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000287f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028800: 2022 5c6e 5465 6d70 6c61 7465 4672 6f6d   "\nTemplateFrom
+00028810: 5465 6d70 6c61 7465 466c 6f77 2062 7269  TemplateFlow bri
+00028820: 636b 3a20 436f 756c 6420 6e6f 7420 6669  ck: Could not fi
+00028830: 6e64 2074 656d 706c 6174 6520 220a 2020  nd template ".  
+00028840: 2020 2020 2020 2020 2020 2020 2020 2227                "'
+00028850: 7b30 7d27 2077 6974 6820 7370 6563 733d  {0}' with specs=
+00028860: 7b31 7d2e 2050 6c65 6173 6520 7265 7669  {1}. Please revi
+00028870: 7365 2079 6f75 7220 7465 6d70 6c61 7465  se your template
+00028880: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00028890: 2020 2022 6172 6775 6d65 6e74 2e22 2e66     "argument.".f
+000288a0: 6f72 6d61 7428 7365 6c66 2e69 6e5f 7465  ormat(self.in_te
+000288b0: 6d70 6c61 7465 2c20 7465 6d70 6c61 7465  mplate, template
+000288c0: 5f73 7065 6329 0a20 2020 2020 2020 2020  _spec).         
+000288d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000288e0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+000288f0: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
+00028900: 706c 5f74 6172 6765 745f 7061 7468 2c20  pl_target_path, 
+00028910: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+00028920: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+00028930: 2020 2020 2020 2020 2020 225c 6e54 656d            "\nTem
+00028940: 706c 6174 6546 726f 6d54 656d 706c 6174  plateFromTemplat
+00028950: 6546 6c6f 7720 6272 6963 6b3a 2054 6865  eFlow brick: The
+00028960: 2061 7661 696c 6162 6c65 2074 656d 706c   available templ
+00028970: 6174 6520 220a 2020 2020 2020 2020 2020  ate ".          
+00028980: 2020 2020 2020 226d 6f64 6966 6965 7273        "modifiers
+00028990: 2028 7b30 7d29 2064 6964 206e 6f74 2073   ({0}) did not s
+000289a0: 656c 6563 7420 6120 756e 6971 7565 2074  elect a unique t
+000289b0: 656d 706c 6174 6520 2867 6f74 2022 0a20  emplate (got ". 
+000289c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000289d0: 277b 317d 2729 2e20 506c 6561 7365 2072  '{1}'). Please r
+000289e0: 6576 6973 6520 796f 7572 2074 656d 706c  evise your templ
+000289f0: 6174 6520 220a 2020 2020 2020 2020 2020  ate ".          
+00028a00: 2020 2020 2020 2261 7267 756d 656e 742e        "argument.
+00028a10: 222e 666f 726d 6174 2873 656c 662e 696e  ".format(self.in
+00028a20: 5f74 656d 706c 6174 652c 2074 656d 706c  _template, templ
+00028a30: 6174 655f 7370 6563 290a 2020 2020 2020  ate_spec).      
+00028a40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00028a50: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00028a60: 2020 2020 7365 6c66 2e6f 7574 7075 7473      self.outputs
+00028a70: 5b22 7465 6d70 6c61 7465 225d 203d 2073  ["template"] = s
+00028a80: 7472 2874 706c 5f74 6172 6765 745f 7061  tr(tpl_target_pa
+00028a90: 7468 290a 0a20 2020 2020 2020 2023 2052  th)..        # R
+00028aa0: 6574 7572 6e20 7468 6520 7265 7175 6972  eturn the requir
+00028ab0: 656d 656e 742c 206f 7574 7075 7473 2061  ement, outputs a
+00028ac0: 6e64 2069 6e68 6572 6974 616e 6365 5f64  nd inheritance_d
+00028ad0: 6963 740a 2020 2020 2020 2020 7265 7475  ict.        retu
+00028ae0: 726e 2073 656c 662e 6d61 6b65 5f69 6e69  rn self.make_ini
+00028af0: 7452 6573 756c 7428 290a 0a20 2020 2064  tResult()..    d
+00028b00: 6566 2072 756e 5f70 726f 6365 7373 5f6d  ef run_process_m
+00028b10: 6961 2873 656c 6629 3a0a 2020 2020 2020  ia(self):.      
+00028b20: 2020 2222 2244 6564 6963 6174 6564 2074    """Dedicated t
+00028b30: 6f20 7468 6520 7072 6f63 6573 7320 6c61  o the process la
+00028b40: 756e 6368 2073 7465 7020 6f66 2074 6865  unch step of the
+00028b50: 2062 7269 636b 2e22 2222 0a20 2020 2020   brick.""".     
+00028b60: 2020 2073 7570 6572 2854 656d 706c 6174     super(Templat
+00028b70: 6546 726f 6d54 656d 706c 6174 6546 6c6f  eFromTemplateFlo
+00028b80: 772c 2073 656c 6629 2e72 756e 5f70 726f  w, self).run_pro
+00028b90: 6365 7373 5f6d 6961 2829 0a0a 0a63 6c61  cess_mia()...cla
+00028ba0: 7373 2054 6872 6573 686f 6c64 2850 726f  ss Threshold(Pro
+00028bb0: 6365 7373 4d49 4129 3a0a 2020 2020 2222  cessMIA):.    ""
+00028bc0: 220a 2020 2020 2a4d 616b 6573 2061 2062  ".    *Makes a b
+00028bd0: 696e 6172 7920 6d61 736b 2069 6d61 6765  inary mask image
+00028be0: 2061 7420 6120 6769 7665 6e20 7468 7265   at a given thre
+00028bf0: 7368 6f6c 642a 0a0a 2020 2020 506c 6561  shold*..    Plea
+00028c00: 7365 2c20 7365 6520 7468 6520 636f 6d70  se, see the comp
+00028c10: 6c65 7465 2064 6f63 756d 656e 7461 7469  lete documentati
+00028c20: 6f6e 2066 6f72 2074 6865 0a20 2020 2060  on for the.    `
+00028c30: 5468 7265 7368 6f6c 6420 6272 6963 6b20  Threshold brick 
+00028c40: 696e 2074 6865 206d 6961 5f70 726f 6365  in the mia_proce
+00028c50: 7373 6573 2077 6562 7369 7465 0a20 2020  sses website.   
+00028c60: 203c 6874 7470 733a 2f2f 706f 7075 6c73   <https://populs
+00028c70: 652e 6769 7468 7562 2e69 6f2f 6d69 615f  e.github.io/mia_
+00028c80: 7072 6f63 6573 7365 732f 6874 6d6c 2f64  processes/html/d
+00028c90: 6f63 756d 656e 7461 7469 6f6e 2f62 7269  ocumentation/bri
+00028ca0: 636b 732f 7072 6570 726f 6365 7373 2f6f  cks/preprocess/o
+00028cb0: 7468 6572 2f54 6872 6573 686f 6c64 2e68  ther/Threshold.h
+00028cc0: 746d 6c3e 605f 0a0a 2020 2020 2222 220a  tml>`_..    """.
+00028cd0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00028ce0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00028cf0: 2022 2222 4465 6469 6361 7465 6420 746f   """Dedicated to
+00028d00: 2074 6865 2061 7474 7269 6275 7465 7320   the attributes 
+00028d10: 696e 6974 6961 6c69 7361 7469 6f6e 202f  initialisation /
+00028d20: 2069 6e73 7461 6e74 6961 7469 6f6e 2e0a   instantiation..
+00028d30: 0a20 2020 2020 2020 2054 6865 2069 6e70  .        The inp
+00028d40: 7574 2061 6e64 206f 7574 7075 7420 706c  ut and output pl
+00028d50: 7567 7320 6172 6520 6465 6669 6e65 6420  ugs are defined 
+00028d60: 6865 7265 2e20 5468 6520 7370 6563 6961  here. The specia
+00028d70: 6c0a 2020 2020 2020 2020 2773 656c 662e  l.        'self.
+00028d80: 7265 7175 6972 656d 656e 7427 2061 7474  requirement' att
+00028d90: 7269 6275 7465 2028 6f70 7469 6f6e 616c  ribute (optional
+00028da0: 2920 6973 2075 7365 6420 746f 2064 6566  ) is used to def
+00028db0: 696e 6520 7468 650a 2020 2020 2020 2020  ine the.        
+00028dc0: 7468 6972 642d 7061 7274 7920 7072 6f64  third-party prod
+00028dd0: 7563 7473 206e 6563 6573 7361 7279 2066  ucts necessary f
+00028de0: 6f72 2074 6865 2072 756e 6e69 6e67 206f  or the running o
+00028df0: 6620 7468 6520 6272 6963 6b2e 0a20 2020  f the brick..   
+00028e00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00028e10: 2023 2049 6e69 7469 616c 6973 6174 696f   # Initialisatio
+00028e20: 6e20 6f66 2074 6865 206f 626a 6563 7473  n of the objects
+00028e30: 206e 6565 6465 6420 666f 7220 7468 6520   needed for the 
+00028e40: 6c61 756e 6368 206f 6620 7468 6520 6272  launch of the br
+00028e50: 6963 6b0a 2020 2020 2020 2020 7375 7065  ick.        supe
+00028e60: 7228 5468 7265 7368 6f6c 642c 2073 656c  r(Threshold, sel
+00028e70: 6629 2e5f 5f69 6e69 745f 5f28 290a 0a20  f).__init__().. 
+00028e80: 2020 2020 2020 2023 2054 6869 7264 2070         # Third p
+00028e90: 6172 7479 2073 6f66 7477 6172 6573 2072  arty softwares r
+00028ea0: 6571 7569 7265 6420 666f 7220 7468 6520  equired for the 
+00028eb0: 6578 6563 7574 696f 6e20 6f66 2074 6865  execution of the
+00028ec0: 2062 7269 636b 0a20 2020 2020 2020 2073   brick.        s
+00028ed0: 656c 662e 7265 7175 6972 656d 656e 7420  elf.requirement 
+00028ee0: 3d20 5b5d 0a0a 2020 2020 2020 2020 2320  = []..        # 
+00028ef0: 496e 7075 7473 2064 6573 6372 6970 7469  Inputs descripti
+00028f00: 6f6e 0a20 2020 2020 2020 2069 6e5f 6669  on.        in_fi
+00028f10: 6c65 735f 6465 7363 203d 2028 0a20 2020  les_desc = (.   
+00028f20: 2020 2020 2020 2020 2022 4120 6c69 7374           "A list
+00028f30: 206f 6620 6974 656d 7320 7769 7468 2073   of items with s
+00028f40: 7472 696e 6720 656c 656d 656e 7473 2063  tring elements c
+00028f50: 6f72 7265 7370 6f6e 6469 6e67 2022 0a20  orresponding ". 
+00028f60: 2020 2020 2020 2020 2020 2022 746f 2065             "to e
+00028f70: 7869 7374 696e 6720 7061 7468 2066 696c  xisting path fil
+00028f80: 6573 2e22 0a20 2020 2020 2020 2029 0a20  es.".        ). 
+00028f90: 2020 2020 2020 2074 6872 6573 686f 6c64         threshold
+00028fa0: 5f64 6573 6320 3d20 280a 2020 2020 2020  _desc = (.      
+00028fb0: 2020 2020 2020 2256 616c 7565 2066 6f72        "Value for
+00028fc0: 2074 6865 2061 7070 6c69 6564 2074 6872   the applied thr
+00028fd0: 6573 686f 6c64 2028 6120 666c 6f61 7420  eshold (a float 
+00028fe0: 6265 7477 6565 6e20 3020 616e 6420 3129  between 0 and 1)
+00028ff0: 2e22 0a20 2020 2020 2020 2029 0a20 2020  .".        ).   
+00029000: 2020 2020 2047 4d5f 6669 6c74 6572 696e       GM_filterin
+00029010: 675f 6465 7363 203d 2028 0a20 2020 2020  g_desc = (.     
+00029020: 2020 2020 2020 2022 4669 6c74 6572 696e         "Filterin
+00029030: 6720 2862 6173 6564 206f 6e20 7468 6520  g (based on the 
+00029040: 6b65 7977 6f72 6420 6331 2920 746f 206b  keyword c1) to k
+00029050: 6565 7020 6f6e 6c79 2022 0a20 2020 2020  eep only ".     
+00029060: 2020 2020 2020 2022 6772 6579 206d 6174         "grey mat
+00029070: 7465 7220 696d 6167 6573 2028 6120 626f  ter images (a bo
+00029080: 6f6c 6561 6e29 220a 2020 2020 2020 2020  olean)".        
+00029090: 290a 2020 2020 2020 2020 7375 6666 6978  ).        suffix
+000290a0: 5f64 6573 6320 3d20 2253 7566 6669 7820  _desc = "Suffix 
+000290b0: 6f66 2074 6865 206f 7574 7075 7420 696d  of the output im
+000290c0: 6167 6520 2861 2073 7472 696e 6729 2e22  age (a string)."
+000290d0: 0a20 2020 2020 2020 2070 7265 6669 785f  .        prefix_
+000290e0: 6465 7363 203d 2022 5072 6566 6978 206f  desc = "Prefix o
+000290f0: 6620 7468 6520 6f75 7470 7574 2069 6d61  f the output ima
+00029100: 6765 2028 6120 7374 7269 6e67 292e 220a  ge (a string).".
+00029110: 0a20 2020 2020 2020 2023 204f 7574 7075  .        # Outpu
+00029120: 7473 2064 6573 6372 6970 7469 6f6e 0a20  ts description. 
+00029130: 2020 2020 2020 206f 7574 5f66 696c 6573         out_files
+00029140: 5f64 6573 6320 3d20 280a 2020 2020 2020  _desc = (.      
+00029150: 2020 2020 2020 2250 6174 6820 6f66 2074        "Path of t
+00029160: 6865 2073 6361 6e20 6166 7465 7220 6170  he scan after ap
+00029170: 706c 6963 6174 696f 6e20 6f66 2074 6865  plication of the
+00029180: 2074 6872 6573 686f 6c64 2022 0a20 2020   threshold ".   
+00029190: 2020 2020 2020 2020 2022 2861 2070 6174           "(a pat
+000291a0: 686c 696b 6520 6f62 6a65 6374 206f 7220  hlike object or 
+000291b0: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
+000291c0: 696e 6720 6120 6669 6c65 2c20 6f72 2022  ing a file, or "
+000291d0: 0a20 2020 2020 2020 2020 2020 2022 6120  .            "a 
+000291e0: 6c69 7374 206f 6620 7061 7468 6c69 6b65  list of pathlike
+000291f0: 206f 626a 6563 7473 206f 7220 7374 7269   objects or stri
+00029200: 6e67 7320 7265 7072 6573 656e 7469 6e67  ngs representing
+00029210: 2061 2022 0a20 2020 2020 2020 2020 2020   a ".           
+00029220: 2022 6669 6c65 292e 220a 2020 2020 2020   "file).".      
+00029230: 2020 290a 0a20 2020 2020 2020 2023 2049    )..        # I
+00029240: 6e70 7574 7320 7472 6169 7473 0a20 2020  nputs traits.   
+00029250: 2020 2020 2073 656c 662e 6164 645f 7472       self.add_tr
+00029260: 6169 7428 0a20 2020 2020 2020 2020 2020  ait(.           
+00029270: 2022 696e 5f66 696c 6573 222c 0a20 2020   "in_files",.   
+00029280: 2020 2020 2020 2020 2049 6e70 7574 4d75           InputMu
+00029290: 6c74 6950 6174 6828 0a20 2020 2020 2020  ltiPath(.       
+000292a0: 2020 2020 2020 2020 2074 7261 6974 732e           traits.
+000292b0: 4569 7468 6572 2846 696c 6528 292c 2074  Either(File(), t
+000292c0: 7261 6974 732e 4c69 7374 2846 696c 6528  raits.List(File(
+000292d0: 2929 292c 0a20 2020 2020 2020 2020 2020  ))),.           
+000292e0: 2020 2020 206f 7574 7075 743d 4661 6c73       output=Fals
+000292f0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00029300: 2020 2064 6573 633d 696e 5f66 696c 6573     desc=in_files
+00029310: 5f64 6573 632c 0a20 2020 2020 2020 2020  _desc,.         
+00029320: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+00029330: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00029340: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00029350: 2020 2020 2022 474d 5f66 696c 7465 7269       "GM_filteri
+00029360: 6e67 222c 0a20 2020 2020 2020 2020 2020  ng",.           
+00029370: 2074 7261 6974 732e 426f 6f6c 280a 2020   traits.Bool(.  
+00029380: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00029390: 6661 756c 745f 7661 6c75 653d 5472 7565  fault_value=True
+000293a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000293b0: 2020 6f75 7470 7574 3d46 616c 7365 2c0a    output=False,.
+000293c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000293d0: 6f70 7469 6f6e 616c 3d54 7275 652c 0a20  optional=True,. 
+000293e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000293f0: 6573 633d 474d 5f66 696c 7465 7269 6e67  esc=GM_filtering
+00029400: 5f64 6573 632c 0a20 2020 2020 2020 2020  _desc,.         
+00029410: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+00029420: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00029430: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00029440: 2020 2020 2022 7072 6566 6978 222c 0a20       "prefix",. 
+00029450: 2020 2020 2020 2020 2020 2074 7261 6974             trait
+00029460: 732e 5374 7269 6e67 2822 222c 206f 7574  s.String("", out
+00029470: 7075 743d 4661 6c73 652c 206f 7074 696f  put=False, optio
+00029480: 6e61 6c3d 5472 7565 2c20 6465 7363 3d70  nal=True, desc=p
+00029490: 7265 6669 785f 6465 7363 292c 0a20 2020  refix_desc),.   
+000294a0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+000294b0: 7365 6c66 2e61 6464 5f74 7261 6974 280a  self.add_trait(.
+000294c0: 2020 2020 2020 2020 2020 2020 2273 7566              "suf
+000294d0: 6669 7822 2c0a 2020 2020 2020 2020 2020  fix",.          
+000294e0: 2020 7472 6169 7473 2e53 7472 696e 6728    traits.String(
+000294f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029500: 2022 5f30 3032 222c 206f 7574 7075 743d   "_002", output=
+00029510: 4661 6c73 652c 206f 7074 696f 6e61 6c3d  False, optional=
+00029520: 5472 7565 2c20 6465 7363 3d73 7566 6669  True, desc=suffi
+00029530: 785f 6465 7363 0a20 2020 2020 2020 2020  x_desc.         
+00029540: 2020 2029 2c0a 2020 2020 2020 2020 290a     ),.        ).
+00029550: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00029560: 645f 7472 6169 7428 0a20 2020 2020 2020  d_trait(.       
+00029570: 2020 2020 2022 7468 7265 7368 6f6c 6422       "threshold"
+00029580: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
+00029590: 6169 7473 2e52 616e 6765 280a 2020 2020  aits.Range(.    
+000295a0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+000295b0: 653d 302e 332c 0a20 2020 2020 2020 2020  e=0.3,.         
+000295c0: 2020 2020 2020 206c 6f77 3d30 2e30 2c0a         low=0.0,.
+000295d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000295e0: 6869 6768 3d31 2e30 2c0a 2020 2020 2020  high=1.0,.      
+000295f0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00029600: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00029610: 2020 2020 2020 2020 6f70 7469 6f6e 616c          optional
+00029620: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+00029630: 2020 2020 2020 2064 6573 633d 7468 7265         desc=thre
+00029640: 7368 6f6c 645f 6465 7363 2c0a 2020 2020  shold_desc,.    
+00029650: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00029660: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00029670: 4f75 7470 7574 7320 7472 6169 7473 0a20  Outputs traits. 
+00029680: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+00029690: 7472 6169 7428 0a20 2020 2020 2020 2020  trait(.         
+000296a0: 2020 2022 6f75 745f 6669 6c65 7322 2c0a     "out_files",.
+000296b0: 2020 2020 2020 2020 2020 2020 4f75 7470              Outp
+000296c0: 7574 4d75 6c74 6950 6174 6828 4669 6c65  utMultiPath(File
+000296d0: 2829 2c20 6f75 7470 7574 3d54 7275 652c  (), output=True,
+000296e0: 2064 6573 633d 6f75 745f 6669 6c65 735f   desc=out_files_
+000296f0: 6465 7363 292c 0a20 2020 2020 2020 2029  desc),.        )
+00029700: 0a0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+00029710: 6e69 745f 6465 6661 756c 745f 7472 6169  nit_default_trai
+00029720: 7473 2829 0a0a 2020 2020 6465 6620 5f6e  ts()..    def _n
+00029730: 616d 6573 4669 6c74 6572 2873 656c 6629  amesFilter(self)
+00029740: 3a0a 2020 2020 2020 2020 2222 2246 696c  :.        """Fil
+00029750: 7465 7269 6e67 206f 6620 696e 5f66 696c  tering of in_fil
+00029760: 6573 2069 6e70 7574 2070 6172 616d 6574  es input paramet
+00029770: 6572 2069 6e20 6f72 6465 7220 746f 206b  er in order to k
+00029780: 6565 7020 6f6e 6c79 2047 4d2e 0a0a 2020  eep only GM...  
+00029790: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+000297a0: 474d 2069 6d61 6765 7320 2863 6f6e 7461  GM images (conta
+000297b0: 696e 696e 6720 2263 3122 2069 6e20 7468  ining "c1" in th
+000297c0: 6520 6669 7273 7420 3520 6368 6172 6163  e first 5 charac
+000297d0: 7465 7273 290a 2020 2020 2020 2020 2222  ters).        ""
+000297e0: 220a 2020 2020 2020 2020 6669 6c65 7320  ".        files 
+000297f0: 3d20 5b5d 0a0a 2020 2020 2020 2020 666f  = []..        fo
+00029800: 7220 6669 6c65 5f6e 616d 6520 696e 2073  r file_name in s
+00029810: 656c 662e 696e 5f66 696c 6573 3a0a 2020  elf.in_files:.  
+00029820: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00029830: 6e73 7461 6e63 6528 6669 6c65 5f6e 616d  nstance(file_nam
+00029840: 652c 2028 6c69 7374 2c20 5472 6169 744c  e, (list, TraitL
+00029850: 6973 744f 626a 6563 7429 293a 0a20 2020  istObject)):.   
+00029860: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00029870: 655f 6e61 6d65 203d 2066 696c 655f 6e61  e_name = file_na
+00029880: 6d65 5b30 5d0a 0a20 2020 2020 2020 2020  me[0]..         
+00029890: 2020 2023 2054 616b 6520 7468 6520 6669     # Take the fi
+000298a0: 7273 7420 3520 6368 6172 6163 7465 7273  rst 5 characters
+000298b0: 2069 6e20 7468 6520 6361 7365 2069 6620   in the case if 
+000298c0: 7468 6520 474d 2077 6173 2070 726f 6365  the GM was proce
+000298d0: 7373 6564 0a20 2020 2020 2020 2020 2020  ssed.           
+000298e0: 2023 2065 782e 206e 6f72 6d61 6c69 7361   # ex. normalisa
+000298f0: 7469 6f6e 203d 2077 6331 2c20 6e6f 726d  tion = wc1, norm
+00029900: 616c 6973 6174 696f 6e20 7468 656e 2073  alisation then s
+00029910: 6d6f 6f74 6820 3d20 7377 6331 202e 2e2e  mooth = swc1 ...
+00029920: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+00029930: 6869 7320 6973 206e 6f74 2074 6865 2063  his is not the c
+00029940: 6c65 616e 6572 2077 6179 202e 2e2e 2066  leaner way ... f
+00029950: 6f72 2065 7861 6d70 6c65 2069 6e20 7468  or example in th
+00029960: 6520 6361 7365 206f 6620 610a 2020 2020  e case of a.    
+00029970: 2020 2020 2020 2020 2320 6669 6c65 206e          # file n
+00029980: 616d 6520 696e 636c 7564 696e 6720 6063  ame including `c
+00029990: 3160 2069 6e20 7468 6520 6669 7273 7420  1` in the first 
+000299a0: 3520 6368 6172 6163 7465 7273 2066 6f72  5 characters for
+000299b0: 2061 6e6f 7468 6572 0a20 2020 2020 2020   another.       
+000299c0: 2020 2020 2023 2072 6561 736f 6e20 2860       # reason (`
+000299d0: 6331 6020 696e 2050 6174 6965 6e74 4e61  c1` in PatientNa
+000299e0: 6d65 2c20 6574 632e 292e 0a20 2020 2020  me, etc.)..     
+000299f0: 2020 2020 2020 2023 2046 6958 4d45 3a20         # FiXME: 
+00029a00: 7768 6174 2063 616e 2077 6520 646f 2074  what can we do t
+00029a10: 6f20 6265 2063 6c65 616e 6572 3f0a 2020  o be cleaner?.  
+00029a20: 2020 2020 2020 2020 2020 6966 2022 6331            if "c1
+00029a30: 2220 696e 206f 732e 7061 7468 2e62 6173  " in os.path.bas
+00029a40: 656e 616d 6528 6f73 2e70 6174 682e 6e6f  ename(os.path.no
+00029a50: 726d 7061 7468 2866 696c 655f 6e61 6d65  rmpath(file_name
+00029a60: 2929 5b3a 355d 3a0a 2020 2020 2020 2020  ))[:5]:.        
+00029a70: 2020 2020 2020 2020 6669 6c65 732e 6170          files.ap
+00029a80: 7065 6e64 2866 696c 655f 6e61 6d65 290a  pend(file_name).
+00029a90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00029aa0: 6669 6c65 730a 0a20 2020 2064 6566 206c  files..    def l
+00029ab0: 6973 745f 6f75 7470 7574 7328 7365 6c66  ist_outputs(self
+00029ac0: 2c20 6973 5f70 6c75 6767 6564 3d4e 6f6e  , is_plugged=Non
+00029ad0: 6529 3a0a 2020 2020 2020 2020 2222 2244  e):.        """D
+00029ae0: 6564 6963 6174 6564 2074 6f20 7468 6520  edicated to the 
+00029af0: 696e 6974 6961 6c69 7361 7469 6f6e 2073  initialisation s
+00029b00: 7465 7020 6f66 2074 6865 2062 7269 636b  tep of the brick
+00029b10: 2e0a 0a20 2020 2020 2020 2054 6865 206d  ...        The m
+00029b20: 6169 6e20 6f62 6a65 6374 6976 6520 6f66  ain objective of
+00029b30: 2074 6869 7320 6d65 7468 6f64 2069 7320   this method is 
+00029b40: 746f 2070 726f 6475 6365 2074 6865 206f  to produce the o
+00029b50: 7574 7075 7473 206f 6620 7468 650a 2020  utputs of the.  
+00029b60: 2020 2020 2020 6272 6963 6b73 2028 7365        bricks (se
+00029b70: 6c66 2e6f 7574 7075 7473 2920 616e 6420  lf.outputs) and 
+00029b80: 7468 6520 6173 736f 6369 6174 6564 2074  the associated t
+00029b90: 6167 7320 2873 656c 662e 696e 6865 7269  ags (self.inheri
+00029ba0: 7461 6e63 655f 6469 6329 2c0a 2020 2020  tance_dic),.    
+00029bb0: 2020 2020 6966 2064 6566 696e 6564 2068      if defined h
+00029bc0: 6572 652e 2054 6f20 776f 726b 2070 726f  ere. To work pro
+00029bd0: 7065 726c 7920 7468 6973 206d 6574 686f  perly this metho
+00029be0: 6420 6d75 7374 2072 6574 7572 6e0a 2020  d must return.  
+00029bf0: 2020 2020 2020 7365 6c66 2e6d 616b 655f        self.make_
+00029c00: 696e 6974 5265 7375 6c74 2829 206f 626a  initResult() obj
+00029c10: 6563 742e 0a0a 2020 2020 2020 2020 3a70  ect...        :p
+00029c20: 6172 616d 2069 735f 706c 7567 6765 643a  aram is_plugged:
+00029c30: 2074 6865 2073 7461 7465 2c20 6c69 6e6b   the state, link
+00029c40: 6564 206f 7220 6e6f 742c 206f 6620 7468  ed or not, of th
+00029c50: 6520 706c 7567 732e 0a20 2020 2020 2020  e plugs..       
+00029c60: 203a 7265 7475 726e 733a 2061 2064 6963   :returns: a dic
+00029c70: 7469 6f6e 6172 7920 7769 7468 2072 6571  tionary with req
+00029c80: 7569 7265 6d65 6e74 2c20 6f75 7470 7574  uirement, output
+00029c90: 7320 616e 6420 696e 6865 7269 7461 6e63  s and inheritanc
+00029ca0: 655f 6469 6374 2e0a 2020 2020 2020 2020  e_dict..        
+00029cb0: 2222 220a 2020 2020 2020 2020 2320 5573  """.        # Us
+00029cc0: 696e 6720 7468 6520 696e 6865 7269 7461  ing the inherita
+00029cd0: 6e63 6520 746f 2050 726f 6365 7373 4d49  nce to ProcessMI
+00029ce0: 4120 636c 6173 732c 206c 6973 745f 6f75  A class, list_ou
+00029cf0: 7470 7574 7320 6d65 7468 6f64 0a20 2020  tputs method.   
+00029d00: 2020 2020 2073 7570 6572 2854 6872 6573       super(Thres
+00029d10: 686f 6c64 2c20 7365 6c66 292e 6c69 7374  hold, self).list
+00029d20: 5f6f 7574 7075 7473 2829 0a0a 2020 2020  _outputs()..    
+00029d30: 2020 2020 2320 4f75 7470 7574 7320 6465      # Outputs de
+00029d40: 6669 6e69 7469 6f6e 0a20 2020 2020 2020  finition.       
+00029d50: 2069 6620 7365 6c66 2e69 6e5f 6669 6c65   if self.in_file
+00029d60: 7320 213d 2055 6e64 6566 696e 6564 2061  s != Undefined a
+00029d70: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+00029d80: 2073 656c 662e 7468 7265 7368 6f6c 6420   self.threshold 
+00029d90: 616e 6420 7365 6c66 2e74 6872 6573 686f  and self.thresho
+00029da0: 6c64 2021 3d20 556e 6465 6669 6e65 640a  ld != Undefined.
+00029db0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00029dc0: 2020 2020 2020 2069 6620 7365 6c66 2e47         if self.G
+00029dd0: 4d5f 6669 6c74 6572 696e 6720 6973 2054  M_filtering is T
+00029de0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+00029df0: 2020 2020 2066 696c 6573 5f6e 616d 6520       files_name 
+00029e00: 3d20 7365 6c66 2e5f 6e61 6d65 7346 696c  = self._namesFil
+00029e10: 7465 7228 290a 0a20 2020 2020 2020 2020  ter()..         
+00029e20: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00029e30: 2020 2020 2020 2020 2066 696c 6573 5f6e           files_n
+00029e40: 616d 6520 3d20 7365 6c66 2e69 6e5f 6669  ame = self.in_fi
+00029e50: 6c65 730a 0a20 2020 2020 2020 2020 2020  les..           
+00029e60: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00029e70: 2020 2020 2020 286e 6f74 2073 656c 662e        (not self.
+00029e80: 7375 6666 6978 290a 2020 2020 2020 2020  suffix).        
+00029e90: 2020 2020 2020 2020 6f72 2028 7365 6c66          or (self
+00029ea0: 2e73 7566 6669 782e 6973 7370 6163 6528  .suffix.isspace(
+00029eb0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00029ec0: 2020 206f 7220 7365 6c66 2e73 7566 6669     or self.suffi
+00029ed0: 7820 696e 205b 556e 6465 6669 6e65 642c  x in [Undefined,
+00029ee0: 2022 3c75 6e64 6566 696e 6564 3e22 5d0a   "<undefined>"].
+00029ef0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+00029f00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00029f10: 656c 662e 7375 6666 6978 203d 2022 2022  elf.suffix = " "
+00029f20: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00029f30: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00029f40: 2020 2028 6e6f 7420 7365 6c66 2e70 7265     (not self.pre
+00029f50: 6669 7829 0a20 2020 2020 2020 2020 2020  fix).           
+00029f60: 2020 2020 206f 7220 2873 656c 662e 7072       or (self.pr
+00029f70: 6566 6978 2e69 7373 7061 6365 2829 290a  efix.isspace()).
+00029f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f90: 6f72 2028 7365 6c66 2e70 7265 6669 7820  or (self.prefix 
+00029fa0: 696e 205b 556e 6465 6669 6e65 642c 2022  in [Undefined, "
+00029fb0: 3c75 6e64 6566 696e 6564 3e22 5d29 0a20  <undefined>"]). 
+00029fc0: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+00029fd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00029fe0: 6c66 2e70 7265 6669 7820 3d20 2220 220a  lf.prefix = " ".
+00029ff0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+0002a000: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+0002a010: 2020 2020 666c 6167 203d 2054 7275 6520      flag = True 
+0002a020: 2023 2049 6620 4661 6c73 652c 2073 7566   # If False, suf
+0002a030: 2f70 7265 6620 6368 6563 6b20 7769 6c6c  /pref check will
+0002a040: 206e 6f74 2062 6520 7065 7266 6f72 6d65   not be performe
+0002a050: 6420 6c61 7465 720a 2020 2020 2020 2020  d later.        
+0002a060: 2020 2020 7265 7476 616c 203d 204e 6f6e      retval = Non
+0002a070: 650a 0a20 2020 2020 2020 2020 2020 2066  e..            f
+0002a080: 6f72 2066 696c 655f 6e61 6d65 3120 696e  or file_name1 in
+0002a090: 2066 696c 6573 5f6e 616d 653a 0a20 2020   files_name:.   
+0002a0a0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0002a0b0: 6964 5f65 7874 2c20 696e 5f65 7874 2c20  id_ext, in_ext, 
+0002a0c0: 6669 6c65 4e61 6d65 203d 2063 6865 636b  fileName = check
+0002a0d0: 4669 6c65 4578 7428 6669 6c65 5f6e 616d  FileExt(file_nam
+0002a0e0: 6531 2c20 4558 5429 0a0a 2020 2020 2020  e1, EXT)..      
+0002a0f0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0002a100: 2076 616c 6964 5f65 7874 3a0a 2020 2020   valid_ext:.    
+0002a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a120: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0002a130: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0002a140: 5c6e 5468 7265 7368 6f6c 6420 6272 6963  \nThreshold bric
+0002a150: 6b3a 2054 6865 2069 6e70 7574 2069 6d61  k: The input ima
+0002a160: 6765 2066 6f72 6d61 7420 6973 206e 6f74  ge format is not
+0002a170: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0002a180: 2020 2020 2020 2020 2020 2022 7265 636f             "reco
+0002a190: 676e 697a 6564 2e2e 2e21 220a 2020 2020  gnized...!".    
+0002a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002a1c0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0002a1d0: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0002a1e0: 682c 205f 203d 206f 732e 7061 7468 2e73  h, _ = os.path.s
+0002a1f0: 706c 6974 2866 696c 655f 6e61 6d65 3129  plit(file_name1)
+0002a200: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002a210: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+0002a220: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002a230: 7375 6666 6978 203d 3d20 2220 220a 2020  suffix == " ".  
+0002a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a250: 2020 616e 6420 7365 6c66 2e70 7265 6669    and self.prefi
+0002a260: 7820 3d3d 2022 2022 0a20 2020 2020 2020  x == " ".       
+0002a270: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0002a280: 2070 6174 6820 3d3d 2073 656c 662e 6f75   path == self.ou
+0002a290: 7470 7574 5f64 6972 6563 746f 7279 0a20  tput_directory. 
+0002a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2b0: 2020 2061 6e64 2066 6c61 6720 6973 2054     and flag is T
+0002a2c0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0002a2d0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0002a2e0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+0002a2f0: 2051 4d65 7373 6167 6542 6f78 2829 0a20   QMessageBox(). 
+0002a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a310: 2020 206d 7367 2e73 6574 4963 6f6e 2851     msg.setIcon(Q
+0002a320: 4d65 7373 6167 6542 6f78 2e57 6172 6e69  MessageBox.Warni
+0002a330: 6e67 290a 2020 2020 2020 2020 2020 2020  ng).            
+0002a340: 2020 2020 2020 2020 6d73 672e 7365 7457          msg.setW
+0002a350: 696e 646f 7754 6974 6c65 280a 2020 2020  indowTitle(.    
+0002a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a370: 2020 2020 226d 6961 5f70 726f 6365 7373      "mia_process
+0002a380: 6573 202d 2054 6872 6573 686f 6c64 2062  es - Threshold b
+0002a390: 7269 636b 2057 6172 6e69 6e67 2122 0a20  rick Warning!". 
+0002a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a3b0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0002a3c0: 2020 2020 2020 2020 206d 7367 2e73 6574           msg.set
+0002a3d0: 5465 7874 280a 2020 2020 2020 2020 2020  Text(.          
+0002a3e0: 2020 2020 2020 2020 2020 2020 2020 2253                "S
+0002a3f0: 7566 6669 7820 616e 6420 7072 6566 6978  uffix and prefix
+0002a400: 2069 6e70 7574 2070 6172 616d 6574 6572   input parameter
+0002a410: 7320 6172 6520 6e6f 7420 220a 2020 2020  s are not ".    
+0002a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a430: 2020 2020 2264 6566 696e 6564 206f 7220      "defined or 
+0002a440: 636f 6e73 6973 7420 6f6e 6c79 206f 6620  consist only of 
+0002a450: 6f6e 6520 6f72 206d 6f72 6520 7768 6974  one or more whit
+0002a460: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+0002a470: 2020 2020 2020 2020 2020 2020 2273 7061              "spa
+0002a480: 6365 732e 5c6e 5468 6520 7b30 7d20 696e  ces.\nThe {0} in
+0002a490: 7075 7420 7061 7261 6d65 7465 7220 7769  put parameter wi
+0002a4a0: 6c6c 2062 6520 220a 2020 2020 2020 2020  ll be ".        
+0002a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4c0: 226f 7665 7277 7269 7474 656e 202e 2e2e  "overwritten ...
+0002a4d0: 5c6e 2059 6573 206f 7220 220a 2020 2020  \n Yes or ".    
+0002a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4f0: 2020 2020 2241 626f 7274 3f22 2e66 6f72      "Abort?".for
+0002a500: 6d61 7428 6669 6c65 5f6e 616d 6531 290a  mat(file_name1).
+0002a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a520: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0002a530: 2020 2020 2020 2020 2020 6d73 672e 7365            msg.se
+0002a540: 7453 7461 6e64 6172 6442 7574 746f 6e73  tStandardButtons
+0002a550: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002a560: 2020 2020 2020 2020 2020 514d 6573 7361            QMessa
+0002a570: 6765 426f 782e 5965 730a 2020 2020 2020  geBox.Yes.      
+0002a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a590: 2020 7c20 514d 6573 7361 6765 426f 782e    | QMessageBox.
+0002a5a0: 5965 7354 6f41 6c6c 0a20 2020 2020 2020  YesToAll.       
+0002a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a5c0: 207c 2051 4d65 7373 6167 6542 6f78 2e41   | QMessageBox.A
+0002a5d0: 626f 7274 0a20 2020 2020 2020 2020 2020  bort.           
+0002a5e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0002a5f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002a600: 6574 7661 6c20 3d20 6d73 672e 6578 6563  etval = msg.exec
+0002a610: 5f28 290a 0a20 2020 2020 2020 2020 2020  _()..           
+0002a620: 2020 2020 2020 2020 2069 6620 7265 7476           if retv
+0002a630: 616c 2021 3d20 514d 6573 7361 6765 426f  al != QMessageBo
+0002a640: 782e 4162 6f72 743a 0a20 2020 2020 2020  x.Abort:.       
+0002a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a660: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+0002a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a680: 2020 2020 225c 6e54 6872 6573 686f 6c64      "\nThreshold
+0002a690: 2062 7269 636b 2077 6172 6e69 6e67 3a20   brick warning: 
+0002a6a0: 7468 6520 6f75 745f 6669 6c65 7320 6f75  the out_files ou
+0002a6b0: 7470 7574 2022 0a20 2020 2020 2020 2020  tput ".         
+0002a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a6d0: 2020 2022 7061 7261 6d65 7465 7220 6973     "parameter is
+0002a6e0: 2074 6865 2073 616d 6520 6173 2074 6865   the same as the
+0002a6f0: 2069 6e5f 6669 6c65 7320 696e 7075 7420   in_files input 
+0002a700: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002a710: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+0002a720: 6172 616d 6574 6572 2028 7375 6666 6978  arameter (suffix
+0002a730: 2061 6e64 2070 7265 6669 7820 6172 6520   and prefix are 
+0002a740: 6e6f 7420 6465 6669 6e65 6429 3a22 0a20  not defined):". 
+0002a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a760: 2020 2020 2020 2020 2020 2022 5c6e 7b30             "\n{0
+0002a770: 7d20 7769 6c6c 2062 6520 6f76 6572 7772  } will be overwr
+0002a780: 6974 6564 202e 2e2e 222e 666f 726d 6174  ited ...".format
+0002a790: 2866 696c 655f 6e61 6d65 3129 0a20 2020  (file_name1).   
+0002a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a7b0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0002a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a7d0: 6966 2072 6574 7661 6c20 3d3d 2051 4d65  if retval == QMe
+0002a7e0: 7373 6167 6542 6f78 2e59 6573 546f 416c  ssageBox.YesToAl
+0002a7f0: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
+0002a800: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002a810: 6c61 6720 3d20 4661 6c73 650a 2020 2020  lag = False.    
+0002a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a830: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+0002a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a850: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0002a860: 5c6e 5468 7265 7368 6f6c 6420 6272 6963  \nThreshold bric
+0002a870: 6b3a 2059 6573 546f 416c 6c20 7365 6c65  k: YesToAll sele
+0002a880: 6374 6564 3a20 656e 6420 6f66 2022 0a20  cted: end of ". 
+0002a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0002a8b0: 6f76 6572 7772 6974 6520 6368 6563 6b73  overwrite checks
+0002a8c0: 206f 6e20 696e 7075 7420 696d 6167 6573   on input images
+0002a8d0: 202e 2e2e 220a 2020 2020 2020 2020 2020   ...".          
+0002a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0002a900: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a920: 2020 2020 2020 6669 6c65 735f 6e61 6d65        files_name
+0002a930: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0002a940: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0002a950: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0002a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a970: 2022 5c6e 5468 7265 7368 6f6c 6420 6272   "\nThreshold br
+0002a980: 6963 6b20 4162 6f72 7465 642e 2050 6c65  ick Aborted. Ple
+0002a990: 6173 6520 6368 6563 6b20 796f 7572 2022  ase check your "
+0002a9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a9b0: 2020 2020 2020 2020 2020 2020 2022 696e               "in
+0002a9c0: 7075 7420 7061 7261 6d65 7465 7273 202e  put parameters .
+0002a9d0: 2e2e 220a 2020 2020 2020 2020 2020 2020  ..".            
+0002a9e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0002a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa00: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0002aa10: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0002aa20: 6c65 732e 6170 7065 6e64 280a 2020 2020  les.append(.    
+0002aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa40: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
+0002aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa60: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
+0002aa70: 745f 6469 7265 6374 6f72 792c 0a20 2020  t_directory,.   
+0002aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aa90: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+0002aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aab0: 2020 2073 656c 662e 7072 6566 6978 2e73     self.prefix.s
+0002aac0: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+0002aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aae0: 2020 202b 2066 696c 654e 616d 650a 2020     + fileName.  
+0002aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab00: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
+0002ab10: 2e73 7566 6669 782e 7374 7269 7028 290a  .suffix.strip().
+0002ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab30: 2020 2020 2020 2020 2020 2020 2b20 222e              + ".
+0002ab40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002ab50: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0002ab60: 696e 5f65 7874 0a20 2020 2020 2020 2020  in_ext.         
+0002ab70: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0002ab80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002ab90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0002aba0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0002abb0: 2020 2020 2020 2069 6620 6669 6c65 733a         if files:
+0002abc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002abd0: 2073 656c 662e 6f75 7470 7574 735b 226f   self.outputs["o
+0002abe0: 7574 5f66 696c 6573 225d 203d 2066 696c  ut_files"] = fil
+0002abf0: 6573 0a20 2020 2020 2020 2020 2020 2065  es.            e
+0002ac00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002ac10: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+0002ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac30: 222d 2054 6872 6573 686f 6c64 2062 7269  "- Threshold bri
+0002ac40: 636b 3a20 5468 6572 6520 7761 7320 6e6f  ck: There was no
+0002ac50: 206f 7574 7075 7420 6669 6c65 2064 6564   output file ded
+0002ac60: 7563 7465 6420 220a 2020 2020 2020 2020  ucted ".        
+0002ac70: 2020 2020 2020 2020 2020 2020 2264 7572              "dur
+0002ac80: 696e 6720 696e 6974 6961 6c69 7361 7469  ing initialisati
+0002ac90: 6f6e 2e20 506c 6561 7365 2063 6865 636b  on. Please check
+0002aca0: 2074 6865 2069 6e70 7574 2022 0a20 2020   the input ".   
+0002acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002acc0: 2022 7061 7261 6d65 7465 7273 2e2e 2e21   "parameters...!
+0002acd0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002ace0: 2020 290a 0a20 2020 2020 2020 2023 2074    )..        # t
+0002acf0: 6167 7320 696e 6865 7269 7461 6e63 6520  ags inheritance 
+0002ad00: 286f 7074 696f 6e61 6c29 0a20 2020 2020  (optional).     
+0002ad10: 2020 2069 6620 7365 6c66 2e6f 7574 7075     if self.outpu
+0002ad20: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0002ad30: 666f 7220 6b65 792c 2076 616c 2069 6e20  for key, val in 
+0002ad40: 7365 6c66 2e6f 7574 7075 7473 2e69 7465  self.outputs.ite
+0002ad50: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0002ad60: 2020 2020 2020 6966 206b 6579 203d 3d20        if key == 
+0002ad70: 226f 7574 5f66 696c 6573 223a 0a20 2020  "out_files":.   
+0002ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad90: 2066 6f72 2069 6e5f 7661 6c2c 206f 7574   for in_val, out
+0002ada0: 5f76 616c 2069 6e20 7a69 7028 6669 6c65  _val in zip(file
+0002adb0: 735f 6e61 6d65 2c20 7661 6c29 3a0a 2020  s_name, val):.  
+0002adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002add0: 2020 2020 2020 5f2c 2066 696c 654f 7661        _, fileOva
+0002ade0: 6c20 3d20 6f73 2e70 6174 682e 7370 6c69  l = os.path.spli
+0002adf0: 7428 6f75 745f 7661 6c29 0a20 2020 2020  t(out_val).     
+0002ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae10: 2020 2066 696c 654f 7661 6c5f 6e6f 5f65     fileOval_no_e
+0002ae20: 7874 2c20 5f20 3d20 6f73 2e70 6174 682e  xt, _ = os.path.
+0002ae30: 7370 6c69 7465 7874 2866 696c 654f 7661  splitext(fileOva
+0002ae40: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+0002ae50: 2020 2020 2020 2020 2020 205f 2c20 6669             _, fi
+0002ae60: 6c65 4976 616c 203d 206f 732e 7061 7468  leIval = os.path
+0002ae70: 2e73 706c 6974 2869 6e5f 7661 6c29 0a20  .split(in_val). 
+0002ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae90: 2020 2020 2020 2066 696c 6549 7661 6c5f         fileIval_
+0002aea0: 6e6f 5f65 7874 2c20 5f20 3d20 6f73 2e70  no_ext, _ = os.p
+0002aeb0: 6174 682e 7370 6c69 7465 7874 2866 696c  ath.splitext(fil
+0002aec0: 6549 7661 6c29 0a0a 2020 2020 2020 2020  eIval)..        
+0002aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aee0: 6966 2028 7365 6c66 2e70 7265 6669 7829  if (self.prefix)
+0002aef0: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
+0002af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002af10: 2020 2066 696c 654f 7661 6c5f 6e6f 5f65     fileOval_no_e
+0002af20: 7874 2e73 7461 7274 7377 6974 6828 7365  xt.startswith(se
+0002af30: 6c66 2e70 7265 6669 7829 0a20 2020 2020  lf.prefix).     
+0002af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002af50: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0002af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002af70: 2020 2320 666d 743a 206f 6666 0a20 2020    # fmt: off.   
+0002af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002af90: 2020 2020 2020 2020 2066 696c 654f 7661           fileOva
+0002afa0: 6c5f 6e6f 5f65 7874 203d 2066 696c 654f  l_no_ext = fileO
+0002afb0: 7661 6c5f 6e6f 5f65 7874 5b0a 2020 2020  val_no_ext[.    
+0002afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002afd0: 2020 2020 2020 2020 2020 2020 6c65 6e28              len(
+0002afe0: 7365 6c66 2e70 7265 6669 7829 3a5d 0a20  self.prefix):]. 
+0002aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b000: 2020 2020 2020 2020 2020 2023 2066 6d74             # fmt
+0002b010: 3a20 6f6e 0a0a 2020 2020 2020 2020 2020  : on..          
+0002b020: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002b030: 2028 7365 6c66 2e73 7566 6669 7829 2061   (self.suffix) a
+0002b040: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+0002b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b060: 2066 696c 654f 7661 6c5f 6e6f 5f65 7874   fileOval_no_ext
+0002b070: 2e65 6e64 7377 6974 6828 7365 6c66 2e73  .endswith(self.s
+0002b080: 7566 6669 7829 0a20 2020 2020 2020 2020  uffix).         
+0002b090: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0002b0a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b0b0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0002b0c0: 6c65 4f76 616c 5f6e 6f5f 6578 7420 3d20  leOval_no_ext = 
+0002b0d0: 6669 6c65 4f76 616c 5f6e 6f5f 6578 745b  fileOval_no_ext[
+0002b0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b100: 203a 202d 6c65 6e28 7365 6c66 2e73 7566   : -len(self.suf
+0002b110: 6669 7829 0a20 2020 2020 2020 2020 2020  fix).           
+0002b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b130: 205d 0a0a 2020 2020 2020 2020 2020 2020   ]..            
+0002b140: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0002b150: 696c 654f 7661 6c5f 6e6f 5f65 7874 203d  ileOval_no_ext =
+0002b160: 3d20 6669 6c65 4976 616c 5f6e 6f5f 6578  = fileIval_no_ex
+0002b170: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0002b180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002b190: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0002b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1b0: 2020 2020 6765 745f 6462 4669 656c 6456      get_dbFieldV
+0002b1c0: 616c 7565 280a 2020 2020 2020 2020 2020  alue(.          
+0002b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1e0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0002b1f0: 726f 6a65 6374 2c20 696e 5f76 616c 2c20  roject, in_val, 
+0002b200: 2250 6174 6965 6e74 4e61 6d65 220a 2020  "PatientName".  
+0002b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b220: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0002b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b250: 6973 204e 6f6e 650a 2020 2020 2020 2020  is None.        
+0002b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b270: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0002b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b290: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+0002b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b2c0: 2020 225c 6e54 6872 6573 686f 6c64 2062    "\nThreshold b
+0002b2d0: 7269 636b 3a5c 6e54 6865 2027 5061 7469  rick:\nThe 'Pati
+0002b2e0: 656e 744e 616d 6527 220a 2020 2020 2020  entName'".      
+0002b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b300: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+0002b310: 7461 6720 636f 756c 6420 6e6f 7420 6265  tag could not be
+0002b320: 2061 6464 6564 2074 6f20 7468 6520 220a   added to the ".
+0002b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b350: 2020 2020 2264 6174 6162 6173 6520 666f      "database fo
+0002b360: 7220 7468 6520 277b 7d27 2070 6172 616d  r the '{}' param
+0002b370: 6574 6572 2e20 5468 6973 2022 0a20 2020  eter. This ".   
+0002b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b3a0: 2022 6361 6e20 6c65 6164 2074 6f20 6120   "can lead to a 
+0002b3b0: 7375 6273 6571 7565 6e74 2069 7373 7565  subsequent issue
+0002b3c0: 2064 7572 696e 6720 220a 2020 2020 2020   during ".      
+0002b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b3e0: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+0002b3f0: 6e69 7469 616c 697a 6174 696f 6e21 215c  nitialization!!\
+0002b400: 6e22 2e66 6f72 6d61 7428 6f75 745f 7661  n".format(out_va
+0002b410: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+0002b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b430: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0002b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b450: 2020 7365 6c66 2e74 6167 735f 696e 6865    self.tags_inhe
+0002b460: 7269 7461 6e63 6528 0a20 2020 2020 2020  ritance(.       
+0002b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b480: 2020 2020 2020 2020 2069 6e5f 7661 6c2c           in_val,
+0002b490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b4b0: 206f 7574 5f76 616c 2c0a 2020 2020 2020   out_val,.      
+0002b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b4d0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0002b4e0: 2023 2052 6574 7572 6e20 7468 6520 7265   # Return the re
+0002b4f0: 7175 6972 656d 656e 742c 206f 7574 7075  quirement, outpu
+0002b500: 7473 2061 6e64 2069 6e68 6572 6974 616e  ts and inheritan
+0002b510: 6365 5f64 6963 740a 2020 2020 2020 2020  ce_dict.        
+0002b520: 7265 7475 726e 2073 656c 662e 6d61 6b65  return self.make
+0002b530: 5f69 6e69 7452 6573 756c 7428 290a 0a20  _initResult().. 
+0002b540: 2020 2064 6566 2072 756e 5f70 726f 6365     def run_proce
+0002b550: 7373 5f6d 6961 2873 656c 6629 3a0a 2020  ss_mia(self):.  
+0002b560: 2020 2020 2020 2222 2244 6564 6963 6174        """Dedicat
+0002b570: 6564 2074 6f20 7468 6520 7072 6f63 6573  ed to the proces
+0002b580: 7320 6c61 756e 6368 2073 7465 7020 6f66  s launch step of
+0002b590: 2074 6865 2062 7269 636b 2e22 2222 0a20   the brick.""". 
+0002b5a0: 2020 2020 2020 2073 7570 6572 2854 6872         super(Thr
+0002b5b0: 6573 686f 6c64 2c20 7365 6c66 292e 7275  eshold, self).ru
+0002b5c0: 6e5f 7072 6f63 6573 735f 6d69 6128 290a  n_process_mia().
+0002b5d0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0002b5e0: 2e47 4d5f 6669 6c74 6572 696e 6720 6973  .GM_filtering is
+0002b5f0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+0002b600: 2020 2066 696c 6573 5f6e 616d 6520 3d20     files_name = 
+0002b610: 7365 6c66 2e5f 6e61 6d65 7346 696c 7465  self._namesFilte
+0002b620: 7228 290a 0a20 2020 2020 2020 2065 6c73  r()..        els
+0002b630: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+0002b640: 696c 6573 5f6e 616d 6520 3d20 7365 6c66  iles_name = self
+0002b650: 2e69 6e5f 6669 6c65 730a 0a20 2020 2020  .in_files..     
+0002b660: 2020 2066 6f72 2066 696c 655f 6e61 6d65     for file_name
+0002b670: 2069 6e20 6669 6c65 735f 6e61 6d65 3a0a   in files_name:.
+0002b680: 2020 2020 2020 2020 2020 2020 2320 496d              # Im
+0002b690: 6167 6520 7072 6f63 6573 7369 6e67 0a20  age processing. 
+0002b6a0: 2020 2020 2020 2020 2020 2069 6d67 5f66             img_f
+0002b6b0: 696e 616c 203d 2074 6872 6573 686f 6c64  inal = threshold
+0002b6c0: 2866 696c 655f 6e61 6d65 2c20 7365 6c66  (file_name, self
+0002b6d0: 2e74 6872 6573 686f 6c64 290a 0a20 2020  .threshold)..   
+0002b6e0: 2020 2020 2020 2020 2023 2049 6d61 6765           # Image
+0002b6f0: 2073 6176 650a 2020 2020 2020 2020 2020   save.          
+0002b700: 2020 5f2c 2066 696c 655f 6e61 6d65 203d    _, file_name =
+0002b710: 206f 732e 7061 7468 2e73 706c 6974 2866   os.path.split(f
+0002b720: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+0002b730: 2020 2020 2020 6669 6c65 5f6e 616d 655f        file_name_
+0002b740: 6e6f 5f65 7874 2c20 6669 6c65 5f65 7874  no_ext, file_ext
+0002b750: 656e 7369 6f6e 203d 206f 732e 7061 7468  ension = os.path
+0002b760: 2e73 706c 6974 6578 7428 6669 6c65 5f6e  .splitext(file_n
+0002b770: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+0002b780: 206f 7574 5f66 696c 6520 3d20 6f73 2e70   out_file = os.p
+0002b790: 6174 682e 6a6f 696e 280a 2020 2020 2020  ath.join(.      
+0002b7a0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+0002b7b0: 7574 7075 745f 6469 7265 6374 6f72 792c  utput_directory,
+0002b7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b7d0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0002b7e0: 2020 2020 2020 2073 656c 662e 7072 6566         self.pref
+0002b7f0: 6978 2e73 7472 6970 2829 0a20 2020 2020  ix.strip().     
+0002b800: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0002b810: 2066 696c 655f 6e61 6d65 5f6e 6f5f 6578   file_name_no_ex
+0002b820: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0002b830: 2020 2020 2020 2b20 7365 6c66 2e73 7566        + self.suf
+0002b840: 6669 782e 7374 7269 7028 290a 2020 2020  fix.strip().    
+0002b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b860: 2b20 6669 6c65 5f65 7874 656e 7369 6f6e  + file_extension
+0002b870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b880: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0002b890: 290a 2020 2020 2020 2020 2020 2020 6e69  ).            ni
+0002b8a0: 622e 7361 7665 2869 6d67 5f66 696e 616c  b.save(img_final
+0002b8b0: 2c20 6f75 745f 6669 6c65 290a 0a0a 6465  , out_file)...de
+0002b8c0: 6620 6172 7469 6661 6374 5f6d 6173 6b28  f artifact_mask(
+0002b8d0: 696d 6461 7461 2c20 6169 7264 6174 612c  imdata, airdata,
+0002b8e0: 2064 6973 7461 6e63 652c 207a 7363 6f72   distance, zscor
+0002b8f0: 653d 3130 2e30 293a 0a20 2020 2022 2222  e=10.0):.    """
+0002b900: 436f 6d70 7574 6573 2061 206d 6173 6b20  Computes a mask 
+0002b910: 6f66 2061 7274 6966 6163 7473 2066 6f75  of artifacts fou
+0002b920: 6e64 2069 6e20 7468 6520 6169 7220 7265  nd in the air re
+0002b930: 6769 6f6e 2222 220a 0a20 2020 2069 6620  gion"""..    if 
+0002b940: 6e6f 7420 6e70 2e69 7373 7562 6474 7970  not np.issubdtyp
+0002b950: 6528 6169 7264 6174 612e 6474 7970 652c  e(airdata.dtype,
+0002b960: 206e 702e 696e 7465 6765 7229 3a0a 2020   np.integer):.  
+0002b970: 2020 2020 2020 6169 7264 6174 615b 6169        airdata[ai
+0002b980: 7264 6174 6120 3c20 302e 3935 5d20 3d20  rdata < 0.95] = 
+0002b990: 300a 2020 2020 2020 2020 6169 7264 6174  0.        airdat
+0002b9a0: 615b 6169 7264 6174 6120 3e20 302e 305d  a[airdata > 0.0]
+0002b9b0: 203d 2031 0a0a 2020 2020 6267 5f69 6d67   = 1..    bg_img
+0002b9c0: 203d 2069 6d64 6174 6120 2a20 6169 7264   = imdata * aird
+0002b9d0: 6174 610a 2020 2020 6966 206e 702e 7375  ata.    if np.su
+0002b9e0: 6d28 2862 675f 696d 6720 3e20 3029 2e61  m((bg_img > 0).a
+0002b9f0: 7374 7970 6528 6e70 2e75 696e 7438 2929  stype(np.uint8))
+0002ba00: 203c 2031 3030 3a0a 2020 2020 2020 2020   < 100:.        
+0002ba10: 7265 7475 726e 206e 702e 7a65 726f 735f  return np.zeros_
+0002ba20: 6c69 6b65 2861 6972 6461 7461 290a 0a20  like(airdata).. 
+0002ba30: 2020 2023 2046 696e 6420 7468 6520 6261     # Find the ba
+0002ba40: 636b 6772 6f75 6e64 2074 6872 6573 686f  ckground thresho
+0002ba50: 6c64 2028 7468 6520 6d6f 7374 2066 7265  ld (the most fre
+0002ba60: 7175 656e 746c 7920 6f63 6375 7272 696e  quently occurrin
+0002ba70: 6720 7661 6c75 650a 2020 2020 2320 6578  g value.    # ex
+0002ba80: 636c 7564 696e 6720 3029 0a20 2020 2062  cluding 0).    b
+0002ba90: 675f 6c6f 6361 7469 6f6e 203d 206e 702e  g_location = np.
+0002baa0: 6d65 6469 616e 2862 675f 696d 675b 6267  median(bg_img[bg
+0002bab0: 5f69 6d67 203e 2030 5d29 0a20 2020 2062  _img > 0]).    b
+0002bac0: 675f 7370 7265 6164 203d 206d 6164 2862  g_spread = mad(b
+0002bad0: 675f 696d 675b 6267 5f69 6d67 203e 2030  g_img[bg_img > 0
+0002bae0: 5d29 0a20 2020 2062 675f 696d 675b 6267  ]).    bg_img[bg
+0002baf0: 5f69 6d67 203e 2030 5d20 2d3d 2062 675f  _img > 0] -= bg_
+0002bb00: 6c6f 6361 7469 6f6e 0a20 2020 2023 2054  location.    # T
+0002bb10: 4f44 4f3a 2054 6869 7320 6973 2067 656e  ODO: This is gen
+0002bb20: 6572 6174 696e 6720 6120 5275 6e74 696d  erating a Runtim
+0002bb30: 6557 6172 6e69 6e67 3a20 6469 7669 6465  eWarning: divide
+0002bb40: 2062 7920 7a65 726f 2077 6974 6820 4d52   by zero with MR
+0002bb50: 4951 4320 616e 6174 0a20 2020 2062 675f  IQC anat.    bg_
+0002bb60: 696d 675b 6267 5f69 6d67 203e 2030 5d20  img[bg_img > 0] 
+0002bb70: 2f3d 2062 675f 7370 7265 6164 0a0a 2020  /= bg_spread..  
+0002bb80: 2020 2320 4170 706c 7920 7468 6973 2074    # Apply this t
+0002bb90: 6872 6573 686f 6c64 2074 6f20 7468 6520  hreshold to the 
+0002bba0: 6261 636b 6772 6f75 6e64 2076 6f78 656c  background voxel
+0002bbb0: 7320 746f 2069 6465 6e74 6966 7920 766f  s to identify vo
+0002bbc0: 7865 6c73 0a20 2020 2023 2063 6f6e 7472  xels.    # contr
+0002bbd0: 6962 7574 696e 6720 6172 7469 6661 6374  ibuting artifact
+0002bbe0: 732e 0a20 2020 2071 6931 5f69 6d67 203d  s..    qi1_img =
+0002bbf0: 206e 702e 7a65 726f 735f 6c69 6b65 2862   np.zeros_like(b
+0002bc00: 675f 696d 6729 0a20 2020 2071 6931 5f69  g_img).    qi1_i
+0002bc10: 6d67 5b62 675f 696d 6720 3e20 7a73 636f  mg[bg_img > zsco
+0002bc20: 7265 5d20 3d20 310a 2020 2020 7169 315f  re] = 1.    qi1_
+0002bc30: 696d 675b 6469 7374 616e 6365 203c 2030  img[distance < 0
+0002bc40: 2e31 305d 203d 2030 0a0a 2020 2020 2320  .10] = 0..    # 
+0002bc50: 4372 6561 7465 2061 2073 7472 7563 7475  Create a structu
+0002bc60: 7261 6c20 656c 656d 656e 7420 746f 2062  ral element to b
+0002bc70: 6520 7573 6564 2069 6e20 616e 206f 7065  e used in an ope
+0002bc80: 6e69 6e67 206f 7065 7261 7469 6f6e 2e0a  ning operation..
+0002bc90: 2020 2020 7374 7275 6320 3d20 7369 6d2e      struc = sim.
+0002bca0: 6765 6e65 7261 7465 5f62 696e 6172 795f  generate_binary_
+0002bcb0: 7374 7275 6374 7572 6528 332c 2031 290a  structure(3, 1).
+0002bcc0: 2020 2020 7169 315f 696d 6720 3d20 7369      qi1_img = si
+0002bcd0: 6d2e 6269 6e61 7279 5f6f 7065 6e69 6e67  m.binary_opening
+0002bce0: 2871 6931 5f69 6d67 2c20 7374 7275 6329  (qi1_img, struc)
+0002bcf0: 2e61 7374 7970 6528 6e70 2e75 696e 7438  .astype(np.uint8
+0002bd00: 290a 2020 2020 7169 315f 696d 675b 6169  ).    qi1_img[ai
+0002bd10: 7264 6174 6120 3c3d 2030 5d20 3d20 300a  rdata <= 0] = 0.
+0002bd20: 0a20 2020 2072 6574 7572 6e20 7169 315f  .    return qi1_
+0002bd30: 696d 670a 0a0a 6465 6620 6973 5f6f 7574  img...def is_out
+0002bd40: 6c69 6572 2870 6f69 6e74 732c 2074 6872  lier(points, thr
+0002bd50: 6573 683d 332e 3529 3a0a 2020 2020 2222  esh=3.5):.    ""
+0002bd60: 220a 2020 2020 2a52 6574 7572 6e73 2061  ".    *Returns a
+0002bd70: 2062 6f6f 6c65 616e 2061 7272 6179 2077   boolean array w
+0002bd80: 6974 6820 5472 7565 2069 6620 706f 696e  ith True if poin
+0002bd90: 7473 2061 7265 206f 7574 6c69 6572 7320  ts are outliers 
+0002bda0: 616e 6420 4661 6c73 650a 2020 2020 6f74  and False.    ot
+0002bdb0: 6865 7277 6973 652a 0a0a 2020 2020 3a70  herwise*..    :p
+0002bdc0: 6172 616d 206e 7061 7272 6179 2070 6f69  aram nparray poi
+0002bdd0: 6e74 733a 2061 6e20 6e75 6d6f 6273 6572  nts: an numobser
+0002bde0: 7661 7469 6f6e 7320 6279 206e 756d 6469  vations by numdi
+0002bdf0: 6d65 6e73 696f 6e73 206e 756d 7079 2061  mensions numpy a
+0002be00: 7272 6179 0a20 2020 2020 2020 206f 6620  rray.        of 
+0002be10: 6f62 7365 7276 6174 696f 6e73 0a20 2020  observations.   
+0002be20: 203a 7061 7261 6d20 666c 6f61 7420 7468   :param float th
+0002be30: 7265 7368 3a20 7468 6520 6d6f 6469 6669  resh: the modifi
+0002be40: 6564 207a 2d73 636f 7265 2074 6f20 7573  ed z-score to us
+0002be50: 6520 6173 2061 2074 6872 6573 686f 6c64  e as a threshold
+0002be60: 2e0a 2020 2020 2020 2020 4f62 7365 7276  ..        Observ
+0002be70: 6174 696f 6e73 2077 6974 6820 6120 6d6f  ations with a mo
+0002be80: 6469 6669 6564 207a 2d73 636f 7265 2028  dified z-score (
+0002be90: 6261 7365 6420 6f6e 2074 6865 206d 6564  based on the med
+0002bea0: 6961 6e20 6162 736f 6c75 7465 0a20 2020  ian absolute.   
+0002beb0: 2020 2020 2064 6576 6961 7469 6f6e 2920       deviation) 
+0002bec0: 6772 6561 7465 7220 7468 616e 2074 6869  greater than thi
+0002bed0: 7320 7661 6c75 6520 7769 6c6c 2062 6520  s value will be 
+0002bee0: 636c 6173 7369 6669 6564 2061 7320 6f75  classified as ou
+0002bef0: 746c 6965 7273 2e0a 2020 2020 3a72 6574  tliers..    :ret
+0002bf00: 7572 6e3a 2041 2062 6f6c 6561 6e20 6d61  urn: A bolean ma
+0002bf10: 736b 2c20 6f66 2073 697a 6520 6e75 6d6f  sk, of size numo
+0002bf20: 6273 6572 7661 7469 6f6e 732d 6c65 6e67  bservations-leng
+0002bf30: 7468 2061 7272 6179 2e0a 0a20 2020 202e  th array...    .
+0002bf40: 2e20 6e6f 7465 3a3a 0a20 2020 2020 2020  . note::.       
+0002bf50: 2042 6f72 6973 2049 676c 6577 6963 7a20   Boris Iglewicz 
+0002bf60: 616e 6420 4461 7669 6420 486f 6167 6c69  and David Hoagli
+0002bf70: 6e20 2831 3939 3329 2c20 2256 6f6c 756d  n (1993), "Volum
+0002bf80: 6520 3136 3a20 486f 7720 746f 2044 6574  e 16: How to Det
+0002bf90: 6563 7420 616e 640a 2020 2020 2020 2020  ect and.        
+0002bfa0: 4861 6e64 6c65 204f 7574 6c69 6572 7322  Handle Outliers"
+0002bfb0: 2c20 5468 6520 4153 5143 2042 6173 6963  , The ASQC Basic
+0002bfc0: 2052 6566 6572 656e 6365 7320 696e 2051   References in Q
+0002bfd0: 7561 6c69 7479 2043 6f6e 7472 6f6c 3a0a  uality Control:.
+0002bfe0: 2020 2020 2020 2020 5374 6174 6973 7469          Statisti
+0002bff0: 6361 6c20 5465 6368 6e69 7175 6573 2c20  cal Techniques, 
+0002c000: 4564 7761 7264 2046 2e20 4d79 6b79 746b  Edward F. Mykytk
+0002c010: 612c 2050 682e 442e 2c20 4564 6974 6f72  a, Ph.D., Editor
+0002c020: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
+0002c030: 206c 656e 2870 6f69 6e74 732e 7368 6170   len(points.shap
+0002c040: 6529 203d 3d20 313a 0a20 2020 2020 2020  e) == 1:.       
+0002c050: 2070 6f69 6e74 7320 3d20 706f 696e 7473   points = points
+0002c060: 5b3a 2c20 4e6f 6e65 5d0a 2020 2020 6d65  [:, None].    me
+0002c070: 6469 616e 203d 206e 702e 6d65 6469 616e  dian = np.median
+0002c080: 2870 6f69 6e74 732c 2061 7869 733d 3029  (points, axis=0)
+0002c090: 0a20 2020 2064 6966 6620 3d20 6e70 2e73  .    diff = np.s
+0002c0a0: 756d 2828 706f 696e 7473 202d 206d 6564  um((points - med
+0002c0b0: 6961 6e29 202a 2a20 322c 2061 7869 733d  ian) ** 2, axis=
+0002c0c0: 2d31 290a 2020 2020 6469 6666 203d 206e  -1).    diff = n
+0002c0d0: 702e 7371 7274 2864 6966 6629 0a20 2020  p.sqrt(diff).   
+0002c0e0: 206d 6564 5f61 6273 5f64 6576 6961 7469   med_abs_deviati
+0002c0f0: 6f6e 203d 206e 702e 6d65 6469 616e 2864  on = np.median(d
+0002c100: 6966 6629 0a0a 2020 2020 6d6f 6469 6669  iff)..    modifi
+0002c110: 6564 5f7a 5f73 636f 7265 203d 2030 2e36  ed_z_score = 0.6
+0002c120: 3734 3520 2a20 6469 6666 202f 206d 6564  745 * diff / med
+0002c130: 5f61 6273 5f64 6576 6961 7469 6f6e 0a0a  _abs_deviation..
+0002c140: 2020 2020 7469 6d65 706f 696e 7473 5f74      timepoints_t
+0002c150: 6f5f 6469 7363 6172 6420 3d20 300a 2020  o_discard = 0.  
+0002c160: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0002c170: 286c 656e 286d 6f64 6966 6965 645f 7a5f  (len(modified_z_
+0002c180: 7363 6f72 6529 293a 0a20 2020 2020 2020  score)):.       
+0002c190: 2069 6620 6d6f 6469 6669 6564 5f7a 5f73   if modified_z_s
+0002c1a0: 636f 7265 5b69 5d20 3c3d 2074 6872 6573  core[i] <= thres
+0002c1b0: 683a 0a20 2020 2020 2020 2020 2020 2062  h:.            b
+0002c1c0: 7265 616b 0a20 2020 2020 2020 2065 6c73  reak.        els
+0002c1d0: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+0002c1e0: 696d 6570 6f69 6e74 735f 746f 5f64 6973  imepoints_to_dis
+0002c1f0: 6361 7264 202b 3d20 310a 0a20 2020 2072  card += 1..    r
+0002c200: 6574 7572 6e20 7469 6d65 706f 696e 7473  eturn timepoints
+0002c210: 5f74 6f5f 6469 7363 6172 640a 0a0a 6465  _to_discard...de
+0002c220: 6620 7468 7265 7368 6f6c 6428 6669 6c65  f threshold(file
+0002c230: 5f6e 616d 652c 2074 6872 6573 6829 3a0a  _name, thresh):.
+0002c240: 2020 2020 2222 220a 2020 2020 4261 7369      """.    Basi
+0002c250: 6320 6d65 7468 6f64 2066 6f72 2069 6d61  c method for ima
+0002c260: 6765 2074 6872 6573 686f 6c64 696e 670a  ge thresholding.
+0002c270: 0a20 2020 203a 7061 7261 6d20 6669 6c65  .    :param file
+0002c280: 5f6e 616d 653a 2049 6d61 6765 2074 6f20  _name: Image to 
+0002c290: 6265 2074 6872 6573 686f 6c64 6564 0a20  be thresholded. 
+0002c2a0: 2020 203a 7061 7261 6d20 7468 7265 7368     :param thresh
+0002c2b0: 3a20 5468 7265 7368 6f6c 6420 7661 6c75  : Threshold valu
+0002c2c0: 6520 2861 2066 6c6f 6174 2062 6574 7765  e (a float betwe
+0002c2d0: 656e 2030 2061 6e64 2031 290a 2020 2020  en 0 and 1).    
+0002c2e0: 3a72 6574 7572 6e73 3a20 496d 6167 6520  :returns: Image 
+0002c2f0: 6166 7465 7220 7468 7265 7368 6f6c 6469  after thresholdi
+0002c300: 6e67 0a20 2020 2022 2222 0a20 2020 2069  ng.    """.    i
+0002c310: 6d67 203d 206e 6962 2e6c 6f61 6428 6669  mg = nib.load(fi
+0002c320: 6c65 5f6e 616d 6529 0a20 2020 2069 6d67  le_name).    img
+0002c330: 5f64 6174 6120 3d20 696d 672e 6765 745f  _data = img.get_
+0002c340: 6664 6174 6128 290a 2020 2020 5f6d 6178  fdata().    _max
+0002c350: 203d 2069 6d67 5f64 6174 612e 6d61 7828   = img_data.max(
+0002c360: 290a 2020 2020 2320 4361 7374 2074 6865  ).    # Cast the
+0002c370: 2074 6872 6573 686f 6c64 6564 2064 6174   thresholded dat
+0002c380: 6120 746f 2074 6865 2073 616d 6520 6461  a to the same da
+0002c390: 7461 2074 7970 6520 6173 2074 6865 2069  ta type as the i
+0002c3a0: 6e70 7574 2064 6174 610a 2020 2020 696d  nput data.    im
+0002c3b0: 675f 7468 7265 7368 203d 2028 696d 675f  g_thresh = (img_
+0002c3c0: 6461 7461 203e 2028 5f6d 6178 202a 2074  data > (_max * t
+0002c3d0: 6872 6573 6829 292e 6173 7479 7065 2869  hresh)).astype(i
+0002c3e0: 6d67 5f64 6174 612e 6474 7970 6529 0a20  mg_data.dtype). 
+0002c3f0: 2020 2069 6d67 5f66 696e 616c 203d 206e     img_final = n
+0002c400: 6962 2e4e 6966 7469 3149 6d61 6765 2869  ib.Nifti1Image(i
+0002c410: 6d67 5f74 6872 6573 682c 2069 6d67 2e61  mg_thresh, img.a
+0002c420: 6666 696e 652c 2069 6d67 2e68 6561 6465  ffine, img.heade
+0002c430: 7229 0a20 2020 2072 6574 7572 6e20 696d  r).    return im
+0002c440: 675f 6669 6e61 6c0a                      g_final.
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/spm/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/spm/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/preprocess/spm/spatial_preprocessing.py` & `mia_processes-2.6.0/mia_processes/bricks/preprocess/spm/spatial_preprocessing.py`

 * *Files 2% similar despite different names*

```diff
@@ -362,20 +362,20 @@
             # in nipype if the mandatory parameters are not yet defined!
             if self.output_directory:
                 self.process.output_directory = self.output_directory
 
             else:
                 print("No output_directory was found...!\n")
 
-            self.outputs[
-                "coregistered_source"
-            ] = self.process._coregistered_source
-            self.outputs[
-                "coregistered_files"
-            ] = self.process._coregistered_files
+            self.outputs["coregistered_source"] = (
+                self.process._coregistered_source
+            )
+            self.outputs["coregistered_files"] = (
+                self.process._coregistered_files
+            )
 
         if self.outputs:
             out_coregsource = []
             out_coregfiles = []
 
             for key, val in self.outputs.items():
                 if key == "coregistered_source":
@@ -536,25 +536,26 @@
         # Initialisation of the objects needed for the launch of the brick
         super(GM_WM_Normalize, self).__init__()
 
         # Third party softwares required for the execution of the brick
         self.requirement = ["spm", "nipype"]
 
         # Inputs description
+        apply_to_files_desc = (
+            "Files to apply transformation to. A list of "
+            "items which are an existing, uncompressed file "
+            "(valid extensions: [.img, .nii, .hdr])."
+        )
+
         deformation_file_desc = (
             "File y_*.nii containing 3 deformation fields "
             "for the deformation in x, y and z dimension "
             "(an uncompressed file; valid extensions in "
             "[.img, .nii, .hdr])."
         )
-        apply_to_files_desc = (
-            "Files to apply transformation to. A list of "
-            "items which are an existing, uncompressed file "
-            "(valid extensions: [.img, .nii, .hdr])."
-        )
 
         in_filter_desc = (
             'One of "GM" (gray matter) or "WM" (white matter) or '
             '"GM & WM" (uses GM and WM; 2 files) or "GM + WM" '
             "(makes GM + WM, then uses the result; 1 file)."
         )
 
@@ -581,33 +582,33 @@
             "string representing a file, or a list of "
             "pathlike objects or strings representing a "
             "file)."
         )
 
         # Inputs traits
         self.add_trait(
-            "deformation_file",
-            ImageFileSPM(
-                output=False, optional=False, desc=deformation_file_desc
-            ),
-        )
-
-        self.add_trait(
             "apply_to_files",
             InputMultiPath(
                 traits.Either(
                     ImageFileSPM(), traits.List(ImageFileSPM()), Undefined
                 ),
                 output=False,
                 optional=False,
                 desc=apply_to_files_desc,
             ),
         )
 
         self.add_trait(
+            "deformation_file",
+            ImageFileSPM(
+                output=False, optional=False, desc=deformation_file_desc
+            ),
+        )
+
+        self.add_trait(
             "in_filter",
             Enum(
                 "GM",
                 "WM",
                 "GM & WM",
                 "GM + WM",
                 output=False,
@@ -1273,17 +1274,17 @@
             self.channel_files
             and self.channel_info
             and self.write_deformation_fields
             and self.tissues
         ):
             self.process.channel_files = self.channel_files
             self.process.channel_info = self.channel_info
-            (
-                self.process.write_deformation_fields
-            ) = self.write_deformation_fields
+            (self.process.write_deformation_fields) = (
+                self.write_deformation_fields
+            )
             self.process.tissues = self.tissues
 
             # The management of self.process.output_directory could be
             # delegated to the
             # populse_mia.user_interface.pipeline_manager.process_mia
             # module. We can't do it at the moment because the
             # sync_process_output_traits() of the
@@ -1869,17 +1870,49 @@
                         pathOval, fileOval = os.path.split(out_val)
                         _, fileIval = os.path.split(in_val)
                         # fmt: off
                         fileOvalNoPref = fileOval[len(self.out_prefix):]
                         # fmt: on
 
                         if fileOvalNoPref == fileIval:
+                            all_tags_to_add = []
+                            # Add the voxel sizes after normalization,
+                            # in database
+                            tag_to_add = dict()
+                            tag_to_add["name"] = "Voxel sizes"
+                            tag_to_add["field_type"] = "list_float"
+                            tag_to_add["description"] = (
+                                "The voxel sizes (x, y & "
+                                "z, in mm) of the written "
+                                "normalised images"
+                            )
+                            tag_to_add["visibility"] = True
+                            tag_to_add["origin"] = "user"
+                            tag_to_add["unit"] = "mm"
+                            tag_to_add["default_value"] = None
+                            tag_to_add["value"] = self.write_voxel_sizes
+                            all_tags_to_add.append(tag_to_add)
+                            # Add the Affine regularization type for
+                            # normalization, in database
+                            tag_to_add = dict()
+                            tag_to_add["name"] = "Affine regularization type"
+                            tag_to_add["field_type"] = "string"
+                            tag_to_add["description"] = (
+                                "Standard space for affine " "registration"
+                            )
+                            tag_to_add["visibility"] = True
+                            tag_to_add["origin"] = "user"
+                            tag_to_add["unit"] = None
+                            tag_to_add["default_value"] = None
+                            tag_to_add["value"] = (
+                                self.affine_regularization_type
+                            ).upper()
+                            all_tags_to_add.append(tag_to_add)
                             self.tags_inheritance(
-                                in_val,
-                                out_val,
+                                in_val, out_val, own_tags=all_tags_to_add
                             )
 
                 if (key == "deformation_field") and (val != Undefined):
                     pathOval, fileOval = os.path.split(val)
                     _, fileIval = os.path.split(self.image_to_align)
                     fileOvalNoPref = fileOval[2:]
 
@@ -1922,17 +1955,17 @@
 
         self.process.bias_regularization = self.bias_regularization
         self.process.bias_fwhm = self.bias_fwhm
 
         if self.jobtype.startswith("est"):
             self.process.tpm = self.tpm
 
-        (
-            self.process.affine_regularization_type
-        ) = self.affine_regularization_type
+        (self.process.affine_regularization_type) = (
+            self.affine_regularization_type
+        )
         self.process.warping_regularization = self.warping_regularization
         self.process.smoothness = self.smoothness
         self.process.sampling_distance = self.sampling_distance
         self.process.write_bounding_box = self.write_bounding_box
         self.process.write_voxel_sizes = self.write_voxel_sizes
         self.process.write_interp = self.write_interp
         self.process.out_prefix = self.out_prefix
@@ -3157,17 +3190,31 @@
 
                         else:
                             # fmt: off
                             fileOvalNoPref = fileOval[len("s"):]
                             # fmt : on
 
                         if fileOvalNoPref == fileIval:
+                            all_tags_to_add = []
+                            # Add the fwhm parameter for smooth, in database
+                            tag_to_add = dict()
+                            tag_to_add["name"] = "FWHM (X, Y, Z) for Smooth"
+                            tag_to_add["field_type"] = "list_float"
+                            tag_to_add["description"] = (
+                                "Full width at half maximum (FWHM) of the "
+                                "Gaussian smoothing kernel in mm"
+                            )
+                            tag_to_add["visibility"] = True
+                            tag_to_add["origin"] = "user"
+                            tag_to_add["unit"] = "mm"
+                            tag_to_add["default_value"] = None
+                            tag_to_add["value"] = self.fwhm
+                            all_tags_to_add.append(tag_to_add)
                             self.tags_inheritance(
-                                in_val,
-                                out_val,
+                                in_val, out_val, own_tags=all_tags_to_add
                             )
         # Return the requirement, outputs and inheritance_dict
         return self.make_initResult()
 
     def run_process_mia(self):
         """Dedicated to the process launch step of the brick."""
         super(Smooth, self).run_process_mia()
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/reports/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/reports/__init__.py`

 * *Files 4% similar despite different names*

```diff
@@ -17,15 +17,17 @@
     AnatIQMs,
     BoldIQMs,
     BoldIQMsPlot,
     CarpetParcellation,
     ComputeDVARS,
     FramewiseDisplacement,
     Mean_stdDev_calc,
+    PlotSignalROI,
     Result_collector,
     Spikes,
 )
 from .reporting import (  # noqa: F401
     ReportAnatMriqc,
+    ReportCO2inhalCvr,
     ReportFuncMriqc,
     ReportGroupMriqc,
 )
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/reports/processes.py` & `mia_processes-2.6.0/mia_processes/bricks/reports/processes.py`

 * *Files 4% similar despite different names*

```diff
@@ -9,14 +9,15 @@
     :Class:
         - AnatIQMs
         - BoldIQMs
         - BoldIQMsPlot
         - CarpetParcellation
         - ComputeDVARS
         - FramewiseDisplacement
+        - PlotSignalROI
         - Mean_stdDev_calc
         - Result_collector
         - Spikes
 
     :Function:
         - art_qi1
         - art_qi2
@@ -92,39 +93,42 @@
 import json
 import os
 import re
 import shutil
 import tempfile
 from math import sqrt
 
-import nibabel as nb
+import matplotlib.pyplot as plt
+import nibabel as nib
 import numpy as np
 import pandas as pd
 import scipy.ndimage as nd
+from nilearn import plotting
+from nilearn.image import resample_to_img
 from nilearn.signal import clean
 from nipy.algorithms.registration import aff2euler, to_matrix44
 
 # nipype import
 from nipype.interfaces.base import (
     File,
     InputMultiPath,
     OutputMultiPath,
+    TraitListObject,
     Undefined,
     traits,
 )
 from nipype.interfaces.spm.base import ImageFileSPM
 from nitime.algorithms import AR_est_YW
 from niworkflows.utils.timeseries import _nifti_timeseries
 from niworkflows.viz.plots import fMRIPlot
 from numpy.polynomial import Legendre
 
 # populse_mia import
 from populse_mia.user_interface.pipeline_manager.process_mia import ProcessMIA
 from scipy.stats import kurtosis  # pylint: disable=E0611
-from skimage.transform import resize
 
 # mia_processes import
 from mia_processes.utils import checkFileExt, get_dbFieldValue
 
 DIETRICH_FACTOR = 0.6551364  # 1.0 / sqrt(2 / (4 - pi))
 FSL_FAST_LABELS = {"csf": 1, "gm": 2, "wm": 3, "bg": 0}
 RAS_AXIS_ORDER = {"x": 0, "y": 1, "z": 2}
@@ -300,23 +304,23 @@
 
     def run_process_mia(self):
         """Dedicated to the process launch step of the brick."""
         super(AnatIQMs, self).run_process_mia()
 
         results_dict = {}
 
-        imdata = nb.load(self.in_ras).get_fdata()
+        imdata = nib.load(self.in_ras).get_fdata()
 
         # Try to load files
         has_in_noinu = True
         if self.in_noinu:
             try:
-                imnii = nb.load(self.in_noinu)
+                imnii = nib.load(self.in_noinu)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_in_noinu = False
                 print("\nError with in_noinu file: ", e)
             else:
                 # Load image corrected for INU
@@ -325,17 +329,17 @@
         else:
             has_in_noinu = False
 
         has_segmentation = True
         if self.segmentation:
             try:
                 # Load binary segmentation from FSL FAST
-                segnii = nb.load(self.segmentation)
+                segnii = nib.load(self.segmentation)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_segmentation = False
                 print("\nError with segmentation file: ", e)
                 pass
             else:
@@ -343,17 +347,17 @@
         else:
             has_segmentation = False
 
         has_airmask = True
         if self.airmask:
             try:
                 # Load binary segmentation from FSL FAST
-                airnii = nb.load(self.airmask)
+                airnii = nib.load(self.airmask)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_airmask = False
                 print("\nError with airmask file: ", e)
                 pass
             else:
@@ -361,17 +365,17 @@
         else:
             has_airmask = False
 
         has_artmask = True
         if self.artmask:
             try:
                 # Load binary segmentation from FSL FAST
-                artnii = nb.load(self.artmask)
+                artnii = nib.load(self.artmask)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_artmask = False
                 print("\nError with artmask file: ", e)
                 pass
             else:
@@ -379,17 +383,17 @@
         else:
             has_artmask = False
 
         has_headmask = True
         if self.headmask:
             try:
                 # Load binary segmentation from FSL FAST
-                headnii = nb.load(self.headmask)
+                headnii = nib.load(self.headmask)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_headmask = False
                 print("\nError with headmask file: ", e)
                 pass
             else:
@@ -397,17 +401,17 @@
         else:
             has_headmask = False
 
         has_rotmask = True
         if self.rotmask:
             try:
                 # Load binary segmentation from FSL FAST
-                rotnii = nb.load(self.rotmask)
+                rotnii = nib.load(self.rotmask)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_rotmask = False
                 print("\nError with rotmask file: ", e)
                 pass
             else:
@@ -417,17 +421,17 @@
 
         has_pvms = True
         if self.rotmask:
             try:
                 # Load Partial Volume Maps (pvms) from FSL FAST
                 pvmniis = []
                 for fname in self.pvms:
-                    pvmniis.append(nb.load(fname))
+                    pvmniis.append(nib.load(fname))
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_pvms = False
                 print("\nError with pvms files: ", e)
                 pass
             else:
@@ -446,17 +450,17 @@
             has_pvms = False
 
         has_mni_tpms = True
         if self.mni_tpms:
             try:
                 mni_tpmsniis = []
                 for fname in self.mni_tpms:
-                    mni_tpmsniis.append(nb.load(fname))
+                    mni_tpmsniis.append(nib.load(fname))
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_mni_tpms = False
                 print("\nError with mni_tpms files: ", e)
                 pass
         else:
@@ -522,15 +526,15 @@
         if has_airmask and has_artmask:
             # Artifacts
             results_dict["qi_1"] = art_qi1(airdata, artdata)
 
         if self.hatmask != Undefined:
             # Artifacts QI2
             results_dict["qi_2"], results_dict["histogram_qi2"] = art_qi2(
-                imdata, nb.load(self.hatmask).get_fdata()
+                imdata, nib.load(self.hatmask).get_fdata()
             )
 
         if has_stats:
             # CJV
             results_dict["cjv"] = cjv(
                 # mu_wm, mu_gm, sigma_wm, sigma_gm
                 stats["wm"]["median"],
@@ -592,15 +596,15 @@
                     imnii.header.get_zooms()[3]
                 )
             except IndexError:
                 pass
 
         if has_segmentation:
             # Bias
-            bias = nb.load(self.in_inu).get_fdata()[segdata > 0]
+            bias = nib.load(self.in_inu).get_fdata()[segdata > 0]
             results_dict["inu"] = {
                 "range": float(
                     np.abs(
                         np.percentile(bias, 95.0) - np.percentile(bias, 5.0)
                     )
                 ),
                 "med": float(np.median(bias)),
@@ -810,26 +814,26 @@
         return self.make_initResult()
 
     def run_process_mia(self):
         """Dedicated to the process launch step of the brick."""
         super(BoldIQMs, self).run_process_mia()
 
         # Get the mean EPI data and get it ready
-        epinii = nb.load(self.in_epi)
+        epinii = nib.load(self.in_epi)
         epidata = np.nan_to_num(epinii.get_fdata())
         epidata = epidata.astype(np.float32)
         epidata[epidata < 0] = 0
 
         # Get EPI data (with mc done) and get it ready
         has_in_hmc = True
         if self.in_hmc:
             try:
-                hmcnii = nb.load(self.in_hmc)
+                hmcnii = nib.load(self.in_hmc)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_in_hmc = False
                 print("\nError with in_hmc file: ", e)
             else:
                 hmcdata = np.nan_to_num(hmcnii.get_fdata())
@@ -838,17 +842,17 @@
         else:
             has_in_hmc = False
 
         # Get EPI data (with mc done) and get it ready
         has_in_mask = True
         if self.in_mask:
             try:
-                msknii = nb.load(self.in_mask)
+                msknii = nib.load(self.in_mask)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_in_mask = False
                 print("\nError with in_mask file: ", e)
             else:
                 mskdata = np.nan_to_num(msknii.get_fdata())
@@ -858,27 +862,28 @@
         else:
             has_in_mask = False
 
         # Get tsnr data and get it ready
         has_in_tsnr = True
         if self.in_tsnr:
             try:
-                tsnr_nii = nb.load(self.in_tsnr)
+                tsnr_nii = nib.load(self.in_tsnr)
             except (
-                nb.filebasedimages.ImageFileError,
+                nib.filebasedimages.ImageFileError,
                 FileNotFoundError,
                 TypeError,
             ) as e:
                 has_in_tsnr = False
                 print("\nError with in_mask file: ", e)
             else:
                 # nibabel: get_data() is deprecated in favour of get_fdata().
-                # We only keep here get_data() to achieve reproducibility
-                # with native mriqc results (which use get_data() in V22.06)
-                tsnr_data = tsnr_nii.get_data()
+                # To achieve reproducibility with native mriqc results
+                # (which use get_data() in V22.06), we can use
+                # numpy.asanyarray(img.dataobj).
+                tsnr_data = tsnr_nii.get_fdata()
         else:
             has_in_tsnr = False
 
         results_dict = {}
 
         if has_in_mask:
             # Summary stats
@@ -1233,15 +1238,15 @@
                 "FD": [0.0]
                 + np.loadtxt(
                     self.in_fd_file, skiprows=1, usecols=[0]
                 ).tolist(),
             }
         )
 
-        input_data = nb.load(self.in_func)
+        input_data = nib.load(self.in_func)
         seg_file = self.carpet_seg
         dataset, segments = _nifti_timeseries(input_data, seg_file)
 
         fig = fMRIPlot(
             dataset,
             segments=segments,
             spikes_files=([self.in_spikes_file]),
@@ -1383,29 +1388,29 @@
         return self.make_initResult()
 
     def run_process_mia(self):
         """Dedicated to the process launch step of the brick."""
         super(CarpetParcellation, self).run_process_mia()
 
         # Binary dilation
-        brainmask_img = nb.load(self.brainmask)
+        brainmask_img = nib.load(self.brainmask)
         brainmaskdata = np.bool_(brainmask_img.dataobj)
 
         # Obtain dilated brain mask
         dilated = image_binary_dilation(
             brainmaskdata,
             radius=2,
         )
 
         # Binary subtraction
         subtraction = np.bool_(dilated)
         subtraction[np.bool_(brainmaskdata)] = False
 
         # Carpet parcellation
-        img = nb.load(self.segmentation)
+        img = nib.load(self.segmentation)
 
         lut = np.zeros((256,), dtype="uint8")
         lut[100:201] = 1  # Ctx GM
         lut[30:99] = 2  # dGM
         lut[1:11] = 3  # WM+CSF
         lut[255] = 4  # Cerebellum
         # Apply lookup table
@@ -1605,16 +1610,16 @@
 
         file_out = os.path.join(
             self.output_directory,
             (self.out_prefix + file_name_no_ext + ".out"),
         )
 
         # Load data
-        func = np.float32(nb.load(self.in_file).dataobj)
-        mask = np.bool_(nb.load(self.in_mask).dataobj)
+        func = np.float32(nib.load(self.in_file).dataobj)
+        mask = np.bool_(nib.load(self.in_mask).dataobj)
 
         if len(func.shape) != 4:
             raise RuntimeError("Input fMRI dataset should be 4-dimensional")
 
         mfunc = func[mask]
 
         if self.intensity_normalization != 0:
@@ -1864,16 +1869,17 @@
         )
 
 
 class Mean_stdDev_calc(ProcessMIA):
     """
     *Makes the mean and standard deviation of parametric_maps*
 
-    - The parametric_maps are first resized, if necessary, to the size of the
-      rois_files. Next, the parametric_maps and the rois_files are convolved.
+    - The rois_files parametric_maps are first resized, if necessary, to the
+      size of the parametric_maps. Next, the parametric_maps and the
+      rois_files are convolved.
       Finally, the mean and standard deviation are calculated for the
       corresponding ROIs.
     - The “PatientName_data/ROI_data/ROI_analysis” directory is created to
       receive the results. If this directory exists at runtime, it is
       overwritten.
     - To work correctly, the database entry for the first element of
       parametric_maps must have the PatientName tag filled in.
@@ -2127,54 +2133,49 @@
         os.mkdir(analysis_dir)
 
         if os.path.isdir(tmp):
             shutil.rmtree(tmp)
 
         for parametric_map in self.parametric_maps:
             # Reading parametric map
-            map_img = nb.load(parametric_map)
-            map_data = map_img.get_fdata()
-            # Setting the NaN to 0 in parametric map
-            map_data = np.nan_to_num(map_data)
+            map_img = nib.load(parametric_map)
             # Deduction of the parameter from the name of the parametric map
             param_file_name = os.path.basename(parametric_map)
 
             if "_" not in param_file_name:
                 parameter = os.path.splitext(param_file_name)
 
             else:
                 parameter = param_file_name[: param_file_name.index("_")]
 
             for roi_file in self.rois_files:
-                roi_img = nb.load(roi_file)
-                roi_data = roi_img.get_fdata()
-                # Setting the NaN to 0 in ROI images
-                roi_data = np.nan_to_num(roi_data)
+                roi_img = nib.load(roi_file)
                 # Deduction of the ROI name from the roi_file
                 roi_name, _ = os.path.splitext(os.path.basename(roi_file))
 
                 if self.prefix_to_delete != " " and roi_name.startswith(
                     self.prefix_to_delete
                 ):
                     # fmt: off
                     roi_name = roi_name[len(self.prefix_to_delete):]
                     # fmt: on
 
                 # Making sure that the ROIs and parametric images are at the
                 # same size
-                if roi_data.shape[:3] != map_data.shape[:3]:
-                    map_data_max = max(map_data.max(), -map_data.min())
-                    final_map_data = (
-                        resize(map_data / map_data_max, roi_data.shape[:3])
-                        * map_data_max
+                if roi_img.shape[:3] != map_img.shape[:3]:
+                    roi_img = resample_to_img(
+                        roi_img, map_img, interpolation="linear"
                     )
 
                 # Convolution of the parametric map with the ROI images
-                roi_thresh = (roi_data > 0).astype(float)
-                result = final_map_data * roi_thresh
+                final_roi_data = roi_img.get_fdata().astype(np.float32)
+                final_roi_data[final_roi_data < 1e-5] = 0
+                map_data = map_img.get_fdata()
+                mask = (final_roi_data > 0) & ~np.isnan(map_data)
+                result = np.where(mask, map_data, 0)
 
                 # Calculating mean and standard deviation
                 if np.size(result[result.nonzero()]) == 0:
                     print(
                         "\nMean_stdDev_cal brick:\nWarning: No result found "
                         "after convolution of the {0} ROI and the {1} "
                         "data".format(roi_file, parametric_map)
@@ -2203,14 +2204,337 @@
                         if calculation == "mean":
                             f.write("%.3f" % mean_result)
 
                         else:
                             f.write("%.3f" % std_result)
 
 
+class PlotSignalROI(ProcessMIA):
+    """
+    *Plot signals from ROI using a segmentation file with label*
+
+    Please, see the complete documentation for the `PlotSignalROI brick
+    in the mia_processes website
+    <https://populse.github.io/mia_processes/html/documentation/bricks/preprocess/other/PlotSignalROI.html>`_
+
+    """
+
+    def __init__(self):
+        """Dedicated to the attributes initialisation / instantiation.
+
+        The input and output plugs are defined here. The special
+        'self.requirement' attribute (optional) is used to define the
+        third-party products necessary for the running of the brick.
+        """
+        # Initialisation of the objects needed for the launch of the brick
+        super(PlotSignalROI, self).__init__()
+
+        # Third party softwares required for the execution of the brick
+        self.requirement = []
+
+        # Inputs description
+        in_file_desc = (
+            "Input image from which the signal has been extracted(a 3D image)"
+            "(a pathlike object or string representing a file)."
+        )
+        signals_whole_brain_desc = (
+            " Signal of the in_file in a csv file "
+            "(a pathlike object or string representing a file)"
+        )
+        labels_desc = (
+            "The label list of the ROI to extract the signal (a list of int)"
+        )
+        labels_names_desc = ()
+        rois_files_desc = (
+            "List of the image with each ROI segmented (a list of file)"
+        )
+        signals_desc = (
+            "Extracted signal for each ROI in a csv file "
+            "(a pathlike object or string representing a file)"
+        )
+        suffix_desc = "Suffix for outout file ( string)"
+
+        # Outputs description
+        out_png_desc = (
+            "Out file (a pathlike object or string representing a file)"
+        )
+
+        # Inputs traits
+        self.add_trait(
+            "in_file", File(output=False, optional=False, desc=in_file_desc)
+        )
+        self.add_trait(
+            "labels",
+            traits.Either(
+                traits.List(traits.Int()),
+                traits.List(traits.String()),
+                output=False,
+                optional=False,
+                desc=labels_desc,
+            ),
+        )
+        self.add_trait(
+            "labels_names",
+            traits.List(
+                traits.String(),
+                output=False,
+                optional=True,
+                desc=labels_names_desc,
+            ),
+        )
+        self.add_trait(
+            "rois_files",
+            InputMultiPath(
+                File(),
+                output=False,
+                optional=False,
+                desc=rois_files_desc,
+            ),
+        )
+        self.add_trait(
+            "signals", File(output=False, optional=False, desc=signals_desc)
+        )
+        self.add_trait(
+            "signals_whole_brain",
+            traits.File(
+                output=False, optional=True, desc=signals_whole_brain_desc
+            ),
+        )
+        self.add_trait(
+            "suffix",
+            traits.String(output=False, optional=True, desc=suffix_desc),
+        )
+
+        # Outputs traits
+        self.add_trait(
+            "out_png", File(output=True, optional=False, desc=out_png_desc)
+        )
+
+        self.init_default_traits()
+
+    def list_outputs(self, is_plugged=None):
+        """Dedicated to the initialisation step of the brick.
+
+        The main objective of this method is to produce the outputs of the
+        bricks (self.outputs) and the associated tags (self.inheritance_dic),
+        if defined here. To work properly this method must return
+        self.make_initResult() object.
+
+        :param is_plugged: the state, linked or not, of the plugs.
+        :returns: a dictionary with requirement, outputs and inheritance_dict.
+        """
+        # Using the inheritance to ProcessMIA class, list_outputs method
+        super(PlotSignalROI, self).list_outputs()
+
+        # Outputs definition
+        if self.in_file:
+            if self.output_directory:
+                valid_ext, in_ext, file_name = checkFileExt(self.in_file, EXT)
+                if not valid_ext:
+                    print(
+                        "PlotSignalROI brick: "
+                        "The input image format is not recognized...!"
+                    )
+                    return
+                labels = ""
+                if self.suffix:
+                    labels = "_" + self.suffix
+                else:
+                    list_label = []
+                    if self.labels_names:
+                        list_label = self.labels_names
+                    elif self.labels:
+                        list_label = self.labels
+                    for label in list_label:
+                        labels += "_" + str(label)
+                self.outputs["out_png"] = os.path.join(
+                    self.output_directory,
+                    file_name + "_extracted_signals" + labels + ".png",
+                )
+
+                if self.outputs:
+                    self.tags_inheritance(
+                        in_file=self.in_file,
+                        out_file=self.outputs["out_png"],
+                    )
+            else:
+                print(
+                    "PlotSignalROI brick: "
+                    "No output_directory was found...!\n"
+                )
+                return
+
+        # Return the requirement, outputs and inheritance_dict
+        return self.make_initResult()
+
+    def run_process_mia(self):
+        """Dedicated to the process launch step of the brick."""
+        super(PlotSignalROI, self).run_process_mia()
+        color = [
+            "r",
+            "g",
+            "b",
+            "c",
+            "m",
+            "y",
+            "fuchsia",
+            "salmon",
+            "yellowgreen",
+            "teal",
+            "darkorange",
+            "magenta",
+            "navy",
+            "olive",
+            "gold",
+            "turquoise",
+        ]
+        while len(self.labels) > len(color):
+            color += color
+        # Create fig
+        fig = plt.figure(figsize=(28, 20))
+        ax1 = plt.subplot2grid((2, 6), (0, 0), colspan=5, rowspan=1)
+        ax4 = plt.subplot2grid((2, 6), (0, 5), colspan=1, rowspan=1)
+        ax2 = plt.subplot2grid((2, 6), (1, 0), colspan=4, rowspan=1)
+        ax3 = plt.subplot2grid((2, 6), (1, 5), colspan=2, rowspan=1)
+
+        # Create image with all the roi and plot it
+        concate_roi = None
+        if isinstance(self.rois_files, TraitListObject):
+            for roi in self.rois_files:
+                roi_volume = np.asarray(nib.load(roi).dataobj)
+                if concate_roi is None:
+                    concate_roi = roi_volume > 0
+                concate_roi = np.where(roi_volume > 0, roi_volume, concate_roi)
+                affine = nib.load(roi).affine
+                header = nib.load(roi).header
+            concate_roi_image = nib.Nifti1Image(
+                concate_roi, affine, header=header
+            )
+        else:
+            concate_roi = self.rois_files
+        valid_ext, in_ext, file_name = checkFileExt(self.in_file, EXT)
+
+        image = nib.load(self.in_file)
+        if len(image.shape) == 3:
+            # 3D image
+            bg_image = self.in_file
+        elif len(image.shape) == 4:
+            # 4D image
+            volume = np.asarray(image.dataobj)
+            first_volume = volume.copy()[:, :, :, 0]
+            bg_image = nib.Nifti1Image(first_volume, image.affine)
+
+        plotting.plot_roi(
+            roi_img=concate_roi_image,
+            bg_img=bg_image,
+            title="ROI",
+            axes=ax1,
+            colorbar=True,
+        )
+        txt_correspondence = "Colorbar correspondence:\n"
+        list_labels = self.labels
+        if self.labels_names and self.labels:
+            list_labels = self.labels_names
+            for i, label in enumerate(self.labels):
+                txt_correspondence += f"\n{label} : {self.labels_names[i]}"
+            txt_correspondence_ax = ax4.text(
+                0,
+                1,
+                txt_correspondence,
+                ha="left",
+                va="top",
+                wrap=True,
+                transform=ax4.transAxes,
+                fontsize=13,
+            )
+            ax4.set_xticks([])
+            ax4.set_yticks([])
+            ax4.axis("off")
+            txt_correspondence_ax._get_wrap_line_width = lambda: ax4.bbox.width
+        txt = ""
+        # Plot all signals
+        # And create txt with average signal for each roi
+        if self.signals_whole_brain:
+            signals_whole_brain_df = pd.read_csv(
+                self.signals_whole_brain, index_col=0
+            )
+            signals_whole_brain = signals_whole_brain_df.to_numpy()
+            average_signal_whole_brain = np.mean(signals_whole_brain)
+            txt = f"\nMean signal : {round(average_signal_whole_brain, 2)} "
+        signals_roi_df = pd.read_csv(self.signals, index_col=0)
+        signals_roi = signals_roi_df.to_numpy()
+        if signals_roi.shape[0] == 1:
+            if signals_roi.shape[1] == 1:
+                # 3D image
+                print(signals_roi)
+                ax2.plot(
+                    0,
+                    signals_roi,
+                    marker="o",
+                    markersize=5,
+                    markeredgecolor=color[0],
+                    markerfacecolor=color[0],
+                    label=list_labels[0],
+                )
+            else:
+                # 4D image
+                ax2.plot(
+                    signals_roi[0],
+                    linewidth=2,
+                    color=color[0],
+                    label=list_labels[0],
+                )
+            average = np.mean(signals_roi)
+            txt += (
+                f"\n \nMean signal ROI {list_labels[0]} : {round(average, 2)}"
+            )
+        elif signals_roi.shape[0] > 1:
+            for indice, signals in enumerate(signals_roi):
+                label = list_labels[indice]
+                if signals_roi.shape[1] == 1:
+                    # 3D image
+                    ax2.plot(
+                        [0],
+                        [signals],
+                        marker="o",
+                        markersize=5,
+                        markeredgecolor=color[indice],
+                        markerfacecolor=color[indice],
+                        label=label,
+                    )
+                else:
+                    # 4D image
+                    ax2.plot(
+                        signals, linewidth=2, color=color[indice], label=label
+                    )
+                average = np.mean(signals)
+                txt += f"\n \nMean signal ROI {label} : {round(average, 2)}"
+
+        fig.suptitle(f"Average signal {file_name}", fontsize=25)
+        txt = ax3.text(
+            0,
+            1,
+            txt,
+            ha="left",
+            va="top",
+            wrap=True,
+            transform=ax3.transAxes,
+            fontsize=13,
+        )
+        txt._get_wrap_line_width = lambda: ax3.bbox.width
+        ax2.set_xlabel("volumes")
+        ax2.set_ylabel("signals")
+        ax2.legend(bbox_to_anchor=(1.04, 1), loc="upper left")
+        ax3.set_xticks([])
+        ax3.set_yticks([])
+        ax3.axis("off")
+
+        plt.savefig(self.out_png, bbox_inches="tight")
+
+
 class Result_collector(ProcessMIA):
     r"""
     *Save a file.xlm with the data collection for a patient*
 
     - To work correctly, the database entry for the first element of
       parameter_files must have the "PatientName" tag filled in.
     - The “PatientName_data/results_aggregation” directory is created to
@@ -2252,15 +2576,15 @@
             "this: roi_hemi_calcul_param_contrast"
         )
         laterality_index_desc = "Calculates the laterality indexes (a boolean)"
         patient_info_desc = (
             "A dictionary whose keys/values correspond to "
             "information about the patient "
             "(e.g. {"
-            "'PatientName': 'ablair','Pathology': 'ACMD', "
+            "'PatientRef': 'sub_1','Pathology': 'ACMD', "
             "'Age': 64, 'Sex': 'M', 'MR': '3T', "
             "'Gas': 'BACTAL', 'GasAdmin': 'MASK'}"
         )
 
         # Outputs description
         out_files_desc = (
             "A list of .xml files containing a summary of the input parameters"
@@ -2289,15 +2613,15 @@
         )
 
         self.add_trait(
             "patient_info",
             traits.Dict(output=False, optional=True, desc=patient_info_desc),
         )
         self.patient_info = dict(
-            PatientName=Undefined,
+            PatientRef=Undefined,
             Pathology=Undefined,
             Age=Undefined,
             Sex=Undefined,
             MR=Undefined,
             Gas=Undefined,
             GasAdmin=Undefined,
         )
@@ -2445,28 +2769,27 @@
                     )
 
             if out_files:
                 self.outputs["out_files"] = list(out_files)
 
             # FIXME: the data should be anonymized and we should use PatientRef
             #        instead of PatientName !
-
             if (
-                self.patient_info.get("PatientName") is None
-                or self.patient_info["PatientName"] == Undefined
+                self.patient_info.get("PatientRef") is None
+                or self.patient_info["PatientRef"] == Undefined
             ):
                 patient_ref = get_dbFieldValue(
                     self.project, self.parameter_files[0], "PatientRef"
                 )
 
                 if patient_ref is None:
-                    self.patient_info["PatientName"] = patient_name
+                    self.patient_info["PatientRef"] = patient_name
 
                 else:
-                    self.patient_info["PatientName"] = patient_ref
+                    self.patient_info["PatientRef"] = patient_ref
 
             if (
                 self.patient_info.get("Pathology") is None
                 or self.patient_info["Pathology"] == Undefined
             ):
                 pathology = get_dbFieldValue(
                     self.project, self.parameter_files[0], "Pathology"
@@ -2672,15 +2995,15 @@
                                     )
 
                         else:
                             for roi in res[contrast][param][calcul]:
                                 f.write("{0}_{1}\t".format(param, roi))
 
                         f.write(
-                            "\n{0}\t".format(self.patient_info["PatientName"])
+                            "\n{0}\t".format(self.patient_info["PatientRef"])
                         )
                         f.write("{0}\t".format(self.patient_info["Pathology"]))
                         f.write("{0}\t".format(self.patient_info["Age"]))
                         f.write("{0}\t".format(self.patient_info["Sex"]))
                         f.write("{0}\t".format(self.patient_info["MR"]))
                         f.write("{0}\t".format(self.patient_info["Gas"]))
                         f.write("{0}\t".format(self.patient_info["GasAdmin"]))
@@ -2845,19 +3168,19 @@
         # Return the requirement, outputs and inheritance_dict
         return self.make_initResult()
 
     def run_process_mia(self):
         """Dedicated to the process launch step of the brick."""
         super(Spikes, self).run_process_mia()
 
-        func_nii = nb.load(self.in_file)
+        func_nii = nib.load(self.in_file)
         func_data = func_nii.get_fdata()
         func_shape = func_data.shape
 
-        orientation = nb.aff2axcodes(func_nii.affine)
+        orientation = nib.aff2axcodes(func_nii.affine)
 
         new_mask_3d = np.zeros(func_nii.shape[:3]) == 1
 
         if orientation[0] in ["L", "R"]:
             new_mask_3d[0:2, :, :] = True
             new_mask_3d[-3:-1, :, :] = True
         else:
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/reports/reporting.py` & `mia_processes-2.6.0/mia_processes/bricks/reports/reporting.py`

 * *Files 23% similar despite different names*

```diff
@@ -3,14 +3,15 @@
 
 The purpose of this module is to provide the reporting bricks necessary to
 generate automatic report at the end of a pipeline calculation.
 
 :Contains:
     :Class:
         - ReportAnatMriqc
+        - ReportCO2inhalCvr
         - ReportFuncMriqc
         - ReportGroupMriqc
 
 """
 
 ##########################################################################
 # mia_processes - Copyright (C) IRMaGe/CEA, 2018
@@ -26,19 +27,17 @@
 from datetime import datetime
 
 # nipype import
 from nipype.interfaces.base import File, OutputMultiPath, Undefined, traits
 from nipype.interfaces.spm.base import ImageFileSPM
 
 # populse_mia import
+from populse_mia.software_properties import Config
 from populse_mia.user_interface.pipeline_manager.process_mia import ProcessMIA
 
-# traits import
-from traits.api import Enum
-
 # mia_processes import:
 from mia_processes.utils import (
     Report,
     dict4runtime_update,
     mriqc_get_all_run,
     mriqc_group_iqms_tsv,
     plot_boxplot_points,
@@ -349,17 +348,19 @@
             self.dict4runtime["Spectro"] = "Philips Achieva 3.0T TX"
 
         # Generate an output name
         if self.anat and self.anat not in ["<undefined>", traits.Undefined]:
             self.outputs["report"] = os.path.join(
                 self.output_directory,
                 "{0}_anatomical_mriqcReport_{1}.pdf".format(
-                    self.dict4runtime["PatientName"]
-                    if self.dict4runtime["PatientName"] != "Undefined"
-                    else "Undefined_name_ref",
+                    (
+                        self.dict4runtime["PatientName"]
+                        if self.dict4runtime["PatientName"] != "Undefined"
+                        else "Undefined_name_ref"
+                    ),
                     datetime.now().strftime("%Y_%m_%d_%H_%M_%S_%f")[:22],
                 ),
             )
 
         else:
             return self.make_initResult()
 
@@ -823,14 +824,752 @@
             norm_anat_inf_slice_start=self.norm_anat_inf_slice_start,
             norm_anat_slices_gap=self.norm_anat_slices_gap,
         )
 
         report.make_report()
 
 
+class ReportCO2inhalCvr(ProcessMIA):
+    """
+    *Generates report for CVR study by CO2 inhalation task*
+
+    Please, see the complete documentation for the `ReportCO2inhalCvr brick
+    in the mia_processes website
+    <https://populse.github.io/mia_processes/html/documentation/bricks/reports/ReportCO2inhalCvr.html>`_
+
+    """
+
+    def __init__(self):
+        """Dedicated to the attributes initialisation / instantiation.
+
+        The input and output plugs are defined here. The special
+        'self.requirement' attribute (optional) is used to define the
+        third-party products necessary for the running of the brick.
+        """
+        # Initialisation of the objects needed for the launch of the brick
+        super(ReportCO2inhalCvr, self).__init__()
+
+        # Third party software required for the execution of the brick
+        self.requirement = []
+
+        # Inputs description
+        norm_anat_desc = (
+            "An existing, uncompressed normalised anatomical "
+            "image file (valid extensions: .nii)"
+        )
+
+        norm_anat_fig_rows_desc = (
+            "The number of lines for the normalised "
+            "anatomical slice planes plot"
+        )
+
+        norm_anat_fig_cols_desc = (
+            "The number of columns for the normalised "
+            "anatomical slice planes plot"
+        )
+
+        norm_anat_inf_slice_start_desc = (
+            "The first index displayed in "
+            "normalised anatomical slice planes "
+            "plot"
+        )
+
+        norm_anat_slices_gap_desc = (
+            "Gap between slices in normalised anatomical slice planes plot"
+        )
+
+        norm_anat_cmap_desc = (
+            "Colormap name used for the normalised anatomical plot "
+            "(a string, default: 'Greys_r')"
+        )
+
+        norm_anat_vmin_desc = (
+            "Minimum value in the data range covered by the color map"
+        )
+
+        norm_anat_vmax_desc = (
+            "Maximum value in the data range covered by the color map"
+        )
+
+        norm_func_desc = (
+            "An existing, uncompressed normalised functional image file "
+            "(valid extensions: .nii, .nii.gz)"
+        )
+
+        norm_func_fig_rows_desc = (
+            "The number of lines for the normalised functional slice "
+            "planes plot"
+        )
+
+        norm_func_fig_cols_desc = (
+            "The number of columns for the normalised functional slice "
+            "planes plot"
+        )
+
+        norm_func_inf_slice_start_desc = (
+            "The first index displayed in the normalised functional slice "
+            "planes plot"
+        )
+
+        norm_func_slices_gap_desc = (
+            "Gap between slices in the normalised functional slice planes plot"
+        )
+
+        norm_func_cmap_desc = (
+            "Colormap name used for the normalised functional plot "
+            "(a string, default: 'Greys_r')"
+        )
+
+        norm_func_vmin_desc = (
+            "Minimum value in the data range covered by the color map ("
+        )
+
+        norm_func_vmax_desc = (
+            "Maximum value in the data range covered by the color map"
+        )
+
+        realignment_parameters_desc = (
+            "Estimation of translation and rotation parameters when "
+            "realigning functional data (a pathlike object or a"
+            "string representing a file, or a list "
+            "of pathlike objects or strings "
+            "representing a file)"
+        )
+        regressor_physio_desc = (
+            "Time series data that represent the "
+            "physiological processes thought to "
+            "contribute to the CVR in the fMRI signal "
+            "(a pathlike object or a string representing "
+            "a file, or a list of pathlike objects or "
+            "strings representing a file)"
+        )
+        beta_image_desc = (
+            "The 1st estimated parameter of the model, i.e. beta_0001.nii "
+            "(valid extensions:.nii)"
+        )
+
+        beta_cmap_desc = (
+            "Colormap name used for the first beta parameter plot "
+            "(a string, default: 'rainbow')"
+        )
+
+        beta_vmin_desc = (
+            "Minimum value in the data range covered by the color map ("
+        )
+
+        beta_vmax_desc = (
+            "Maximum value in the data range covered by the color map"
+        )
+
+        spmT_image_desc = (
+            "Stat images from a t-contrast, i.e. spmT_0001.nii, "
+            "(valid extensions:.nii)"
+        )
+
+        spmT_cmap_desc = (
+            "Colormap name used for the stat images plot "
+            "(a string, default: 'rainbow')"
+        )
+
+        spmT_vmin_desc = (
+            "Minimum value in the data range covered by the color map"
+        )
+
+        spmT_vmax_desc = (
+            "Maximum value in the data range covered by the color map"
+        )
+
+        patient_info_desc = (
+            "Optional dictionary with information about the patient "
+            "(e.g. {"
+            "'PatientName': 'sub-1', 'Pathology': 'ACMD', "
+            "'Age': 64, 'Sex': 'M', 'MR': '3T', "
+            "'Gas': 'BACTAL', 'GasAdmin': 'MASK'}"
+        )
+
+        # Outputs description
+        report_desc = "The generated report (pdf)"
+
+        # Inputs traits
+        self.add_trait(
+            "norm_anat",
+            ImageFileSPM(
+                copyfile=False,
+                output=False,
+                optional=False,
+                desc=norm_anat_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_anat_fig_rows",
+            traits.Int(
+                5, output=False, optional=True, desc=norm_anat_fig_rows_desc
+            ),
+        )
+
+        self.add_trait(
+            "norm_anat_fig_cols",
+            traits.Int(
+                5, output=False, optional=True, desc=norm_anat_fig_cols_desc
+            ),
+        )
+
+        self.add_trait(
+            "norm_anat_inf_slice_start",
+            traits.Either(
+                Undefined,
+                traits.Int,
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=norm_anat_inf_slice_start_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_anat_slices_gap",
+            traits.Either(
+                Undefined,
+                traits.Int,
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=norm_anat_slices_gap_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_anat_cmap",
+            traits.String(
+                "Greys_r",
+                output=False,
+                optional=True,
+                desc=norm_anat_cmap_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_anat_vmin",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=norm_anat_vmin_desc,
+            ),
+        )
+        self.norm_anat_vmin = Undefined
+
+        self.add_trait(
+            "norm_anat_vmax",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=norm_anat_vmax_desc,
+            ),
+        )
+        self.norm_anat_vmax = Undefined
+
+        # TODO: We use the normalized functional. It seems that it's the
+        #       normalized - smothed functional that's used in Amigo. We'll
+        #       have to check and decide what we'll use here finally?
+        self.add_trait(
+            "norm_func",
+            ImageFileSPM(
+                copyfile=False,
+                output=False,
+                optional=False,
+                desc=norm_func_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_func_fig_rows",
+            traits.Int(
+                5, output=False, optional=True, desc=norm_func_fig_rows_desc
+            ),
+        )
+
+        self.add_trait(
+            "norm_func_fig_cols",
+            traits.Int(
+                5, output=False, optional=True, desc=norm_func_fig_cols_desc
+            ),
+        )
+
+        self.add_trait(
+            "norm_func_inf_slice_start",
+            traits.Either(
+                Undefined,
+                traits.Int,
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=norm_func_inf_slice_start_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_func_slices_gap",
+            traits.Either(
+                Undefined,
+                traits.Int,
+                default=Undefined,
+                output=False,
+                optional=True,
+                desc=norm_func_slices_gap_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_func_cmap",
+            traits.String(
+                "Greys_r",
+                output=False,
+                optional=True,
+                desc=norm_func_cmap_desc,
+            ),
+        )
+
+        self.add_trait(
+            "norm_func_vmin",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=norm_func_vmin_desc,
+            ),
+        )
+        self.norm_func_vmin = Undefined
+
+        self.add_trait(
+            "norm_func_vmax",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=norm_func_vmax_desc,
+            ),
+        )
+        self.norm_func_vmax = Undefined
+
+        self.add_trait(
+            "realignment_parameters",
+            File(
+                output=False, optional=False, desc=realignment_parameters_desc
+            ),
+        )
+
+        self.add_trait(
+            "regressor_physio",
+            File(output=False, optional=False, desc=regressor_physio_desc),
+        )
+
+        self.add_trait(
+            "beta_image",
+            File(output=False, optional=False, desc=beta_image_desc),
+        )
+
+        self.add_trait(
+            "beta_cmap",
+            traits.String(
+                "rainbow", output=False, optional=True, desc=beta_cmap_desc
+            ),
+        )
+
+        self.add_trait(
+            "beta_vmin",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=beta_vmin_desc,
+            ),
+        )
+        self.beta_vmin = Undefined
+
+        self.add_trait(
+            "beta_vmax",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=beta_vmax_desc,
+            ),
+        )
+        self.beta_vmax = Undefined
+
+        self.add_trait(
+            "spmT_image",
+            File(output=False, optional=False, desc=spmT_image_desc),
+        )
+
+        self.add_trait(
+            "spmT_cmap",
+            traits.String(
+                "rainbow", output=False, optional=True, desc=spmT_cmap_desc
+            ),
+        )
+
+        self.add_trait(
+            "spmT_vmin",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=spmT_vmin_desc,
+            ),
+        )
+        self.spmT_vmin = Undefined
+
+        self.add_trait(
+            "spmT_vmax",
+            traits.Either(
+                Undefined,
+                traits.Float(),
+                output=False,
+                optional=True,
+                desc=spmT_vmax_desc,
+            ),
+        )
+        self.spmT_vmax = Undefined
+
+        self.add_trait(
+            "patient_info",
+            traits.Dict(output=False, optional=True, desc=patient_info_desc),
+        )
+        self.patient_info = dict(
+            PatientRef=Undefined,
+            Pathology=Undefined,
+            Age=Undefined,
+            Sex=Undefined,
+            MR=Undefined,
+            Gas=Undefined,
+            GasAdmin=Undefined,
+        )
+
+        # Outputs traits
+        self.add_trait(
+            "report",
+            OutputMultiPath(
+                File(), output=True, optional=True, desc=report_desc
+            ),
+        )
+        # Special parameter used as a messenger for the run_process_mia method
+        self.add_trait(
+            "dict4runtime",
+            traits.Dict(output=False, optional=True, userlevel=1),
+        )
+
+        self.init_default_traits()
+
+    def list_outputs(self, is_plugged=None):
+        """Dedicated to the initialisation step of the brick.
+
+        The main objective of this method is to produce the outputs of the
+        bricks (self.outputs) and the associated tags (self.inheritance_dic),
+        if defined here. To work properly this method must return
+        self.make_initResult() object.
+
+        :param is_plugged: the state, linked or not, of the plugs.
+        :returns: a dictionary with requirement, outputs and inheritance_dict.
+        """
+        # Using the inheritance to ProcessMIA class, list_outputs method
+        super(ReportCO2inhalCvr, self).list_outputs()
+
+        file_position = (
+            self.norm_anat.find(self.project.getName())
+            + len(self.project.getName())
+            + 1
+        )
+        db_file_norm_anat = self.norm_anat[file_position:]
+        db_file_norm_func = self.norm_func[file_position:]
+        # TODO: Do we need to explicitly take the smoothed func as input,
+        #       or can we simply add the prefix 's' to the normalized func?
+        db_file_smooth_norm_func = "s" + db_file_norm_func
+        db_file_regressor_physio = self.regressor_physio[file_position:]
+
+        # As we do not have access to the database at the runtime (see #272),
+        # we prepare here the data that the run_process_mia method will need
+        # via dict4runtime parameter:
+        self.dict4runtime["norm_anat"] = {}
+        dict4runtime_update(
+            self.dict4runtime["norm_anat"],
+            self.project.session,
+            db_file_norm_anat,
+            "AcquisitionDate",
+            "Acquisition nbr",
+            "Affine regularization type",
+            "Age",
+            "Dataset dimensions (Count, X,Y,Z,T...)",
+            "EchoTime",
+            "FlipAngle",
+            "FOV",
+            "Grid spacings (X,Y,Z,T,...)",
+            "Pathology",
+            "PatientName",
+            "PatientRef",
+            "ProtocolName",
+            "RepetitionTime",
+            "SequenceName",
+            "Sex",
+            "Site",
+            "SliceThickness",
+            "Spectro",
+            "Start/end slice",
+            "StudyName",
+            "Voxel sizes",
+        )
+        self.dict4runtime["norm_func"] = {}
+        dict4runtime_update(
+            self.dict4runtime["norm_func"],
+            self.project.session,
+            db_file_norm_func,
+            "Acquisition nbr",
+            "Affine regularization type",
+            "Dataset dimensions (Count, X,Y,Z,T...)",
+            "EchoTime",
+            "FlipAngle",
+            "FOV",
+            "Gas",
+            "GasAdmin",
+            "Grid spacings (X,Y,Z,T,...)",
+            "ProtocolName",
+            "RepetitionTime",
+            "SequenceName",
+            "SliceThickness",
+            "Start/end slice",
+            "Voxel sizes",
+        )
+        self.dict4runtime["smooth_norm_func"] = {}
+        dict4runtime_update(
+            self.dict4runtime["smooth_norm_func"],
+            self.project.session,
+            db_file_smooth_norm_func,
+            "FWHM (X, Y, Z) for Smooth",
+        )
+        self.dict4runtime["regressor_physio"] = {}
+        dict4runtime_update(
+            self.dict4runtime["regressor_physio"],
+            self.project.session,
+            db_file_regressor_physio,
+            "Regressor state",
+        )
+        # FIXME: the data should be anonymized and we should use PatientRef
+        #        instead of PatientName !
+        if self.dict4runtime["norm_anat"]["PatientName"] == "Undefined":
+            print(
+                "\nReportCO2inhalCvr brick:\nThe tags PatientName was not "
+                "found in the database for the {} file...\n The "
+                "initialization is aborted...".format(db_file_norm_anat)
+            )
+            return self.make_initResult()
+
+        if (
+            self.patient_info.get("PatientRef") is None
+            or self.patient_info["PatientRef"] == Undefined
+        ):
+            if self.dict4runtime["norm_anat"]["PatientRef"] == "Undefined":
+                self.dict4runtime["norm_anat"]["PatientRef"] = (
+                    self.dict4runtime["norm_anat"]["PatientName"]
+                )
+                self.patient_info["PatientRef"] = self.dict4runtime[
+                    "norm_anat"
+                ]["PatientName"]
+
+            else:
+                self.patient_info["PatientRef"] = self.dict4runtime[
+                    "norm_anat"
+                ]["PatientRef"]
+
+        else:
+            self.dict4runtime["norm_anat"]["PatientRef"] = (
+                self.patient_info.get("PatientRef")
+            )
+
+        if (
+            self.patient_info.get("Pathology") is None
+            or self.patient_info["Pathology"] == Undefined
+        ):
+            if self.dict4runtime["norm_anat"]["Pathology"] != "Undefined":
+                self.patient_info["Pathology"] = self.dict4runtime[
+                    "norm_anat"
+                ]["Pathology"]
+
+        else:
+            self.dict4runtime["norm_anat"]["Pathology"] = (
+                self.patient_info.get("Pathology")
+            )
+
+        if (
+            self.patient_info.get("Age") is None
+            or self.patient_info["Age"] == Undefined
+        ):
+            if self.dict4runtime["norm_anat"]["Age"] != "Undefined":
+                self.patient_info["Age"] = self.dict4runtime["norm_anat"][
+                    "Age"
+                ]
+
+        else:
+            self.dict4runtime["norm_anat"]["Age"] = self.patient_info.get(
+                "Age"
+            )
+
+        if (
+            self.patient_info.get("Sex") is None
+            or self.patient_info["Sex"] == Undefined
+        ):
+            if self.dict4runtime["norm_anat"]["Sex"] != "Undefined":
+                self.patient_info["Sex"] = self.dict4runtime["norm_anat"][
+                    "Sex"
+                ]
+
+        else:
+            self.dict4runtime["norm_anat"]["Sex"] = self.patient_info.get(
+                "Sex"
+            )
+
+        if (
+            self.patient_info.get("MR") is None
+            or self.patient_info["MR"] == Undefined
+        ):
+            if self.dict4runtime["norm_anat"]["Spectro"] != "Undefined":
+                self.patient_info["MR"] = self.dict4runtime["norm_anat"][
+                    "Spectro"
+                ]
+
+        else:
+            self.dict4runtime["norm_anat"]["Spectro"] = self.patient_info.get(
+                "MR"
+            )
+
+        if (
+            self.patient_info.get("Gas") is None
+            or self.patient_info["Gas"] == Undefined
+        ):
+            if self.dict4runtime["norm_func"]["Gas"] != "Undefined":
+                self.patient_info["Gas"] == self.dict4runtime["norm_func"][
+                    "Gas"
+                ]
+
+        else:
+            self.dict4runtime["norm_func"]["Gas"] = self.patient_info.get(
+                "Gas"
+            )
+
+        if (
+            self.patient_info.get("GasAdmin") is None
+            or self.patient_info["GasAdmin"] == Undefined
+        ):
+            if self.dict4runtime["norm_func"]["GasAdmin"] != "Undefined":
+                self.patient_info["GasAdmin"] == self.dict4runtime[
+                    "norm_func"
+                ]["GasAdmin"]
+
+        else:
+            self.dict4runtime["norm_func"]["GasAdmin"] = self.patient_info.get(
+                "GasAdmin"
+            )
+
+        # FIXME: Currently, Site and Spectro data are hard-coded. A solution
+        #        should be found to retrieve them automatically or to put them
+        #        in the input parameters of the brick:
+        # Site
+        if self.dict4runtime["norm_anat"]["Site"] in ("", "Undefined"):
+            self.dict4runtime["norm_anat"][
+                "Site"
+            ] = "Grenoble University Hospital - CLUNI"
+
+        # MriScanner
+        if self.dict4runtime["norm_anat"]["Spectro"] in ("", "Undefined"):
+            self.dict4runtime["norm_anat"][
+                "Spectro"
+            ] = "Philips Achieva 3.0T TX"
+
+        # Reference population file for result stat anal
+        config = Config()
+        self.dict4runtime["CVR_ref_data"] = os.path.join(
+            config.get_resources_path(),
+            "reference_population_data",
+            "CVR_ref_pop_SEMVIE-16.xlsx",
+        )
+
+        # Generate an output name
+        if (
+            self.norm_anat
+            and self.norm_anat not in ["<undefined>", traits.Undefined]
+        ) and (
+            self.norm_func
+            and self.norm_func not in ["<undefined>", traits.Undefined]
+        ):
+            self.outputs["report"] = os.path.join(
+                self.output_directory,
+                "{0}_CO2_inhal_CVR_Report_{1}.pdf".format(
+                    self.dict4runtime["norm_anat"]["PatientRef"],
+                    datetime.now().strftime("%Y_%m_%d_%H_%M_%S_%f")[:22],
+                ),
+            )
+
+        else:
+            return self.make_initResult()
+
+        self.tags_inheritance(
+            self.norm_anat,
+            self.outputs["report"],
+        )
+        return self.make_initResult()
+
+    def run_process_mia(self):
+        """Dedicated to the process launch step of the brick."""
+        super(ReportCO2inhalCvr, self).run_process_mia()
+
+        report = Report(
+            self.report,
+            self.dict4runtime,
+            CVR=True,
+            norm_anat=self.norm_anat,
+            norm_anat_fig_rows=self.norm_anat_fig_rows,
+            norm_anat_fig_cols=self.norm_anat_fig_cols,
+            norm_anat_inf_slice_start=self.norm_anat_inf_slice_start,
+            norm_anat_slices_gap=self.norm_anat_slices_gap,
+            norm_anat_cmap=self.norm_anat_cmap,
+            norm_anat_vmin=self.norm_anat_vmin,
+            norm_anat_vmax=self.norm_anat_vmax,
+            norm_func=self.norm_func,
+            norm_func_fig_rows=self.norm_func_fig_rows,
+            norm_func_fig_cols=self.norm_func_fig_cols,
+            norm_func_inf_slice_start=self.norm_func_inf_slice_start,
+            norm_func_slices_gap=self.norm_func_slices_gap,
+            norm_func_cmap=self.norm_func_cmap,
+            norm_func_vmin=self.norm_func_vmin,
+            norm_func_vmax=self.norm_func_vmax,
+            realignment_parameters=self.realignment_parameters,
+            regressor_physio=self.regressor_physio,
+            beta_image=self.beta_image,
+            beta_cmap=self.beta_cmap,
+            beta_vmin=self.beta_vmin,
+            beta_vmax=self.beta_vmax,
+            spmT_image=self.spmT_image,
+            spmT_cmap=self.spmT_cmap,
+            spmT_vmin=self.spmT_vmin,
+            spmT_vmax=self.spmT_vmax,
+            output_directory=self.output_directory,
+        )
+
+        report.make_report()
+
+
 class ReportFuncMriqc(ProcessMIA):
     """
     *Generates the report for functional data in MRIQC pipeline*
 
     Please, see the complete documentation for the `ReportFuncMriqc
     brick in the mia_processes website
     <https://populse.github.io/mia_processes/html/documentation/bricks/reports/ReportFuncMriqc.html>`_
@@ -1117,17 +1856,19 @@
             self.dict4runtime["Spectro"] = "Philips Achieva 3.0T TX"
 
         # Generate an output name
         if self.func and self.func not in ["<undefined>", traits.Undefined]:
             self.outputs["report"] = os.path.join(
                 self.output_directory,
                 "{0}_functional_mriqcReport_{1}.pdf".format(
-                    self.dict4runtime["PatientName"]
-                    if self.dict4runtime["PatientName"] != "Undefined"
-                    else "Undefined_name_ref",
+                    (
+                        self.dict4runtime["PatientName"]
+                        if self.dict4runtime["PatientName"] != "Undefined"
+                        else "Undefined_name_ref"
+                    ),
                     datetime.now().strftime("%Y_%m_%d_%H_%M_%S_%f")[:22],
                 ),
             )
 
         else:
             return self.make_initResult()
 
@@ -1470,15 +2211,15 @@
         # Outputs description
         report_pdf_desc = "The generated report (pdf)"
         out_tsv_desc = "The tsv file"
 
         # Inputs traits
         self.add_trait(
             "modality",
-            Enum(
+            traits.Enum(
                 "anat", "bold", output=False, optional=True, desc=modality_desc
             ),
         )
         # Outputs traits
         self.add_trait("out_tsv", File(output=True, desc=out_tsv_desc))
         self.add_trait("report_pdf", File(output=True, desc=report_pdf_desc))
 
@@ -1544,17 +2285,17 @@
                 "Age",
             )
             # FIXME: Currently, Site and Spectro data are hard-coded.
             #        A solution should be found to retrieve them automatically
             #        or to put them in the input parameters of the brick:
             # Site
             if dict4runtime_file["Site"] in ("", "Undefined"):
-                dict4runtime_file[
-                    "Site"
-                ] = "Grenoble University Hospital - CLUNI"
+                dict4runtime_file["Site"] = (
+                    "Grenoble University Hospital - CLUNI"
+                )
 
             # MriScanner
             if dict4runtime_file["Spectro"] in ("", "Undefined"):
                 dict4runtime_file["Spectro"] = "Philips Achieva 3.0T TX"
 
             self.dict4runtime[str(i)] = dict4runtime_file
             i += 1
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/stat/spm/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/stat/spm/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/bricks/stat/spm/model.py` & `mia_processes-2.6.0/mia_processes/bricks/stat/spm/model.py`

 * *Files 0% similar despite different names*

```diff
@@ -279,17 +279,19 @@
                         self.T_contrast_names,
                         self.T_condition_names,
                         self.T_contrast_weights,
                     )
                 ]
             else:
                 contrasts_T = [
-                    (cont_name, "T", condition, cont_weight, sess)
-                    if sess is not Undefined
-                    else (cont_name, "T", condition, cont_weight)
+                    (
+                        (cont_name, "T", condition, cont_weight, sess)
+                        if sess is not Undefined
+                        else (cont_name, "T", condition, cont_weight)
+                    )
                     for cont_name, condition, cont_weight, sess in zip(
                         self.T_contrast_names,
                         self.T_condition_names,
                         self.T_contrast_weights,
                         self.session,
                     )
                 ]
@@ -1599,27 +1601,27 @@
             ),
         )
 
         self.add_trait(
             "sess_hpf",
             traits.List(
                 traits.Float(),
-                value=[427.2],
+                value=[427.0],
                 usedefault=True,
                 output=False,
                 optional=True,
                 desc=sess_hpf_desc,
             ),
         )
-        # TODO: 427.2 corresponds to the value used in Amigo
-        #       Duration * TR * 3.56 = 427.2 if Duration == 40 and
+        # TODO: 427.0 corresponds to the value used in Amigo
+        #       round(Duration * TR * 3.56) = 427 if Duration == 40 and
         #       TR == 3s; why 3.56 ?
         #       I was expecting rather to:
         #       (time between first block start
-        #        - second block start) * TR *2 = 80 *3 *2 = 480
+        #        - second block start) * TR * 2 = 80 * 3 * 2 = 480
         #       Can we code an automatic recovery procedure for the
         #       hpf parameter ?
         #       (in this case, the user would have to declare additional
         #       tags in the database, like the block duration !)
 
         self.add_trait(
             "factor_info",
@@ -2182,17 +2184,17 @@
                         "pipeline...\n".format(scan)
                     )
 
             if dyn_num > 0:
                 tag_to_add = dict()
                 tag_to_add["name"] = "Dynamic Number"
                 tag_to_add["field_type"] = FIELD_TYPE_INTEGER
-                tag_to_add[
-                    "description"
-                ] = "Total number of dynamics in the functionals"
+                tag_to_add["description"] = (
+                    "Total number of dynamics in the functionals"
+                )
                 tag_to_add["visibility"] = True
                 tag_to_add["origin"] = TAG_ORIGIN_USER
                 tag_to_add["unit"] = None
                 tag_to_add["default_value"] = None
                 tag_to_add["value"] = dyn_num
                 all_tags_to_add.append(tag_to_add)
 
@@ -2251,17 +2253,17 @@
         self.process.interscan_interval = self.interscan_interval
         self.process.microtime_resolution = self.microtime_resolution
         self.process.microtime_onset = self.microtime_onset
         self.process.session_info = self.dict4runtime["sessions"]
         self.process.factor_info = self.factor_info
         self.process.bases = self.bases
         self.process.volterra_expansion_order = self.volterra_expansion_order
-        (
-            self.process.global_intensity_normalization
-        ) = self.global_intensity_normalization
+        (self.process.global_intensity_normalization) = (
+            self.global_intensity_normalization
+        )
         self.process.mask_threshold = self.mask_threshold
 
         # Only one mask can be defined in spm. If more than one is given, only
         # the first one will be used for all sessions ...
         if self.mask_image != Undefined:
             if type(self.mask_image) in [
                 list,
```

### Comparing `mia_processes-2.5.0/mia_processes/bricks/tools/__init__.py` & `mia_processes-2.6.0/mia_processes/bricks/tools/__init__.py`

 * *Files 17% similar despite different names*

```diff
@@ -23,8 +23,9 @@
     Get_Conditions_From_csv,
     Get_Patient_Name,
     Import_Data,
     Input_Filter,
     List_Duplicate,
     List_To_File,
     Make_A_List,
+    Make_CVR_reg_physio,
 )
```

### Comparing `mia_processes-2.5.0/mia_processes/info.py` & `mia_processes-2.6.0/mia_processes/info.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 # -*- coding: utf-8 -*-
 
-"""The module dedicated to the main informations on mia_processes.
+"""The module dedicated to the main information on mia_processes.
 
 The info.py module is mainly used by the setup.py module.
 
 """
 
 ##########################################################################
 # mia_processes - Copyright (C) IRMaGe/CEA, 2018
@@ -15,15 +15,15 @@
 ##########################################################################
 
 import os
 import subprocess
 
 # Current version
 version_major = 2
-version_minor = 5
+version_minor = 6
 version_micro = 0
 # version_extra = "dev"  # leave empty for release
 version_extra = ""
 
 # Expected by setup.py: string of form "X.Y.Z"
 if version_extra:
     __version__ = "{0}.{1}.{2}-{3}".format(
@@ -131,14 +131,15 @@
     "nibabel",
     "nilearn",
     "nipy",
     "nipype",
     "nitime",
     "nitransforms",
     "numpy",
+    "openpyxl",
     "paramiko",
     "populse-db >= 2.5.0, < 3.0.0",
     "populse_mia >= 2.5.0, < 3.0.0",
     "pyxnat",
     "reportlab",
     "scipy",
     "statsmodels",
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/CerebVascularReact/__init__.py` & `mia_processes-2.6.0/mia_processes/pipelines/CerebVascularReact/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/CerebVascularReact/co2_inhalation.py` & `mia_processes-2.6.0/mia_processes/pipelines/reports/extract_roi_param.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,202 +1,169 @@
 # -*- coding: utf-8 -*-
 
-"""The pipelines library of the mia_processes package.
+"""blabla.
 
-The CO2_inhalation pipeline is designed for CVR measurement
-using hypercapnia challenge.
+The purpose of this module is to blabla.
 
 :Contains:
     :Class:
-        - CO2_inhalation
+        - Extract_roi_param
 
 """
 
 ##########################################################################
 # mia_processes - Copyright (C) IRMaGe/CEA, 2018
 # Distributed under the terms of the CeCILL license, as published by
 # the CEA-CNRS-INRIA. Refer to the LICENSE file or to
 # http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html
 # for details.
 ##########################################################################
 
+# Other import
+import traits.api as traits
+
+# Capsul import
 from capsul.api import Pipeline
 
 
-class CO2_inhalation(Pipeline):
+class Extract_roi_param(Pipeline):
     """
-    *CVR measurement under hypercapnia challenge*
+    *Produces gray matter masks for various ROIs and means, standard
+    deviations, laterality indexes for beta and spmT values in these ROIs*
+
+    Please, see the complete documentation for the `Extract_roi_param brick
+    in the mia_processes website
+    <https://populse.github.io/mia_processes/html/documentation/pipelines/reports/Extract_roi_param.html>`_
 
-    Please, see the complete documentation for the
-    `CO2_inhalation pipeline in the mia_processes website:
-    <https://populse.github.io/mia_processes/html/documentation/pipelines/CerebVascularReact/CO2_inhalation.html>`_
     """
 
     def pipeline_definition(self):
         """Building the pipeline"""
         # nodes
         self.add_process(
-            "1_spatial_preprocessing",
-            "mia_processes.pipelines.preprocess.bold_spatial_preprocessing1."
-            "Bold_spatial_preprocessing1",
-        )
-        self.nodes["1_spatial_preprocessing"].process.nodes_activation = {
-            "newsegment": True,
-            "realign": True,
-            "list_duplicate": True,
-            "normalize12_1": True,
-            "normalize12_2": True,
-            "smooth": True,
-            "coregister": True,
-        }
+            "concat_to_list_of_list",
+            "mia_processes.bricks.tools.tools.Concat_to_list_of_list",
+        )
         self.add_process(
-            "2_spatial_mask",
-            "mia_processes.pipelines.preprocess.spatial_mask.Spatial_mask",
+            "import_data", "mia_processes.bricks.tools.tools.Import_Data"
         )
-        self.nodes["2_spatial_mask"].process.nodes_activation = {
-            "gm_wm_normalize": True,
-            "threshold_1": True,
-            "smooth": True,
-            "threshold_2": True,
-            "resample1": True,
-        }
         self.add_process(
-            "3_boldStat",
-            "mia_processes.pipelines.stat.bold_stat_cvr.Bold_stat_cvr",
+            "find_in_list_1", "mia_processes.bricks.tools.tools.Find_In_List"
         )
-        self.nodes["3_boldStat"].process.nodes_activation = {
-            "estimatecontrast": True,
-            "level1design": True,
-            "estimatemodel": True,
-            "make_a_list": True,
-        }
         self.add_process(
-            "4_extract_roi_param",
-            "mia_processes.pipelines.reports.extract_roi_param."
-            "Extract_roi_param",
-        )
-        self.nodes["4_extract_roi_param"].process.nodes_activation = {
-            "concat_to_list_of_list": True,
-            "import_data": True,
-            "find_in_list_1": True,
-            "find_in_list_2": True,
-            "files_to_list": True,
-            "convroi": True,
-            "resample1": True,
-            "resample2": True,
-            "mean_stddev_calc": True,
-            "concat_to_list": True,
-            "result_collector": True,
-        }
+            "find_in_list_2", "mia_processes.bricks.tools.tools.Find_In_List"
+        )
         self.add_process(
             "files_to_list", "mia_processes.bricks.tools.tools.Files_To_List"
         )
-
-        # links
-        self.export_parameter(
-            "1_spatial_preprocessing", "anat_file", is_optional=False
+        self.nodes["files_to_list"].set_plug_value("file1", traits.Undefined)
+        self.nodes["files_to_list"].set_plug_value("file2", traits.Undefined)
+        self.add_process(
+            "convroi",
+            "mia_processes.bricks.preprocess.others.processing.ConvROI",
         )
-        self.export_parameter(
-            "1_spatial_preprocessing", "func_files", is_optional=False
+        self.add_process(
+            "mean_stddev_calc",
+            "mia_processes.bricks.reports.processes.Mean_stdDev_calc",
         )
-        self.export_parameter(
-            "files_to_list", "file1", "regressor_physio", is_optional=False
+        self.nodes["mean_stddev_calc"].set_plug_value(
+            "parametric_maps", traits.Undefined
         )
-        self.export_parameter(
-            "4_extract_roi_param", "patient_info", is_optional=True
+        self.nodes["mean_stddev_calc"].process.parametric_maps = (
+            traits.Undefined
         )
-        self.export_parameter(
-            "1_spatial_preprocessing", "bias_field_images", is_optional=True
+        self.add_process(
+            "concat_to_list",
+            "mia_processes.bricks.tools.tools.Concat_to_list",
         )
-        self.add_link(
-            "1_spatial_preprocessing.native_class_images->"
-            "2_spatial_mask.native_class_images"
+        self.add_process(
+            "result_collector",
+            "mia_processes.bricks.reports.processes.Result_collector",
         )
-        self.add_link(
-            "1_spatial_preprocessing.forward_deformation_field->"
-            "2_spatial_mask.deformation_file"
+        self.nodes["result_collector"].set_plug_value(
+            "parameter_files", traits.Undefined
         )
-        self.add_link(
-            "1_spatial_preprocessing.realignment_parameters->"
-            "files_to_list.file2"
+        self.nodes["result_collector"].process.parameter_files = (
+            traits.Undefined
         )
+        self.nodes["result_collector"].set_plug_value("laterality_index", True)
+
+        # links
         self.export_parameter(
-            "1_spatial_preprocessing", "normalized_anat", is_optional=True
-        )
-        self.add_link(
-            "1_spatial_preprocessing.smoothed_func->3_boldStat.smoothed_func"
+            "find_in_list_1", "in_list", "spmT_images", is_optional=False
         )
-        self.add_link(
-            "1_spatial_preprocessing.smoothed_func->"
-            "2_spatial_mask.smoothed_func"
+        self.add_link("spmT_images->import_data.file_in_db")
+        self.export_parameter(
+            "find_in_list_2", "in_list", "beta_images", is_optional=False
         )
         self.export_parameter(
-            "1_spatial_preprocessing", "coregistered_source", is_optional=False
+            "convroi", "convolve_with", "mask_003", is_optional=False
         )
-        self.add_link("2_spatial_mask.mask_002->4_extract_roi_param.mask_002")
-        self.add_link("2_spatial_mask.mask_002->3_boldStat.mask_002")
-        self.export_parameter("2_spatial_mask", "mask_003", is_optional=False)
         self.add_link(
-            "3_boldStat.spmT_images->4_extract_roi_param.spmT_images"
-        )
-        self.export_parameter(
-            "3_boldStat", "out_spm_mat_file", is_optional=False
+            "concat_to_list_of_list.listOflist->import_data.rois_list"
         )
+        self.add_link("import_data.rois_files->convroi.images_to_convolve")
+        self.add_link("find_in_list_1.out_file->files_to_list.file1")
+        self.add_link("find_in_list_2.out_file->files_to_list.file2")
         self.add_link(
-            "3_boldStat.beta_images->4_extract_roi_param.beta_images"
+            "files_to_list.file_list->mean_stddev_calc.parametric_maps"
         )
+        self.add_link("convroi.out_images->mean_stddev_calc.rois_files")
         self.export_parameter(
-            "4_extract_roi_param", "resample2_masks", is_optional=False
+            "convroi", "out_images", "conv_roi_masks", is_optional=False
+        )
+        self.add_link("mean_stddev_calc.mean_out_files->concat_to_list.list1")
+        self.add_link("mean_stddev_calc.std_out_files->concat_to_list.list2")
+        self.add_link(
+            "concat_to_list.out_list->result_collector.parameter_files"
         )
         self.export_parameter(
-            "4_extract_roi_param", "xls_files", is_optional=False
+            "result_collector", "out_files", "xls_files", is_optional=False
         )
         self.export_parameter(
-            "4_extract_roi_param", "conv_roi_masks", is_optional=False
+            "result_collector", "patient_info", is_optional=True
         )
-        self.add_link("files_to_list.file_list->3_boldStat.regressors")
 
         # parameters order
 
         self.reorder_traits(
             (
-                "anat_file",
-                "func_files",
-                "regressor_physio",
-                "out_spm_mat_file",
-                "bias_field_images",
-                "normalized_anat",
-                "coregistered_source",
+                "spmT_images",
+                "beta_images",
                 "mask_003",
-                "conv_roi_masks",
                 "patient_info",
-                "resample2_masks",
                 "xls_files",
+                "conv_roi_masks",
             )
         )
 
         # nodes positions
         self.node_position = {
-            "inputs": (-275.0790595529901, 183.49872617882536),
-            "1_spatial_preprocessing": (
-                -164.59507406061374,
-                -222.31943258070515,
-            ),
-            "2_spatial_mask": (183.75989123102062, -212.8388047341995),
-            "3_boldStat": (120.47624500640808, 271.95641405347675),
-            "4_extract_roi_param": (528.7543856377755, -56.221297992058865),
-            "files_to_list": (-52.58039247862696, 250.55123446892662),
-            "outputs": (805.7712478465897, -179.76368248093885),
+            "concat_to_list_of_list": (600.7683536977197, 728.759454227074),
+            "import_data": (838.6779740642814, 754.1903278234439),
+            "find_in_list_1": (932.5914095369304, 358.62362954626724),
+            "find_in_list_2": (934.9228804667309, 484.75539916550395),
+            "files_to_list": (1114.731116701135, 420.0484771498629),
+            "convroi": (1065.1429219295185, 724.9587551579114),
+            "inputs": (611.1177232874335, 426.308895086078),
+            "mean_stddev_calc": (1271.1258849845178, 433.198331290194),
+            "concat_to_list": (1548.909413304923, 471.51209287285405),
+            "result_collector": (1593.7045438762555, 614.2307688530867),
+            "outputs": (1776.5211971944557, 773.6691624619851),
         }
 
         # nodes dimensions
         self.node_dimension = {
-            "inputs": (138.46938723929543, 180.0),
-            "1_spatial_preprocessing": (236.515625, 320.0),
-            "2_spatial_mask": (200.15625, 145.0),
-            "3_boldStat": (215.375, 145.0),
-            "4_extract_roi_param": (206.875, 180.0),
+            "concat_to_list_of_list": (143.21875, 110.0),
+            "import_data": (147.703125, 180.0),
+            "find_in_list_1": (118.84375, 110.0),
+            "find_in_list_2": (118.84375, 110.0),
             "files_to_list": (97.640625, 145.0),
-            "outputs": (138.83679503946317, 320.0),
+            "convroi": (208.0625, 145.0),
+            "inputs": (119.17251223929541, 136.0),
+            "mean_stddev_calc": (214.171875, 180.0),
+            "concat_to_list": (97.96875, 110.0),
+            "result_collector": (171.640625, 145.0),
+            "outputs": (113.32117003946317, 86.0),
         }
 
         self.do_autoexport_nodes_parameters = False
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/DWITractography/__init__.py` & `mia_processes-2.6.0/mia_processes/pipelines/DWITractography/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/DWITractography/dwi_whole_brain_tractography.py` & `mia_processes-2.6.0/mia_processes/pipelines/DWITractography/dwi_whole_brain_tractography.py`

 * *Files 4% similar despite different names*

```diff
@@ -116,20 +116,14 @@
             "mia_processes.bricks.preprocess."
             "mrtrix.processes.SphericalHarmonicExtraction",
         )
 
         # links
         self.export_parameter("dwi_preprocessing", "in_dwi", is_optional=False)
         self.export_parameter(
-            "dwi_preprocessing", "in_bvec", is_optional=False
-        )
-        self.export_parameter(
-            "dwi_preprocessing", "in_bval", is_optional=False
-        )
-        self.export_parameter(
             "dwi_preprocessing", "in_dwi_pe_dir", is_optional=True
         )
         self.export_parameter(
             "dwi_preprocessing", "in_dwi_ro_time", is_optional=True
         )
         self.export_parameter(
             "dwi_preprocessing", "in_b0_reverse", is_optional=False
@@ -197,16 +191,14 @@
         )
 
         # parameters order
 
         self.reorder_traits(
             (
                 "in_dwi",
-                "in_bvec",
-                "in_bval",
                 "in_dwi_pe_dir",
                 "in_dwi_ro_time",
                 "in_b0_reverse",
                 "in_T1w",
                 "sh_peaks",
                 "tracks_10mio",
                 "tracks_sift",
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/__init__.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_airmask.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_airmask.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_headmask.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_headmask.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_mni_tpms.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_mni_tpms.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_skullstrip.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_skullstrip.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_skullstrip_synthstrip.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_skullstrip_synthstrip.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/anat_spatial_norm.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/anat_spatial_norm.py`

 * *Files 0% similar despite different names*

```diff
@@ -51,17 +51,17 @@
             "mia_processes.bricks.preprocess.ants.processes.Registration",
         )
         self.nodes["registration"].process.convergence_threshold = [
             1e-07,
             1e-08,
         ]
         self.nodes["registration"].process.convergence_window_size = [15, 5, 3]
-        self.nodes[
-            "registration"
-        ].process.interpolation = "LanczosWindowedSinc"
+        self.nodes["registration"].process.interpolation = (
+            "LanczosWindowedSinc"
+        )
         self.nodes["registration"].process.metric = ["Mattes", "Mattes"]
         self.nodes["registration"].process.metric_weight = [1.0, 1.0]
         self.nodes["registration"].process.number_of_iterations = [[20], [15]]
         self.nodes["registration"].process.radius_or_number_of_bins = [56, 56]
         self.nodes["registration"].process.sampling_percentage = [0.2, 0.1]
         self.nodes["registration"].process.sampling_strategy = [
             "Random",
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_hmc.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_hmc.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_mni_align.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_mni_align.py`

 * *Files 0% similar despite different names*

```diff
@@ -53,17 +53,17 @@
             1e-06,
         ]
         self.nodes["registration"].process.convergence_window_size = [
             20,
             20,
             10,
         ]
-        self.nodes[
-            "registration"
-        ].process.interpolation = "LanczosWindowedSinc"
+        self.nodes["registration"].process.interpolation = (
+            "LanczosWindowedSinc"
+        )
         self.nodes["registration"].process.metric = ["Mattes", "Mattes", "CC"]
         self.nodes["registration"].process.metric_weight = [1, 1, 1]
         self.nodes["registration"].process.number_of_iterations = [
             [10000, 1000, 100],
             [500, 250, 100],
             [100, 30, 20],
         ]
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing1.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing1.py`

 * *Files 17% similar despite different names*

```diff
@@ -82,42 +82,87 @@
             "mia_processes.bricks.preprocess.spm.spatial_preprocessing."
             "Coregister",
         )
         self.nodes["coregister"].process.source = traits.Undefined
         self.nodes["coregister"].process.apply_to_files = traits.Undefined
 
         # links
-        self.export_parameter("list_duplicate", "file_name", "anat_file")
-        self.export_parameter("realign", "in_files", "func_files")
-        self.export_parameter("newsegment", "bias_corrected_images")
-        self.export_parameter("newsegment", "bias_field_images")
-        self.export_parameter("newsegment", "native_class_images")
-        self.export_parameter("newsegment", "forward_deformation_field")
+        self.export_parameter(
+            "list_duplicate", "file_name", "anat_file", is_optional=False
+        )
+        self.export_parameter(
+            "realign", "in_files", "func_files", is_optional=False
+        )
+        self.export_parameter(
+            "newsegment", "bias_corrected_images", is_optional=True
+        )
+        self.export_parameter(
+            "newsegment", "bias_field_images", is_optional=True
+        )
+        self.export_parameter(
+            "newsegment", "native_class_images", is_optional=True
+        )
         self.add_link(
             "newsegment.forward_deformation_field->"
-            "normalize12_2.deformation_file"
+            "normalize12_1.deformation_file"
+        )
+        self.export_parameter(
+            "newsegment", "forward_deformation_field", is_optional=True
         )
         self.add_link(
             "newsegment.forward_deformation_field->"
-            "normalize12_1.deformation_file"
+            "normalize12_2.deformation_file"
         )
         self.add_link("realign.realigned_files->coregister.apply_to_files")
         self.add_link("realign.mean_image->coregister.source")
-        self.export_parameter("realign", "realignment_parameters")
+        self.export_parameter(
+            "realign", "realignment_parameters", is_optional=True
+        )
         self.add_link("list_duplicate.out_file->coregister.target")
-        self.add_link("list_duplicate.out_list->normalize12_1.apply_to_files")
         self.add_link("list_duplicate.out_list->newsegment.channel_files")
+        self.add_link("list_duplicate.out_list->normalize12_1.apply_to_files")
         self.export_parameter(
-            "normalize12_1", "normalized_files", "normalized_anat"
+            "normalize12_1",
+            "normalized_files",
+            "normalized_anat",
+            is_optional=True,
         )
         self.add_link("normalize12_2.normalized_files->smooth.in_files")
-        self.export_parameter("smooth", "smoothed_files", "smoothed_func")
-        self.export_parameter("coregister", "coregistered_source")
+        self.export_parameter(
+            "normalize12_2",
+            "normalized_files",
+            "normalized_func",
+            is_optional=True,
+        )
+        self.export_parameter(
+            "smooth", "smoothed_files", "smoothed_func", is_optional=False
+        )
+        self.export_parameter(
+            "coregister", "coregistered_source", is_optional=False
+        )
         self.add_link(
-            "coregister.coregistered_files->normalize12_2.apply_to_files"
+            "coregister.coregistered_files->" "normalize12_2.apply_to_files"
+        )
+
+        # parameters order
+
+        self.reorder_traits(
+            (
+                "anat_file",
+                "func_files",
+                "bias_corrected_images",
+                "bias_field_images",
+                "native_class_images",
+                "forward_deformation_field",
+                "realignment_parameters",
+                "normalized_anat",
+                "smoothed_func",
+                "coregistered_source",
+                "normalized_func",
+            )
         )
 
         # nodes positions
         self.node_position = {
             "outputs": (431.5335139107567, 281.77678807649437),
             "inputs": (-703.3088243130337, 598.5753496196925),
             "normalize12_1": (20.32584777973804, 161.56490940865137),
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing2.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/bold_spatial_preprocessing2.py`

 * *Files 2% similar despite different names*

```diff
@@ -38,17 +38,17 @@
         # nodes
         self.add_process(
             "normalize12_T1_estwrite",
             "mia_processes.bricks.preprocess.spm.spatial_preprocessing."
             "Normalize12",
         )
         self.nodes["normalize12_T1_estwrite"].process.jobtype = "estwrite"
-        self.nodes[
-            "normalize12_T1_estwrite"
-        ].process.bias_regularization = 0.0001
+        self.nodes["normalize12_T1_estwrite"].process.bias_regularization = (
+            0.0001
+        )
         self.nodes["normalize12_T1_estwrite"].process.bias_fwhm = 30
         self.nodes["normalize12_T1_estwrite"].process.write_interp = 4
 
         self.add_process(
             "realign",
             "mia_processes.bricks.preprocess.spm.spatial_preprocessing."
             "Realign",
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/dwi_fod_msmt_csd.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/dwi_fod_msmt_csd.py`

 * *Files 0% similar despite different names*

```diff
@@ -11,15 +11,14 @@
 
 """
 
 from capsul.api import Pipeline
 
 
 class Dwi_fod_msmt_csd(Pipeline):
-
     """
     *DWI fiber orientation distribution*
 
     Please, see the complete documentation for the
     `Dwi_fod_msmt_csd pipeline in the mia_processes website
     <https://populse.github.io/mia_processes/html/documentation/pipelines/preprocess/Dwi_fod_msmt_csd.html>`_
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/dwi_preprocessing.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/dwi_preprocessing.py`

 * *Files 3% similar despite different names*

```diff
@@ -10,15 +10,14 @@
         - Dwi_preprocessing
 
 """
 from capsul.api import Pipeline
 
 
 class Dwi_preprocessing(Pipeline):
-
     """
     *DWI preprocessing with reverse b0*
 
     Please, see the complete documentation for the
     `Dwi_preprocessing pipeline in the mia_processes website
     <https://populse.github.io/mia_processes/html/documentation/pipelines/preprocess/Dwi_preprocessing.html>`_
 
@@ -43,20 +42,20 @@
             "Unringing",
             "mia_processes.bricks.preprocess.mrtrix.processes.MRDeGibbs",
         )
         self.add_process(
             "MotionDistortionCorrection",
             "mia_processes.bricks.preprocess.mrtrix.processes.DWIPreproc",
         )
-        self.nodes[
-            "MotionDistortionCorrection"
-        ].process.rpe_options = "rpe_pair"
-        self.nodes[
-            "MotionDistortionCorrection"
-        ].process.eddy_options = " --slm=linear --data_is_shelled"
+        self.nodes["MotionDistortionCorrection"].process.rpe_options = (
+            "rpe_pair"
+        )
+        self.nodes["MotionDistortionCorrection"].process.eddy_options = (
+            " --slm=linear --data_is_shelled"
+        )
         self.add_process(
             "Extractb0",
             "mia_processes.bricks.preprocess.mrtrix.processes.DWIExtract",
         )
         self.add_process(
             "Meanb0", "mia_processes.bricks.preprocess.mrtrix.processes.MRMath"
         )
@@ -80,16 +79,14 @@
             "mia_processes.bricks.preprocess.mrtrix.processes.DWIBrainMask",
         )
 
         # links
         self.export_parameter(
             "Convert_dwi", "in_file", "in_dwi", is_optional=False
         )
-        self.export_parameter("Convert_dwi", "in_bvec", is_optional=False)
-        self.export_parameter("Convert_dwi", "in_bval", is_optional=False)
         self.export_parameter(
             "MotionDistortionCorrection",
             "pe_dir",
             "in_dwi_pe_dir",
             is_optional=True,
         )
         self.export_parameter(
@@ -128,16 +125,14 @@
         )
 
         # parameters order
 
         self.reorder_traits(
             (
                 "in_dwi",
-                "in_bvec",
-                "in_bval",
                 "in_dwi_pe_dir",
                 "in_dwi_ro_time",
                 "in_b0_reverse",
                 "brain_mask",
                 "preproc_dwi",
             )
         )
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/dwi_tissue_boundaries.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/dwi_tissue_boundaries.py`

 * *Files 0% similar despite different names*

```diff
@@ -10,15 +10,14 @@
 
 """
 
 from capsul.api import Pipeline
 
 
 class Dwi_tissue_boundaries(Pipeline):
-
     """
     *DWI create tissue boudadiries with a T1w*
 
     Please, see the complete documentation for the
     `Dwi_tissue_boundaries pipeline in the mia_processes website
     <https://populse.github.io/mia_processes/html/documentation/pipelines/preprocess/Dwi_tissue_boundaries.html>`_
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/preprocess/spatial_mask.py` & `mia_processes-2.6.0/mia_processes/pipelines/preprocess/spatial_mask.py`

 * *Files 4% similar despite different names*

```diff
@@ -47,14 +47,15 @@
         self.nodes["threshold_1"].process.in_files = traits.Undefined
         self.nodes["threshold_1"].process.prefix = traits.Undefined
 
         self.add_process(
             "smooth", "mia_processes.bricks.preprocess.spm.Smooth"
         )
         self.nodes["smooth"].process.in_files = traits.Undefined
+        self.nodes["smooth"].process.data_type = 4
 
         self.add_process(
             "threshold_2", "mia_processes.bricks.preprocess.others.Threshold"
         )
         self.nodes["threshold_2"].process.in_files = traits.Undefined
         self.nodes["threshold_2"].process.suffix = traits.Undefined
         self.nodes["threshold_2"].process.prefix = "mask_"
@@ -70,27 +71,26 @@
             "gm_wm_normalize", "apply_to_files", "native_class_images"
         )
         self.export_parameter("gm_wm_normalize", "deformation_file")
         self.add_link("gm_wm_normalize.normalized_files->threshold_1.in_files")
         self.add_link("threshold_1.out_files->smooth.in_files")
         self.add_link("smooth.smoothed_files->threshold_2.in_files")
         self.add_link("threshold_2.out_files->resample1.files_to_resample")
-        self.export_parameter("threshold_2", "out_files", "mask_002")
         self.export_parameter("resample1", "out_files", "mask_003")
         self.export_parameter("resample1", "reference_image", "smoothed_func")
 
         # nodes positions
         self.node_position = {
-            "resample1": (1098.1930830538756, 358.70082875467926),
-            "gm_wm_normalize": (148.0592545730909, 241.78618461052582),
-            "threshold_2": (859.6906003882427, 166.4031059560745),
-            "smooth": (589.819429076529, 60.48208962658873),
-            "outputs": (1253.8683258652045, 204.33700914618174),
-            "inputs": (-108.82929066732682, 268.3653106451782),
-            "threshold_1": (383.85268207902703, -53.26912478589021),
+            "resample1": (1067.6501882850332, 222.64611569347358),
+            "gm_wm_normalize": (136.9527473844211, 309.8135411411285),
+            "threshold_2": (866.6321673811615, 369.0968621492992),
+            "smooth": (607.8675032581176, 370.0759775107607),
+            "outputs": (1284.411220634047, 244.59809770510992),
+            "inputs": (-49.131814528226414, 168.40674594714966),
+            "threshold_1": (418.5605170436202, 453.4652656971715),
         }
 
         # nodes dimensions
         self.node_dimension = {
             "inputs": (157.4068872392954, 111.0),
             "threshold_1": (152.609375, 215.0),
             "smooth": (218.046875, 215.0),
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/qualityControl/__init__.py` & `mia_processes-2.6.0/mia_processes/pipelines/qualityControl/__init__.py`

 * *Files 19% similar despite different names*

```diff
@@ -10,7 +10,8 @@
 # the CEA-CNRS-INRIA. Refer to the LICENSE file or to
 # http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html
 # for details.
 ##########################################################################
 
 from .anat_mriqc import Anat_mriqc  # noqa: F401
 from .bold_mriqc import Bold_mriqc  # noqa: F401
+from .bold_signals_roi import Bold_signals_roi  # noqa: F401
```

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/qualityControl/anat_mriqc.py` & `mia_processes-2.6.0/mia_processes/pipelines/qualityControl/anat_mriqc.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/qualityControl/bold_mriqc.py` & `mia_processes-2.6.0/mia_processes/pipelines/qualityControl/bold_mriqc.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/reports/__init__.py` & `mia_processes-2.6.0/mia_processes/pipelines/reports/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/reports/bold_iqms.py` & `mia_processes-2.6.0/mia_processes/pipelines/reports/bold_iqms.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/stat/__init__.py` & `mia_processes-2.6.0/mia_processes/pipelines/stat/__init__.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/pipelines/stat/bold_stat_cvr.py` & `mia_processes-2.6.0/mia_processes/pipelines/stat/bold_stat_cvr.py`

 * *Files 8% similar despite different names*

```diff
@@ -61,15 +61,15 @@
         self.export_parameter(
             "make_a_list", "obj1", "regressors", is_optional=False
         )
         self.export_parameter(
             "level1design", "sess_scans", "smoothed_func", is_optional=False
         )
         self.export_parameter(
-            "level1design", "mask_image", "mask_002", is_optional=True
+            "level1design", "mask_image", "mask_003", is_optional=True
         )
         self.export_parameter(
             "estimatecontrast", "spmT_images", is_optional=True
         )
         self.export_parameter(
             "estimatecontrast", "out_spm_mat_file", is_optional=False
         )
@@ -88,35 +88,35 @@
 
         # parameters order
 
         self.reorder_traits(
             (
                 "regressors",
                 "smoothed_func",
-                "mask_002",
+                "mask_003",
                 "spmT_images",
                 "out_spm_mat_file",
                 "beta_images",
             )
         )
 
         # nodes positions
         self.node_position = {
-            "estimatecontrast": (809.5599999999998, 60.0),
-            "level1design": (139.24, -103.75999999999988),
-            "estimatemodel": (489.87999999999977, 145.7199999999999),
-            "make_a_list": (8.399999999999991, 255.60000000000002),
+            "estimatecontrast": (854.3356190476188, 53.00380952380948),
+            "level1design": (171.42247619047617, -102.36076190476183),
+            "estimatemodel": (515.0662857142854, 175.10399999999987),
+            "make_a_list": (39.18323809523808, 198.2312380952381),
             "inputs": (-158.2314466389599, 157.20000000000002),
-            "outputs": (1133.715545039463, 267.3599999999999),
+            "outputs": (1150.50640218232, 168.01409523809508),
         }
 
         # nodes dimensions
         self.node_dimension = {
-            "estimatecontrast": (226.203125, 425.0),
+            "estimatecontrast": (247.8125, 425.0),
             "level1design": (290.015625, 880.0),
-            "estimatemodel": (246.296875, 425.0),
-            "make_a_list": (101.984375, 110.0),
-            "inputs": (109.015625, 145.0),
-            "outputs": (121.359375, 145.0),
+            "estimatemodel": (246.296875, 390.0),
+            "make_a_list": (96.515625, 110.0),
+            "inputs": (129.36001223929543, 111.0),
+            "outputs": (124.38367003946317, 111.0),
         }
 
         self.do_autoexport_nodes_parameters = False
```

### Comparing `mia_processes-2.5.0/mia_processes/process_matlab.py` & `mia_processes-2.6.0/mia_processes/process_matlab.py`

 * *Files identical despite different names*

### Comparing `mia_processes-2.5.0/mia_processes/utils/__init__.py` & `mia_processes-2.6.0/mia_processes/utils/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -26,16 +26,16 @@
     dict4runtime_update,
     get_dbFieldValue,
     mriqc_get_all_run,
     mriqc_group_iqms_tsv,
     plot_boxplot_points,
     plot_qi2,
     plot_segmentation,
+    plot_slice_planes,
     set_dbFieldValue,
-    slice_planes_plot,
 )
 
 # Prevent circular import (PageNumCanvas)
 # isort: off
 from .report import Report  # noqa: F401
 
 # isort: on
```

### Comparing `mia_processes-2.5.0/mia_processes/utils/tools.py` & `mia_processes-2.6.0/mia_processes/utils/tools.py`

 * *Files 18% similar despite different names*

```diff
@@ -11,16 +11,17 @@
         - del_dbFieldValue
         - dict4runtime_update
         - get_dbFieldValue
         - mriqc_get_all_run
         - mriqc_group_iqms_tsv
         - plot_boxplot_points
         - plot_qi2
+        - plot_segmentation
+        - plot_slice_planes
         - set_dbFieldValue
-        - slice_planes_plot
 """
 
 ##########################################################################
 # Populse_mia - Copyright (C) IRMaGe/CEA, 2018
 # Distributed under the terms of the CeCILL license, as published by
 # the CEA-CNRS-INRIA. Refer to the LICENSE file or to
 # http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html
@@ -33,15 +34,17 @@
 import os
 
 import matplotlib.pyplot as plt
 import nibabel as nib
 import numpy as np
 import pandas as pd
 from matplotlib.cm import get_cmap
+from matplotlib.colors import LinearSegmentedColormap
 from mpl_toolkits.axes_grid1 import ImageGrid
+from nilearn.image import resample_to_img
 from nilearn.plotting import plot_anat
 from nitransforms.io.afni import _dicom_real_to_card
 from populse_mia.data_manager.data_history_inspect import data_history_pipeline
 from populse_mia.data_manager.project import (
     COLLECTION_CURRENT,
     COLLECTION_INITIAL,
 )
@@ -94,15 +97,15 @@
         """Customise the string representation of the ReportLine object
 
         :returns: the string representation of the object
         """
         return "Line(w=%s)" % self.width
 
     def draw(self):
-        "Draw the line"
+        """Draw the line"""
         self.canv.line(0, self.height, self.width, self.height)
 
 
 def checkFileExt(in_file, ext_dic):
     """Check file extension
 
     :param in_file: file name (a string)
@@ -520,231 +523,439 @@
     project.session.set_values(
         COLLECTION_INITIAL,
         database_filename,
         {tag_to_add["name"]: tag_to_add["value"]},
     )
 
 
-def slice_planes_plot(
-    data,
-    fig_rows,
-    fig_cols,
-    inf_slice_start=None,
-    slices_gap=None,
+def plot_slice_planes(
+    data_1,
+    data_2=None,
+    fig_rows=4,
+    fig_cols=4,
+    slice_start=None,
+    slice_step=None,
     dyn=1,
-    cmap="Greys_r",
+    cmap_1="Greys_r",
+    vmin_1=None,
+    vmax_1=None,
+    cmap_2="rainbow",
+    vmin_2=None,
+    vmax_2=None,
     out_dir=None,
     only_noise=False,
     out_name=None,
 ):
-    "blablabla"
+    """Create a PNG file with a mosaic display of volume slices.
 
-    brain_img = nib.as_closest_canonical(nib.load(data))
-    brain_data = brain_img.get_fdata()
-    brain_data = np.squeeze(brain_data)
+    Several images can be overlaid. data_1, the only mandatory argument,
+    is the background image (or the only image displayed). data_2 is the
+    image (or images) superimposed on data_1. Currently, only axial slices
+    are displayed.
+
+    fig_rows, fig_cols, slice_start and slice_step are optional. If they are
+    not known, plot_slice_planes will try to adapt as best it can to obtain
+    an acceptable display. The default values for fig_rows, fig_cols and dyn
+    are 4, 4 and 1 respectively.
+
+    :param data_1: an existing, image file (valid extensions: .nii).
+    :param data_2: an existing, image file or a list of existing image files
+                   (valid extensions: .nii).
+    :param fig_rows: the number of rows in the images panel (integer).
+    :param fig_cols: the number of columns in the images panel (integer).
+    :param slice_start: starting slice number to be displayed (integer).
+    :param slice_step: the gap between each slice to be displayed (integer).
+    :param dyn: the volume number in the space-time, for 4D (integer).
+    :param cmap_1: the color map name (string) for data_1.
+    :param vmin_1: the low value of the range used for data_1 display(float).
+    :param vmax_1: the high value of the range used for data_1 display(float).
+    :param cmap_2: the color map name (string) or a list of RGB tuple
+                   (ex. [(255, 0, 0), (0, 0, 255)]).
+    :param vmin_2: the low value of the range used for data_2 display(float).
+    :param vmax_2: the high value of the range used for data_2 display(float).
+    :param out_dir: the output directory where the mosaic images will be saved.
+    :param only_noise: if True, shows the noise (boolean).
+    :param out_name: the suffix added to form the output name (string).
+
+    Note: cmap for parametric display can be, gist_rainbow, RdYlBu, Spectral,
+          rainbow_r, jet_r, seismic_r, bwr_r
+    """
+
+    brain_img_1 = nib.as_closest_canonical(nib.load(data_1))
+    brain_data_1 = brain_img_1.get_fdata()
+    brain_data_1 = np.squeeze(brain_data_1)
+
+    if cmap_1 in (None, Undefined):
+        cmap_1 = "Greys_r"
+
+    cmap_1 = get_cmap(cmap_1)
+    cmap_1.set_bad(color="black")
+    brain_data_2 = None
+
+    if data_2 is not None:
+        brain_data_2 = []
+        cmap_2_tmp = []
+        vmin_2_tmp = []
+        vmax_2_tmp = []
+
+        if not isinstance(data_2, list):
+            data_2 = [data_2]
+
+        for i, fil in enumerate(data_2):
+            brain_img_2 = nib.as_closest_canonical(nib.load(fil))
+
+            if brain_img_1.shape[:3] != brain_img_2.shape[:3]:
+                brain_img_2 = resample_to_img(
+                    brain_img_2, brain_img_1, interpolation="linear"
+                )
+
+            data = brain_img_2.get_fdata().astype(np.float32)
+
+            data = np.squeeze(data)
+            nan_indexes = np.isnan(data)
+
+            if cmap_2 in (None, Undefined):
+                cmap = "rainbow"
+
+            elif isinstance(cmap_2, str):
+                cmap = cmap_2
+
+            if isinstance(cmap_2, list):
+                cmap = cmap_2[int(np.fix(i / 2))]
+                norm_mask_color = tuple(channel / 255 for channel in cmap)
+                cmap = LinearSegmentedColormap.from_list(
+                    "CustomCmap", [norm_mask_color, norm_mask_color]
+                )
+
+            else:
+                cmap = get_cmap(cmap)
+
+            cmap.set_bad(alpha=0)
+
+            # Remainder:
+            # Amigo beta cmap vmin - vmax:0.01 - 0.25
+            # Amigo SPMt cmap vmin - vmax:3 - 16
+
+            if vmin_2 in (None, Undefined):
+                vmin = np.min(data[~nan_indexes])
+
+            else:
+                vmin = vmin_2
 
-    if len(brain_data.shape) == 4:
-        brain_data = brain_data[:, :, :, dyn]
+            if vmin < 0:
+                vmin = 0.1
 
-    elif len(brain_data.shape) > 4:
+            if vmax_2 in (None, Undefined):
+                vmax = np.max(data[~nan_indexes])
+
+            else:
+                vmax = vmax_2
+
+            brain_data_2.append(data)
+            cmap_2_tmp.append(cmap)
+            vmin_2_tmp.append(vmin)
+            vmax_2_tmp.append(vmax)
+
+        cmap_2 = cmap_2_tmp
+        vmin_2 = vmin_2_tmp
+        vmax_2 = vmax_2_tmp
+
+    if len(brain_data_1.shape) == 4:
+        brain_data_1 = brain_data_1[:, :, :, dyn]
+
+    elif len(brain_data_1.shape) > 4:
         # TODO: what we do in this case?
         pass
 
-    min_thres = np.percentile(brain_data, 5)
-    mask_data = np.ones_like(brain_data)
-    mask_data[brain_data <= min_thres] = 0
-    ind_non_zero = np.argwhere(mask_data)
+    min_thres = np.percentile(brain_data_1, 5)
+    mask_data_1 = np.ones_like(brain_data_1)
+    mask_data_1[brain_data_1 <= min_thres] = 0
+    ind_non_zero = np.argwhere(mask_data_1)
     (ystart, xstart, zstart), (ystop, xstop, zstop) = (
         ind_non_zero.min(0),
         ind_non_zero.max(0) + 1,
     )
-    brain_data = brain_data[ystart:ystop, xstart:xstop, zstart:zstop]
-    disp_slices = fig_rows * fig_cols
+    brain_data_1 = brain_data_1[ystart:ystop, xstart:xstop, zstart:zstop]
+    mask_data_1 = np.logical_not(np.isnan(brain_data_1))
 
-    if inf_slice_start in (None, Undefined) and slices_gap in (
-        None,
-        Undefined,
-    ):
-        slices_gap = brain_data.shape[2] // disp_slices
-        memory = set()
-        ind_slices = None
-
-        while (
-            len(np.arange(start=0, stop=brain_data.shape[2], step=slices_gap))
-            != disp_slices
-        ):
-            if (
-                len(
-                    np.arange(
-                        start=0, stop=brain_data.shape[2], step=slices_gap
-                    )
-                )
-                in memory
-            ):
-                ind_slices = np.arange(
-                    start=0, stop=brain_data.shape[2], step=slices_gap
-                )
+    if only_noise:
+        vmin_1 = np.percentile(brain_data_1[mask_data_1], 0)
+        vmax_1 = np.percentile(brain_data_1[mask_data_1], 61)
 
-                if len(ind_slices) > disp_slices:
-                    while len(ind_slices) != disp_slices:
-                        ind_slices = ind_slices[:-1]
-
-                    ind_slices = ind_slices[:-1]
-                    ind_slices = np.append(
-                        ind_slices,
-                        ind_slices[-1]
-                        + (brain_data.shape[2] - ind_slices[-1]) // 2,
-                    )
-                    break
-
-                if len(ind_slices) < disp_slices:
-                    slices_gap -= 1
-
-            elif (
-                len(
-                    np.arange(
-                        start=0, stop=brain_data.shape[2], step=slices_gap
-                    )
-                )
-                > disp_slices
-            ):
-                memory.add(
-                    len(
-                        np.arange(
-                            start=0, stop=brain_data.shape[2], step=slices_gap
-                        )
-                    )
-                )
-                slices_gap += 1
+    if vmin_1 in (None, Undefined):
+        vmin_1 = np.percentile(brain_data_1[mask_data_1], 0.5)
 
-            elif (
-                len(
-                    np.arange(
-                        start=0, stop=brain_data.shape[2], step=slices_gap
-                    )
-                )
-                < disp_slices
-            ):
-                memory.add(
-                    len(
-                        np.arange(
-                            start=0, stop=brain_data.shape[2], step=slices_gap
-                        )
-                    )
-                )
-                slices_gap -= 1
+    if vmax_1 in (None, Undefined):
+        vmax_1 = np.percentile(brain_data_1[mask_data_1], 99.5)
 
-        if ind_slices is None:
-            inf_slice_start = (
-                brain_data.shape[2]
-                - np.arange(
-                    start=0, stop=brain_data.shape[2], step=slices_gap
-                )[
-                    len(
-                        np.arange(
-                            start=0, stop=brain_data.shape[2], step=slices_gap
-                        )
-                    )
-                    - 1
-                ]
-            ) // 2
-            ind_slices = np.arange(
-                start=inf_slice_start,
-                stop=brain_data.shape[2],
-                step=slices_gap,
-            )
+    disp_slices = fig_rows * fig_cols
+    lst = np.arange(start=0, stop=brain_data_1.shape[2], step=1)
 
-    elif len(np.array(list(range(0, brain_data.shape[2])))) > disp_slices:
+    if slice_start not in (None, Undefined):
         # fmt: off
-        ind_slices = np.array(list(range(0, brain_data.shape[2])))[
-            inf_slice_start:
-            inf_slice_start + (slices_gap * disp_slices):
-            slices_gap
-        ]
+        lst = lst[slice_start - 1 if slice_start != 0 else 0:]
         # fmt: on
 
+    start = 0
+    ind_slices = []
+
+    if disp_slices > len(lst):
+        disp_slices = len(lst)
+
+    if slice_step in (None, Undefined):
+        avg = len(lst) // disp_slices
+        remainder = len(lst) % disp_slices
+
     else:
-        ind_slices = np.array(list(range(0, brain_data.shape[2])))
+        avg = slice_step
+        remainder = -1
 
-    # Reminder: 19cm == 7.4803inch; 23cm == 9.0551
-    fig = plt.figure(figsize=(7.4803, 9.0551))  # Width, height in inches.
+    for i in range(disp_slices):
+        end = start + avg + (1 if i < remainder else 0)
+
+        if start >= len(lst):
+            break
+
+        ind_slices.append(lst[start:end])
+        start = end
+
+    if all(
+        (isinstance(element, np.ndarray) and len(element) == 1)
+        for element in ind_slices
+    ):
+        ind_slices = [element[0] for element in ind_slices]
 
-    mask_data = np.logical_not(np.isnan(brain_data))
-    if only_noise:
-        vmin = np.percentile(brain_data[mask_data], 0)
-        vmax = np.percentile(brain_data[mask_data], 61)
     else:
-        vmin = np.percentile(brain_data[mask_data], 0.5)
-        vmax = np.percentile(brain_data[mask_data], 99.5)
+        middle_idx = [(len(element) - 1) // 2 for element in ind_slices]
+        ind_slices = [
+            element[idx] for element, idx in zip(ind_slices, middle_idx)
+        ]
 
-    zooms = brain_img.header.get_zooms()
-    grid = ImageGrid(fig, 111, nrows_ncols=(fig_rows, fig_cols), axes_pad=0)
-    cmap = get_cmap(cmap)
+    # Reminder: 19cm == 7.4803inch; 23cm == 9.0551
+    # Width, height in inches
+    fig = plt.figure(figsize=(7.4803, 9.0551), facecolor="black")
+    # fig.patch.set_facecolor("black")
+    zooms = brain_img_1.header.get_zooms()
+
+    if brain_data_2 is None or len(brain_data_2) > 1:
+        grid = ImageGrid(
+            fig,
+            111,
+            nrows_ncols=(fig_rows, fig_cols),
+            axes_pad=0,
+        )
+    elif len(brain_data_2) == 1:
+        grid = ImageGrid(
+            fig,
+            111,
+            nrows_ncols=(fig_rows, fig_cols),
+            axes_pad=0,
+            cbar_mode="single",
+            cbar_location="bottom",
+            cbar_pad=0,
+            cbar_size="2%",
+        )
 
-    if len(ind_slices) < 5:
+    if disp_slices < 5:
         fontsize = 18
 
-    elif len(ind_slices) < 10:
+    elif disp_slices < 10:
         fontsize = 16
 
-    elif len(ind_slices) < 15:
+    elif disp_slices < 15:
         fontsize = 14
 
-    elif len(ind_slices) < 20:
+    elif disp_slices < 20:
         fontsize = 12
 
-    elif len(ind_slices) < 25:
+    elif disp_slices < 25:
         fontsize = 10
 
-    elif len(ind_slices) < 40:
+    elif disp_slices < 40:
         fontsize = 8
 
-    else:
+    elif disp_slices < 100:
         fontsize = 6
 
-    for ax, ind_slice in zip(grid, ind_slices):
-        phys_sp = np.array(zooms[:2]) * brain_data[:, :, ind_slice].shape
+    else:
+        fontsize = 4
+
+    for slice_numb, ax in enumerate(grid):
+
+        if slice_numb >= len(ind_slices):
+            displ_1 = np.zeros((2, 2, 2))
+            ind_slice = 1
+
+            if brain_data_2 is not None:
+                displ_2 = [np.zeros((2, 2, 2))]
+
+            else:
+                displ_2 = None
+
+        else:
+            displ_1 = brain_data_1
+            ind_slice = ind_slices[slice_numb]
+            displ_2 = brain_data_2
 
+        phys_sp = np.array(zooms[:2]) * brain_data_1[:, :, ind_slice].shape
         ax.imshow(
-            np.swapaxes(brain_data[:, :, ind_slice], 0, 1),
-            vmin=vmin,
-            vmax=vmax,
-            cmap=cmap,
+            np.swapaxes(displ_1[:, :, ind_slice], 0, 1),
+            vmin=vmin_1,
+            vmax=vmax_1,
+            cmap=cmap_1,
             interpolation="nearest",
             origin="lower",
             extent=[0, phys_sp[0], 0, phys_sp[1]],
         )
+
+        if displ_2 is not None:
+
+            for i, displ in enumerate(displ_2):
+                data = np.swapaxes(displ[:, :, ind_slice], 0, 1)
+                im2 = ax.imshow(
+                    data,
+                    vmin=vmin_2[i],
+                    vmax=vmax_2[i],
+                    cmap=cmap_2[i],
+                    alpha=np.where(data <= vmin_2[i], 0, 0.5),
+                    # alpha=np.where(data <= vmin_2[i], 0, 1.0),
+                    interpolation="nearest",
+                    origin="lower",
+                    extent=[0, phys_sp[0], 0, phys_sp[1]],
+                )
+
         ax.set_xticklabels([])
         ax.set_yticklabels([])
         ax.grid(False)
         ax.axis("off")
+        # ax.set_facecolor('black')
+        bgcolor = cmap_1(min(vmin_1, 0.0))
+        fgcolor = cmap_1(vmax_1)
 
-        bgcolor = cmap(min(vmin, 0.0))
-        fgcolor = cmap(vmax)
+        if slice_numb + 1 > len(ind_slices):
+            ind_slice = ""
 
         ax.text(
             0.98,
             0.01,
-            "%d" % ind_slice,
+            "{}".format(ind_slice),
             color=fgcolor,
             transform=ax.transAxes,
             horizontalalignment="right",
             verticalalignment="bottom",
             fontsize=fontsize,
             bbox=dict(
                 boxstyle="square,pad=0", edgecolor=bgcolor, facecolor=bgcolor
             ),
         )
 
-    fname, ext = os.path.splitext(os.path.basename(data))
-    if out_name:
+    if brain_data_2 is not None and len(brain_data_2) == 1:
+        cbar = grid.cbar_axes[0].colorbar(im2)
+        cbar.ax.tick_params(labelsize=6, colors="white")
+        cbar.set_label("Intensity", size=6, color="white")
+
+    if data_2 is None:
+        fname, _ = os.path.splitext(os.path.basename(data_1))
+
+    elif len(brain_data_2) > 1:
+        fname = ""
+
+    else:
+        fname, _ = os.path.splitext(os.path.basename(data_2[0]))
+
+    if out_name is not None:
         fname += "_" + out_name
 
     if out_dir is None:
-        out_file = os.path.abspath(fname + "_slice_planes_plot.png")
+        out_dir = os.path.dirname(data_1)
 
-    else:
-        out_file = os.path.join(out_dir, fname + "_slice_planes_plot.png")
+    out_file = os.path.join(out_dir, fname + "_slice_planes_plot.png")
+    counter = 1
 
-    fig.savefig(out_file, format="png", dpi=300, bbox_inches="tight")
+    while os.path.exists(out_file):
+        b_name, ext = os.path.splitext(out_file)
+        out_file = f"{b_name}_{counter:03d}{ext}"
+        counter += 1
 
+    fig.savefig(out_file, format="png", dpi=300, bbox_inches="tight")
     return out_file
+
+
+def check_orientations(images, verbose=True):
+    """Check the dimensions and orientations of the images.
+
+    images: images from nibabel
+    verbose: whether to create a verbose returned message.
+
+    returns:    status: status (True means OK)
+                message: string describing status (empty if OK)
+
+    """
+    status = True
+    message = ""
+
+    if len(images) <= 1:
+        return status, message
+
+    dimensions = [img.shape for img in images]
+    orientations = [img.affine for img in images]
+
+    if len(set(dimensions)) > 1:
+        status = False
+        message += "The images do not all have the same dimensions.\n"
+
+        if verbose:
+            message += (
+                "The function assumes that a voxel in one image "
+                "corresponds to the same voxel in another.\n"
+            )
+            message += (
+                "This is not a safe assumption if the dimensions "
+                "of the images differ.\n"
+            )
+            message += (
+                "Please ensure that you have processed all the "
+                "image data in the same way (eg. check spatial "
+                "normalisation bounding-boxes, voxel-sizes etc).\n"
+            )
+            message += "Here are the dimensions of the image volumes:\n"
+
+            for i, dim in enumerate(dimensions):
+                message += (
+                    f'[{", ".join(map(str, dim))}]:'
+                    f"{images[i].get_filename()}\n"
+                )
+            message += "\n"
+
+    if len(set(orientations)) > 1:
+        status = False
+        message += (
+            "The images do not all have the same orientation "
+            "and/or voxel size.\n"
+        )
+        if verbose:
+            message += (
+                "The function assumes that a voxel in one image "
+                "corresponds exactly with the same voxel "
+                "in another.\n"
+            )
+            message += (
+                "This is not a safe assumption if the orientation "
+                "information in the headers files indicates that\n"
+            )
+            message += (
+                "the images are oriented differently. Please ensure "
+                "that you process all data correctly.\n"
+            )
+            message += (
+                "For example, you may have realigned the images, "
+                "but not actually resliced them to be in voxel-wise "
+                "alignment.\n"
+            )
+            message += (
+                "Here are the orientation matrices of the " "image volumes:\n"
+            )
+
+            for i, orient in enumerate(orientations):
+                message += f"{orient}\n"
+
+    return status, message
```

### Comparing `mia_processes-2.5.0/mia_processes.egg-info/PKG-INFO` & `mia_processes-2.6.0/mia_processes.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
-Name: mia-processes
-Version: 2.5.0
+Name: mia_processes
+Version: 2.6.0
 Summary: mia_processes
 Home-page: http://populse.github.io/mia_processes
 Author: Populse team
 Author-email: Populse team <populse-support@univ-grenoble-alpes.fr>
 License: CeCILL-B
 Project-URL: homepage, http://populse.github.io/mia_processes/
 Project-URL: repository, https://github.com/populse/mia_processes
@@ -30,14 +30,15 @@
 Requires-Dist: nibabel
 Requires-Dist: nilearn
 Requires-Dist: nipy
 Requires-Dist: nipype
 Requires-Dist: nitime
 Requires-Dist: nitransforms
 Requires-Dist: numpy
+Requires-Dist: openpyxl
 Requires-Dist: paramiko
 Requires-Dist: populse-db<3.0.0,>=2.5.0
 Requires-Dist: populse_mia<3.0.0,>=2.5.0
 Requires-Dist: pyxnat
 Requires-Dist: reportlab
 Requires-Dist: scipy
 Requires-Dist: statsmodels
@@ -119,29 +120,36 @@
 
 Many mia_processes bricks (atomic processes) use third-party softwares. To use these bricks, the corresponding [third-party softwares must be installed](https://populse.github.io/populse_mia/html/installation/3rd-party_installations.html).
 
 
 # Requirements
 
 In order to get all the bricks and pipelines proposed by mia_processes some third libraries are required:
+* boto
+* cmp
+* cfflib
 * dipy
 * nibabel
 * nilearn
 * nipy
 * nipype
 * nitime
 * nitransforms
 * numpy
-* populse_db >=2.1.0
-* populse_mia >= 2.2.0
+* openpyxl
+* paramiko
+* populse-db >= 2.5.0, < 3.0.0
+* populse_mia >= 2.5.0, < 3.0.0
+* pyxnat
 * reportlab
 * scipy
 * statsmodels
 * templateflow
 * torch
+* vtk
 
 # License
 
 * The whole populse project is open source.
 * Mia_processes is precisely released under the CeCILL software license.
 * All license details can be found [here](http://cecill.info/licences/Licence_CeCILL_V2.1-en.html), or refer to the license file [here](https://github.com/populse/mia_processes/blob/master/LICENSE).
```

### Comparing `mia_processes-2.5.0/mia_processes.egg-info/SOURCES.txt` & `mia_processes-2.6.0/mia_processes.egg-info/SOURCES.txt`

 * *Files 8% similar despite different names*

```diff
@@ -19,20 +19,24 @@
 mia_processes/bricks/preprocess/ants/processes.py
 mia_processes/bricks/preprocess/dipy/__init__.py
 mia_processes/bricks/preprocess/dipy/processes.py
 mia_processes/bricks/preprocess/freesurfer/__init__.py
 mia_processes/bricks/preprocess/freesurfer/processes.py
 mia_processes/bricks/preprocess/fsl/__init__.py
 mia_processes/bricks/preprocess/fsl/processes.py
+mia_processes/bricks/preprocess/matlab_wrap/__init__.py
+mia_processes/bricks/preprocess/matlab_wrap/processes.py
 mia_processes/bricks/preprocess/mrtrix/__init__.py
 mia_processes/bricks/preprocess/mrtrix/processes.py
 mia_processes/bricks/preprocess/others/__init__.py
 mia_processes/bricks/preprocess/others/processing.py
 mia_processes/bricks/preprocess/spm/__init__.py
 mia_processes/bricks/preprocess/spm/spatial_preprocessing.py
+mia_processes/bricks/preprocess/volbrain/__init__.py
+mia_processes/bricks/preprocess/volbrain/processes.py
 mia_processes/bricks/reports/__init__.py
 mia_processes/bricks/reports/processes.py
 mia_processes/bricks/reports/reporting.py
 mia_processes/bricks/stat/__init__.py
 mia_processes/bricks/stat/spm/__init__.py
 mia_processes/bricks/stat/spm/model.py
 mia_processes/bricks/tools/__init__.py
@@ -56,15 +60,17 @@
 mia_processes/pipelines/preprocess/dwi_fod_msmt_csd.py
 mia_processes/pipelines/preprocess/dwi_preprocessing.py
 mia_processes/pipelines/preprocess/dwi_tissue_boundaries.py
 mia_processes/pipelines/preprocess/spatial_mask.py
 mia_processes/pipelines/qualityControl/__init__.py
 mia_processes/pipelines/qualityControl/anat_mriqc.py
 mia_processes/pipelines/qualityControl/bold_mriqc.py
+mia_processes/pipelines/qualityControl/bold_signals_roi.py
 mia_processes/pipelines/reports/__init__.py
 mia_processes/pipelines/reports/bold_iqms.py
 mia_processes/pipelines/reports/extract_roi_param.py
 mia_processes/pipelines/stat/__init__.py
 mia_processes/pipelines/stat/bold_stat_cvr.py
+mia_processes/sources_images/__init__.py
 mia_processes/utils/__init__.py
 mia_processes/utils/report.py
 mia_processes/utils/tools.py
```

### Comparing `mia_processes-2.5.0/pyproject.toml` & `mia_processes-2.6.0/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [project]
 name = "mia_processes"
-version = "2.5.0"
+version = "2.6.0"
 authors = [
     {name = "Populse team", email = "populse-support@univ-grenoble-alpes.fr"},
 ]
 description = "mia_processes"
 readme = "README.md"
 requires-python = ">=3.9"
 license = {text = "CeCILL-B"}
@@ -29,14 +29,15 @@
     "nibabel",
     "nilearn",
     "nipy",
     "nipype",
     "nitime",
     "nitransforms",
     "numpy",
+    "openpyxl",
     "paramiko",
     "populse-db >= 2.5.0, < 3.0.0",
     "populse_mia >= 2.5.0, < 3.0.0",
     "pyxnat",
     "reportlab",
     "scipy",
     "statsmodels",
```

### Comparing `mia_processes-2.5.0/setup.py` & `mia_processes-2.6.0/setup.py`

 * *Files identical despite different names*

